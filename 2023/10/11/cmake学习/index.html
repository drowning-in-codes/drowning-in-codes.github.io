<!doctypehtml><html lang=zh-CN><script defer src=/live2d-widget/autoload.js></script><meta charset=UTF-8><meta content=width=device-width,initial-scale=1,maximum-scale=2 name=viewport><meta content=#222 name=theme-color><meta content="Hexo 5.4.0" name=generator><link href=/images/blog_32px.png rel=apple-touch-icon sizes=180x180><link href=/images/blog_32px.png rel=icon sizes=32x32 type=image/png><link href=/images/blog_16px.png rel=icon sizes=16x16 type=image/png><link color=#222 href=/images/logo.svg rel=mask-icon><meta content=EPrJAp11bJwHULpQUaSNSZ8_3RcvTsPDAEGOME4pl1w name=google-site-verification><!-- Google tag (gtag.js) --><!-- 
<script async src="https://www.googletagmanager.com/gtag/js?id=G-VB21D8MKKW"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-VB21D8MKKW');
</script> --><!-- google adsense in head.swig --><script async crossorigin=anonymous src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4034523802263123></script><meta content=7226864CE87CE9DE8C008385273846FF name=msvalidate.01><meta content=code-fjFXVtiL7j name=baidu-site-verification><link href=/css/main.css rel=stylesheet><link as=style href=https://fonts.googleapis.com/css?family=Roboto%20Mono,Roboto:300,300italic,400,400italic,700,700italic|Roboto:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext onload=this.rel='stylesheet' rel=preload><link as=style href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css onload=this.rel='stylesheet' rel=preload><link href=https://fonts.googleapis.com/css?family=Noto+Serif+SC|Roboto&display=swap rel=stylesheet><link href=https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css rel=stylesheet><link href=https://cdn.jsdelivr.net/npm/pace-js@1/themes/blue/pace-theme-minimal.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/pace-js@1/pace.min.js></script><script id=hexo-configurations>var NexT = window.NexT || {};
    var CONFIG = {"hostname":"www.sekyoro.top","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","width":240,"display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":null},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":true,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"appID":"0F9LEEVW82","apiKey":"78839e9f9be09d081c5c4da81975cd19","indexName":"sekyoblog_sec","hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"manual","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};</script><link href=//cdn.bootcss.com/animate.css/3.5.0/animate.min.css rel=stylesheet><meta content=åœ¨Windowsä¸Šå¼€å‘c++ç›¸æ¯”Linuxè¿˜æ˜¯æœ‰ç‚¹ä¸æ–¹ä¾¿,è¿™é‡Œä»‹ç»CMake,è·¨å¹³å°çš„æ„å»ºå·¥å…·. name=description><meta content=article property=og:type><meta content=cmakeå­¦ä¹  property=og:title><meta content=https://www.sekyoro.top/2023/10/11/cmake%E5%AD%A6%E4%B9%A0/index.html property=og:url><meta content=Sekyoroçš„åšå®¢å°å±‹ property=og:site_name><meta content=åœ¨Windowsä¸Šå¼€å‘c++ç›¸æ¯”Linuxè¿˜æ˜¯æœ‰ç‚¹ä¸æ–¹ä¾¿,è¿™é‡Œä»‹ç»CMake,è·¨å¹³å°çš„æ„å»ºå·¥å…·. property=og:description><meta content=zh_CN property=og:locale><meta content=https://i.imgur.com/0mXZUbA.png property=og:image><meta content=https://i.imgur.com/cozY007.png property=og:image><meta content=https://s2.loli.net/2024/07/23/T2xNuyIMd9ZaPRH.png property=og:image><meta content=https://s2.loli.net/2024/07/24/2dorRDC4hYVsbj7.png property=og:image><meta content=https://s2.loli.net/2024/07/25/KifydlhZsekbLva.png property=og:image><meta content=https://s2.loli.net/2024/07/25/SLxahKDtwsZ6dMz.png property=og:image><meta content=https://s2.loli.net/2024/07/25/N3yYAxsBnIatMJ4.png property=og:image><meta content=2023-10-11T09:26:00.000Z property=article:published_time><meta content=2025-02-07T14:13:19.000Z property=article:modified_time><meta content=Sekyoro property=article:author><meta content=CMake property=article:tag><meta content=summary name=twitter:card><meta content=https://i.imgur.com/0mXZUbA.png name=twitter:image><link href=https://www.sekyoro.top/2023/10/11/cmake%E5%AD%A6%E4%B9%A0/ rel=canonical><script id=page-configurations>// https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };</script><title>cmakeå­¦ä¹  | Sekyoroçš„åšå®¢å°å±‹</title><noscript><style>.use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }</style></noscript><link href=/atom.xml rel=alternate title=Sekyoroçš„åšå®¢å°å±‹ type=application/atom+xml><body itemscope itemtype=http://schema.org/WebPage><canvas style="position: fixed;left: 0;top: 0;z-index: 1; pointer-events: none;" class=fireworks></canvas><script defer src=https://cdn.bootcss.com/animejs/2.2.0/anime.min.js></script><script defer src=/js/src/fireworks.js></script><div class="container use-motion"><div class=headband></div><header class=header itemscope itemtype=http://schema.org/WPHeader><div class=header-inner><div class=site-brand-container><div class=site-nav-toggle><div aria-label=åˆ‡æ¢å¯¼èˆªæ  class=toggle><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div></div><div class=site-meta><a class=brand href=/ rel=start> <span class=logo-line-before><i></i></span> <h1 class=site-title>Sekyoroçš„åšå®¢å°å±‹</h1> <span class=logo-line-after><i></i></span> </a></div><div class=site-nav-right><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class=site-nav><ul class="main-menu menu" id=menu><li class="menu-item menu-item-home"><a href=/ rel=section><i class="fa fa-home fa-fw"></i>é¦–é¡µ</a><li class="menu-item menu-item-about"><a href=/about/ rel=section><i class="fa fa-user fa-fw"></i>å…³äº</a><li class="menu-item menu-item-tags"><a href=/tags/ rel=section><i class="fa fa-tags fa-fw"></i>æ ‡ç­¾</a><li class="menu-item menu-item-categories"><a href=/categories/ rel=section><i class="fa fa-th fa-fw"></i>åˆ†ç±»</a><li class="menu-item menu-item-archives"><a href=/archives/ rel=section><i class="fa fa-archive fa-fw"></i>å½’æ¡£</a><li class="menu-item menu-item-bangumis"><a href=/bangumis/ rel=section><i class="fa fa-film fa-fw"></i>è¿½ç•ª</a><li class="menu-item menu-item-resume"><a href=/resume/ rel=section><i class="fa fa-file-pdf fa-fw"></i>ç®€å†</a><li class="menu-item menu-item-materials"><a href=/materials/ rel=section><i class="fa fa-book fa-fw"></i>å­¦ä¹ èµ„æ–™</a><li class="menu-item menu-item-sitemap"><a href=/sitemap.xml rel=section><i class="fa fa-sitemap fa-fw"></i>ç«™ç‚¹åœ°å›¾</a><li class="menu-item menu-item-search"><a class=popup-trigger role=button><i class="fa fa-search fa-fw"></i>æœç´¢ </a></ul></nav><div class=search-pop-overlay><div class="popup search-popup"><div class=search-header><span class=search-icon> <i class="fa fa-search"></i> </span><div class=search-input-container></div><span class=popup-btn-close> <i class="fa fa-times-circle"></i> </span></div><div class=algolia-results><div id=algolia-stats></div><div id=algolia-hits></div><div class=algolia-pagination id=algolia-pagination></div></div></div></div></div></header><a class="book-mark-link book-mark-link-fixed" role=button></a><main class=main><div class=main-inner><div class=content-wrap><div class="content post posts-expand"><article class=post-block itemscope itemtype=http://schema.org/Article lang=zh-CN><link href=https://www.sekyoro.top/2023/10/11/cmake%E5%AD%A6%E4%B9%A0/ itemprop=mainEntityOfPage><span hidden itemprop=author itemscope itemtype=http://schema.org/Person> <meta content=https://i.loli.net/2021/05/17/YqoavnXdGTpPO9R.jpg itemprop=image> <meta content=Sekyoro itemprop=name> <meta content=ä»€ä¹ˆä¹Ÿæ— æ³•èˆå¼ƒçš„äººï¼Œä»€ä¹ˆä¹Ÿåšä¸äº†. itemprop=description> </span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization> <meta content=Sekyoroçš„åšå®¢å°å±‹ itemprop=name> </span><header class=post-header><h1 itemprop="name headline" class=post-title>cmakeå­¦ä¹ </h1><div class=post-meta><span class=post-meta-item> <span class=post-meta-item-icon> <i class="far fa-calendar"></i> </span> <span class=post-meta-item-text>å‘è¡¨äº</span> <time itemprop="dateCreated datePublished" title="åˆ›å»ºæ—¶é—´ï¼š2023-10-11 17:26:00" datetime=2023-10-11T17:26:00+08:00>2023-10-11</time> </span><span class=post-meta-item> <span class=post-meta-item-icon> <i class="far fa-calendar-check"></i> </span> <span class=post-meta-item-text>æ›´æ–°äº</span> <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-02-07 22:13:19" datetime=2025-02-07T22:13:19+08:00 itemprop=dateModified>2025-02-07</time> </span><span style="display: none;" class=post-meta-item id=busuanzi_container_page_pv title=é˜…è¯»æ¬¡æ•°> <span class=post-meta-item-icon> <i class="fa fa-eye"></i> </span> <span class=post-meta-item-text>é˜…è¯»æ¬¡æ•°ï¼š</span> <span id=busuanzi_value_page_pv></span> </span><br><span class=post-meta-item title=æœ¬æ–‡å­—æ•°> <span class=post-meta-item-icon> <i class="far fa-file-word"></i> </span> <span class=post-meta-item-text>æœ¬æ–‡å­—æ•°ï¼š</span> <span>55k</span> </span><span class=post-meta-item title=é˜…è¯»æ—¶é•¿> <span class=post-meta-item-icon> <i class="far fa-clock"></i> </span> <span class=post-meta-item-text>é˜…è¯»æ—¶é•¿ â‰ˆ</span> <span>50 åˆ†é’Ÿ</span> </span></div></header><div class=post-body itemprop=articleBody><div class=post-tags><a href=/tags/CMake/ rel=tag># CMake</a></div><p>åœ¨Windowsä¸Šå¼€å‘c++ç›¸æ¯”Linuxè¿˜æ˜¯æœ‰ç‚¹ä¸æ–¹ä¾¿,è¿™é‡Œä»‹ç»CMake,è·¨å¹³å°çš„æ„å»ºå·¥å…·.<br><span id=more></span><h2 id=Before-cmake><a title="Before cmake" class=headerlink href=#Before-cmake></a>Before cmake</h2><p>cmakeå¯ä»¥ç”Ÿæˆmakefiles,å¾ˆå¤šæ—¶å€™æˆ‘ä»¬ä¹Ÿæ˜¯ä½¿ç”¨çš„makefiles,å½“ç„¶å®ƒä¹Ÿå¯ä»¥ç”Ÿæˆvsproj,ninjaç­‰æ„å»ºæ–‡ä»¶.è¿™é‡Œä»¥makefilesä¸ºä¾‹ä»‹ç»ä¸€ä¸‹æ„å»ºç³»ç»Ÿ.<blockquote><p>Makefile ç”¨äºå¸®åŠ©å†³å®šå¤§å‹ç¨‹åºçš„å“ªäº›éƒ¨åˆ†éœ€è¦é‡æ–°ç¼–è¯‘. åœ¨ç»å¤§å¤šæ•°æƒ…å†µä¸‹,ç¼–è¯‘çš„æ˜¯ C æˆ– C++ æ–‡ä»¶. å…¶ä»–è¯­è¨€é€šå¸¸ä¹Ÿæœ‰è‡ªå·±çš„å·¥å…·,å…¶ä½œç”¨ä¸ Make ç±»ä¼¼. é™¤äº†ç¼–è¯‘ä¹‹å¤–,Make è¿˜å¯ä»¥ç”¨äºéœ€è¦æ ¹æ®æ–‡ä»¶å˜åŒ–è¿è¡Œä¸€ç³»åˆ—æŒ‡ä»¤çš„æƒ…å†µ.</blockquote><p>æµè¡Œçš„ C/C++ æ›¿ä»£æ„å»ºç³»ç»Ÿæœ‰ SConsã€CMakeã€Bazel å’Œ Ninjaä¸€äº›ä»£ç ç¼–è¾‘å™¨ï¼ˆå¦‚ Microsoft Visual Studioï¼‰ä¹Ÿæœ‰è‡ªå·±çš„å†…ç½®æ„å»ºå·¥å…·.<p>Java æœ‰ Antã€Maven å’Œ Gradle,Goã€Rust å’Œ TypeScript ç­‰å…¶ä»–è¯­è¨€ä¹Ÿæœ‰è‡ªå·±çš„æ„å»ºå·¥å…·.<p>Pythonã€Ruby å’Œå•çº¯çš„Javascript ç­‰è§£é‡Šå‹è¯­è¨€ä¸éœ€è¦ç±»ä¼¼ Makefile çš„å·¥å…·. Makefile çš„ç›®æ ‡æ˜¯æ ¹æ®å“ªäº›æ–‡ä»¶å‘ç”Ÿäº†å˜åŒ–,ç¼–è¯‘å“ªäº›éœ€è¦ç¼–è¯‘çš„æ–‡ä»¶.<p>ä½†æ˜¯,å½“è§£é‡Šå‹è¯­è¨€ä¸­çš„æ–‡ä»¶å‘ç”Ÿå˜åŒ–æ—¶,å°±ä¸éœ€è¦é‡æ–°ç¼–è¯‘äº†. ç¨‹åºè¿è¡Œæ—¶,å°†ä½¿ç”¨æ–‡ä»¶çš„æœ€æ–°ç‰ˆæœ¬.<h3 id=syntax><a class=headerlink href=#syntax title=syntax></a>syntax</h3><p>Makefile ç”±ä¸€ç³»åˆ—è§„åˆ™ç»„æˆ. ä¸€æ¡è§„åˆ™é€šå¸¸æ˜¯è¿™æ ·çš„ï¼š<figure class="highlight makefile"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br></pre><td class=code><pre><span class=line><span class=section>targets: prerequisites</span></span><br><span class=line>	command</span><br><span class=line>	command</span><br><span class=line>	command</span><br></pre></table></figure><p>ç›®æ ‡(targets)æ˜¯æ–‡ä»¶å,ç”¨ç©ºæ ¼éš”å¼€.é€šå¸¸æƒ…å†µä¸‹,æ¯æ¡è§„åˆ™(rule)åªæœ‰ä¸€ä¸ªç›®æ ‡.<p>å‘½ä»¤(command)æ˜¯ä¸€ç³»åˆ—é€šå¸¸ç”¨äºåˆ›å»ºç›®æ ‡çš„æ­¥éª¤,éœ€è¦ä»¥åˆ¶è¡¨ç¬¦è€Œä¸æ˜¯ç©ºæ ¼å¼€å¤´.<p>å…ˆå†³æ¡ä»¶(prerequisites)ä¹Ÿæ˜¯æ–‡ä»¶å,ä»¥ç©ºæ ¼åˆ†éš”.åœ¨è¿è¡Œç›®æ ‡çš„å‘½ä»¤ä¹‹å‰,è¿™äº›æ–‡ä»¶å¿…é¡»å­˜åœ¨.è¿™äº›æ–‡ä»¶ä¹Ÿç§°ä¸ºä¾èµ–é¡¹<p>ä»¥ hello world ä¸ºä¾‹å¼€å§‹ï¼š<figure class="highlight makefile"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br></pre><td class=code><pre><span class=line><span class=section>hello:</span></span><br><span class=line>	echo <span class=string>"Hello, World"</span></span><br><span class=line>	echo <span class=string>"This line will print if the file hello does not exist."</span></span><br></pre></table></figure><p>æœ‰ä¸€ä¸ªåä¸º hello çš„ç›®æ ‡,è¿™ä¸ªç›®æ ‡æœ‰ä¸¤æ¡å‘½ä»¤,è¿™ä¸ªç›®æ ‡æ²¡æœ‰å…ˆå†³æ¡ä»¶,ç„¶åè¿è¡Œ make hello.<p><strong>åªè¦ hello æ–‡ä»¶ä¸å­˜åœ¨,å‘½ä»¤å°±ä¼šè¿è¡Œ</strong>. è¦çŸ¥é“hello æ—¢æ˜¯ç›®æ ‡,ä¹Ÿæ˜¯æ–‡ä»¶.<p>è¿™æ˜¯å› ä¸ºä¸¤è€…ç›´æ¥è”ç³»åœ¨ä¸€èµ·. <strong>é€šå¸¸æƒ…å†µä¸‹,å½“è¿è¡Œç›®æ ‡æ–‡ä»¶æ—¶ï¼ˆä¹Ÿå°±æ˜¯è¿è¡Œç›®æ ‡æ–‡ä»¶çš„å‘½ä»¤æ—¶ï¼‰,å‘½ä»¤ä¼šåˆ›å»ºä¸€ä¸ªä¸ç›®æ ‡æ–‡ä»¶åŒåçš„æ–‡ä»¶</strong>. åœ¨è¿™ç§æƒ…å†µä¸‹,hello ç›®æ ‡ä¸ä¼šåˆ›å»º hello æ–‡ä»¶.<figure class="highlight makefile"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line><span class=section>blah: cc blah.c -o blah </span></span><br></pre></table></figure><p>è¿è¡Œ make å‘½ä»¤. ç”±äº make å‘½ä»¤çš„å‚æ•°ä¸­æ²¡æœ‰æä¾›ç›®æ ‡æ–‡ä»¶,å› æ­¤ä¼šè¿è¡Œç¬¬ä¸€ä¸ªç›®æ ‡æ–‡ä»¶. åœ¨æœ¬ä¾‹ä¸­,åªæœ‰ä¸€ä¸ªç›®æ ‡ï¼ˆblahï¼‰<p>ç¬¬ä¸€æ¬¡è¿è¡Œæ—¶,blah å°†è¢«åˆ›å»º. ç¬¬äºŒæ¬¡è¿è¡Œæ—¶,ä½ ä¼šçœ‹åˆ° make: â€˜blahâ€™ æ˜¯æœ€æ–°çš„. è¿™æ˜¯å› ä¸º blah æ–‡ä»¶å·²ç»å­˜åœ¨. ä½†æœ‰ä¸€ä¸ªé—®é¢˜ï¼šå¦‚æœæˆ‘ä»¬ä¿®æ”¹äº† blah.c,ç„¶åè¿è¡Œ make,ä»€ä¹ˆéƒ½ä¸ä¼šé‡æ–°ç¼–è¯‘.<p>é€šè¿‡æ·»åŠ ä¸€ä¸ªå‰ææ¡ä»¶æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼š<figure class="highlight makefile"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line><span class=section>blah: blah.c cc blah.c -o blah </span></span><br></pre></table></figure><p>å½“æˆ‘ä»¬å†æ¬¡è¿è¡Œ make æ—¶,ä¼šå‘ç”Ÿä»¥ä¸‹ä¸€ç³»åˆ—æ­¥éª¤ï¼š ç¬¬ä¸€ä¸ªç›®æ ‡è¢«é€‰ä¸­,å› ä¸ºç¬¬ä¸€ä¸ªç›®æ ‡æ˜¯é»˜è®¤ç›®æ ‡<p>è¿™ä¸ªç›®æ ‡çš„å‰ææ¡ä»¶æ˜¯ blah.c ,Make å†³å®šå®ƒæ˜¯å¦åº”è¯¥è¿è¡Œ blah ç›®æ ‡. <strong>åªæœ‰å½“ blah ä¸å­˜åœ¨æˆ– blah.c æ¯” blah æ–°æ—¶,å®ƒæ‰ä¼šè¿è¡Œ</strong><p>æœ€åä¸€æ­¥è‡³å…³é‡è¦,æ˜¯ make çš„ç²¾é«“æ‰€åœ¨. <strong>å®ƒè¦åšçš„æ˜¯åˆ¤æ–­è‡ªä¸Šæ¬¡ç¼–è¯‘ blah ä»¥æ¥,blah çš„å…ˆå†³æ¡ä»¶æ˜¯å¦å‘ç”Ÿäº†å˜åŒ–. ä¹Ÿå°±æ˜¯è¯´,å¦‚æœ blah.c è¢«ä¿®æ”¹,è¿è¡Œ make å°±åº”è¯¥é‡æ–°ç¼–è¯‘è¯¥æ–‡ä»¶</strong>. ä¸ºäº†åšåˆ°è¿™ä¸€ç‚¹,å®ƒä¼šä½¿ç”¨æ–‡ä»¶ç³»ç»Ÿçš„æ—¶é—´æˆ³ä½œä¸ºä»£ç†æ¥åˆ¤æ–­æ˜¯å¦æœ‰æ”¹åŠ¨. è¿™æ˜¯ä¸€ç§åˆç†çš„å¯å‘å¼æ–¹æ³•,å› ä¸ºæ–‡ä»¶æ—¶é—´æˆ³é€šå¸¸åªæœ‰åœ¨æ–‡ä»¶è¢«ä¿®æ”¹æ—¶æ‰ä¼šå‘ç”Ÿå˜åŒ–. ä½†å¿…é¡»è®¤è¯†åˆ°,æƒ…å†µå¹¶éæ€»æ˜¯å¦‚æ­¤. <strong>ä¾‹å¦‚,ä½ å¯ä»¥ä¿®æ”¹ä¸€ä¸ªæ–‡ä»¶,ç„¶åæŠŠè¯¥æ–‡ä»¶çš„ä¿®æ”¹æ—¶é—´æˆ³æ”¹æˆæ—§çš„. å¦‚æœä½ è¿™æ ·åšäº†,Make å°±ä¼šé”™è¯¯åœ°è®¤ä¸ºè¯¥æ–‡ä»¶æ²¡æœ‰æ”¹åŠ¨,å› æ­¤å¯ä»¥å¿½ç•¥</strong>.<h3 id=more-examples><a title="more examples" class=headerlink href=#more-examples></a>more examples</h3><p>ä¸‹é¢çš„ Makefile æœ€ç»ˆä¼šè¿è¡Œæ‰€æœ‰ä¸‰ä¸ªç›®æ ‡.<p>å½“ä½ åœ¨ç»ˆç«¯è¿è¡Œ make æ—¶,å®ƒä¼šé€šè¿‡ä¸€ç³»åˆ—æ­¥éª¤ç¼–è¯‘ä¸€ä¸ªåä¸º blah çš„ç¨‹åº:<p>Make é€‰æ‹©ç›®æ ‡ blah,å› ä¸ºç¬¬ä¸€ä¸ªç›®æ ‡æ˜¯é»˜è®¤ç›®æ ‡ blah éœ€è¦ blah.o,æ‰€ä»¥ make æœç´¢ blah.o<p>ç›®æ ‡ blah.o éœ€è¦ blah.c,æ‰€ä»¥ make æœç´¢ blah.c<p>ç›®æ ‡ blah.c æ²¡æœ‰ä¾èµ–å…³ç³»,æ‰€ä»¥è¿è¡Œ echo å‘½ä»¤.ç„¶åè¿è¡Œ cc -c å‘½ä»¤,å› ä¸ºæ‰€æœ‰ blah.o çš„ä¾èµ–å…³ç³»éƒ½å·²å¤„ç†å®Œæ¯•. ç„¶åè¿è¡Œ top cc å‘½ä»¤,å› ä¸ºæ‰€æœ‰ blah çš„ä¾èµ–å…³ç³»éƒ½å·²å¤„ç†å®Œæ¯•.<figure class="highlight makefile"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br></pre><td class=code><pre><span class=line><span class=section>blah: blah.o</span></span><br><span class=line>	cc blah.o -o blah <span class=comment># Runs third</span></span><br><span class=line></span><br><span class=line><span class=section>blah.o: blah.c</span></span><br><span class=line>	cc -c blah.c -o blah.o <span class=comment># Runs second</span></span><br><span class=line></span><br><span class=line><span class=comment># Typically blah.c would already exist, but I want to limit any additional required files</span></span><br><span class=line><span class=section>blah.c:</span></span><br><span class=line>	echo <span class=string>"int main() { return 0; }"</span> > blah.c <span class=comment># Runs first</span></span><br></pre></table></figure><p>å¦‚æœåˆ é™¤ blah.c,æ‰€æœ‰ä¸‰ä¸ªç›®æ ‡éƒ½å°†é‡æ–°è¿è¡Œ. å¦‚æœç¼–è¾‘å®ƒï¼ˆä»è€Œå°†æ—¶é—´æˆ³æ”¹ä¸ºæ¯” blah.o æ–°ï¼‰,åˆ™ä¼šè¿è¡Œå‰ä¸¤ä¸ªç›®æ ‡. å¦‚æœè¿è¡Œ touch blah.oï¼ˆä»è€Œå°†æ—¶é—´æˆ³æ”¹ä¸ºæ¯” blah æ›´æ–°ï¼‰,åˆ™åªæœ‰ç¬¬ä¸€ä¸ªç›®æ ‡ä¼šè¿è¡Œ. å¦‚æœä»€ä¹ˆéƒ½ä¸æ”¹,åˆ™æ‰€æœ‰ç›®æ ‡éƒ½ä¸ä¼šè¿è¡Œ<figure class="highlight makefile"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br></pre><td class=code><pre><span class=line><span class=section>some_file: other_file</span></span><br><span class=line>	echo <span class=string>"This will always run, and runs second"</span></span><br><span class=line>	touch some_file</span><br><span class=line></span><br><span class=line><span class=section>other_file:</span></span><br><span class=line>	echo <span class=string>"This will always run, and runs first"</span></span><br></pre></table></figure><p>è¿™ä¸ªä¾‹å­, å®ƒå°†å§‹ç»ˆè¿è¡Œä¸¤ä¸ªç›®æ ‡,å› ä¸º some_file ä¾èµ–äº other_file,è€Œ other_file ä»æœªåˆ›å»º.<h3 id=clean><a class=headerlink href=#clean title=clean></a>clean</h3><p>clean ç»å¸¸è¢«ç”¨ä½œåˆ é™¤å…¶ä»–ç›®æ ‡è¾“å‡ºçš„ç›®æ ‡,ä½†åœ¨ Make ä¸­å®ƒå¹¶ä¸æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„è¯.<p>è¯·æ³¨æ„,clean åœ¨è¿™é‡Œåšäº†ä¸¤ä»¶æ–°äº‹æƒ…:<strong>å®ƒä¸æ˜¯ç¬¬ä¸€ä¸ªç›®æ ‡(é»˜è®¤),ä¹Ÿä¸æ˜¯å…ˆå†³æ¡ä»¶.è¿™æ„å‘³ç€é™¤éä½ æ˜ç¡®è°ƒç”¨ make clean,å¦åˆ™å®ƒæ°¸è¿œä¸ä¼šè¿è¡Œ</strong>. å¦‚æœä½ ç¢°å·§æœ‰ä¸€ä¸ªåä¸º clean çš„æ–‡ä»¶,è¿™ä¸ªç›®æ ‡å°±ä¸ä¼šè¿è¡Œ,è¿™ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„. å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜,ä½¿ç”¨ .PHONY ğŸ˜‹<figure class="highlight makefile"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br></pre><td class=code><pre><span class=line><span class=section>some_file: </span></span><br><span class=line>	touch some_file</span><br><span class=line><span class=section>clean:</span></span><br><span class=line>	rm -f some_file</span><br></pre></table></figure><h3 id=variables><a class=headerlink href=#variables title=variables></a>variables</h3><p>å˜é‡åªèƒ½æ˜¯å­—ç¬¦ä¸². é€šå¸¸æƒ…å†µä¸‹,æ‚¨éœ€è¦ä½¿ç”¨ :=,ä½† = ä¹Ÿå¯ä»¥.<figure class="highlight makefile"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br></pre><td class=code><pre><span class=line>files := file1 file2</span><br><span class=line><span class=section>some_file: <span class=variable>$(files)</span></span></span><br><span class=line>	echo <span class=string>"Look at this variable: "</span> <span class=variable>$(files)</span></span><br><span class=line>	touch some_file</span><br><span class=line></span><br><span class=line><span class=section>file1:</span></span><br><span class=line>	touch file1</span><br><span class=line><span class=section>file2:</span></span><br><span class=line>	touch file2</span><br><span class=line></span><br><span class=line><span class=section>clean:</span></span><br><span class=line>	rm -f file1 file2 some_file</span><br></pre></table></figure><p>å•å¼•å·æˆ–åŒå¼•å·å¯¹ Make æ²¡æœ‰ä»»ä½•æ„ä¹‰. å®ƒä»¬åªæ˜¯åˆ†é…ç»™å˜é‡çš„å­—ç¬¦. ä¸è¿‡,å¼•å·å¯¹ shell/bash å¾ˆæœ‰ç”¨,åœ¨ printf ç­‰å‘½ä»¤ä¸­éœ€è¦ç”¨åˆ°. åœ¨æœ¬ä¾‹ä¸­,ä¸¤æ¡å‘½ä»¤çš„è¡Œä¸ºæ˜¯ä¸€æ ·çš„ï¼š<figure class="highlight makefile"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br></pre><td class=code><pre><span class=line>a := one two<span class=comment># a is set to the string "one two"</span></span><br><span class=line>b := 'one two' <span class=comment># Not recommended. b is set to the string "'one two'"</span></span><br><span class=line><span class=section>all:</span></span><br><span class=line>	printf '$a'</span><br><span class=line>	printf $b</span><br></pre></table></figure><p>ä½¿ç”¨ ${} æˆ– $() å¼•ç”¨å˜é‡<figure class="highlight makefile"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br></pre><td class=code><pre><span class=line>x := dude</span><br><span class=line><span class=section>all:</span></span><br><span class=line>	echo <span class=variable>$(x)</span></span><br><span class=line>	echo ${x}</span><br><span class=line></span><br><span class=line>	<span class=comment># Bad practice, but works</span></span><br><span class=line>	echo $x </span><br></pre></table></figure><h3 id=Targets><a class=headerlink href=#Targets title=Targets></a>Targets</h3><p>makeå¤šä¸ªç›®æ ‡,å¹¶å¸Œæœ›æ‰€æœ‰ç›®æ ‡éƒ½è¿è¡Œï¼Ÿ<p>å†™ä¸€ä¸ªä¸€ä¸ªall. ç”±äºè¿™æ˜¯åˆ—å‡ºçš„ç¬¬ä¸€æ¡è§„åˆ™,å¦‚æœè°ƒç”¨ make æ—¶æ²¡æœ‰æŒ‡å®šç›®æ ‡,å®ƒå°†é»˜è®¤è¿è¡Œ.<figure class="highlight makefile"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br></pre><td class=code><pre><span class=line><span class=section>all: one two three</span></span><br><span class=line></span><br><span class=line><span class=section>one:</span></span><br><span class=line>	touch one</span><br><span class=line><span class=section>two:</span></span><br><span class=line>	touch two</span><br><span class=line><span class=section>three:</span></span><br><span class=line>	touch three</span><br><span class=line></span><br><span class=line><span class=section>clean:</span></span><br><span class=line>	rm -f one two three</span><br></pre></table></figure><p>å½“ä¸€æ¡è§„åˆ™æœ‰å¤šä¸ªç›®æ ‡æ—¶,å°†é’ˆå¯¹æ¯ä¸ªç›®æ ‡è¿è¡Œå‘½ä»¤. $@ æ˜¯ä¸€ä¸ªè‡ªåŠ¨å˜é‡,åŒ…å«ç›®æ ‡åç§°.<figure class="highlight makefile"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br></pre><td class=code><pre><span class=line><span class=section>all: f1.o f2.o</span></span><br><span class=line></span><br><span class=line>f1.o f2.o:</span><br><span class=line>	echo <span class=variable>$@</span></span><br><span class=line><span class=comment># Equivalent to:</span></span><br><span class=line><span class=comment># f1.o:</span></span><br><span class=line><span class=comment>#	 echo f1.o</span></span><br><span class=line><span class=comment># f2.o:</span></span><br><span class=line><span class=comment>#	 echo f2.o</span></span><br></pre></table></figure><h3 id=automatic-variables-and-wildcards><a title="automatic variables and wildcards" class=headerlink href=#automatic-variables-and-wildcards></a>automatic variables and wildcards</h3><p>åœ¨ Make ä¸­,<em> å’Œ % éƒ½è¢«ç§°ä¸ºé€šé…ç¬¦,ä½†å®ƒä»¬çš„å«ä¹‰å®Œå…¨ä¸åŒ. </em> åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­æœç´¢åŒ¹é…çš„æ–‡ä»¶å.<p>å»ºè®®å§‹ç»ˆå°†å…¶å°è£…åœ¨<strong>é€šé…ç¬¦å‡½æ•°</strong>ä¸­<figure class="highlight makefile"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br></pre><td class=code><pre><span class=line><span class=comment># Print out file information about every .c file</span></span><br><span class=line><span class=section>print: $(wildcard *.c)</span></span><br><span class=line>	ls -la  <span class=variable>$?</span></span><br></pre></table></figure><p>*å¯ä»¥åœ¨ç›®æ ‡ã€å…ˆå†³æ¡ä»¶æˆ–é€šé…ç¬¦åŠŸèƒ½ä¸­ä½¿ç”¨<p><strong>æ³¨æ„</strong>: ä¸èƒ½åœ¨å˜é‡å®šä¹‰ä¸­ç›´æ¥ä½¿ç”¨ *<p><strong>æ³¨æ„</strong>: å½“ * ä¸èƒ½åŒ¹é…ä»»ä½•æ–‡ä»¶æ—¶,å®ƒå°†ä¿æŒåŸæ ·ï¼ˆé™¤éåœ¨é€šé…ç¬¦åŠŸèƒ½ä¸­è¿è¡Œ<figure class="highlight makefile"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br></pre><td class=code><pre><span class=line>thing_wrong := *.o <span class=comment># Don't do this! '*' will not get expanded</span></span><br><span class=line>thing_right := <span class=variable>$(<span class=built_in>wildcard</span> *.o)</span></span><br><span class=line></span><br><span class=line><span class=section>all: one two three four</span></span><br><span class=line></span><br><span class=line><span class=comment># Fails, because $(thing_wrong) is the string "*.o"</span></span><br><span class=line><span class=section>one: <span class=variable>$(thing_wrong)</span></span></span><br><span class=line></span><br><span class=line><span class=comment># Stays as *.o if there are no files that match this pattern :(</span></span><br><span class=line><span class=section>two: *.o </span></span><br><span class=line></span><br><span class=line><span class=comment># Works as you would expect! In this case, it does nothing.</span></span><br><span class=line><span class=section>three: <span class=variable>$(thing_right)</span></span></span><br><span class=line></span><br><span class=line><span class=comment># Same as rule three</span></span><br><span class=line><span class=section>four: $(wildcard *.o)</span></span><br></pre></table></figure><p>% éå¸¸æœ‰ç”¨,ä½†ç”±äºå…¶ä½¿ç”¨åœºåˆå¤šç§å¤šæ ·,æ‰€ä»¥æœ‰äº›ä»¤äººå›°æƒ‘. <strong>åœ¨ â€œåŒ¹é… â€œæ¨¡å¼ä¸‹ä½¿ç”¨æ—¶,å®ƒä¼šåŒ¹é…å­—ç¬¦ä¸²ä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªå­—ç¬¦</strong>,è¿™ç§åŒ¹é…ç§°ä¸ºè¯å¹².<p><strong>åœ¨ â€œæ›¿æ¢ â€œæ¨¡å¼ä¸‹ä½¿ç”¨æ—¶,å®ƒä¼šå°†åŒ¹é…åˆ°çš„å­—ç¬¦ä¸²æ›¿æ¢ä¸ºå­—ç¬¦ä¸²ä¸­çš„å­—ç¬¦ä¸².% æœ€å¸¸ç”¨äºè§„åˆ™å®šä¹‰å’ŒæŸäº›ç‰¹å®šå‡½æ•°ä¸­</strong>.<figure class="highlight makefile"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br></pre><td class=code><pre><span class=line><span class=section>hey: one two</span></span><br><span class=line>	<span class=comment># Outputs "hey", since this is the target name</span></span><br><span class=line>	echo <span class=variable>$@</span></span><br><span class=line></span><br><span class=line>	<span class=comment># Outputs all prerequisites newer than the target</span></span><br><span class=line>	echo <span class=variable>$?</span></span><br><span class=line></span><br><span class=line>	<span class=comment># Outputs all prerequisites</span></span><br><span class=line>	echo <span class=variable>$^</span></span><br><span class=line></span><br><span class=line>	<span class=comment># Outputs the first prerequisite</span></span><br><span class=line>	echo <span class=variable>$<</span></span><br><span class=line></span><br><span class=line>	touch hey</span><br><span class=line></span><br><span class=line><span class=section>one:</span></span><br><span class=line>	touch one</span><br><span class=line></span><br><span class=line><span class=section>two:</span></span><br><span class=line>	touch two</span><br><span class=line></span><br><span class=line><span class=section>clean:</span></span><br><span class=line>	rm -f hey one two</span><br></pre></table></figure><h3 id=éšå¼è§„åˆ™><a class=headerlink href=#éšå¼è§„åˆ™ title=éšå¼è§„åˆ™></a>éšå¼è§„åˆ™</h3><p>ä¸‹é¢æ˜¯ä¸€ä¸ªéšå«è§„åˆ™åˆ—è¡¨ï¼š<ul><li>Compiling a C program: <code>n.o</code> is made automatically from <code>n.c</code> with a command of the form <code>$(CC) -c $(CPPFLAGS) $(CFLAGS) $^ -o $@</code><li>Compiling a C++ program: <code>n.o</code> is made automatically from <code>n.cc</code> or <code>n.cpp</code> with a command of the form <code>$(CXX) -c $(CPPFLAGS) $(CXXFLAGS) $^ -o $@</code><li>Linking a single object file: <code>n</code> is made automatically from <code>n.o</code> by running the command <code>$(CC) $(LDFLAGS) $^ $(LOADLIBES) $(LDLIBS) -o $@</code></ul><p>è¿™äº›å€¼é»˜è®¤<ul><li><code>CC</code>: Program for compiling C programs; default <code>cc</code><li><code>CXX</code>: Program for compiling C++ programs; default <code>g++</code><li><code>CFLAGS</code>: Extra flags to give to the C compiler<li><code>CXXFLAGS</code>: Extra flags to give to the C++ compiler<li><code>CPPFLAGS</code>: Extra flags to give to the C preprocessor<li><code>LDFLAGS</code>: Extra flags to give to compilers when they are supposed to invoke the linke</ul><figure class="highlight makefile"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br></pre><td class=code><pre><span class=line>CC = gcc <span class=comment># Flag for implicit rules</span></span><br><span class=line>CFLAGS = -g <span class=comment># Flag for implicit rules. Turn on debug info</span></span><br><span class=line></span><br><span class=line><span class=comment># Implicit rule #1: blah is built via the C linker implicit rule</span></span><br><span class=line><span class=comment># Implicit rule #2: blah.o is built via the C compilation implicit rule, because blah.c exists</span></span><br><span class=line><span class=section>blah: blah.o</span></span><br><span class=line></span><br><span class=line><span class=section>blah.c:</span></span><br><span class=line>	echo <span class=string>"int main() { return 0; }"</span> > blah.c</span><br><span class=line></span><br><span class=line><span class=section>clean:</span></span><br><span class=line>	rm -f blah*</span><br></pre></table></figure><p>é™æ€æ¨¡å¼è§„åˆ™æ˜¯åœ¨ Makefile ä¸­å°‘å†™ä»£ç çš„å¦ä¸€ç§æ–¹æ³•.<figure class="highlight makefile"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br></pre><td class=code><pre><span class=line><span class=section>targets...: target-pattern: prereq-patterns ...</span></span><br><span class=line>   commands</span><br></pre></table></figure><p>å…¶æœ¬è´¨æ˜¯é€šè¿‡ç›®æ ‡æ¨¡å¼ï¼ˆé€šè¿‡ % é€šé…ç¬¦ï¼‰åŒ¹é…ç»™å®šç›®æ ‡. åŒ¹é…åˆ°çš„å†…å®¹ç§°ä¸ºè¯å¹². ç„¶å,å°†è¯å¹²ä»£å…¥å…ˆå†³æ¡ä»¶æ¨¡å¼,ç”Ÿæˆç›®æ ‡çš„å…ˆå†³æ¡ä»¶.<figure class="highlight makefile"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br></pre><td class=code><pre><span class=line>objects = foo.o bar.o all.o</span><br><span class=line><span class=section>all: <span class=variable>$(objects)</span></span></span><br><span class=line>	<span class=variable>$(CC)</span> <span class=variable>$^</span> -o all</span><br><span class=line></span><br><span class=line><span class=section>foo.o: foo.c</span></span><br><span class=line>	<span class=variable>$(CC)</span> -c foo.c -o foo.o</span><br><span class=line></span><br><span class=line><span class=section>bar.o: bar.c</span></span><br><span class=line>	<span class=variable>$(CC)</span> -c bar.c -o bar.o</span><br><span class=line></span><br><span class=line><span class=section>all.o: all.c</span></span><br><span class=line>	<span class=variable>$(CC)</span> -c all.c -o all.o</span><br><span class=line></span><br><span class=line><span class=section>all.c:</span></span><br><span class=line>	echo <span class=string>"int main() { return 0; }"</span> > all.c</span><br><span class=line></span><br><span class=line><span class=comment># Note: all.c does not use this rule because Make prioritizes more specific matches when there is more than one match.</span></span><br><span class=line><span class=section>%.c:</span></span><br><span class=line>	touch <span class=variable>$@</span></span><br><span class=line></span><br><span class=line><span class=section>clean:</span></span><br><span class=line>	rm -f *.c *.o all</span><br></pre></table></figure><p>æ›´é«˜æ•ˆçš„æ–¹æ³•<figure class="highlight makefile"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br></pre><td class=code><pre><span class=line>objects = foo.o bar.o all.o</span><br><span class=line><span class=section>all: <span class=variable>$(objects)</span></span></span><br><span class=line>	<span class=variable>$(CC)</span> <span class=variable>$^</span> -o all</span><br><span class=line></span><br><span class=line><span class=comment># Syntax - targets ...: target-pattern: prereq-patterns ...</span></span><br><span class=line><span class=comment># In the case of the first target, foo.o, the target-pattern matches foo.o and sets the "stem" to be "foo".</span></span><br><span class=line><span class=comment># It then replaces the '%' in prereq-patterns with that stem</span></span><br><span class=line><span class=variable>$(objects)</span>: %.o: %.c</span><br><span class=line>	<span class=variable>$(CC)</span> -c <span class=variable>$^</span> -o <span class=variable>$@</span></span><br><span class=line></span><br><span class=line><span class=section>all.c:</span></span><br><span class=line>	echo <span class=string>"int main() { return 0; }"</span> > all.c</span><br><span class=line></span><br><span class=line><span class=comment># Note: all.c does not use this rule because Make prioritizes more specific matches when there is more than one match.</span></span><br><span class=line><span class=section>%.c:</span></span><br><span class=line>	touch <span class=variable>$@</span></span><br><span class=line></span><br><span class=line><span class=section>clean:</span></span><br><span class=line>	rm -f *.c *.o all</span><br></pre></table></figure><p>è¿‡æ»¤å™¨å‡½æ•°å¯ç”¨äºé™æ€æ¨¡å¼è§„åˆ™,ä»¥åŒ¹é…æ­£ç¡®çš„æ–‡ä»¶.<figure class="highlight makefile"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br></pre><td class=code><pre><span class=line>obj_files = foo.result bar.o lose.o</span><br><span class=line>src_files = foo.raw bar.c lose.c</span><br><span class=line></span><br><span class=line><span class=section>all: <span class=variable>$(obj_files)</span></span></span><br><span class=line><span class=comment># Note: PHONY is important here. Without it, implicit rules will try to build the executable "all", since the prereqs are ".o" files.</span></span><br><span class=line><span class=meta><span class=meta-keyword>.PHONY</span>: all </span></span><br><span class=line></span><br><span class=line><span class=comment># Ex 1: .o files depend on .c files. Though we don't actually make the .o file.</span></span><br><span class=line><span class=variable>$(<span class=built_in>filter</span> %.o,<span class=variable>$(obj_files)</span>)</span>: %.o: %.c</span><br><span class=line>	echo <span class=string>"target: <span class=variable>$@</span> prereq: <span class=variable>$<</span>"</span></span><br><span class=line></span><br><span class=line><span class=comment># Ex 2: .result files depend on .raw files. Though we don't actually make the .result file.</span></span><br><span class=line><span class=variable>$(<span class=built_in>filter</span> %.result,<span class=variable>$(obj_files)</span>)</span>: %.result: %.raw</span><br><span class=line>	echo <span class=string>"target: <span class=variable>$@</span> prereq: <span class=variable>$<</span>"</span> </span><br><span class=line></span><br><span class=line>%.c %.raw:</span><br><span class=line>	touch <span class=variable>$@</span></span><br><span class=line></span><br><span class=line><span class=section>clean:</span></span><br><span class=line>	rm -f <span class=variable>$(src_files)</span></span><br></pre></table></figure><p>æ¨¡å¼è§„åˆ™ç»å¸¸è¢«ä½¿ç”¨,ä½†å¾ˆå®¹æ˜“æ··æ·†. ä½ å¯ä»¥ä»ä¸¤ä¸ªæ–¹é¢æ¥çœ‹å¾…å®ƒä»¬ï¼š<ol><li>ä¸€ç§å®šä¹‰è‡ªå·±çš„éšå¼è§„åˆ™çš„æ–¹æ³•<li>ä¸€ç§æ›´ç®€å•çš„é™æ€æ¨¡å¼è§„åˆ™å½¢å¼</ol><figure class="highlight makefile"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br></pre><td class=code><pre><span class=line><span class=comment># Define a pattern rule that compiles every .c file into a .o file</span></span><br><span class=line>%.o : %.c</span><br><span class=line>		<span class=variable>$(CC)</span> -c <span class=variable>$(CFLAGS)</span> <span class=variable>$(CPPFLAGS)</span> <span class=variable>$<</span> -o <span class=variable>$@</span></span><br></pre></table></figure><p>æ¨¡å¼è§„åˆ™åœ¨ç›®æ ‡ä¸­åŒ…å«ä¸€ä¸ªâ€%â€. è¯¥â€™%â€™åŒ¹é…ä»»ä½•éç©ºå­—ç¬¦ä¸²,å…¶ä»–å­—ç¬¦åˆ™è‡ªè¡ŒåŒ¹é….<p>æ¨¡å¼è§„åˆ™<strong>å…ˆå†³æ¡ä»¶ä¸­çš„â€%â€ä»£è¡¨ä¸ç›®æ ‡ä¸­çš„â€%â€åŒ¹é…çš„åŒä¸€è¯å¹²</strong>.<p>åŒå†’å·è§„åˆ™å¾ˆå°‘ä½¿ç”¨,ä½†å…è®¸ä¸ºåŒä¸€ç›®æ ‡å®šä¹‰å¤šä¸ªè§„åˆ™. å¦‚æœè¿™äº›è§„åˆ™æ˜¯å•å†’å·,åˆ™ä¼šæ‰“å°è­¦å‘Š,å¹¶ä¸”åªä¼šè¿è¡Œç¬¬äºŒç»„å‘½ä»¤.<figure class="highlight makefile"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br></pre><td class=code><pre><span class=line><span class=section>all: blah</span></span><br><span class=line><span class=section>blah::</span></span><br><span class=line>	echo <span class=string>"hello"</span></span><br><span class=line><span class=section>blah::</span></span><br><span class=line>	echo <span class=string>"hello again"</span></span><br></pre></table></figure><p>åœ¨å‘½ä»¤å‰æ·»åŠ  @,ä»¥é˜»æ­¢å‘½ä»¤è¢«æ‰“å°<p>ä¹Ÿå¯ä»¥ä½¿ç”¨ -s è¿è¡Œ make,åœ¨æ¯ä¸€è¡Œå‰æ·»åŠ  @.<figure class="highlight makefile"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br></pre><td class=code><pre><span class=line><span class=section>all: </span></span><br><span class=line>	@echo <span class=string>"This make line will not be printed"</span></span><br><span class=line>	echo <span class=string>"But this will"</span></span><br></pre></table></figure><p>æ¯æ¡å‘½ä»¤éƒ½åœ¨ä¸€ä¸ªæ–°çš„ shell ä¸­è¿è¡Œ<figure class="highlight makefile"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br></pre><td class=code><pre><span class=line><span class=section>all: </span></span><br><span class=line>	cd ..</span><br><span class=line>	<span class=comment># The cd above does not affect this line, because each command is effectively run in a new shell</span></span><br><span class=line>	echo `pwd`</span><br><span class=line></span><br><span class=line>	<span class=comment># This cd command affects the next because they are on the same line</span></span><br><span class=line>	cd ..;echo `pwd`</span><br><span class=line></span><br><span class=line>	<span class=comment># Same as above</span></span><br><span class=line>	cd ..; \</span><br><span class=line>	echo `pwd`</span><br></pre></table></figure><p>ä¿®æ”¹é»˜è®¤shell<code>/bin/sh</code><figure class="highlight makefile"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br></pre><td class=code><pre><span class=line>SHELL=/bin/bash</span><br><span class=line></span><br><span class=line><span class=section>cool:</span></span><br><span class=line>	echo <span class=string>"Hello from bash"</span></span><br></pre></table></figure><p>å¦‚æœå¸Œæœ›å­—ç¬¦ä¸²å¸¦æœ‰ç¾å…ƒç¬¦å·,å¯ä»¥ä½¿ç”¨ $$. è¿™å°±æ˜¯åœ¨ bash æˆ– sh ä¸­ä½¿ç”¨ shell å˜é‡çš„æ–¹æ³•,è¯·æ³¨æ„ Makefile å˜é‡å’Œ Shell å˜é‡ä¹‹é—´çš„åŒºåˆ«.<figure class="highlight makefile"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br></pre><td class=code><pre><span class=line>make_var = I am a make variable</span><br><span class=line><span class=section>all:</span></span><br><span class=line>	<span class=comment># Same as running "sh_var='I am a shell variable'; echo $sh_var" in the shell</span></span><br><span class=line>	sh_var='I am a shell variable'; echo $$sh_var</span><br><span class=line></span><br><span class=line>	<span class=comment># Same as running "echo I am a make variable" in the shell</span></span><br><span class=line>	echo <span class=variable>$(make_var)</span></span><br></pre></table></figure><p>åœ¨è¿è¡Œ make æ—¶æ·»åŠ  -k,å³ä½¿å‡ºç°é”™è¯¯ä¹Ÿèƒ½ç»§ç»­è¿è¡Œ. åœ¨å‘½ä»¤å‰æ·»åŠ  - å¯ä»¥æŠ‘åˆ¶é”™è¯¯<p>åœ¨ make ä¸­æ·»åŠ  -i å¯ä»¥è®©æ¯æ¡å‘½ä»¤éƒ½å‡ºé”™.<p>è¦é€’å½’è°ƒç”¨ makefile,è¯·ä½¿ç”¨ç‰¹æ®Šçš„ $(MAKE) è€Œä¸æ˜¯ make,å› ä¸ºå®ƒä¼šä¸ºä½ ä¼ é€’ make æ ‡å¿—,è€Œè‡ªèº«ä¸ä¼šå—å…¶å½±å“.<figure class="highlight makefile"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br></pre><td class=code><pre><span class=line>new_contents = <span class=string>"hello:\n\ttouch inside_file"</span></span><br><span class=line><span class=section>all:</span></span><br><span class=line>	mkdir -p subdir</span><br><span class=line>	printf <span class=variable>$(new_contents)</span> | sed -e 's/^ //' > subdir/makefile</span><br><span class=line>	cd subdir && <span class=variable>$(MAKE)</span></span><br><span class=line></span><br><span class=line><span class=section>clean:</span></span><br><span class=line>	rm -rf subdir</span><br></pre></table></figure><p>å½“ Make å¯åŠ¨æ—¶,å®ƒä¼š<strong>è‡ªåŠ¨ä»æ‰§è¡Œæ—¶è®¾ç½®çš„æ‰€æœ‰ç¯å¢ƒå˜é‡ä¸­åˆ›å»º Make å˜é‡</strong>.<figure class="highlight makefile"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br></pre><td class=code><pre><span class=line><span class=comment># Run this with "export shell_env_var='I am an environment variable'; make"</span></span><br><span class=line><span class=section>all:</span></span><br><span class=line>	<span class=comment># Print out the Shell variable</span></span><br><span class=line>	echo $$shell_env_var</span><br><span class=line></span><br><span class=line>	<span class=comment># Print out the Make variable</span></span><br><span class=line>	echo <span class=variable>$(shell_env_var)</span></span><br></pre></table></figure><p>exportæŒ‡ä»¤ä½¿ç”¨ä¸€ä¸ªå˜é‡,å¹¶å°†å…¶è®¾ç½®ä¸ºæ‰€æœ‰ shell å‘½ä»¤çš„ç¯å¢ƒï¼š<figure class="highlight makefile"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br></pre><td class=code><pre><span class=line>shell_env_var=Shell env var, created inside of Make</span><br><span class=line><span class=keyword>export</span> shell_env_var</span><br><span class=line><span class=section>all:</span></span><br><span class=line>	echo <span class=variable>$(shell_env_var)</span></span><br><span class=line>	echo $$shell_env_var</span><br></pre></table></figure><p>è®¾ç½®ä¸€ä¸ªç›®æ ‡å¯¼å‡ºå˜é‡<figure class="highlight makefile"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br></pre><td class=code><pre><span class=line><span class=section>.EXPORT_ALL_VARIABLES:</span></span><br><span class=line>new_contents = <span class=string>"hello:\n\techo \$<span class=variable>$(cooly)</span>"</span></span><br><span class=line></span><br><span class=line>cooly = <span class=string>"The subdirectory can see me!"</span></span><br><span class=line><span class=comment># This would nullify the line above: unexport cooly</span></span><br><span class=line></span><br><span class=line><span class=section>all:</span></span><br><span class=line>	mkdir -p subdir</span><br><span class=line>	printf <span class=variable>$(new_contents)</span> | sed -e 's/^ //' > subdir/makefile</span><br><span class=line>	@echo <span class=string>"---MAKEFILE CONTENTS---"</span></span><br><span class=line>	@cd subdir && cat makefile</span><br><span class=line>	@echo <span class=string>"---END MAKEFILE CONTENTS---"</span></span><br><span class=line>	cd subdir && <span class=variable>$(MAKE)</span></span><br><span class=line></span><br><span class=line><span class=section>clean:</span></span><br><span class=line>	rm -rf subdir</span><br></pre></table></figure><p>å˜é‡æœ‰ä¸¤ç§ç±»å‹ï¼š<p>é€’å½’ï¼ˆä½¿ç”¨ =ï¼‰â€”åªåœ¨ä½¿ç”¨å‘½ä»¤æ—¶æŸ¥æ‰¾å˜é‡,è€Œä¸æ˜¯åœ¨å®šä¹‰å˜é‡æ—¶æŸ¥æ‰¾.<p>ç®€å•æ‰©å±•ï¼ˆä½¿ç”¨ :=ï¼‰â€”å°±åƒæ™®é€šçš„å‘½ä»¤å¼ç¼–ç¨‹â€”åªæ‰©å±•ç›®å‰å·²å®šä¹‰çš„å˜é‡.<figure class="highlight makefile"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br></pre><td class=code><pre><span class=line><span class=comment># Recursive variable. This will print "later" below</span></span><br><span class=line>one = one ${later_variable}</span><br><span class=line><span class=comment># Simply expanded variable. This will not print "later" below</span></span><br><span class=line>two := two ${later_variable}</span><br><span class=line></span><br><span class=line>later_variable = later</span><br><span class=line></span><br><span class=line><span class=section>all: </span></span><br><span class=line>	echo <span class=variable>$(one)</span></span><br><span class=line>	echo <span class=variable>$(two)</span></span><br></pre></table></figure><p><code>?=</code> only sets variables if they have not yet been set<figure class="highlight makefile"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br></pre><td class=code><pre><span class=line>one = hello</span><br><span class=line>one ?= will not be set</span><br><span class=line>two ?= will be set</span><br><span class=line></span><br><span class=line><span class=section>all: </span></span><br><span class=line>	echo <span class=variable>$(one)</span></span><br><span class=line>	echo <span class=variable>$(two)</span></span><br></pre></table></figure><p>è¡Œå°¾çš„ç©ºæ ¼ä¸ä¼šè¢«åˆ é™¤,ä½†è¡Œé¦–çš„ç©ºæ ¼ä¼šè¢«åˆ é™¤. è¦ä½¿ç”¨å•ç©ºæ ¼åˆ›å»ºå˜é‡,è¯·ä½¿ç”¨ $(nullstring)<figure class="highlight makefile"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br></pre><td class=code><pre><span class=line>with_spaces = hello   <span class=comment># with_spaces has many spaces after "hello"</span></span><br><span class=line>after = <span class=variable>$(with_spaces)</span>there</span><br><span class=line></span><br><span class=line>nullstring =</span><br><span class=line>space = <span class=variable>$(nullstring)</span> <span class=comment># Make a variable with a single space.</span></span><br><span class=line></span><br><span class=line><span class=section>all: </span></span><br><span class=line>	echo <span class=string>"<span class=variable>$(after)</span>"</span></span><br><span class=line>	echo start<span class=string>"<span class=variable>$(space)</span>"</span>end</span><br></pre></table></figure><p>æœªå®šä¹‰å˜é‡å®é™…ä¸Šæ˜¯ä¸€ä¸ªç©ºå­—ç¬¦ä¸²<p>ä½¿ç”¨<code>+=</code>æ·»åŠ <figure class="highlight makefile"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br></pre><td class=code><pre><span class=line>foo := start</span><br><span class=line>foo += more</span><br><span class=line></span><br><span class=line><span class=section>all: </span></span><br><span class=line>	echo <span class=variable>$(foo)</span></span><br></pre></table></figure><p>ä½¿ç”¨ override å¯ä»¥è¦†ç›–å‘½ä»¤è¡Œå˜é‡.<figure class="highlight makefile"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br></pre><td class=code><pre><span class=line><span class=comment># Overrides command line arguments</span></span><br><span class=line><span class=keyword>override</span> option_one = did_override</span><br><span class=line><span class=comment># Does not override command line arguments</span></span><br><span class=line>option_two = not_override</span><br><span class=line><span class=section>all: </span></span><br><span class=line>	echo <span class=variable>$(option_one)</span></span><br><span class=line>	echo <span class=variable>$(option_two)</span></span><br></pre></table></figure><p>å®šä¹‰æŒ‡ä»¤å¹¶ä¸æ˜¯ä¸€ä¸ªå‡½æ•°,å°½ç®¡å®ƒçœ‹èµ·æ¥åƒ. <strong>define/endef åªæ˜¯åˆ›å»ºä¸€ä¸ªå˜é‡,å¹¶å°†å…¶è®¾ç½®ä¸ºä¸€ç³»åˆ—å‘½ä»¤</strong>. è¯·æ³¨æ„,è¿™ä¸åœ¨å‘½ä»¤ä¹‹é—´ä½¿ç”¨åˆ†å·æœ‰ç‚¹ä¸åŒ,å› ä¸ºæ¯ä¸ªå‘½ä»¤éƒ½ä¼šåœ¨å•ç‹¬çš„ shell ä¸­è¿è¡Œ.<figure class="highlight makefile"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br></pre><td class=code><pre><span class=line>one = <span class=keyword>export</span> blah=<span class=string>"I was set!"</span>; echo $$blah</span><br><span class=line></span><br><span class=line><span class=keyword>define</span> two</span><br><span class=line><span class=keyword>export</span> blah=<span class=string>"I was set!"</span></span><br><span class=line>echo $$blah</span><br><span class=line><span class=keyword>endef</span></span><br><span class=line></span><br><span class=line><span class=section>all: </span></span><br><span class=line>	@echo <span class=string>"This prints 'I was set'"</span></span><br><span class=line>	@<span class=variable>$(one)</span></span><br><span class=line>	@echo <span class=string>"This does not print 'I was set' because each command runs in a separate shell"</span></span><br><span class=line>	@<span class=variable>$(two)</span></span><br></pre></table></figure><p>å¯ä¸ºç‰¹å®šç›®æ ‡è®¾ç½®å˜é‡,ä¹Ÿå¯ä»¥ä¸ºç‰¹å®šç›®æ ‡æ¨¡å¼è®¾ç½®å˜é‡<figure class="highlight makefile"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br></pre><td class=code><pre><span class=line><span class=section>all: one = cool</span></span><br><span class=line></span><br><span class=line><span class=section>all: </span></span><br><span class=line>	echo one is defined: <span class=variable>$(one)</span></span><br><span class=line></span><br><span class=line><span class=section>other:</span></span><br><span class=line>	echo one is nothing: <span class=variable>$(one)</span></span><br><span class=line>	</span><br><span class=line><span class=section>%.c: one = cool</span></span><br><span class=line></span><br><span class=line><span class=section>blah.c: </span></span><br><span class=line>	echo one is defined: <span class=variable>$(one)</span></span><br><span class=line></span><br><span class=line><span class=section>other:</span></span><br><span class=line>	echo one is nothing: <span class=variable>$(one)</span></span><br><span class=line>	</span><br></pre></table></figure><h3 id=æ¡ä»¶><a class=headerlink href=#æ¡ä»¶ title=æ¡ä»¶></a>æ¡ä»¶</h3><figure class="highlight makefile"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br></pre><td class=code><pre><span class=line>foo = ok</span><br><span class=line><span class=section>all:</span></span><br><span class=line><span class=keyword>ifeq</span> (<span class=variable>$(foo)</span>, ok)</span><br><span class=line>	echo <span class=string>"foo equals ok"</span></span><br><span class=line><span class=keyword>else</span></span><br><span class=line>	echo <span class=string>"nope"</span></span><br><span class=line><span class=keyword>endif</span></span><br></pre></table></figure><p>æ£€æŸ¥å˜é‡æ˜¯å¦ä¸ºç©º<figure class="highlight makefile"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br></pre><td class=code><pre><span class=line>nullstring =</span><br><span class=line>foo = <span class=variable>$(nullstring)</span> <span class=comment># end of line; there is a space here</span></span><br><span class=line></span><br><span class=line><span class=section>all:</span></span><br><span class=line><span class=keyword>ifeq</span> (<span class=variable>$(<span class=built_in>strip</span> <span class=variable>$(foo)</span>)</span>,)</span><br><span class=line>	echo <span class=string>"foo is empty after being stripped"</span></span><br><span class=line><span class=keyword>endif</span></span><br><span class=line><span class=keyword>ifeq</span> (<span class=variable>$(nullstring)</span>,)</span><br><span class=line>	echo <span class=string>"nullstring doesn't even have spaces"</span></span><br><span class=line><span class=keyword>endif</span></span><br></pre></table></figure><p>ifdef ä¸ä¼šæ‰©å±•å˜é‡å¼•ç”¨ï¼›å®ƒåªæ˜¯æŸ¥çœ‹æ˜¯å¦å®šä¹‰äº†æŸä¸ªå˜é‡<figure class="highlight makefile"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br></pre><td class=code><pre><span class=line>bar =</span><br><span class=line>foo = <span class=variable>$(bar)</span></span><br><span class=line></span><br><span class=line><span class=section>all:</span></span><br><span class=line><span class=keyword>ifdef</span> foo</span><br><span class=line>	echo <span class=string>"foo is defined"</span></span><br><span class=line><span class=keyword>endif</span></span><br><span class=line><span class=keyword>ifndef</span> bar</span><br><span class=line>	echo <span class=string>"but bar is not"</span></span><br><span class=line><span class=keyword>endif</span></span><br></pre></table></figure><p>æŸ¥çœ‹makeæ ‡å¿—,ä½¿ç”¨ findstring å’Œ MAKEFLAGS æµ‹è¯• make æ ‡å¿—. ä½¿ç”¨ make -i è¿è¡Œæ­¤ç¤ºä¾‹,å³å¯çœ‹åˆ°å®ƒæ‰“å°å‡º echo è¯­å¥.<figure class="highlight makefile"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br></pre><td class=code><pre><span class=line><span class=section>all:</span></span><br><span class=line><span class=comment># Search for the "-i" flag. MAKEFLAGS is just a list of single characters, one per flag. So look for "i" in this case.</span></span><br><span class=line><span class=keyword>ifneq</span> (,<span class=variable>$(<span class=built_in>findstring</span> i, <span class=variable>$(MAKEFLAGS)</span>)</span>)</span><br><span class=line>	echo <span class=string>"i was passed to MAKEFLAGS"</span></span><br><span class=line><span class=keyword>endif</span></span><br></pre></table></figure><h3 id=å‡½æ•°><a class=headerlink href=#å‡½æ•° title=å‡½æ•°></a>å‡½æ•°</h3><p>å‡½æ•°ä¸»è¦ç”¨äºæ–‡æœ¬å¤„ç†. ä½¿ç”¨ $(fn, arguments) æˆ– ${fn, arguments} è°ƒç”¨å‡½æ•°. Make æœ‰å¤§é‡å†…ç½®å‡½æ•°.<figure class="highlight makefile"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br></pre><td class=code><pre><span class=line>bar := ${subst not,<span class=string>"totally"</span>, <span class=string>"I am not superman"</span>}</span><br><span class=line><span class=section>all: </span></span><br><span class=line>	@echo <span class=variable>$(bar)</span></span><br></pre></table></figure><p>å‡½æ•° subst å°†notæ›¿æ¢ä¸ºtotally.<figure class="highlight makefile"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line>comma := , empty:= space := <span class=variable>$(empty)</span> <span class=variable>$(empty)</span> foo := a b c bar := <span class=variable>$(<span class=built_in>subst</span> <span class=variable>$(space)</span>, <span class=variable>$(comma)</span> , <span class=variable>$(foo)</span>)</span> <span class=comment># Watch out! all:  # Output is ", a , b , c". Notice the spaces introduced @echo $(bar)</span></span><br></pre></table></figure><p>æ­¤å¤–è¿˜æœ‰patsubst,foreach,if,call,shell,filterç­‰å‡½æ•°,<p><code>$(patsubst pattern,replacement,text)</code><p>è¿˜æœ‰ä¸€ç§åªæ›¿æ¢åç¼€çš„é€Ÿè®°æ–¹æ³•ï¼š$(text:suffix=replacement).æ³¨æ„:ä¸è¦ä¸ºè¿™ç§é€Ÿè®°æ–¹æ³•æ·»åŠ é¢å¤–çš„ç©ºæ ¼.å®ƒä¼šè¢«è§†ä¸ºæœç´¢æˆ–æ›¿æ¢è¯.<figure class="highlight makefile"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br></pre><td class=code><pre><span class=line>foo := a.o b.o l.a c.o</span><br><span class=line>one := <span class=variable>$(<span class=built_in>patsubst</span> %.o,%.c,<span class=variable>$(foo)</span>)</span></span><br><span class=line><span class=comment># This is a shorthand for the above</span></span><br><span class=line>two := $(foo:%.o=%.c)</span><br><span class=line><span class=comment># This is the suffix-only shorthand, and is also equivalent to the above.</span></span><br><span class=line>three := $(foo:.o=.c)</span><br><span class=line></span><br><span class=line><span class=section>all:</span></span><br><span class=line>	echo <span class=variable>$(one)</span></span><br><span class=line>	echo <span class=variable>$(two)</span></span><br><span class=line>	echo <span class=variable>$(three)</span></span><br></pre></table></figure><p><code>$(foreach var,list,text)</code> å®ƒå°†ä¸€ä¸ªå•è¯åˆ—è¡¨ï¼ˆç”¨ç©ºæ ¼åˆ†éš”ï¼‰è½¬æ¢ä¸ºå¦ä¸€ä¸ªå•è¯åˆ—è¡¨.<p>var è®¾ç½®ä¸ºåˆ—è¡¨ä¸­çš„æ¯ä¸ªå•è¯,text åˆ™ä¸ºæ¯ä¸ªå•è¯å±•å¼€.<figure class="highlight makefile"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br></pre><td class=code><pre><span class=line>foo := who are you</span><br><span class=line><span class=comment># For each "word" in foo, output that same word with an exclamation after</span></span><br><span class=line>bar := <span class=variable>$(<span class=built_in>foreach</span> wrd,<span class=variable>$(foo)</span>,<span class=variable>$(wrd)</span>!)</span></span><br><span class=line></span><br><span class=line><span class=section>all:</span></span><br><span class=line>	<span class=comment># Output is "who! are! you!"</span></span><br><span class=line>	@echo <span class=variable>$(bar)</span></span><br></pre></table></figure><p>if æ£€æŸ¥ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å¦ä¸ºéç©º. å¦‚æœæ˜¯,åˆ™è¿è¡Œç¬¬äºŒä¸ªå‚æ•°,å¦åˆ™è¿è¡Œç¬¬ä¸‰ä¸ªå‚æ•°<figure class="highlight makefile"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br></pre><td class=code><pre><span class=line>foo := <span class=variable>$(<span class=built_in>if</span> this-is-not-empty,then!,else!)</span></span><br><span class=line>empty :=</span><br><span class=line>bar := <span class=variable>$(<span class=built_in>if</span> <span class=variable>$(empty)</span>,then!,else!)</span></span><br><span class=line></span><br><span class=line><span class=section>all:</span></span><br><span class=line>	@echo <span class=variable>$(foo)</span></span><br><span class=line>	@echo <span class=variable>$(bar)</span></span><br></pre></table></figure><p>m akeæ”¯æŒåˆ›å»ºåŸºæœ¬å‡½æ•°,åªéœ€é€šè¿‡åˆ›å»ºä¸€ä¸ªå˜é‡æ¥ â€œå®šä¹‰ â€œå‡½æ•°,ä½†è¦ä½¿ç”¨ (0)ã€(1) ç­‰å‚æ•°. ç„¶åä½¿ç”¨ç‰¹æ®Šçš„è°ƒç”¨å†…ç½®å‡½æ•°è°ƒç”¨è¯¥å‡½æ•°. è¯­æ³•æ˜¯ <code>(call variable,param,param)</code>. (0)æ˜¯å˜é‡,(1)ã€(2)ç­‰æ˜¯å‚æ•°.<figure class="highlight makefile"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br></pre><td class=code><pre><span class=line>sweet_new_fn = Variable Name: $(0) First: $(1) Second: $(2) Empty Variable: $(3)</span><br><span class=line></span><br><span class=line><span class=section>all:</span></span><br><span class=line>	<span class=comment># Outputs "Variable Name: sweet_new_fn First: go Second: tigers Empty Variable:"</span></span><br><span class=line>	@echo <span class=variable>$(<span class=built_in>call</span> sweet_new_fn, go, tigers)</span></span><br></pre></table></figure><p><code>filter</code>å‡½æ•°ç”¨äºä»åˆ—è¡¨ä¸­é€‰æ‹©ç¬¦åˆç‰¹å®šæ¨¡å¼çš„æŸäº›å…ƒç´ . ä¾‹å¦‚,è¿™å°†é€‰æ‹© obj_files ä¸­ä»¥ .o ç»“å°¾çš„æ‰€æœ‰å…ƒç´ .<figure class="highlight makefile"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br></pre><td class=code><pre><span class=line><span class=comment># call function</span></span><br><span class=line><span class=section>all: </span></span><br><span class=line>	@echo <span class=variable>$(<span class=built_in>shell</span> ls -la)</span> <span class=comment># Very ugly because the newlines are gone!</span></span><br><span class=line>	</span><br><span class=line>obj_files = foo.result bar.o lose.o</span><br><span class=line>filtered_files = <span class=variable>$(<span class=built_in>filter</span> %.o,<span class=variable>$(obj_files)</span>)</span></span><br><span class=line></span><br><span class=line><span class=section>all:</span></span><br><span class=line>	@echo <span class=variable>$(filtered_files)</span></span><br></pre></table></figure><p>include æŒ‡ä»¤å‘Šè¯‰ make è¯»å–ä¸€ä¸ªæˆ–å¤šä¸ªå…¶ä»– makefile. å®ƒæ˜¯ makefile ä¸­çš„ä¸€è¡Œ<p>è¿™åœ¨ä½¿ç”¨ -M ç­‰ç¼–è¯‘å™¨æ ‡å¿—æ—¶ç‰¹åˆ«æœ‰ç”¨,è¿™äº›æ ‡å¿—ä¼šæ ¹æ®æºä»£ç åˆ›å»º Makefile. ä¾‹å¦‚,å¦‚æœæŸäº› c æ–‡ä»¶åŒ…å«ä¸€ä¸ªå¤´æ–‡ä»¶,é‚£ä¹ˆè¯¥å¤´æ–‡ä»¶å°±ä¼šè¢«æ·»åŠ åˆ°ç”± gcc ç¼–å†™çš„ Makefile ä¸­.<p>ä½¿ç”¨ vpath æŒ‡å®šå­˜åœ¨æŸäº›å…ˆå†³æ¡ä»¶é›†çš„ä½ç½®. å…¶æ ¼å¼ä¸º vpath \<pattern> <ç›®å½•,ç©ºæ ¼/å†’å·åˆ†éš”> <\pattern> å¯ä»¥æœ‰ä¸€ä¸ª %,å¯ä»¥åŒ¹é…ä»»ä½• 0 ä¸ªæˆ–å¤šä¸ªå­—ç¬¦. æ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨å˜é‡ VPATH è¿›è¡Œå…¨å±€æ“ä½œ <figure class="highlight makefile"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br></pre><td class=code><pre><span class=line><span class=keyword>vpath</span> %.h ../headers ../other-directory</span><br><span class=line></span><br><span class=line><span class=comment># Note: vpath allows blah.h to be found even though blah.h is never in the current directory</span></span><br><span class=line><span class=section>some_binary: ../headers blah.h</span></span><br><span class=line>	touch some_binary</span><br><span class=line></span><br><span class=line><span class=section>../headers:</span></span><br><span class=line>	mkdir ../headers</span><br><span class=line></span><br><span class=line><span class=comment># We call the target blah.h instead of ../headers/blah.h, because that's the prereq that some_binary is looking for</span></span><br><span class=line><span class=comment># Typically, blah.h would already exist and you wouldn't need this.</span></span><br><span class=line><span class=section>blah.h:</span></span><br><span class=line>	touch ../headers/blah.h</span><br><span class=line></span><br><span class=line><span class=section>clean:</span></span><br><span class=line>	rm -rf ../headers</span><br><span class=line>	rm -f some_binary</span><br></pre></table></figure> <p>åœ¨ç›®æ ‡ä¸­æ·»åŠ  .PHONY å¯ä»¥é˜²æ­¢ Make å°†å‡ç›®æ ‡ä¸æ–‡ä»¶åæ··æ·†. åœ¨æœ¬ä¾‹ä¸­,å¦‚æœåˆ›å»ºäº† clean æ–‡ä»¶,ä»å°†è¿è¡Œ make clean.</p> <p>â€œphonyâ€ç›®æ ‡çš„åç§°é€šå¸¸å¾ˆå°‘æ˜¯æ–‡ä»¶å,åœ¨å®è·µä¸­å¾ˆå¤šäººéƒ½ä¼šè·³è¿‡è¿™ä¸€ç‚¹</p> <figure class="highlight makefile"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br></pre><td class=code><pre><span class=line><span class=section>some_file:</span></span><br><span class=line>	touch some_file</span><br><span class=line>	touch clean</span><br><span class=line></span><br><span class=line><span class=meta><span class=meta-keyword>.PHONY</span>: clean</span></span><br><span class=line><span class=section>clean:</span></span><br><span class=line>	rm -f some_file</span><br><span class=line>	rm -f clean</span><br></pre></table></figure> <p>å¦‚æœå‘½ä»¤è¿”å›éé›¶çš„é€€å‡ºçŠ¶æ€,make å·¥å…·å°†åœæ­¢è¿è¡Œè§„åˆ™ï¼ˆå¹¶è¿”å›å…ˆå†³æ¡ä»¶ï¼‰</p> <p>å¦‚æœè§„åˆ™ä»¥è¿™ç§æ–¹å¼å¤±è´¥,DELETE_ON_ERROR å°†åˆ é™¤è§„åˆ™çš„ç›®æ ‡. è¿™å°†å‘ç”Ÿåœ¨æ‰€æœ‰ç›®æ ‡ä¸Š,è€Œä¸ä»…ä»…æ˜¯åƒ PHONY è¿™æ ·çš„ç›®æ ‡. å°½ç®¡å‡ºäºå†å²åŸå› ,make å¹¶æ²¡æœ‰è¿™æ ·åš,ä½†æœ€å¥½è¿˜æ˜¯ä¸€ç›´ä½¿ç”¨è¿™ä¸ªåŠŸèƒ½.</p> <figure class="highlight makefile"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br></pre><td class=code><pre><span class=line><span class=section>.DELETE_ON_ERROR:</span></span><br><span class=line><span class=section>all: one two</span></span><br><span class=line></span><br><span class=line><span class=section>one:</span></span><br><span class=line>	touch one</span><br><span class=line>	false</span><br><span class=line></span><br><span class=line><span class=section>two:</span></span><br><span class=line>	touch two</span><br><span class=line>	false</span><br></pre></table></figure> <h2 id=cmake-fundamental><a title="cmake fundamental" class=headerlink href=#cmake-fundamental></a>cmake fundamental</h2><p>åœ¨Windowsä¸Šå¯é€‰æ‹©çš„æ„å»ºåç«¯æœ‰vs,codeblocksè¿™ç§è½¯ä»¶çš„æ–‡ä»¶ç»“æ„,æˆ–è€…å•çº¯çš„Makefilesä»¥åŠNinja.ç›¸å½“äºå¿½ç•¥äº†å‡ ä¸ªé¡¹ç›®æ„å»ºçš„å·®å¼‚.</p> <p><img alt=image-20231013105520974 data-src=https://i.imgur.com/0mXZUbA.png style=zoom:50%;></p> <h2 id=å¸¸ç”¨å˜é‡><a class=headerlink href=#å¸¸ç”¨å˜é‡ title=å¸¸ç”¨å˜é‡></a>å¸¸ç”¨å˜é‡</h2><p><code>PROJECT_BINARY_DIR</code></p> <p>ç¼–è¯‘ç”Ÿæˆé¡¹ç›®çš„ç›®å½•</p> <p><code>PROJECT_SOURCE_DIR</code></p> <p>é¡¶å±‚ç›®å½•</p> <p><code>EXECUTABLE_OUTPUT_PATH</code>ä»¥åŠ<code>LIBRARY_OUTPUT_PATH</code></p> <p>åˆ†åˆ«ç”¨æ¥é‡æ–°å®šä¹‰æœ€ç»ˆç»“æœçš„å­˜æ”¾ç›®å½•</p> <p><code>CMAKE_ARCHIVE_OUTPUT_DIRECTORY</code>ï¼šé»˜è®¤å­˜æ”¾é™æ€åº“çš„æ–‡ä»¶å¤¹ä½ç½®ï¼›</p> <p><code>CMAKE_LIBRARY_OUTPUT_DIRECTORY</code>ï¼šé»˜è®¤å­˜æ”¾åŠ¨æ€åº“çš„æ–‡ä»¶å¤¹ä½ç½®ï¼›</p> <p><code>LIBRARY_OUTPUT_PATH</code>ï¼šé»˜è®¤å­˜æ”¾åº“æ–‡ä»¶çš„ä½ç½®,å¦‚æœäº§ç”Ÿçš„æ˜¯é™æ€åº“å¹¶ä¸”æ²¡æœ‰æŒ‡å®š CMAKE_ARCHIVE_OUTPUT_DIRECTORY åˆ™å­˜æ”¾åœ¨è¯¥ç›®å½•ä¸‹,åŠ¨æ€åº“ä¹Ÿç±»ä¼¼ï¼›</p> <p><code>CMAKE_RUNTIME_OUTPUT_DIRECTORY</code>ï¼šå­˜æ”¾å¯æ‰§è¡Œè½¯ä»¶çš„ç›®å½•ï¼›</p> <p><code>CMAKE_CXX_FLAGS</code>å’Œ<code>CMAKE_C_FLAGS</code></p> <p>è®¾ç½®C/ C++ç¼–è¯‘é€‰é¡¹,<code>CMAKE_C_COMPILER</code>è®¾ç½®å¯¹åº”ç¼–è¯‘å™¨è·¯å¾„.</p> <p><code>BUILD_SHARED_LIBS</code></p> <p>ç”¨æ¥æ§åˆ¶é»˜è®¤çš„åº“ç¼–è¯‘æ–¹å¼,å¦‚æœä¸è¿›è¡Œè®¾ç½®,ä½¿ç”¨ADD_LIBRARY å¹¶æ²¡æœ‰æŒ‡å®šåº“ç±»å‹çš„æƒ…å†µä¸‹,é»˜è®¤ç¼–è¯‘ç”Ÿæˆçš„åº“éƒ½æ˜¯é™æ€åº“.</p> <p>æ­¤å¤–è¿˜æœ‰ä¸€äº›ç³»ç»Ÿä¿¡æ¯</p> <p><img alt=image-20231013163518609 data-src=https://i.imgur.com/cozY007.png></p> <p>ä½¿ç”¨$ENV{}è°ƒç”¨ç³»ç»Ÿå˜é‡.</p> <h2 id=æŒ‡å®šç”Ÿæˆç¨‹åº><a class=headerlink href=#æŒ‡å®šç”Ÿæˆç¨‹åº title=æŒ‡å®šç”Ÿæˆç¨‹åº></a>æŒ‡å®šç”Ÿæˆç¨‹åº</h2><figure class="highlight cmake"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br></pre><td class=code><pre><span class=line><span class=keyword>add_library</span>(&LTname> [STATIC | SHARED | MODULE]</span><br><span class=line>            [EXCLUDE_FROM_ALL]</span><br><span class=line>            source1 [source2 ...])</span><br></pre></table></figure> <p>å°†æºç sourceæ„å»ºæˆä¸€ä¸ªåº“, ä¾›ä»–äººä½¿ç”¨</p> <p><code>[STATIC | SHARED | MODULE]</code> ï¼šç±»å‹æœ‰ä¸‰ç§</p> <figure class="highlight cmake"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br></pre><td class=code><pre><span class=line><span class=keyword>add_executable</span>(< name> [WIN32] [MACOSX_BUNDLE]</span><br><span class=line>                [EXCLUDE_FROM_ALL]  source1 source2 â€¦ sourceN)</span><br></pre></table></figure> <p>ä½¿ç”¨ç»™å®šçš„æºæ–‡ä»¶,ä¸ºå·¥ç¨‹å¼•å…¥ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶.å¼•å…¥ä¸€ä¸ªåä¸º< name>çš„å¯æ‰§è¡Œç›®æ ‡,è¯¥ç›®æ ‡ä¼šç”±è°ƒç”¨è¯¥å‘½ä»¤æ—¶åœ¨æºæ–‡ä»¶åˆ—è¡¨ä¸­æŒ‡å®šçš„æºæ–‡ä»¶æ¥æ„å»º</p> <h2 id=æ·»åŠ å¤´æ–‡ä»¶ç›®å½•å’Œåº“><a class=headerlink href=#æ·»åŠ å¤´æ–‡ä»¶ç›®å½•å’Œåº“ title=æ·»åŠ å¤´æ–‡ä»¶ç›®å½•å’Œåº“></a>æ·»åŠ å¤´æ–‡ä»¶ç›®å½•å’Œåº“</h2><figure class="highlight cmake"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br></pre><td class=code><pre><span class=line><span class=keyword>include_directories</span>([AFTER|BEFORE] [SYSTEM]  dir1  dir2 ...)</span><br><span class=line><span class=keyword>target_include_directories</span>()</span><br></pre></table></figure> <p>å°†ç»™å®šç›®å½• dir1 dir2 åŠ ç»™ç¼–è¯‘å™¨æœç´¢åˆ°çš„åŒ…å«æ–‡ä»¶ .é»˜è®¤æƒ…å†µä¸‹,åŠ åˆ°ç›®å½•åˆ—è¡¨çš„æœ€å,target_include_directorieså¯ä»¥æŒ‡å®šé’ˆå¯¹ç›®æ ‡æ–‡ä»¶æ·»åŠ å¤´æ–‡ä»¶ç›®å½•.</p> <figure class="highlight cmake"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br></pre><td class=code><pre><span class=line><span class=keyword>target_link_libraries</span>(<<span class=keyword>target</span>> [item1] [item2] [...]</span><br><span class=line>                      [[debug|optimized|general] &LTitem>] ...)</span><br></pre></table></figure> <p>è¯¥æŒ‡ä»¤çš„ä½œç”¨ä¸ºå°†ç›®æ ‡æ–‡ä»¶ä¸åº“æ–‡ä»¶è¿›è¡Œé“¾æ¥.</p> <p>ä¸Šè¿°æŒ‡ä»¤ä¸­çš„<code>&LTtarget></code>æ˜¯æŒ‡é€šè¿‡add_executable()å’Œadd_library()æŒ‡ä»¤ç”Ÿæˆå·²ç»åˆ›å»ºçš„ç›®æ ‡æ–‡ä»¶.</p> <p>å¯ä»¥ä½¿ç”¨<code>&LTa>_FOUND</code>æ£€æŸ¥æ˜¯å¦é€šè¿‡findåŠ è½½æˆåŠŸ,ä¹‹åä½¿ç”¨target_link_librariesè¿æ¥.</p> <h2 id=find-package-amp-find-path-amp-find-library><a class=headerlink href=#find-package-amp-find-path-amp-find-library title=find_package&find_path&find_library></a>find_package&find_path&find_library</h2><p>find_pathå’Œfind_libraryåˆ†åˆ«ç”¨æ¥æ‰¾å¤´æ–‡ä»¶å’Œåº“.æ‰¾åˆ°ä¹‹åå¯ä»¥ä½¿ç”¨include_directoryæˆ–è€…target_link_librariesç”¨æ¥ä½¿ç”¨.</p> <figure class="highlight cmake"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br></pre><td class=code><pre><span class=line><span class=keyword>FIND_PATH</span>(myCeres NAMES ceress.h PATHS /ceres/<span class=keyword>include</span>/ceres NO_DEFAULT_PATH)</span><br><span class=line><span class=keyword>INCLUDE_DIRECTORIES</span>(<span class=variable>${myCeres}</span>)</span><br></pre></table></figure> <h2 id=ç¼–è¯‘æ—¶æ¶ˆæ¯è¾“å‡º><a class=headerlink href=#ç¼–è¯‘æ—¶æ¶ˆæ¯è¾“å‡º title=ç¼–è¯‘æ—¶æ¶ˆæ¯è¾“å‡º></a>ç¼–è¯‘æ—¶æ¶ˆæ¯è¾“å‡º</h2><figure class="highlight cmake"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line><span class=keyword>MESSAGE</span>(STATUS <span class=string>"HELLO"</span>)</span><br></pre></table></figure> <h2 id=è®¾ç½®å˜é‡><a class=headerlink href=#è®¾ç½®å˜é‡ title=è®¾ç½®å˜é‡></a>è®¾ç½®å˜é‡</h2><figure class="highlight cmake"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line><span class=keyword>set</span>(CMAKE_LIBRARY_OUTPUT_DIRECTORY <span class=variable>${CMAKE_SOURCE_DIR}</span>/lib/x86)</span><br></pre></table></figure> <p>setè®¾ç½®å˜é‡,åç»­ä½¿ç”¨${}ä½¿ç”¨å˜é‡</p> <h2 id=æ§åˆ¶ç»“æ„><a class=headerlink href=#æ§åˆ¶ç»“æ„ title=æ§åˆ¶ç»“æ„></a>æ§åˆ¶ç»“æ„</h2><p>if elseif else endif</p> <p>æ–‡ä»¶ä¸­å¯ä»¥ä½¿ç”¨æ¡ä»¶,å¾ªç¯ç­‰æ§åˆ¶è¯­å¥.å¯ä»¥ç”¨æ¥åˆ¤æ–­æ„å»ºæ—¶ç³»ç»Ÿçš„ä¸€äº›ç¯å¢ƒ.</p> <p>æ¯”å¦‚</p> <figure class="highlight cmake"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br></pre><td class=code><pre><span class=line><span class=comment># include dynamic link path</span></span><br><span class=line><span class=keyword>if</span>(CMAKE_SYSTEM_PROCESSOR <span class=keyword>MATCHES</span> <span class=string>"x86"</span>)</span><br><span class=line>    <span class=keyword>link_directories</span>(<span class=variable>${CMAKE_CURRENT_SOURCE_DIR}</span>/../nwpu_std_msgs/lib/x86)</span><br><span class=line>    <span class=keyword>link_directories</span>(<span class=variable>${CMAKE_CURRENT_SOURCE_DIR}</span>/../nwpucutils/lib/x86)</span><br><span class=line><span class=keyword>elseif</span>(CMAKE_SYSTEM_PROCESSOR <span class=keyword>MATCHES</span> <span class=string>"arm"</span>)</span><br><span class=line>    <span class=keyword>link_directories</span>(<span class=variable>${CMAKE_CURRENT_SOURCE_DIR}</span>/../nwpu_std_msgs/lib/arm)</span><br><span class=line>    <span class=keyword>link_directories</span>(<span class=variable>${CMAKE_CURRENT_SOURCE_DIR}</span>/../nwpucutils/lib/arm)</span><br><span class=line><span class=keyword>endif</span>()</span><br></pre></table></figure> <h2 id=æ·»åŠ å…¶ä»–å­ç›®å½•><a class=headerlink href=#æ·»åŠ å…¶ä»–å­ç›®å½• title=æ·»åŠ å…¶ä»–å­ç›®å½•></a>æ·»åŠ å…¶ä»–å­ç›®å½•</h2><figure class="highlight cmake"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line><span class=keyword>add_subdirectory</span>(source_dir [binary_dir] [EXCLUDE_FROM_ALL] [SYSTEM])</span><br></pre></table></figure> <p><strong>æ·»åŠ ä¸€ä¸ªå­ç›®å½•å¹¶æ„å»ºè¯¥å­ç›®å½•</strong>.source_diræŒ‡å®šæºCMakeLists.txtå’Œä»£ç æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•.</p> <p>ä¸€èˆ¬ç”¨åœ¨åµŒå¥—çš„é¡¹ç›®ä¸­,é¡¶å±‚CMakeLists.txtæ–‡ä»¶æ·»åŠ å­ç›®å½•,è®©å­ç›®å½•å…ˆæ„å»ºå®Œæˆä¹‹åæ·»åŠ å…¶ä¸­ç”Ÿæˆçš„åº“å’Œå¤´æ–‡ä»¶.</p> <h2 id=è·å–æ–‡ä»¶><a class=headerlink href=#è·å–æ–‡ä»¶ title=è·å–æ–‡ä»¶></a>è·å–æ–‡ä»¶</h2><figure class="highlight cmake"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line><span class=keyword>FILE</span> (GLOB ALL_SOURCES <span class=string>"*.cpp"</span> <span class=string>"*.c"</span> <span class=string>"./AFolder/*.cpp"</span> )</span><br></pre></table></figure> <p>ä½¿ç”¨æ­£åˆ™åŒ¹é…å“åº”æ–‡ä»¶å¹¶å­˜åˆ°ä¸€ä¸ªå˜é‡ä¸­</p> <figure class="highlight cmake"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line><span class=keyword>aux_source_directory</span>(dir VAR) </span><br></pre></table></figure> <p>å‘ç°ä¸€ä¸ªç›®å½•ä¸‹æ‰€æœ‰çš„<strong>æºä»£ç æ–‡ä»¶</strong>å¹¶å°†åˆ—è¡¨å­˜å‚¨åœ¨ä¸€ä¸ªå˜é‡ä¸­.</p> <h2 id=vsä¸­æ˜¾ç¤ºå¤´æ–‡ä»¶><a class=headerlink href=#vsä¸­æ˜¾ç¤ºå¤´æ–‡ä»¶ title=vsä¸­æ˜¾ç¤ºå¤´æ–‡ä»¶></a>vsä¸­æ˜¾ç¤ºå¤´æ–‡ä»¶</h2><figure class="highlight cmake"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br></pre><td class=code><pre><span class=line><span class=keyword>file</span>(GLOB_RECURSE pipe_header_files  <span class=variable>${CMAKE_CURRENT_SOURCE_DIR}</span>/<span class=keyword>include</span>/*.h )</span><br><span class=line><span class=keyword>source_group</span>(<span class=string>"Header Files"</span> FILES <span class=variable>${pipe_header_files}</span>) </span><br></pre></table></figure> <p>ä½¿ç”¨source_groupå¢åŠ æ–‡ä»¶</p> <p>å¹¶æ·»åŠ åˆ°ç”Ÿæˆç›®æ ‡ä¸­</p> <figure class="highlight cmake"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line><span class=keyword>add_library</span>( lib_pipe_shared SHARED <span class=variable>${pipe_src}</span> <span class=variable>${pipe_header_files}</span>)</span><br></pre></table></figure> <h2 id=optionä¸add-definitions><a class=headerlink href=#optionä¸add-definitions title=optionä¸add_definitions></a>optionä¸add_definitions</h2><figure class="highlight cmake"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line><span class=keyword>option</span>(&LTvariable> <span class=string>"&LThelp_text>"</span> [value])</span><br></pre></table></figure> <p>å¯ä»¥åœ¨cmakeå‘½ä»¤ä¸­æŒ‡å®šè¯¥å€¼.</p> <p>è€Œadd_definitionç”¨äºæŒ‡å®šç¼–è¯‘å™¨å‚æ•°,æ¯”å¦‚<code>add_definitions("-Wall -g")</code>,æ­¤å¤–æ›´æ¨èä½¿ç”¨add_compile_definitionså°†é¢„å¤„ç†å™¨å®šä¹‰æ·»åŠ åˆ°ç¼–è¯‘å™¨å‘½ä»¤è¡Œ,ä½¿ç”¨add_compile_optionså‘½ä»¤æ·»åŠ å…¶å®ƒé€‰é¡¹.</p> <p>æ¯”å¦‚ä¸‹é¢æ–‡ä»¶,ä½¿ç”¨add_definitionå®šä¹‰äº†TEST_DEBUG,optionå®šä¹‰ä¸ºOFFå¹¶åœ¨cmakeæ‰§è¡Œæ—¶æŒ‡å®šä¸ºon,ç„¶ååœ¨cmakeæ–‡ä»¶ä¸­æŒ‡å®šoptionä¸ºon,è¿™æ ·å°±æ‰§è¡Œäº†<code>add_definitions(-DTEST_DEBUG)</code>,å®šä¹‰äº†è¯¥å®.</p> <figure class="highlight bash"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br></pre><td class=code><pre><span class=line><span class=meta>#!/bin/sh</span></span><br><span class=line></span><br><span class=line>cmake -DTEST_DEBUG=ON .</span><br><span class=line>cmake --build .</span><br><span class=line></span><br></pre></table></figure> <figure class="highlight cmake"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br></pre><td class=code><pre><span class=line><span class=keyword>project</span>(<span class=keyword>test</span>)</span><br><span class=line></span><br><span class=line><span class=keyword>option</span>(TEST_DEBUG <span class=string>"option for debug"</span> <span class=keyword>OFF</span>)</span><br><span class=line><span class=keyword>if</span> (TEST_DEBUG)</span><br><span class=line><span class=keyword>add_definitions</span>(-DTEST_DEBUG)</span><br><span class=line><span class=keyword>endif</span>()</span><br></pre></table></figure> <figure class="highlight c"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br></pre><td class=code><pre><span class=line><span class=meta>#<span class=meta-keyword>include</span> <span class=meta-string>"test.h"</span></span></span><br><span class=line></span><br><span class=line><span class=meta>#<span class=meta-keyword>ifdef</span> TEST_DEBUG</span></span><br><span class=line>...</span><br><span class=line><span class=meta>#<span class=meta-keyword>endif</span></span></span><br></pre></table></figure> <p>CMakeä¸­çš„å‘½ä»¤ç‰¹åˆ«å¤š,äº‹å®ä¸Šå¹¶ä¸éœ€è¦å»ä¸€ä¸ªä¸€ä¸ªè®°ä½,é€šå¸¸åªè¦çŸ¥é“ä¸€ä¸ªé¡¹ç›®çš„å¤§è‡´æ„å»ºæµç¨‹ä»¥åŠå¯èƒ½éœ€è¦çš„å‘½ä»¤å°±è¡Œäº†.</p> <figure class="highlight cmake"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br></pre><td class=code><pre><span class=line><span class=keyword>target_compile_definitions</span>(foo PUBLIC FOO)</span><br><span class=line><span class=keyword>target_compile_definitions</span>(foo PUBLIC -DFOO)  <span class=comment># -D removed</span></span><br><span class=line><span class=keyword>target_compile_definitions</span>(foo PUBLIC <span class=string>""</span> FOO) <span class=comment># "" ignored</span></span><br><span class=line><span class=keyword>target_compile_definitions</span>(foo PUBLIC -D FOO) <span class=comment># -D becomes "", then ignored</span></span><br></pre></table></figure> <h3 id=ç”Ÿæˆå™¨è¡¨ç¤º><a class=headerlink href=#ç”Ÿæˆå™¨è¡¨ç¤º title=ç”Ÿæˆå™¨è¡¨ç¤º></a>ç”Ÿæˆå™¨è¡¨ç¤º</h3><p>ç”Ÿæˆå™¨è¡¨è¾¾å¼æ˜¯åœ¨æ„å»ºçš„é…ç½®é˜¶æ®µè¿›è¡Œçš„è¯­å¥.<strong>å¤§å¤šæ•°å‡½æ•°å…è®¸ä½¿ç”¨ç”Ÿæˆå™¨è¡¨è¾¾å¼,åªæœ‰å°‘æ•°ä¾‹å¤–.ä»¥ $ çš„å½¢å¼ä½¿ç”¨,å…¶ä¸­ OPERATOR æˆ–ç›´æ¥ä½¿ç”¨,æˆ–ä¸ VALUE è¿›è¡Œæ¯” è¾ƒ.</strong></p> <figure class="highlight cmake"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br></pre><td class=code><pre><span class=line><span class=keyword>target_compile_options</span>(my_target PRIVATE</span><br><span class=line><span class=string>"$<$&LTCXX_COMPILER_ID:GNU,Clang,AppleClang>:-Wall>"</span>)</span><br><span class=line></span><br></pre></table></figure> <p>è‹¥ CXX_COMPILER_ID å˜é‡åŒ¹é… GNU, Clang, AppleClang åˆ—è¡¨ä¸­ä»»æ„ä¸€ä¸ª,åˆ™é™„åŠ -Wall é€‰ é¡¹åˆ°ç›®æ ‡â€”â€”ä¹Ÿå°±æ˜¯ my_target.ç”Ÿæˆå™¨è¡¨è¾¾å¼åœ¨ç¼–å†™ç‹¬ç«‹äºå¹³å°å’Œç¼–è¯‘å™¨çš„ CMake æ–‡ä»¶æ—¶éå¸¸æ–¹ä¾¿.</p> <p>é™¤äº†æŸ¥è¯¢å€¼,ç”Ÿæˆå™¨è¡¨è¾¾å¼è¿˜å¯ä»¥ç”¨äºè½¬æ¢å­—ç¬¦ä¸²å’Œåˆ—è¡¨:</p> <figure class="highlight cmake"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line>$&LTLOWER_CASE:CMake></span><br></pre></table></figure> <p>è¿™å°†è¾“å‡ºâ€œcmakeâ€.</p> <h2 id=Advanced-cmake><a title="Advanced cmake" class=headerlink href=#Advanced-cmake></a>Advanced cmake</h2><p>cmakeåœ¨c++ä¸­ç”¨çš„å¤ªå¤šäº†,</p> <p>æœ€è¿‘åœ¨çœ‹åˆ«äººé¡¹ç›®çš„æ—¶å€™çœ‹è§äº†ä¸€äº›æ¯”è¾ƒé«˜çº§çš„cmakeä½¿ç”¨æ–¹æ³•.</p> <p><strong>macro</strong></p> <p>å®šä¹‰ä¸€ä¸ªåä¸º \<name> çš„å®,è¯¥å®æ¥æ”¶åä¸º \<arg1>, â€¦ çš„å‚æ•°. <p>CMake å®ä½¿ç”¨ macro()/endmacro() å®šä¹‰,æœ‰ç‚¹åƒå‡½æ•°function.ä¸åŒçš„æ˜¯,å‡½æ•°å‚æ•°æ˜¯çœŸå˜é‡,è€Œ åœ¨å®ä¸­æ˜¯å­—ç¬¦ä¸²æ›¿æ¢.è¿™æ„å‘³ç€å¿…é¡»ä½¿ç”¨å¤§æ‹¬å·è®¿é—®å®çš„æ‰€æœ‰å‚æ•°. å¦ä¸€ä¸ªåŒºåˆ«æ˜¯,é€šè¿‡è°ƒç”¨å‡½æ•°,ä½œç”¨åŒºåŸŸè½¬ç§»åˆ°å‡½æ•°å†…éƒ¨.æ‰§è¡Œå®æ—¶,å°±å¥½åƒå®çš„ä¸»ä½“ç²˜è´´åˆ° è°ƒç”¨ä½ç½®ä¸€æ ·,å®ä¸ä¼šåˆ›å»ºå˜é‡å’Œæ§åˆ¶æµçš„ä½œç”¨åŸŸ.å› æ­¤,é¿å…åœ¨å®ä¸­è°ƒç”¨ return().</p> <p><strong>function</strong></p> <p>å‡½æ•°ç”± function()/endfunction() å®šä¹‰.å‡½æ•°ä¸ºå˜é‡åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ä½œç”¨åŸŸ,å› æ­¤æ‰€æœ‰ åœ¨å†…éƒ¨å®šä¹‰çš„å˜é‡éƒ½ä¸èƒ½ä»å¤–éƒ¨è®¿é—®,é™¤éå°† PARENT_SCOPE é€‰é¡¹ä¼ é€’ç»™ set(). å‡½æ•°ä¸åŒºåˆ†å¤§å°å†™,é€šè¿‡ function åçš„åç§°åŠ ä¸Šåœ†æ‹¬å·æ¥ä½¿ç”¨å‡½æ•°</p> <h4 id=Effective-CMake><a title="Effective CMake" class=headerlink href=#Effective-CMake></a>Effective CMake</h4><ul><li><a href=https://gist.github.com/mbinna/c61dbb39bca0e4fb7d1f73b0d66a4fd1 rel=noopener target=_blank>Effective Modern CMake (github.com)</a><li><a href=https://github.com/xiaoweiChen/CMake-Best-Practices rel=noopener target=_blank>xiaoweiChen/CMake-Best-Practices: ã€ŠCMake Best Practicesã€‹çš„éä¸“ä¸šä¸ªäººç¿»è¯‘ (github.com)</a><li><a href=https://llvm.org/docs/CMakePrimer.html rel=noopener target=_blank>CMake Primer â€” LLVM 19.0.0git documentation</a></ul> <h5 id=é€šç”¨><a class=headerlink href=#é€šç”¨ title=é€šç”¨></a>é€šç”¨</h5><p>ä½¿ç”¨CMakeç‰ˆæœ¬å¤§äº3.0.0</p> <p>å°†CMakeè§†ä¸ºä»£ç ,åƒå¯¹å¾…ä»»ä½•å…¶ä»–ç¼–ç¨‹è¯­è¨€ä¸€æ ·,ä¿æŒCMakeLists.txtå’Œæ¨¡å—çš„ä»£ç æ¸…æ™°ã€ç»“æ„è‰¯å¥½.</p> <p>å…¨å±€å®šä¹‰é¡¹ç›®å±æ€§,åœ¨é¡¶å±‚CMakeLists.txtæ–‡ä»¶ä¸­å®šä¹‰å¦‚<strong>ç¼–è¯‘å™¨è­¦å‘Šã€ä»£ç æ ‡å‡†ç­‰å…¨å±€é¡¹ç›®å±æ€§</strong>,ç¡®ä¿æ‰€æœ‰ç›®æ ‡ä½¿ç”¨ç›¸åŒçš„æ ‡å‡†,é¿å…å› ä¾èµ–ç›®æ ‡é—´çš„ç¼–è¯‘é€‰é¡¹ä¸ä¸€è‡´å¯¼è‡´çš„é—®é¢˜</p> <blockquote><p>ä¾‹å¦‚,ä¸€ä¸ªé¡¹ç›®å¯èƒ½ä¼šä½¿ç”¨ä¸€ç»„é€šç”¨çš„ç¼–è¯‘å™¨è­¦å‘Š. åœ¨é¡¶å±‚ CMakeLists.txt æ–‡ä»¶ä¸­å…¨å±€å®šä¹‰æ­¤ç±»å±æ€§,å¯é¿å…å› ä¾èµ–ç›®æ ‡ä½¿ç”¨æ›´ä¸¥æ ¼çš„ç¼–è¯‘å™¨é€‰é¡¹è€Œå¯¼è‡´ä¾èµ–ç›®æ ‡çš„å…¬å…±å¤´æ–‡ä»¶æ— æ³•ç¼–è¯‘çš„æƒ…å†µ. å…¨å±€å®šä¹‰æ­¤ç±»é¡¹ç›®å±æ€§å¯ä»¥æ›´æ–¹ä¾¿åœ°ç®¡ç†é¡¹ç›®åŠå…¶æ‰€æœ‰ç›®æ ‡.</blockquote> <p>ç›´æ¥æ“ä½œç›®æ ‡(targets),ä¸è¦ä½¿ç”¨<code>add_compile_options</code>, <code>include_directories</code>, <code>link_directories</code>, <code>link_libraries</code>ç­‰å‘½ä»¤,å› ä¸ºå®ƒä»¬ä½œç”¨äºç›®å½•çº§åˆ«,å¯èƒ½å¼•å…¥éšå«çš„ä¾èµ–å…³ç³».ç›¸å,ç›´æ¥å¯¹ç‰¹å®šçš„ç›®æ ‡ä½¿ç”¨<code>target_compile_options</code>, <code>target_include_directories</code>, <code>target_link_directories</code>, <code>target_link_libraries</code>ç­‰å‘½ä»¤.</p> <p>ä¸è¦ç›´æ¥æ“ä½œCMAKE_CXX_FLAGS,ä¸åŒçš„ç¼–è¯‘å™¨æœ‰ä¸åŒçš„å‘½ä»¤è¡Œå‚æ•°æ ¼å¼.é€šè¿‡CMAKE_CXX_FLAGSè®¾ç½®C++æ ‡å‡†ï¼ˆå¦‚<code>-std=c++14</code>ï¼‰å¯èƒ½ä¼šåœ¨æœªæ¥ç‰ˆæœ¬çš„ç¼–è¯‘å™¨ä¸Šå¤±æ•ˆ,å› ä¸ºè¿™äº›è¦æ±‚ä¹Ÿå¯èƒ½åœ¨å…¶ä»–æ ‡å‡†ï¼ˆå¦‚C++17ï¼‰ä¸­æ»¡è¶³,è€Œä¸”è€ç¼–è¯‘å™¨çš„é€‰é¡¹å¯èƒ½ä¸åŒ.å› æ­¤,<strong>åº”è¯¥å‘Šè¯‰CMakeæ‰€éœ€çš„ç¼–è¯‘ç‰¹æ€§,è®©CMakeæ ¹æ®å…·ä½“æƒ…å†µé€‰æ‹©é€‚å½“çš„ç¼–è¯‘å™¨é€‰é¡¹.</strong></p> <p>åˆç†ä½¿ç”¨usage requirements,ä¾‹å¦‚,ä¸è¦å°†<code>-Wall</code>ï¼ˆå¼€å¯æ‰€æœ‰è­¦å‘Šï¼‰æ·»åŠ åˆ°ç›®æ ‡çš„PUBLICæˆ–INTERFACEæ®µçš„<code>target_compile_options</code>ä¸­,å› ä¸ºè¿™ä¸æ˜¯æ„å»ºä¾èµ–ç›®æ ‡æ‰€å¿…éœ€çš„,è¿™æ ·åšå¯èƒ½å¯¼è‡´ä¸å¿…è¦çš„è­¦å‘Šä¿¡æ¯.</p> <h5 id=æ¨¡å—Modules><a class=headerlink href=#æ¨¡å—Modules title=æ¨¡å—Modules></a>æ¨¡å—Modules</h5><p>ä½¿ç”¨å£°æ˜å¯¼å‡ºç›®æ ‡çš„ç°ä»£æŸ¥æ‰¾æ¨¡å—.</p> <p>ä» CMake 3.4 å¼€å§‹,è¶Šæ¥è¶Šå¤šçš„æŸ¥æ‰¾æ¨¡å—å¯¼å‡ºäº†å¯é€šè¿‡ target_link_libraries ä½¿ç”¨çš„ç›®æ ‡.</p> <p>ä½¿ç”¨å¤–éƒ¨è½¯ä»¶åŒ…çš„å¯¼å‡ºç›®æ ‡. ä¸è¦é‡è¹ˆ CMake ä½¿ç”¨å¤–éƒ¨è½¯ä»¶åŒ…å®šä¹‰çš„å˜é‡çš„è¦†è¾™. è€Œåº”é€šè¿‡ target_link_libraries ä½¿ç”¨å¯¼å‡ºçš„ç›®æ ‡.</p> <p>å¯¹äºä¸æ”¯æŒå®¢æˆ·ç«¯ä½¿ç”¨ CMake çš„ç¬¬ä¸‰æ–¹åº“,è¯·ä½¿ç”¨æŸ¥æ‰¾æ¨¡å—. CMake ä¸ºç¬¬ä¸‰æ–¹åº“æä¾›äº†ä¸€ç³»åˆ—æŸ¥æ‰¾æ¨¡å—.</p> <p>ä¾‹å¦‚,Boost ä¸æ”¯æŒ CMake. ç›¸å,CMake æä¾›äº†ä¸€ä¸ªæŸ¥æ‰¾æ¨¡å—,ä»¥ä¾¿åœ¨ CMake ä¸­ä½¿ç”¨ Boost.</p> <p>å¦‚æœæŸä¸ªåº“ä¸æ”¯æŒå®¢æˆ·ç«¯ä½¿ç”¨ CMake,è¯·å°†å…¶ä½œä¸º bug æŠ¥å‘Šç»™ç¬¬ä¸‰æ–¹åº“ä½œè€…. å¦‚æœè¯¥åº“æ˜¯ä¸€ä¸ªå¼€æºé¡¹ç›®,è¯·è€ƒè™‘å‘é€è¡¥ä¸. CMake åœ¨ä¸šç•Œå ä¸»å¯¼åœ°ä½. å¦‚æœåº“ä½œè€…ä¸æ”¯æŒ CMake,é‚£å°±éº»çƒ¦äº†.</p> <p>ä¸ºä¸æ”¯æŒå®¢æˆ·ç«¯ä½¿ç”¨ CMake çš„ç¬¬ä¸‰æ–¹åº“ç¼–å†™æŸ¥æ‰¾æ¨¡å—. å¯ä»¥æ”¹é€ æŸ¥æ‰¾æ¨¡å—,å°†ç›®æ ‡æ­£ç¡®å¯¼å‡ºåˆ°ä¸æ”¯æŒ CMake çš„å¤–éƒ¨è½¯ä»¶åŒ….</p> <p>å¦‚æœæ‚¨æ˜¯åº“ä½œè€…,è¯·å¯¼å‡ºåº“çš„INTERFACE</p> <h5 id=é¡¹ç›®Projects><a class=headerlink href=#é¡¹ç›®Projects title=é¡¹ç›®Projects></a>é¡¹ç›®Projects</h5><ul><li><p>é¿å…åœ¨é¡¹ç›®å‘½ä»¤å‚æ•°ä¸­ä½¿ç”¨è‡ªå®šä¹‰å˜é‡. ä¿æŒç®€å•. ä¸è¦å¼•å…¥ä¸å¿…è¦çš„è‡ªå®šä¹‰å˜é‡. ä¸è¦ä½¿ç”¨ add_library(a ${MY_HEADERS} ${MY_SOURCES}),è€Œåº”ä½¿ç”¨ add_library(a b.h b.cpp).</p><li><p>ä¸è¦åœ¨é¡¹ç›®ä¸­ä½¿ç”¨ file(GLOB),CMake æ˜¯ä¸€ä¸ªç¼–è¯‘ç³»ç»Ÿç”Ÿæˆå™¨,è€Œä¸æ˜¯ä¸€ä¸ªç¼–è¯‘ç³»ç»Ÿ. åœ¨ç”Ÿæˆæ„å»ºç³»ç»Ÿæ—¶,å®ƒä¼šå°† GLOB è¡¨è¾¾å¼æ±‚å€¼ä¸ºä¸€ä¸ªæ–‡ä»¶åˆ—è¡¨. ç„¶å,è”ç¼–ç³»ç»Ÿä¼šå¯¹è¯¥æ–‡ä»¶åˆ—è¡¨è¿›è¡Œæ“ä½œ. CMake æ— æ³•å°† GLOB è¡¨è¾¾å¼è½¬å‘ç»™è”ç¼–ç³»ç»Ÿ,ä»¥ä¾¿åœ¨è”ç¼–æ—¶å¯¹è¡¨è¾¾å¼è¿›è¡Œè¯„ä¼°. CMake å¸Œæœ›æˆä¸ºæ‰€æ”¯æŒçš„è”ç¼–ç³»ç»Ÿçš„å…¬åˆ†æ¯. å¹¶éæ‰€æœ‰çš„æ„å»ºç³»ç»Ÿéƒ½æ”¯æŒè¿™ä¸€ç‚¹,å› æ­¤ CMake ä¹Ÿæ— æ³•æ”¯æŒ.</p><li>å°†ç‰¹å®šäº CI çš„è®¾ç½®æ”¾åœ¨ CTest è„šæœ¬ä¸­,è€Œä¸æ˜¯é¡¹ç›®ä¸­,è¿™æ ·ä¼šè®©äº‹æƒ…æ›´ç®€å•.<li>æµ‹è¯•åç§°åº”éµå¾ªå‘½åçº¦å®š. è¿™æ ·å¯ä»¥ç®€åŒ–é€šè¿‡ CTest è¿è¡Œæµ‹è¯•æ—¶çš„ regex è¿‡æ»¤.</ul> <h5 id=ç›®æ ‡-Targets-åŠå…¶å±æ€§-Properties><a class=headerlink href=#ç›®æ ‡-Targets-åŠå…¶å±æ€§-Properties title=ç›®æ ‡(Targets)åŠå…¶å±æ€§(Properties)></a>ç›®æ ‡(Targets)åŠå…¶å±æ€§(Properties)</h5><p><strong>ä»ç›®æ ‡å’Œå±æ€§çš„è§’åº¦æ€è€ƒ</strong></p> <p>é€šè¿‡ä»ç›®æ ‡çš„è§’åº¦å®šä¹‰å±æ€§ï¼ˆå³ç¼–è¯‘å®šä¹‰ã€ç¼–è¯‘é€‰é¡¹ã€ç¼–è¯‘ç‰¹æ€§ã€åŒ…å«ç›®å½•å’Œåº“ä¾èµ–å…³ç³»,compile definitions, compile options, compile features, include directories, and library dependenciesï¼‰,å¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜åœ¨ç›®æ ‡çº§åˆ«å¯¹ç³»ç»Ÿè¿›è¡Œæ¨ç†. å¼€å‘äººå‘˜ä¸éœ€è¦äº†è§£æ•´ä¸ªç³»ç»Ÿ,å°±èƒ½å¯¹å•ä¸ªç›®æ ‡è¿›è¡Œæ¨ç†. æ„å»ºç³»ç»Ÿå¯å¤„ç†åå‘æ€§.</p> <p><strong>å°†ç›®æ ‡æƒ³è±¡æˆå¯¹è±¡</strong></p> <p>è°ƒç”¨æˆå‘˜å‡½æ•°ä¼šä¿®æ”¹å¯¹è±¡çš„æˆå‘˜å˜é‡.</p> <p>ä¸æ„é€ å‡½æ•°ç±»æ¯”ï¼šadd_executable add_library</p> <p>ä¸æˆå‘˜å˜é‡ç±»æ¯”ï¼štarget propertiesï¼ˆå¤ªå¤š,è¿™é‡Œä¸ä¸€ä¸€åˆ—ä¸¾ï¼‰</p> <p>ä¸æˆå‘˜å‡½æ•°ç±»æ¯”ï¼štarget_compile_definitions target_compile_features target_compile_options target_include_directories target_link_libraries target_sources get_target_property set_target_property</p> <p>å¦‚æœç›®æ ‡éœ€è¦å†…éƒ¨å±æ€§ï¼ˆå¦‚ç¼–è¯‘å®šä¹‰ã€ç¼–è¯‘é€‰é¡¹ã€ç¼–è¯‘ç‰¹æ€§ã€åŒ…å«ç›®å½•å’Œåº“ä¾èµ–å…³ç³»ï¼‰,è¯·å°†å®ƒä»¬æ·»åŠ åˆ° target_* å‘½ä»¤çš„ PRIVATE éƒ¨åˆ†.</p> <p><strong>ä½¿ç”¨ target_compile_definitions å£°æ˜ç¼–è¯‘å®šä¹‰</strong></p> <p>å¯å°†ç¼–è¯‘å®šä¹‰ä¸ç›®æ ‡çš„å¯è§æ€§ï¼ˆPRIVATEã€PUBLICã€INTERFACEï¼‰å…³è”èµ·æ¥. è¿™æ¯”ä½¿ç”¨ add_compile_definitions æ›´å¥½,å› ä¸º add_compile_definitions ä¸ç›®æ ‡æ²¡æœ‰å…³è”.</p> <p><strong>ä½¿ç”¨ target_compile_options å£°æ˜ç¼–è¯‘é€‰é¡¹</strong></p> <p>è¿™ä¸ç¼–è¯‘é€‰é¡¹ä¸ç›®æ ‡çš„å¯è§æ€§ï¼ˆPRIVATEã€PUBLICã€INTERFACEï¼‰ç›¸å…³è”. è¿™æ¯”ä½¿ç”¨ add_compile_options è¦å¥½,å› ä¸º add_compile_options ä¸ç›®æ ‡æ²¡æœ‰å…³è”.</p> <p>ä½†è¦æ³¨æ„ä¸è¦å£°æ˜ä¼šå½±å“ ABI çš„ç¼–è¯‘é€‰é¡¹. è¯·å…¨å±€å£°æ˜è¿™äº›é€‰é¡¹.</p> <p>target_compile_featuresåŒ</p> <p><strong>ä½¿ç”¨ target_include_directories å£°æ˜ include ç›®å½•</strong></p> <p>è¿™å°† include ç›®å½•ä¸ç›®æ ‡çš„å¯è§æ€§ï¼ˆPRIVATEã€PUBLICã€INTERFACEï¼‰ç›¸å…³è”. è¿™æ¯”ä½¿ç”¨ include_directories æ›´å¥½,å› ä¸º include_directories ä¸ç›®æ ‡æ²¡æœ‰å…³è”.</p> <p><strong>ä½¿ç”¨ target_link_libraries å£°æ˜ç›´æ¥ä¾èµ–å…³ç³»</strong>,è¿™å°†æŠŠä½¿ç”¨è¦æ±‚ä»ä¾èµ–ç›®æ ‡ä¼ æ’­åˆ°è¢«ä¾èµ–ç›®æ ‡. è¯¥å‘½ä»¤è¿˜èƒ½è§£å†³ä¼ é€’ä¾èµ–å…³ç³».</p> <p><strong>ä¸è¦åœ¨ç»„ä»¶ç›®å½•ä¹‹å¤–çš„è·¯å¾„ä¸‹ä½¿ç”¨ target_include_directories</strong></p> <p>åœ¨ç»„ä»¶ç›®å½•ä¹‹å¤–ä½¿ç”¨è·¯å¾„æ˜¯ä¸€ç§éšè—çš„ä¾èµ–å…³ç³». ç›¸å,åº”ä½¿ç”¨ target_include_directories é€šè¿‡ target_link_directories å°†åŒ…å«ç›®å½•ä½œä¸ºä½¿ç”¨è¦æ±‚ä¼ æ’­ç»™ä¾èµ–ç›®æ ‡.</p> <p>ä½¿ç”¨ target_* æ—¶,å§‹ç»ˆæ˜ç¡®å£°æ˜å±æ€§ PUBLICã€PRIVATE æˆ– INTERFACE. æ˜ç¡®å£°æ˜å¯å‡å°‘æ— æ„ä¸­å¼•å…¥éšè—ä¾èµ–å…³ç³»çš„æœºä¼š.</p> <p>ä¸è¦ä½¿ç”¨ target_compile_options è®¾ç½®ä¼šå½±å“ ABI çš„é€‰é¡¹. å¯¹å¤šä¸ªç›®æ ‡ä½¿ç”¨ä¸åŒçš„ç¼–è¯‘é€‰é¡¹å¯èƒ½ä¼šå½±å“ ABI å…¼å®¹æ€§. é˜²æ­¢æ­¤ç±»é—®é¢˜çš„æœ€ç®€å•è§£å†³æ–¹æ¡ˆæ˜¯å…¨å±€å®šä¹‰ç¼–è¯‘é€‰é¡¹.</p> <p>ä½¿ç”¨åœ¨åŒä¸€ CMake æ ‘ä¸­å®šä¹‰çš„åº“åº”ä¸ä½¿ç”¨å¤–éƒ¨åº“ç›¸åŒ. åœ¨åŒä¸€ CMake æ ‘ä¸­å®šä¹‰çš„è½¯ä»¶åŒ…å¯ç›´æ¥è®¿é—®. é€šè¿‡ CMAKE_PREFIX_PATH è·å–é¢„ç¼–è¯‘åº“. å¦‚æœè½¯ä»¶åŒ…å®šä¹‰åœ¨åŒä¸€ä¸ªç¼–è¯‘æ ‘ä¸­,é‚£ä¹ˆä½¿ç”¨ find_package æŸ¥æ‰¾è¯¥è½¯ä»¶åŒ…å°±ä¸ä¼šæœ‰ä»»ä½•é—®é¢˜. åœ¨å°†ç›®æ ‡ Bar å¯¼å‡ºåˆ°å‘½åç©ºé—´ Foo æ—¶,è¿˜å¯ä»¥é€šè¿‡ add_library(Foo::Bar ALIAS Bar) åˆ›å»ºåˆ«å Foo::Bar. åˆ›å»ºä¸€ä¸ªå˜é‡,åˆ—å‡ºæ‰€æœ‰å­é¡¹ç›®. å®šä¹‰ find_package å®æ¥å°è£…åŸæ¥çš„ find_package å‘½ä»¤ï¼ˆç°åœ¨å¯é€šè¿‡ _find_package è®¿é—®ï¼‰. å¦‚æœå˜é‡åŒ…å«è½¯ä»¶åŒ…çš„åç§°,å®å°†ç¦æ­¢è°ƒç”¨ _find_package.</p> <h5 id=å‡½æ•°ä¸å®><a class=headerlink href=#å‡½æ•°ä¸å® title=å‡½æ•°ä¸å®></a>å‡½æ•°ä¸å®</h5><p>é™¤äº†åŸºäºç›®å½•çš„ä½œç”¨åŸŸå¤–,CMake å‡½æ•°ä¹Ÿæœ‰è‡ªå·±çš„ä½œç”¨åŸŸ. è¿™æ„å‘³ç€åœ¨å‡½æ•°ä¸­è®¾ç½®çš„å˜é‡åœ¨çˆ¶ä½œç”¨åŸŸä¸­ä¸å¯è§. å®åˆ™ä¸ç„¶.</p> <p>å®åªèƒ½ç”¨äºå®šä¹‰å¾ˆå°çš„åŠŸèƒ½,æˆ–ç”¨äºå°è£…æœ‰è¾“å‡ºå‚æ•°çš„å‘½ä»¤. å‡½æ•°æœ‰è‡ªå·±çš„ä½œç”¨åŸŸ,å®æ²¡æœ‰.</p> <p>å®çš„å‚æ•°ä¸ä¼šè¢«è®¾ç½®ä¸ºå˜é‡,è€Œæ˜¯åœ¨æ‰§è¡Œå®ä¹‹å‰åœ¨å®ä¸­è§£æå¯¹å‚æ•°çš„å¼•ç”¨. è¿™å¯èƒ½ä¼šåœ¨ä½¿ç”¨æœªå¼•ç”¨å˜é‡æ—¶å¯¼è‡´æ„å¤–è¡Œä¸º. ä¸€èˆ¬æ¥è¯´,è¿™ä¸ªé—®é¢˜å¹¶ä¸å¸¸è§,å› ä¸ºå®ƒéœ€è¦ä½¿ç”¨åç§°åœ¨çˆ¶ä½œç”¨åŸŸä¸­é‡å çš„éå‚å¼•å˜é‡,ä½†å¿…é¡»æ³¨æ„,å› ä¸ºå®ƒå¯èƒ½å¯¼è‡´å¾®å¦™çš„é”™è¯¯.</p> <p>ä¸è¦ä½¿ç”¨ä¼šå½±å“ç›®å½•æ ‘ä¸­æ‰€æœ‰ç›®æ ‡çš„å®,å¦‚ include_directoriesã€add_definitions æˆ– link_libraries. è¿™äº›å®æ˜¯é‚ªæ¶çš„. å¦‚æœåœ¨é¡¶å±‚ä½¿ç”¨å®,æ‰€æœ‰ç›®æ ‡éƒ½å¯ä»¥ä½¿ç”¨å®å®šä¹‰çš„å±æ€§. ä¾‹å¦‚,æ‰€æœ‰ç›®æ ‡éƒ½å¯ä»¥ä½¿ç”¨ï¼ˆå³ #includeï¼‰include_directories æ‰€å®šä¹‰çš„å¤´æ–‡ä»¶. å¦‚æœç›®æ ‡ä¸éœ€è¦é“¾æ¥ï¼ˆå¦‚æ¥å£åº“ã€å†…è”æ¨¡æ¿ï¼‰,åœ¨è¿™ç§æƒ…å†µä¸‹ç”šè‡³ä¸ä¼šå‡ºç°ç¼–è¯‘å™¨é”™è¯¯. ä½¿ç”¨è¿™äº›å®å¾ˆå®¹æ˜“æ„å¤–åœ°é€šè¿‡å…¶ä»–ç›®æ ‡åˆ›å»ºéšè—çš„ä¾èµ–å…³ç³».</p> <p><strong>å»ºè®®ä½¿ç”¨ cmake_parse_arguments æ¥å¤„ç†ä»»ä½•å‡½æ•°ä¸­åŸºäºå‚æ•°çš„å¤æ‚è¡Œä¸ºæˆ–å¯é€‰å‚æ•°.</strong></p> <h5 id=å¾ªç¯><a class=headerlink href=#å¾ªç¯ title=å¾ªç¯></a>å¾ªç¯</h5><ul><li><code>foreach(var IN ITEMS foo bar baz) ...</code><li><code>foreach(var IN LISTS my_list) ...</code><li><code>foreach(var IN LISTS my_list ITEMS foo bar baz) ...</code></ul> <h5 id=åŒ…><a class=headerlink href=#åŒ… title=åŒ…></a>åŒ…</h5><p>ä½¿ç”¨ CPack åˆ›å»ºè½¯ä»¶åŒ….</p> <p>CPack æ˜¯ CMake çš„ä¸€éƒ¨åˆ†,å¹¶ä¸ CMake å®Œç¾é›†æˆ.</p> <p>ç¼–å†™ CPackConfig.cmake,å…¶ä¸­åŒ…æ‹¬ CMake ç”Ÿæˆçš„ CPackConfig.cmake,è¿™æ ·å°±å¯ä»¥è®¾ç½®æ— éœ€å‡ºç°åœ¨é¡¹ç›®ä¸­çš„å…¶ä»–å˜é‡.</p> <h5 id=äº¤å‰ç¼–è¯‘><a class=headerlink href=#äº¤å‰ç¼–è¯‘ title=äº¤å‰ç¼–è¯‘></a>äº¤å‰ç¼–è¯‘</h5><p>ä½¿ç”¨å·¥å…·é“¾æ–‡ä»¶è¿›è¡Œäº¤å‰ç¼–è¯‘.å·¥å…·é“¾æ–‡ä»¶å°è£…äº†ç”¨äºäº¤å‰ç¼–è¯‘çš„å·¥å…·é“¾.</p> <p>ä¿æŒå·¥å…·é“¾æ–‡ä»¶çš„ç®€æ´,è¿™æ ·æ›´æ˜“äºç†è§£å’Œä½¿ç”¨. ä¸è¦åœ¨å·¥å…·é“¾æ–‡ä»¶ä¸­åŠ å…¥é€»è¾‘. ä¸ºæ¯ä¸ªå¹³å°åˆ›å»ºä¸€ä¸ªå·¥å…·é“¾æ–‡ä»¶.</p> <h5 id=è­¦å‘Šä¸æŠ¥é”™><a class=headerlink href=#è­¦å‘Šä¸æŠ¥é”™ title=è­¦å‘Šä¸æŠ¥é”™></a>è­¦å‘Šä¸æŠ¥é”™</h5><p>æ­£ç¡®å¯¹å¾…æ„å»ºé”™è¯¯ã€ä¿®å¤é”™è¯¯ã€æ‹’ç»æ‹‰å–è¯·æ±‚ã€æš‚ç¼“å‘å¸ƒ.</p> <p><strong>å°†è­¦å‘Šè§†ä¸ºé”™è¯¯</strong></p> <p>è¦å°†è­¦å‘Šè§†ä¸ºé”™è¯¯,åˆ‡å‹¿å‘ç¼–è¯‘å™¨ä¼ é€’ -Werror. å¦‚æœè¿™æ ·åš,ç¼–è¯‘å™¨å°±ä¼šå°†è­¦å‘Šè§†ä¸ºé”™è¯¯.</p> <ul><li>You cannot enable <code>-Werror</code> unless you already reached zero warnings.<li>You cannot increase the warning level unless you already fixed all warnings introduced by that level.<li>You cannot upgrade your compiler unless you already fixed all new warnings that the compiler reports at your warning level.<li>You cannot update your dependencies unless you already ported your code away from any symbols that are now <code>[[deprecated]]</code>.<li><p>You cannot <code>[[deprecated]]</code> your internal code as long as it is still used. But once it is no longer used, you can as well just remove it.</p> <p><strong>å°†æ–°çš„è­¦å‘Šè§†ä¸ºé”™è¯¯</strong></p></ul> <ol><li>At the beginning of a development cycle (e.g., sprint), allow new warnings to be introduced.<ul><li>Increase warning level, enable new warnings explicitly.<li>Update the compiler.<li>Update dependencies.<li>Mark symbols as <code>[[deprecated]]</code>.</ul><li>Burn down the number of warnings.<li>Repeat.</ol> <p>ä½¿ç”¨å¤šä¸ªæ”¯æŒçš„åˆ†æå™¨ï¼šclang-tidy (\<lang>_CLANG_TIDY)ã€cpplint (\<lang>_CPPLINT)ã€include-what-you-use (\<lang>_INCLUDE_WHAT_YOU_USE) å’Œ LINK_WHAT_YOU_USE å¯å¸®åŠ©æ‚¨å‘ç°ä»£ç ä¸­çš„é—®é¢˜. è¿™äº›å·¥å…·çš„è¯Šæ–­è¾“å‡ºå°†æ˜¾ç¤ºåœ¨æ„å»ºè¾“å‡ºå’Œé›†æˆå¼€å‘ç¯å¢ƒä¸­. <p>å¯¹äºæ¯ä¸ªå¤´æ–‡ä»¶,éƒ½å¿…é¡»æœ‰ä¸€ä¸ªå…³è”çš„æºæ–‡ä»¶,è¯¥æºæ–‡ä»¶ #includes å¤´æ–‡ä»¶åœ¨é¡¶éƒ¨,å³ä½¿è¯¥æºæ–‡ä»¶æœ¬æ¥æ˜¯ç©ºçš„. å¤§å¤šæ•°åˆ†æå·¥å…·éƒ½ä¼šæŠ¥å‘Šå½“å‰æºæ–‡ä»¶å’Œå…³è”å¤´æ–‡ä»¶çš„è¯Šæ–­ç»“æœ. æ²¡æœ‰å…³è”æºæ–‡ä»¶çš„å¤´æ–‡ä»¶ä¸ä¼šè¢«åˆ†æ. æ‚¨ä¹Ÿè®¸å¯ä»¥è®¾ç½®è‡ªå®šä¹‰å¤´æ–‡ä»¶è¿‡æ»¤å™¨,ä½†è¿™æ ·å¤´æ–‡ä»¶å¯èƒ½ä¼šè¢«åˆ†æå¤šæ¬¡.</p> <h2 id=å®æˆ˜><a class=headerlink href=#å®æˆ˜ title=å®æˆ˜></a>å®æˆ˜</h2><p>CMake ä¸­å­˜åœ¨ä¸¤ä¸ªé€»è¾‘æ–‡ä»¶å¤¹.ä¸€ä¸ªæ˜¯æºæ–‡ä»¶å¤¹,åŒ…å«é¡¹ç›®çš„å±‚æ¬¡ç»“æ„é›†ï¼›å¦ä¸€ä¸ªæ˜¯æ„å»ºæ–‡ä»¶å¤¹,åŒ…å«æ„å»ºæŒ‡ä»¤ã€ç¼“å­˜,ä»¥åŠæ‰€æœ‰ç”Ÿæˆçš„äºŒè¿›åˆ¶æ–‡ä»¶å’Œå·¥ä»¶.</p> <p>æºæ–‡ä»¶å¤¹æ˜¯ CMakeLists.txt æ–‡ä»¶æ‰€åœ¨çš„ä½ç½®.æ„å»ºæ–‡ä»¶å¤¹å¯ä»¥æ”¾åœ¨æºæ–‡ä»¶å¤¹ä¸­,ä¹Ÿå¯ä»¥å°†å…¶æ”¾åœ¨å¦ä¸€ä¸ªä½ç½®.ä¸¤ç§æ–¹å¼éƒ½å¯ä»¥Í¾</p> <p>æ„å»ºæ–‡ä»¶å¤¹é€šå‘½åä¸º build,ä½†ä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»–åç§°,åŒ…æ‹¬ä¸åŒå¹³å°çš„å‰ç¼€å’Œåç¼€.å½“åœ¨æº ä»£ç æ ‘ä¸­ä½¿ç”¨æ„å»ºæ–‡ä»¶å¤¹æ—¶,æœ€å¥½å°†å…¶æ·»åŠ åˆ°.gitignore ä¸­. å½“é…ç½® CMake é¡¹ç›®æ—¶,å°†åœ¨æ„å»ºæ–‡ä»¶å¤¹ä¸­é‡æ–°åˆ›å»ºæºæ–‡ä»¶å¤¹çš„é¡¹ç›®å’Œæ–‡ä»¶å¤¹ç»“æ„,ä»¥ä¾¿æ‰€æœ‰æ„ å»ºå·¥ä»¶éƒ½ä½äºç›¸åŒçš„ä½ç½®.æ¯ä¸ªæ–‡ä»¶å¤¹ä¸­,éƒ½æœ‰ä¸€ä¸ªåä¸º CMakeFiles çš„å­æ–‡ä»¶å¤¹,å…¶ä¸­åŒ…å« CMake é…ç½®æ­¥éª¤ç”Ÿæˆçš„ä¿¡æ¯.</p> <p>CMake é¡¹ç›®çš„æ–‡ä»¶ç»“æ„ä¼šæ˜ å°„åˆ° build æ–‡ä»¶å¤¹ä¸­.<strong>æ¯ä¸ªåŒ…å« CMakeLists.txt æ–‡ä»¶çš„æ–‡ä»¶å¤¹å°†è¿›è¡Œæ˜ å°„,å°†åˆ›å»ºä¸€ä¸ªåä¸º CMakeFiles çš„å­æ–‡ä»¶å¤¹</strong>,å…¶ä¸­åŒ…å«ç”¨ äºæ„å»ºçš„ä¿¡æ¯</p> <p>å˜é‡çš„ä½œç”¨åŸŸå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼ç¡®å®š:</p> <p>â€¢ å‡½æ•°ä½œç”¨åŸŸ: åœ¨å‡½æ•°å†…éƒ¨è®¾ç½®çš„å˜é‡åªåœ¨å‡½æ•°å†…éƒ¨å¯è§.</p> <p>â€¢ ç›®å½•ä½œç”¨åŸŸ: æºæ ‘ä¸­çš„æ¯ä¸ªå­ç›®å½•ç»‘å®šå˜é‡,å¹¶åŒ…æ‹¬æ¥è‡ªçˆ¶ç›®å½•çš„å˜é‡.</p> <p>â€¢ æŒä¹…ç¼“å­˜: ç¼“å­˜çš„å˜é‡å¯ä»¥æ˜¯ç³»ç»Ÿçš„,ä¹Ÿå¯ä»¥æ˜¯ç”¨æˆ·å®šä¹‰çš„.åœ¨å¤šæ¬¡è¿è¡Œä¸­ä¿æŒå®ƒä»¬çš„å€¼ä¸å˜.</p> <p>å°† PARENT_SCOPE é€‰é¡¹ä¼ é€’ç»™ set() ä¼šä½¿å˜é‡åœ¨çˆ¶ä½œç”¨åŸŸä¸­å¯è§</p> <p><a href=https://cmake.org/cmake/help/latest/manual/cmake-variables.7.html rel=noopener target=_blank>cmake-variables(7) â€” CMake 3.30.1 Documentation</a></p> <h3 id=é¡¹ç›®ç»“æ„><a class=headerlink href=#é¡¹ç›®ç»“æ„ title=é¡¹ç›®ç»“æ„></a>é¡¹ç›®ç»“æ„</h3><figure class="highlight reasonml"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br></pre><td class=code><pre><span class=line>â”œâ”€â”€ <span class=module-access><span class=module><span class=identifier>CMakeLists</span>.</span></span>txt</span><br><span class=line>â”œâ”€â”€ build</span><br><span class=line>â”œâ”€â”€ <span class=keyword>include</span>/project_name</span><br><span class=line>â””â”€â”€ src</span><br></pre></table></figure> <p>æœ€å°çš„é¡¹ç›®ç»“æ„ä¸­æœ‰ä¸‰ä¸ªæ–‡ä»¶å¤¹å’Œä¸€ä¸ªæ–‡ä»¶</p> <p>â€¢ build: æ”¾ç½®æ„å»ºæ–‡ä»¶å’ŒäºŒè¿›åˆ¶æ–‡ä»¶çš„æ–‡ä»¶å¤¹.</p> <p>â€¢ include/project_name: æ­¤ æ–‡ ä»¶ å¤¹ åŒ… å« ä» é¡¹ ç›® å¤– éƒ¨ å…¬ å¼€ è®¿ é—® çš„ æ‰€ æœ‰ å¤´ æ–‡ ä»¶, åŒ… å« ä½¿å®ƒæ›´å®¹æ˜“çœ‹å‡ºå¤´æ–‡ä»¶æ¥è‡ªå“ªä¸ªåº“.</p> <p>â€¢ src: æ­¤æ–‡ä»¶å¤¹åŒ…å«æ‰€æœ‰ç§æœ‰çš„æºæ–‡ä»¶å’Œå¤´æ–‡ä»¶</p> <p>â€¢ CMakeLists.txt: è¿™æ˜¯ä¸» CMake æ–‡ä»¶</p> <p>æ„å»ºæ–‡ä»¶å¤¹å¯ä»¥æ”¾ç½®åœ¨ä»»ä½•åœ°æ–¹,æ”¾åœ¨é¡¹ç›®æ ¹ç›®å½•æœ€æ–¹ä¾¿,ä½†å¼ºçƒˆå»ºè®®ä¸è¦é€‰æ‹©ä»»ä½•éç©ºæ–‡ä»¶ å¤¹ä½œä¸ºæ„å»ºæ–‡ä»¶å¤¹.ç‰¹åˆ«æ˜¯å°†æ„å»ºå¥½çš„æ–‡ä»¶æ”¾å…¥ include æˆ– src ä¸­,è¿™æ˜¯ä¸€ç§ç³Ÿç³•çš„å®è·µ.å…¶ä»–æ–‡ä»¶ å¤¹,å¦‚ test æˆ– doc,åœ¨ç»„ç»‡æµ‹è¯•é¡¹ç›®å’Œæ–‡æ¡£é¡µé¢æ—¶å°±å¾ˆæ–¹ä¾¿</p> <p><strong>åµŒå¥—é¡¹ç›®</strong></p> <figure class="highlight reasonml"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br></pre><td class=code><pre><span class=line>â”œâ”€â”€ <span class=module-access><span class=module><span class=identifier>CMakeLists</span>.</span></span>txt</span><br><span class=line>â”œâ”€â”€ build</span><br><span class=line>â”œâ”€â”€ <span class=keyword>include</span>/project_name</span><br><span class=line>â”œâ”€â”€ src</span><br><span class=line>â””â”€â”€ subproject</span><br><span class=line>â”œâ”€â”€ <span class=module-access><span class=module><span class=identifier>CMakeLists</span>.</span></span>txt</span><br><span class=line>â”œâ”€â”€ <span class=keyword>include</span></span><br><span class=line>â”‚ â””â”€â”€ subproject</span><br><span class=line>â””â”€â”€ src</span><br></pre></table></figure> <figure class="highlight cpp"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br></pre><td class=code><pre><span class=line><span class=built_in>cmake_minimum_required</span>(VERSION <span class=number>3.21</span>)</span><br><span class=line><span class=built_in>project</span>(</span><br><span class=line>hello_world_standalone</span><br><span class=line>VERSION <span class=number>1.0</span></span><br><span class=line>DESCRIPTION<span class=string>"A simple C++ project"</span></span><br><span class=line>HOMEPAGE_URL https:<span class=comment>//github.com/PacktPublishing/CMake-BestPractices</span></span><br><span class=line>LANGUAGES CXX</span><br><span class=line>)</span><br><span class=line><span class=built_in>add_executable</span>(hello_world)</span><br><span class=line><span class=built_in>target_sources</span>(hello_world PRIVATE src/main.cpp)</span><br><span class=line></span><br></pre></table></figure> <p>ç¬¬ä¸€è¡Œ,cmake_minimum_required(VERSION 3.21),æœŸæœ›çœ‹åˆ°çš„ CMake çš„ç‰ˆæœ¬,ä»¥åŠ CMake å°†å¯ç”¨å“ªäº›ç‰¹æ€§.æœ¬ä¹¦çš„ä¾‹å­ä¸­éƒ½ä½¿ç”¨ CMake 3.21,ä½†æ˜¯å‡ºäºå…¼å®¹æ€§çš„åŸå› ,è¯»è€…ä»¬å¯ä»¥é€‰ æ‹©ä¸€ä¸ªè¾ƒä½çš„ç‰ˆæœ¬.</p> <p>å¯¹äºæœ¬ä¾‹,3.1 ç‰ˆæœ¬å°†æ˜¯ç»å¯¹çš„æœ€å°å€¼,å› ä¸ºåœ¨æ­¤ä¹‹å‰,target_sources ä¸å¯ç”¨.å°† cmake_minimum_required æŒ‡ä»¤æ”¾åœ¨æ¯ä¸ª CMakeLists.txt æ–‡ä»¶çš„é¡¶éƒ¨æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„åšæ³•.</p> <p>æ¥ä¸‹æ¥,ä½¿ç”¨ project() æŒ‡ä»¤è®¾ç½®é¡¹ç›®.ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯é¡¹ç›®çš„åç§°â€”â€”æˆ‘ä»¬çš„ä¾‹å­ä¸­ä¸º â€œhello_world_standaloneâ€. æ¥ä¸‹æ¥,ç‰ˆæœ¬è®¾ç½®ä¸º 1.0.ä¸‹é¢æ˜¯ä¸€ä¸ªç®€çŸ­çš„æè¿°å’Œä¸»é¡µçš„ URL.</p> <p>æœ€å,LANGUAGES CXX å± æ€§æŒ‡å®šæ­£åœ¨æ„å»ºä¸€ä¸ª C++ é¡¹ç›®.é™¤äº†é¡¹ç›®åç§°ä¹‹å¤–,æ‰€æœ‰å‚æ•°éƒ½å¯é€‰. è°ƒç”¨ add_executable(hello_world) æŒ‡ä»¤,ä¼šåˆ›å»ºä¸€ä¸ªåä¸º hello_world çš„ç›®æ ‡.è¿™ä¹Ÿå°† æ˜¯å¯æ‰§è¡Œçš„æ–‡ä»¶å. ç°åœ¨å·²ç»åˆ›å»ºäº†ç›®æ ‡,ä½¿ç”¨ target_sources å®Œæˆäº†å‘ç›®æ ‡æ·»åŠ  C++ æºæ–‡ä»¶.Chapter3 æ˜¯ç›®æ ‡å,åœ¨ add_executable ä¸­æŒ‡å®š.</p> <p>PRIVATE å®šä¹‰æºä»…ç”¨äºæ„å»ºæ­¤ç›®æ ‡,è€Œä¸ç”¨äºä¾èµ–çš„ç›® æ ‡.åœ¨èŒƒå›´è¯´æ˜ç¬¦ä¹‹å,æœ‰ä¸€ä¸ªç›¸å¯¹äºå½“å‰ CMakeLists.txt æ–‡ä»¶è·¯å¾„çš„æºæ–‡ä»¶åˆ—è¡¨.å¦‚æœéœ€è¦,å½“ å‰å¤„ç†çš„ CMakeLists txt æ–‡ä»¶çš„ä½ç½®å¯ä»¥é€šè¿‡ CMAKE_CURRENT_SOURCE_DIR å¾—åˆ°.</p> <p>æºç å¯ä»¥ç›´æ¥æ·»åŠ åˆ° add_executable,ä¹Ÿå¯ä»¥å•ç‹¬ä½¿ç”¨ target_sources,å°†å®ƒä»¬ä¸ target_sources ä¸€èµ·æ·»åŠ .é€šè¿‡ä½¿ç”¨ PRIVATEã€PUBLIC æˆ– INTERFACE,å¯ä»¥æ˜¾å¼åœ°å®šä¹‰åœ¨ä½• å¤„ä½¿ç”¨æºç .ä½†æ˜¯,<strong>æŒ‡å®š PRIVATE ä»¥å¤–çš„å†…å®¹åªå¯¹åº“ç›®æ ‡æœ‰æ„ä¹‰</strong>.</p> <h3 id=åˆ›å»ºåº“><a class=headerlink href=#åˆ›å»ºåº“ title=åˆ›å»ºåº“></a>åˆ›å»ºåº“</h3><figure class="highlight cmake"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br></pre><td class=code><pre><span class=line><span class=keyword>cmake_minimum_required</span>(VERSION <span class=number>3.21</span>)</span><br><span class=line><span class=keyword>project</span>(</span><br><span class=line>ch3.hello_lib</span><br><span class=line>VERSION <span class=number>1.0</span></span><br><span class=line>DESCRIPTION</span><br><span class=line><span class=string>"A simple C++ project to demonstrate creating executables</span></span><br><span class=line><span class=string>and libraries in CMake"</span></span><br><span class=line>LANGUAGES CXX)</span><br><span class=line><span class=keyword>add_library</span>(hello)</span><br><span class=line><span class=keyword>target_sources</span>(</span><br><span class=line>hello</span><br><span class=line>PRIVATE src/hello.cpp src/internal.cpp)</span><br><span class=line><span class=keyword>target_compile_features</span>(hello PUBLIC cxx_std_17)</span><br><span class=line><span class=keyword>target_include_directories</span>(</span><br><span class=line>hello</span><br><span class=line>PRIVATE src/hello</span><br><span class=line>PUBLIC <span class=keyword>include</span>)</span><br></pre></table></figure> <p>æºæ–‡ä»¶ä½¿ç”¨ PRIVATE æ·»åŠ ,PRIVATE å’Œ PUBLIC å…³é”®å­—æŒ‡å®šåœ¨ä½•å¤„ä½¿ç”¨æºä»£ç è¿›è¡Œç¼–è¯‘.PRIVATE æŒ‡å®šçš„æºæ–‡ä»¶å°†åªåœ¨ç›®æ ‡ hello ä¸­ä½¿ç”¨</p> <p>è‹¥ä½¿ç”¨ PUBLIC,é‚£ä¹ˆæºæ–‡ä»¶ä¹Ÿä¼šå°†é™„åŠ åˆ° hello å’Œä¾èµ– hello çš„ç›®æ ‡ä¸Š,è¿™é€šå¸¸ä¸æ˜¯æƒ³è¦çš„ç»“æœ.</p> <p><strong>INTERFACE å…³é”®å­—è¯´æ˜æºæ–‡ä»¶ä¸ä¼šæ·»åŠ åˆ° hello ç›®æ ‡ä¸­,è€Œæ˜¯ä¼šæ·»åŠ åˆ°ä¾èµ–åˆ° hello çš„ç›®æ ‡ä¸Š</strong>.</p> <p>é€šå¸¸,ä¸ºç›®æ ‡æŒ‡å®šä¸º PRIVATE çš„å†…å®¹éƒ½å¯ä»¥è§†ä¸ºæ„å»ºéœ€æ±‚.æœ€å,åŒ…å«ç›®å½•ä½¿ç”¨ target_include_directories è®¾ç½®.è¯¥æŒ‡ä»¤æŒ‡å®šçš„æ–‡ä»¶å¤¹å†…çš„æ‰€æœ‰æ–‡ä»¶éƒ½å¯ä»¥ä½¿ç”¨ #include (å¸¦å°–æ‹¬å·) æ¥è®¿é—®</p> <h3 id=å‘½ååº“><a class=headerlink href=#å‘½ååº“ title=å‘½ååº“></a>å‘½ååº“</h3><p>å½“ä½¿ç”¨ add_library() åˆ›å»ºåº“æ—¶,åº“åç§°åœ¨é¡¹ç›®ä¸­å¿…é¡»å…¨å±€å”¯ä¸€.é»˜è®¤æƒ…å†µä¸‹,åº“ çš„å®é™…æ–‡ä»¶åæ˜¯æ ¹æ®å¹³å°ä¸Šçš„çº¦å®šæ„é€ çš„,ä¾‹å¦‚ lib.åœ¨ Linux ä¸Šä¸º .a,åœ¨ Windows ä¸Šä¸º < åç§° >.lib.é€šè¿‡è®¾ç½®ç›®æ ‡çš„ OUTPUT_NAME å±æ€§,å¯ä»¥æ›´æ”¹æ–‡ä»¶çš„åç§°</p> <p>åŠ¨æ€åº“çš„å¸¸ç”¨å‘½åçº¦å®šæ˜¯åœ¨æ–‡ä»¶åä¸­æ·»åŠ ç‰ˆæœ¬ä»¥æŒ‡å®šæ„å»ºç‰ˆæœ¬å’Œ API ç‰ˆæœ¬,é€šè¿‡æŒ‡å®š VERSION å’Œ SOVERSION å±æ€§,CMake å°†åœ¨æ„å»ºå’Œå®‰è£…åº“æ—¶åˆ›å»ºå¿…è¦çš„æ–‡ä»¶åå’Œç¬¦å·é“¾æ¥</p> <p>é¡¹ç›®ä¸­ç»å¸¸çœ‹åˆ°çš„å¦ä¸€ç§çº¦å®š,æ˜¯ä¸ºå„ç§æ„å»ºé…ç½®çš„æ–‡ä»¶åæ·»åŠ ä¸åŒçš„åç¼€.CMake é€šè¿‡è®¾ ç½® CMAKE__POSTFIX å…¨å±€å˜é‡æˆ–æ·»åŠ  _POSTFIX å±æ€§æ¥å¤„ç†è¿™ä¸ªé—®é¢˜.è‹¥ è®¾ç½®äº†æ­¤å˜é‡,åç¼€å°†è‡ªåŠ¨æ·»åŠ åˆ°éå¯æ‰§è¡Œç›®æ ‡.</p> <figure class="highlight sh"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br></pre><td class=code><pre><span class=line>add_library(ch3_hello)</span><br><span class=line>set_target_properties(</span><br><span class=line>ch3_hello</span><br><span class=line>PROPERTIES OUTPUT_NAME hello</span><br><span class=line>)</span><br><span class=line>set_target_properties(</span><br><span class=line>hello</span><br><span class=line>PROPERTIES VERSION <span class=variable>${PROJECT_VERSION}</span> <span class=comment># Contains 1.2.3</span></span><br><span class=line>SOVERSION <span class=variable>${PROJECT_VERSION_MAJOR}</span> <span class=comment># Contains only 1</span></span><br><span class=line>)</span><br><span class=line></span><br><span class=line>set_target_properties(</span><br><span class=line>hello</span><br><span class=line>PROPERTIES DEBUG_POSTFIX d)</span><br><span class=line></span><br><span class=line>set_target_properties(</span><br><span class=line>hello</span><br><span class=line>PROPERTIES DEBUG_POSTFIX d)</span><br></pre></table></figure> <p>è¿™å°†ä½¿åº“æ–‡ä»¶å’Œç¬¦å·é“¾æ¥å‘½åä¸º libhellod</p> <h3 id=åŠ¨æ€åº“çš„ç¬¦å·å¯è§æ€§><a class=headerlink href=#åŠ¨æ€åº“çš„ç¬¦å·å¯è§æ€§ title=åŠ¨æ€åº“çš„ç¬¦å·å¯è§æ€§></a>åŠ¨æ€åº“çš„ç¬¦å·å¯è§æ€§</h3><p>è¦é“¾æ¥åˆ°åŠ¨æ€åº“,é“¾æ¥å™¨å¿…é¡»çŸ¥é“å“ªäº›ç¬¦å·å¯ä»¥ä»åº“å¤–éƒ¨ä½¿ç”¨.è¿™äº›ç¬¦å·å¯ä»¥æ˜¯ç±»ã€å‡½æ•°ã€ç±» å‹ç­‰,ä½¿å®ƒä»¬å¯è§çš„è¿‡ç¨‹ç§°ä¸ºå¯¼å‡º.</p> <p>æŒ‡å®šç¬¦å·å¯è§æ€§æ—¶,ç¼–è¯‘å™¨æœ‰ä¸åŒçš„æ–¹å¼å’Œé»˜è®¤è¡Œä¸º,è¿™ä½¿å¾—ä»¥ç‹¬ç«‹äºå¹³å°çš„æ–¹å¼ æŒ‡å®šç¬¦å·å¯è§æ€§æœ‰ç‚¹éº»çƒ¦.</p> <p>ä»é»˜è®¤çš„ç¼–è¯‘å™¨å¯è§æ€§å¼€å§‹Í¾g<strong>cc å’Œ clang å‡è®¾æ‰€æœ‰çš„ç¬¦å·éƒ½ æ˜¯å¯è§çš„</strong>,è€Œ <strong>Visual Studio ç¼–è¯‘å™¨é»˜è®¤æƒ…å†µä¸‹ä¼šéšè—æ‰€æœ‰çš„ç¬¦å·,é™¤éæ˜¾å¼å¯¼å‡º</strong>.</p> <p>è®¾ç½® CMAKE_WINDOWS_EXPORT_ALL_SYMBOLS,å¯ä»¥æ”¹å˜ MSVC çš„é»˜è®¤è¡Œä¸º,è¿™æ˜¯ä¸€ç§æš´åŠ›çš„ è§£å†³æ–¹æ³•,åªæœ‰å½“åº“çš„æ‰€æœ‰ç¬¦å·éƒ½åº”è¯¥å¯¼å‡ºæ—¶æ‰èƒ½ä½¿ç”¨</p> <h3 id=æ›´æ”¹é»˜è®¤å¯è§æ€§><a class=headerlink href=#æ›´æ”¹é»˜è®¤å¯è§æ€§ title=æ›´æ”¹é»˜è®¤å¯è§æ€§></a>æ›´æ”¹é»˜è®¤å¯è§æ€§</h3><p>æš´éœ²åº“çš„å†…éƒ¨ç¬¦å·ä¼šæš´éœ²æœ¬åº”éšè—çš„ä¸œè¥¿,æ‰€ä»¥è®¾ç½®åŠ¨æ€åº“æ—¶æœ€å¥½æ›´æ”¹é»˜è®¤å¯è§æ€§å¹¶æš´éœ²éœ€è¦çš„ç±»ã€å‡½æ•°.</p> <p>è¦æ›´æ”¹ç¬¦å·çš„é»˜è®¤å¯è§æ€§,è¯·å°† _VISIBILITY_PRESET å±æ€§è®¾ç½®ä¸º HIDDEN.æ­¤ å±æ€§å¯ä»¥å…¨å±€è®¾ç½®,ä¹Ÿå¯ä»¥é’ˆå¯¹å•ä¸ªåº“ç›®æ ‡è®¾ç½®. ä¼šæ›¿æ¢ä¸ºç¼–å†™åº“çš„è¯­è¨€,ä¾‹å¦‚ï¼šCXX æ›¿ æ¢ä¸º C++,C æ›¿æ¢ä¸º C.</p> <p>è‹¥æ‰€æœ‰è¦å¯¼å‡ºçš„ç¬¦å·éƒ½æ˜¯éšè—ç¬¦å·,å¿…é¡»åœ¨ä»£ç ä¸­ç‰¹åˆ«æ ‡è®°.æœ€å¸¸è§çš„æ–¹æ³•æ˜¯æŒ‡å®šä¸€ä¸ªé¢„å¤„ç†å™¨å®šä¹‰æ¥ç¡®å®šä¸€ä¸ªç¬¦å·æ˜¯å¦å¯è§</p> <p>CMake æä¾›äº† generate_export_header å®,ç”± GenerateExportHeader æ¨¡å—å¯¼å…¥.ä¸‹é¢çš„ä¾‹å­ä¸­,hello åº“çš„ç¬¦å·é»˜è®¤è®¾ç½®ä¸ºéšè—.ç„¶å,é€šè¿‡ä½¿ç”¨ generate_export_header å®å†æ¬¡å•ç‹¬å¯ç”¨.å¦å¤–,æœ¬ä¾‹å°† VISIBILITY_INLINES_HIDDEN å±æ€§è®¾ç½®ä¸º TRUE,é€šè¿‡éšè—å†…è” ç±»æˆå‘˜å‡½æ•°è¿›ä¸€æ­¥å‡å°‘å¯¼å‡ºçš„ç¬¦å·è¡¨</p> <figure class="highlight cmake"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br></pre><td class=code><pre><span class=line><span class=keyword>add_library</span>(hello SHARED)</span><br><span class=line><span class=keyword>set_property</span>(<span class=keyword>TARGET</span> hello PROPERTY CXX_VISIBILITY_PRESET <span class=string>"hidden"</span>)</span><br><span class=line><span class=keyword>set_property</span>(<span class=keyword>TARGET</span> hello PROPERTY VISIBILITY_INLINES_HIDDEN <span class=keyword>TRUE</span>)</span><br><span class=line><span class=keyword>include</span>(GenerateExportHeader)</span><br><span class=line>generate_export_header(hello EXPORT_FILE_NAME <span class=keyword>export</span>/hello/ export_hello.hpp)</span><br><span class=line><span class=keyword>target_include_directories</span>(hello PUBLIC <span class=string>"${CMAKE_CURRENT_BINARY_DIR}/export"</span>)</span><br></pre></table></figure> <h3 id=æ¥å£å’Œçº¯å¤´æ–‡ä»¶åº“><a class=headerlink href=#æ¥å£å’Œçº¯å¤´æ–‡ä»¶åº“ title=æ¥å£å’Œçº¯å¤´æ–‡ä»¶åº“></a>æ¥å£å’Œçº¯å¤´æ–‡ä»¶åº“</h3><p>çº¯å¤´æ–‡ä»¶çš„åº“æœ‰ç‚¹ç‰¹æ®Š,å› ä¸ºä¸éœ€è¦ç¼–è¯‘Í¾ ç›¸å,å¯ä»¥å¯¼å‡ºå®ƒä»¬çš„å¤´æ–‡ä»¶,ä»¥ä¾¿ç›´æ¥åŒ…å«åœ¨å…¶ ä»–åº“ä¸­.</p> <p>å¤§å¤šæ•°æƒ…å†µä¸‹,å¤´æ–‡ä»¶åº“çš„å·¥ä½œæ–¹å¼ä¸æ™®é€šåº“ç±»ä¼¼,ä½†æ˜¯å¤´æ–‡ä»¶ä½¿ç”¨ INTERFACE,è€Œé PUBLIC.</p> <p>ç”±äºä»…åŒ…å«å¤´æ–‡ä»¶çš„åº“ä¸éœ€è¦ç¼–è¯‘,å› æ­¤ä¸ä¼šå‘ç›®æ ‡æ·»åŠ æºæ–‡ä»¶.</p> <figure class="highlight cmake"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br></pre><td class=code><pre><span class=line><span class=keyword>project</span>(</span><br><span class=line>ch3_hello_header_only</span><br><span class=line>VERSION <span class=number>1.0</span></span><br><span class=line>DESCRIPTION <span class=string>"Chapter 3 header-only example"</span></span><br><span class=line>LANGUAGES CXX)</span><br><span class=line><span class=keyword>add_library</span>(hello_header_only INTERFACE)</span><br><span class=line><span class=keyword>target_include_directories</span>(hello_header_only INTERFACE <span class=keyword>include</span>/)</span><br><span class=line><span class=keyword>target_compile_features</span>(hello_header_only INTERFACE cxx_std_17)</span><br></pre></table></figure> <h3 id=å¯¹è±¡åº“><a class=headerlink href=#å¯¹è±¡åº“ title=å¯¹è±¡åº“></a>å¯¹è±¡åº“</h3><p>æœ‰æ—¶,å¯èƒ½æƒ³è¦<strong>åˆ†ç¦»ä»£ç ,ä»¥ä¾¿éƒ¨åˆ†ä»£ç å¯ä»¥é‡ç”¨</strong>,è€Œä¸éœ€è¦åˆ›å»ºå®Œæ•´çš„åº“.å½“æƒ³åœ¨å¯æ‰§è¡Œæµ‹ è¯•å’Œå•å…ƒæµ‹è¯•ä¸­ä½¿ç”¨æŸäº›ä»£ç æ—¶,é€šå¸¸çš„åšæ³•æ˜¯ä¸éœ€è¦é‡æ–°ç¼–è¯‘æ‰€æœ‰ä»£ç ä¸¤æ¬¡.ä¸ºæ­¤,CMake æ ä¾›äº†å¯¹è±¡åº“,å…¶ä¸­çš„æºä»£ç æ˜¯ç¼–è¯‘çš„,ä½†ä¸è¿›è¡Œå½’æ¡£æˆ–é“¾æ¥.é€šè¿‡ <code>add_library(MyLibrary object)</code> åˆ›å»ºå¯¹è±¡åº“.</p> <p>è‡ª CMake 3.12 èµ·, è¿™ äº› å¯¹ è±¡ å¯ ä»¥ åƒ æ™® é€š åº“ ä¸€ æ · ä½¿ ç”¨, åª éœ€ å°† å®ƒ ä»¬ æ·» åŠ  åˆ° target_link_libraries å‡½æ•°ä¸­.3.12 ç‰ˆæœ¬ä¹‹å‰,å¯¹è±¡åº“éœ€è¦æ·»åŠ ç”Ÿæˆå™¨è¡¨è¾¾å¼,ä¹Ÿå°± æ˜¯ $.è¿™å°†åœ¨ç”Ÿæˆæ„å»ºç³»ç»ŸæœŸé—´æ‰©å±•ä¸ºä¸€ä¸ªå¯¹è±¡åˆ—è¡¨.è¿™ç§æ–¹å¼ç° åœ¨è¿˜å¯ä»¥ç”¨,ä½†ä¸æ¨èè¿™æ ·åš,å› ä¸ºè¿™å¾ˆå¿«å°±å˜å¾—ä¸å¯ç»´æŠ¤,ç‰¹åˆ«æ˜¯åœ¨ä¸€ä¸ªé¡¹ç›®ä¸­æœ‰å¤šä¸ªå¯¹è±¡åº“çš„ æƒ…å†µä¸‹.</p> <h3 id=ä½¿ç”¨åº“><a class=headerlink href=#ä½¿ç”¨åº“ title=ä½¿ç”¨åº“></a>ä½¿ç”¨åº“</h3><p>å¯ ä»¥ æŠŠ add_library æ”¾ åœ¨ åŒ ä¸€ ä¸ª CMakeLists.txt æ–‡ ä»¶ ä¸­, æˆ– è€… ä½¿ ç”¨ add_subdirectory å°†å…¶æ•´åˆèµ·æ¥.ä¸¤è€…éƒ½æ˜¯æœ‰æ•ˆçš„é€‰é¡¹,å¹¶å–å†³äºé¡¹ç›®çš„è®¾ç½®æ–¹å¼</p> <figure class="highlight cmake"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br></pre><td class=code><pre><span class=line><span class=keyword>add_subdirectory</span>(hello_lib)</span><br><span class=line><span class=keyword>add_subdirectory</span>(hello_header_only)</span><br><span class=line><span class=keyword>add_subdirectory</span>(hello_object)</span><br><span class=line><span class=keyword>add_executable</span>(chapter3)</span><br><span class=line><span class=keyword>target_sources</span>(chapter3 PRIVATE src/main.cpp)</span><br><span class=line><span class=keyword>target_link_libraries</span>(chapter3 PRIVATE hello_header_only hello</span><br><span class=line>hello_object)</span><br></pre></table></figure> <p>target_link_libraries çš„ç›®æ ‡ä¹Ÿå¯ä»¥æ˜¯å¦ä¸€ä¸ªåº“.åŒæ ·,åº“çš„é“¾æ¥è¯´æ˜ç¬¦,å¯ä»¥æ˜¯ä»¥ä¸‹ ä»»æ„ä¸€ä¸ª:</p> <p>â€¢ PRIVATE: ç”¨äºé“¾æ¥åº“,ä½†ä¸æ˜¯å…¬å…±æ¥å£çš„ä¸€éƒ¨åˆ†.åªæœ‰åœ¨æ„å»ºç›®æ ‡æ—¶æ‰éœ€è¦é“¾æ¥åº“.</p> <p>â€¢ INTERFACE: æ²¡æœ‰é“¾æ¥åˆ°åº“,ä½†æ˜¯å…¬å…±æ¥å£çš„ä¸€éƒ¨åˆ†.å½“åœ¨å…¶ä»–åœ°æ–¹ä½¿ç”¨ç›®æ ‡æ—¶,é“¾æ¥åº“æ˜¯å¿…éœ€çš„.è¿™é€šå¸¸ä»…é™å¤´æ–‡ä»¶åº“æ—¶ä½¿ç”¨.</p> <p>â€¢ PUBLIC: é“¾æ¥åˆ°åº“,æ˜¯å…¬å…±æ¥å£çš„ä¸€éƒ¨åˆ†.å› æ­¤,è¯¥åº“æ—¢æ˜¯æ„å»ºä¾èµ–é¡¹,ä¹Ÿæ˜¯ä½¿ç”¨ä¾èµ–é¡¹.</p> <h3 id=è®¾ç½®ç¼–è¯‘å™¨å’Œé“¾æ¥å™¨é€‰é¡¹><a class=headerlink href=#è®¾ç½®ç¼–è¯‘å™¨å’Œé“¾æ¥å™¨é€‰é¡¹ title=è®¾ç½®ç¼–è¯‘å™¨å’Œé“¾æ¥å™¨é€‰é¡¹></a>è®¾ç½®ç¼–è¯‘å™¨å’Œé“¾æ¥å™¨é€‰é¡¹</h3><p>C++ ç¼–è¯‘å™¨æœ‰å¾ˆå¤šé€‰é¡¹æ¥è®¾ç½®ä¸€äº›å¸¸è§çš„æ ‡å¿—,ä»å¤–éƒ¨è®¾ç½®é¢„å¤„ç†å™¨å®šä¹‰ä¹Ÿæ˜¯ä¸€ç§å¸¸è§çš„åš æ³•.CMake ä¸­,è¿™äº›æ˜¯ä½¿ç”¨ target_compile_options ä¼ é€’,ä½¿ç”¨ target_link_options æ›´æ”¹é“¾æ¥å™¨è¡Œä¸º,ä½†ç¼–è¯‘å™¨å’Œé“¾æ¥å™¨å¯èƒ½æœ‰ä¸åŒçš„è®¾ç½®æ ‡å¿—çš„æ–¹æ³•.ä¾‹å¦‚,åœ¨ GCC å’Œ Clang ä¸­,é€‰ é¡¹ç”¨å‡å· (-) ä¼ é€’,è€Œ Microsoft ç¼–è¯‘å™¨å°†æ–œæ  (/) ä½œä¸ºé€‰é¡¹çš„å‰ç¼€.ä½†æ˜¯<strong>é€šè¿‡ç”Ÿæˆå™¨è¡¨è¾¾å¼,å¯ä»¥å¾ˆå®¹æ˜“åœ°åœ¨ CMake ä¸­å¤„ç†è¿™ä¸ªé—®é¢˜</strong>:</p> <figure class="highlight cmake"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br></pre><td class=code><pre><span class=line><span class=keyword>target_link_options</span>(</span><br><span class=line>hello</span><br><span class=line>PRIVATE $<$&LTCXX_COMPILER_ID:MSVC>:/SomeOption></span><br><span class=line>$<$&LTCXX_COMPILER_ID:GNU,Clang,AppleClang>:-</span><br><span class=line>someOption></span><br><span class=line>)</span><br></pre></table></figure> <p>$<a href=$:/SomeOption>$:/SomeOption</a> æ˜¯ ä¸€ ä¸ª åµŒ å¥— çš„ ç”Ÿ æˆ å™¨ è¡¨ è¾¾ å¼, ç”± å†… è€Œ å¤– æ±‚ å€¼. ç”Ÿ æˆ å™¨ è¡¨ è¾¾ å¼ åœ¨ ç”Ÿ æˆ é˜¶ æ®µ è¿› è¡Œ è®¡ ç®—.</p> <p>é¦– å…ˆ, å½“ C++ ç¼– è¯‘ å™¨ ç­‰ äº MSVC æ—¶ä¸º true.è‹¥æ˜¯è¿™ç§æƒ…å†µ,é‚£ä¹ˆå¤–éƒ¨è¡¨è¾¾å¼å°†è¿”å›/SomeOption, ç„¶åä¼ é€’ç»™ç¼–è¯‘å™¨.è‹¥å†…éƒ¨è¡¨è¾¾å¼çš„è®¡ç®—ç»“æœä¸º false,åˆ™ä¸ä¼ é€’. $<$:-fopenmp> çš„å·¥ä½œåŸç†ç±»ä¼¼,ä½†ä¸æ˜¯åªæ£€æŸ¥ å•ä¸ªå€¼,è€Œæ˜¯ä¼ é€’ä¸€ä¸ªåŒ…å« GNU,Clang,AppleClang çš„åˆ—è¡¨.è‹¥ CXX_COMPILER_ID åŒ¹é…å…¶ä¸­ ä»»ä½•ä¸€ä¸ª,å†…éƒ¨è¡¨è¾¾å¼è®¡ç®—ä¸º true,someOption ä¼šä¼ é€’ç»™ç¼–è¯‘å™¨. å°†ç¼–è¯‘å™¨æˆ–é“¾æ¥å™¨é€‰é¡¹ä¼ é€’ä¸º PRIVATE,å°†å…¶æ ‡è®°ä¸ºä¸åº“æ¥å£ä¸éœ€è¦çš„æ­¤ç›®æ ‡çš„æ„å»ºéœ€æ±‚.</p> <p>è‹¥ ä½¿ç”¨ PUBLIC,é‚£ä¹ˆç¼–è¯‘é€‰é¡¹ä¹Ÿæˆä¸ºæ„å»ºéœ€æ±‚,æ‰€æœ‰ä¾èµ–äºåŸå§‹ç›®æ ‡çš„ç›®æ ‡å°†ä½¿ç”¨ç›¸åŒçš„ç¼–è¯‘é€‰é¡¹. å°†ç¼–è¯‘å™¨é€‰é¡¹æš´éœ²ç»™ä¾èµ–çš„ç›®æ ‡æ˜¯éœ€è¦è°¨æ…åšçš„äº‹æƒ….</p> <p>è‹¥ç¼–è¯‘å™¨é€‰é¡¹åªç”¨äºä½¿ç”¨ç›®æ ‡è€Œä¸ç”¨äºæ„å»ºç›®æ ‡,åˆ™å¯ä»¥ä½¿ç”¨å…³é”®å­— INTERFACE.åœ¨æ„å»ºçº¯å¤´æ–‡ä»¶åº“æ—¶,è¿™æ˜¯æœ€å¸¸è§çš„æƒ…å†µ. ç¼– è¯‘ å™¨ é€‰ é¡¹ çš„ ç‰¹ æ®Š æƒ… å†µ æ˜¯ ç¼– è¯‘ å®š ä¹‰, å…¶ ä¼š ä¼  é€’ ç»™ åº• å±‚ ç¨‹ åº. è¿™ é€š è¿‡ target_compile_definitions è¿›è¡Œä¼ é€’.</p> <h3 id=è°ƒè¯•ç¼–è¯‘å™¨é€‰é¡¹><a class=headerlink href=#è°ƒè¯•ç¼–è¯‘å™¨é€‰é¡¹ title=è°ƒè¯•ç¼–è¯‘å™¨é€‰é¡¹></a>è°ƒè¯•ç¼–è¯‘å™¨é€‰é¡¹</h3><p>è¦æŸ¥çœ‹æ‰€æœ‰ç¼–è¯‘é€‰é¡¹,å¯ä»¥æŸ¥çœ‹ç”Ÿæˆçš„æ„å»ºæ–‡ä»¶,ä¾‹å¦‚ Makefiles æˆ– Visual Studio é¡¹ç›®.æ›´æ–¹ä¾¿ çš„æ–¹æ³•æ˜¯è®© CMake å°†æ‰€æœ‰ç¼–è¯‘å‘½ä»¤å¯¼å‡ºä¸º JSON. é€š è¿‡ ä½¿ ç”¨ CMAKE_EXPORT_COMPILE_COMMANDS, å°† ç”Ÿ æˆ ä¸€ ä¸ª å ä¸º compile_commands.json çš„æ–‡ä»¶,å…¶åŒ…å«ç”¨äºç¼–è¯‘çš„å®Œæ•´å‘½ä»¤.</p> <h3 id=åº“åˆ«å><a class=headerlink href=#åº“åˆ«å title=åº“åˆ«å></a>åº“åˆ«å</h3><p>åº“åˆ«åæ˜¯åœ¨ä¸åˆ›å»ºæ–°çš„æ„å»ºç›®æ ‡çš„æƒ…å†µä¸‹å¼•ç”¨åº“çš„ä¸€ç§æ–¹æ³•,æœ‰æ—¶ç§°ä¸ºå‘½åç©ºé—´.å¸¸è§çš„æ¨¡å¼ æ˜¯ä¸ºä»é¡¹ç›®ä¸­å®‰è£…çš„æ¯ä¸ªåº“ä»¥ MyProject::library çš„å½¢å¼åˆ›å»ºä¸€ä¸ªåº“åˆ«å,å¯ä»¥ç”¨äºå¯¹å¤šä¸ªç›®æ ‡è¿›è¡Œ è¯­ä¹‰åˆ†ç»„.æœ‰åŠ©äºé¿å…å‘½åæ–¹é¢çš„å†²çª,ç‰¹åˆ«æ˜¯å½“é¡¹ç›®åŒ…å«å…¬å…±ç›®æ ‡æ—¶,æ¯”å¦‚åä¸º utils çš„åº“ã€helper å’Œç±»ä¼¼çš„åº“.</p> <figure class="highlight cmake"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br></pre><td class=code><pre><span class=line><span class=keyword>add_library</span>(Chapter3::hello ALIAS hello)</span><br><span class=line>...</span><br><span class=line><span class=keyword>target_link_libraries</span>(SomeLibrary PRIVATE Chapter3::hello)</span><br></pre></table></figure> <h3 id=ä½¿ç”¨é¢„è®¾å€¼ç»´æŠ¤æ„å»ºé…ç½®><a class=headerlink href=#ä½¿ç”¨é¢„è®¾å€¼ç»´æŠ¤æ„å»ºé…ç½® title=ä½¿ç”¨é¢„è®¾å€¼ç»´æŠ¤æ„å»ºé…ç½®></a>ä½¿ç”¨é¢„è®¾å€¼ç»´æŠ¤æ„å»ºé…ç½®</h3><p>æ„å»ºä¿¡æ¯å¯ä»¥å­˜å‚¨åœ¨ CMakePresets.json æ–‡ä»¶ä¸­,æ”¾åœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸­.æ­¤å¤–,æ¯ä¸ªç”¨æˆ·éƒ½å¯ä»¥å°†ä»–ä»¬é…ç½®æ·»åŠ åˆ° CMakeUserPresets.json æ–‡ ä»¶ä¸­.åŸºæœ¬é¢„è®¾é€šå¸¸ç½®äºç‰ˆæœ¬æ§åˆ¶ä¹‹ä¸‹</p> <figure class="highlight json"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br></pre><td class=code><pre><span class=line>{</span><br><span class=line><span class=attr>"version"</span>: <span class=number>3</span>,</span><br><span class=line><span class=attr>"cmakeMinimumRequired"</span>: {</span><br><span class=line><span class=attr>"major"</span>: <span class=number>3</span>,</span><br><span class=line><span class=attr>"minor"</span>: <span class=number>21</span>,</span><br><span class=line><span class=attr>"patch"</span>: <span class=number>0</span></span><br><span class=line>},</span><br><span class=line><span class=attr>"configurePresets"</span>: [...],</span><br><span class=line><span class=attr>"buildPresets"</span>: [...],</span><br><span class=line><span class=attr>"testPresets"</span>: [...]</span><br><span class=line>}</span><br><span class=line></span><br></pre></table></figure> <p>è¦æŸ¥çœ‹é¡¹ç›®ä¸­é…ç½®äº†å“ªäº›é¢„è®¾å€¼,è¯·è¿è¡Œ cmake â€”list-presets æŸ¥çœ‹å¯ç”¨é¢„è®¾å€¼çš„åˆ—è¡¨. è¦ä½¿ç”¨é¢„è®¾è¿›è¡Œç”Ÿæˆ,è¯·æ‰§è¡Œ cmake â€”build â€”preset name</p> <h3 id=æ‰“åŒ…ã€éƒ¨ç½²å’Œå®‰è£…><a class=headerlink href=#æ‰“åŒ…ã€éƒ¨ç½²å’Œå®‰è£… title=æ‰“åŒ…ã€éƒ¨ç½²å’Œå®‰è£…></a>æ‰“åŒ…ã€éƒ¨ç½²å’Œå®‰è£…</h3><p>install() æŒ‡ä»¤ install(â€¦) æŒ‡ä»¤æ˜¯ä¸€ä¸ªå†…ç½®çš„ CMake å‘½ä»¤,å…è®¸ç”Ÿæˆç”¨äºå®‰è£…ç›®æ ‡ã€æ–‡ä»¶ã€ç›®å½•ç­‰çš„æ„å»ºç³»ç»Ÿè¯´æ˜.<strong>CMake ä¸ä¼šç”Ÿæˆå®‰è£…æŒ‡ä»¤,é™¤éæ˜ç¡®åœ°è¯´æ˜</strong>.å› æ­¤,å®‰è£…æ€»æ˜¯åœ¨å¼€å‘è€…çš„æ§åˆ¶ä¸­.</p> <p>è¦ä½¿ CMake ç›®æ ‡å¯å®‰è£…,å¿…é¡»ç”¨è‡³å°‘ä¸€ä¸ªå‚æ•°æŒ‡å®š TARGETS å‚æ•°.æŒ‡ä»¤çš„ç­¾åå¦‚ä¸‹æ‰€ç¤º:</p> <figure class="highlight cmake"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line><span class=keyword>install</span>(TARGETS ... [...])</span><br></pre></table></figure> <p>TARGETS å‚æ•°è¡¨ç¤º install å¯ä»¥æ¥å—ä¸€ç»„ CMake ç›®æ ‡,ä»¥ä¾¿ä¸ºå…¶ç”Ÿæˆå®‰è£…ä»£ç ,åªå®‰è£…ç›® æ ‡çš„è¾“å‡ºæ„ä»¶.æœ€å¸¸è§çš„ç›®æ ‡è¾“å‡ºå·¥ä»¶å®šä¹‰å¦‚ä¸‹:</p> <p>â€¢ ARCHIVE (é™æ€åº“ã€DLL å¯¼å…¥åº“å’Œé“¾æ¥å™¨å¯¼å…¥æ–‡ä»¶): â€“ é™¤äº†åœ¨ macOS ä¸­æ ‡è®°ä¸º FRAMEWORK çš„ç›®æ ‡</p> <p>â€¢ LIBRARY (åŠ¨æ€åº“): â€“ é™¤äº†åœ¨ macOS ä¸­æ ‡è®°ä¸º FRAMEWORK çš„ç›®æ ‡ â€“ é™¤äº† dll (Windows)</p> <p>â€¢ RUNTIME (å¯æ‰§è¡Œæ–‡ä»¶å’Œ dll): â€“ é™¤äº†åœ¨ macOS ä¸­æ ‡è®°ä¸º MACOSX_BUNDLE çš„ç›®æ ‡</p> <p>è¿™äº›ç›®å½•çš„é»˜è®¤å€¼ç”± CMake æä¾›,å…·ä½“å–å†³äºç›®æ ‡ç±» å‹.æä¾›é»˜è®¤å®‰è£…è·¯å¾„ä¿¡æ¯çš„ CMake æ¨¡å—ç§°ä¸º GNUInstallDirs æ¨¡å—.GNUInstallDirs æ¨¡å—å®šä¹‰äº†å„ ç§ CMAKE<em>INSTALL</em>çš„è·¯å¾„.é»˜è®¤å®‰è£…ç›®å½•å¦‚ä¸‹è¡¨æ‰€ç¤º:</p> <p><img alt=image-20240723111850609 data-src=https://s2.loli.net/2024/07/23/T2xNuyIMd9ZaPRH.png></p> <p>è¦†ç›–å†…ç½®é»˜è®¤å€¼,åœ¨ install(â€¦) æŒ‡ä»¤ä¸­éœ€è¦ä½¿ç”¨ DESTINATION å‚æ•°.</p> <figure class="highlight cmake"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br></pre><td class=code><pre><span class=line><span class=keyword>install</span>(TARGETS ch4_ex01_executable</span><br><span class=line>RUNTIME DESTINATION qbin</span><br><span class=line>)</span><br></pre></table></figure> <figure class="highlight cmake"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br></pre><td class=code><pre><span class=line><span class=keyword>add_library</span>(ch4_ex02_static STATIC)</span><br><span class=line><span class=keyword>target_sources</span>(ch4_ex02_static PRIVATE src/lib.cpp)</span><br><span class=line><span class=keyword>target_include_directories</span>(ch4_ex02_static PUBLIC <span class=keyword>include</span>)</span><br><span class=line><span class=keyword>target_compile_features</span>(ch4_ex02_static PRIVATE cxx_std_11)</span><br><span class=line><span class=keyword>include</span>(GNUInstallDirs) <span class=comment># å¼•å…¥æ¨¡å—ä½¿å¾—ä¿®æ”¹é»˜è®¤å®‰è£…ä½ç½®</span></span><br><span class=line><span class=keyword>install</span>(TARGETS ch4_ex02_static)</span><br><span class=line><span class=keyword>install</span> (</span><br><span class=line>DIRECTORY <span class=keyword>include</span>/</span><br><span class=line>DESTINATION <span class=string>"${CMAKE_INSTALL_INCLUDEDIR}"</span></span><br><span class=line>)</span><br></pre></table></figure> <p><strong>å¤šä¸€ä¸ª DIRECTORY å‚æ•°,è¿™æ˜¯ä½¿é™æ€åº“çš„å¤´æ–‡ ä»¶å¯å®‰è£…</strong>.è¿™æ ·åšçš„åŸå› æ˜¯ CMake ä¸ä¼šå®‰è£…ä»»ä½•éè¾“å‡ºå·¥ä»¶,è€Œ STATIC åº“ç›®æ ‡åªç”Ÿæˆä¸€ä¸ªäºŒè¿›åˆ¶ æ–‡ä»¶ä½œä¸ºè¾“å‡ºå·¥ä»¶.å¤´æ–‡ä»¶ä¸æ˜¯è¾“å‡ºå·¥ä»¶,åº”è¯¥å•ç‹¬å®‰è£…</p> <h4 id=å®‰è£…æ–‡ä»¶><a class=headerlink href=#å®‰è£…æ–‡ä»¶ title=å®‰è£…æ–‡ä»¶></a>å®‰è£…æ–‡ä»¶</h4><p>å®‰è£…çš„ä¸œè¥¿å¹¶ä¸æ€»æ˜¯ç›®æ ‡è¾“å‡ºæ„ä»¶çš„ä¸€éƒ¨åˆ†.å®ƒä»¬å¯èƒ½æ˜¯ç›®æ ‡çš„è¿è¡Œæ—¶ä¾èµ–é¡¹,ä¾‹å¦‚å›¾ç‰‡ã€æºæ–‡ä»¶ã€è„šæœ¬å’Œé…ç½®æ–‡ä»¶</p> <p>install(FILESâ€¦) æŒ‡ä»¤æ¥å—ä¸€ä¸ªæˆ–å¤šä¸ªæ–‡ä»¶ä½œä¸ºå‚æ•°,è¿˜éœ€è¦ TYPE æˆ– DESTINATION å‚ æ•°,è¿™ä¸¤ä¸ªå‚æ•°ç”¨äºç¡®å®šæŒ‡å®šæ–‡ä»¶çš„ç›®æ ‡ç›®å½•.</p> <p>TYPE ç”¨äºæŒ‡ç¤ºå“ªäº›æ–‡ä»¶å°†ä½¿ç”¨è¯¥æ–‡ä»¶ç±»å‹çš„é»˜è®¤è·¯å¾„ä½œä¸ºå®‰è£…ç›®å½•,å¯ä»¥é€šè¿‡è®¾ç½®ç›¸å…³çš„ GNUInstallDirs å˜é‡æ¥é‡å†™é»˜è®¤å€¼</p> <p><img alt=image-20240724193228436 data-src=https://s2.loli.net/2024/07/24/2dorRDC4hYVsbj7.png></p> <figure class="highlight cmake"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br></pre><td class=code><pre><span class=line><span class=keyword>install</span>(FILES <span class=string>"${CMAKE_CURRENT_LIST_DIR}/chapter4_greeter_content"</span></span><br><span class=line>DESTINATION <span class=string>"${CMAKE_INSTALL_BINDIR}"</span>)</span><br><span class=line><span class=keyword>install</span>(PROGRAMS <span class=string>"${CMAKE_CURRENT_LIST_DIR}/chapter4_greeter.py"</span></span><br><span class=line>DESTINATION <span class=string>"${CMAKE_INSTALL_BINDIR}"</span> RENAME chapter4_greeter)</span><br><span class=line></span><br></pre></table></figure> <h4 id=å®‰è£…ç›®å½•><a class=headerlink href=#å®‰è£…ç›®å½• title=å®‰è£…ç›®å½•></a>å®‰è£…ç›®å½•</h4><p>install(DIRECTORYâ€¦) æŒ‡ä»¤ç”¨äºå®‰è£…ç›®å½•,ç›®å½•çš„ç»“æ„å°†æŒ‰åŸæ ·å¤åˆ¶åˆ°ç›®æ ‡.ç›®å½•æ—¢å¯ä»¥ ä½œä¸ºä¸€ä¸ªæ•´ä½“å®‰è£…,ä¹Ÿå¯ä»¥æœ‰é€‰æ‹©åœ°å®‰è£….</p> <figure class="highlight cmake"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line><span class=keyword>install</span>(DIRECTORY dir1 dir2 dir3 TYPE LOCALSTATE)</span><br></pre></table></figure> <figure class="highlight cmake"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br></pre><td class=code><pre><span class=line><span class=keyword>include</span>(GNUInstallDirs)</span><br><span class=line><span class=keyword>install</span>(DIRECTORY dir1 DESTINATION <span class=variable>${CMAKE_INSTALL_</span></span><br><span class=line><span class=variable>LOCALSTATEDIR}</span> FILES_MATCHING PATTERN <span class=string>"*.x"</span>)</span><br><span class=line><span class=keyword>install</span>(DIRECTORY dir2 DESTINATION <span class=variable>${CMAKE_INSTALL_</span></span><br><span class=line><span class=variable>LOCALSTATEDIR}</span> FILES_MATCHING PATTERN <span class=string>"*.hpp"</span></span><br><span class=line>EXCLUDE PATTERN <span class=string>"*"</span>)</span><br><span class=line><span class=keyword>install</span>(DIRECTORY dir3 DESTINATION <span class=variable>${CMAKE_INSTALL_</span></span><br><span class=line><span class=variable>LOCALSTATEDIR}</span> PATTERN <span class=string>"bin"</span> EXCLUDE)</span><br></pre></table></figure> <p><strong>DESTINATION</strong> è¿™ä¸ªå‚æ•°å…è®¸ install(â€¦) æŒ‡å®šå®‰è£…ç›®å½•,ç›®å½•å¯ä»¥æ˜¯ç›¸å¯¹è·¯å¾„,ä¹Ÿå¯ä»¥æ˜¯ç»å¯¹è·¯å¾„.ç›¸å¯¹è·¯å¾„æ˜¯ç›¸å¯¹äº CMAKE_INSTALL_PREFIX çš„,å»ºè®®ä½¿ç”¨ç›¸å¯¹è·¯å¾„ä½¿å®‰è£…å¯é‡å®šä½.</p> <p>å¦å¤–,ä½¿ç”¨ç›¸å¯¹è·¯å¾„è¿›è¡Œæ‰“åŒ…ä¹Ÿå¾ˆé‡è¦,å› ä¸º cpack è¦æ±‚å®‰è£…è·¯å¾„æ˜¯ç›¸å¯¹è·¯å¾„.æœ€å¥½ä½¿ç”¨ä»¥ç›¸å…³ GNUInstallDirs å˜é‡å¼€å§‹çš„è·¯å¾„,ä»¥ä¾¿åŒ…ç»´æŠ¤äººå‘˜åœ¨éœ€è¦æ—¶è¦†ç›–å®‰è£…ç›®æ ‡.</p> <p>DESTINATION å‚æ•°å¯ä»¥ä¸ TARGETS, FILES,IMPORTED_RUNTIME_ARTIFACTS,EXPORT å’Œ DIRECTORY å®‰è£…ç±»å‹ä¸€èµ·ä½¿ç”¨. <strong>PERMISSIONS</strong> æ­¤ å‚ æ•° å… è®¸ åœ¨ æ”¯ æŒ çš„ å¹³ å° ä¸Š æ›´ æ”¹ å·² å®‰ è£… æ–‡ ä»¶ çš„ æƒ é™. å¯ ç”¨ æƒ é™ ä¸º:OWNER_READã€ OWNER_WRITEã€OWNER_EXECUTEã€GROUP_READã€GROUP_WRITEã€GROUP_EXECUTEã€ WORLD_READã€WORLD_WRITEã€WORLD_EXECUTEã€SETUID å’Œ SETGID.PERMISSIONS å‚ æ•°å¯ä»¥ä¸ TARGETS, FILES, IMPORTED_RUNTIME_ARTIFACTS, EXPORT å’Œ DIRECTORY å®‰è£… ç±»å‹ä¸€èµ·ä½¿ç”¨.</p> <p><strong>CONFIGURATIONS</strong> å…è®¸æŒ‡å®šæ„å»ºé…ç½®æ—¶é™åˆ¶å‚æ•°çš„åº”ç”¨.</p> <p><strong>OPTIONAL</strong> æ­¤å‚æ•°ä½¿è¦å®‰è£…çš„æ–‡ä»¶ä¸ºå¯é€‰æ–‡ä»¶,å› æ­¤å½“æ–‡ä»¶ä¸å­˜åœ¨æ—¶,å®‰è£…ä¸ä¼šå¤±è´¥.å¯é€‰å‚æ•°å¯ä»¥ä¸ TARGETS, FILES, IMPORTED_RUNTIME_ARTIFACTS å’Œ DIRECTORY å®‰è£…ç±»å‹ä¸€èµ·ä½¿ç”¨.</p> <h4 id=æä¾›é¡¹ç›®é…ç½®ä¿¡æ¯><a class=headerlink href=#æä¾›é¡¹ç›®é…ç½®ä¿¡æ¯ title=æä¾›é¡¹ç›®é…ç½®ä¿¡æ¯></a>æä¾›é¡¹ç›®é…ç½®ä¿¡æ¯</h4><p>è‹¥äº¤ä»˜ä¸€ä¸ªåº“,ä¹Ÿå¿…é¡»å¾ˆå®¹æ˜“å¯¼å…¥åˆ°ä¸€ä¸ªé¡¹ç›®â€”â€”ç‰¹åˆ«æ˜¯ CMake é¡¹ç›®.</p> <p>CMake ä½¿ç”¨ä¾èµ–çš„é¦–é€‰æ–¹å¼æ˜¯é€šè¿‡åŒ….åŒ…ä¸ºåŸºäº CMake çš„æ„å»ºç³»ç»Ÿä¼ é€’ä¾èµ–ä¿¡æ¯,åŒ…å¯ä»¥æ˜¯ Config-file åŒ…ã€Find-module åŒ…æˆ– pkg-config åŒ….æ‰€æœ‰çš„åŒ…ç±»å‹éƒ½å¯ä»¥é€šè¿‡ find_package() æ‰¾åˆ°å¹¶ä½¿ç”¨</p> <p>æœ‰ ä¸¤ ç§ ç±» å‹ çš„ é… ç½® æ–‡ ä»¶ â€”â€” åŒ… é… ç½® æ–‡ ä»¶ å’Œ å¯ é€‰ çš„ åŒ… ç‰ˆ æœ¬ æ–‡ ä»¶, ä¸¤ ä¸ª æ–‡ ä»¶ éƒ½ å¿… é¡» æœ‰ ä¸€ ä¸ª ç‰¹ å®š çš„ å‘½ å.æ¯”å¦‚åˆ†åˆ«ä¸ºConfig.cmake,ConfigVersion.cmake</p> <p>åŒ… é… ç½® æ–‡ ä»¶çš„å†…å®¹å¯èƒ½å¦‚ä¸‹,ä¸»è¦è®¾ç½®åŒ…å«å¤´æ–‡ä»¶å’Œåº“:</p> <figure class="highlight cmake"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br></pre><td class=code><pre><span class=line><span class=keyword>set</span>(Foo_INCLUDE_DIRS <span class=variable>${PREFIX}</span>/<span class=keyword>include</span>/foo-<span class=number>1.2</span>) </span><br><span class=line><span class=keyword>set</span>(Foo_LIBRARIES <span class=variable>${PREFIX}</span>/lib/foo-<span class=number>1.2</span>/libfoo.a)</span><br></pre></table></figure> <p>æœç´¢åŒ…æ—¶,find_package(â€¦) ä¼šæŸ¥æ‰¾ ${CMAKE_PREFIX_PATH}$/cmake ç›®å½•.</p> <figure class="highlight cmake"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br></pre><td class=code><pre><span class=line><span class=keyword>include</span>(GNUInstallDirs)</span><br><span class=line><span class=keyword>set</span>(ch4_ex05_lib_INSTALL_CMAKEDIR cmake CACHE PATH</span><br><span class=line><span class=string>"Installation directory for config-file package cmake files"</span>)</span><br></pre></table></figure> <p>include(GNUInstallDirs) ç”¨ äº åŒ… å« GNUInstallDirs æ¨¡ å—. è¿™ æ ä¾› äº† CMAKE_INSTALL_INCLUDEDIR å˜ é‡, set(ch4_ex05_lib_INSTALL_CMAKEDIRâ€¦) æ˜¯ä¸€ä¸ªç”¨æˆ·å®šä¹‰çš„å˜é‡,æ˜¯å¯¼å‡ºç›®æ ‡çš„å®‰è£…è·¯å¾„.</p> <figure class="highlight cmake"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br></pre><td class=code><pre><span class=line>/*çœç•¥ å‰é¢<span class=keyword>add_library</span>*/</span><br><span class=line><span class=keyword>target_include_directories</span>(ch4_ex05_lib PUBLIC</span><br><span class=line>$&LTBUILD_INTERFACE:<span class=variable>${CMAKE_CURRENT_SOURCE_DIR}</span>/<span class=keyword>include</span>></span><br><span class=line>)</span><br><span class=line><span class=keyword>target_compile_features</span>(ch4_ex05_lib PUBLIC cxx_std_11)</span><br></pre></table></figure> <p>ä¸Šé¢è®¾ç½®å¥½äº†ç›®æ ‡åŒ…å«å¤´æ–‡ä»¶,,å› ä¸ºåœ¨å°†ç›®æ ‡å¯¼å…¥åˆ°å¦ä¸€ä¸ª é¡¹ç›®æ—¶,ä¸å­˜åœ¨æ„å»ºæ—¶åŒ…å«è·¯å¾„,å…¶ä½¿ç”¨ç”Ÿæˆå™¨è¡¨è¾¾å¼æ¥åŒºåˆ†æ„å»ºæ—¶åŒ…å«ç›®å½•å’Œå®‰è£…æ—¶åŒ…å«ç›®å½•</p> <figure class="highlight cmake"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br></pre><td class=code><pre><span class=line><span class=keyword>install</span>(TARGETS ch4_ex05_lib</span><br><span class=line><span class=keyword>EXPORT</span> ch4_ex05_lib_export</span><br><span class=line>INCLUDES DESTINATION <span class=variable>${CMAKE_INSTALL_INCLUDEDIR}</span></span><br><span class=line>)</span><br><span class=line><span class=keyword>install</span> (</span><br><span class=line>DIRECTORY <span class=variable>${PROJECT_SOURCE_DIR}</span>/<span class=keyword>include</span>/</span><br><span class=line>DESTINATION <span class=variable>${CMAKE_INSTALL_INCLUDEDIR}</span> <span class=comment># å¤´æ–‡ä»¶å®‰è£…ç›®å½•</span></span><br><span class=line>)</span><br></pre></table></figure> <p>EXPORT å‚ æ•°, ç”¨ äº ä» ç»™ å®š çš„ install(â€¦) ç›® æ ‡ åˆ› å»º ä¸€ ä¸ª å¯¼ å‡º å ç§°. ç„¶ å, å¯ ä»¥ ä½¿ ç”¨ æ­¤ å¯¼ å‡º å ç§° å¯¼ å‡º è¿™ äº› ç›® æ ‡. ä½¿ ç”¨ INCLUDES DESTINATION å‚ æ•° æŒ‡ å®š çš„ è·¯ å¾„, å°† ç”¨ äº å¡« å…… å¯¼ å‡º ç›® æ ‡ çš„ INTERFACE_INCLUDE_DIRECTORIES å± æ€§, å¹¶ è‡ª åŠ¨ ä½¿ ç”¨ å®‰ è£… å‰ ç¼€ è·¯ å¾„ ä½œ ä¸º å‰ ç¼€(å°±æ˜¯å®‰è£…å¤´æ–‡ä»¶,å› ä¸ºå…¶ä¸ä¼šè¢«æ˜¾ç¤ºå®‰è£…æˆ–å¯¼å…¥)</p> <figure class="highlight cmake"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br></pre><td class=code><pre><span class=line><span class=keyword>install</span>(<span class=keyword>EXPORT</span> ch4_ex05_lib_export</span><br><span class=line><span class=keyword>FILE</span> ch4_ex05_lib-config.cmake</span><br><span class=line>NAMESPACE ch4_ex05_lib::</span><br><span class=line>DESTINATION <span class=variable>${ch4_ex05_lib_INSTALL_CMAKEDIR}</span></span><br><span class=line>)</span><br></pre></table></figure> <p>EXPORT å‚æ•°æ¥å—ç°æœ‰çš„å¯¼å‡ºå ç§°æ¥è¿›è¡Œå¯¼å‡º,å®ƒå¼•ç”¨çš„æ˜¯ ch4_ex05_lib_export å¯¼å‡ºåç§°,åœ¨ä¹‹å‰çš„ install(TARGETSâ€¦) ä¸­åˆ›å»ºçš„.</p> <p><strong>FILE ç”¨äºç¡®å®šå¯¼å‡ºçš„æ–‡ä»¶å,</strong>å¹¶è®¾ç½®ä¸º ch4_ex05_lib-config.cmake.</p> <p><strong>NAMESPACE ç”¨äº ä¸ºæ‰€æœ‰å¯¼å‡ºçš„ç›®æ ‡æ·»åŠ å‘½åç©ºé—´å‰ç¼€</strong>.è¿™å…è®¸å°†æ‰€æœ‰å¯¼å‡ºçš„ç›®æ ‡è¿æ¥åˆ°é€šç”¨çš„å‘½åç©ºé—´ä¸‹,å¹¶é¿å… ä¸å…·æœ‰ç›¸ä¼¼ç›®æ ‡åç§°çš„åŒ…å‘ç”Ÿå†²çª.</p> <p>æœ€å,DESTINATION ç¡®å®šç”Ÿæˆå¯¼å‡ºæ–‡ä»¶çš„å®‰è£…è·¯å¾„.è®¾ç½®ä¸º ${ch4_ex05_lib_INSTALL_CMAKEDIR} ä»¥ä¾¿ find_package() å‘ç°å®ƒ</p> <p>è¦å®ç°å¯¹ find_package(â€¦) çš„å®Œå…¨æ”¯æŒ,è¿˜éœ€è¦ç”ŸæˆåŒ…ç‰ˆæœ¬æ–‡ä»¶.</p> <figure class="highlight cmake"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br></pre><td class=code><pre><span class=line><span class=keyword>include</span>(CMakePackageConfigHelpers)</span><br><span class=line>write_basic_package_version_file(</span><br><span class=line><span class=string>"ch4_ex05_lib-config-version.cmake"</span></span><br><span class=line><span class=comment># Package compatibility strategy. SameMajorVersion is</span></span><br><span class=line>essentially 'semantic versioning'.</span><br><span class=line>COMPATIBILITY SameMajorVersion</span><br><span class=line>)</span><br><span class=line><span class=keyword>install</span>(FILES</span><br><span class=line><span class=string>"${CMAKE_CURRENT_BINARY_DIR}/ch4_ex05_lib-config-version.</span></span><br><span class=line><span class=string>cmake"</span></span><br><span class=line>DESTINATION <span class=string>"${ch4_ex05_lib_INSTALL_CMAKEDIR}"</span></span><br><span class=line>)</span><br></pre></table></figure> <p>ä½¿ç”¨ include(CMakePackageConfigHelpers),å¯¼å…¥ CMakePackageConfigHelpers æ¨¡å—.è¿™ä¸ªæ¨¡å— æä¾›äº† write_basic_package_version_file(â€¦) å‡½æ•°,ç”¨äºæ ¹æ®ç»™å®šçš„å‚æ•°è‡ªåŠ¨ç”ŸæˆåŒ…ç‰ˆæœ¬æ–‡ä»¶</p> <blockquote><p>ç®€å•æ¥è¯´,é€šè¿‡ç”ŸæˆåŒ…é…ç½®å’ŒåŒ…ç‰ˆæœ¬æ–‡ä»¶,æ–¹ä¾¿find_packageå¯¼å…¥.<p>è€ŒåŒ…é…ç½®æ–‡ä»¶éœ€è¦é€šè¿‡install(export )å®‰è£…,åŒ…ç‰ˆæœ¬æ–‡ä»¶åˆ©ç”¨write_basic_package_version_fileä»é¡¹ç›®ç‰ˆæœ¬è·å–å¯¼å‡ºç‰ˆæœ¬,åŒ¹é…find_packageä¸­çš„ç‰ˆæœ¬</blockquote> <p><strong>å¦‚ä½•ä½¿ç”¨</strong></p> <figure class="highlight cmake"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br></pre><td class=code><pre><span class=line><span class=keyword>if</span>(<span class=keyword>NOT</span> PROJECT_IS_TOP_LEVEL)</span><br><span class=line><span class=keyword>message</span>(FATAL_ERROR <span class=string>"The chapter-4, ex05_consumer project is</span></span><br><span class=line><span class=string>intended to be a standalone, top-level project. Do not</span></span><br><span class=line><span class=string>include this directory."</span>)</span><br><span class=line><span class=keyword>endif</span>()</span><br><span class=line><span class=keyword>find_package</span>(ch4_ex05_lib <span class=number>1</span> CONFIG REQUIRED) <span class=comment># æ‰¾åˆ°åŒ…é…ç½®æˆ–åŒ…ç‰ˆæœ¬æ–‡ä»¶,è®¾ç½®åŒ…å«å¤´æ–‡ä»¶å’Œåº“</span></span><br><span class=line><span class=keyword>add_executable</span>(ch4_ex05_consumer src/main.cpp)</span><br><span class=line><span class=keyword>target_compile_features</span>(ch4_ex05_consumer PRIVATE cxx_std_11)</span><br><span class=line><span class=keyword>target_link_libraries</span>(ch4_ex05_consumer ch4_ex05_lib::ch4_ex05_</span><br><span class=line>lib) <span class=comment># é“¾æ¥åº“</span></span><br></pre></table></figure> <figure class="highlight cpp"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br></pre><td class=code><pre><span class=line><span class=meta>#<span class=meta-keyword>include</span> <span class=meta-string>&LTchapter4/ex05/lib.hpp></span> # å¼•å…¥å¤´æ–‡ä»¶</span></span><br><span class=line> <span class=function><span class=keyword>int</span> <span class=title>main</span><span class=params>(<span class=keyword>void</span>)</span></span>{</span><br><span class=line> chapter4::ex05::greeter gÍ¾</span><br><span class=line> g.<span class=built_in>greet</span>()Í¾</span><br><span class=line> }</span><br></pre></table></figure> <h4 id=åˆ›å»ºå®‰è£…åŒ…><a class=headerlink href=#åˆ›å»ºå®‰è£…åŒ… title=åˆ›å»ºå®‰è£…åŒ…></a>åˆ›å»ºå®‰è£…åŒ…</h4><p>CMake çš„æ‰“åŒ…å·¥å…· CPack é»˜è®¤éš CMake å®‰è£…ä¸€èµ·æä¾›,å¯ä»¥åˆ©ç”¨ç°æœ‰çš„ CMake ä»£ç æ¥ç”Ÿæˆç‰¹å®šäºå¹³å°çš„å®‰è£…å’ŒåŒ…</p> <p><img alt=image-20240725113947270 data-src=https://s2.loli.net/2024/07/25/KifydlhZsekbLva.png></p> <p>CPack ä½¿ç”¨ CPackConfig.cmake ä¸­çš„é…ç½®ç»† èŠ‚,CPackSourceConfig.Cmake æ–‡ä»¶ç”ŸæˆåŒ….è¿™äº›æ–‡ä»¶å¯ä»¥æ‰‹åŠ¨å¡«å†™,ä¹Ÿå¯ä»¥ç”± CMake åœ¨ CPack æ¨¡å—çš„å¸®åŠ©ä¸‹è‡ªåŠ¨ç”Ÿæˆ.</p> <p>åŒ…å« CPack æ¨¡å—ä¼šç”Ÿæˆ <strong>CPackConfig.cmake</strong> å’Œ <strong>CPackSourceConfig.cmake</strong> æ–‡ä»¶,è¿™æ˜¯æ‰“åŒ…é¡¹ç›®æ‰€éœ€çš„ CPack é…ç½®</p> <p>å½“ CMake æˆ–ç”¨æˆ·æ­£ç¡®è®¾ç½®äº† CPack é…ç½®æ–‡ ä»¶,å°±å¯ä»¥ä½¿ç”¨ CPack.CPack æ¨¡å—å…è®¸å®šåˆ¶åŒ…è£…è¿‡ç¨‹,ä»è€Œå¯ä»¥è®¾ç½®å¤§é‡çš„ CPack å˜é‡.è¿™äº›å˜ é‡åˆ†ä¸ºä¸¤ç»„â€”â€”æ™®é€šå˜é‡å’Œç”Ÿæˆå™¨ç‰¹å®šå˜é‡.å…¬å…±å˜é‡å½±å“æ‰€æœ‰åŒ…ç”Ÿæˆå™¨,è€Œç”Ÿæˆå™¨ç‰¹å®šçš„å˜é‡åª å½±å“ç‰¹å®šç±»å‹çš„ç”Ÿæˆå™¨</p> <p><img alt=image-20240725113958063 data-src=https://s2.loli.net/2024/07/25/SLxahKDtwsZ6dMz.png></p> <figure class="highlight cmake"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br></pre><td class=code><pre><span class=line><span class=keyword>cmake_minimum_required</span>(VERSION <span class=number>3.21</span>)</span><br><span class=line><span class=keyword>project</span>(</span><br><span class=line>ch4_ex06_pack</span><br><span class=line>VERSION <span class=number>1.0</span></span><br><span class=line>DESCRIPTION <span class=string>"Chapter 4 Example 06, Packaging with CPack"</span></span><br><span class=line>LANGUAGES CXX)</span><br><span class=line><span class=keyword>if</span>(<span class=keyword>NOT</span> PROJECT_IS_TOP_LEVEL)</span><br><span class=line><span class=keyword>message</span>(FATAL_ERROR <span class=string>"The chapter-4, ex06_pack project is</span></span><br><span class=line><span class=string>intended to be a standalone, top-level project.</span></span><br><span class=line><span class=string>Do not include this directory."</span>)</span><br><span class=line><span class=keyword>endif</span>()</span><br><span class=line><span class=keyword>add_subdirectory</span>(executable)</span><br><span class=line><span class=keyword>add_subdirectory</span>(library)</span><br><span class=line><span class=keyword>set</span>(CPACK_PACKAGE_VENDOR <span class=string>"CTT Authors"</span>)</span><br><span class=line><span class=keyword>set</span>(CPACK_GENERATOR <span class=string>"DEBÍ¾RPMÍ¾TBZ2"</span>)</span><br><span class=line><span class=keyword>set</span>(CPACK_THREADS <span class=number>0</span>)</span><br><span class=line><span class=keyword>set</span>(CPACK_DEBIAN_PACKAGE_MAINTAINER <span class=string>"CTT Authors"</span>)</span><br><span class=line><span class=keyword>include</span>(CPack)</span><br></pre></table></figure> <figure class="highlight cmake"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line>cmake â€“S . -B build/</span><br></pre></table></figure> <p>é¡¹ç›®é…ç½®å®Œæˆå,CpackConfig.cmake å’Œ CpackConfigSource.cmake æ–‡ä»¶å°†ç”Ÿæˆåˆ° build/CPack* ç›®å½•ä¸‹</p> <figure class="highlight cmake"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br></pre><td class=code><pre><span class=line>cmake --build build/</span><br><span class=line>cpack --config build/CPackConfig.cmake -B build/</span><br></pre></table></figure> <p>å‚æ•°â€”config æ˜¯ CPack å‘½ä»¤çš„ä¸»è¦è¾“å…¥.å‚æ•°-B ä¿®æ”¹äº†é»˜è®¤çš„åŒ…ç›®å½•,CPack å°†æŠŠå®ƒçš„å·¥ ä»¶å†™å…¥è¯¥ç›®å½•</p> <h4 id=å¯»æ‰¾åŒ…å’Œæ–‡ä»¶><a class=headerlink href=#å¯»æ‰¾åŒ…å’Œæ–‡ä»¶ title=å¯»æ‰¾åŒ…å’Œæ–‡ä»¶></a>å¯»æ‰¾åŒ…å’Œæ–‡ä»¶</h4><figure class="highlight cmake"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line><span class=keyword>find_package</span>(PackageName [version] [EXACT | QUIET | NO_MODULE | NO_CMAKE_PATH | NO_CMAKE_ENVIRONMENT | NO_SYSTEM_ENVIRONMENT | NO_CMAKE_SYSTEM_PATH | CMAKE_FIND_ROOT_PATH_BOTH | ONLY_CMAKE_FIND_ROOT_PATH] [REQUIRED | OPTIONAL] [COMPONENTS component1 component2 ...] [CONFIG | MODULE])</span><br></pre></table></figure> <p>CMake èƒ½å¤ŸæŸ¥æ‰¾å®šä¹‰ç›®æ ‡ã€åŒ…æ‹¬è·¯å¾„å’ŒåŒ…ç‰¹å®šå˜é‡çš„æ•´ä¸ªåŒ….æ›´å¤šç»†èŠ‚è¯·å‚è€ƒ CMake é¡¹ç›®éƒ¨ åˆ†ä¸­çš„åº“. æœ‰äº”ä¸ª find_â€¦æŒ‡ä»¤,å®ƒä»¬é€‰é¡¹å’Œè¡Œä¸ºéå¸¸ç›¸ä¼¼:</p> <p>â€¢ find_file: å®šä½å•ä¸ªæ–‡ä»¶.</p> <p>â€¢ find_path: æŸ¥æ‰¾åŒ…å«ç‰¹å®šæ–‡ä»¶çš„ç›®å½•.</p> <p>â€¢ find_library: æŸ¥æ‰¾åº“æ–‡ä»¶.</p> <p>â€¢ find_program: æŸ¥æ‰¾å¯æ‰§è¡Œç¨‹åº.</p> <p>â€¢ find_package: æŸ¥æ‰¾å®Œæ•´çš„åŒ…</p> <p><strong>find_pacakge</strong></p> <figure class="highlight cmake"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br></pre><td class=code><pre><span class=line><span class=keyword>find_package</span>(&LTPackageName> [version] [EXACT] [QUIET] [MODULE]</span><br><span class=line>[REQUIRED] [[COMPONENTS] [components...]]</span><br><span class=line>[OPTIONAL_COMPONENTS components...]</span><br><span class=line>[NO_POLICY_SCOPE])</span><br></pre></table></figure> <p>find_package æœ‰ä¸¤ä¸ªç­¾å: ä¸€ä¸ªåŸºæœ¬ç­¾åæˆ–çŸ­ç­¾å,ä¸€ä¸ªå®Œæ•´ç­¾åæˆ–é•¿ç­¾å.é€šå¸¸, ä½¿ç”¨çŸ­ç­¾åå°±è¶³ä»¥æ‰¾åˆ°æ­£åœ¨å¯»æ‰¾çš„åŒ…,å› ä¸ºå®ƒæ›´å®¹æ˜“ç»´æŠ¤,åº”è¯¥æ˜¯é¦–é€‰.<strong>çŸ­æ ¼å¼åŒæ—¶æ”¯æŒæ¨¡å—å’Œé…ç½®åŒ…</strong>,è€Œé•¿æ ¼å¼åªæ”¯æŒé…ç½®æ¨¡å¼</p> <ul><li>åœ¨<strong>æ¨¡å—æ¨¡å¼</strong>ä¸‹è¿è¡Œæ—¶,find_package ä¼šæœç´¢åä¸º Find\<packagename>.cmake çš„æ–‡ä»¶Í¾ é¦–å…ˆä¼š åœ¨ CMAKE_MODULE_PATH æŒ‡å®šçš„è·¯å¾„ä¸­æœç´¢,ç„¶åæ˜¯åœ¨å¤–éƒ¨æä¾›çš„è·¯å¾„ä¸­æŸ¥æ‰¾æ¨¡å—. <li><strong>åœ¨é…ç½®æ¨¡å¼ä¸‹è¿è¡Œæ—¶,find_package ä¼šæœç´¢ä»¥ä¸‹çš„æ–‡ä»¶</strong>:</li> <p>â€¢ -config.cmake</p> <p>â€¢ Config.cmake</p> <p>â€¢ -config-version.cmake (è‹¥æŒ‡å®šäº†ç‰ˆæœ¬è¯¦ç»†ä¿¡æ¯)</p> <p>â€¢ ConfigVersion.cmake (è‹¥æŒ‡å®šäº†ç‰ˆæœ¬è¯¦ç»†ä¿¡æ¯)</p> <figure class="highlight cmake"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br></pre><td class=code><pre><span class=line><span class=keyword>find_package</span>(OpenSSL REQUIRED COMPONENTS SSL)</span><br><span class=line><span class=keyword>add_executable</span>(find_package_example)</span><br><span class=line><span class=keyword>target_link_libraries</span>(find_package_example PRIVATE OpenSSL::SSL)</span><br></pre></table></figure> <p>find_packageæœç´¢çš„ç›®å½•é¡ºåº</p> <p><img alt=image-20240725144118496 data-src=https://s2.loli.net/2024/07/25/N3yYAxsBnIatMJ4.png></p> <p>é…ç½®æ¨¡å¼ä¸‹æœç´¢è·¯å¾„å¦‚ä¸‹</p> <figure class="highlight awk"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br></pre><td class=code><pre><span class=line>&LTprefix>/</span><br><span class=line>&LTprefix><span class=regexp>/(cmake|CMake)/</span></span><br><span class=line>&LTprefix><span class=regexp>/&LTpackageName>*/</span></span><br><span class=line>&LTprefix><span class=regexp>/&LTpackageName>*/</span>(cmake|CMake)/</span><br><span class=line>&LTprefix><span class=regexp>/(lib/</span>&LTarch>|lib*|share)<span class=regexp>/cmake/</span>&LTpackageName>*/</span><br><span class=line>&LTprefix><span class=regexp>/(lib/</span>&LTarch>|lib*|share)<span class=regexp>/&LTpackageName>*/</span></span><br><span class=line>&LTprefix><span class=regexp>/(lib/</span>&LTarch>|lib*|share)<span class=regexp>/&LTpackageName>*/</span>(cmake|CMake)/</span><br><span class=line>&LTprefix><span class=regexp>/&LTpackageName>*/</span>(lib<span class=regexp>/&LTarch>|lib*|share)/</span>cmake/</span><br><span class=line>&LTpackageName>*/</span><br><span class=line>&LTprefix><span class=regexp>/&LTpackageName>*/</span>(lib<span class=regexp>/&LTarch>|lib*|share)/</span>&LTpackageName>*/</span><br><span class=line>&LTprefix><span class=regexp>/&LTpackageName>*/</span>(lib<span class=regexp>/&LTarch>|lib*|share)/</span>&LTpackageName>*/</span><br><span class=line>(cmake|CMake)/</span><br></pre></table></figure> <p><strong>ç¼–å†™æŸ¥æ‰¾æ¨¡å—(å¦‚æœæƒ³ä½¿ç”¨çš„åº“æ²¡æœ‰cmake)</strong></p> <p>ç›®å‰ä»ç„¶æœ‰å¾ˆå¤šåº“æ²¡æœ‰ä½¿ç”¨ CMake ç®¡ç†,æˆ–è€…ä¸å¯¼å‡º CMake åŒ….è‹¥å¯ä»¥å°†å®ƒä»¬å®‰è£…åœ¨ç³»ç»Ÿçš„é»˜è®¤ä½ç½®,æ‰¾åˆ°è¿™äº›åº“é€šå¸¸ä¹Ÿä¸æ˜¯é—®é¢˜.å½“ä½¿ç”¨ä»…ä¸ºæŸä¸ªé¡¹ç›®æ‰€éœ€çš„ä¸“æœ‰ç¬¬ä¸‰æ–¹åº“,æˆ–è€…ä½¿ç”¨ä»ç³» ç»ŸåŒ…ç®¡ç†å™¨å®‰è£…çš„åº“æ„å»ºçš„ä¸åŒç‰ˆæœ¬çš„åº“æ—¶,ä½¿ç”¨å¯¹åº”ç‰ˆæœ¬çš„åº“å°±æˆäº†ä»¶éº»çƒ¦äº‹.</p> <figure class="highlight reasonml"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br></pre><td class=code><pre><span class=line>â”œâ”€â”€ dep &LT-- The folder where we locally keep dependencies</span><br><span class=line>â”œâ”€â”€ cmake</span><br><span class=line>â”‚ â””â”€â”€ <span class=module-access><span class=module><span class=identifier>FindLibImagePipeline</span>.</span></span>cmake &LT-- This is what we need <span class=keyword>to</span> write</span><br><span class=line>â”œâ”€â”€ <span class=module-access><span class=module><span class=identifier>CMakeLists</span>.</span></span>txt &LT-- Main <span class=module-access><span class=module><span class=identifier>CmakeLists</span>.</span></span>txt</span><br><span class=line>â”œâ”€â”€ src</span><br><span class=line>â”‚ â”œâ”€â”€ *.cpp files</span><br><span class=line></span><br></pre></table></figure> <p>find æ¨¡å—å¦‚ä½•æ‰¾åˆ°<strong>å¿…è¦çš„å¤´æ–‡ä»¶å’ŒäºŒè¿›åˆ¶æ–‡ä»¶</strong>,ä»¥åŠä¸º CMake åˆ›å»ºå¯¼å…¥ç›®æ ‡çš„æŒ‡ä»¤.<strong>å½“ä½¿ç”¨ find_package æ—¶,CMake åœ¨ CMAKE_MODULE_PATH ä¸­æœç´¢åä¸º Find\<packagename>.cmake çš„æ–‡ä»¶ <p>å¤„ç†é€»è¾‘æ˜¯é¦–å…ˆåœ¨CMAKE_MODULE_PATHä¸­æ·»åŠ .cmake,ç„¶åæ·»åŠ libraryå’Œpath,ç„¶ååˆ¤æ–­ç›®æ ‡æœ‰æ²¡æœ‰,å¦‚æœæ²¡æœ‰å°±æ„å»ºåº“,å¹¶è®¾ç½®åº“çš„å±æ€§. å…¶ä¸­åˆ©ç”¨äº†find_package_handle_standard_args æ£€æŸ¥ä¼ é€’çš„LIBRARY å’Œ INCLUDE_DIR å˜é‡æ˜¯å¦æœ‰æ•ˆ,ä»è€Œä¼šè®¾ç½® _FOUND å˜é‡.</p> <h4 id=åŒ…ç®¡ç†å™¨><a class=headerlink href=#åŒ…ç®¡ç†å™¨ title=åŒ…ç®¡ç†å™¨></a>åŒ…ç®¡ç†å™¨</h4><p><strong>Conan</strong></p> <p>Conan æœ€å¼ºå¤§çš„ç‰¹æ€§æ˜¯å¯ä»¥ä¸ºå¤šä¸ªå¹³å°ã€é…ç½®å’Œç‰ˆæœ¬åˆ›å»ºå’Œç®¡ç†äºŒè¿›åˆ¶åŒ….åˆ›å»ºåŒ…æ—¶,ä½¿ç”¨ conanfile.py æ–‡ä»¶æè¿°å®ƒä»¬,è¯¥æ–‡ä»¶åˆ—å‡ºäº†æ‰€æœ‰ä¾èµ–é¡¹ã€æºå’Œæ„å»ºæŒ‡ä»¤.</p> <p>ç”¨ CMake ä½¿ç”¨ Conan çš„æ–¹æ³•æ˜¯ä½¿ç”¨ CMake æœ¬èº«çš„ Conan,è‹¥ä¸æƒ³è¿™æ ·åš,å¯ä»¥åœ¨å¤–éƒ¨ä½¿ç”¨ Conan,ä½†å»ºè®®åœ¨ä½¿ç”¨ Conan ä¹‹å‰ä½¿ç”¨ find_program æ£€æŸ¥ Conan ç¨‹åºæ˜¯å¦å­˜åœ¨</p> <p>CMakeä¸Conanæ­é…é›†æˆå¾ˆå¥½,ç›´æ¥åœ¨CMakeLists.txtä¸­åŒ…å«conan.cmake(æ²¡æœ‰ç›´æ¥ä¸‹è½½),ç„¶åincludeå¹¶ä½¿ç”¨conançš„ä¸€ç³»åˆ—å‘½ä»¤è¿›è¡Œå®‰è£….</p> <p><strong>vcpkg</strong></p> <p>æµè¡Œçš„å¼€æºåŒ…ç®¡ç†å™¨æ˜¯å¾®è½¯çš„ vcpkg,å·¥ä½œæ–¹å¼ç±»ä¼¼äº Conan,ä½¿ç”¨å®¢æˆ·æœº/æœåŠ¡å™¨æ¶æ„. æœ€åˆæ„å»ºå®ƒæ˜¯ä¸ºäº†ä¸ Visual Studio ç¼–è¯‘å™¨ç¯å¢ƒä¸€èµ·å·¥ä½œ,åæ¥æ·»åŠ äº† CMake.</p> <blockquote><p>å½“ä»¥æ¸…å•æ¨¡å¼è¿è¡Œæ—¶,é¡¹ç›®çš„ä¾èµ–é¡¹åœ¨ vcpkg.json ä¸­å®šä¹‰,æ–‡ä»¶åœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹,æ¸…å•æ¨¡å¼ æœ‰ä¸€ä¸ªå¾ˆå¤§çš„ä¼˜åŠ¿,å¯ä»¥æ›´å¥½åœ°ä¸ CMake é›†æˆ,å› æ­¤è¯·å°½å¯èƒ½ä½¿ç”¨æ¸…å•æ¨¡å¼<p>è‹¥ä»¥ç»å…¸æ¨¡å¼è¿è¡Œ, åˆ™å¿…é¡»åœ¨è¿è¡Œ CMake ä¹‹å‰æ‰‹åŠ¨å®‰è£…è¿™äº›åŒ…,å½“ä¼ é€’ vcpkg å·¥å…·é“¾æ–‡ä»¶æ—¶,å¯ä»¥ä½¿ç”¨ find_package å’Œ target_link_libraries ä½¿ç”¨å·²å®‰è£…çš„åŒ…,</blockquote> <figure class="highlight sh"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br></pre><td class=code><pre><span class=line>Cmake -S &LTsource_dir> -D &LTbinary_dir> -DCMAKE_TOOLCHAIN_</span><br><span class=line>FILE=[vcpkg root]/scripts/buildsystems/vcpkg.cmake</span><br></pre></table></figure> <p>è®¾ç½®å·¥å…·é“¾æ–‡ä»¶å¯èƒ½ä¼šåœ¨äº¤å‰ç¼–è¯‘æ—¶å¯¼è‡´é—®é¢˜,å› ä¸º CMAKE_TOOLCHAIN_FILE å¯èƒ½å·²ç» æŒ‡å‘ä¸€ä¸ªä¸åŒçš„æ–‡ä»¶,æ‰€ä»¥ç¬¬äºŒä¸ªå·¥å…·é“¾æ–‡ä»¶å¯ä»¥é€šè¿‡ VCPKG_CHAINLOAD_TOOLCHAIN_FILE ä¼ é€’</p> <figure class="highlight sh"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br></pre><td class=code><pre><span class=line>cmake -S &LTsource_dir> -D &LTbinary_dir> -DCMAKE_TOOLCHAIN_</span><br><span class=line>FILE=[vcpkg root]/scripts/buildsystems/vcpkg.cmake -DVCPKG</span><br><span class=line>_CHAINLOAD_TOOLCHAIN_FILE=/path/to/other/toolchain.cmake</span><br></pre></table></figure> <p>ä¸»è¦æ˜¯è¦è®©cmakeçŸ¥é“åŒ…ç®¡ç†å™¨å®‰è£…äº†å“ªäº›åº“å¹¶æŒ‡å®šcmakeå®‰è£…å“ªäº›åº“,å¯ä»¥é€šè¿‡<code>CMakePresets.json</code>è¿›è¡Œé…ç½®</p> <h4 id=è·å–ä¾èµ–é¡¹æºä»£ç ><a class=headerlink href=#è·å–ä¾èµ–é¡¹æºä»£ç  title=è·å–ä¾èµ–é¡¹æºä»£ç ></a>è·å–ä¾èµ–é¡¹æºä»£ç </h4><p>å¯¹äºæ„å»ºçš„å¤–éƒ¨é¡¹ç›®,ä½¿ç”¨ FetchContent æ¨¡å—æ˜¯æ·»åŠ æºä¾èµ–é¡¹çš„ä¸€ç§æ–¹æ³•.å¯¹äºäºŒè¿›åˆ¶ä¾ èµ–,ä½¿ç”¨ find_packageçš„æ–¹å¼ä»æ˜¯é¦–é€‰.</p> <blockquote><p>ä¸‹è½½å¹¶å°†ç¬¬ä¸‰æ–¹è½¯ä»¶çš„å‰¯æœ¬é›†æˆåˆ°äº§å“ä¸­çš„åšæ³•,ç§°ä¸ºä¾›åº”å•†æ–¹å¼.ä¼˜ç‚¹æ˜¯å¸¸å¸¸ä½¿æ„å»ºè½¯ä»¶ å˜å¾—å®¹æ˜“,ä½†åœ¨æ‰“åŒ…åº“æ–¹é¢äº§ç”Ÿäº†é—®é¢˜</blockquote> <p><strong>FetchContent</strong></p> <p>FetchContent æä¾›äº†ä¸€ç³»åˆ—å‡½æ•°æ¥æ‹‰å–æºä¾èµ–é¡¹,ä¸»è¦æ˜¯ <strong>FetchContent_Declare</strong>,å®ƒå®š ä¹‰äº†ä¸‹è½½å’Œæ„å»º <strong>FetchContent_MakeAvailable</strong> çš„å‚æ•°,<strong>FetchContent_MakeAvailable</strong> å¡«å……ä¾èµ–é¡¹çš„ç›®æ ‡,å¹¶ä½¿å®ƒä»¬å¯ç”¨äºæ„å»º</p> <figure class="highlight cmake"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br></pre><td class=code><pre><span class=line><span class=keyword>include</span>(FetchContent)</span><br><span class=line>FetchContent_Declare(</span><br><span class=line>bertrand</span><br><span class=line>GIT_REPOSITORY https://github.com/bernedom/bertrand.git</span><br><span class=line>GIT_TAG <span class=number>0.0</span>.<span class=number>17</span>)</span><br><span class=line>FetchContent_MakeAvailable(bertrand)</span><br><span class=line><span class=keyword>add_executable</span>(fetch_content_example)</span><br><span class=line><span class=keyword>target_link_libraries</span>(</span><br><span class=line>fetch_content_example</span><br><span class=line>PRIVATE bertrand::bertrand</span><br><span class=line>)</span><br></pre></table></figure> <h3 id=è‡ªåŠ¨ç”Ÿæˆæ–‡æ¡£><a class=headerlink href=#è‡ªåŠ¨ç”Ÿæˆæ–‡æ¡£ title=è‡ªåŠ¨ç”Ÿæˆæ–‡æ¡£></a>è‡ªåŠ¨ç”Ÿæˆæ–‡æ¡£</h3><p>Doxygen æ˜¯ä¸€ä¸ªéå¸¸æµè¡Œçš„ C++ é¡¹ç›®æ–‡æ¡£è½¯ä»¶,å…è®¸ä»ä»£ç ç”Ÿæˆæ–‡æ¡£.,Doxygen è¦æ±‚æ³¨é‡Šé‡‡ç”¨é¢„å®šä¹‰çš„ä¸€ç»„æ ¼å¼, è¿˜éœ€è¦ä¸€ä¸ª Doxyfile,å…¶åŒ…å«æ–‡æ¡£ç”Ÿæˆçš„æ‰€æœ‰å‚æ•°,æ¯”å¦‚è¾“å‡ºæ ¼å¼ã€æ’é™¤çš„æ–‡ä»¶æ¨¡å¼ã€ é¡¹ç›®åç§°ç­‰,å› ä¸ºé…ç½®å‚æ•°å¤ªå¤š,å¼€å§‹é…ç½® Doxygen å¯èƒ½ä¼šè®©äººæœ›è€Œç”Ÿç•,ä½† CMake å¯ä»¥è‡ªåŠ¨ç”Ÿ æˆ Doxyfile.</p> <figure class="highlight cmake"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br></pre><td class=code><pre><span class=line><span class=keyword>find_package</span>(Doxygen)</span><br><span class=line><span class=keyword>set</span>(DOXYGEN_OUTPUT_DIRECTORY<span class=string>"${CMAKE_CURRENT_BINARY_DIR}/docs"</span>)</span><br><span class=line><span class=keyword>set</span>(DOXYGEN_GENERATE_HTML YES)</span><br><span class=line><span class=keyword>set</span>(DOXYGEN_GENERATE_MAN YES)</span><br><span class=line><span class=keyword>set</span>(DOXYGEN_MARKDOWN_SUPPORT YES)</span><br><span class=line><span class=keyword>set</span>(DOXYGEN_AUTOLINK_SUPPORT YES)</span><br><span class=line><span class=keyword>set</span>(DOXYGEN_HAVE_DOT YES)</span><br><span class=line><span class=keyword>set</span>(DOXYGEN_COLLABORATION_GRAPH YES)</span><br><span class=line><span class=keyword>set</span>(DOXYGEN_CLASS_GRAPH YES)</span><br><span class=line><span class=keyword>set</span>(DOXYGEN_UML_LOOK YES)</span><br><span class=line><span class=keyword>set</span>(DOXYGEN_DOT_UML_DETAILS YES)</span><br><span class=line><span class=keyword>set</span>(DOXYGEN_DOT_WRAP_THRESHOLD <span class=number>100</span>)</span><br><span class=line><span class=keyword>set</span>(DOXYGEN_CALL_GRAPH YES)</span><br><span class=line><span class=keyword>set</span>(DOXYGEN_QUIET YES)</span><br><span class=line></span><br></pre></table></figure> <ul><li>DOXYGEN_OUTPUT_DIRECTORY: è®¾ç½® Doxygen çš„è¾“å‡ºç›®å½•,<li>DOXYGEN_GENERATE_HTML: ç”Ÿæˆè¶…æ–‡æœ¬æ ‡è®°è¯­è¨€ (HTML)<li>DOXYGEN_GENERATE_MAN: ç”Ÿæˆ MAN é¡µé¢,<li>DOXYGEN_AUTOLINK_SUPPORT: Doxygen è‡ªåŠ¨é“¾æ¥è¯­è¨€ç¬¦å·å’Œæ–‡ä»¶ååˆ°ç›¸å…³æ–‡æ¡£é¡µé¢ (è‹¥ å¯ç”¨),<li>DOXYGEN_HAVE_DOT: Doxygen ç¯å¢ƒæœ‰å¯ç”¨çš„ dot,è¯¥å‘½ä»¤å¯ç”¨äºç”Ÿæˆå›¾åƒ,è¿™å°†ä½¿ Doxygen èƒ½å¤Ÿä½¿ç”¨ä¾èµ–å…³ç³»å›¾ã€ç»§æ‰¿å›¾å’Œåä½œå›¾æ¥ä¸°å¯Œç”Ÿæˆçš„æ–‡æ¡£,<li>DOXYGEN_COLLABORATION_GRAPH: ä¸ºç±»ç”Ÿæˆåä½œå›¾<li>DOXYGEN_CLASS_GRAPH: ç”Ÿæˆç±»å›¾,<li>DOXYGEN_UML_LOOK: Instructs ç”Ÿæˆç±»ä¼¼ç»Ÿä¸€å»ºæ¨¡è¯­è¨€ (UML) çš„å›¾,<li>DOXYGEN_DOT_UML_DETAILS: å°†ç±»å‹å’Œå‚æ•°ä¿¡æ¯æ·»åŠ åˆ° UML å›¾ä¸­,<li>DOXYGEN_DOT_WRAP_THRESHOLD: ä¸º UML å›¾è®¾ç½®è¡Œæ¢è¡Œé˜ˆå€¼,<li>DOXYGEN_CALL_GRAPH: ä¸ºå‡½æ•°æ–‡æ¡£ä¸­çš„å‡½æ•°ç”Ÿæˆè°ƒç”¨å›¾,<li>DOXYGEN_QUIET: é™é»˜ç”Ÿæˆåˆ°æ ‡å‡†è¾“å‡º (stdout) çš„ Doxygen è¾“å‡º</ul> <figure class="highlight cmake"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br></pre><td class=code><pre><span class=line>doxygen_add_docs(</span><br><span class=line>ch6_ex01_doxdocgen_generate_docs</span><br><span class=line><span class=string>"${CMAKE_CURRENT_LIST_DIR}"</span></span><br><span class=line>ALL</span><br><span class=line>COMMENT <span class=string>"Generating documentation for Chapter 6 - Example</span></span><br><span class=line><span class=string>01 with Doxygen"</span></span><br><span class=line>)</span><br></pre></table></figure> <p>ä½¿ç”¨ doxygen_add_docs(â€¦) æ¥ç”Ÿæˆæ–‡æ¡£,è¯¥å‡½æ•°å°†ç”Ÿæˆä¸€ä¸ªåä¸º targetName çš„è‡ªå®šä¹‰ç›®æ ‡</p> <p>å‚æ•°åˆ—è¡¨ filesOrDirs, åŒ…å«<strong>ç”Ÿæˆæ–‡æ¡£çš„ä»£ç çš„æ–‡ä»¶æˆ–ç›®å½•çš„åˆ—è¡¨</strong></p> <p>ALL å‚æ•°ç”¨äºä½¿ CMake çš„ ALL å…ƒç›®æ ‡ä¾èµ–äº doxygen_add_docs(â€¦) åˆ›å»ºçš„æ–‡æ¡£ç›®æ ‡,å› æ­¤åœ¨æ„å»º ALL å…ƒç›®æ ‡æ—¶è‡ªåŠ¨ç”Ÿæˆæ–‡æ¡£</p> <p>COMMENT å‚æ•°ç”¨äºè®© CMake åœ¨æ„å»ºç›®æ ‡æ—¶è¾“å‡ºä¸€æ¡æ¶ˆæ¯</p> <figure class="highlight cmake"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br></pre><td class=code><pre><span class=line><span class=keyword>function</span>(pro_BuildDoc doxyfilein)</span><br><span class=line>  <span class=keyword>if</span>(<span class=keyword>TARGET</span> Doxygen::doxygen)</span><br><span class=line>    <span class=keyword>set</span>(doxyfileout <span class=variable>${CMAKE_CURRENT_BINARY_DIR}</span>/<span class=variable>${doxyfilein}</span>)</span><br><span class=line>    <span class=keyword>configure_file</span>(<span class=variable>${doxyfilein}</span> <span class=variable>${doxyfileout}</span> @ONLY)</span><br><span class=line>    <span class=keyword>set</span>(targetName <span class=string>"${CMAKE_PROJECT_NAME}_doc"</span>)</span><br><span class=line>    <span class=keyword>add_custom_target</span>(<span class=variable>${targetName}</span> <span class=keyword>COMMAND</span> Doxygen::doxygen <span class=variable>${doxyfileout}</span></span><br><span class=line>                                  WORKING_DIRECTORY <span class=variable>${CMAKE_CURRENT_SOURCE_DIR}</span></span><br><span class=line>                                  COMMENT <span class=string>"Generating API documentation with Doxygen"</span> VERBATIM</span><br><span class=line>                              SOURCES <span class=variable>${doxyfilein}</span> <span class=variable>${doxyfileout}</span>)</span><br><span class=line></span><br><span class=line>    <span class=keyword>set_target_properties</span>(<span class=variable>${targetName}</span> PROPERTIES FOLDER <span class=variable>${CMAKE_PROJECT_NAME}</span>)</span><br><span class=line>    <span class=keyword>source_group</span>(doxyfile_input FILES <span class=variable>${doxyfilein}</span>)</span><br><span class=line>    <span class=keyword>source_group</span>(doxyfile_output FILES <span class=variable>${doxyfileout}</span>)</span><br><span class=line>  <span class=keyword>else</span>()</span><br><span class=line>    <span class=keyword>message</span>(STATUS <span class=string>"not have doxygen, ignore"</span>)</span><br><span class=line>  <span class=keyword>endif</span>()</span><br><span class=line><span class=keyword>endfunction</span>()</span><br><span class=line></span><br></pre></table></figure> <p><strong>CPackæ‰“åŒ…æ–‡æ¡£</strong></p> <figure class="highlight cmake"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br></pre><td class=code><pre><span class=line><span class=keyword>include</span>(GNUInstallDirs)</span><br><span class=line><span class=keyword>install</span>(DIRECTORY <span class=string>"${CMAKE_CURRENT_BINARY_DIR}/docs/html/"</span></span><br><span class=line>DESTINATION <span class=string>"${CMAKE_INSTALL_DOCDIR}"</span> COMPONENT</span><br><span class=line>ch6_ex01_html)</span><br><span class=line><span class=keyword>install</span>(DIRECTORY <span class=string>"${CMAKE_CURRENT_BINARY_DIR}/docs/man/"</span></span><br><span class=line>DESTINATION <span class=string>"${CMAKE_INSTALL_MANDIR}"</span> COMPONENT</span><br><span class=line>ch6_ex01_man)</span><br></pre></table></figure> <figure class="highlight cmake"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br></pre><td class=code><pre><span class=line><span class=keyword>set</span>(CPACK_PACKAGE_NAME cbp_chapter6_example01)</span><br><span class=line><span class=keyword>set</span>(CPACK_PACKAGE_VENDOR <span class=string>"CBP Authors"</span>)</span><br><span class=line><span class=keyword>set</span>(CPACK_GENERATOR <span class=string>"DEBÍ¾RPMÍ¾TBZ2"</span>)</span><br><span class=line><span class=keyword>set</span>(CPACK_DEBIAN_PACKAGE_MAINTAINER <span class=string>"CBP Authors"</span>)</span><br><span class=line><span class=keyword>include</span>(CPack)</span><br></pre></table></figure> <h3 id=é›†æˆä»£ç è´¨é‡å·¥å…·><a class=headerlink href=#é›†æˆä»£ç è´¨é‡å·¥å…· title=é›†æˆä»£ç è´¨é‡å·¥å…·></a>é›†æˆä»£ç è´¨é‡å·¥å…·</h3><h4 id=ä»£ç æµ‹è¯•><a class=headerlink href=#ä»£ç æµ‹è¯• title=ä»£ç æµ‹è¯•></a>ä»£ç æµ‹è¯•</h4><p>é€šè¿‡ CTest,CMake å¯ä»¥ä»¥å†…ç½®çš„æ–¹æ³•æ¥æ‰§è¡Œæµ‹è¯•,è®¾ç½® enable_testing(),å¹¶ä½¿ç”¨ add_test() æ·»åŠ äº†æµ‹è¯•çš„ CMake é¡¹ç›®éƒ½æ”¯æŒè¿è¡Œæµ‹è¯•,</p> <p>enable_testing() å°†åœ¨å½“å‰ç›®å½•å’Œå…¶å­ç›®å½•ä¸­å¯ç”¨,å¹¶æ·»åŠ æµ‹è¯•,</p> <p>å› æ­¤åœ¨ä½¿ç”¨ add_subdirectory å‰,é€šå¸¸å°†å…¶è®¾ç½®åœ¨é¡¶å±‚çš„ CMakeLists.txt ä¸­,è‹¥ä½¿ç”¨ <strong>include(CTest),CMake çš„ CTest æ¨¡å—ä¼šè‡ªåŠ¨è®¾ç½® enable_testing</strong>, é™¤é BUILD_TESTING ä¸º OFF,</p> <blockquote><p>æ ¹æ® BUILD_TESTING é€‰é¡¹ç¦ç”¨æ„å»ºå’Œè¿è¡Œæµ‹è¯•ä¹Ÿæ˜¯ä¸€ç§å¾ˆå¥½çš„å®è·µ,<p>è¿™é‡Œçš„å¸¸ç”¨æ¨¡å¼æ˜¯å°†é¡¹ç›®ä¸­ä¸æµ‹è¯•ç›¸å…³çš„æ‰€æœ‰éƒ¨åˆ†æ”¾åœ¨å…¶å­æ–‡ä»¶å¤¹ä¸­,å¹¶ä¸”åªåœ¨ BUILD_TESTING è®¾ç½®ä¸º ON æ—¶åŒ…å«å­ æ–‡ä»¶å¤¹,</blockquote> <p>CTest å°†ä½¿ç”¨æœ‰å…³æµ‹è¯•çš„ä¿¡æ¯å¹¶æ‰§è¡Œå®ƒä»¬,é€šè¿‡ç‹¬ç«‹è¿è¡Œ ctest æˆ–ä½œä¸º CMake æ„å»ºæ­¥éª¤çš„ä¸€éƒ¨ åˆ†,æ¥æ‰§è¡Œæµ‹è¯•,ä»¥ä¸‹ä¸¤ä¸ªå‘½ä»¤éƒ½å¯æ‰§è¡Œæµ‹è¯•:</p> <figure class="highlight sh"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br></pre><td class=code><pre><span class=line>ctest --test-dir  &LTbuild_dir></span><br><span class=line>cmake --build &LTbuild_dir> --target <span class=built_in>test</span></span><br></pre></table></figure> <p>æœ‰é€‰æ‹©åœ°æ‰§è¡Œæµ‹è¯•çš„å¦ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨ LABELS å±æ€§è¿›è¡Œæ ‡è®°,ç„¶åä½¿ç”¨ CTest çš„-Lé€‰é¡¹é€‰ æ‹©è¦è¿è¡Œçš„æ ‡ç­¾,ä¸€ä¸ªæµ‹è¯•å¯ä»¥æœ‰å¤šä¸ªç”¨åˆ†å·åˆ†éš”çš„æ ‡ç­¾</p> <figure class="highlight cmake"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br></pre><td class=code><pre><span class=line><span class=keyword>add_test</span>(NAME labeled_test_1 <span class=keyword>COMMAND</span> someTest)</span><br><span class=line><span class=keyword>set_tests_properties</span>(labeled_test PROPERTIES LABELS <span class=string>"example"</span>)</span><br><span class=line><span class=keyword>add_test</span>(NAME labeled_test_2 <span class=keyword>COMMAND</span> anotherTest)</span><br><span class=line><span class=keyword>set_tests_properties</span>(labeled_test_2 PROPERTIES LABELS <span class=string>"will_fail"</span> )</span><br><span class=line><span class=keyword>add_test</span>(NAME labeled_test_3 <span class=keyword>COMMAND</span> YetAnotherText)</span><br><span class=line><span class=keyword>set_tests_properties</span>(labeled_test_3 PROPERTIES LABELS <span class=string>"exampleÍ¾will_fail"</span>)</span><br><span class=line></span><br></pre></table></figure> <p>-L å‘½ä»¤è¡Œé€‰é¡¹æ¥å—ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼æ¥è¿‡æ»¤æ ‡ç­¾</p> <figure class="highlight sh"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line>ctest -L <span class=string>"example|will_fail"</span></span><br></pre></table></figure> <p>æ›´å¥½çš„æµ‹è¯•åº“æ¯”å¦‚ä½¿ç”¨googleTest.</p> <p>æ­¤å¤–è¿˜æœ‰ä»£ç é™æ€æ£€æŸ¥(åŒ…æ‹¬æ ¼å¼åŒ–,è¯­æ³•æ£€æŸ¥ç­‰)ã€è¦†ç›–ç‡ä»¥åŠä»£ç æ¶ˆæ€ç­‰å·¥å…·,ä½†å…¶å®å…¶ä¸­ä¸€äº›åŠŸèƒ½å·²ç»ç”±å…¶ä»–ç¨‹åºä»£æ›¿äº†(æ¯”å¦‚IDEå’Œä¸€äº›ç¼–è¾‘å™¨),è¿™é‡Œä¸åšæè¿°</p> <h3 id=æ‰§è¡Œè‡ªå®šä¹‰ä»»åŠ¡><a class=headerlink href=#æ‰§è¡Œè‡ªå®šä¹‰ä»»åŠ¡ title=æ‰§è¡Œè‡ªå®šä¹‰ä»»åŠ¡></a>æ‰§è¡Œè‡ªå®šä¹‰ä»»åŠ¡</h3><p><strong>æ„å»ºæ—¶æ‰§è¡Œè‡ªå®šä¹‰ä»»åŠ¡</strong></p> <figure class="highlight cmake"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br></pre><td class=code><pre><span class=line><span class=keyword>add_custom_target</span>(Name [ALL] [command1 [args1...]]</span><br><span class=line>[<span class=keyword>COMMAND</span> command2 [args2...] ...]</span><br><span class=line>[DEPENDS depend depend depend ... ]</span><br><span class=line>[BYPRODUCTS [files...]]</span><br><span class=line>[WORKING_DIRECTORY dir]</span><br><span class=line>[COMMENT comment]</span><br><span class=line>[JOB_POOL job_pool]</span><br><span class=line>[VERBATIM] [USES_TERMINAL]</span><br><span class=line>[COMMAND_EXPAND_LISTS]</span><br><span class=line>[SOURCES src1 [src2...]])</span><br></pre></table></figure> <p><code>add_custom_target</code> ç”¨äºå®šä¹‰ä¸€ä¸ªè‡ªå®šä¹‰çš„ç›®æ ‡,è¿™ä¸ªç›®æ ‡å¯ä»¥è¿è¡Œä¸€ä¸ªå‘½ä»¤æˆ–ä¸€ç»„å‘½ä»¤</p> <figure class="highlight cmake"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br></pre><td class=code><pre><span class=line><span class=keyword>add_executable</span>(SomeExe)</span><br><span class=line><span class=keyword>add_custom_target</span>(CreateHash ALL <span class=keyword>COMMAND</span> Somehasher</span><br><span class=line>$&LTTARGET_FILE:SomeExe>)</span><br></pre></table></figure> <p>å®šä¹‰ä¸€ä¸ªè‡ªå®šä¹‰çš„ç›®æ ‡,è¯¥ç›®æ ‡æœ¬èº«ä¸æ˜¯ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶æˆ–åº“,è€Œæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ä»»åŠ¡,æ¯”å¦‚æ¸…ç†æ“ä½œã€ç”Ÿæˆæ–‡æ¡£ç­‰,</p> <p><strong>add_custom_command</strong></p> <p>åœ¨æ„å»ºç›®æ ‡æ—¶å¯èƒ½éœ€è¦æ‰§è¡Œå¤–éƒ¨ä»»åŠ¡,CMake ä¸­å¯ä»¥ä½¿ç”¨ add_custom_command æ¥ å®ç°è¿™ä¸€ç‚¹,å®ƒæœ‰ä¸¤ä¸ªç­¾å,ä¸€ä¸ªç”¨äºå°†å‘½ä»¤ä¸ç°æœ‰ç›®æ ‡æŒ‚é’©,è€Œå¦ä¸€ä¸ªç”¨äºç”Ÿæˆæ–‡ä»¶,</p> <figure class="highlight cmake"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br></pre><td class=code><pre><span class=line><span class=keyword>add_executable</span>(MyExecutable)</span><br><span class=line><span class=keyword>add_custom_command</span>(<span class=keyword>TARGET</span> MyExecutable</span><br><span class=line>POST_BUILD</span><br><span class=line><span class=keyword>COMMAND</span> hasher $&LTTARGET_FILE:ch8_custom_command_example></span><br><span class=line><span class=variable>${CMAKE_CURRENT_BINARY_DIR}</span>/MyExecutable.sha256</span><br><span class=line>COMMENT <span class=string>"Creating hash for MyExecutable"</span></span><br><span class=line>)</span><br></pre></table></figure> <p><code>add_custom_command</code> ç”¨äºå®šä¹‰ä¸€ä¸ªå‘½ä»¤,è¯¥å‘½ä»¤ä¼šåœ¨æ„å»ºè¿‡ç¨‹ä¸­è¿è¡Œ,å¹¶å¯ä»¥ä¸ä¸€ä¸ªç›®æ ‡å…³è”.</p> <p>å®ƒå¯ä»¥ç”¨æ¥ç”Ÿæˆæºæ–‡ä»¶æˆ–æ‰§è¡Œå…¶ä»–ä»»åŠ¡,å¸Œæœ›è‡ªå®šä¹‰ä»»åŠ¡äº§ç”Ÿç‰¹å®šçš„è¾“å‡ºæ–‡ä»¶,è¿™å¯ä»¥é€šè¿‡å®šä¹‰è‡ªå®šä¹‰ç›®æ ‡,å¹¶åœ¨ç›®æ ‡ä¹‹é—´è®¾ç½® å¿…è¦çš„ä¾èµ–é¡¹æ¥å®ç°</p> <ul><li>PRE_BUILD: åœ¨ Visual Studio ä¸­,æ­¤å‘½ä»¤åœ¨æ‰§è¡Œå…¶ä»–æ„å»ºæ­¥éª¤ä¹‹å‰æ‰§è¡Œ,å½“ä½¿ç”¨å…¶ä»–ç”Ÿæˆå™¨ æ—¶,ä¼šåœ¨ PRE_LINK å‘½ä»¤ä¹‹å‰è¿è¡Œ,<li>PRE_LINK: æ­¤å‘½ä»¤å°†åœ¨ç¼–è¯‘æºä»£ç ä¹‹åè¿è¡Œ,åœ¨å¯æ‰§è¡Œæ–‡ä»¶æˆ–å­˜æ¡£å·¥å…·é“¾æ¥åˆ°é™æ€åº“ä¹‹å‰è¿è¡Œ,<li>POS_BUILD: è¿™å°†åœ¨æ‰§è¡Œæ‰€æœ‰å…¶ä»–æ„å»ºè§„åˆ™åè¿è¡Œè¯¥å‘½ä»¤,</ul> <p>ä¸»è¦ç”¨äºå¯¹ç›®æ ‡è¿›è¡Œè¯»å†™,æˆ–æ˜¯ç”Ÿæˆä¸€äº›æ–‡ä»¶</p> <figure class="highlight cmake"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br></pre><td class=code><pre><span class=line><span class=keyword>add_custom_command</span>(OUTPUT archive.tar.gz</span><br><span class=line><span class=keyword>COMMAND</span> cmake -E tar czf <span class=variable>${CMAKE_CURRENT_BINARY_DIR}</span>/archive.tar.gz</span><br><span class=line>$&LTTARGET_FILE:MyTarget></span><br><span class=line>COMMENT <span class=string>"Creating Archive for MyTarget"</span></span><br><span class=line>VERBATIM</span><br><span class=line>)</span><br><span class=line><span class=keyword>add_custom_command</span>(OUTPUT archive.tar.gz</span><br><span class=line><span class=keyword>COMMAND</span> cmake -E tar czf <span class=variable>${CMAKE_CURRENT_BINARY_DIR}</span>/archive.</span><br><span class=line>tar.gz</span><br><span class=line><span class=variable>${CMAKE_CURRENT_SOURCE_DIR}</span>/SomeFile.txt</span><br><span class=line>APPEND</span><br><span class=line>)</span><br></pre></table></figure> <p><code>VERBATIM</code> æ˜¯ä¸€ä¸ªå…³é”®å­—,ç”¨äºæ§åˆ¶å¦‚ä½•è§£é‡Š <code>add_custom_command</code> æˆ– <code>add_custom_target</code> ä¸­å®šä¹‰çš„å‘½ä»¤è¡Œ,å½“ä½ åœ¨å‘½ä»¤ä¸­ä½¿ç”¨ <code>VERBATIM</code> å…³é”®å­—æ—¶,CMake ä¼šå°†æ•´ä¸ªå‘½ä»¤è¡Œä½œä¸ºå•ä¸ªå­—ç¬¦ä¸²ä¼ é€’ç»™æ„å»ºç³»ç»Ÿ,è€Œä¸æ˜¯å°è¯•è§£æå…¶ä¸­çš„å˜é‡æˆ–è¡¨è¾¾å¼</p> <p><strong>é…ç½®æ—¶æ‰§è¡Œè‡ªå®šä¹‰ä»»åŠ¡</strong></p> <p>ç”Ÿæˆåœ¨æ„å»ºå‰éœ€è¦çš„ä¿¡æ¯,æˆ–è€… éœ€è¦æ›´æ–°æ–‡ä»¶ä»¥é‡æ–°è¿è¡Œ CMake,å¦ä¸€ä¸ªæƒ…å†µæ˜¯åœ¨é…ç½®æ­¥éª¤ä¸­ç”Ÿæˆ CMakeLists.txt æ–‡ä»¶æˆ–å…¶ä»–è¾“å…¥ æ–‡ä»¶,ä¹Ÿå¯ä»¥é€šè¿‡ configure_file å®ç°</p> <figure class="highlight cmake"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br></pre><td class=code><pre><span class=line><span class=keyword>execute_process</span>(</span><br><span class=line><span class=keyword>COMMAND</span> SomeExecutable</span><br><span class=line><span class=keyword>COMMAND</span> AnotherExecutable</span><br><span class=line>COMMAND_ERROR_IS_FATAL_ANY</span><br><span class=line>)</span><br><span class=line></span><br></pre></table></figure> <p>æ„å»ºè½¯ä»¶æ—¶,å¸¸è§çš„ä»»åŠ¡æ˜¯åœ¨æ„å»ºå‰å°†ä¸€äº›æ–‡ä»¶å¤åˆ¶åˆ°ç‰¹å®šä½ç½®æˆ–è¿›è¡Œä¿®æ”¹,è§£å†³æ–¹æ¡ˆæ˜¯ä½¿ç”¨ configure_file æŒ‡ä»¤,å¯ä»¥å°†æ–‡ä»¶ä»ä¸€ä¸ªä½ç½®å¤åˆ¶åˆ° å¦ä¸€ä¸ªä½ç½®,</p> <figure class="highlight cmake"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br></pre><td class=code><pre><span class=line><span class=keyword>configure_file</span>(&LTinput> &LToutput></span><br><span class=line>NO_SOURCE_PERMISSIONS | USE_SOURCE_PERMISSIONS |</span><br><span class=line>FILE_PERMISSIONS &LTpermissions>...]</span><br><span class=line>[COPYONLY] [ESCAPE_QUOTES] [@ONLY]</span><br><span class=line>[NEWLINE_STYLE [UNIX|DOS|WIN32|LF|CRLF] ])</span><br></pre></table></figure> <p>configure_file å°†\<input> æ–‡ä»¶å¤åˆ¶åˆ°\<output>æ–‡ä»¶,å°†åˆ›å»ºè¾“å‡ºæ–‡ä»¶çš„è·¯å¾„,è·¯å¾„å¯ä»¥æ˜¯ç›¸å¯¹è·¯å¾„æˆ–ç»å¯¹è·¯å¾„,è‹¥ä½¿ç”¨ç›¸å¯¹è·¯å¾„,åˆ™å°†ä»å½“å‰æºç›®å½•æœç´¢è¾“å…¥æ–‡ä»¶,ä½†<strong>è¾“å‡ºæ–‡ä»¶çš„è·¯å¾„å°†ç›¸å¯¹äºå½“å‰æ„å»ºç›®å½•</strong>, <p>è‹¥ä¸èƒ½å†™å…¥è¾“å‡ºæ–‡ä»¶,å‘½ä»¤å¤±è´¥,é…ç½®åœæ­¢,é€šå¸¸,è¾“å‡ºæ–‡ä»¶ä¸ ç›®æ ‡æ–‡ä»¶å…·æœ‰ç›¸åŒçš„æƒé™,è‹¥å½“å‰ç”¨æˆ·ä¸è¾“å…¥æ–‡ä»¶æ‰€å±çš„ç”¨æˆ·ä¸åŒ,æ‰€æœ‰æƒå¯èƒ½ä¼šå‘ç”Ÿå˜åŒ–, è‹¥æ·»åŠ äº† NO_SOURCE_PERMISSION,åˆ™æƒé™ä¸ä¼šè½¬ç§»,è¾“å‡ºæ–‡ä»¶å°†è·å¾—é»˜è®¤æƒé™ï¼šrw-râ€”râ€”, ä¹Ÿå¯ä»¥ä½¿ç”¨ FILE_PERMISSIONS é€‰é¡¹æ‰‹åŠ¨æŒ‡å®šæƒé™,è¯¥é€‰é¡¹æ¥å—ä¸€ä¸ªä¸‰ä½æ•°çš„æ•°å­—ä½œä¸ºå‚æ•°, USE_SOURCE_PERMISSION å·²ç»æ˜¯é»˜è®¤é€‰é¡¹,è¿™ä¸ªé€‰é¡¹åªæ˜¯ä¸ºäº†æ›´æ˜ç¡®åœ°è¿›è¡Œè¯´æ˜</p> <h3 id=å¯å¤åˆ¶çš„æ„å»ºç¯å¢ƒ><a class=headerlink href=#å¯å¤åˆ¶çš„æ„å»ºç¯å¢ƒ title=å¯å¤åˆ¶çš„æ„å»ºç¯å¢ƒ></a>å¯å¤åˆ¶çš„æ„å»ºç¯å¢ƒ</h3><p>ä¸ºäº†ä½¿ç”¨é¢„è®¾,é¡¹ç›®çš„é¡¶å±‚ç›®å½•å¿…é¡»åŒ…å«åä¸º CMakePresets.json æˆ– CMakeUserPresets.json çš„æ–‡ ä»¶,è‹¥ä¸¤ä¸ªæ–‡ä»¶éƒ½å­˜åœ¨,å°†å…ˆè§£æ CMakePresets.json,å†è§£æ CMakeUserPresets.json,è¿™ä¸¤ä¸ªæ–‡ä»¶ æœ‰ç›¸åŒçš„æ ¼å¼,ä½†ä½¿ç”¨æ–¹å¼ç•¥æœ‰ä¸åŒ:</p> <ul><li>CMakePresets.json ç”±é¡¹ç›®æœ¬èº«æä¾›,å¹¶å¤„ç†é¡¹ç›®ç‰¹å®šçš„äº‹æƒ…,æ¯”å¦‚è¿è¡Œ CI æ„å»º,æˆ–è‹¥é¡¹ç›®æœ¬ èº«éœ€è¦å“ªäº›å·¥å…·é“¾,åº”è¯¥ä½¿ç”¨å“ªäº›å·¥å…·é“¾è¿›è¡Œäº¤å‰ç¼–è¯‘,CMakePresets.json ç”¨äºç‰¹å®šçš„é¡¹ç›®, ä¸åº”è¯¥å¼•ç”¨é¡¹ç›®ç»“æ„å¤–çš„æ–‡ä»¶æˆ–è·¯å¾„,ç”±äºè¿™äº›é¢„è®¾ä¸é¡¹ç›®ç´§å¯†ç›¸è¿,é€šå¸¸ä¹Ÿå¤„äºç‰ˆæœ¬æ§åˆ¶ ä¸­,<li>CMakeUserPresets.json é€šå¸¸ç”±å¼€å‘äººå‘˜å®šä¹‰,ä»¥ä¾¿åœ¨è‡ªå·±çš„æœºå™¨æˆ–æ„å»ºç¯å¢ƒä¸­ä½¿ç”¨, CMakeUserPresets.json å¯ä»¥å°½å¯èƒ½çš„å…·ä½“,åŒ…å«é¡¹ç›®ä¹‹å¤–çš„è·¯å¾„æˆ–ç‰¹å®šç³»ç»Ÿè®¾ç½®ç‰¹æœ‰çš„è·¯å¾„, å› æ­¤,é¡¹ç›®ä¸åº”æä¾›æ­¤æ–‡ä»¶,ä¹Ÿä¸åº”å°†å…¶ç½®äºç‰ˆæœ¬æ§åˆ¶ä¸­,</ul> <p>é¢„è®¾æ˜¯å°†ç¼“å­˜å˜é‡ã€ç¼–è¯‘å™¨æ ‡å¿—ç­‰ç§»å‡º CMakeLists.txt æ–‡ä»¶çš„å¥½æ–¹æ³•,åŒæ—¶ä»¥ä¸€ç§å¯ä»¥åœ¨ CMake ä¸­ä½¿ç”¨çš„æ–¹å¼ä¿æŒå¯ç”¨çš„ä¿¡æ¯,ä»è€Œæé«˜é¡¹ç›®çš„å¯ç§»æ¤æ€§</p> <p>è‹¥é¢„ç½®å¯ç”¨,é€šè¿‡å‘½ä»¤ cmake â€”listpresets å¯ä»¥ä»æºç›®å½•ä¸­åˆ—å‡ºé¢„è®¾</p> <figure class="highlight json"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br></pre><td class=code><pre><span class=line>{</span><br><span class=line><span class=attr>"version"</span>: <span class=number>3</span>,</span><br><span class=line><span class=attr>"cmakeMinimumRequired"</span>: {<span class=attr>"major"</span>: <span class=number>3</span>,<span class=attr>"minor"</span>: <span class=number>21</span>,<span class=attr>"patch"</span>:</span><br><span class=line><span class=number>0</span> },</span><br><span class=line><span class=attr>"configurePresets"</span>: [...],</span><br><span class=line><span class=attr>"buildPresets"</span>: [...],</span><br><span class=line><span class=attr>"testPresets"</span>: [...],</span><br><span class=line><span class=attr>"vendor"</span>: {</span><br><span class=line><span class=attr>"microsoft.com/VisualStudioSettings/CMake/1.9"</span>:</span><br><span class=line>{ <span class=attr>"intelliSenseMode"</span>: <span class=string>"windows-msvc-x64"</span></span><br><span class=line>} }</span><br><span class=line>}</span><br></pre></table></figure> <figure class="highlight json"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br></pre><td class=code><pre><span class=line>{</span><br><span class=line><span class=attr>"version"</span>: <span class=number>3</span>,</span><br><span class=line><span class=attr>"configurePresets"</span>: [</span><br><span class=line>{</span><br><span class=line><span class=attr>"name"</span>: <span class=string>"ninja"</span>,</span><br><span class=line><span class=attr>"displayName"</span>: <span class=string>"Ninja Debug"</span>,</span><br><span class=line><span class=attr>"description"</span>: <span class=string>"build in debug mode using Ninja generator"</span>,</span><br><span class=line><span class=attr>"generator"</span>: <span class=string>"Ninja"</span>,</span><br><span class=line><span class=attr>"binaryDir"</span>: <span class=string>"build"</span>,</span><br><span class=line><span class=attr>"cacheVariables"</span>: { <span class=attr>"CMAKE_BUILD_TYPE"</span>: <span class=string>"Debug"</span> }</span><br><span class=line>}</span><br><span class=line>]</span><br><span class=line>}</span><br></pre></table></figure> <p>å¯ä»¥ä½¿ç”¨inheritså­—æ®µè¿›è¡Œç»§æ‰¿</p> <figure class="highlight json"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br></pre><td class=code><pre><span class=line>{</span><br><span class=line><span class=attr>"version"</span>: <span class=number>3</span>,</span><br><span class=line><span class=attr>"configurePresets"</span>: [</span><br><span class=line>{</span><br><span class=line><span class=attr>"name"</span>: <span class=string>"ci-ninja"</span>,</span><br><span class=line><span class=attr>"generator"</span>: <span class=string>"Ninja"</span>,</span><br><span class=line><span class=attr>"hidden"</span>: <span class=literal>true</span>,</span><br><span class=line><span class=attr>"binaryDir"</span>: <span class=string>"build"</span></span><br><span class=line>},</span><br><span class=line>{</span><br><span class=line><span class=attr>"name"</span>: <span class=string>"ci-ninja-debug"</span>,</span><br><span class=line><span class=attr>"inherits"</span>: <span class=string>"ci-ninja"</span>,</span><br><span class=line><span class=attr>"cacheVariables"</span>: {</span><br><span class=line><span class=attr>"CMAKE_BUILD_TYPE"</span>: <span class=string>"Debug"</span></span><br><span class=line>}</span><br><span class=line>},</span><br><span class=line>{</span><br><span class=line><span class=attr>"name"</span>: <span class=string>"ci-ninja-release"</span>,</span><br><span class=line><span class=attr>"inherits"</span>: <span class=string>"ci-ninja"</span>,</span><br><span class=line><span class=attr>"cacheVariables"</span>: {</span><br><span class=line><span class=attr>"CMAKE_BUILD_TYPE"</span>: <span class=string>"Release"</span></span><br><span class=line>}</span><br><span class=line>}</span><br><span class=line>]</span><br><span class=line>}</span><br></pre></table></figure> <h3 id=åŸºæœ¬æ¨¡å—><a class=headerlink href=#åŸºæœ¬æ¨¡å— title=åŸºæœ¬æ¨¡å—></a>åŸºæœ¬æ¨¡å—</h3><p><strong>å‡½æ•°</strong></p> <figure class="highlight cmake"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br></pre><td class=code><pre><span class=line><span class=keyword>function</span>(git_get_branch_name result_var_name)</span><br><span class=line><span class=keyword>execute_process</span>(</span><br><span class=line><span class=keyword>COMMAND</span> git symbolic-ref -q --short HEAD</span><br><span class=line>WORKING_DIRECTORY <span class=string>"${CMAKE_CURRENT_SOURCE_DIR}"</span></span><br><span class=line>OUTPUT_VARIABLE git_current_branch_name</span><br><span class=line>OUTPUT_STRIP_TRAILING_WHITESPACE</span><br><span class=line>ERROR_QUIET</span><br><span class=line>)</span><br><span class=line><span class=keyword>set</span>(<span class=variable>${result_var_name}</span> <span class=variable>${git_current_branch_name}</span></span><br><span class=line>PARENT_SCOPE)</span><br><span class=line><span class=keyword>endfunction</span>()</span><br></pre></table></figure> <p>å‡½æ•°å®šä¹‰äº†ä¸€ä¸ªæ–°çš„å˜é‡ä½œç”¨åŸŸ,å› æ­¤å¯¹ CMake å˜é‡æ‰€åšçš„æ›´æ”¹åªåœ¨å‡½æ•°ä½“ä¸­å¯è§,ç‹¬ç«‹ä½œ ç”¨åŸŸæ˜¯å‡½æ•°æœ€é‡è¦çš„å±æ€§,æœ‰äº†æ–°çš„ä½œç”¨åŸŸå°±èƒ½é¿å…æ„å¤–åœ°å°†å˜é‡æš´éœ²ç»™ä½¿ç”¨è€…,é™¤éæˆ‘ä»¬æƒ³è¿™æ ·åš</p> <p>å¤§å¤šæ•°æ—¶å€™,æˆ‘ä»¬å¸Œæœ›åœ¨<strong>å‡½æ•°çš„ä½œç”¨åŸŸä¸­åŒ…å«æ›´æ”¹</strong>,å¹¶ä¸”<strong>åªå°†å‡½æ•°çš„ç»“æœåæ˜ ç»™ä½¿ç”¨è€…</strong>,ç”±äº CMake æ²¡æœ‰è¿”å›å€¼çš„æ¦‚å¿µ,æˆ‘ä»¬å°†é‡‡ç”¨åœ¨è°ƒç”¨è€…çš„ä½œç”¨åŸŸæ–¹æ³•ä¸­å®šä¹‰ä¸€ä¸ªå˜é‡æ¥å°†å‡½æ•°ç»“æœè¿”å›ç»™ä½¿ç”¨è€…</p> <p><strong>å®</strong></p> <p>å®ä¸å®šä¹‰æ–°çš„å˜é‡ä½œç”¨åŸŸ</p> <figure class="highlight cmake"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br></pre><td class=code><pre><span class=line><span class=keyword>macro</span>(git_get_branch_name_m result_var_name)</span><br><span class=line><span class=keyword>execute_process</span>(</span><br><span class=line><span class=keyword>COMMAND</span> git symbolic-ref -q --short HEAD</span><br><span class=line>WORKING_DIRECTORY <span class=string>"${CMAKE_CURRENT_SOURCE_DIR}"</span></span><br><span class=line>OUTPUT_VARIABLE <span class=variable>${result_var_name}</span></span><br><span class=line>OUTPUT_STRIP_TRAILING_WHITESPACE</span><br><span class=line>ERROR_QUIET</span><br><span class=line>)</span><br><span class=line><span class=keyword>endmacro</span>()</span><br></pre></table></figure> <h2 id=å…·ä½“é¡¹ç›®><a class=headerlink href=#å…·ä½“é¡¹ç›® title=å…·ä½“é¡¹ç›®></a>å…·ä½“é¡¹ç›®</h2><p>å‚è€ƒ<a href=https://github.com/Ubpa/UCMake/blob/master/cmake/UbpaBasic.cmake rel=noopener target=_blank>UCMake/cmake/UbpaBasic.cmake at master Â· Ubpa/UCMake (github.com)</a></p> <p>é¦–å…ˆä»‹ç»ä¸€ä¸‹å…¶ä¸­ç”¨åˆ°çš„æ–¹æ³•,æ­ä¸€ä¸ªcmakeé¡¹ç›®,ä¸»è¦é€»è¾‘æ˜¯åˆ©ç”¨includeå’Œadd_subdirectoryå¢åŠ æ¨¡å—,åŒæ—¶è®¾ç½®æ›´å¤šå˜è„¸. ä½¿ç”¨functionå’Œmacroå†™ä¸€äº›å·¥å…·æ–¹æ³•.</p> <figure class="highlight cmake"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line><span class=keyword>cmake_parse_arguments</span>(PREFIX  [<span class=keyword>OPTION</span> names]  [ONE_VALUE names]  [MULTI_VALUE names]  [UNPARSED_ARGUMENTS var]  [args...] )</span><br></pre></table></figure> <p>å‚æ•°è§£é‡Š</p> <ul><li><strong>PREFIX</strong>ï¼šä¸€ä¸ªå­—ç¬¦ä¸²,ç”¨äºå‰ç¼€å‘½åè§£æå‡ºæ¥çš„å˜é‡.<li><strong>OPTION</strong>ï¼šå¯é€‰å…³é”®å­—å‚æ•°åˆ—è¡¨,æ¯ä¸ªå‚æ•°åªæ¥å—æˆ–ä¸æ¥å—ä¸€ä¸ªå€¼,é€šå¸¸ç”¨äºå¼€å…³é€‰é¡¹.<li><strong>ONE_VALUE</strong>ï¼šå…³é”®å­—å‚æ•°åˆ—è¡¨,æ¯ä¸ªå‚æ•°æ¥å—ä¸€ä¸ªå€¼.<li><strong>MULTI_VALUE</strong>ï¼šå…³é”®å­—å‚æ•°åˆ—è¡¨,æ¯ä¸ªå‚æ•°å¯ä»¥æ¥å—ä¸€ä¸ªæˆ–å¤šä¸ªå€¼.<li><strong>UNPARSED_ARGUMENTS</strong>ï¼šä¸€ä¸ªå˜é‡å,æœªè§£æçš„å‚æ•°å°†è¢«å­˜å‚¨åœ¨è¿™ä¸ªå˜é‡ä¸­.<li><strong>argsâ€¦</strong>ï¼šä¼ é€’ç»™<code>cmake_parse_arguments()</code>çš„å®é™…å‚æ•°åˆ—è¡¨</ul> <p><code>CMAKE_MODULE_PATH</code>æ˜¯CMakeä¸­çš„ä¸€ä¸ªç¯å¢ƒå˜é‡,ç”¨äºæŒ‡å®šCMakeåº”è¯¥æœç´¢é¢å¤–æ¨¡å—æ–‡ä»¶çš„ç›®å½•åˆ—è¡¨.è¿™äº›æ¨¡å—æ–‡ä»¶é€šå¸¸åŒ…å«è‡ªå®šä¹‰çš„CMakeå‡½æ•°å’Œå®,æˆ–è€…åŒ…å«ç”¨äºæŸ¥æ‰¾ç‰¹å®šåº“ã€åŒ…çš„é…ç½®æ–‡ä»¶.</p> <p>éœ€è¦åœ¨å¼€å§‹è®¾ç½®çš„å±æ€§æ¯”è¾ƒå¤š,åŒ…æ‹¬ç¼–è¯‘å™¨åŠå…¶ç‰ˆæœ¬,è¾“å‡ºç›®æ ‡ç›®å½•,æ„å»ºç±»å‹ç­‰ç­‰</p> <p>è¿™äº›å…¶å®å¯ä»¥åœ¨CMAKE -Dä¸­è®¾ç½®</p> <figure class="highlight autoit"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br></pre><td class=code><pre><span class=line>CMAKE_BUILD_TYPE:<span class=built_in>STRING</span> <span class=meta>#æ„å»ºç±»å‹</span></span><br><span class=line>CMAKE_CXX_COMPILER <span class=meta>#ä¿®æ”¹ç¼–è¯‘å™¨</span></span><br><span class=line>DCMAKE_CXX_FLAGS:<span class=built_in>STRING</span>=<span class=string>"-Wall</span></span><br><span class=line><span class=string>  -Werror"</span>  <span class=meta># æ„å»ºæ ‡å¿—</span></span><br></pre></table></figure> <blockquote><p>CMAKE_BUILD_TYPE å˜é‡åªå¯¹å•é…ç½®ç”Ÿæˆå™¨æœ‰æ„ä¹‰,ä¾‹å¦‚ Unix Makefiles å’Œ Ninja.åœ¨å¤šé… ç½®ç”Ÿæˆå™¨ä¸­,ä¾‹å¦‚ Visual Studio,<strong>æ„å»ºç±»å‹æ˜¯ä¸€ä¸ªæ„å»ºæ—¶å‚æ•°,ä¸æ˜¯ä¸€ä¸ªé…ç½®æ—¶å‚æ•°,å› æ­¤ ä¸èƒ½é€šè¿‡ä½¿ç”¨ CMAKE_BUILD_TYPE æ¥é…ç½®</strong></blockquote> <p>CMake æœ¬èº«æä¾›äº†å››ç§æ„å»ºç±»å‹:</p> <p>â€¢ Debug: æœªä¼˜åŒ–,åŒ…å«æ‰€æœ‰è°ƒè¯•ç¬¦å·,æ‰€æœ‰çš„æ–­è¨€éƒ½æ˜¯å¯ç”¨çš„.è¿™ä¸ GCC å’Œ Clang è®¾ç½®-O0 -g æ˜¯ä¸€æ ·çš„.</p> <p>â€¢ Release: å¯¹è¿è¡Œé€Ÿåº¦è¿›è¡Œä¼˜åŒ–,æ²¡æœ‰è°ƒè¯•ç¬¦å·å’Œæ–­è¨€ç¦ç”¨.é€šå¸¸,è¿™æ˜¯ç”¨äºäº¤ä»˜çš„æ„å»ºç±»å‹. è¿™ä¸-O3 -DNDEBUG ç›¸åŒ.</p> <p>â€¢ RelWithDebInfo: æä¾›ä¼˜åŒ–,å¹¶åŒ…æ‹¬è°ƒè¯•ç¬¦å·,ç¦ç”¨æ–­è¨€,è¿™ä¸-O2 -g -DNDEBUG ç›¸åŒ.</p> <p>â€¢ MinSizeRel: è¿™å’Œ Release æ˜¯ä¸€æ ·çš„,ä½†ä¼˜åŒ–äº†äºŒè¿›åˆ¶å¤§å°,è€Œä¸æ˜¯é€Ÿåº¦,è¿™ä¸-Os -DNDEBUG ç›¸åŒ.æ³¨æ„,å¹¶ä¸æ˜¯æ‰€æœ‰å¹³å°ä¸Šçš„ç”Ÿæˆå™¨éƒ½æ”¯æŒæ­¤é…ç½®.</p> <p>æ„å»ºæ ‡å¿—å¯ä»¥ä¸ºæ¯ä¸ªæ„å»ºç±»å‹å®šåˆ¶,æ–¹æ³•æ˜¯åœ¨å®ƒä»¬åé¢åŠ ä¸Šå¤§å†™çš„æ„å»ºç±»å‹å­—ç¬¦ä¸².æœ‰å››ä¸ªå˜ é‡ç”¨äºå››ä¸ªä¸åŒçš„æ„å»ºç±»å‹,å®ƒä»¬å¯¹äºæ ¹æ®ç¼–è¯‘å™¨æ ‡å¿—æŒ‡å®šæ„å»ºç±»å‹éå¸¸æœ‰ç”¨.è¿™äº›å˜é‡ä¸­æŒ‡å®šçš„ æ ‡å¿—åªåœ¨é…ç½®æ„å»ºç±»å‹åŒ¹é…æ—¶æœ‰æ•ˆ: 1. CMAKE__FLAGS_DEBUG 2. CMAKE<strong>FLAGS_RELEASE 3. CMAKE\</strong>FLAGS_RELWITHDEBINFO 4. CMAKE__FLAGS_MINSIZEREL</p> <h2 id=Beyond-CMake><a title="Beyond CMake" class=headerlink href=#Beyond-CMake></a>Beyond CMake</h2><p>CMakeèƒ½å¤Ÿå¾ˆå¥½ä¸Vcpkgä¸Conanç»“åˆ,é™¤äº†CMakeç”¨ä½œæ„å»ºã€ä¾èµ–ç®¡ç†å·¥å…·ä¹‹å¤–,è¿˜æœ‰<a href=https://mesonbuild.com/Quick-guide.html rel=noopener target=_blank>Meson</a>,<a href=https://bazel.google.cn/versions/7.3.0/about/intro?hl=zh-cn rel=noopener target=_blank>Bazel</a>,<a href=https://premake.github.io/ rel=noopener target=_blank>Premake</a>ä»¥åŠ<a href=https://xmake.io/#/ rel=noopener target=_blank>xmake</a>. ç›¸å…³è®¨è®º<a href=https://www.reddit.com/r/cpp/comments/eppqhj/cmake_vs_meson_vs_bazel/ rel=noopener target=_blank>CMake vs Meson vs Bazel ? : r/cpp</a>,<a href=https://github.com/xmake-io/xmake/discussions/1863 rel=noopener target=_blank>How is this different than premake? What does it do better? Â· xmake-io/xmake Â· Discussion #1863</a>. è¿™é‡Œç®€å•ä½¿ç”¨Mesonå¯¹æ¯”ä¸€ä¸‹.</p> <blockquote><p>äº‹å®ä¸Š,CMakeã€Mesonéƒ½ç®—æ˜¯Project management(generator),è€Œmakeã€ninjaæ‰æ˜¯build backend.è€ŒXmakeç®—æ˜¯Project management+build backend+package manager.<p>å…¶ä¸­CMakeå’ŒMesonä½¿ç”¨è‡ªåˆ¶çš„è¯­æ³•,xmakeå’Œpremakeä½¿ç”¨luaé…ç½®</blockquote> <p>åœ¨é¡¹ç›®ä¸­åˆ›å»º<code>meson.build</code>æ–‡ä»¶</p> <figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br></pre><td class=code><pre><span class=line>project('tutorial','c')</span><br><span class=line>executable('demo','main.c')</span><br></pre></table></figure> <figure class="highlight sh"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line>meson setup builddir</span><br></pre></table></figure> <p>mesonä¸éœ€è¦åœ¨é…ç½®ä¸­æ˜¾ç¤ºæ·»åŠ å¤´æ–‡ä»¶åˆ°sourcesä¸­.Meson ä½¿ç”¨ Ninjaï¼Œ<strong>Ninja ä½¿ç”¨ç¼–è¯‘å™¨ä¾èµ–ä¿¡æ¯æ¥è‡ªåŠ¨ç¡®å®š C æºæ–‡ä»¶å’Œå¤´æ–‡ä»¶ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œå› æ­¤å½“å¤´æ–‡ä»¶å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå®ƒå°†æ­£ç¡®åœ°é‡æ–°æ„å»ºå†…å®¹</strong>ã€‚</p> <p><code>setup builddir</code>è¡¨ç¤ºè¿›è¡Œé…ç½®,ã€‚Meson ä¸å…¶ä»–ä¸€äº›æ„å»ºç³»ç»Ÿä¸åŒï¼Œå®ƒä¸å…è®¸æºç æ„å»ºã€‚å¿…é¡»å§‹ç»ˆåˆ›å»ºä¸€ä¸ªå•ç‹¬çš„æ„å»ºç›®å½•ã€‚å¸¸è§çš„åšæ³•æ˜¯å°†é»˜è®¤æ„å»ºç›®å½•æ”¾åœ¨é¡¶çº§æºç›®å½•çš„å­ç›®å½•ä¸­.</p> <figure class="highlight sh"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br></pre><td class=code><pre><span class=line>meson compile -C builddir or</span><br><span class=line><span class=built_in>cd</span> builddir</span><br><span class=line>meason compile</span><br></pre></table></figure> <p><code>-C</code> å‚æ•°å‘Šè¯‰ Meson é…ç½®çš„æ„å»ºç›®å½•.</p> <p>Meson æœ‰ä¸€ä¸ªç”¨äºä¸‹è½½å’Œæ„å»ºï¼ˆå¦‚æœéœ€è¦ï¼‰ä¾èµ–é¡¹çš„ Web æœåŠ¡ï¼Œç§°ä¸º WrapDBã€‚å¯ä»¥ä¸‹è½½ä¾èµ–é¡¹ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨å®ƒã€‚é¦–å…ˆéœ€è¦åˆ›å»ºä¸€ä¸ª <code>subprojects</code> ç›®å½•ï¼Œå› ä¸ºåœ¨ Meson ä¸­ï¼Œæ‰€æœ‰è¿™äº›å­é¡¹ç›®éƒ½å¿…é¡»å­˜å‚¨åœ¨è¯¥ç›®å½•ä¸­ä»¥ä¿æŒä¸€è‡´æ€§<a href=https://mesonbuild.com/Wrapdb-projects.html rel=noopener target=_blank>Meson WrapDB packages</a></p> <figure class="highlight arduino"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line>mkdir subprojects</span><br></pre></table></figure> <p>ä¸‹è½½ä¾èµ–å‘½ä»¤å¦‚ä¸‹</p> <figure class="highlight sh"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line>meson wrap install sdl2</span><br></pre></table></figure> <p>è¿™æ˜¯ä¸€ä¸ªåŒ…å«å…·æœ‰ä¸Šæ¸¸ Meson æ„å»ºç³»ç»Ÿæˆ–ç”± Meson å›¢é˜Ÿç»´æŠ¤çš„ç«¯å£çš„é¡¹ç›®åˆ—è¡¨ã€‚å®ƒä»¬å¯ä»¥è¢«æ‚¨çš„é¡¹ç›®ç”¨æ¥æä¾›å…¶ä¾èµ–é¡¹ã€‚ä½¿ç”¨å‘½ä»¤è¡Œ <code>meson wrap install &LTproject></code> å°†è¿™äº›é¡¹ç›®çš„ wrap æ–‡ä»¶å®‰è£…åˆ°é¡¹ç›® <code>subprojects/</code> ç›®å½•ä¸­ã€‚</p> <figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br></pre><td class=code><pre><span class=line>project('sdldemo', 'c',</span><br><span class=line>        default_options: 'default_library=static')</span><br><span class=line></span><br><span class=line>sdl2_dep = dependency('sdl2')</span><br><span class=line>sdl2_main_dep = dependency('sdl2main')</span><br><span class=line></span><br><span class=line>executable('sdlprog', 'sdlprog.c',</span><br><span class=line>           win_subsystem: 'windows',</span><br><span class=line>           dependencies: [sdl2_dep, sdl2_main_dep])</span><br></pre></table></figure> <h3 id=å‚è€ƒèµ„æ–™><a class=headerlink href=#å‚è€ƒèµ„æ–™ title=å‚è€ƒèµ„æ–™></a>å‚è€ƒèµ„æ–™</h3><ol><li><a href=https://blog.csdn.net/llffss/article/details/120121617 rel=noopener target=_blank>cmakeæŒ‡ä»¤æ±‡æ€»_cmakeå‘½ä»¤å¤§å…¨_nuosen123çš„åšå®¢-CSDNåšå®¢</a><li><a href=https://www.runoob.com/w3cnote/cpp-static-library-and-dynamic-library.html rel=noopener target=_blank>C++é™æ€åº“ä¸åŠ¨æ€åº“ | èœé¸Ÿæ•™ç¨‹ (runoob.com)</a><li><a href=https://zhuanlan.zhihu.com/p/578843962 rel=noopener target=_blank>ä½¿ç”¨C++åˆ›å»ºå¹¶è°ƒç”¨åŠ¨æ€é“¾æ¥åº“(dll) - çŸ¥ä¹ (zhihu.com)</a><li><a href=https://blog.csdn.net/Op_chaos/article/details/110476264?spm=1001.2101.3001.6650.7&utm_medium=distribute.pc_relevant.none-task-blog-2~default~CTRLIST~Rate-7-110476264-blog-120121617.235^v38^pc_relevant_anti_t3_base&depth_1-utm_source=distribute.pc_relevant.none-task-blog-2~default~CTRLIST~Rate-7-110476264-blog-120121617.235^v38^pc_relevant_anti_t3_base&utm_relevant_index=11 rel=noopener target=_blank>CMakeæŒ‡ä»¤è¯¦è§£_cmake -d-CSDNåšå®¢</a><li><a href=https://blog.csdn.net/qq_25160757/article/details/79813428 rel=noopener target=_blank>VSçš„åŒ…å«ç›®å½•ã€åº“ç›®å½•ã€å¼•ç”¨ç›®å½•ã€å¯æ‰§è¡Œç›®å½•è§£é‡Š_vsåŒ…å«ç›®å½•å’Œå¼•ç”¨ç›®å½•-CSDNåšå®¢</a><li><a href=https://www.cnblogs.com/pandamohist/p/13674438.html rel=noopener target=_blank>cmakeä¹‹Visual studioæ— æ³•æ˜¾ç¤ºå¤´æ–‡ä»¶ - mohist - åšå®¢å›­ (cnblogs.com)</a><li><a href=https://blog.csdn.net/sandalphon4869/article/details/100589747 rel=noopener target=_blank>Linuxä¹‹cmakeçš„æŒ‡ä»¤ä»¥åŠå†…éƒ¨æ„å»ºå’Œå¤–éƒ¨æ„å»º_cmake å¤–éƒ¨ç¼–è¯‘-CSDNåšå®¢</a><li><a href=https://www.cnblogs.com/guoshuai-ouc/p/cmake_variable.html rel=noopener target=_blank>cmake å¸¸ç”¨å˜é‡å’Œå¸¸ç”¨ç¯å¢ƒå˜é‡ - å°æœå­å•Š - åšå®¢å›­ (cnblogs.com)</a><li><a href=https://blog.csdn.net/qq_38410730/article/details/102477162 rel=noopener target=_blank>ã€CMakeã€‘CMakeLists.txtçš„è¶…å‚»ç“œæ‰‹æŠŠæ‰‹æ•™ç¨‹ï¼ˆé™„å®ä¾‹æºç ï¼‰_ã€cmakeã€‘cmakelists.txtçš„è¶…å‚»ç“œæ‰‹æŠŠæ‰‹æ•™ç¨‹(é™„å®ä¾‹æºç )-CSDNåšå®¢</a><li><a href=https://developer.aliyun.com/article/243229#:~:text=å®˜ç½‘ä¸æ¨èä½¿ç”¨l,ariesä½¿ç”¨. rel=noopener target=_blank>makeçš„link_directorieså‘½ä»¤ä¸èµ·ä½œç”¨-é˜¿é‡Œäº‘å¼€å‘è€…ç¤¾åŒº (aliyun.com)</a><li><a href=https://cmake.org/cmake/help/latest/ rel=noopener target=_blank>CMake Reference Documentation â€” CMake 3.28.0-rc1 Documentation</a><li><a href=https://blog.csdn.net/afei__/article/details/81201039 rel=noopener target=_blank>CMakeLists.txt è¯­æ³•ä»‹ç»ä¸å®ä¾‹æ¼”ç»ƒ-CSDNåšå®¢</a><li><a href=https://www.bookstack.cn/read/Modern-CMake-CN-Modern-CMake-zh_CN/701c8402c6158612.md rel=noopener target=_blank>ç°ä»£çš„ CMake çš„ä»‹ç» - ã€ŠModern CMake ç®€ä½“ä¸­æ–‡ç‰ˆã€‹ - ä¹¦æ ˆç½‘ Â· BookStack</a><li><a href=https://cmakebyexample.dev/ rel=noopener target=_blank>CMake by Example</a><li><a href=https://makefiletutorial.com/#makefile-cookbook rel=noopener target=_blank>Makefile Tutorial By Example</a><li><a href=https://www.youtube.com/watch?v=bsXLMQ6WgIk&ab_channel=CppNow rel=noopener target=_blank>C ++ç°åœ¨2017å¹´ï¼šä¸¹å°¼å°”Â·è²è´¹å°”â€œæœ‰æ•ˆçš„CMakeâ€ (youtube.com)</a></ol> <link href=/css/spoiler.css rel=stylesheet><script async src=/js/spoiler.js></script> <div><div><div style="text-align:center;color: #ccc;font-size:14px;">-------------æœ¬æ–‡ç»“æŸ<i class="fa fa-paw"></i>æ„Ÿè°¢æ‚¨çš„é˜…è¯»-------------</div></div></div> <div class=reward-container><div>æ„Ÿè°¢é˜…è¯».</div><button onclick="var qr = document.getElementById('qr'); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">æ‰“èµ</button><div style="display: none;" id=qr><div style="display: inline-block;"><img alt="Sekyoro å¾®ä¿¡æ”¯ä»˜" src=/images/wechatpay.png><p>å¾®ä¿¡æ”¯ä»˜</div></div></div> <div><ul class=post-copyright><li class=post-copyright-author><strong>æœ¬æ–‡ä½œè€…ï¼š </strong>Sekyoro<li class=post-copyright-link><strong>æœ¬æ–‡é“¾æ¥ï¼š</strong> <a href=https://www.sekyoro.top/2023/10/11/cmake%E5%AD%A6%E4%B9%A0/ title=cmakeå­¦ä¹ >https://www.sekyoro.top/2023/10/11/cmakeå­¦ä¹ /</a><li class=post-copyright-license><strong>ç‰ˆæƒå£°æ˜ï¼š </strong>æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href=https://creativecommons.org/licenses/by-nc-sa/4.0/ rel=noopener target=_blank><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼</ul></div> <div class=followme><p>æ¬¢è¿å…³æ³¨æˆ‘çš„å…¶å®ƒå‘å¸ƒæ¸ é“<div class=social-list><div class=social-item><a class=social-link href=/images/wxqrcode.png target=_blank> <span class=icon> <i class="fab fa-weixin"></i> </span> <span class=label>WeChat</span> </a></div><div class=social-item><a class=social-link href=/images/website.png target=_blank> <span class=icon> <i class="fa fa-user"></i> </span> <span class=label>PersonalWebsite</span> </a></div><div class=social-item><a class=social-link href=https://my-astro-git-main-drowning-in-codes.vercel.app target=_blank> <span class=icon> <i class="fas fa-share"></i> </span> <span class=label>æ‚é±¼åˆ†äº«</span> </a></div><div class=social-item><a class=social-link href=/atom.xml target=_blank> <span class=icon> <i class="fa fa-rss"></i> </span> <span class=label>RSS</span> </a></div></div></div> <footer class=post-footer><div class=post-tags><a href=/tags/CMake/ rel=tag><i class="fa fa-tag"></i> CMake</a></div><div class=post-nav><div class=post-nav-item><a href=/2023/10/04/stable-diffusion%E5%AD%A6%E4%B9%A0/ rel=prev title=stable_diffusionå­¦ä¹ > <i class="fa fa-chevron-left"></i> stable_diffusionå­¦ä¹  </a></div><div class=post-nav-item><a title="ç›®æ ‡æ£€æµ‹(Object Detection)å­¦ä¹ _P1" href=/2023/10/11/%E7%9B%AE%E6%A0%87%E6%A3%80%E6%B5%8B-Object-Detection-%E5%AD%A6%E4%B9%A0/ rel=next> ç›®æ ‡æ£€æµ‹(Object Detection)å­¦ä¹ _P1 <i class="fa fa-chevron-right"></i> </a></div></div></footer> <!-- è¯„è®ºåŒº --> <div class=comments><div data-id=city data-uid=MTAyMC81MzE5Ny8yOTY3Mg== id=lv-container></div></div> <script>window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }</script> <div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div> <aside class=sidebar><div class=sidebar-inner><!-- canvasç²’å­æ—¶é’Ÿ --><div><canvas id=canvas style=width:60%;>å½“å‰æµè§ˆå™¨ä¸æ”¯æŒcanvasï¼Œè¯·æ›´æ¢æµè§ˆå™¨åå†è¯•</canvas></div><script>(function(){

   var digit=
    [
        [
            [0,0,1,1,1,0,0],
            [0,1,1,0,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,0,1,1,0],
            [0,0,1,1,1,0,0]
        ],//0
        [
            [0,0,0,1,1,0,0],
            [0,1,1,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [1,1,1,1,1,1,1]
        ],//1
        [
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,0,1,1,0,0,0],
            [0,1,1,0,0,0,0],
            [1,1,0,0,0,0,0],
            [1,1,0,0,0,1,1],
            [1,1,1,1,1,1,1]
        ],//2
        [
            [1,1,1,1,1,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,0,0,1,1,0],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//3
        [
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,1,0],
            [0,0,1,1,1,1,0],
            [0,1,1,0,1,1,0],
            [1,1,0,0,1,1,0],
            [1,1,1,1,1,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,0,1,1,0],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,1,1]
        ],//4
        [
            [1,1,1,1,1,1,1],
            [1,1,0,0,0,0,0],
            [1,1,0,0,0,0,0],
            [1,1,1,1,1,1,0],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//5
        [
            [0,0,0,0,1,1,0],
            [0,0,1,1,0,0,0],
            [0,1,1,0,0,0,0],
            [1,1,0,0,0,0,0],
            [1,1,0,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//6
        [
            [1,1,1,1,1,1,1],
            [1,1,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,1,1,0,0,0],
            [0,0,1,1,0,0,0],
            [0,0,1,1,0,0,0],
            [0,0,1,1,0,0,0]
        ],//7
        [
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//8
        [
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,1,1,0,0,0,0]
        ],//9
        [
            [0,0,0,0,0,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,0,0,0,0,0]
        ]//:
    ];

var canvas = document.getElementById('canvas');

if(canvas.getContext){
    var cxt = canvas.getContext('2d');
    //å£°æ˜canvasçš„å®½é«˜
    var H = 100,W = 700;
    canvas.height = H;
    canvas.width = W;
    cxt.fillStyle = '#f00';
    cxt.fillRect(10,10,50,50);

    //å­˜å‚¨æ—¶é—´æ•°æ®
    var data = [];
    //å­˜å‚¨è¿åŠ¨çš„å°çƒ
    var balls = [];
    //è®¾ç½®ç²’å­åŠå¾„
    var R = canvas.height/20-1;
    (function(){
        var temp = /(\d)(\d):(\d)(\d):(\d)(\d)/.exec(new Date());
        //å­˜å‚¨æ—¶é—´æ•°å­—ï¼Œç”±åä½å°æ—¶ã€ä¸ªä½å°æ—¶ã€å†’å·ã€åä½åˆ†é’Ÿã€ä¸ªä½åˆ†é’Ÿã€å†’å·ã€åä½ç§’é’Ÿã€ä¸ªä½ç§’é’Ÿè¿™7ä¸ªæ•°å­—ç»„æˆ
        data.push(temp[1],temp[2],10,temp[3],temp[4],10,temp[5],temp[6]);
    })();

    /*ç”Ÿæˆç‚¹é˜µæ•°å­—*/
    function renderDigit(index,num){
        for(var i = 0; i < digit[num].length; i++){
            for(var j = 0; j < digit[num][i].length; j++){
                if(digit[num][i][j] == 1){
                    cxt.beginPath();
                    cxt.arc(14*(R+2)*index + j*2*(R+1)+(R+1),i*2*(R+1)+(R+1),R,0,2*Math.PI);
                    cxt.closePath();
                    cxt.fill();
                }
            }
        }
    }

    /*æ›´æ–°æ—¶é’Ÿ*/
    function updateDigitTime(){
        var changeNumArray = [];
        var temp = /(\d)(\d):(\d)(\d):(\d)(\d)/.exec(new Date());
        var NewData = [];
        NewData.push(temp[1],temp[2],10,temp[3],temp[4],10,temp[5],temp[6]);
        for(var i = data.length-1; i >=0 ; i--){
            //æ—¶é—´å‘ç”Ÿå˜åŒ–
            if(NewData[i] !== data[i]){
                //å°†å˜åŒ–çš„æ•°å­—å€¼å’Œåœ¨dataæ•°ç»„ä¸­çš„ç´¢å¼•å­˜å‚¨åœ¨changeNumArrayæ•°ç»„ä¸­
                changeNumArray.push(i+'_'+(Number(data[i])+1)%10);
            }
        }
        //å¢åŠ å°çƒ
        for(var i = 0; i< changeNumArray.length; i++){
            addBalls.apply(this,changeNumArray[i].split('_'));
        }
        data = NewData.concat();
    }

    /*æ›´æ–°å°çƒçŠ¶æ€*/
    function updateBalls(){
        for(var i = 0; i < balls.length; i++){
            balls[i].stepY += balls[i].disY;
            balls[i].x += balls[i].stepX;
            balls[i].y += balls[i].stepY;
            if(balls[i].x > W + R || balls[i].y > H + R){
                balls.splice(i,1);
                i--;
            }
        }
    }

    /*å¢åŠ è¦è¿åŠ¨çš„å°çƒ*/
    function addBalls(index,num){
        var numArray = [1,2,3];
        var colorArray =  ["#3BE","#09C","#A6C","#93C","#9C0","#690","#FB3","#F80","#F44","#C00"];
        for(var i = 0; i < digit[num].length; i++){
            for(var j = 0; j < digit[num][i].length; j++){
                if(digit[num][i][j] == 1){
                    var ball = {
                        x:14*(R+2)*index + j*2*(R+1)+(R+1),
                        y:i*2*(R+1)+(R+1),
                        stepX:Math.floor(Math.random() * 4 -2),
                        stepY:-2*numArray[Math.floor(Math.random()*numArray.length)],
                        color:colorArray[Math.floor(Math.random()*colorArray.length)],
                        disY:1
                    };
                    balls.push(ball);
                }
            }
        }
    }

    /*æ¸²æŸ“*/
    function render(){
        //é‡ç½®ç”»å¸ƒå®½åº¦ï¼Œè¾¾åˆ°æ¸…ç©ºç”»å¸ƒçš„æ•ˆæœ
        canvas.height = 100;
        //æ¸²æŸ“æ—¶é’Ÿ
        for(var i = 0; i < data.length; i++){
            renderDigit(i,data[i]);
        }
        //æ¸²æŸ“å°çƒ
        for(var i = 0; i < balls.length; i++){
            cxt.beginPath();
            cxt.arc(balls[i].x,balls[i].y,R,0,2*Math.PI);
            cxt.fillStyle = balls[i].color;
            cxt.closePath();
            cxt.fill();
        }
    }

    clearInterval(oTimer);
    var oTimer = setInterval(function(){
        //æ›´æ–°æ—¶é’Ÿ
        updateDigitTime();
        //æ›´æ–°å°çƒçŠ¶æ€
        updateBalls();
        //æ¸²æŸ“
        render();
    },50);
}

})();</script><!-- require APlayer --><link href=https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js></script><!-- require MetingJS --><script src=/js/meting-js.js></script><ul class="sidebar-nav motion-element"><li class=sidebar-nav-toc>æ–‡ç« ç›®å½•<li class=sidebar-nav-overview>ç«™ç‚¹æ¦‚è§ˆ</ul><!--noindex--><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class=nav><li class="nav-item nav-level-2"><a class=nav-link href=#Before-cmake><span class=nav-number>1.</span> <span class=nav-text>Before cmake</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#syntax><span class=nav-number>1.1.</span> <span class=nav-text>syntax</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#more-examples><span class=nav-number>1.2.</span> <span class=nav-text>more examples</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#clean><span class=nav-number>1.3.</span> <span class=nav-text>clean</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#variables><span class=nav-number>1.4.</span> <span class=nav-text>variables</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#Targets><span class=nav-number>1.5.</span> <span class=nav-text>Targets</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#automatic-variables-and-wildcards><span class=nav-number>1.6.</span> <span class=nav-text>automatic variables and wildcards</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#%E9%9A%90%E5%BC%8F%E8%A7%84%E5%88%99><span class=nav-number>1.7.</span> <span class=nav-text>éšå¼è§„åˆ™</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#%E6%9D%A1%E4%BB%B6><span class=nav-number>1.8.</span> <span class=nav-text>æ¡ä»¶</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#%E5%87%BD%E6%95%B0><span class=nav-number>1.9.</span> <span class=nav-text>å‡½æ•°</span></a></ol><li class="nav-item nav-level-2"><a class=nav-link href=#cmake-fundamental><span class=nav-number>2.</span> <span class=nav-text>cmake fundamental</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#%E5%B8%B8%E7%94%A8%E5%8F%98%E9%87%8F><span class=nav-number>3.</span> <span class=nav-text>å¸¸ç”¨å˜é‡</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#%E6%8C%87%E5%AE%9A%E7%94%9F%E6%88%90%E7%A8%8B%E5%BA%8F><span class=nav-number>4.</span> <span class=nav-text>æŒ‡å®šç”Ÿæˆç¨‹åº</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#%E6%B7%BB%E5%8A%A0%E5%A4%B4%E6%96%87%E4%BB%B6%E7%9B%AE%E5%BD%95%E5%92%8C%E5%BA%93><span class=nav-number>5.</span> <span class=nav-text>æ·»åŠ å¤´æ–‡ä»¶ç›®å½•å’Œåº“</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#find-package-amp-find-path-amp-find-library><span class=nav-number>6.</span> <span class=nav-text>find_package&find_path&find_library</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#%E7%BC%96%E8%AF%91%E6%97%B6%E6%B6%88%E6%81%AF%E8%BE%93%E5%87%BA><span class=nav-number>7.</span> <span class=nav-text>ç¼–è¯‘æ—¶æ¶ˆæ¯è¾“å‡º</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#%E8%AE%BE%E7%BD%AE%E5%8F%98%E9%87%8F><span class=nav-number>8.</span> <span class=nav-text>è®¾ç½®å˜é‡</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#%E6%8E%A7%E5%88%B6%E7%BB%93%E6%9E%84><span class=nav-number>9.</span> <span class=nav-text>æ§åˆ¶ç»“æ„</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#%E6%B7%BB%E5%8A%A0%E5%85%B6%E4%BB%96%E5%AD%90%E7%9B%AE%E5%BD%95><span class=nav-number>10.</span> <span class=nav-text>æ·»åŠ å…¶ä»–å­ç›®å½•</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#%E8%8E%B7%E5%8F%96%E6%96%87%E4%BB%B6><span class=nav-number>11.</span> <span class=nav-text>è·å–æ–‡ä»¶</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#vs%E4%B8%AD%E6%98%BE%E7%A4%BA%E5%A4%B4%E6%96%87%E4%BB%B6><span class=nav-number>12.</span> <span class=nav-text>vsä¸­æ˜¾ç¤ºå¤´æ–‡ä»¶</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#option%E4%B8%8Eadd-definitions><span class=nav-number>13.</span> <span class=nav-text>optionä¸add_definitions</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#%E7%94%9F%E6%88%90%E5%99%A8%E8%A1%A8%E7%A4%BA><span class=nav-number>13.1.</span> <span class=nav-text>ç”Ÿæˆå™¨è¡¨ç¤º</span></a></ol><li class="nav-item nav-level-2"><a class=nav-link href=#Advanced-cmake><span class=nav-number>14.</span> <span class=nav-text>Advanced cmake</span></a><ol class=nav-child><li class="nav-item nav-level-4"><a class=nav-link href=#Effective-CMake><span class=nav-number>14.0.1.</span> <span class=nav-text>Effective CMake</span></a><ol class=nav-child><li class="nav-item nav-level-5"><a class=nav-link href=#%E9%80%9A%E7%94%A8><span class=nav-number>14.0.1.1.</span> <span class=nav-text>é€šç”¨</span></a><li class="nav-item nav-level-5"><a class=nav-link href=#%E6%A8%A1%E5%9D%97Modules><span class=nav-number>14.0.1.2.</span> <span class=nav-text>æ¨¡å—Modules</span></a><li class="nav-item nav-level-5"><a class=nav-link href=#%E9%A1%B9%E7%9B%AEProjects><span class=nav-number>14.0.1.3.</span> <span class=nav-text>é¡¹ç›®Projects</span></a><li class="nav-item nav-level-5"><a class=nav-link href=#%E7%9B%AE%E6%A0%87-Targets-%E5%8F%8A%E5%85%B6%E5%B1%9E%E6%80%A7-Properties><span class=nav-number>14.0.1.4.</span> <span class=nav-text>ç›®æ ‡(Targets)åŠå…¶å±æ€§(Properties)</span></a><li class="nav-item nav-level-5"><a class=nav-link href=#%E5%87%BD%E6%95%B0%E4%B8%8E%E5%AE%8F><span class=nav-number>14.0.1.5.</span> <span class=nav-text>å‡½æ•°ä¸å®</span></a><li class="nav-item nav-level-5"><a class=nav-link href=#%E5%BE%AA%E7%8E%AF><span class=nav-number>14.0.1.6.</span> <span class=nav-text>å¾ªç¯</span></a><li class="nav-item nav-level-5"><a class=nav-link href=#%E5%8C%85><span class=nav-number>14.0.1.7.</span> <span class=nav-text>åŒ…</span></a><li class="nav-item nav-level-5"><a class=nav-link href=#%E4%BA%A4%E5%8F%89%E7%BC%96%E8%AF%91><span class=nav-number>14.0.1.8.</span> <span class=nav-text>äº¤å‰ç¼–è¯‘</span></a><li class="nav-item nav-level-5"><a class=nav-link href=#%E8%AD%A6%E5%91%8A%E4%B8%8E%E6%8A%A5%E9%94%99><span class=nav-number>14.0.1.9.</span> <span class=nav-text>è­¦å‘Šä¸æŠ¥é”™</span></a></ol></ol></ol><li class="nav-item nav-level-2"><a class=nav-link href=#%E5%AE%9E%E6%88%98><span class=nav-number>15.</span> <span class=nav-text>å®æˆ˜</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84><span class=nav-number>15.1.</span> <span class=nav-text>é¡¹ç›®ç»“æ„</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#%E5%88%9B%E5%BB%BA%E5%BA%93><span class=nav-number>15.2.</span> <span class=nav-text>åˆ›å»ºåº“</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#%E5%91%BD%E5%90%8D%E5%BA%93><span class=nav-number>15.3.</span> <span class=nav-text>å‘½ååº“</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#%E5%8A%A8%E6%80%81%E5%BA%93%E7%9A%84%E7%AC%A6%E5%8F%B7%E5%8F%AF%E8%A7%81%E6%80%A7><span class=nav-number>15.4.</span> <span class=nav-text>åŠ¨æ€åº“çš„ç¬¦å·å¯è§æ€§</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#%E6%9B%B4%E6%94%B9%E9%BB%98%E8%AE%A4%E5%8F%AF%E8%A7%81%E6%80%A7><span class=nav-number>15.5.</span> <span class=nav-text>æ›´æ”¹é»˜è®¤å¯è§æ€§</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#%E6%8E%A5%E5%8F%A3%E5%92%8C%E7%BA%AF%E5%A4%B4%E6%96%87%E4%BB%B6%E5%BA%93><span class=nav-number>15.6.</span> <span class=nav-text>æ¥å£å’Œçº¯å¤´æ–‡ä»¶åº“</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#%E5%AF%B9%E8%B1%A1%E5%BA%93><span class=nav-number>15.7.</span> <span class=nav-text>å¯¹è±¡åº“</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#%E4%BD%BF%E7%94%A8%E5%BA%93><span class=nav-number>15.8.</span> <span class=nav-text>ä½¿ç”¨åº“</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#%E8%AE%BE%E7%BD%AE%E7%BC%96%E8%AF%91%E5%99%A8%E5%92%8C%E9%93%BE%E6%8E%A5%E5%99%A8%E9%80%89%E9%A1%B9><span class=nav-number>15.9.</span> <span class=nav-text>è®¾ç½®ç¼–è¯‘å™¨å’Œé“¾æ¥å™¨é€‰é¡¹</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#%E8%B0%83%E8%AF%95%E7%BC%96%E8%AF%91%E5%99%A8%E9%80%89%E9%A1%B9><span class=nav-number>15.10.</span> <span class=nav-text>è°ƒè¯•ç¼–è¯‘å™¨é€‰é¡¹</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#%E5%BA%93%E5%88%AB%E5%90%8D><span class=nav-number>15.11.</span> <span class=nav-text>åº“åˆ«å</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#%E4%BD%BF%E7%94%A8%E9%A2%84%E8%AE%BE%E5%80%BC%E7%BB%B4%E6%8A%A4%E6%9E%84%E5%BB%BA%E9%85%8D%E7%BD%AE><span class=nav-number>15.12.</span> <span class=nav-text>ä½¿ç”¨é¢„è®¾å€¼ç»´æŠ¤æ„å»ºé…ç½®</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#%E6%89%93%E5%8C%85%E3%80%81%E9%83%A8%E7%BD%B2%E5%92%8C%E5%AE%89%E8%A3%85><span class=nav-number>15.13.</span> <span class=nav-text>æ‰“åŒ…ã€éƒ¨ç½²å’Œå®‰è£…</span></a><ol class=nav-child><li class="nav-item nav-level-4"><a class=nav-link href=#%E5%AE%89%E8%A3%85%E6%96%87%E4%BB%B6><span class=nav-number>15.13.1.</span> <span class=nav-text>å®‰è£…æ–‡ä»¶</span></a><li class="nav-item nav-level-4"><a class=nav-link href=#%E5%AE%89%E8%A3%85%E7%9B%AE%E5%BD%95><span class=nav-number>15.13.2.</span> <span class=nav-text>å®‰è£…ç›®å½•</span></a><li class="nav-item nav-level-4"><a class=nav-link href=#%E6%8F%90%E4%BE%9B%E9%A1%B9%E7%9B%AE%E9%85%8D%E7%BD%AE%E4%BF%A1%E6%81%AF><span class=nav-number>15.13.3.</span> <span class=nav-text>æä¾›é¡¹ç›®é…ç½®ä¿¡æ¯</span></a><li class="nav-item nav-level-4"><a class=nav-link href=#%E5%88%9B%E5%BB%BA%E5%AE%89%E8%A3%85%E5%8C%85><span class=nav-number>15.13.4.</span> <span class=nav-text>åˆ›å»ºå®‰è£…åŒ…</span></a><li class="nav-item nav-level-4"><a class=nav-link href=#%E5%AF%BB%E6%89%BE%E5%8C%85%E5%92%8C%E6%96%87%E4%BB%B6><span class=nav-number>15.13.5.</span> <span class=nav-text>å¯»æ‰¾åŒ…å’Œæ–‡ä»¶</span></a><li class="nav-item nav-level-4"><a class=nav-link href=#%E5%8C%85%E7%AE%A1%E7%90%86%E5%99%A8><span class=nav-number>15.13.6.</span> <span class=nav-text>åŒ…ç®¡ç†å™¨</span></a><li class="nav-item nav-level-4"><a class=nav-link href=#%E8%8E%B7%E5%8F%96%E4%BE%9D%E8%B5%96%E9%A1%B9%E6%BA%90%E4%BB%A3%E7%A0%81><span class=nav-number>15.13.7.</span> <span class=nav-text>è·å–ä¾èµ–é¡¹æºä»£ç </span></a></ol><li class="nav-item nav-level-3"><a class=nav-link href=#%E8%87%AA%E5%8A%A8%E7%94%9F%E6%88%90%E6%96%87%E6%A1%A3><span class=nav-number>15.14.</span> <span class=nav-text>è‡ªåŠ¨ç”Ÿæˆæ–‡æ¡£</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#%E9%9B%86%E6%88%90%E4%BB%A3%E7%A0%81%E8%B4%A8%E9%87%8F%E5%B7%A5%E5%85%B7><span class=nav-number>15.15.</span> <span class=nav-text>é›†æˆä»£ç è´¨é‡å·¥å…·</span></a><ol class=nav-child><li class="nav-item nav-level-4"><a class=nav-link href=#%E4%BB%A3%E7%A0%81%E6%B5%8B%E8%AF%95><span class=nav-number>15.15.1.</span> <span class=nav-text>ä»£ç æµ‹è¯•</span></a></ol><li class="nav-item nav-level-3"><a class=nav-link href=#%E6%89%A7%E8%A1%8C%E8%87%AA%E5%AE%9A%E4%B9%89%E4%BB%BB%E5%8A%A1><span class=nav-number>15.16.</span> <span class=nav-text>æ‰§è¡Œè‡ªå®šä¹‰ä»»åŠ¡</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#%E5%8F%AF%E5%A4%8D%E5%88%B6%E7%9A%84%E6%9E%84%E5%BB%BA%E7%8E%AF%E5%A2%83><span class=nav-number>15.17.</span> <span class=nav-text>å¯å¤åˆ¶çš„æ„å»ºç¯å¢ƒ</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#%E5%9F%BA%E6%9C%AC%E6%A8%A1%E5%9D%97><span class=nav-number>15.18.</span> <span class=nav-text>åŸºæœ¬æ¨¡å—</span></a></ol><li class="nav-item nav-level-2"><a class=nav-link href=#%E5%85%B7%E4%BD%93%E9%A1%B9%E7%9B%AE><span class=nav-number>16.</span> <span class=nav-text>å…·ä½“é¡¹ç›®</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#Beyond-CMake><span class=nav-number>17.</span> <span class=nav-text>Beyond CMake</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99><span class=nav-number>17.1.</span> <span class=nav-text>å‚è€ƒèµ„æ–™</span></a></ol></div></div><!--/noindex--><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop=author itemscope itemtype=http://schema.org/Person><img alt=Sekyoro class=site-author-image itemprop=image src=https://i.loli.net/2021/05/17/YqoavnXdGTpPO9R.jpg><p class=site-author-name itemprop=name>Sekyoro<div class=site-description itemprop=description>ä»€ä¹ˆä¹Ÿæ— æ³•èˆå¼ƒçš„äººï¼Œä»€ä¹ˆä¹Ÿåšä¸äº†.</div></div><div class="site-state-wrap motion-element"><nav class=site-state><div class="site-state-item site-state-posts"><a href=/archives/> <span class=site-state-item-count>256</span> <span class=site-state-item-name>æ—¥å¿—</span> </a></div><div class="site-state-item site-state-categories"><a href=/categories/> <span class=site-state-item-count>16</span> <span class=site-state-item-name>åˆ†ç±»</span></a></div><div class="site-state-item site-state-tags"><a href=/tags/> <span class=site-state-item-count>219</span> <span class=site-state-item-name>æ ‡ç­¾</span></a></div></nav></div><div class="links-of-author motion-element"><span class=links-of-author-item> <a title="Personal Website â†’ http://proanimer.com" href=http://proanimer.com/ rel=noopener target=_blank><i class="fab fa-internet-explorer fa-fw"></i>Personal Website</a> </span><span class=links-of-author-item> <a title="GitHub â†’ https://github.com/drowning-in-codes" href=https://github.com/drowning-in-codes rel=noopener target=_blank><i class="fab fa-github fa-fw"></i>GitHub</a> </span><span class=links-of-author-item> <a title="E-Mail â†’ mailto:bukalala174@gmail.com" href=mailto:bukalala174@gmail.com rel=noopener target=_blank><i class="fa fa-envelope fa-fw"></i>E-Mail</a> </span><span class=links-of-author-item> <a title="wxPublicAccount â†’ https://mp.weixin.qq.com/s?__biz=Mzg3ODY1MDkzMg==&mid=2247483770&idx=1&sn=fdf88faab01d5c219ac609570a21c9d6&chksm=cf113221f866bb373938cfca03cf095ff4fe1e4dc37d68ef5de4cd4876ee1260fca0c015a4d6&token=1096259873&lang=zh_CN#rd" href=https://mp.weixin.qq.com/s?__biz=Mzg3ODY1MDkzMg==&mid=2247483770&idx=1&sn=fdf88faab01d5c219ac609570a21c9d6&chksm=cf113221f866bb373938cfca03cf095ff4fe1e4dc37d68ef5de4cd4876ee1260fca0c015a4d6&token=1096259873&lang=zh_CN#rd rel=noopener target=_blank><i class="fab fa-weixin fa-fw"></i>wxPublicAccount</a> </span><span class=links-of-author-item> <a title="RSS â†’ /atom.xml" href=/atom.xml><i class="fa fa-rss fa-fw"></i>RSS</a> </span><span class=links-of-author-item> <a title="CSDN â†’ https://blog.csdn.net/aqwca" href=https://blog.csdn.net/aqwca rel=noopener target=_blank><i class="fa fa-handshake fa-fw"></i>CSDN</a> </span><span class=links-of-author-item> <a title="æ‚é±¼åˆ†äº« â†’ https://my-astro-git-main-drowning-in-codes.vercel.app" href=https://my-astro-git-main-drowning-in-codes.vercel.app/ rel=noopener target=_blank><i class="fas fa-share fa-fw"></i>æ‚é±¼åˆ†äº«</a> </span></div><div class="links-of-blogroll motion-element"><div class=links-of-blogroll-title><i class="fa fa-link fa-fw"></i> å‹æƒ…é“¾æ¥</div><ul class=links-of-blogroll-list><li class=links-of-blogroll-item><a href=http://myqhs.top/ rel=noopener target=_blank title=http://myqhs.top/>myqhs</a><li class=links-of-blogroll-item><a href=https://www.lllomh.com/ rel=noopener target=_blank title=https://www.lllomh.com/>èŠˆæ¸¡</a><li class=links-of-blogroll-item><a href=https://protool-ten.vercel.app/ rel=noopener target=_blank title=https://protool-ten.vercel.app/>protools</a></ul></div><div class="motion-element announcement"><div class=title></div><p class=content><p class=date></div></div><meting-js id=6856787487 order=random server=netease type=playlist> </meting-js><div class=widget-wrap><h3 class=widget-title style=margin:0>æ–‡ç« è¯äº‘</h3><div class="widget tagcloud" id=myCanvasContainer><canvas height=250 id=resCanvas style=width:100% width=250><ul class=tag-list itemprop=keywords><li class=tag-list-item><a class=tag-list-link href=/tags/CMake/ rel=tag>CMake</a><span class=tag-list-count>1</span></ul></canvas></div></div><script id=clustrmaps src=https://clustrmaps.com/map_v2.js?d=xQdGTxqARTBiNIwX2aUban-ixkj2s6VaZQWo-aVCgY8&cl=ffffff&w=a></script><div class="back-to-top motion-element"><i class="fa fa-arrow-up"></i><span>0%</span></div><!-- è¾¹æ  --></div></aside> <div id=sidebar-dimmer></div> <footer class=footer><div class=footer-inner><div class=copyright>Â© Wed Apr 08 2020 08:00:00 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´) â€“ <span itemprop=copyrightYear>2026</span><span class=with-love> <i class="fa fa-heart"></i> </span><span class=author itemprop=copyrightHolder>Sekyoro</span><span class=post-meta-divider>|</span><span class=post-meta-item-icon> <i class="fa fa-chart-area"></i> </span><span title=ç«™ç‚¹æ€»å­—æ•°>3.7m</span><span class=post-meta-divider>|</span><span class=post-meta-item-icon> <i class="fa fa-coffee"></i> </span><span title=ç«™ç‚¹é˜…è¯»æ—¶é•¿>55:26</span></div><script async src=https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js></script><span id=busuanzi_container_site_pv>æ€»è®¿é—®é‡<span id=busuanzi_value_site_pv></span>æ¬¡</span><span class=post-meta-divider>|</span><span id=busuanzi_container_site_uv>æ€»è®¿å®¢æ•°<span id=busuanzi_value_site_uv></span>äºº</span><span class=post-meta-divider>|</span><!-- ä¸è’œå­è®¡æ•°åˆå§‹å€¼çº æ­£ --><script>document.addEventListener("DOMContentLoaded", function() {
    var int = setInterval(fixCount, 50);  // 50mså‘¨æœŸæ£€æµ‹å‡½æ•°
    var countOffset = 20000;  // åˆå§‹åŒ–é¦–æ¬¡æ•°æ®

    function fixCount() {
        var pvContainer = document.getElementById("busuanzi_container_site_pv");
        if (pvContainer && pvContainer.style.display !== "none") {
            var pvElement = document.getElementById("busuanzi_value_site_pv");
            if (pvElement) {
                pvElement.innerHTML = parseInt(pvElement.innerHTML) + countOffset;
                clearInterval(int);
            }
        }
        
        var uvContainer = document.getElementById("busuanzi_container_site_uv");
        if (uvContainer && window.getComputedStyle(uvContainer).display !== "none")
        {
            var uvElement = document.getElementById("busuanzi_value_site_uv");
            if (uvElement) {
                uvElement.innerHTML = parseInt(uvElement.innerHTML) + countOffset; // åŠ ä¸Šåˆå§‹æ•°æ® 
                clearInterval(int); // åœæ­¢æ£€æµ‹
            }
        }
    }
});</script><div><span id=timeDate>è½½å…¥å¤©æ•°...</span><span id=times>è½½å…¥æ—¶åˆ†ç§’...</span><script>var now = new Date();
    function createtime() {
        var grt= new Date("04/08/2021 20:00:00");
        now.setTime(now.getTime()+250);
        days = (now - grt ) / 1000 / 60 / 60 / 24; dnum = Math.floor(days);
        hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum); hnum = Math.floor(hours);
        if(String(hnum).length ==1 ){hnum = "0" + hnum;} minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum);
        mnum = Math.floor(minutes); if(String(mnum).length ==1 ){mnum = "0" + mnum;}
        seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum);
        snum = Math.round(seconds); if(String(snum).length ==1 ){snum = "0" + snum;}
        document.getElementById("timeDate").innerHTML = "æœ¬ç«™å·²å®‰å…¨è¿è¡Œ "+dnum+" å¤© ";
        document.getElementById("times").innerHTML = hnum + " å°æ—¶ " + mnum + " åˆ† " + snum + " ç§’";
    }
setInterval("createtime()",250);</script></div><div class=busuanzi-count><script async data-pjax src=https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><span style="display: none;" class=post-meta-item id=busuanzi_container_site_uv> <span class=post-meta-item-icon> <i class="fa fa-user"></i> </span> <span class=site-uv title=æ€»è®¿å®¢é‡> <span id=busuanzi_value_site_uv></span> </span> </span><span class=post-meta-divider>|</span><span style="display: none;" class=post-meta-item id=busuanzi_container_site_pv> <span class=post-meta-item-icon> <i class="fa fa-eye"></i> </span> <span class=site-pv title=æ€»è®¿é—®é‡> <span id=busuanzi_value_site_pv></span> </span> </span></div></div></footer> <script color=0,0,255 count=99 opacity=0.5 src=/lib/canvas-nest/canvas-nest.min.js zindex=-1></script> <script src=/lib/anime.min.js></script> <script src=https://cdn.jsdelivr.net/gh/theme-next/theme-next-pjax@0/pjax.min.js></script> <script src=https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js></script> <script src=https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js></script> <script src=https://cdn.jsdelivr.net/npm/lozad@1/dist/lozad.min.js></script> <script src=https://cdn.jsdelivr.net/npm/velocity-animate@1/velocity.min.js></script> <script src=https://cdn.jsdelivr.net/npm/velocity-animate@1/velocity.ui.min.js></script> <script src=/js/utils.js></script> <script src=/js/motion.js></script> <script src=/js/schemes/pisces.js></script> <script src=/js/next-boot.js></script> <script src=/js/bookmark.js></script> <script>var pjax = new Pjax({
  selectors: [
    'head title',
    '#page-configurations',
    '.content-wrap',
    '.post-toc-wrap',
    '.languages',
    '#pjax',
	'.widget-wrap'
  ],
  switches: {
    '.post-toc-wrap': Pjax.switches.innerHTML
  },
  analytics: false,
  cacheBust: false,
  scrollTo : !CONFIG.bookmark.enable
});

window.addEventListener('pjax:success', () => {
  document.querySelectorAll('script[data-pjax], script#page-configurations, #pjax script').forEach(element => {
    var code = element.text || element.textContent || element.innerHTML || '';
    var parent = element.parentNode;
    parent.removeChild(element);
    var script = document.createElement('script');
    if (element.id) {
      script.id = element.id;
    }
    if (element.className) {
      script.className = element.className;
    }
    if (element.type) {
      script.type = element.type;
    }
    if (element.src) {
      script.src = element.src;
      // Force synchronous loading of peripheral JS.
      script.async = false;
    }
    if (element.dataset.pjax !== undefined) {
      script.dataset.pjax = '';
    }
    if (code !== '') {
      script.appendChild(document.createTextNode(code));
    }
    parent.appendChild(script);
  });
 
  NexT.boot.refresh();
  // Define Motion Sequence & Bootstrap Motion.
  if (CONFIG.motion.enable) {
    NexT.motion.integrator
      .init()
      .add(NexT.motion.middleWares.subMenu)
      .add(NexT.motion.middleWares.postList)
      .bootstrap();
  }
  NexT.utils.updateSidebarPosition();
});</script> <script data-pjax>(function(){
      var canonicalURL, curProtocol;
      //Get the <link> tag
      var x=document.getElementsByTagName("link");
		//Find the last canonical URL
		if(x.length > 0){
			for (i=0;i<x.length;i++){
				if(x[i].rel.toLowerCase() == 'canonical' && x[i].href){
					canonicalURL=x[i].href;
				}
			}
		}
    //Get protocol
	    if (!canonicalURL){
	    	curProtocol = window.location.protocol.split(':')[0];
	    }
	    else{
	    	curProtocol = canonicalURL.split(':')[0];
	    }
      //Get current URL if the canonical URL does not exist
	    if (!canonicalURL) canonicalURL = window.location.href;
	    //Assign script content. Replace current URL with the canonical URL
      !function(){var e=/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi,r=canonicalURL,t=document.referrer;if(!e.test(r)){var n=(String(curProtocol).toLowerCase() === 'https')?"https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif":"//api.share.baidu.com/s.gif";t?(n+="?r="+encodeURIComponent(document.referrer),r&&(n+="&l="+r)):r&&(n+="?l="+r);var i=new Image;i.src=n}}(window);})();</script> <script src=https://cdn.jsdelivr.net/npm/algoliasearch@4/dist/algoliasearch-lite.umd.js></script> <script src=https://cdn.jsdelivr.net/npm/instantsearch.js@4/dist/instantsearch.production.min.js></script> <script src=/js/algolia-search.js></script> <script data-pjax>document.querySelectorAll('.pdfobject-container').forEach(element => {
  let url = element.dataset.target;
  let pdfOpenParams = {
    navpanes : 0,
    toolbar  : 0,
    statusbar: 0,
    pagemode : 'thumbs',
    view     : 'FitH'
  };
  let pdfOpenFragment = '#' + Object.entries(pdfOpenParams).map(([key, value]) => `${key}=${encodeURIComponent(value)}`).join('&');
  let fullURL = `/lib/pdf/web/viewer.html?file=${encodeURIComponent(url)}${pdfOpenFragment}`;

  if (NexT.utils.supportsPDFs()) {
    element.innerHTML = `<embed class="pdfobject" src="${url + pdfOpenFragment}" type="application/pdf" style="height: ${element.dataset.height};">`;
  } else {
    element.innerHTML = `<iframe src="${fullURL}" style="height: ${element.dataset.height};" frameborder="0"></iframe>`;
  }
});</script> <div id=pjax><script charset=utf-8 defer src=/js/outdate.js></script></div> <script charset=utf-8 defer src=/js/tagcanvas.js></script> <script charset=utf-8 defer src=/js/tagcloud.js></script> <script>NexT.utils.loadComments(document.querySelector('#lv-container'), () => {
  window.livereOptions = {
    refer: location.pathname.replace(CONFIG.root, '').replace('index.html', '')
  };
  (function(d, s) {
    var j, e = d.getElementsByTagName(s)[0];
    if (typeof LivereTower === 'function') { return; }
    j = d.createElement(s);
    j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
    j.async = true;
    e.parentNode.insertBefore(j, e);
  })(document, 'script');
});</script> <script>var OriginTitile = document.title;
  var titleTime;
  document.addEventListener("visibilitychange", function() {
    if (document.hidden) {
      document.title = "(ã¤ã‚§âŠ‚)æˆ‘è—å¥½äº†å“¦~" + OriginTitile;
      clearTimeout(titleTime);
    } else {
      document.title = "(*Â´âˆ‡ï½€*) è¢«ä½ å‘ç°å•¦~" + OriginTitile;
      titleTime = setTimeout(function() {
        document.title = OriginTitile;
      }, 2000);
    }
  });</script> <script src=/js/src/activate-power-mode.min.js></script> <script>POWERMODE.colorful = true;
    POWERMODE.shake = false;
    document.body.addEventListener('input', POWERMODE);</script>