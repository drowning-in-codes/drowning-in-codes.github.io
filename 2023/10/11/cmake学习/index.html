<!doctypehtml><html lang=zh-CN><script defer src=/live2d-widget/autoload.js></script><meta charset=UTF-8><meta content=width=device-width,initial-scale=1,maximum-scale=2 name=viewport><meta content=#222 name=theme-color><meta content="Hexo 5.4.0" name=generator><link href=/images/blog_32px.png rel=apple-touch-icon sizes=180x180><link href=/images/blog_32px.png rel=icon sizes=32x32 type=image/png><link href=/images/blog_16px.png rel=icon sizes=16x16 type=image/png><link color=#222 href=/images/logo.svg rel=mask-icon><meta content=EPrJAp11bJwHULpQUaSNSZ8_3RcvTsPDAEGOME4pl1w name=google-site-verification><!-- Google tag (gtag.js) --><!-- 
<script async src="https://www.googletagmanager.com/gtag/js?id=G-VB21D8MKKW"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-VB21D8MKKW');
</script> --><!-- google adsense in head.swig --><script async crossorigin=anonymous src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4034523802263123></script><meta content=7226864CE87CE9DE8C008385273846FF name=msvalidate.01><meta content=code-fjFXVtiL7j name=baidu-site-verification><link href=/css/main.css rel=stylesheet><link as=style href=https://fonts.googleapis.com/css?family=Roboto%20Mono,Roboto:300,300italic,400,400italic,700,700italic|Roboto:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext onload=this.rel='stylesheet' rel=preload><link as=style href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css onload=this.rel='stylesheet' rel=preload><link href=https://fonts.googleapis.com/css?family=Noto+Serif+SC|Roboto&display=swap rel=stylesheet><link href=https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css rel=stylesheet><link href=https://cdn.jsdelivr.net/npm/pace-js@1/themes/blue/pace-theme-minimal.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/pace-js@1/pace.min.js></script><script id=hexo-configurations>var NexT = window.NexT || {};
    var CONFIG = {"hostname":"www.sekyoro.top","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","width":240,"display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":null},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":true,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"appID":"3G9PZZIKCH","apiKey":"8eb71f5ca3167e9ef3487882f10cfaad","indexName":"SekyoroSearch","hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"manual","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};</script><link href=//cdn.bootcss.com/animate.css/3.5.0/animate.min.css rel=stylesheet><meta content=åœ¨Windowsä¸Šå¼€å‘c++ç›¸æ¯”Linuxè¿˜æ˜¯æœ‰ç‚¹ä¸æ–¹ä¾¿,è¿™é‡Œä»‹ç»CMake,è·¨å¹³å°çš„æ„å»ºå·¥å…·. name=description><meta content=article property=og:type><meta content=cmakeå­¦ä¹  property=og:title><meta content=https://www.sekyoro.top/2023/10/11/cmake%E5%AD%A6%E4%B9%A0/index.html property=og:url><meta content=Sekyoroçš„åšå®¢å°å±‹ property=og:site_name><meta content=åœ¨Windowsä¸Šå¼€å‘c++ç›¸æ¯”Linuxè¿˜æ˜¯æœ‰ç‚¹ä¸æ–¹ä¾¿,è¿™é‡Œä»‹ç»CMake,è·¨å¹³å°çš„æ„å»ºå·¥å…·. property=og:description><meta content=zh_CN property=og:locale><meta content=https://i.imgur.com/0mXZUbA.png property=og:image><meta content=https://i.imgur.com/cozY007.png property=og:image><meta content=2023-10-11T09:26:00.000Z property=article:published_time><meta content=2024-07-21T15:21:40.785Z property=article:modified_time><meta content=Sekyoro property=article:author><meta content=CMake property=article:tag><meta content=summary name=twitter:card><meta content=https://i.imgur.com/0mXZUbA.png name=twitter:image><link href=https://www.sekyoro.top/2023/10/11/cmake%E5%AD%A6%E4%B9%A0/ rel=canonical><script id=page-configurations>// https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };</script><title>cmakeå­¦ä¹  | Sekyoroçš„åšå®¢å°å±‹</title><noscript><style>.use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }</style></noscript><link href=/atom.xml rel=alternate title=Sekyoroçš„åšå®¢å°å±‹ type=application/atom+xml><body itemscope itemtype=http://schema.org/WebPage><canvas style="position: fixed;left: 0;top: 0;z-index: 1; pointer-events: none;" class=fireworks></canvas><script defer src=https://cdn.bootcss.com/animejs/2.2.0/anime.min.js></script><script defer src=/js/src/fireworks.js></script><div class="container use-motion"><div class=headband></div><header class=header itemscope itemtype=http://schema.org/WPHeader><div class=header-inner><div class=site-brand-container><div class=site-nav-toggle><div aria-label=åˆ‡æ¢å¯¼èˆªæ  class=toggle><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div></div><div class=site-meta><a class=brand href=/ rel=start> <span class=logo-line-before><i></i></span> <h1 class=site-title>Sekyoroçš„åšå®¢å°å±‹</h1> <span class=logo-line-after><i></i></span> </a></div><div class=site-nav-right><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class=site-nav><ul class="main-menu menu" id=menu><li class="menu-item menu-item-home"><a href=/ rel=section><i class="fa fa-home fa-fw"></i>é¦–é¡µ</a><li class="menu-item menu-item-about"><a href=/about/ rel=section><i class="fa fa-user fa-fw"></i>å…³äº</a><li class="menu-item menu-item-tags"><a href=/tags/ rel=section><i class="fa fa-tags fa-fw"></i>æ ‡ç­¾</a><li class="menu-item menu-item-categories"><a href=/categories/ rel=section><i class="fa fa-th fa-fw"></i>åˆ†ç±»</a><li class="menu-item menu-item-archives"><a href=/archives/ rel=section><i class="fa fa-archive fa-fw"></i>å½’æ¡£</a><li class="menu-item menu-item-bangumis"><a href=/bangumis/ rel=section><i class="fa fa-film fa-fw"></i>è¿½ç•ª</a><li class="menu-item menu-item-resume"><a href=/resume/ rel=section><i class="fa fa-file-pdf fa-fw"></i>ç®€å†</a><li class="menu-item menu-item-materials"><a href=/materials/ rel=section><i class="fa fa-book fa-fw"></i>å­¦ä¹ èµ„æ–™</a><li class="menu-item menu-item-sitemap"><a href=/sitemap.xml rel=section><i class="fa fa-sitemap fa-fw"></i>ç«™ç‚¹åœ°å›¾</a><li class="menu-item menu-item-search"><a class=popup-trigger role=button><i class="fa fa-search fa-fw"></i>æœç´¢ </a></ul></nav><div class=search-pop-overlay><div class="popup search-popup"><div class=search-header><span class=search-icon> <i class="fa fa-search"></i> </span><div class=search-input-container></div><span class=popup-btn-close> <i class="fa fa-times-circle"></i> </span></div><div class=algolia-results><div id=algolia-stats></div><div id=algolia-hits></div><div class=algolia-pagination id=algolia-pagination></div></div></div></div></div></header><a class="book-mark-link book-mark-link-fixed" role=button></a><main class=main><div class=main-inner><div class=content-wrap><div class="content post posts-expand"><article class=post-block itemscope itemtype=http://schema.org/Article lang=zh-CN><link href=https://www.sekyoro.top/2023/10/11/cmake%E5%AD%A6%E4%B9%A0/ itemprop=mainEntityOfPage><span hidden itemprop=author itemscope itemtype=http://schema.org/Person> <meta content=https://i.loli.net/2021/05/17/YqoavnXdGTpPO9R.jpg itemprop=image> <meta content=Sekyoro itemprop=name> <meta content=ä»€ä¹ˆä¹Ÿæ— æ³•èˆå¼ƒçš„äººï¼Œä»€ä¹ˆä¹Ÿåšä¸äº†. itemprop=description> </span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization> <meta content=Sekyoroçš„åšå®¢å°å±‹ itemprop=name> </span><header class=post-header><h1 itemprop="name headline" class=post-title>cmakeå­¦ä¹ </h1><div class=post-meta><span class=post-meta-item> <span class=post-meta-item-icon> <i class="far fa-calendar"></i> </span> <span class=post-meta-item-text>å‘è¡¨äº</span> <time itemprop="dateCreated datePublished" title="åˆ›å»ºæ—¶é—´ï¼š2023-10-11 17:26:00" datetime=2023-10-11T17:26:00+08:00>2023-10-11</time> </span><span class=post-meta-item> <span class=post-meta-item-icon> <i class="far fa-calendar-check"></i> </span> <span class=post-meta-item-text>æ›´æ–°äº</span> <time title="ä¿®æ”¹æ—¶é—´ï¼š2024-07-21 23:21:40" datetime=2024-07-21T23:21:40+08:00 itemprop=dateModified>2024-07-21</time> </span><span style="display: none;" class=post-meta-item id=busuanzi_container_page_pv title=é˜…è¯»æ¬¡æ•°> <span class=post-meta-item-icon> <i class="fa fa-eye"></i> </span> <span class=post-meta-item-text>é˜…è¯»æ¬¡æ•°ï¼š</span> <span id=busuanzi_value_page_pv></span> </span><br><span class=post-meta-item title=æœ¬æ–‡å­—æ•°> <span class=post-meta-item-icon> <i class="far fa-file-word"></i> </span> <span class=post-meta-item-text>æœ¬æ–‡å­—æ•°ï¼š</span> <span>29k</span> </span><span class=post-meta-item title=é˜…è¯»æ—¶é•¿> <span class=post-meta-item-icon> <i class="far fa-clock"></i> </span> <span class=post-meta-item-text>é˜…è¯»æ—¶é•¿ â‰ˆ</span> <span>27 åˆ†é’Ÿ</span> </span></div></header><div class=post-body itemprop=articleBody><p>åœ¨Windowsä¸Šå¼€å‘c++ç›¸æ¯”Linuxè¿˜æ˜¯æœ‰ç‚¹ä¸æ–¹ä¾¿,è¿™é‡Œä»‹ç»CMake,è·¨å¹³å°çš„æ„å»ºå·¥å…·.<br><span id=more></span><h2 id=Before-cmake><a title="Before cmake" class=headerlink href=#Before-cmake></a>Before cmake</h2><p>cmakeå¯ä»¥ç”Ÿæˆmakefiles,å¾ˆå¤šæ—¶å€™æˆ‘ä»¬ä¹Ÿæ˜¯ä½¿ç”¨çš„makefiles,å½“ç„¶å®ƒä¹Ÿå¯ä»¥ç”Ÿæˆvsproj,ninjaç­‰æ„å»ºæ–‡ä»¶.è¿™é‡Œä»¥makefilesä¸ºä¾‹ä»‹ç»ä¸€ä¸‹æ„å»ºç³»ç»Ÿ.<blockquote><p>Makefile ç”¨äºå¸®åŠ©å†³å®šå¤§å‹ç¨‹åºçš„å“ªäº›éƒ¨åˆ†éœ€è¦é‡æ–°ç¼–è¯‘ã€‚ åœ¨ç»å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œç¼–è¯‘çš„æ˜¯ C æˆ– C++ æ–‡ä»¶ã€‚ å…¶ä»–è¯­è¨€é€šå¸¸ä¹Ÿæœ‰è‡ªå·±çš„å·¥å…·ï¼Œå…¶ä½œç”¨ä¸ Make ç±»ä¼¼ã€‚ é™¤äº†ç¼–è¯‘ä¹‹å¤–ï¼ŒMake è¿˜å¯ä»¥ç”¨äºéœ€è¦æ ¹æ®æ–‡ä»¶å˜åŒ–è¿è¡Œä¸€ç³»åˆ—æŒ‡ä»¤çš„æƒ…å†µã€‚</blockquote><p>æµè¡Œçš„ C/C++ æ›¿ä»£æ„å»ºç³»ç»Ÿæœ‰ SConsã€CMakeã€Bazel å’Œ Ninjaä¸€äº›ä»£ç ç¼–è¾‘å™¨ï¼ˆå¦‚ Microsoft Visual Studioï¼‰ä¹Ÿæœ‰è‡ªå·±çš„å†…ç½®æ„å»ºå·¥å…·.<p>Java æœ‰ Antã€Maven å’Œ Gradleï¼ŒGoã€Rust å’Œ TypeScript ç­‰å…¶ä»–è¯­è¨€ä¹Ÿæœ‰è‡ªå·±çš„æ„å»ºå·¥å…·ã€‚<p>Pythonã€Ruby å’Œå•çº¯çš„Javascript ç­‰è§£é‡Šå‹è¯­è¨€ä¸éœ€è¦ç±»ä¼¼ Makefile çš„å·¥å…·ã€‚ Makefile çš„ç›®æ ‡æ˜¯æ ¹æ®å“ªäº›æ–‡ä»¶å‘ç”Ÿäº†å˜åŒ–ï¼Œç¼–è¯‘å“ªäº›éœ€è¦ç¼–è¯‘çš„æ–‡ä»¶ã€‚<p>ä½†æ˜¯ï¼Œå½“è§£é‡Šå‹è¯­è¨€ä¸­çš„æ–‡ä»¶å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå°±ä¸éœ€è¦é‡æ–°ç¼–è¯‘äº†ã€‚ ç¨‹åºè¿è¡Œæ—¶ï¼Œå°†ä½¿ç”¨æ–‡ä»¶çš„æœ€æ–°ç‰ˆæœ¬ã€‚<h3 id=syntax><a class=headerlink href=#syntax title=syntax></a>syntax</h3><p>Makefile ç”±ä¸€ç³»åˆ—è§„åˆ™ç»„æˆã€‚ ä¸€æ¡è§„åˆ™é€šå¸¸æ˜¯è¿™æ ·çš„ï¼š<figure class="highlight makefile"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br></pre><td class=code><pre><span class=line><span class=section>targets: prerequisites</span></span><br><span class=line>	command</span><br><span class=line>	command</span><br><span class=line>	command</span><br></pre></table></figure><p>ç›®æ ‡(targets)æ˜¯æ–‡ä»¶å,ç”¨ç©ºæ ¼éš”å¼€.é€šå¸¸æƒ…å†µä¸‹,æ¯æ¡è§„åˆ™(rule)åªæœ‰ä¸€ä¸ªç›®æ ‡.<p>å‘½ä»¤(command)æ˜¯ä¸€ç³»åˆ—é€šå¸¸ç”¨äºåˆ›å»ºç›®æ ‡çš„æ­¥éª¤,éœ€è¦ä»¥åˆ¶è¡¨ç¬¦è€Œä¸æ˜¯ç©ºæ ¼å¼€å¤´.<p>å…ˆå†³æ¡ä»¶(prerequisites)ä¹Ÿæ˜¯æ–‡ä»¶å,ä»¥ç©ºæ ¼åˆ†éš”.åœ¨è¿è¡Œç›®æ ‡çš„å‘½ä»¤ä¹‹å‰,è¿™äº›æ–‡ä»¶å¿…é¡»å­˜åœ¨.è¿™äº›æ–‡ä»¶ä¹Ÿç§°ä¸ºä¾èµ–é¡¹<p>ä»¥ hello world ä¸ºä¾‹å¼€å§‹ï¼š<figure class="highlight makefile"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br></pre><td class=code><pre><span class=line><span class=section>hello:</span></span><br><span class=line>	echo <span class=string>"Hello, World"</span></span><br><span class=line>	echo <span class=string>"This line will print if the file hello does not exist."</span></span><br></pre></table></figure><p>æœ‰ä¸€ä¸ªåä¸º hello çš„ç›®æ ‡ï¼Œè¿™ä¸ªç›®æ ‡æœ‰ä¸¤æ¡å‘½ä»¤ï¼Œè¿™ä¸ªç›®æ ‡æ²¡æœ‰å…ˆå†³æ¡ä»¶ï¼Œç„¶åè¿è¡Œ make hello.<p><strong>åªè¦ hello æ–‡ä»¶ä¸å­˜åœ¨ï¼Œå‘½ä»¤å°±ä¼šè¿è¡Œ</strong>. è¦çŸ¥é“hello æ—¢æ˜¯ç›®æ ‡,ä¹Ÿæ˜¯æ–‡ä»¶.<p>è¿™æ˜¯å› ä¸ºä¸¤è€…ç›´æ¥è”ç³»åœ¨ä¸€èµ·. <strong>é€šå¸¸æƒ…å†µä¸‹,å½“è¿è¡Œç›®æ ‡æ–‡ä»¶æ—¶ï¼ˆä¹Ÿå°±æ˜¯è¿è¡Œç›®æ ‡æ–‡ä»¶çš„å‘½ä»¤æ—¶ï¼‰,å‘½ä»¤ä¼šåˆ›å»ºä¸€ä¸ªä¸ç›®æ ‡æ–‡ä»¶åŒåçš„æ–‡ä»¶</strong>. åœ¨è¿™ç§æƒ…å†µä¸‹,hello ç›®æ ‡ä¸ä¼šåˆ›å»º hello æ–‡ä»¶.<figure class="highlight makefile"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line><span class=section>blah: cc blah.c -o blah </span></span><br></pre></table></figure><p>è¿è¡Œ make å‘½ä»¤ã€‚ ç”±äº make å‘½ä»¤çš„å‚æ•°ä¸­æ²¡æœ‰æä¾›ç›®æ ‡æ–‡ä»¶ï¼Œå› æ­¤ä¼šè¿è¡Œç¬¬ä¸€ä¸ªç›®æ ‡æ–‡ä»¶ã€‚ åœ¨æœ¬ä¾‹ä¸­ï¼Œåªæœ‰ä¸€ä¸ªç›®æ ‡ï¼ˆblahï¼‰<p>ç¬¬ä¸€æ¬¡è¿è¡Œæ—¶ï¼Œblah å°†è¢«åˆ›å»ºã€‚ ç¬¬äºŒæ¬¡è¿è¡Œæ—¶ï¼Œä½ ä¼šçœ‹åˆ° make: â€˜blahâ€™ æ˜¯æœ€æ–°çš„ã€‚ è¿™æ˜¯å› ä¸º blah æ–‡ä»¶å·²ç»å­˜åœ¨ã€‚ ä½†æœ‰ä¸€ä¸ªé—®é¢˜ï¼šå¦‚æœæˆ‘ä»¬ä¿®æ”¹äº† blah.cï¼Œç„¶åè¿è¡Œ makeï¼Œä»€ä¹ˆéƒ½ä¸ä¼šé‡æ–°ç¼–è¯‘ã€‚<p>é€šè¿‡æ·»åŠ ä¸€ä¸ªå‰ææ¡ä»¶æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼š<figure class="highlight makefile"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line><span class=section>blah: blah.c cc blah.c -o blah </span></span><br></pre></table></figure><p>å½“æˆ‘ä»¬å†æ¬¡è¿è¡Œ make æ—¶ï¼Œä¼šå‘ç”Ÿä»¥ä¸‹ä¸€ç³»åˆ—æ­¥éª¤ï¼š ç¬¬ä¸€ä¸ªç›®æ ‡è¢«é€‰ä¸­ï¼Œå› ä¸ºç¬¬ä¸€ä¸ªç›®æ ‡æ˜¯é»˜è®¤ç›®æ ‡<p>è¿™ä¸ªç›®æ ‡çš„å‰ææ¡ä»¶æ˜¯ blah.c ,Make å†³å®šå®ƒæ˜¯å¦åº”è¯¥è¿è¡Œ blah ç›®æ ‡ã€‚ <strong>åªæœ‰å½“ blah ä¸å­˜åœ¨æˆ– blah.c æ¯” blah æ–°æ—¶ï¼Œå®ƒæ‰ä¼šè¿è¡Œ</strong><p>æœ€åä¸€æ­¥è‡³å…³é‡è¦ï¼Œæ˜¯ make çš„ç²¾é«“æ‰€åœ¨ã€‚ <strong>å®ƒè¦åšçš„æ˜¯åˆ¤æ–­è‡ªä¸Šæ¬¡ç¼–è¯‘ blah ä»¥æ¥ï¼Œblah çš„å…ˆå†³æ¡ä»¶æ˜¯å¦å‘ç”Ÿäº†å˜åŒ–ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœ blah.c è¢«ä¿®æ”¹ï¼Œè¿è¡Œ make å°±åº”è¯¥é‡æ–°ç¼–è¯‘è¯¥æ–‡ä»¶</strong>ã€‚ ä¸ºäº†åšåˆ°è¿™ä¸€ç‚¹ï¼Œå®ƒä¼šä½¿ç”¨æ–‡ä»¶ç³»ç»Ÿçš„æ—¶é—´æˆ³ä½œä¸ºä»£ç†æ¥åˆ¤æ–­æ˜¯å¦æœ‰æ”¹åŠ¨ã€‚ è¿™æ˜¯ä¸€ç§åˆç†çš„å¯å‘å¼æ–¹æ³•ï¼Œå› ä¸ºæ–‡ä»¶æ—¶é—´æˆ³é€šå¸¸åªæœ‰åœ¨æ–‡ä»¶è¢«ä¿®æ”¹æ—¶æ‰ä¼šå‘ç”Ÿå˜åŒ–ã€‚ ä½†å¿…é¡»è®¤è¯†åˆ°ï¼Œæƒ…å†µå¹¶éæ€»æ˜¯å¦‚æ­¤ã€‚ <strong>ä¾‹å¦‚ï¼Œä½ å¯ä»¥ä¿®æ”¹ä¸€ä¸ªæ–‡ä»¶ï¼Œç„¶åæŠŠè¯¥æ–‡ä»¶çš„ä¿®æ”¹æ—¶é—´æˆ³æ”¹æˆæ—§çš„ã€‚ å¦‚æœä½ è¿™æ ·åšäº†ï¼ŒMake å°±ä¼šé”™è¯¯åœ°è®¤ä¸ºè¯¥æ–‡ä»¶æ²¡æœ‰æ”¹åŠ¨ï¼Œå› æ­¤å¯ä»¥å¿½ç•¥</strong>ã€‚<h3 id=more-examples><a title="more examples" class=headerlink href=#more-examples></a>more examples</h3><p>ä¸‹é¢çš„ Makefile æœ€ç»ˆä¼šè¿è¡Œæ‰€æœ‰ä¸‰ä¸ªç›®æ ‡.<p>å½“ä½ åœ¨ç»ˆç«¯è¿è¡Œ make æ—¶,å®ƒä¼šé€šè¿‡ä¸€ç³»åˆ—æ­¥éª¤ç¼–è¯‘ä¸€ä¸ªåä¸º blah çš„ç¨‹åº:<p>Make é€‰æ‹©ç›®æ ‡ blah,å› ä¸ºç¬¬ä¸€ä¸ªç›®æ ‡æ˜¯é»˜è®¤ç›®æ ‡ blah éœ€è¦ blah.o,æ‰€ä»¥ make æœç´¢ blah.o<p>ç›®æ ‡ blah.o éœ€è¦ blah.c,æ‰€ä»¥ make æœç´¢ blah.c<p>ç›®æ ‡ blah.c æ²¡æœ‰ä¾èµ–å…³ç³»ï¼Œæ‰€ä»¥è¿è¡Œ echo å‘½ä»¤.ç„¶åè¿è¡Œ cc -c å‘½ä»¤ï¼Œå› ä¸ºæ‰€æœ‰ blah.o çš„ä¾èµ–å…³ç³»éƒ½å·²å¤„ç†å®Œæ¯•. ç„¶åè¿è¡Œ top cc å‘½ä»¤,å› ä¸ºæ‰€æœ‰ blah çš„ä¾èµ–å…³ç³»éƒ½å·²å¤„ç†å®Œæ¯•.<figure class="highlight makefile"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br></pre><td class=code><pre><span class=line><span class=section>blah: blah.o</span></span><br><span class=line>	cc blah.o -o blah <span class=comment># Runs third</span></span><br><span class=line></span><br><span class=line><span class=section>blah.o: blah.c</span></span><br><span class=line>	cc -c blah.c -o blah.o <span class=comment># Runs second</span></span><br><span class=line></span><br><span class=line><span class=comment># Typically blah.c would already exist, but I want to limit any additional required files</span></span><br><span class=line><span class=section>blah.c:</span></span><br><span class=line>	echo <span class=string>"int main() { return 0; }"</span> > blah.c <span class=comment># Runs first</span></span><br></pre></table></figure><p>å¦‚æœåˆ é™¤ blah.cï¼Œæ‰€æœ‰ä¸‰ä¸ªç›®æ ‡éƒ½å°†é‡æ–°è¿è¡Œã€‚ å¦‚æœç¼–è¾‘å®ƒï¼ˆä»è€Œå°†æ—¶é—´æˆ³æ”¹ä¸ºæ¯” blah.o æ–°ï¼‰ï¼Œåˆ™ä¼šè¿è¡Œå‰ä¸¤ä¸ªç›®æ ‡ã€‚ å¦‚æœè¿è¡Œ touch blah.oï¼ˆä»è€Œå°†æ—¶é—´æˆ³æ”¹ä¸ºæ¯” blah æ›´æ–°ï¼‰ï¼Œåˆ™åªæœ‰ç¬¬ä¸€ä¸ªç›®æ ‡ä¼šè¿è¡Œã€‚ å¦‚æœä»€ä¹ˆéƒ½ä¸æ”¹ï¼Œåˆ™æ‰€æœ‰ç›®æ ‡éƒ½ä¸ä¼šè¿è¡Œ<figure class="highlight makefile"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br></pre><td class=code><pre><span class=line><span class=section>some_file: other_file</span></span><br><span class=line>	echo <span class=string>"This will always run, and runs second"</span></span><br><span class=line>	touch some_file</span><br><span class=line></span><br><span class=line><span class=section>other_file:</span></span><br><span class=line>	echo <span class=string>"This will always run, and runs first"</span></span><br></pre></table></figure><p>è¿™ä¸ªä¾‹å­, å®ƒå°†å§‹ç»ˆè¿è¡Œä¸¤ä¸ªç›®æ ‡,å› ä¸º some_file ä¾èµ–äº other_fileï¼Œè€Œ other_file ä»æœªåˆ›å»ºã€‚<h3 id=clean><a class=headerlink href=#clean title=clean></a>clean</h3><p>clean ç»å¸¸è¢«ç”¨ä½œåˆ é™¤å…¶ä»–ç›®æ ‡è¾“å‡ºçš„ç›®æ ‡ï¼Œä½†åœ¨ Make ä¸­å®ƒå¹¶ä¸æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„è¯ã€‚<p>è¯·æ³¨æ„,clean åœ¨è¿™é‡Œåšäº†ä¸¤ä»¶æ–°äº‹æƒ…:<strong>å®ƒä¸æ˜¯ç¬¬ä¸€ä¸ªç›®æ ‡(é»˜è®¤),ä¹Ÿä¸æ˜¯å…ˆå†³æ¡ä»¶.è¿™æ„å‘³ç€é™¤éä½ æ˜ç¡®è°ƒç”¨ make cleanï¼Œå¦åˆ™å®ƒæ°¸è¿œä¸ä¼šè¿è¡Œ</strong>. å¦‚æœä½ ç¢°å·§æœ‰ä¸€ä¸ªåä¸º clean çš„æ–‡ä»¶,è¿™ä¸ªç›®æ ‡å°±ä¸ä¼šè¿è¡Œï¼Œè¿™ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„. å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜,ä½¿ç”¨ .PHONY ğŸ˜‹<figure class="highlight makefile"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br></pre><td class=code><pre><span class=line><span class=section>some_file: </span></span><br><span class=line>	touch some_file</span><br><span class=line><span class=section>clean:</span></span><br><span class=line>	rm -f some_file</span><br></pre></table></figure><h3 id=variables><a class=headerlink href=#variables title=variables></a>variables</h3><p>å˜é‡åªèƒ½æ˜¯å­—ç¬¦ä¸²ã€‚ é€šå¸¸æƒ…å†µä¸‹ï¼Œæ‚¨éœ€è¦ä½¿ç”¨ :=ï¼Œä½† = ä¹Ÿå¯ä»¥ã€‚<figure class="highlight makefile"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br></pre><td class=code><pre><span class=line>files := file1 file2</span><br><span class=line><span class=section>some_file: <span class=variable>$(files)</span></span></span><br><span class=line>	echo <span class=string>"Look at this variable: "</span> <span class=variable>$(files)</span></span><br><span class=line>	touch some_file</span><br><span class=line></span><br><span class=line><span class=section>file1:</span></span><br><span class=line>	touch file1</span><br><span class=line><span class=section>file2:</span></span><br><span class=line>	touch file2</span><br><span class=line></span><br><span class=line><span class=section>clean:</span></span><br><span class=line>	rm -f file1 file2 some_file</span><br></pre></table></figure><p>å•å¼•å·æˆ–åŒå¼•å·å¯¹ Make æ²¡æœ‰ä»»ä½•æ„ä¹‰ã€‚ å®ƒä»¬åªæ˜¯åˆ†é…ç»™å˜é‡çš„å­—ç¬¦ã€‚ ä¸è¿‡ï¼Œå¼•å·å¯¹ shell/bash å¾ˆæœ‰ç”¨ï¼Œåœ¨ printf ç­‰å‘½ä»¤ä¸­éœ€è¦ç”¨åˆ°ã€‚ åœ¨æœ¬ä¾‹ä¸­,ä¸¤æ¡å‘½ä»¤çš„è¡Œä¸ºæ˜¯ä¸€æ ·çš„ï¼š<figure class="highlight makefile"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br></pre><td class=code><pre><span class=line>a := one two<span class=comment># a is set to the string "one two"</span></span><br><span class=line>b := 'one two' <span class=comment># Not recommended. b is set to the string "'one two'"</span></span><br><span class=line><span class=section>all:</span></span><br><span class=line>	printf '$a'</span><br><span class=line>	printf $b</span><br></pre></table></figure><p>ä½¿ç”¨ ${} æˆ– $() å¼•ç”¨å˜é‡<figure class="highlight makefile"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br></pre><td class=code><pre><span class=line>x := dude</span><br><span class=line><span class=section>all:</span></span><br><span class=line>	echo <span class=variable>$(x)</span></span><br><span class=line>	echo ${x}</span><br><span class=line></span><br><span class=line>	<span class=comment># Bad practice, but works</span></span><br><span class=line>	echo $x </span><br></pre></table></figure><h3 id=Targets><a class=headerlink href=#Targets title=Targets></a>Targets</h3><p>makeå¤šä¸ªç›®æ ‡ï¼Œå¹¶å¸Œæœ›æ‰€æœ‰ç›®æ ‡éƒ½è¿è¡Œï¼Ÿ<p>å†™ä¸€ä¸ªä¸€ä¸ªallã€‚ ç”±äºè¿™æ˜¯åˆ—å‡ºçš„ç¬¬ä¸€æ¡è§„åˆ™ï¼Œå¦‚æœè°ƒç”¨ make æ—¶æ²¡æœ‰æŒ‡å®šç›®æ ‡ï¼Œå®ƒå°†é»˜è®¤è¿è¡Œã€‚<figure class="highlight makefile"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br></pre><td class=code><pre><span class=line><span class=section>all: one two three</span></span><br><span class=line></span><br><span class=line><span class=section>one:</span></span><br><span class=line>	touch one</span><br><span class=line><span class=section>two:</span></span><br><span class=line>	touch two</span><br><span class=line><span class=section>three:</span></span><br><span class=line>	touch three</span><br><span class=line></span><br><span class=line><span class=section>clean:</span></span><br><span class=line>	rm -f one two three</span><br></pre></table></figure><p>å½“ä¸€æ¡è§„åˆ™æœ‰å¤šä¸ªç›®æ ‡æ—¶ï¼Œå°†é’ˆå¯¹æ¯ä¸ªç›®æ ‡è¿è¡Œå‘½ä»¤ã€‚ $@ æ˜¯ä¸€ä¸ªè‡ªåŠ¨å˜é‡ï¼ŒåŒ…å«ç›®æ ‡åç§°ã€‚<figure class="highlight makefile"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br></pre><td class=code><pre><span class=line><span class=section>all: f1.o f2.o</span></span><br><span class=line></span><br><span class=line>f1.o f2.o:</span><br><span class=line>	echo <span class=variable>$@</span></span><br><span class=line><span class=comment># Equivalent to:</span></span><br><span class=line><span class=comment># f1.o:</span></span><br><span class=line><span class=comment>#	 echo f1.o</span></span><br><span class=line><span class=comment># f2.o:</span></span><br><span class=line><span class=comment>#	 echo f2.o</span></span><br></pre></table></figure><h3 id=automatic-variables-and-wildcards><a title="automatic variables and wildcards" class=headerlink href=#automatic-variables-and-wildcards></a>automatic variables and wildcards</h3><p>åœ¨ Make ä¸­ï¼Œ<em> å’Œ % éƒ½è¢«ç§°ä¸ºé€šé…ç¬¦,ä½†å®ƒä»¬çš„å«ä¹‰å®Œå…¨ä¸åŒ. </em> åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­æœç´¢åŒ¹é…çš„æ–‡ä»¶åã€‚<p>å»ºè®®å§‹ç»ˆå°†å…¶å°è£…åœ¨<strong>é€šé…ç¬¦å‡½æ•°</strong>ä¸­<figure class="highlight makefile"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br></pre><td class=code><pre><span class=line><span class=comment># Print out file information about every .c file</span></span><br><span class=line><span class=section>print: $(wildcard *.c)</span></span><br><span class=line>	ls -la  <span class=variable>$?</span></span><br></pre></table></figure><p>*å¯ä»¥åœ¨ç›®æ ‡ã€å…ˆå†³æ¡ä»¶æˆ–é€šé…ç¬¦åŠŸèƒ½ä¸­ä½¿ç”¨<p><strong>æ³¨æ„</strong>: ä¸èƒ½åœ¨å˜é‡å®šä¹‰ä¸­ç›´æ¥ä½¿ç”¨ *<p><strong>æ³¨æ„</strong>: å½“ * ä¸èƒ½åŒ¹é…ä»»ä½•æ–‡ä»¶æ—¶,å®ƒå°†ä¿æŒåŸæ ·ï¼ˆé™¤éåœ¨é€šé…ç¬¦åŠŸèƒ½ä¸­è¿è¡Œ<figure class="highlight makefile"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br></pre><td class=code><pre><span class=line>thing_wrong := *.o <span class=comment># Don't do this! '*' will not get expanded</span></span><br><span class=line>thing_right := <span class=variable>$(<span class=built_in>wildcard</span> *.o)</span></span><br><span class=line></span><br><span class=line><span class=section>all: one two three four</span></span><br><span class=line></span><br><span class=line><span class=comment># Fails, because $(thing_wrong) is the string "*.o"</span></span><br><span class=line><span class=section>one: <span class=variable>$(thing_wrong)</span></span></span><br><span class=line></span><br><span class=line><span class=comment># Stays as *.o if there are no files that match this pattern :(</span></span><br><span class=line><span class=section>two: *.o </span></span><br><span class=line></span><br><span class=line><span class=comment># Works as you would expect! In this case, it does nothing.</span></span><br><span class=line><span class=section>three: <span class=variable>$(thing_right)</span></span></span><br><span class=line></span><br><span class=line><span class=comment># Same as rule three</span></span><br><span class=line><span class=section>four: $(wildcard *.o)</span></span><br></pre></table></figure><p>% éå¸¸æœ‰ç”¨ï¼Œä½†ç”±äºå…¶ä½¿ç”¨åœºåˆå¤šç§å¤šæ ·ï¼Œæ‰€ä»¥æœ‰äº›ä»¤äººå›°æƒ‘ã€‚ <strong>åœ¨ â€œåŒ¹é… â€œæ¨¡å¼ä¸‹ä½¿ç”¨æ—¶ï¼Œå®ƒä¼šåŒ¹é…å­—ç¬¦ä¸²ä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªå­—ç¬¦</strong>ï¼Œè¿™ç§åŒ¹é…ç§°ä¸ºè¯å¹²ã€‚<p><strong>åœ¨ â€œæ›¿æ¢ â€œæ¨¡å¼ä¸‹ä½¿ç”¨æ—¶ï¼Œå®ƒä¼šå°†åŒ¹é…åˆ°çš„å­—ç¬¦ä¸²æ›¿æ¢ä¸ºå­—ç¬¦ä¸²ä¸­çš„å­—ç¬¦ä¸²ã€‚% æœ€å¸¸ç”¨äºè§„åˆ™å®šä¹‰å’ŒæŸäº›ç‰¹å®šå‡½æ•°ä¸­</strong>ã€‚<figure class="highlight makefile"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br></pre><td class=code><pre><span class=line><span class=section>hey: one two</span></span><br><span class=line>	<span class=comment># Outputs "hey", since this is the target name</span></span><br><span class=line>	echo <span class=variable>$@</span></span><br><span class=line></span><br><span class=line>	<span class=comment># Outputs all prerequisites newer than the target</span></span><br><span class=line>	echo <span class=variable>$?</span></span><br><span class=line></span><br><span class=line>	<span class=comment># Outputs all prerequisites</span></span><br><span class=line>	echo <span class=variable>$^</span></span><br><span class=line></span><br><span class=line>	<span class=comment># Outputs the first prerequisite</span></span><br><span class=line>	echo <span class=variable>$<</span></span><br><span class=line></span><br><span class=line>	touch hey</span><br><span class=line></span><br><span class=line><span class=section>one:</span></span><br><span class=line>	touch one</span><br><span class=line></span><br><span class=line><span class=section>two:</span></span><br><span class=line>	touch two</span><br><span class=line></span><br><span class=line><span class=section>clean:</span></span><br><span class=line>	rm -f hey one two</span><br></pre></table></figure><h3 id=éšå¼è§„åˆ™><a class=headerlink href=#éšå¼è§„åˆ™ title=éšå¼è§„åˆ™></a>éšå¼è§„åˆ™</h3><p>ä¸‹é¢æ˜¯ä¸€ä¸ªéšå«è§„åˆ™åˆ—è¡¨ï¼š<ul><li>Compiling a C program: <code>n.o</code> is made automatically from <code>n.c</code> with a command of the form <code>$(CC) -c $(CPPFLAGS) $(CFLAGS) $^ -o $@</code><li>Compiling a C++ program: <code>n.o</code> is made automatically from <code>n.cc</code> or <code>n.cpp</code> with a command of the form <code>$(CXX) -c $(CPPFLAGS) $(CXXFLAGS) $^ -o $@</code><li>Linking a single object file: <code>n</code> is made automatically from <code>n.o</code> by running the command <code>$(CC) $(LDFLAGS) $^ $(LOADLIBES) $(LDLIBS) -o $@</code></ul><p>è¿™äº›å€¼é»˜è®¤<ul><li><code>CC</code>: Program for compiling C programs; default <code>cc</code><li><code>CXX</code>: Program for compiling C++ programs; default <code>g++</code><li><code>CFLAGS</code>: Extra flags to give to the C compiler<li><code>CXXFLAGS</code>: Extra flags to give to the C++ compiler<li><code>CPPFLAGS</code>: Extra flags to give to the C preprocessor<li><code>LDFLAGS</code>: Extra flags to give to compilers when they are supposed to invoke the linke</ul><figure class="highlight makefile"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br></pre><td class=code><pre><span class=line>CC = gcc <span class=comment># Flag for implicit rules</span></span><br><span class=line>CFLAGS = -g <span class=comment># Flag for implicit rules. Turn on debug info</span></span><br><span class=line></span><br><span class=line><span class=comment># Implicit rule #1: blah is built via the C linker implicit rule</span></span><br><span class=line><span class=comment># Implicit rule #2: blah.o is built via the C compilation implicit rule, because blah.c exists</span></span><br><span class=line><span class=section>blah: blah.o</span></span><br><span class=line></span><br><span class=line><span class=section>blah.c:</span></span><br><span class=line>	echo <span class=string>"int main() { return 0; }"</span> > blah.c</span><br><span class=line></span><br><span class=line><span class=section>clean:</span></span><br><span class=line>	rm -f blah*</span><br></pre></table></figure><p>é™æ€æ¨¡å¼è§„åˆ™æ˜¯åœ¨ Makefile ä¸­å°‘å†™ä»£ç çš„å¦ä¸€ç§æ–¹æ³•ã€‚<figure class="highlight makefile"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br></pre><td class=code><pre><span class=line><span class=section>targets...: target-pattern: prereq-patterns ...</span></span><br><span class=line>   commands</span><br></pre></table></figure><p>å…¶æœ¬è´¨æ˜¯é€šè¿‡ç›®æ ‡æ¨¡å¼ï¼ˆé€šè¿‡ % é€šé…ç¬¦ï¼‰åŒ¹é…ç»™å®šç›®æ ‡ã€‚ åŒ¹é…åˆ°çš„å†…å®¹ç§°ä¸ºè¯å¹²ã€‚ ç„¶åï¼Œå°†è¯å¹²ä»£å…¥å…ˆå†³æ¡ä»¶æ¨¡å¼ï¼Œç”Ÿæˆç›®æ ‡çš„å…ˆå†³æ¡ä»¶ã€‚<figure class="highlight makefile"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br></pre><td class=code><pre><span class=line>objects = foo.o bar.o all.o</span><br><span class=line><span class=section>all: <span class=variable>$(objects)</span></span></span><br><span class=line>	<span class=variable>$(CC)</span> <span class=variable>$^</span> -o all</span><br><span class=line></span><br><span class=line><span class=section>foo.o: foo.c</span></span><br><span class=line>	<span class=variable>$(CC)</span> -c foo.c -o foo.o</span><br><span class=line></span><br><span class=line><span class=section>bar.o: bar.c</span></span><br><span class=line>	<span class=variable>$(CC)</span> -c bar.c -o bar.o</span><br><span class=line></span><br><span class=line><span class=section>all.o: all.c</span></span><br><span class=line>	<span class=variable>$(CC)</span> -c all.c -o all.o</span><br><span class=line></span><br><span class=line><span class=section>all.c:</span></span><br><span class=line>	echo <span class=string>"int main() { return 0; }"</span> > all.c</span><br><span class=line></span><br><span class=line><span class=comment># Note: all.c does not use this rule because Make prioritizes more specific matches when there is more than one match.</span></span><br><span class=line><span class=section>%.c:</span></span><br><span class=line>	touch <span class=variable>$@</span></span><br><span class=line></span><br><span class=line><span class=section>clean:</span></span><br><span class=line>	rm -f *.c *.o all</span><br></pre></table></figure><p>æ›´é«˜æ•ˆçš„æ–¹æ³•<figure class="highlight makefile"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br></pre><td class=code><pre><span class=line>objects = foo.o bar.o all.o</span><br><span class=line><span class=section>all: <span class=variable>$(objects)</span></span></span><br><span class=line>	<span class=variable>$(CC)</span> <span class=variable>$^</span> -o all</span><br><span class=line></span><br><span class=line><span class=comment># Syntax - targets ...: target-pattern: prereq-patterns ...</span></span><br><span class=line><span class=comment># In the case of the first target, foo.o, the target-pattern matches foo.o and sets the "stem" to be "foo".</span></span><br><span class=line><span class=comment># It then replaces the '%' in prereq-patterns with that stem</span></span><br><span class=line><span class=variable>$(objects)</span>: %.o: %.c</span><br><span class=line>	<span class=variable>$(CC)</span> -c <span class=variable>$^</span> -o <span class=variable>$@</span></span><br><span class=line></span><br><span class=line><span class=section>all.c:</span></span><br><span class=line>	echo <span class=string>"int main() { return 0; }"</span> > all.c</span><br><span class=line></span><br><span class=line><span class=comment># Note: all.c does not use this rule because Make prioritizes more specific matches when there is more than one match.</span></span><br><span class=line><span class=section>%.c:</span></span><br><span class=line>	touch <span class=variable>$@</span></span><br><span class=line></span><br><span class=line><span class=section>clean:</span></span><br><span class=line>	rm -f *.c *.o all</span><br></pre></table></figure><p>è¿‡æ»¤å™¨å‡½æ•°å¯ç”¨äºé™æ€æ¨¡å¼è§„åˆ™ï¼Œä»¥åŒ¹é…æ­£ç¡®çš„æ–‡ä»¶ã€‚<figure class="highlight makefile"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br></pre><td class=code><pre><span class=line>obj_files = foo.result bar.o lose.o</span><br><span class=line>src_files = foo.raw bar.c lose.c</span><br><span class=line></span><br><span class=line><span class=section>all: <span class=variable>$(obj_files)</span></span></span><br><span class=line><span class=comment># Note: PHONY is important here. Without it, implicit rules will try to build the executable "all", since the prereqs are ".o" files.</span></span><br><span class=line><span class=meta><span class=meta-keyword>.PHONY</span>: all </span></span><br><span class=line></span><br><span class=line><span class=comment># Ex 1: .o files depend on .c files. Though we don't actually make the .o file.</span></span><br><span class=line><span class=variable>$(<span class=built_in>filter</span> %.o,<span class=variable>$(obj_files)</span>)</span>: %.o: %.c</span><br><span class=line>	echo <span class=string>"target: <span class=variable>$@</span> prereq: <span class=variable>$<</span>"</span></span><br><span class=line></span><br><span class=line><span class=comment># Ex 2: .result files depend on .raw files. Though we don't actually make the .result file.</span></span><br><span class=line><span class=variable>$(<span class=built_in>filter</span> %.result,<span class=variable>$(obj_files)</span>)</span>: %.result: %.raw</span><br><span class=line>	echo <span class=string>"target: <span class=variable>$@</span> prereq: <span class=variable>$<</span>"</span> </span><br><span class=line></span><br><span class=line>%.c %.raw:</span><br><span class=line>	touch <span class=variable>$@</span></span><br><span class=line></span><br><span class=line><span class=section>clean:</span></span><br><span class=line>	rm -f <span class=variable>$(src_files)</span></span><br></pre></table></figure><p>æ¨¡å¼è§„åˆ™ç»å¸¸è¢«ä½¿ç”¨ï¼Œä½†å¾ˆå®¹æ˜“æ··æ·†ã€‚ ä½ å¯ä»¥ä»ä¸¤ä¸ªæ–¹é¢æ¥çœ‹å¾…å®ƒä»¬ï¼š<ol><li>ä¸€ç§å®šä¹‰è‡ªå·±çš„éšå¼è§„åˆ™çš„æ–¹æ³•<li>ä¸€ç§æ›´ç®€å•çš„é™æ€æ¨¡å¼è§„åˆ™å½¢å¼</ol><figure class="highlight makefile"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br></pre><td class=code><pre><span class=line><span class=comment># Define a pattern rule that compiles every .c file into a .o file</span></span><br><span class=line>%.o : %.c</span><br><span class=line>		<span class=variable>$(CC)</span> -c <span class=variable>$(CFLAGS)</span> <span class=variable>$(CPPFLAGS)</span> <span class=variable>$<</span> -o <span class=variable>$@</span></span><br></pre></table></figure><p>æ¨¡å¼è§„åˆ™åœ¨ç›®æ ‡ä¸­åŒ…å«ä¸€ä¸ªâ€%â€ã€‚ è¯¥â€™%â€™åŒ¹é…ä»»ä½•éç©ºå­—ç¬¦ä¸²ï¼Œå…¶ä»–å­—ç¬¦åˆ™è‡ªè¡ŒåŒ¹é…ã€‚<p>æ¨¡å¼è§„åˆ™<strong>å…ˆå†³æ¡ä»¶ä¸­çš„â€%â€ä»£è¡¨ä¸ç›®æ ‡ä¸­çš„â€%â€åŒ¹é…çš„åŒä¸€è¯å¹²</strong>ã€‚<p>åŒå†’å·è§„åˆ™å¾ˆå°‘ä½¿ç”¨,ä½†å…è®¸ä¸ºåŒä¸€ç›®æ ‡å®šä¹‰å¤šä¸ªè§„åˆ™ã€‚ å¦‚æœè¿™äº›è§„åˆ™æ˜¯å•å†’å·,åˆ™ä¼šæ‰“å°è­¦å‘Š,å¹¶ä¸”åªä¼šè¿è¡Œç¬¬äºŒç»„å‘½ä»¤.<figure class="highlight makefile"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br></pre><td class=code><pre><span class=line><span class=section>all: blah</span></span><br><span class=line><span class=section>blah::</span></span><br><span class=line>	echo <span class=string>"hello"</span></span><br><span class=line><span class=section>blah::</span></span><br><span class=line>	echo <span class=string>"hello again"</span></span><br></pre></table></figure><p>åœ¨å‘½ä»¤å‰æ·»åŠ  @ï¼Œä»¥é˜»æ­¢å‘½ä»¤è¢«æ‰“å°<p>ä¹Ÿå¯ä»¥ä½¿ç”¨ -s è¿è¡Œ makeï¼Œåœ¨æ¯ä¸€è¡Œå‰æ·»åŠ  @ã€‚<figure class="highlight makefile"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br></pre><td class=code><pre><span class=line><span class=section>all: </span></span><br><span class=line>	@echo <span class=string>"This make line will not be printed"</span></span><br><span class=line>	echo <span class=string>"But this will"</span></span><br></pre></table></figure><p>æ¯æ¡å‘½ä»¤éƒ½åœ¨ä¸€ä¸ªæ–°çš„ shell ä¸­è¿è¡Œ<figure class="highlight makefile"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br></pre><td class=code><pre><span class=line><span class=section>all: </span></span><br><span class=line>	cd ..</span><br><span class=line>	<span class=comment># The cd above does not affect this line, because each command is effectively run in a new shell</span></span><br><span class=line>	echo `pwd`</span><br><span class=line></span><br><span class=line>	<span class=comment># This cd command affects the next because they are on the same line</span></span><br><span class=line>	cd ..;echo `pwd`</span><br><span class=line></span><br><span class=line>	<span class=comment># Same as above</span></span><br><span class=line>	cd ..; \</span><br><span class=line>	echo `pwd`</span><br></pre></table></figure><p>ä¿®æ”¹é»˜è®¤shell<code>/bin/sh</code><figure class="highlight makefile"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br></pre><td class=code><pre><span class=line>SHELL=/bin/bash</span><br><span class=line></span><br><span class=line><span class=section>cool:</span></span><br><span class=line>	echo <span class=string>"Hello from bash"</span></span><br></pre></table></figure><p>å¦‚æœå¸Œæœ›å­—ç¬¦ä¸²å¸¦æœ‰ç¾å…ƒç¬¦å·ï¼Œå¯ä»¥ä½¿ç”¨ $$ã€‚ è¿™å°±æ˜¯åœ¨ bash æˆ– sh ä¸­ä½¿ç”¨ shell å˜é‡çš„æ–¹æ³•ï¼Œè¯·æ³¨æ„ Makefile å˜é‡å’Œ Shell å˜é‡ä¹‹é—´çš„åŒºåˆ«ã€‚<figure class="highlight makefile"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br></pre><td class=code><pre><span class=line>make_var = I am a make variable</span><br><span class=line><span class=section>all:</span></span><br><span class=line>	<span class=comment># Same as running "sh_var='I am a shell variable'; echo $sh_var" in the shell</span></span><br><span class=line>	sh_var='I am a shell variable'; echo $$sh_var</span><br><span class=line></span><br><span class=line>	<span class=comment># Same as running "echo I am a make variable" in the shell</span></span><br><span class=line>	echo <span class=variable>$(make_var)</span></span><br></pre></table></figure><p>åœ¨è¿è¡Œ make æ—¶æ·»åŠ  -kï¼Œå³ä½¿å‡ºç°é”™è¯¯ä¹Ÿèƒ½ç»§ç»­è¿è¡Œã€‚ åœ¨å‘½ä»¤å‰æ·»åŠ  - å¯ä»¥æŠ‘åˆ¶é”™è¯¯<p>åœ¨ make ä¸­æ·»åŠ  -i å¯ä»¥è®©æ¯æ¡å‘½ä»¤éƒ½å‡ºé”™ã€‚<p>è¦é€’å½’è°ƒç”¨ makefileï¼Œè¯·ä½¿ç”¨ç‰¹æ®Šçš„ $(MAKE) è€Œä¸æ˜¯ makeï¼Œå› ä¸ºå®ƒä¼šä¸ºä½ ä¼ é€’ make æ ‡å¿—ï¼Œè€Œè‡ªèº«ä¸ä¼šå—å…¶å½±å“ã€‚<figure class="highlight makefile"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br></pre><td class=code><pre><span class=line>new_contents = <span class=string>"hello:\n\ttouch inside_file"</span></span><br><span class=line><span class=section>all:</span></span><br><span class=line>	mkdir -p subdir</span><br><span class=line>	printf <span class=variable>$(new_contents)</span> | sed -e 's/^ //' > subdir/makefile</span><br><span class=line>	cd subdir && <span class=variable>$(MAKE)</span></span><br><span class=line></span><br><span class=line><span class=section>clean:</span></span><br><span class=line>	rm -rf subdir</span><br></pre></table></figure><p>å½“ Make å¯åŠ¨æ—¶ï¼Œå®ƒä¼š<strong>è‡ªåŠ¨ä»æ‰§è¡Œæ—¶è®¾ç½®çš„æ‰€æœ‰ç¯å¢ƒå˜é‡ä¸­åˆ›å»º Make å˜é‡</strong>ã€‚<figure class="highlight makefile"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br></pre><td class=code><pre><span class=line><span class=comment># Run this with "export shell_env_var='I am an environment variable'; make"</span></span><br><span class=line><span class=section>all:</span></span><br><span class=line>	<span class=comment># Print out the Shell variable</span></span><br><span class=line>	echo $$shell_env_var</span><br><span class=line></span><br><span class=line>	<span class=comment># Print out the Make variable</span></span><br><span class=line>	echo <span class=variable>$(shell_env_var)</span></span><br></pre></table></figure><p>exportæŒ‡ä»¤ä½¿ç”¨ä¸€ä¸ªå˜é‡ï¼Œå¹¶å°†å…¶è®¾ç½®ä¸ºæ‰€æœ‰ shell å‘½ä»¤çš„ç¯å¢ƒï¼š<figure class="highlight makefile"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br></pre><td class=code><pre><span class=line>shell_env_var=Shell env var, created inside of Make</span><br><span class=line><span class=keyword>export</span> shell_env_var</span><br><span class=line><span class=section>all:</span></span><br><span class=line>	echo <span class=variable>$(shell_env_var)</span></span><br><span class=line>	echo $$shell_env_var</span><br></pre></table></figure><p>è®¾ç½®ä¸€ä¸ªç›®æ ‡å¯¼å‡ºå˜é‡<figure class="highlight makefile"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br></pre><td class=code><pre><span class=line><span class=section>.EXPORT_ALL_VARIABLES:</span></span><br><span class=line>new_contents = <span class=string>"hello:\n\techo \$<span class=variable>$(cooly)</span>"</span></span><br><span class=line></span><br><span class=line>cooly = <span class=string>"The subdirectory can see me!"</span></span><br><span class=line><span class=comment># This would nullify the line above: unexport cooly</span></span><br><span class=line></span><br><span class=line><span class=section>all:</span></span><br><span class=line>	mkdir -p subdir</span><br><span class=line>	printf <span class=variable>$(new_contents)</span> | sed -e 's/^ //' > subdir/makefile</span><br><span class=line>	@echo <span class=string>"---MAKEFILE CONTENTS---"</span></span><br><span class=line>	@cd subdir && cat makefile</span><br><span class=line>	@echo <span class=string>"---END MAKEFILE CONTENTS---"</span></span><br><span class=line>	cd subdir && <span class=variable>$(MAKE)</span></span><br><span class=line></span><br><span class=line><span class=section>clean:</span></span><br><span class=line>	rm -rf subdir</span><br></pre></table></figure><p>å˜é‡æœ‰ä¸¤ç§ç±»å‹ï¼š<p>é€’å½’ï¼ˆä½¿ç”¨ =ï¼‰â€”åªåœ¨ä½¿ç”¨å‘½ä»¤æ—¶æŸ¥æ‰¾å˜é‡ï¼Œè€Œä¸æ˜¯åœ¨å®šä¹‰å˜é‡æ—¶æŸ¥æ‰¾ã€‚<p>ç®€å•æ‰©å±•ï¼ˆä½¿ç”¨ :=ï¼‰â€”å°±åƒæ™®é€šçš„å‘½ä»¤å¼ç¼–ç¨‹â€”åªæ‰©å±•ç›®å‰å·²å®šä¹‰çš„å˜é‡ã€‚<figure class="highlight makefile"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br></pre><td class=code><pre><span class=line><span class=comment># Recursive variable. This will print "later" below</span></span><br><span class=line>one = one ${later_variable}</span><br><span class=line><span class=comment># Simply expanded variable. This will not print "later" below</span></span><br><span class=line>two := two ${later_variable}</span><br><span class=line></span><br><span class=line>later_variable = later</span><br><span class=line></span><br><span class=line><span class=section>all: </span></span><br><span class=line>	echo <span class=variable>$(one)</span></span><br><span class=line>	echo <span class=variable>$(two)</span></span><br></pre></table></figure><p><code>?=</code> only sets variables if they have not yet been set<figure class="highlight makefile"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br></pre><td class=code><pre><span class=line>one = hello</span><br><span class=line>one ?= will not be set</span><br><span class=line>two ?= will be set</span><br><span class=line></span><br><span class=line><span class=section>all: </span></span><br><span class=line>	echo <span class=variable>$(one)</span></span><br><span class=line>	echo <span class=variable>$(two)</span></span><br></pre></table></figure><p>è¡Œå°¾çš„ç©ºæ ¼ä¸ä¼šè¢«åˆ é™¤ï¼Œä½†è¡Œé¦–çš„ç©ºæ ¼ä¼šè¢«åˆ é™¤ã€‚ è¦ä½¿ç”¨å•ç©ºæ ¼åˆ›å»ºå˜é‡ï¼Œè¯·ä½¿ç”¨ $(nullstring)<figure class="highlight makefile"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br></pre><td class=code><pre><span class=line>with_spaces = hello   <span class=comment># with_spaces has many spaces after "hello"</span></span><br><span class=line>after = <span class=variable>$(with_spaces)</span>there</span><br><span class=line></span><br><span class=line>nullstring =</span><br><span class=line>space = <span class=variable>$(nullstring)</span> <span class=comment># Make a variable with a single space.</span></span><br><span class=line></span><br><span class=line><span class=section>all: </span></span><br><span class=line>	echo <span class=string>"<span class=variable>$(after)</span>"</span></span><br><span class=line>	echo start<span class=string>"<span class=variable>$(space)</span>"</span>end</span><br></pre></table></figure><p>æœªå®šä¹‰å˜é‡å®é™…ä¸Šæ˜¯ä¸€ä¸ªç©ºå­—ç¬¦ä¸²<p>ä½¿ç”¨<code>+=</code>æ·»åŠ <figure class="highlight makefile"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br></pre><td class=code><pre><span class=line>foo := start</span><br><span class=line>foo += more</span><br><span class=line></span><br><span class=line><span class=section>all: </span></span><br><span class=line>	echo <span class=variable>$(foo)</span></span><br></pre></table></figure><p>ä½¿ç”¨ override å¯ä»¥è¦†ç›–å‘½ä»¤è¡Œå˜é‡ã€‚<figure class="highlight makefile"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br></pre><td class=code><pre><span class=line><span class=comment># Overrides command line arguments</span></span><br><span class=line><span class=keyword>override</span> option_one = did_override</span><br><span class=line><span class=comment># Does not override command line arguments</span></span><br><span class=line>option_two = not_override</span><br><span class=line><span class=section>all: </span></span><br><span class=line>	echo <span class=variable>$(option_one)</span></span><br><span class=line>	echo <span class=variable>$(option_two)</span></span><br></pre></table></figure><p>å®šä¹‰æŒ‡ä»¤å¹¶ä¸æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå°½ç®¡å®ƒçœ‹èµ·æ¥åƒã€‚ <strong>define/endef åªæ˜¯åˆ›å»ºä¸€ä¸ªå˜é‡,å¹¶å°†å…¶è®¾ç½®ä¸ºä¸€ç³»åˆ—å‘½ä»¤</strong>ã€‚ è¯·æ³¨æ„ï¼Œè¿™ä¸åœ¨å‘½ä»¤ä¹‹é—´ä½¿ç”¨åˆ†å·æœ‰ç‚¹ä¸åŒï¼Œå› ä¸ºæ¯ä¸ªå‘½ä»¤éƒ½ä¼šåœ¨å•ç‹¬çš„ shell ä¸­è¿è¡Œã€‚<figure class="highlight makefile"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br></pre><td class=code><pre><span class=line>one = <span class=keyword>export</span> blah=<span class=string>"I was set!"</span>; echo $$blah</span><br><span class=line></span><br><span class=line><span class=keyword>define</span> two</span><br><span class=line><span class=keyword>export</span> blah=<span class=string>"I was set!"</span></span><br><span class=line>echo $$blah</span><br><span class=line><span class=keyword>endef</span></span><br><span class=line></span><br><span class=line><span class=section>all: </span></span><br><span class=line>	@echo <span class=string>"This prints 'I was set'"</span></span><br><span class=line>	@<span class=variable>$(one)</span></span><br><span class=line>	@echo <span class=string>"This does not print 'I was set' because each command runs in a separate shell"</span></span><br><span class=line>	@<span class=variable>$(two)</span></span><br></pre></table></figure><p>å¯ä¸ºç‰¹å®šç›®æ ‡è®¾ç½®å˜é‡,ä¹Ÿå¯ä»¥ä¸ºç‰¹å®šç›®æ ‡æ¨¡å¼è®¾ç½®å˜é‡<figure class="highlight makefile"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br></pre><td class=code><pre><span class=line><span class=section>all: one = cool</span></span><br><span class=line></span><br><span class=line><span class=section>all: </span></span><br><span class=line>	echo one is defined: <span class=variable>$(one)</span></span><br><span class=line></span><br><span class=line><span class=section>other:</span></span><br><span class=line>	echo one is nothing: <span class=variable>$(one)</span></span><br><span class=line>	</span><br><span class=line><span class=section>%.c: one = cool</span></span><br><span class=line></span><br><span class=line><span class=section>blah.c: </span></span><br><span class=line>	echo one is defined: <span class=variable>$(one)</span></span><br><span class=line></span><br><span class=line><span class=section>other:</span></span><br><span class=line>	echo one is nothing: <span class=variable>$(one)</span></span><br><span class=line>	</span><br></pre></table></figure><h3 id=æ¡ä»¶><a class=headerlink href=#æ¡ä»¶ title=æ¡ä»¶></a>æ¡ä»¶</h3><figure class="highlight makefile"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br></pre><td class=code><pre><span class=line>foo = ok</span><br><span class=line><span class=section>all:</span></span><br><span class=line><span class=keyword>ifeq</span> (<span class=variable>$(foo)</span>, ok)</span><br><span class=line>	echo <span class=string>"foo equals ok"</span></span><br><span class=line><span class=keyword>else</span></span><br><span class=line>	echo <span class=string>"nope"</span></span><br><span class=line><span class=keyword>endif</span></span><br></pre></table></figure><p>æ£€æŸ¥å˜é‡æ˜¯å¦ä¸ºç©º<figure class="highlight makefile"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br></pre><td class=code><pre><span class=line>nullstring =</span><br><span class=line>foo = <span class=variable>$(nullstring)</span> <span class=comment># end of line; there is a space here</span></span><br><span class=line></span><br><span class=line><span class=section>all:</span></span><br><span class=line><span class=keyword>ifeq</span> (<span class=variable>$(<span class=built_in>strip</span> <span class=variable>$(foo)</span>)</span>,)</span><br><span class=line>	echo <span class=string>"foo is empty after being stripped"</span></span><br><span class=line><span class=keyword>endif</span></span><br><span class=line><span class=keyword>ifeq</span> (<span class=variable>$(nullstring)</span>,)</span><br><span class=line>	echo <span class=string>"nullstring doesn't even have spaces"</span></span><br><span class=line><span class=keyword>endif</span></span><br></pre></table></figure><p>ifdef ä¸ä¼šæ‰©å±•å˜é‡å¼•ç”¨ï¼›å®ƒåªæ˜¯æŸ¥çœ‹æ˜¯å¦å®šä¹‰äº†æŸä¸ªå˜é‡<figure class="highlight makefile"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br></pre><td class=code><pre><span class=line>bar =</span><br><span class=line>foo = <span class=variable>$(bar)</span></span><br><span class=line></span><br><span class=line><span class=section>all:</span></span><br><span class=line><span class=keyword>ifdef</span> foo</span><br><span class=line>	echo <span class=string>"foo is defined"</span></span><br><span class=line><span class=keyword>endif</span></span><br><span class=line><span class=keyword>ifndef</span> bar</span><br><span class=line>	echo <span class=string>"but bar is not"</span></span><br><span class=line><span class=keyword>endif</span></span><br></pre></table></figure><p>æŸ¥çœ‹makeæ ‡å¿—ï¼Œä½¿ç”¨ findstring å’Œ MAKEFLAGS æµ‹è¯• make æ ‡å¿—ã€‚ ä½¿ç”¨ make -i è¿è¡Œæ­¤ç¤ºä¾‹ï¼Œå³å¯çœ‹åˆ°å®ƒæ‰“å°å‡º echo è¯­å¥ã€‚<figure class="highlight makefile"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br></pre><td class=code><pre><span class=line><span class=section>all:</span></span><br><span class=line><span class=comment># Search for the "-i" flag. MAKEFLAGS is just a list of single characters, one per flag. So look for "i" in this case.</span></span><br><span class=line><span class=keyword>ifneq</span> (,<span class=variable>$(<span class=built_in>findstring</span> i, <span class=variable>$(MAKEFLAGS)</span>)</span>)</span><br><span class=line>	echo <span class=string>"i was passed to MAKEFLAGS"</span></span><br><span class=line><span class=keyword>endif</span></span><br></pre></table></figure><h3 id=å‡½æ•°><a class=headerlink href=#å‡½æ•° title=å‡½æ•°></a>å‡½æ•°</h3><p>å‡½æ•°ä¸»è¦ç”¨äºæ–‡æœ¬å¤„ç†. ä½¿ç”¨ $(fn, arguments) æˆ– ${fn, arguments} è°ƒç”¨å‡½æ•°. Make æœ‰å¤§é‡å†…ç½®å‡½æ•°.<figure class="highlight makefile"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br></pre><td class=code><pre><span class=line>bar := ${subst not,<span class=string>"totally"</span>, <span class=string>"I am not superman"</span>}</span><br><span class=line><span class=section>all: </span></span><br><span class=line>	@echo <span class=variable>$(bar)</span></span><br></pre></table></figure><p>å‡½æ•° subst å°†notæ›¿æ¢ä¸ºtotally.<figure class="highlight makefile"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line>comma := , empty:= space := <span class=variable>$(empty)</span> <span class=variable>$(empty)</span> foo := a b c bar := <span class=variable>$(<span class=built_in>subst</span> <span class=variable>$(space)</span>, <span class=variable>$(comma)</span> , <span class=variable>$(foo)</span>)</span> <span class=comment># Watch out! all:  # Output is ", a , b , c". Notice the spaces introduced @echo $(bar)</span></span><br></pre></table></figure><p>æ­¤å¤–è¿˜æœ‰patsubst,foreach,if,call,shell,filterç­‰å‡½æ•°,<p><code>$(patsubst pattern,replacement,text)</code><p>è¿˜æœ‰ä¸€ç§åªæ›¿æ¢åç¼€çš„é€Ÿè®°æ–¹æ³•ï¼š$(text:suffix=replacement).æ³¨æ„:ä¸è¦ä¸ºè¿™ç§é€Ÿè®°æ–¹æ³•æ·»åŠ é¢å¤–çš„ç©ºæ ¼.å®ƒä¼šè¢«è§†ä¸ºæœç´¢æˆ–æ›¿æ¢è¯ã€‚<figure class="highlight makefile"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br></pre><td class=code><pre><span class=line>foo := a.o b.o l.a c.o</span><br><span class=line>one := <span class=variable>$(<span class=built_in>patsubst</span> %.o,%.c,<span class=variable>$(foo)</span>)</span></span><br><span class=line><span class=comment># This is a shorthand for the above</span></span><br><span class=line>two := $(foo:%.o=%.c)</span><br><span class=line><span class=comment># This is the suffix-only shorthand, and is also equivalent to the above.</span></span><br><span class=line>three := $(foo:.o=.c)</span><br><span class=line></span><br><span class=line><span class=section>all:</span></span><br><span class=line>	echo <span class=variable>$(one)</span></span><br><span class=line>	echo <span class=variable>$(two)</span></span><br><span class=line>	echo <span class=variable>$(three)</span></span><br></pre></table></figure><p><code>$(foreach var,list,text)</code> å®ƒå°†ä¸€ä¸ªå•è¯åˆ—è¡¨ï¼ˆç”¨ç©ºæ ¼åˆ†éš”ï¼‰è½¬æ¢ä¸ºå¦ä¸€ä¸ªå•è¯åˆ—è¡¨.<p>var è®¾ç½®ä¸ºåˆ—è¡¨ä¸­çš„æ¯ä¸ªå•è¯,text åˆ™ä¸ºæ¯ä¸ªå•è¯å±•å¼€.<figure class="highlight makefile"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br></pre><td class=code><pre><span class=line>foo := who are you</span><br><span class=line><span class=comment># For each "word" in foo, output that same word with an exclamation after</span></span><br><span class=line>bar := <span class=variable>$(<span class=built_in>foreach</span> wrd,<span class=variable>$(foo)</span>,<span class=variable>$(wrd)</span>!)</span></span><br><span class=line></span><br><span class=line><span class=section>all:</span></span><br><span class=line>	<span class=comment># Output is "who! are! you!"</span></span><br><span class=line>	@echo <span class=variable>$(bar)</span></span><br></pre></table></figure><p>if æ£€æŸ¥ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å¦ä¸ºéç©ºã€‚ å¦‚æœæ˜¯ï¼Œåˆ™è¿è¡Œç¬¬äºŒä¸ªå‚æ•°ï¼Œå¦åˆ™è¿è¡Œç¬¬ä¸‰ä¸ªå‚æ•°<figure class="highlight makefile"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br></pre><td class=code><pre><span class=line>foo := <span class=variable>$(<span class=built_in>if</span> this-is-not-empty,then!,else!)</span></span><br><span class=line>empty :=</span><br><span class=line>bar := <span class=variable>$(<span class=built_in>if</span> <span class=variable>$(empty)</span>,then!,else!)</span></span><br><span class=line></span><br><span class=line><span class=section>all:</span></span><br><span class=line>	@echo <span class=variable>$(foo)</span></span><br><span class=line>	@echo <span class=variable>$(bar)</span></span><br></pre></table></figure><p>m akeæ”¯æŒåˆ›å»ºåŸºæœ¬å‡½æ•°,åªéœ€é€šè¿‡åˆ›å»ºä¸€ä¸ªå˜é‡æ¥ â€œå®šä¹‰ â€œå‡½æ•°ï¼Œä½†è¦ä½¿ç”¨ (0)ã€(1) ç­‰å‚æ•°ã€‚ ç„¶åä½¿ç”¨ç‰¹æ®Šçš„è°ƒç”¨å†…ç½®å‡½æ•°è°ƒç”¨è¯¥å‡½æ•°ã€‚ è¯­æ³•æ˜¯ <code>(call variable,param,param)</code>ã€‚ (0)æ˜¯å˜é‡ï¼Œ(1)ã€(2)ç­‰æ˜¯å‚æ•°ã€‚<figure class="highlight makefile"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br></pre><td class=code><pre><span class=line>sweet_new_fn = Variable Name: $(0) First: $(1) Second: $(2) Empty Variable: $(3)</span><br><span class=line></span><br><span class=line><span class=section>all:</span></span><br><span class=line>	<span class=comment># Outputs "Variable Name: sweet_new_fn First: go Second: tigers Empty Variable:"</span></span><br><span class=line>	@echo <span class=variable>$(<span class=built_in>call</span> sweet_new_fn, go, tigers)</span></span><br></pre></table></figure><p><code>filter</code>å‡½æ•°ç”¨äºä»åˆ—è¡¨ä¸­é€‰æ‹©ç¬¦åˆç‰¹å®šæ¨¡å¼çš„æŸäº›å…ƒç´ ã€‚ ä¾‹å¦‚ï¼Œè¿™å°†é€‰æ‹© obj_files ä¸­ä»¥ .o ç»“å°¾çš„æ‰€æœ‰å…ƒç´ ã€‚<figure class="highlight makefile"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br></pre><td class=code><pre><span class=line><span class=comment># call function</span></span><br><span class=line><span class=section>all: </span></span><br><span class=line>	@echo <span class=variable>$(<span class=built_in>shell</span> ls -la)</span> <span class=comment># Very ugly because the newlines are gone!</span></span><br><span class=line>	</span><br><span class=line>obj_files = foo.result bar.o lose.o</span><br><span class=line>filtered_files = <span class=variable>$(<span class=built_in>filter</span> %.o,<span class=variable>$(obj_files)</span>)</span></span><br><span class=line></span><br><span class=line><span class=section>all:</span></span><br><span class=line>	@echo <span class=variable>$(filtered_files)</span></span><br></pre></table></figure><p>include æŒ‡ä»¤å‘Šè¯‰ make è¯»å–ä¸€ä¸ªæˆ–å¤šä¸ªå…¶ä»– makefileã€‚ å®ƒæ˜¯ makefile ä¸­çš„ä¸€è¡Œ<p>è¿™åœ¨ä½¿ç”¨ -M ç­‰ç¼–è¯‘å™¨æ ‡å¿—æ—¶ç‰¹åˆ«æœ‰ç”¨,è¿™äº›æ ‡å¿—ä¼šæ ¹æ®æºä»£ç åˆ›å»º Makefile. ä¾‹å¦‚,å¦‚æœæŸäº› c æ–‡ä»¶åŒ…å«ä¸€ä¸ªå¤´æ–‡ä»¶,é‚£ä¹ˆè¯¥å¤´æ–‡ä»¶å°±ä¼šè¢«æ·»åŠ åˆ°ç”± gcc ç¼–å†™çš„ Makefile ä¸­.<p>ä½¿ç”¨ vpath æŒ‡å®šå­˜åœ¨æŸäº›å…ˆå†³æ¡ä»¶é›†çš„ä½ç½®ã€‚ å…¶æ ¼å¼ä¸º vpath \<pattern> <ç›®å½•ï¼Œç©ºæ ¼/å†’å·åˆ†éš”> <\pattern> å¯ä»¥æœ‰ä¸€ä¸ª %ï¼Œå¯ä»¥åŒ¹é…ä»»ä½• 0 ä¸ªæˆ–å¤šä¸ªå­—ç¬¦ã€‚ æ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨å˜é‡ VPATH è¿›è¡Œå…¨å±€æ“ä½œ <figure class="highlight makefile"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br></pre><td class=code><pre><span class=line><span class=keyword>vpath</span> %.h ../headers ../other-directory</span><br><span class=line></span><br><span class=line><span class=comment># Note: vpath allows blah.h to be found even though blah.h is never in the current directory</span></span><br><span class=line><span class=section>some_binary: ../headers blah.h</span></span><br><span class=line>	touch some_binary</span><br><span class=line></span><br><span class=line><span class=section>../headers:</span></span><br><span class=line>	mkdir ../headers</span><br><span class=line></span><br><span class=line><span class=comment># We call the target blah.h instead of ../headers/blah.h, because that's the prereq that some_binary is looking for</span></span><br><span class=line><span class=comment># Typically, blah.h would already exist and you wouldn't need this.</span></span><br><span class=line><span class=section>blah.h:</span></span><br><span class=line>	touch ../headers/blah.h</span><br><span class=line></span><br><span class=line><span class=section>clean:</span></span><br><span class=line>	rm -rf ../headers</span><br><span class=line>	rm -f some_binary</span><br></pre></table></figure> <p>åœ¨ç›®æ ‡ä¸­æ·»åŠ  .PHONY å¯ä»¥é˜²æ­¢ Make å°†å‡ç›®æ ‡ä¸æ–‡ä»¶åæ··æ·†ã€‚ åœ¨æœ¬ä¾‹ä¸­ï¼Œå¦‚æœåˆ›å»ºäº† clean æ–‡ä»¶ï¼Œä»å°†è¿è¡Œ make cleanã€‚</p> <p>â€œphonyâ€ç›®æ ‡çš„åç§°é€šå¸¸å¾ˆå°‘æ˜¯æ–‡ä»¶åï¼Œåœ¨å®è·µä¸­å¾ˆå¤šäººéƒ½ä¼šè·³è¿‡è¿™ä¸€ç‚¹</p> <figure class="highlight makefile"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br></pre><td class=code><pre><span class=line><span class=section>some_file:</span></span><br><span class=line>	touch some_file</span><br><span class=line>	touch clean</span><br><span class=line></span><br><span class=line><span class=meta><span class=meta-keyword>.PHONY</span>: clean</span></span><br><span class=line><span class=section>clean:</span></span><br><span class=line>	rm -f some_file</span><br><span class=line>	rm -f clean</span><br></pre></table></figure> <p>å¦‚æœå‘½ä»¤è¿”å›éé›¶çš„é€€å‡ºçŠ¶æ€ï¼Œmake å·¥å…·å°†åœæ­¢è¿è¡Œè§„åˆ™ï¼ˆå¹¶è¿”å›å…ˆå†³æ¡ä»¶ï¼‰</p> <p>å¦‚æœè§„åˆ™ä»¥è¿™ç§æ–¹å¼å¤±è´¥ï¼ŒDELETE_ON_ERROR å°†åˆ é™¤è§„åˆ™çš„ç›®æ ‡ã€‚ è¿™å°†å‘ç”Ÿåœ¨æ‰€æœ‰ç›®æ ‡ä¸Šï¼Œè€Œä¸ä»…ä»…æ˜¯åƒ PHONY è¿™æ ·çš„ç›®æ ‡ã€‚ å°½ç®¡å‡ºäºå†å²åŸå› ï¼Œmake å¹¶æ²¡æœ‰è¿™æ ·åšï¼Œä½†æœ€å¥½è¿˜æ˜¯ä¸€ç›´ä½¿ç”¨è¿™ä¸ªåŠŸèƒ½ã€‚</p> <figure class="highlight makefile"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br></pre><td class=code><pre><span class=line><span class=section>.DELETE_ON_ERROR:</span></span><br><span class=line><span class=section>all: one two</span></span><br><span class=line></span><br><span class=line><span class=section>one:</span></span><br><span class=line>	touch one</span><br><span class=line>	false</span><br><span class=line></span><br><span class=line><span class=section>two:</span></span><br><span class=line>	touch two</span><br><span class=line>	false</span><br></pre></table></figure> <h2 id=cmake-fundamental><a title="cmake fundamental" class=headerlink href=#cmake-fundamental></a>cmake fundamental</h2><p>åœ¨Windowsä¸Šå¯é€‰æ‹©çš„æ„å»ºåç«¯æœ‰vs,codeblocksè¿™ç§è½¯ä»¶çš„æ–‡ä»¶ç»“æ„,æˆ–è€…å•çº¯çš„Makefilesä»¥åŠNinja.ç›¸å½“äºå¿½ç•¥äº†å‡ ä¸ªé¡¹ç›®æ„å»ºçš„å·®å¼‚.</p> <p><img alt=image-20231013105520974 data-src=https://i.imgur.com/0mXZUbA.png style=zoom:50%;></p> <h2 id=å¸¸ç”¨å˜é‡><a class=headerlink href=#å¸¸ç”¨å˜é‡ title=å¸¸ç”¨å˜é‡></a>å¸¸ç”¨å˜é‡</h2><p><code>PROJECT_BINARY_DIR</code></p> <p>ç¼–è¯‘ç”Ÿæˆé¡¹ç›®çš„ç›®å½•</p> <p><code>PROJECT_SOURCE_DIR</code></p> <p>é¡¶å±‚ç›®å½•</p> <p><code>EXECUTABLE_OUTPUT_PATH</code>ä»¥åŠ<code>LIBRARY_OUTPUT_PATH</code></p> <p>åˆ†åˆ«ç”¨æ¥é‡æ–°å®šä¹‰æœ€ç»ˆç»“æœçš„å­˜æ”¾ç›®å½•</p> <p><code>CMAKE_ARCHIVE_OUTPUT_DIRECTORY</code>ï¼šé»˜è®¤å­˜æ”¾é™æ€åº“çš„æ–‡ä»¶å¤¹ä½ç½®ï¼›</p> <p><code>CMAKE_LIBRARY_OUTPUT_DIRECTORY</code>ï¼šé»˜è®¤å­˜æ”¾åŠ¨æ€åº“çš„æ–‡ä»¶å¤¹ä½ç½®ï¼›</p> <p><code>LIBRARY_OUTPUT_PATH</code>ï¼šé»˜è®¤å­˜æ”¾åº“æ–‡ä»¶çš„ä½ç½®,å¦‚æœäº§ç”Ÿçš„æ˜¯é™æ€åº“å¹¶ä¸”æ²¡æœ‰æŒ‡å®š CMAKE_ARCHIVE_OUTPUT_DIRECTORY åˆ™å­˜æ”¾åœ¨è¯¥ç›®å½•ä¸‹,åŠ¨æ€åº“ä¹Ÿç±»ä¼¼ï¼›</p> <p><code>CMAKE_RUNTIME_OUTPUT_DIRECTORY</code>ï¼šå­˜æ”¾å¯æ‰§è¡Œè½¯ä»¶çš„ç›®å½•ï¼›</p> <p><code>CMAKE_CXX_FLAGS</code>å’Œ<code>CMAKE_C_FLAGS</code></p> <p>è®¾ç½®C/ C++ç¼–è¯‘é€‰é¡¹,<code>CMAKE_C_COMPILER</code>è®¾ç½®å¯¹åº”ç¼–è¯‘å™¨è·¯å¾„.</p> <p><code>BUILD_SHARED_LIBS</code></p> <p>ç”¨æ¥æ§åˆ¶é»˜è®¤çš„åº“ç¼–è¯‘æ–¹å¼,å¦‚æœä¸è¿›è¡Œè®¾ç½®,ä½¿ç”¨ADD_LIBRARY å¹¶æ²¡æœ‰æŒ‡å®šåº“ç±»å‹çš„æƒ…å†µä¸‹,é»˜è®¤ç¼–è¯‘ç”Ÿæˆçš„åº“éƒ½æ˜¯é™æ€åº“.</p> <p>æ­¤å¤–è¿˜æœ‰ä¸€äº›ç³»ç»Ÿä¿¡æ¯</p> <p><img alt=image-20231013163518609 data-src=https://i.imgur.com/cozY007.png></p> <p>ä½¿ç”¨$ENV{}è°ƒç”¨ç³»ç»Ÿå˜é‡.</p> <h2 id=æŒ‡å®šç”Ÿæˆç¨‹åº><a class=headerlink href=#æŒ‡å®šç”Ÿæˆç¨‹åº title=æŒ‡å®šç”Ÿæˆç¨‹åº></a>æŒ‡å®šç”Ÿæˆç¨‹åº</h2><figure class="highlight cmake"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br></pre><td class=code><pre><span class=line><span class=keyword>add_library</span>(&LTname> [STATIC | SHARED | MODULE]</span><br><span class=line>            [EXCLUDE_FROM_ALL]</span><br><span class=line>            source1 [source2 ...])</span><br></pre></table></figure> <p>å°†æºç sourceæ„å»ºæˆä¸€ä¸ªåº“ï¼Œ ä¾›ä»–äººä½¿ç”¨</p> <p><code>[STATIC | SHARED | MODULE]</code> ï¼šç±»å‹æœ‰ä¸‰ç§</p> <figure class="highlight cmake"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br></pre><td class=code><pre><span class=line><span class=keyword>add_executable</span>(< name> [WIN32] [MACOSX_BUNDLE]</span><br><span class=line>                [EXCLUDE_FROM_ALL]  source1 source2 â€¦ sourceN)</span><br></pre></table></figure> <p>ä½¿ç”¨ç»™å®šçš„æºæ–‡ä»¶ï¼Œä¸ºå·¥ç¨‹å¼•å…¥ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ã€‚å¼•å…¥ä¸€ä¸ªåä¸º< name>çš„å¯æ‰§è¡Œç›®æ ‡ï¼Œè¯¥ç›®æ ‡ä¼šç”±è°ƒç”¨è¯¥å‘½ä»¤æ—¶åœ¨æºæ–‡ä»¶åˆ—è¡¨ä¸­æŒ‡å®šçš„æºæ–‡ä»¶æ¥æ„å»º</p> <h2 id=æ·»åŠ å¤´æ–‡ä»¶ç›®å½•å’Œåº“><a class=headerlink href=#æ·»åŠ å¤´æ–‡ä»¶ç›®å½•å’Œåº“ title=æ·»åŠ å¤´æ–‡ä»¶ç›®å½•å’Œåº“></a>æ·»åŠ å¤´æ–‡ä»¶ç›®å½•å’Œåº“</h2><figure class="highlight cmake"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br></pre><td class=code><pre><span class=line><span class=keyword>include_directories</span>([AFTER|BEFORE] [SYSTEM]  dir1  dir2 ...)</span><br><span class=line><span class=keyword>target_include_directories</span>()</span><br></pre></table></figure> <p>å°†ç»™å®šç›®å½• dir1 dir2 åŠ ç»™ç¼–è¯‘å™¨æœç´¢åˆ°çš„åŒ…å«æ–‡ä»¶ .é»˜è®¤æƒ…å†µä¸‹ï¼ŒåŠ åˆ°ç›®å½•åˆ—è¡¨çš„æœ€å,target_include_directorieså¯ä»¥æŒ‡å®šé’ˆå¯¹ç›®æ ‡æ–‡ä»¶æ·»åŠ å¤´æ–‡ä»¶ç›®å½•.</p> <figure class="highlight cmake"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br></pre><td class=code><pre><span class=line><span class=keyword>target_link_libraries</span>(<<span class=keyword>target</span>> [item1] [item2] [...]</span><br><span class=line>                      [[debug|optimized|general] &LTitem>] ...)</span><br></pre></table></figure> <p>è¯¥æŒ‡ä»¤çš„ä½œç”¨ä¸ºå°†ç›®æ ‡æ–‡ä»¶ä¸åº“æ–‡ä»¶è¿›è¡Œé“¾æ¥ã€‚</p> <p>ä¸Šè¿°æŒ‡ä»¤ä¸­çš„<code>&LTtarget></code>æ˜¯æŒ‡é€šè¿‡add_executable()å’Œadd_library()æŒ‡ä»¤ç”Ÿæˆå·²ç»åˆ›å»ºçš„ç›®æ ‡æ–‡ä»¶.</p> <p>å¯ä»¥ä½¿ç”¨<code>&LTa>_FOUND</code>æ£€æŸ¥æ˜¯å¦é€šè¿‡findåŠ è½½æˆåŠŸ,ä¹‹åä½¿ç”¨target_link_librariesè¿æ¥.</p> <h2 id=find-package-amp-find-path-amp-find-library><a class=headerlink href=#find-package-amp-find-path-amp-find-library title=find_package&find_path&find_library></a>find_package&find_path&find_library</h2><p>find_pathå’Œfind_libraryåˆ†åˆ«ç”¨æ¥æ‰¾å¤´æ–‡ä»¶å’Œåº“.æ‰¾åˆ°ä¹‹åå¯ä»¥ä½¿ç”¨include_directoryæˆ–è€…target_link_librariesç”¨æ¥ä½¿ç”¨.</p> <figure class="highlight cmake"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br></pre><td class=code><pre><span class=line><span class=keyword>FIND_PATH</span>(myCeres NAMES ceress.h PATHS /ceres/<span class=keyword>include</span>/ceres NO_DEFAULT_PATH)</span><br><span class=line><span class=keyword>INCLUDE_DIRECTORIES</span>(<span class=variable>${myCeres}</span>)</span><br></pre></table></figure> <h2 id=ç¼–è¯‘æ—¶æ¶ˆæ¯è¾“å‡º><a class=headerlink href=#ç¼–è¯‘æ—¶æ¶ˆæ¯è¾“å‡º title=ç¼–è¯‘æ—¶æ¶ˆæ¯è¾“å‡º></a>ç¼–è¯‘æ—¶æ¶ˆæ¯è¾“å‡º</h2><figure class="highlight cmake"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line><span class=keyword>MESSAGE</span>(STATUS <span class=string>"HELLO"</span>)</span><br></pre></table></figure> <h2 id=è®¾ç½®å˜é‡><a class=headerlink href=#è®¾ç½®å˜é‡ title=è®¾ç½®å˜é‡></a>è®¾ç½®å˜é‡</h2><figure class="highlight cmake"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line><span class=keyword>set</span>(CMAKE_LIBRARY_OUTPUT_DIRECTORY <span class=variable>${CMAKE_SOURCE_DIR}</span>/lib/x86)</span><br></pre></table></figure> <p>setè®¾ç½®å˜é‡,åç»­ä½¿ç”¨${}ä½¿ç”¨å˜é‡</p> <h2 id=æ§åˆ¶ç»“æ„><a class=headerlink href=#æ§åˆ¶ç»“æ„ title=æ§åˆ¶ç»“æ„></a>æ§åˆ¶ç»“æ„</h2><p>if elseif else endif</p> <p>æ–‡ä»¶ä¸­å¯ä»¥ä½¿ç”¨æ¡ä»¶,å¾ªç¯ç­‰æ§åˆ¶è¯­å¥.å¯ä»¥ç”¨æ¥åˆ¤æ–­æ„å»ºæ—¶ç³»ç»Ÿçš„ä¸€äº›ç¯å¢ƒ.</p> <p>æ¯”å¦‚</p> <figure class="highlight cmake"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br></pre><td class=code><pre><span class=line><span class=comment># include dynamic link path</span></span><br><span class=line><span class=keyword>if</span>(CMAKE_SYSTEM_PROCESSOR <span class=keyword>MATCHES</span> <span class=string>"x86"</span>)</span><br><span class=line>    <span class=keyword>link_directories</span>(<span class=variable>${CMAKE_CURRENT_SOURCE_DIR}</span>/../nwpu_std_msgs/lib/x86)</span><br><span class=line>    <span class=keyword>link_directories</span>(<span class=variable>${CMAKE_CURRENT_SOURCE_DIR}</span>/../nwpucutils/lib/x86)</span><br><span class=line><span class=keyword>elseif</span>(CMAKE_SYSTEM_PROCESSOR <span class=keyword>MATCHES</span> <span class=string>"arm"</span>)</span><br><span class=line>    <span class=keyword>link_directories</span>(<span class=variable>${CMAKE_CURRENT_SOURCE_DIR}</span>/../nwpu_std_msgs/lib/arm)</span><br><span class=line>    <span class=keyword>link_directories</span>(<span class=variable>${CMAKE_CURRENT_SOURCE_DIR}</span>/../nwpucutils/lib/arm)</span><br><span class=line><span class=keyword>endif</span>()</span><br></pre></table></figure> <h2 id=æ·»åŠ å…¶ä»–å­ç›®å½•><a class=headerlink href=#æ·»åŠ å…¶ä»–å­ç›®å½• title=æ·»åŠ å…¶ä»–å­ç›®å½•></a>æ·»åŠ å…¶ä»–å­ç›®å½•</h2><figure class="highlight cmake"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line><span class=keyword>add_subdirectory</span>(source_dir [binary_dir] [EXCLUDE_FROM_ALL] [SYSTEM])</span><br></pre></table></figure> <p><strong>æ·»åŠ ä¸€ä¸ªå­ç›®å½•å¹¶æ„å»ºè¯¥å­ç›®å½•</strong>ã€‚source_diræŒ‡å®šæºCMakeLists.txtå’Œä»£ç æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•ã€‚</p> <p>ä¸€èˆ¬ç”¨åœ¨åµŒå¥—çš„é¡¹ç›®ä¸­,é¡¶å±‚CMakeLists.txtæ–‡ä»¶æ·»åŠ å­ç›®å½•,è®©å­ç›®å½•å…ˆæ„å»ºå®Œæˆä¹‹åæ·»åŠ å…¶ä¸­ç”Ÿæˆçš„åº“å’Œå¤´æ–‡ä»¶.</p> <h2 id=è·å–æ–‡ä»¶><a class=headerlink href=#è·å–æ–‡ä»¶ title=è·å–æ–‡ä»¶></a>è·å–æ–‡ä»¶</h2><figure class="highlight cmake"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line><span class=keyword>FILE</span> (GLOB ALL_SOURCES <span class=string>"*.cpp"</span> <span class=string>"*.c"</span> <span class=string>"./AFolder/*.cpp"</span> )</span><br></pre></table></figure> <p>ä½¿ç”¨æ­£åˆ™åŒ¹é…å“åº”æ–‡ä»¶å¹¶å­˜åˆ°ä¸€ä¸ªå˜é‡ä¸­</p> <figure class="highlight cmake"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line><span class=keyword>aux_source_directory</span>(dir VAR) </span><br></pre></table></figure> <p>å‘ç°ä¸€ä¸ªç›®å½•ä¸‹æ‰€æœ‰çš„<strong>æºä»£ç æ–‡ä»¶</strong>å¹¶å°†åˆ—è¡¨å­˜å‚¨åœ¨ä¸€ä¸ªå˜é‡ä¸­.</p> <h2 id=vsä¸­æ˜¾ç¤ºå¤´æ–‡ä»¶><a class=headerlink href=#vsä¸­æ˜¾ç¤ºå¤´æ–‡ä»¶ title=vsä¸­æ˜¾ç¤ºå¤´æ–‡ä»¶></a>vsä¸­æ˜¾ç¤ºå¤´æ–‡ä»¶</h2><figure class="highlight cmake"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br></pre><td class=code><pre><span class=line><span class=keyword>file</span>(GLOB_RECURSE pipe_header_files  <span class=variable>${CMAKE_CURRENT_SOURCE_DIR}</span>/<span class=keyword>include</span>/*.h )</span><br><span class=line><span class=keyword>source_group</span>(<span class=string>"Header Files"</span> FILES <span class=variable>${pipe_header_files}</span>) </span><br></pre></table></figure> <p>ä½¿ç”¨source_groupå¢åŠ æ–‡ä»¶</p> <p>å¹¶æ·»åŠ åˆ°ç”Ÿæˆç›®æ ‡ä¸­</p> <figure class="highlight cmake"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line><span class=keyword>add_library</span>( lib_pipe_shared SHARED <span class=variable>${pipe_src}</span> <span class=variable>${pipe_header_files}</span>)</span><br></pre></table></figure> <h2 id=optionä¸add-definitions><a class=headerlink href=#optionä¸add-definitions title=optionä¸add_definitions></a>optionä¸add_definitions</h2><figure class="highlight cmake"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line><span class=keyword>option</span>(&LTvariable> <span class=string>"&LThelp_text>"</span> [value])</span><br></pre></table></figure> <p>å¯ä»¥åœ¨cmakeå‘½ä»¤ä¸­æŒ‡å®šè¯¥å€¼.</p> <p>è€Œadd_definitionç”¨äºæŒ‡å®šç¼–è¯‘å™¨å‚æ•°ï¼Œæ¯”å¦‚<code>add_definitions("-Wall -g")</code>,æ­¤å¤–æ›´æ¨èä½¿ç”¨add_compile_definitionså°†é¢„å¤„ç†å™¨å®šä¹‰æ·»åŠ åˆ°ç¼–è¯‘å™¨å‘½ä»¤è¡Œ,ä½¿ç”¨add_compile_optionså‘½ä»¤æ·»åŠ å…¶å®ƒé€‰é¡¹ã€‚</p> <p>æ¯”å¦‚ä¸‹é¢æ–‡ä»¶,ä½¿ç”¨add_definitionå®šä¹‰äº†TEST_DEBUG,optionå®šä¹‰ä¸ºOFFå¹¶åœ¨cmakeæ‰§è¡Œæ—¶æŒ‡å®šä¸ºon,ç„¶ååœ¨cmakeæ–‡ä»¶ä¸­æŒ‡å®šoptionä¸ºon,è¿™æ ·å°±æ‰§è¡Œäº†<code>add_definitions(-DTEST_DEBUG)</code>,å®šä¹‰äº†è¯¥å®.</p> <figure class="highlight bash"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br></pre><td class=code><pre><span class=line><span class=meta>#!/bin/sh</span></span><br><span class=line></span><br><span class=line>cmake -DTEST_DEBUG=ON .</span><br><span class=line>cmake --build .</span><br><span class=line></span><br></pre></table></figure> <figure class="highlight cmake"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br></pre><td class=code><pre><span class=line><span class=keyword>project</span>(<span class=keyword>test</span>)</span><br><span class=line></span><br><span class=line><span class=keyword>option</span>(TEST_DEBUG <span class=string>"option for debug"</span> <span class=keyword>OFF</span>)</span><br><span class=line><span class=keyword>if</span> (TEST_DEBUG)</span><br><span class=line><span class=keyword>add_definitions</span>(-DTEST_DEBUG)</span><br><span class=line><span class=keyword>endif</span>()</span><br></pre></table></figure> <figure class="highlight c"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br></pre><td class=code><pre><span class=line><span class=meta>#<span class=meta-keyword>include</span> <span class=meta-string>"test.h"</span></span></span><br><span class=line></span><br><span class=line><span class=meta>#<span class=meta-keyword>ifdef</span> TEST_DEBUG</span></span><br><span class=line>...</span><br><span class=line><span class=meta>#<span class=meta-keyword>endif</span></span></span><br></pre></table></figure> <p>CMakeä¸­çš„å‘½ä»¤ç‰¹åˆ«å¤š,äº‹å®ä¸Šå¹¶ä¸éœ€è¦å»ä¸€ä¸ªä¸€ä¸ªè®°ä½,é€šå¸¸åªè¦çŸ¥é“ä¸€ä¸ªé¡¹ç›®çš„å¤§è‡´æ„å»ºæµç¨‹ä»¥åŠå¯èƒ½éœ€è¦çš„å‘½ä»¤å°±è¡Œäº†.</p> <figure class="highlight cmake"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br></pre><td class=code><pre><span class=line><span class=keyword>target_compile_definitions</span>(foo PUBLIC FOO)</span><br><span class=line><span class=keyword>target_compile_definitions</span>(foo PUBLIC -DFOO)  <span class=comment># -D removed</span></span><br><span class=line><span class=keyword>target_compile_definitions</span>(foo PUBLIC <span class=string>""</span> FOO) <span class=comment># "" ignored</span></span><br><span class=line><span class=keyword>target_compile_definitions</span>(foo PUBLIC -D FOO) <span class=comment># -D becomes "", then ignored</span></span><br></pre></table></figure> <h3 id=ç”Ÿæˆå™¨è¡¨ç¤º><a class=headerlink href=#ç”Ÿæˆå™¨è¡¨ç¤º title=ç”Ÿæˆå™¨è¡¨ç¤º></a>ç”Ÿæˆå™¨è¡¨ç¤º</h3><p>ç”Ÿæˆå™¨è¡¨è¾¾å¼æ˜¯åœ¨æ„å»ºçš„é…ç½®é˜¶æ®µè¿›è¡Œçš„è¯­å¥ã€‚<strong>å¤§å¤šæ•°å‡½æ•°å…è®¸ä½¿ç”¨ç”Ÿæˆå™¨è¡¨è¾¾å¼ï¼Œåªæœ‰å°‘æ•°ä¾‹å¤–ã€‚ä»¥ $ çš„å½¢å¼ä½¿ç”¨ï¼Œå…¶ä¸­ OPERATOR æˆ–ç›´æ¥ä½¿ç”¨ï¼Œæˆ–ä¸ VALUE è¿›è¡Œæ¯” è¾ƒã€‚</strong></p> <figure class="highlight cmake"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br></pre><td class=code><pre><span class=line><span class=keyword>target_compile_options</span>(my_target PRIVATE</span><br><span class=line><span class=string>"$<$&LTCXX_COMPILER_ID:GNU,Clang,AppleClang>:-Wall>"</span>)</span><br><span class=line></span><br></pre></table></figure> <p>è‹¥ CXX_COMPILER_ID å˜é‡åŒ¹é… GNU, Clang, AppleClang åˆ—è¡¨ä¸­ä»»æ„ä¸€ä¸ªï¼Œåˆ™é™„åŠ -Wall é€‰ é¡¹åˆ°ç›®æ ‡â€”â€”ä¹Ÿå°±æ˜¯ my_targetã€‚ç”Ÿæˆå™¨è¡¨è¾¾å¼åœ¨ç¼–å†™ç‹¬ç«‹äºå¹³å°å’Œç¼–è¯‘å™¨çš„ CMake æ–‡ä»¶æ—¶éå¸¸æ–¹ä¾¿ã€‚</p> <p>é™¤äº†æŸ¥è¯¢å€¼ï¼Œç”Ÿæˆå™¨è¡¨è¾¾å¼è¿˜å¯ä»¥ç”¨äºè½¬æ¢å­—ç¬¦ä¸²å’Œåˆ—è¡¨:</p> <figure class="highlight cmake"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line>$&LTLOWER_CASE:CMake></span><br></pre></table></figure> <p>è¿™å°†è¾“å‡ºâ€œcmakeâ€ã€‚</p> <h2 id=Advanced-cmake><a title="Advanced cmake" class=headerlink href=#Advanced-cmake></a>Advanced cmake</h2><p>cmakeåœ¨c++ä¸­ç”¨çš„å¤ªå¤šäº†,</p> <p>æœ€è¿‘åœ¨çœ‹åˆ«äººé¡¹ç›®çš„æ—¶å€™çœ‹è§äº†ä¸€äº›æ¯”è¾ƒé«˜çº§çš„cmakeä½¿ç”¨æ–¹æ³•.</p> <p><strong>macro</strong></p> <p>å®šä¹‰ä¸€ä¸ªåä¸º \<name> çš„å®ï¼Œè¯¥å®æ¥æ”¶åä¸º \<arg1>, â€¦ çš„å‚æ•°ã€‚ <p>CMake å®ä½¿ç”¨ macro()/endmacro() å®šä¹‰ï¼Œæœ‰ç‚¹åƒå‡½æ•°functionã€‚ä¸åŒçš„æ˜¯ï¼Œå‡½æ•°å‚æ•°æ˜¯çœŸå˜é‡ï¼Œè€Œ åœ¨å®ä¸­æ˜¯å­—ç¬¦ä¸²æ›¿æ¢ã€‚è¿™æ„å‘³ç€å¿…é¡»ä½¿ç”¨å¤§æ‹¬å·è®¿é—®å®çš„æ‰€æœ‰å‚æ•°ã€‚ å¦ä¸€ä¸ªåŒºåˆ«æ˜¯ï¼Œé€šè¿‡è°ƒç”¨å‡½æ•°ï¼Œä½œç”¨åŒºåŸŸè½¬ç§»åˆ°å‡½æ•°å†…éƒ¨ã€‚æ‰§è¡Œå®æ—¶ï¼Œå°±å¥½åƒå®çš„ä¸»ä½“ç²˜è´´åˆ° è°ƒç”¨ä½ç½®ä¸€æ ·ï¼Œå®ä¸ä¼šåˆ›å»ºå˜é‡å’Œæ§åˆ¶æµçš„ä½œç”¨åŸŸã€‚å› æ­¤ï¼Œé¿å…åœ¨å®ä¸­è°ƒç”¨ return()ã€‚</p> <p><strong>function</strong></p> <p>å‡½æ•°ç”± function()/endfunction() å®šä¹‰ã€‚å‡½æ•°ä¸ºå˜é‡åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ä½œç”¨åŸŸï¼Œå› æ­¤æ‰€æœ‰ åœ¨å†…éƒ¨å®šä¹‰çš„å˜é‡éƒ½ä¸èƒ½ä»å¤–éƒ¨è®¿é—®ï¼Œé™¤éå°† PARENT_SCOPE é€‰é¡¹ä¼ é€’ç»™ set()ã€‚ å‡½æ•°ä¸åŒºåˆ†å¤§å°å†™ï¼Œé€šè¿‡ function åçš„åç§°åŠ ä¸Šåœ†æ‹¬å·æ¥ä½¿ç”¨å‡½æ•°</p> <h4 id=Effective-CMake><a title="Effective CMake" class=headerlink href=#Effective-CMake></a>Effective CMake</h4><ul><li><a href=https://gist.github.com/mbinna/c61dbb39bca0e4fb7d1f73b0d66a4fd1 rel=noopener target=_blank>Effective Modern CMake (github.com)</a><li><a href=https://github.com/xiaoweiChen/CMake-Best-Practices rel=noopener target=_blank>xiaoweiChen/CMake-Best-Practices: ã€ŠCMake Best Practicesã€‹çš„éä¸“ä¸šä¸ªäººç¿»è¯‘ (github.com)</a><li><a href=https://llvm.org/docs/CMakePrimer.html rel=noopener target=_blank>CMake Primer â€” LLVM 19.0.0git documentation</a></ul> <h5 id=é€šç”¨><a class=headerlink href=#é€šç”¨ title=é€šç”¨></a>é€šç”¨</h5><p>ä½¿ç”¨CMakeç‰ˆæœ¬å¤§äº3.0.0</p> <p>å°†CMakeè§†ä¸ºä»£ç ,åƒå¯¹å¾…ä»»ä½•å…¶ä»–ç¼–ç¨‹è¯­è¨€ä¸€æ ·ï¼Œä¿æŒCMakeLists.txtå’Œæ¨¡å—çš„ä»£ç æ¸…æ™°ã€ç»“æ„è‰¯å¥½ã€‚</p> <p>å…¨å±€å®šä¹‰é¡¹ç›®å±æ€§,åœ¨é¡¶å±‚CMakeLists.txtæ–‡ä»¶ä¸­å®šä¹‰å¦‚<strong>ç¼–è¯‘å™¨è­¦å‘Šã€ä»£ç æ ‡å‡†ç­‰å…¨å±€é¡¹ç›®å±æ€§</strong>ï¼Œç¡®ä¿æ‰€æœ‰ç›®æ ‡ä½¿ç”¨ç›¸åŒçš„æ ‡å‡†ï¼Œé¿å…å› ä¾èµ–ç›®æ ‡é—´çš„ç¼–è¯‘é€‰é¡¹ä¸ä¸€è‡´å¯¼è‡´çš„é—®é¢˜</p> <blockquote><p>ä¾‹å¦‚ï¼Œä¸€ä¸ªé¡¹ç›®å¯èƒ½ä¼šä½¿ç”¨ä¸€ç»„é€šç”¨çš„ç¼–è¯‘å™¨è­¦å‘Šã€‚ åœ¨é¡¶å±‚ CMakeLists.txt æ–‡ä»¶ä¸­å…¨å±€å®šä¹‰æ­¤ç±»å±æ€§ï¼Œå¯é¿å…å› ä¾èµ–ç›®æ ‡ä½¿ç”¨æ›´ä¸¥æ ¼çš„ç¼–è¯‘å™¨é€‰é¡¹è€Œå¯¼è‡´ä¾èµ–ç›®æ ‡çš„å…¬å…±å¤´æ–‡ä»¶æ— æ³•ç¼–è¯‘çš„æƒ…å†µã€‚ å…¨å±€å®šä¹‰æ­¤ç±»é¡¹ç›®å±æ€§å¯ä»¥æ›´æ–¹ä¾¿åœ°ç®¡ç†é¡¹ç›®åŠå…¶æ‰€æœ‰ç›®æ ‡ã€‚</blockquote> <p>ç›´æ¥æ“ä½œç›®æ ‡(targets),ä¸è¦ä½¿ç”¨<code>add_compile_options</code>, <code>include_directories</code>, <code>link_directories</code>, <code>link_libraries</code>ç­‰å‘½ä»¤ï¼Œå› ä¸ºå®ƒä»¬ä½œç”¨äºç›®å½•çº§åˆ«ï¼Œå¯èƒ½å¼•å…¥éšå«çš„ä¾èµ–å…³ç³»ã€‚ç›¸åï¼Œç›´æ¥å¯¹ç‰¹å®šçš„ç›®æ ‡ä½¿ç”¨<code>target_compile_options</code>, <code>target_include_directories</code>, <code>target_link_directories</code>, <code>target_link_libraries</code>ç­‰å‘½ä»¤ã€‚</p> <p>ä¸è¦ç›´æ¥æ“ä½œCMAKE_CXX_FLAGS,ä¸åŒçš„ç¼–è¯‘å™¨æœ‰ä¸åŒçš„å‘½ä»¤è¡Œå‚æ•°æ ¼å¼ã€‚é€šè¿‡CMAKE_CXX_FLAGSè®¾ç½®C++æ ‡å‡†ï¼ˆå¦‚<code>-std=c++14</code>ï¼‰å¯èƒ½ä¼šåœ¨æœªæ¥ç‰ˆæœ¬çš„ç¼–è¯‘å™¨ä¸Šå¤±æ•ˆï¼Œå› ä¸ºè¿™äº›è¦æ±‚ä¹Ÿå¯èƒ½åœ¨å…¶ä»–æ ‡å‡†ï¼ˆå¦‚C++17ï¼‰ä¸­æ»¡è¶³ï¼Œè€Œä¸”è€ç¼–è¯‘å™¨çš„é€‰é¡¹å¯èƒ½ä¸åŒã€‚å› æ­¤ï¼Œ<strong>åº”è¯¥å‘Šè¯‰CMakeæ‰€éœ€çš„ç¼–è¯‘ç‰¹æ€§ï¼Œè®©CMakeæ ¹æ®å…·ä½“æƒ…å†µé€‰æ‹©é€‚å½“çš„ç¼–è¯‘å™¨é€‰é¡¹ã€‚</strong></p> <p>åˆç†ä½¿ç”¨usage requirements,ä¾‹å¦‚,ä¸è¦å°†<code>-Wall</code>ï¼ˆå¼€å¯æ‰€æœ‰è­¦å‘Šï¼‰æ·»åŠ åˆ°ç›®æ ‡çš„PUBLICæˆ–INTERFACEæ®µçš„<code>target_compile_options</code>ä¸­ï¼Œå› ä¸ºè¿™ä¸æ˜¯æ„å»ºä¾èµ–ç›®æ ‡æ‰€å¿…éœ€çš„,è¿™æ ·åšå¯èƒ½å¯¼è‡´ä¸å¿…è¦çš„è­¦å‘Šä¿¡æ¯ã€‚</p> <h5 id=æ¨¡å—Modules><a class=headerlink href=#æ¨¡å—Modules title=æ¨¡å—Modules></a>æ¨¡å—Modules</h5><p>ä½¿ç”¨å£°æ˜å¯¼å‡ºç›®æ ‡çš„ç°ä»£æŸ¥æ‰¾æ¨¡å—ã€‚</p> <p>ä» CMake 3.4 å¼€å§‹ï¼Œè¶Šæ¥è¶Šå¤šçš„æŸ¥æ‰¾æ¨¡å—å¯¼å‡ºäº†å¯é€šè¿‡ target_link_libraries ä½¿ç”¨çš„ç›®æ ‡ã€‚</p> <p>ä½¿ç”¨å¤–éƒ¨è½¯ä»¶åŒ…çš„å¯¼å‡ºç›®æ ‡ã€‚ ä¸è¦é‡è¹ˆ CMake ä½¿ç”¨å¤–éƒ¨è½¯ä»¶åŒ…å®šä¹‰çš„å˜é‡çš„è¦†è¾™ã€‚ è€Œåº”é€šè¿‡ target_link_libraries ä½¿ç”¨å¯¼å‡ºçš„ç›®æ ‡ã€‚</p> <p>å¯¹äºä¸æ”¯æŒå®¢æˆ·ç«¯ä½¿ç”¨ CMake çš„ç¬¬ä¸‰æ–¹åº“ï¼Œè¯·ä½¿ç”¨æŸ¥æ‰¾æ¨¡å—ã€‚ CMake ä¸ºç¬¬ä¸‰æ–¹åº“æä¾›äº†ä¸€ç³»åˆ—æŸ¥æ‰¾æ¨¡å—ã€‚</p> <p>ä¾‹å¦‚ï¼ŒBoost ä¸æ”¯æŒ CMakeã€‚ ç›¸åï¼ŒCMake æä¾›äº†ä¸€ä¸ªæŸ¥æ‰¾æ¨¡å—ï¼Œä»¥ä¾¿åœ¨ CMake ä¸­ä½¿ç”¨ Boostã€‚</p> <p>å¦‚æœæŸä¸ªåº“ä¸æ”¯æŒå®¢æˆ·ç«¯ä½¿ç”¨ CMakeï¼Œè¯·å°†å…¶ä½œä¸º bug æŠ¥å‘Šç»™ç¬¬ä¸‰æ–¹åº“ä½œè€…ã€‚ å¦‚æœè¯¥åº“æ˜¯ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œè¯·è€ƒè™‘å‘é€è¡¥ä¸ã€‚ CMake åœ¨ä¸šç•Œå ä¸»å¯¼åœ°ä½ã€‚ å¦‚æœåº“ä½œè€…ä¸æ”¯æŒ CMakeï¼Œé‚£å°±éº»çƒ¦äº†ã€‚</p> <p>ä¸ºä¸æ”¯æŒå®¢æˆ·ç«¯ä½¿ç”¨ CMake çš„ç¬¬ä¸‰æ–¹åº“ç¼–å†™æŸ¥æ‰¾æ¨¡å—ã€‚ å¯ä»¥æ”¹é€ æŸ¥æ‰¾æ¨¡å—ï¼Œå°†ç›®æ ‡æ­£ç¡®å¯¼å‡ºåˆ°ä¸æ”¯æŒ CMake çš„å¤–éƒ¨è½¯ä»¶åŒ…ã€‚</p> <p>å¦‚æœæ‚¨æ˜¯åº“ä½œè€…ï¼Œè¯·å¯¼å‡ºåº“çš„INTERFACE</p> <h5 id=é¡¹ç›®Projects><a class=headerlink href=#é¡¹ç›®Projects title=é¡¹ç›®Projects></a>é¡¹ç›®Projects</h5><ul><li><p>é¿å…åœ¨é¡¹ç›®å‘½ä»¤å‚æ•°ä¸­ä½¿ç”¨è‡ªå®šä¹‰å˜é‡ã€‚ ä¿æŒç®€å•ã€‚ ä¸è¦å¼•å…¥ä¸å¿…è¦çš„è‡ªå®šä¹‰å˜é‡ã€‚ ä¸è¦ä½¿ç”¨ add_library(a ${MY_HEADERS} ${MY_SOURCES})ï¼Œè€Œåº”ä½¿ç”¨ add_library(a b.h b.cpp)ã€‚</p><li><p>ä¸è¦åœ¨é¡¹ç›®ä¸­ä½¿ç”¨ file(GLOB),CMake æ˜¯ä¸€ä¸ªç¼–è¯‘ç³»ç»Ÿç”Ÿæˆå™¨ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªç¼–è¯‘ç³»ç»Ÿã€‚ åœ¨ç”Ÿæˆæ„å»ºç³»ç»Ÿæ—¶ï¼Œå®ƒä¼šå°† GLOB è¡¨è¾¾å¼æ±‚å€¼ä¸ºä¸€ä¸ªæ–‡ä»¶åˆ—è¡¨ã€‚ ç„¶åï¼Œè”ç¼–ç³»ç»Ÿä¼šå¯¹è¯¥æ–‡ä»¶åˆ—è¡¨è¿›è¡Œæ“ä½œã€‚ CMake æ— æ³•å°† GLOB è¡¨è¾¾å¼è½¬å‘ç»™è”ç¼–ç³»ç»Ÿï¼Œä»¥ä¾¿åœ¨è”ç¼–æ—¶å¯¹è¡¨è¾¾å¼è¿›è¡Œè¯„ä¼°ã€‚ CMake å¸Œæœ›æˆä¸ºæ‰€æ”¯æŒçš„è”ç¼–ç³»ç»Ÿçš„å…¬åˆ†æ¯ã€‚ å¹¶éæ‰€æœ‰çš„æ„å»ºç³»ç»Ÿéƒ½æ”¯æŒè¿™ä¸€ç‚¹ï¼Œå› æ­¤ CMake ä¹Ÿæ— æ³•æ”¯æŒã€‚</p><li>å°†ç‰¹å®šäº CI çš„è®¾ç½®æ”¾åœ¨ CTest è„šæœ¬ä¸­ï¼Œè€Œä¸æ˜¯é¡¹ç›®ä¸­ï¼Œè¿™æ ·ä¼šè®©äº‹æƒ…æ›´ç®€å•ã€‚<li>æµ‹è¯•åç§°åº”éµå¾ªå‘½åçº¦å®šã€‚ è¿™æ ·å¯ä»¥ç®€åŒ–é€šè¿‡ CTest è¿è¡Œæµ‹è¯•æ—¶çš„ regex è¿‡æ»¤ã€‚</ul> <h5 id=ç›®æ ‡-Targets-åŠå…¶å±æ€§-Properties><a class=headerlink href=#ç›®æ ‡-Targets-åŠå…¶å±æ€§-Properties title=ç›®æ ‡(Targets)åŠå…¶å±æ€§(Properties)></a>ç›®æ ‡(Targets)åŠå…¶å±æ€§(Properties)</h5><p><strong>ä»ç›®æ ‡å’Œå±æ€§çš„è§’åº¦æ€è€ƒ</strong></p> <p>é€šè¿‡ä»ç›®æ ‡çš„è§’åº¦å®šä¹‰å±æ€§ï¼ˆå³ç¼–è¯‘å®šä¹‰ã€ç¼–è¯‘é€‰é¡¹ã€ç¼–è¯‘ç‰¹æ€§ã€åŒ…å«ç›®å½•å’Œåº“ä¾èµ–å…³ç³»,compile definitions, compile options, compile features, include directories, and library dependenciesï¼‰ï¼Œå¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜åœ¨ç›®æ ‡çº§åˆ«å¯¹ç³»ç»Ÿè¿›è¡Œæ¨ç†ã€‚ å¼€å‘äººå‘˜ä¸éœ€è¦äº†è§£æ•´ä¸ªç³»ç»Ÿï¼Œå°±èƒ½å¯¹å•ä¸ªç›®æ ‡è¿›è¡Œæ¨ç†ã€‚ æ„å»ºç³»ç»Ÿå¯å¤„ç†åå‘æ€§ã€‚</p> <p><strong>å°†ç›®æ ‡æƒ³è±¡æˆå¯¹è±¡</strong></p> <p>è°ƒç”¨æˆå‘˜å‡½æ•°ä¼šä¿®æ”¹å¯¹è±¡çš„æˆå‘˜å˜é‡ã€‚</p> <p>ä¸æ„é€ å‡½æ•°ç±»æ¯”ï¼šadd_executable add_library</p> <p>ä¸æˆå‘˜å˜é‡ç±»æ¯”ï¼štarget propertiesï¼ˆå¤ªå¤šï¼Œè¿™é‡Œä¸ä¸€ä¸€åˆ—ä¸¾ï¼‰</p> <p>ä¸æˆå‘˜å‡½æ•°ç±»æ¯”ï¼štarget_compile_definitions target_compile_features target_compile_options target_include_directories target_link_libraries target_sources get_target_property set_target_property</p> <p>å¦‚æœç›®æ ‡éœ€è¦å†…éƒ¨å±æ€§ï¼ˆå¦‚ç¼–è¯‘å®šä¹‰ã€ç¼–è¯‘é€‰é¡¹ã€ç¼–è¯‘ç‰¹æ€§ã€åŒ…å«ç›®å½•å’Œåº“ä¾èµ–å…³ç³»ï¼‰ï¼Œè¯·å°†å®ƒä»¬æ·»åŠ åˆ° target_* å‘½ä»¤çš„ PRIVATE éƒ¨åˆ†ã€‚</p> <p><strong>ä½¿ç”¨ target_compile_definitions å£°æ˜ç¼–è¯‘å®šä¹‰</strong></p> <p>å¯å°†ç¼–è¯‘å®šä¹‰ä¸ç›®æ ‡çš„å¯è§æ€§ï¼ˆPRIVATEã€PUBLICã€INTERFACEï¼‰å…³è”èµ·æ¥ã€‚ è¿™æ¯”ä½¿ç”¨ add_compile_definitions æ›´å¥½ï¼Œå› ä¸º add_compile_definitions ä¸ç›®æ ‡æ²¡æœ‰å…³è”ã€‚</p> <p><strong>ä½¿ç”¨ target_compile_options å£°æ˜ç¼–è¯‘é€‰é¡¹</strong></p> <p>è¿™ä¸ç¼–è¯‘é€‰é¡¹ä¸ç›®æ ‡çš„å¯è§æ€§ï¼ˆPRIVATEã€PUBLICã€INTERFACEï¼‰ç›¸å…³è”ã€‚ è¿™æ¯”ä½¿ç”¨ add_compile_options è¦å¥½ï¼Œå› ä¸º add_compile_options ä¸ç›®æ ‡æ²¡æœ‰å…³è”ã€‚</p> <p>ä½†è¦æ³¨æ„ä¸è¦å£°æ˜ä¼šå½±å“ ABI çš„ç¼–è¯‘é€‰é¡¹ã€‚ è¯·å…¨å±€å£°æ˜è¿™äº›é€‰é¡¹ã€‚</p> <p>target_compile_featuresåŒ</p> <p><strong>ä½¿ç”¨ target_include_directories å£°æ˜ include ç›®å½•</strong></p> <p>è¿™å°† include ç›®å½•ä¸ç›®æ ‡çš„å¯è§æ€§ï¼ˆPRIVATEã€PUBLICã€INTERFACEï¼‰ç›¸å…³è”ã€‚ è¿™æ¯”ä½¿ç”¨ include_directories æ›´å¥½ï¼Œå› ä¸º include_directories ä¸ç›®æ ‡æ²¡æœ‰å…³è”ã€‚</p> <p><strong>ä½¿ç”¨ target_link_libraries å£°æ˜ç›´æ¥ä¾èµ–å…³ç³»</strong>ï¼Œè¿™å°†æŠŠä½¿ç”¨è¦æ±‚ä»ä¾èµ–ç›®æ ‡ä¼ æ’­åˆ°è¢«ä¾èµ–ç›®æ ‡ã€‚ è¯¥å‘½ä»¤è¿˜èƒ½è§£å†³ä¼ é€’ä¾èµ–å…³ç³»ã€‚</p> <p><strong>ä¸è¦åœ¨ç»„ä»¶ç›®å½•ä¹‹å¤–çš„è·¯å¾„ä¸‹ä½¿ç”¨ target_include_directories</strong></p> <p>åœ¨ç»„ä»¶ç›®å½•ä¹‹å¤–ä½¿ç”¨è·¯å¾„æ˜¯ä¸€ç§éšè—çš„ä¾èµ–å…³ç³»ã€‚ ç›¸åï¼Œåº”ä½¿ç”¨ target_include_directories é€šè¿‡ target_link_directories å°†åŒ…å«ç›®å½•ä½œä¸ºä½¿ç”¨è¦æ±‚ä¼ æ’­ç»™ä¾èµ–ç›®æ ‡ã€‚</p> <p>ä½¿ç”¨ target_* æ—¶ï¼Œå§‹ç»ˆæ˜ç¡®å£°æ˜å±æ€§ PUBLICã€PRIVATE æˆ– INTERFACEã€‚ æ˜ç¡®å£°æ˜å¯å‡å°‘æ— æ„ä¸­å¼•å…¥éšè—ä¾èµ–å…³ç³»çš„æœºä¼šã€‚</p> <p>ä¸è¦ä½¿ç”¨ target_compile_options è®¾ç½®ä¼šå½±å“ ABI çš„é€‰é¡¹ã€‚ å¯¹å¤šä¸ªç›®æ ‡ä½¿ç”¨ä¸åŒçš„ç¼–è¯‘é€‰é¡¹å¯èƒ½ä¼šå½±å“ ABI å…¼å®¹æ€§ã€‚ é˜²æ­¢æ­¤ç±»é—®é¢˜çš„æœ€ç®€å•è§£å†³æ–¹æ¡ˆæ˜¯å…¨å±€å®šä¹‰ç¼–è¯‘é€‰é¡¹ã€‚</p> <p>ä½¿ç”¨åœ¨åŒä¸€ CMake æ ‘ä¸­å®šä¹‰çš„åº“åº”ä¸ä½¿ç”¨å¤–éƒ¨åº“ç›¸åŒã€‚ åœ¨åŒä¸€ CMake æ ‘ä¸­å®šä¹‰çš„è½¯ä»¶åŒ…å¯ç›´æ¥è®¿é—®ã€‚ é€šè¿‡ CMAKE_PREFIX_PATH è·å–é¢„ç¼–è¯‘åº“ã€‚ å¦‚æœè½¯ä»¶åŒ…å®šä¹‰åœ¨åŒä¸€ä¸ªç¼–è¯‘æ ‘ä¸­ï¼Œé‚£ä¹ˆä½¿ç”¨ find_package æŸ¥æ‰¾è¯¥è½¯ä»¶åŒ…å°±ä¸ä¼šæœ‰ä»»ä½•é—®é¢˜ã€‚ åœ¨å°†ç›®æ ‡ Bar å¯¼å‡ºåˆ°å‘½åç©ºé—´ Foo æ—¶ï¼Œè¿˜å¯ä»¥é€šè¿‡ add_library(Foo::Bar ALIAS Bar) åˆ›å»ºåˆ«å Foo::Barã€‚ åˆ›å»ºä¸€ä¸ªå˜é‡ï¼Œåˆ—å‡ºæ‰€æœ‰å­é¡¹ç›®ã€‚ å®šä¹‰ find_package å®æ¥å°è£…åŸæ¥çš„ find_package å‘½ä»¤ï¼ˆç°åœ¨å¯é€šè¿‡ _find_package è®¿é—®ï¼‰ã€‚ å¦‚æœå˜é‡åŒ…å«è½¯ä»¶åŒ…çš„åç§°ï¼Œå®å°†ç¦æ­¢è°ƒç”¨ _find_packageã€‚</p> <h5 id=å‡½æ•°ä¸å®><a class=headerlink href=#å‡½æ•°ä¸å® title=å‡½æ•°ä¸å®></a>å‡½æ•°ä¸å®</h5><p>é™¤äº†åŸºäºç›®å½•çš„ä½œç”¨åŸŸå¤–ï¼ŒCMake å‡½æ•°ä¹Ÿæœ‰è‡ªå·±çš„ä½œç”¨åŸŸã€‚ è¿™æ„å‘³ç€åœ¨å‡½æ•°ä¸­è®¾ç½®çš„å˜é‡åœ¨çˆ¶ä½œç”¨åŸŸä¸­ä¸å¯è§ã€‚ å®åˆ™ä¸ç„¶ã€‚</p> <p>å®åªèƒ½ç”¨äºå®šä¹‰å¾ˆå°çš„åŠŸèƒ½ï¼Œæˆ–ç”¨äºå°è£…æœ‰è¾“å‡ºå‚æ•°çš„å‘½ä»¤ã€‚ å‡½æ•°æœ‰è‡ªå·±çš„ä½œç”¨åŸŸï¼Œå®æ²¡æœ‰ã€‚</p> <p>å®çš„å‚æ•°ä¸ä¼šè¢«è®¾ç½®ä¸ºå˜é‡ï¼Œè€Œæ˜¯åœ¨æ‰§è¡Œå®ä¹‹å‰åœ¨å®ä¸­è§£æå¯¹å‚æ•°çš„å¼•ç”¨ã€‚ è¿™å¯èƒ½ä¼šåœ¨ä½¿ç”¨æœªå¼•ç”¨å˜é‡æ—¶å¯¼è‡´æ„å¤–è¡Œä¸ºã€‚ ä¸€èˆ¬æ¥è¯´ï¼Œè¿™ä¸ªé—®é¢˜å¹¶ä¸å¸¸è§ï¼Œå› ä¸ºå®ƒéœ€è¦ä½¿ç”¨åç§°åœ¨çˆ¶ä½œç”¨åŸŸä¸­é‡å çš„éå‚å¼•å˜é‡ï¼Œä½†å¿…é¡»æ³¨æ„ï¼Œå› ä¸ºå®ƒå¯èƒ½å¯¼è‡´å¾®å¦™çš„é”™è¯¯ã€‚</p> <p>ä¸è¦ä½¿ç”¨ä¼šå½±å“ç›®å½•æ ‘ä¸­æ‰€æœ‰ç›®æ ‡çš„å®ï¼Œå¦‚ include_directoriesã€add_definitions æˆ– link_librariesã€‚ è¿™äº›å®æ˜¯é‚ªæ¶çš„ã€‚ å¦‚æœåœ¨é¡¶å±‚ä½¿ç”¨å®ï¼Œæ‰€æœ‰ç›®æ ‡éƒ½å¯ä»¥ä½¿ç”¨å®å®šä¹‰çš„å±æ€§ã€‚ ä¾‹å¦‚ï¼Œæ‰€æœ‰ç›®æ ‡éƒ½å¯ä»¥ä½¿ç”¨ï¼ˆå³ #includeï¼‰include_directories æ‰€å®šä¹‰çš„å¤´æ–‡ä»¶ã€‚ å¦‚æœç›®æ ‡ä¸éœ€è¦é“¾æ¥ï¼ˆå¦‚æ¥å£åº“ã€å†…è”æ¨¡æ¿ï¼‰ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ç”šè‡³ä¸ä¼šå‡ºç°ç¼–è¯‘å™¨é”™è¯¯ã€‚ ä½¿ç”¨è¿™äº›å®å¾ˆå®¹æ˜“æ„å¤–åœ°é€šè¿‡å…¶ä»–ç›®æ ‡åˆ›å»ºéšè—çš„ä¾èµ–å…³ç³»ã€‚</p> <p><strong>å»ºè®®ä½¿ç”¨ cmake_parse_arguments æ¥å¤„ç†ä»»ä½•å‡½æ•°ä¸­åŸºäºå‚æ•°çš„å¤æ‚è¡Œä¸ºæˆ–å¯é€‰å‚æ•°ã€‚</strong></p> <h5 id=å¾ªç¯><a class=headerlink href=#å¾ªç¯ title=å¾ªç¯></a>å¾ªç¯</h5><ul><li><code>foreach(var IN ITEMS foo bar baz) ...</code><li><code>foreach(var IN LISTS my_list) ...</code><li><code>foreach(var IN LISTS my_list ITEMS foo bar baz) ...</code></ul> <h5 id=åŒ…><a class=headerlink href=#åŒ… title=åŒ…></a>åŒ…</h5><p>ä½¿ç”¨ CPack åˆ›å»ºè½¯ä»¶åŒ….</p> <p>CPack æ˜¯ CMake çš„ä¸€éƒ¨åˆ†,å¹¶ä¸ CMake å®Œç¾é›†æˆã€‚</p> <p>ç¼–å†™ CPackConfig.cmake,å…¶ä¸­åŒ…æ‹¬ CMake ç”Ÿæˆçš„ CPackConfig.cmake,è¿™æ ·å°±å¯ä»¥è®¾ç½®æ— éœ€å‡ºç°åœ¨é¡¹ç›®ä¸­çš„å…¶ä»–å˜é‡ã€‚</p> <h5 id=äº¤å‰ç¼–è¯‘><a class=headerlink href=#äº¤å‰ç¼–è¯‘ title=äº¤å‰ç¼–è¯‘></a>äº¤å‰ç¼–è¯‘</h5><p>ä½¿ç”¨å·¥å…·é“¾æ–‡ä»¶è¿›è¡Œäº¤å‰ç¼–è¯‘ã€‚å·¥å…·é“¾æ–‡ä»¶å°è£…äº†ç”¨äºäº¤å‰ç¼–è¯‘çš„å·¥å…·é“¾ã€‚</p> <p>ä¿æŒå·¥å…·é“¾æ–‡ä»¶çš„ç®€æ´ï¼Œè¿™æ ·æ›´æ˜“äºç†è§£å’Œä½¿ç”¨ã€‚ ä¸è¦åœ¨å·¥å…·é“¾æ–‡ä»¶ä¸­åŠ å…¥é€»è¾‘ã€‚ ä¸ºæ¯ä¸ªå¹³å°åˆ›å»ºä¸€ä¸ªå·¥å…·é“¾æ–‡ä»¶ã€‚</p> <h5 id=è­¦å‘Šä¸æŠ¥é”™><a class=headerlink href=#è­¦å‘Šä¸æŠ¥é”™ title=è­¦å‘Šä¸æŠ¥é”™></a>è­¦å‘Šä¸æŠ¥é”™</h5><p>æ­£ç¡®å¯¹å¾…æ„å»ºé”™è¯¯ã€ä¿®å¤é”™è¯¯ã€æ‹’ç»æ‹‰å–è¯·æ±‚ã€æš‚ç¼“å‘å¸ƒã€‚</p> <p><strong>å°†è­¦å‘Šè§†ä¸ºé”™è¯¯</strong></p> <p>è¦å°†è­¦å‘Šè§†ä¸ºé”™è¯¯ï¼Œåˆ‡å‹¿å‘ç¼–è¯‘å™¨ä¼ é€’ -Werrorã€‚ å¦‚æœè¿™æ ·åšï¼Œç¼–è¯‘å™¨å°±ä¼šå°†è­¦å‘Šè§†ä¸ºé”™è¯¯ã€‚</p> <ul><li>You cannot enable <code>-Werror</code> unless you already reached zero warnings.<li>You cannot increase the warning level unless you already fixed all warnings introduced by that level.<li>You cannot upgrade your compiler unless you already fixed all new warnings that the compiler reports at your warning level.<li>You cannot update your dependencies unless you already ported your code away from any symbols that are now <code>[[deprecated]]</code>.<li><p>You cannot <code>[[deprecated]]</code> your internal code as long as it is still used. But once it is no longer used, you can as well just remove it.</p> <p><strong>å°†æ–°çš„è­¦å‘Šè§†ä¸ºé”™è¯¯</strong></p></ul> <ol><li>At the beginning of a development cycle (e.g., sprint), allow new warnings to be introduced.<ul><li>Increase warning level, enable new warnings explicitly.<li>Update the compiler.<li>Update dependencies.<li>Mark symbols as <code>[[deprecated]]</code>.</ul><li>Burn down the number of warnings.<li>Repeat.</ol> <p>ä½¿ç”¨å¤šä¸ªæ”¯æŒçš„åˆ†æå™¨ï¼šclang-tidy (\<lang>_CLANG_TIDY)ã€cpplint (\<lang>_CPPLINT)ã€include-what-you-use (\<lang>_INCLUDE_WHAT_YOU_USE) å’Œ LINK_WHAT_YOU_USE å¯å¸®åŠ©æ‚¨å‘ç°ä»£ç ä¸­çš„é—®é¢˜ã€‚ è¿™äº›å·¥å…·çš„è¯Šæ–­è¾“å‡ºå°†æ˜¾ç¤ºåœ¨æ„å»ºè¾“å‡ºå’Œé›†æˆå¼€å‘ç¯å¢ƒä¸­ã€‚ <p>å¯¹äºæ¯ä¸ªå¤´æ–‡ä»¶ï¼Œéƒ½å¿…é¡»æœ‰ä¸€ä¸ªå…³è”çš„æºæ–‡ä»¶ï¼Œè¯¥æºæ–‡ä»¶ #includes å¤´æ–‡ä»¶åœ¨é¡¶éƒ¨ï¼Œå³ä½¿è¯¥æºæ–‡ä»¶æœ¬æ¥æ˜¯ç©ºçš„ã€‚ å¤§å¤šæ•°åˆ†æå·¥å…·éƒ½ä¼šæŠ¥å‘Šå½“å‰æºæ–‡ä»¶å’Œå…³è”å¤´æ–‡ä»¶çš„è¯Šæ–­ç»“æœã€‚ æ²¡æœ‰å…³è”æºæ–‡ä»¶çš„å¤´æ–‡ä»¶ä¸ä¼šè¢«åˆ†æã€‚ æ‚¨ä¹Ÿè®¸å¯ä»¥è®¾ç½®è‡ªå®šä¹‰å¤´æ–‡ä»¶è¿‡æ»¤å™¨ï¼Œä½†è¿™æ ·å¤´æ–‡ä»¶å¯èƒ½ä¼šè¢«åˆ†æå¤šæ¬¡ã€‚</p> <h2 id=å®æˆ˜><a class=headerlink href=#å®æˆ˜ title=å®æˆ˜></a>å®æˆ˜</h2><h3 id=é¡¹ç›®ç»“æ„><a class=headerlink href=#é¡¹ç›®ç»“æ„ title=é¡¹ç›®ç»“æ„></a>é¡¹ç›®ç»“æ„</h3><figure class="highlight reasonml"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br></pre><td class=code><pre><span class=line>â”œâ”€â”€ <span class=module-access><span class=module><span class=identifier>CMakeLists</span>.</span></span>txt</span><br><span class=line>â”œâ”€â”€ build</span><br><span class=line>â”œâ”€â”€ <span class=keyword>include</span>/project_name</span><br><span class=line>â””â”€â”€ src</span><br></pre></table></figure> <p>æœ€å°çš„é¡¹ç›®ç»“æ„ä¸­æœ‰ä¸‰ä¸ªæ–‡ä»¶å¤¹å’Œä¸€ä¸ªæ–‡ä»¶</p> <p>â€¢ build: æ”¾ç½®æ„å»ºæ–‡ä»¶å’ŒäºŒè¿›åˆ¶æ–‡ä»¶çš„æ–‡ä»¶å¤¹ã€‚</p> <p>â€¢ include/project_name: æ­¤ æ–‡ ä»¶ å¤¹ åŒ… å« ä» é¡¹ ç›® å¤– éƒ¨ å…¬ å¼€ è®¿ é—® çš„ æ‰€ æœ‰ å¤´ æ–‡ ä»¶ï¼Œ åŒ… å« ä½¿å®ƒæ›´å®¹æ˜“çœ‹å‡ºå¤´æ–‡ä»¶æ¥è‡ªå“ªä¸ªåº“ã€‚</p> <p>â€¢ src: æ­¤æ–‡ä»¶å¤¹åŒ…å«æ‰€æœ‰ç§æœ‰çš„æºæ–‡ä»¶å’Œå¤´æ–‡ä»¶</p> <p>â€¢ CMakeLists.txt: è¿™æ˜¯ä¸» CMake æ–‡ä»¶</p> <p>æ„å»ºæ–‡ä»¶å¤¹å¯ä»¥æ”¾ç½®åœ¨ä»»ä½•åœ°æ–¹ï¼Œæ”¾åœ¨é¡¹ç›®æ ¹ç›®å½•æœ€æ–¹ä¾¿ï¼Œä½†å¼ºçƒˆå»ºè®®ä¸è¦é€‰æ‹©ä»»ä½•éç©ºæ–‡ä»¶ å¤¹ä½œä¸ºæ„å»ºæ–‡ä»¶å¤¹ã€‚ç‰¹åˆ«æ˜¯å°†æ„å»ºå¥½çš„æ–‡ä»¶æ”¾å…¥ include æˆ– src ä¸­ï¼Œè¿™æ˜¯ä¸€ç§ç³Ÿç³•çš„å®è·µã€‚å…¶ä»–æ–‡ä»¶ å¤¹ï¼Œå¦‚ test æˆ– docï¼Œåœ¨ç»„ç»‡æµ‹è¯•é¡¹ç›®å’Œæ–‡æ¡£é¡µé¢æ—¶å°±å¾ˆæ–¹ä¾¿</p> <p><strong>åµŒå¥—é¡¹ç›®</strong></p> <figure class="highlight reasonml"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br></pre><td class=code><pre><span class=line>â”œâ”€â”€ <span class=module-access><span class=module><span class=identifier>CMakeLists</span>.</span></span>txt</span><br><span class=line>â”œâ”€â”€ build</span><br><span class=line>â”œâ”€â”€ <span class=keyword>include</span>/project_name</span><br><span class=line>â”œâ”€â”€ src</span><br><span class=line>â””â”€â”€ subproject</span><br><span class=line>â”œâ”€â”€ <span class=module-access><span class=module><span class=identifier>CMakeLists</span>.</span></span>txt</span><br><span class=line>â”œâ”€â”€ <span class=keyword>include</span></span><br><span class=line>â”‚ â””â”€â”€ subproject</span><br><span class=line>â””â”€â”€ src</span><br></pre></table></figure> <figure class="highlight cpp"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br></pre><td class=code><pre><span class=line><span class=built_in>cmake_minimum_required</span>(VERSION <span class=number>3.21</span>)</span><br><span class=line><span class=built_in>project</span>(</span><br><span class=line>hello_world_standalone</span><br><span class=line>VERSION <span class=number>1.0</span></span><br><span class=line>DESCRIPTION<span class=string>"A simple C++ project"</span></span><br><span class=line>HOMEPAGE_URL https:<span class=comment>//github.com/PacktPublishing/CMake-BestPractices</span></span><br><span class=line>LANGUAGES CXX</span><br><span class=line>)</span><br><span class=line><span class=built_in>add_executable</span>(hello_world)</span><br><span class=line><span class=built_in>target_sources</span>(hello_world PRIVATE src/main.cpp)</span><br><span class=line></span><br></pre></table></figure> <p>ç¬¬ä¸€è¡Œï¼Œcmake_minimum_required(VERSION 3.21)ï¼ŒæœŸæœ›çœ‹åˆ°çš„ CMake çš„ç‰ˆæœ¬ï¼Œä»¥åŠ CMake å°†å¯ç”¨å“ªäº›ç‰¹æ€§ã€‚æœ¬ä¹¦çš„ä¾‹å­ä¸­éƒ½ä½¿ç”¨ CMake 3.21ï¼Œä½†æ˜¯å‡ºäºå…¼å®¹æ€§çš„åŸå› ï¼Œè¯»è€…ä»¬å¯ä»¥é€‰ æ‹©ä¸€ä¸ªè¾ƒä½çš„ç‰ˆæœ¬ã€‚</p> <p>å¯¹äºæœ¬ä¾‹ï¼Œ3.1 ç‰ˆæœ¬å°†æ˜¯ç»å¯¹çš„æœ€å°å€¼ï¼Œå› ä¸ºåœ¨æ­¤ä¹‹å‰ï¼Œtarget_sources ä¸å¯ç”¨ã€‚å°† cmake_minimum_required æŒ‡ä»¤æ”¾åœ¨æ¯ä¸ª CMakeLists.txt æ–‡ä»¶çš„é¡¶éƒ¨æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„åšæ³•ã€‚</p> <p>æ¥ä¸‹æ¥ï¼Œä½¿ç”¨ project() æŒ‡ä»¤è®¾ç½®é¡¹ç›®ã€‚ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯é¡¹ç›®çš„åç§°â€”â€”æˆ‘ä»¬çš„ä¾‹å­ä¸­ä¸º â€œhello_world_standaloneâ€ã€‚ æ¥ä¸‹æ¥ï¼Œç‰ˆæœ¬è®¾ç½®ä¸º 1.0ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç®€çŸ­çš„æè¿°å’Œä¸»é¡µçš„ URLã€‚</p> <p>æœ€åï¼ŒLANGUAGES CXX å± æ€§æŒ‡å®šæ­£åœ¨æ„å»ºä¸€ä¸ª C++ é¡¹ç›®ã€‚é™¤äº†é¡¹ç›®åç§°ä¹‹å¤–ï¼Œæ‰€æœ‰å‚æ•°éƒ½å¯é€‰ã€‚ è°ƒç”¨ add_executable(hello_world) æŒ‡ä»¤ï¼Œä¼šåˆ›å»ºä¸€ä¸ªåä¸º hello_world çš„ç›®æ ‡ã€‚è¿™ä¹Ÿå°† æ˜¯å¯æ‰§è¡Œçš„æ–‡ä»¶åã€‚ ç°åœ¨å·²ç»åˆ›å»ºäº†ç›®æ ‡ï¼Œä½¿ç”¨ target_sources å®Œæˆäº†å‘ç›®æ ‡æ·»åŠ  C++ æºæ–‡ä»¶ã€‚Chapter3 æ˜¯ç›®æ ‡åï¼Œåœ¨ add_executable ä¸­æŒ‡å®šã€‚</p> <p>PRIVATE å®šä¹‰æºä»…ç”¨äºæ„å»ºæ­¤ç›®æ ‡ï¼Œè€Œä¸ç”¨äºä¾èµ–çš„ç›® æ ‡ã€‚åœ¨èŒƒå›´è¯´æ˜ç¬¦ä¹‹åï¼Œæœ‰ä¸€ä¸ªç›¸å¯¹äºå½“å‰ CMakeLists.txt æ–‡ä»¶è·¯å¾„çš„æºæ–‡ä»¶åˆ—è¡¨ã€‚å¦‚æœéœ€è¦ï¼Œå½“ å‰å¤„ç†çš„ CMakeLists txt æ–‡ä»¶çš„ä½ç½®å¯ä»¥é€šè¿‡ CMAKE_CURRENT_SOURCE_DIR å¾—åˆ°ã€‚</p> <p>æºç å¯ä»¥ç›´æ¥æ·»åŠ åˆ° add_executableï¼Œä¹Ÿå¯ä»¥å•ç‹¬ä½¿ç”¨ target_sourcesï¼Œå°†å®ƒä»¬ä¸ target_sources ä¸€èµ·æ·»åŠ ã€‚é€šè¿‡ä½¿ç”¨ PRIVATEã€PUBLIC æˆ– INTERFACEï¼Œå¯ä»¥æ˜¾å¼åœ°å®šä¹‰åœ¨ä½• å¤„ä½¿ç”¨æºç ã€‚ä½†æ˜¯ï¼Œ<strong>æŒ‡å®š PRIVATE ä»¥å¤–çš„å†…å®¹åªå¯¹åº“ç›®æ ‡æœ‰æ„ä¹‰</strong>ã€‚</p> <h3 id=åˆ›å»ºåº“><a class=headerlink href=#åˆ›å»ºåº“ title=åˆ›å»ºåº“></a>åˆ›å»ºåº“</h3><figure class="highlight cmake"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br></pre><td class=code><pre><span class=line><span class=keyword>cmake_minimum_required</span>(VERSION <span class=number>3.21</span>)</span><br><span class=line><span class=keyword>project</span>(</span><br><span class=line>ch3.hello_lib</span><br><span class=line>VERSION <span class=number>1.0</span></span><br><span class=line>DESCRIPTION</span><br><span class=line><span class=string>"A simple C++ project to demonstrate creating executables</span></span><br><span class=line><span class=string>and libraries in CMake"</span></span><br><span class=line>LANGUAGES CXX)</span><br><span class=line><span class=keyword>add_library</span>(hello)</span><br><span class=line><span class=keyword>target_sources</span>(</span><br><span class=line>hello</span><br><span class=line>PRIVATE src/hello.cpp src/internal.cpp)</span><br><span class=line><span class=keyword>target_compile_features</span>(hello PUBLIC cxx_std_17)</span><br><span class=line><span class=keyword>target_include_directories</span>(</span><br><span class=line>hello</span><br><span class=line>PRIVATE src/hello</span><br><span class=line>PUBLIC <span class=keyword>include</span>)</span><br></pre></table></figure> <p>æºæ–‡ä»¶ä½¿ç”¨ PRIVATE æ·»åŠ ï¼ŒPRIVATE å’Œ PUBLIC å…³é”®å­—æŒ‡å®šåœ¨ä½•å¤„ä½¿ç”¨æºä»£ç è¿›è¡Œç¼–è¯‘ã€‚PRIVATE æŒ‡å®šçš„æºæ–‡ä»¶å°†åªåœ¨ç›®æ ‡ hello ä¸­ä½¿ç”¨</p> <p>è‹¥ä½¿ç”¨ PUBLICï¼Œé‚£ä¹ˆæºæ–‡ä»¶ä¹Ÿä¼šå°†é™„åŠ åˆ° hello å’Œä¾èµ– hello çš„ç›®æ ‡ä¸Šï¼Œè¿™é€šå¸¸ä¸æ˜¯æƒ³è¦çš„ç»“æœã€‚</p> <p><strong>INTERFACE å…³é”®å­—è¯´æ˜æºæ–‡ä»¶ä¸ä¼šæ·»åŠ åˆ° hello ç›®æ ‡ä¸­ï¼Œè€Œæ˜¯ä¼šæ·»åŠ åˆ°ä¾èµ–åˆ° hello çš„ç›®æ ‡ä¸Š</strong>ã€‚</p> <p>é€šå¸¸,ä¸ºç›®æ ‡æŒ‡å®šä¸º PRIVATE çš„å†…å®¹éƒ½å¯ä»¥è§†ä¸ºæ„å»ºéœ€æ±‚.æœ€å,åŒ…å«ç›®å½•ä½¿ç”¨ target_include_directories è®¾ç½®.è¯¥æŒ‡ä»¤æŒ‡å®šçš„æ–‡ä»¶å¤¹å†…çš„æ‰€æœ‰æ–‡ä»¶éƒ½å¯ä»¥ä½¿ç”¨ #include (å¸¦å°–æ‹¬å·) æ¥è®¿é—®</p> <h3 id=æ¥å£å’Œçº¯å¤´æ–‡ä»¶><a class=headerlink href=#æ¥å£å’Œçº¯å¤´æ–‡ä»¶ title=æ¥å£å’Œçº¯å¤´æ–‡ä»¶></a>æ¥å£å’Œçº¯å¤´æ–‡ä»¶</h3><p>çº¯å¤´æ–‡ä»¶çš„åº“æœ‰ç‚¹ç‰¹æ®Šï¼Œå› ä¸ºä¸éœ€è¦ç¼–è¯‘Í¾ ç›¸åï¼Œå¯ä»¥å¯¼å‡ºå®ƒä»¬çš„å¤´æ–‡ä»¶ï¼Œä»¥ä¾¿ç›´æ¥åŒ…å«åœ¨å…¶ ä»–åº“ä¸­ã€‚</p> <p>å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå¤´æ–‡ä»¶åº“çš„å·¥ä½œæ–¹å¼ä¸æ™®é€šåº“ç±»ä¼¼ï¼Œä½†æ˜¯å¤´æ–‡ä»¶ä½¿ç”¨ INTERFACEï¼Œè€Œé PUBLICã€‚</p> <p>ç”±äºä»…åŒ…å«å¤´æ–‡ä»¶çš„åº“ä¸éœ€è¦ç¼–è¯‘ï¼Œå› æ­¤ä¸ä¼šå‘ç›®æ ‡æ·»åŠ æºæ–‡ä»¶ã€‚</p> <figure class="highlight cmake"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br></pre><td class=code><pre><span class=line><span class=keyword>project</span>(</span><br><span class=line>ch3_hello_header_only</span><br><span class=line>VERSION <span class=number>1.0</span></span><br><span class=line>DESCRIPTION <span class=string>"Chapter 3 header-only example"</span></span><br><span class=line>LANGUAGES CXX)</span><br><span class=line><span class=keyword>add_library</span>(hello_header_only INTERFACE)</span><br><span class=line><span class=keyword>target_include_directories</span>(hello_header_only INTERFACE <span class=keyword>include</span>/)</span><br><span class=line><span class=keyword>target_compile_features</span>(hello_header_only INTERFACE cxx_std_17)</span><br></pre></table></figure> <h3 id=å¯¹è±¡åº“><a class=headerlink href=#å¯¹è±¡åº“ title=å¯¹è±¡åº“></a>å¯¹è±¡åº“</h3><p>æœ‰æ—¶ï¼Œå¯èƒ½æƒ³è¦<strong>åˆ†ç¦»ä»£ç ï¼Œä»¥ä¾¿éƒ¨åˆ†ä»£ç å¯ä»¥é‡ç”¨</strong>ï¼Œè€Œä¸éœ€è¦åˆ›å»ºå®Œæ•´çš„åº“ã€‚å½“æƒ³åœ¨å¯æ‰§è¡Œæµ‹ è¯•å’Œå•å…ƒæµ‹è¯•ä¸­ä½¿ç”¨æŸäº›ä»£ç æ—¶ï¼Œé€šå¸¸çš„åšæ³•æ˜¯ä¸éœ€è¦é‡æ–°ç¼–è¯‘æ‰€æœ‰ä»£ç ä¸¤æ¬¡ã€‚ä¸ºæ­¤ï¼ŒCMake æ ä¾›äº†å¯¹è±¡åº“ï¼Œå…¶ä¸­çš„æºä»£ç æ˜¯ç¼–è¯‘çš„ï¼Œä½†ä¸è¿›è¡Œå½’æ¡£æˆ–é“¾æ¥ã€‚é€šè¿‡ <code>add_library(MyLibrary object)</code> åˆ›å»ºå¯¹è±¡åº“ã€‚</p> <p>è‡ª CMake 3.12 èµ·ï¼Œ è¿™ äº› å¯¹ è±¡ å¯ ä»¥ åƒ æ™® é€š åº“ ä¸€ æ · ä½¿ ç”¨ï¼Œ åª éœ€ å°† å®ƒ ä»¬ æ·» åŠ  åˆ° target_link_libraries å‡½æ•°ä¸­ã€‚3.12 ç‰ˆæœ¬ä¹‹å‰ï¼Œå¯¹è±¡åº“éœ€è¦æ·»åŠ ç”Ÿæˆå™¨è¡¨è¾¾å¼ï¼Œä¹Ÿå°± æ˜¯ $ã€‚è¿™å°†åœ¨ç”Ÿæˆæ„å»ºç³»ç»ŸæœŸé—´æ‰©å±•ä¸ºä¸€ä¸ªå¯¹è±¡åˆ—è¡¨ã€‚è¿™ç§æ–¹å¼ç° åœ¨è¿˜å¯ä»¥ç”¨ï¼Œä½†ä¸æ¨èè¿™æ ·åšï¼Œå› ä¸ºè¿™å¾ˆå¿«å°±å˜å¾—ä¸å¯ç»´æŠ¤ï¼Œç‰¹åˆ«æ˜¯åœ¨ä¸€ä¸ªé¡¹ç›®ä¸­æœ‰å¤šä¸ªå¯¹è±¡åº“çš„ æƒ…å†µä¸‹ã€‚</p> <h3 id=ä½¿ç”¨åº“><a class=headerlink href=#ä½¿ç”¨åº“ title=ä½¿ç”¨åº“></a>ä½¿ç”¨åº“</h3><p>å¯ ä»¥ æŠŠ add_library æ”¾ åœ¨ åŒ ä¸€ ä¸ª CMakeLists.txt æ–‡ ä»¶ ä¸­ï¼Œ æˆ– è€… ä½¿ ç”¨ add_subdirectory å°†å…¶æ•´åˆèµ·æ¥ã€‚ä¸¤è€…éƒ½æ˜¯æœ‰æ•ˆçš„é€‰é¡¹ï¼Œå¹¶å–å†³äºé¡¹ç›®çš„è®¾ç½®æ–¹å¼</p> <figure class="highlight cmake"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br></pre><td class=code><pre><span class=line><span class=keyword>add_subdirectory</span>(hello_lib)</span><br><span class=line><span class=keyword>add_subdirectory</span>(hello_header_only)</span><br><span class=line><span class=keyword>add_subdirectory</span>(hello_object)</span><br><span class=line><span class=keyword>add_executable</span>(chapter3)</span><br><span class=line><span class=keyword>target_sources</span>(chapter3 PRIVATE src/main.cpp)</span><br><span class=line><span class=keyword>target_link_libraries</span>(chapter3 PRIVATE hello_header_only hello</span><br><span class=line>hello_object)</span><br></pre></table></figure> <p>target_link_libraries çš„ç›®æ ‡ä¹Ÿå¯ä»¥æ˜¯å¦ä¸€ä¸ªåº“ã€‚åŒæ ·ï¼Œåº“çš„é“¾æ¥è¯´æ˜ç¬¦ï¼Œå¯ä»¥æ˜¯ä»¥ä¸‹ ä»»æ„ä¸€ä¸ª:</p> <p>â€¢ PRIVATE: ç”¨äºé“¾æ¥åº“ï¼Œä½†ä¸æ˜¯å…¬å…±æ¥å£çš„ä¸€éƒ¨åˆ†ã€‚åªæœ‰åœ¨æ„å»ºç›®æ ‡æ—¶æ‰éœ€è¦é“¾æ¥åº“ã€‚</p> <p>â€¢ INTERFACE: æ²¡æœ‰é“¾æ¥åˆ°åº“ï¼Œä½†æ˜¯å…¬å…±æ¥å£çš„ä¸€éƒ¨åˆ†ã€‚å½“åœ¨å…¶ä»–åœ°æ–¹ä½¿ç”¨ç›®æ ‡æ—¶ï¼Œé“¾æ¥åº“æ˜¯å¿…éœ€çš„ã€‚è¿™é€šå¸¸ä»…é™å¤´æ–‡ä»¶åº“æ—¶ä½¿ç”¨ã€‚</p> <p>â€¢ PUBLIC: é“¾æ¥åˆ°åº“ï¼Œæ˜¯å…¬å…±æ¥å£çš„ä¸€éƒ¨åˆ†ã€‚å› æ­¤ï¼Œè¯¥åº“æ—¢æ˜¯æ„å»ºä¾èµ–é¡¹ï¼Œä¹Ÿæ˜¯ä½¿ç”¨ä¾èµ–é¡¹ã€‚</p> <h3 id=è®¾ç½®ç¼–è¯‘å™¨å’Œé“¾æ¥å™¨é€‰é¡¹><a class=headerlink href=#è®¾ç½®ç¼–è¯‘å™¨å’Œé“¾æ¥å™¨é€‰é¡¹ title=è®¾ç½®ç¼–è¯‘å™¨å’Œé“¾æ¥å™¨é€‰é¡¹></a>è®¾ç½®ç¼–è¯‘å™¨å’Œé“¾æ¥å™¨é€‰é¡¹</h3><p>C++ ç¼–è¯‘å™¨æœ‰å¾ˆå¤šé€‰é¡¹æ¥è®¾ç½®ä¸€äº›å¸¸è§çš„æ ‡å¿—ï¼Œä»å¤–éƒ¨è®¾ç½®é¢„å¤„ç†å™¨å®šä¹‰ä¹Ÿæ˜¯ä¸€ç§å¸¸è§çš„åš æ³•ã€‚CMake ä¸­ï¼Œè¿™äº›æ˜¯ä½¿ç”¨ target_compile_options ä¼ é€’ï¼Œä½¿ç”¨ target_link_options æ›´æ”¹é“¾æ¥å™¨è¡Œä¸ºï¼Œä½†ç¼–è¯‘å™¨å’Œé“¾æ¥å™¨å¯èƒ½æœ‰ä¸åŒçš„è®¾ç½®æ ‡å¿—çš„æ–¹æ³•ã€‚ä¾‹å¦‚ï¼Œåœ¨ GCC å’Œ Clang ä¸­ï¼Œé€‰ é¡¹ç”¨å‡å· (-) ä¼ é€’ï¼Œè€Œ Microsoft ç¼–è¯‘å™¨å°†æ–œæ  (/) ä½œä¸ºé€‰é¡¹çš„å‰ç¼€ã€‚ä½†æ˜¯<strong>é€šè¿‡ç”Ÿæˆå™¨è¡¨è¾¾å¼ï¼Œå¯ä»¥å¾ˆå®¹æ˜“åœ°åœ¨ CMake ä¸­å¤„ç†è¿™ä¸ªé—®é¢˜</strong>:</p> <figure class="highlight cmake"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br></pre><td class=code><pre><span class=line><span class=keyword>target_link_options</span>(</span><br><span class=line>hello</span><br><span class=line>PRIVATE $<$&LTCXX_COMPILER_ID:MSVC>:/SomeOption></span><br><span class=line>$<$&LTCXX_COMPILER_ID:GNU,Clang,AppleClang>:-</span><br><span class=line>someOption></span><br><span class=line>)</span><br></pre></table></figure> <p>$<a href=$:/SomeOption>$:/SomeOption</a> æ˜¯ ä¸€ ä¸ª åµŒ å¥— çš„ ç”Ÿ æˆ å™¨ è¡¨ è¾¾ å¼ï¼Œ ç”± å†… è€Œ å¤– æ±‚ å€¼ã€‚ ç”Ÿ æˆ å™¨ è¡¨ è¾¾ å¼ åœ¨ ç”Ÿ æˆ é˜¶ æ®µ è¿› è¡Œ è®¡ ç®—ã€‚</p> <p>é¦– å…ˆï¼Œ å½“ C++ ç¼– è¯‘ å™¨ ç­‰ äº MSVC æ—¶ä¸º trueã€‚è‹¥æ˜¯è¿™ç§æƒ…å†µï¼Œé‚£ä¹ˆå¤–éƒ¨è¡¨è¾¾å¼å°†è¿”å›/SomeOptionï¼Œ ç„¶åä¼ é€’ç»™ç¼–è¯‘å™¨ã€‚è‹¥å†…éƒ¨è¡¨è¾¾å¼çš„è®¡ç®—ç»“æœä¸º falseï¼Œåˆ™ä¸ä¼ é€’ã€‚ $<$:-fopenmp> çš„å·¥ä½œåŸç†ç±»ä¼¼ï¼Œä½†ä¸æ˜¯åªæ£€æŸ¥ å•ä¸ªå€¼ï¼Œè€Œæ˜¯ä¼ é€’ä¸€ä¸ªåŒ…å« GNUï¼ŒClangï¼ŒAppleClang çš„åˆ—è¡¨ã€‚è‹¥ CXX_COMPILER_ID åŒ¹é…å…¶ä¸­ ä»»ä½•ä¸€ä¸ªï¼Œå†…éƒ¨è¡¨è¾¾å¼è®¡ç®—ä¸º trueï¼ŒsomeOption ä¼šä¼ é€’ç»™ç¼–è¯‘å™¨ã€‚ å°†ç¼–è¯‘å™¨æˆ–é“¾æ¥å™¨é€‰é¡¹ä¼ é€’ä¸º PRIVATEï¼Œå°†å…¶æ ‡è®°ä¸ºä¸åº“æ¥å£ä¸éœ€è¦çš„æ­¤ç›®æ ‡çš„æ„å»ºéœ€æ±‚ã€‚</p> <p>è‹¥ ä½¿ç”¨ PUBLICï¼Œé‚£ä¹ˆç¼–è¯‘é€‰é¡¹ä¹Ÿæˆä¸ºæ„å»ºéœ€æ±‚ï¼Œæ‰€æœ‰ä¾èµ–äºåŸå§‹ç›®æ ‡çš„ç›®æ ‡å°†ä½¿ç”¨ç›¸åŒçš„ç¼–è¯‘é€‰é¡¹ã€‚ å°†ç¼–è¯‘å™¨é€‰é¡¹æš´éœ²ç»™ä¾èµ–çš„ç›®æ ‡æ˜¯éœ€è¦è°¨æ…åšçš„äº‹æƒ…ã€‚</p> <p>è‹¥ç¼–è¯‘å™¨é€‰é¡¹åªç”¨äºä½¿ç”¨ç›®æ ‡è€Œä¸ç”¨äºæ„å»ºç›®æ ‡ï¼Œåˆ™å¯ä»¥ä½¿ç”¨å…³é”®å­— INTERFACEã€‚åœ¨æ„å»ºçº¯å¤´æ–‡ä»¶åº“æ—¶ï¼Œè¿™æ˜¯æœ€å¸¸è§çš„æƒ…å†µã€‚ ç¼– è¯‘ å™¨ é€‰ é¡¹ çš„ ç‰¹ æ®Š æƒ… å†µ æ˜¯ ç¼– è¯‘ å®š ä¹‰ï¼Œ å…¶ ä¼š ä¼  é€’ ç»™ åº• å±‚ ç¨‹ åºã€‚ è¿™ é€š è¿‡ target_compile_definitions è¿›è¡Œä¼ é€’ã€‚</p> <h3 id=è°ƒè¯•ç¼–è¯‘å™¨é€‰é¡¹><a class=headerlink href=#è°ƒè¯•ç¼–è¯‘å™¨é€‰é¡¹ title=è°ƒè¯•ç¼–è¯‘å™¨é€‰é¡¹></a>è°ƒè¯•ç¼–è¯‘å™¨é€‰é¡¹</h3><p>è¦æŸ¥çœ‹æ‰€æœ‰ç¼–è¯‘é€‰é¡¹ï¼Œå¯ä»¥æŸ¥çœ‹ç”Ÿæˆçš„æ„å»ºæ–‡ä»¶ï¼Œä¾‹å¦‚ Makefiles æˆ– Visual Studio é¡¹ç›®ã€‚æ›´æ–¹ä¾¿ çš„æ–¹æ³•æ˜¯è®© CMake å°†æ‰€æœ‰ç¼–è¯‘å‘½ä»¤å¯¼å‡ºä¸º JSONã€‚ é€š è¿‡ ä½¿ ç”¨ CMAKE_EXPORT_COMPILE_COMMANDSï¼Œ å°† ç”Ÿ æˆ ä¸€ ä¸ª å ä¸º compile_commands.json çš„æ–‡ä»¶ï¼Œå…¶åŒ…å«ç”¨äºç¼–è¯‘çš„å®Œæ•´å‘½ä»¤ã€‚</p> <h3 id=åº“åˆ«å><a class=headerlink href=#åº“åˆ«å title=åº“åˆ«å></a>åº“åˆ«å</h3><p>åº“åˆ«åæ˜¯åœ¨ä¸åˆ›å»ºæ–°çš„æ„å»ºç›®æ ‡çš„æƒ…å†µä¸‹å¼•ç”¨åº“çš„ä¸€ç§æ–¹æ³•ï¼Œæœ‰æ—¶ç§°ä¸ºå‘½åç©ºé—´ã€‚å¸¸è§çš„æ¨¡å¼ æ˜¯ä¸ºä»é¡¹ç›®ä¸­å®‰è£…çš„æ¯ä¸ªåº“ä»¥ MyProject::library çš„å½¢å¼åˆ›å»ºä¸€ä¸ªåº“åˆ«åï¼Œå¯ä»¥ç”¨äºå¯¹å¤šä¸ªç›®æ ‡è¿›è¡Œ è¯­ä¹‰åˆ†ç»„ã€‚æœ‰åŠ©äºé¿å…å‘½åæ–¹é¢çš„å†²çªï¼Œç‰¹åˆ«æ˜¯å½“é¡¹ç›®åŒ…å«å…¬å…±ç›®æ ‡æ—¶ï¼Œæ¯”å¦‚åä¸º utils çš„åº“ã€helper å’Œç±»ä¼¼çš„åº“ã€‚</p> <figure class="highlight cmake"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br></pre><td class=code><pre><span class=line><span class=keyword>add_library</span>(Chapter3::hello ALIAS hello)</span><br><span class=line>...</span><br><span class=line><span class=keyword>target_link_libraries</span>(SomeLibrary PRIVATE Chapter3::hello)</span><br></pre></table></figure> <h3 id=æ‰“åŒ…ã€éƒ¨ç½²å’Œå®‰è£…><a class=headerlink href=#æ‰“åŒ…ã€éƒ¨ç½²å’Œå®‰è£… title=æ‰“åŒ…ã€éƒ¨ç½²å’Œå®‰è£…></a>æ‰“åŒ…ã€éƒ¨ç½²å’Œå®‰è£…</h3><p>install() æŒ‡ä»¤ install(â€¦) æŒ‡ä»¤æ˜¯ä¸€ä¸ªå†…ç½®çš„ CMake å‘½ä»¤ï¼Œå…è®¸ç”Ÿæˆç”¨äºå®‰è£…ç›®æ ‡ã€æ–‡ä»¶ã€ç›®å½•ç­‰çš„æ„å»º ç³»ç»Ÿè¯´æ˜ã€‚CMake ä¸ä¼šç”Ÿæˆå®‰è£…æŒ‡ä»¤ï¼Œé™¤éæ˜ç¡®åœ°è¯´æ˜ã€‚å› æ­¤ï¼Œå®‰è£…æ€»æ˜¯åœ¨å¼€å‘è€…çš„æ§åˆ¶ä¸­ã€‚æ¥çœ‹ ä¸‹å®ƒçš„åŸºæœ¬ç”¨æ³•ã€‚</p> <p>è¦ä½¿ CMake ç›®æ ‡å¯å®‰è£…ï¼Œå¿…é¡»ç”¨è‡³å°‘ä¸€ä¸ªå‚æ•°æŒ‡å®š TARGETS å‚æ•°ã€‚æŒ‡ä»¤çš„ç­¾åå¦‚ä¸‹æ‰€ç¤º:</p> <figure class="highlight cmake"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line><span class=keyword>install</span>(TARGETS ... [...])</span><br></pre></table></figure> <h3 id=å‚è€ƒèµ„æ–™><a class=headerlink href=#å‚è€ƒèµ„æ–™ title=å‚è€ƒèµ„æ–™></a>å‚è€ƒèµ„æ–™</h3><ol><li><a href=https://blog.csdn.net/llffss/article/details/120121617 rel=noopener target=_blank>cmakeæŒ‡ä»¤æ±‡æ€»_cmakeå‘½ä»¤å¤§å…¨_nuosen123çš„åšå®¢-CSDNåšå®¢</a><li><a href=https://www.runoob.com/w3cnote/cpp-static-library-and-dynamic-library.html rel=noopener target=_blank>C++é™æ€åº“ä¸åŠ¨æ€åº“ | èœé¸Ÿæ•™ç¨‹ (runoob.com)</a><li><a href=https://zhuanlan.zhihu.com/p/578843962 rel=noopener target=_blank>ä½¿ç”¨C++åˆ›å»ºå¹¶è°ƒç”¨åŠ¨æ€é“¾æ¥åº“(dll) - çŸ¥ä¹ (zhihu.com)</a><li><a href=https://blog.csdn.net/Op_chaos/article/details/110476264?spm=1001.2101.3001.6650.7&utm_medium=distribute.pc_relevant.none-task-blog-2~default~CTRLIST~Rate-7-110476264-blog-120121617.235^v38^pc_relevant_anti_t3_base&depth_1-utm_source=distribute.pc_relevant.none-task-blog-2~default~CTRLIST~Rate-7-110476264-blog-120121617.235^v38^pc_relevant_anti_t3_base&utm_relevant_index=11 rel=noopener target=_blank>CMakeæŒ‡ä»¤è¯¦è§£_cmake -d-CSDNåšå®¢</a><li><a href=https://blog.csdn.net/qq_25160757/article/details/79813428 rel=noopener target=_blank>VSçš„åŒ…å«ç›®å½•ã€åº“ç›®å½•ã€å¼•ç”¨ç›®å½•ã€å¯æ‰§è¡Œç›®å½•è§£é‡Š_vsåŒ…å«ç›®å½•å’Œå¼•ç”¨ç›®å½•-CSDNåšå®¢</a><li><a href=https://www.cnblogs.com/pandamohist/p/13674438.html rel=noopener target=_blank>cmakeä¹‹Visual studioæ— æ³•æ˜¾ç¤ºå¤´æ–‡ä»¶ - mohist - åšå®¢å›­ (cnblogs.com)</a><li><a href=https://blog.csdn.net/sandalphon4869/article/details/100589747 rel=noopener target=_blank>Linuxä¹‹cmakeçš„æŒ‡ä»¤ä»¥åŠå†…éƒ¨æ„å»ºå’Œå¤–éƒ¨æ„å»º_cmake å¤–éƒ¨ç¼–è¯‘-CSDNåšå®¢</a><li><a href=https://www.cnblogs.com/guoshuai-ouc/p/cmake_variable.html rel=noopener target=_blank>cmake å¸¸ç”¨å˜é‡å’Œå¸¸ç”¨ç¯å¢ƒå˜é‡ - å°æœå­å•Š - åšå®¢å›­ (cnblogs.com)</a><li><a href=https://blog.csdn.net/qq_38410730/article/details/102477162 rel=noopener target=_blank>ã€CMakeã€‘CMakeLists.txtçš„è¶…å‚»ç“œæ‰‹æŠŠæ‰‹æ•™ç¨‹ï¼ˆé™„å®ä¾‹æºç ï¼‰_ã€cmakeã€‘cmakelists.txtçš„è¶…å‚»ç“œæ‰‹æŠŠæ‰‹æ•™ç¨‹(é™„å®ä¾‹æºç )-CSDNåšå®¢</a><li><a href=https://developer.aliyun.com/article/243229#:~:text=å®˜ç½‘ä¸æ¨èä½¿ç”¨l,ariesä½¿ç”¨ã€‚ rel=noopener target=_blank>makeçš„link_directorieså‘½ä»¤ä¸èµ·ä½œç”¨-é˜¿é‡Œäº‘å¼€å‘è€…ç¤¾åŒº (aliyun.com)</a><li><a href=https://cmake.org/cmake/help/latest/ rel=noopener target=_blank>CMake Reference Documentation â€” CMake 3.28.0-rc1 Documentation</a><li><a href=https://blog.csdn.net/afei__/article/details/81201039 rel=noopener target=_blank>CMakeLists.txt è¯­æ³•ä»‹ç»ä¸å®ä¾‹æ¼”ç»ƒ-CSDNåšå®¢</a><li><a href=https://www.bookstack.cn/read/Modern-CMake-CN-Modern-CMake-zh_CN/701c8402c6158612.md rel=noopener target=_blank>ç°ä»£çš„ CMake çš„ä»‹ç» - ã€ŠModern CMake ç®€ä½“ä¸­æ–‡ç‰ˆã€‹ - ä¹¦æ ˆç½‘ Â· BookStack</a><li><a href=https://cmakebyexample.dev/ rel=noopener target=_blank>CMake by Example</a><li><a href=https://makefiletutorial.com/#makefile-cookbook rel=noopener target=_blank>Makefile Tutorial By Example</a><li><a href=https://www.youtube.com/watch?v=bsXLMQ6WgIk&ab_channel=CppNow rel=noopener target=_blank>C ++ç°åœ¨2017å¹´ï¼šä¸¹å°¼å°”Â·è²è´¹å°”â€œæœ‰æ•ˆçš„CMakeâ€ (youtube.com)</a></ol> <link href=/css/spoiler.css rel=stylesheet><script async src=/js/spoiler.js></script> <div><div><div style="text-align:center;color: #ccc;font-size:14px;">-------------æœ¬æ–‡ç»“æŸ<i class="fa fa-paw"></i>æ„Ÿè°¢æ‚¨çš„é˜…è¯»-------------</div></div></div> <div class=reward-container><div>æ„Ÿè°¢é˜…è¯».</div><button onclick="var qr = document.getElementById('qr'); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">æ‰“èµ</button><div style="display: none;" id=qr><div style="display: inline-block;"><img alt="Sekyoro å¾®ä¿¡æ”¯ä»˜" src=/images/wechatpay.png><p>å¾®ä¿¡æ”¯ä»˜</div></div></div> <div><ul class=post-copyright><li class=post-copyright-author><strong>æœ¬æ–‡ä½œè€…ï¼š </strong>Sekyoro<li class=post-copyright-link><strong>æœ¬æ–‡é“¾æ¥ï¼š</strong> <a href=https://www.sekyoro.top/2023/10/11/cmake%E5%AD%A6%E4%B9%A0/ title=cmakeå­¦ä¹ >https://www.sekyoro.top/2023/10/11/cmakeå­¦ä¹ /</a><li class=post-copyright-license><strong>ç‰ˆæƒå£°æ˜ï¼š </strong>æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href=https://creativecommons.org/licenses/by-nc-sa/4.0/ rel=noopener target=_blank><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼</ul></div> <div class=followme><p>æ¬¢è¿å…³æ³¨æˆ‘çš„å…¶å®ƒå‘å¸ƒæ¸ é“<div class=social-list><div class=social-item><a class=social-link href=/images/wxqrcode.png target=_blank> <span class=icon> <i class="fab fa-weixin"></i> </span> <span class=label>WeChat</span> </a></div><div class=social-item><a class=social-link href=/images/website.png target=_blank> <span class=icon> <i class="fa fa-user"></i> </span> <span class=label>PersonalWebsite</span> </a></div><div class=social-item><a class=social-link href=https://my-astro-git-main-drowning-in-codes.vercel.app target=_blank> <span class=icon> <i class="fas fa-share"></i> </span> <span class=label>æ‚é±¼åˆ†äº«</span> </a></div><div class=social-item><a class=social-link href=/atom.xml target=_blank> <span class=icon> <i class="fa fa-rss"></i> </span> <span class=label>RSS</span> </a></div></div></div> <footer class=post-footer><div class=post-tags><a href=/tags/CMake/ rel=tag><i class="fa fa-tag"></i> CMake</a></div><div class=post-nav><div class=post-nav-item><a href=/2023/10/04/stable-diffusion%E5%AD%A6%E4%B9%A0/ rel=prev title=stable_diffusionå­¦ä¹ > <i class="fa fa-chevron-left"></i> stable_diffusionå­¦ä¹  </a></div><div class=post-nav-item><a title="ç›®æ ‡æ£€æµ‹(Object Detection)å­¦ä¹ _P1" href=/2023/10/11/%E7%9B%AE%E6%A0%87%E6%A3%80%E6%B5%8B-Object-Detection-%E5%AD%A6%E4%B9%A0/ rel=next> ç›®æ ‡æ£€æµ‹(Object Detection)å­¦ä¹ _P1 <i class="fa fa-chevron-right"></i> </a></div></div></footer> <!-- è¯„è®ºåŒº --> <div class=comments><div data-id=city data-uid=MTAyMC81MzE5Ny8yOTY3Mg== id=lv-container></div></div> <script>window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }</script> <div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div> <aside class=sidebar><div class=sidebar-inner><!-- canvasç²’å­æ—¶é’Ÿ --><div><canvas id=canvas style=width:60%;>å½“å‰æµè§ˆå™¨ä¸æ”¯æŒcanvasï¼Œè¯·æ›´æ¢æµè§ˆå™¨åå†è¯•</canvas></div><script>(function(){

   var digit=
    [
        [
            [0,0,1,1,1,0,0],
            [0,1,1,0,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,0,1,1,0],
            [0,0,1,1,1,0,0]
        ],//0
        [
            [0,0,0,1,1,0,0],
            [0,1,1,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [1,1,1,1,1,1,1]
        ],//1
        [
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,0,1,1,0,0,0],
            [0,1,1,0,0,0,0],
            [1,1,0,0,0,0,0],
            [1,1,0,0,0,1,1],
            [1,1,1,1,1,1,1]
        ],//2
        [
            [1,1,1,1,1,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,0,0,1,1,0],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//3
        [
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,1,0],
            [0,0,1,1,1,1,0],
            [0,1,1,0,1,1,0],
            [1,1,0,0,1,1,0],
            [1,1,1,1,1,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,0,1,1,0],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,1,1]
        ],//4
        [
            [1,1,1,1,1,1,1],
            [1,1,0,0,0,0,0],
            [1,1,0,0,0,0,0],
            [1,1,1,1,1,1,0],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//5
        [
            [0,0,0,0,1,1,0],
            [0,0,1,1,0,0,0],
            [0,1,1,0,0,0,0],
            [1,1,0,0,0,0,0],
            [1,1,0,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//6
        [
            [1,1,1,1,1,1,1],
            [1,1,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,1,1,0,0,0],
            [0,0,1,1,0,0,0],
            [0,0,1,1,0,0,0],
            [0,0,1,1,0,0,0]
        ],//7
        [
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//8
        [
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,1,1,0,0,0,0]
        ],//9
        [
            [0,0,0,0,0,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,0,0,0,0,0]
        ]//:
    ];

var canvas = document.getElementById('canvas');

if(canvas.getContext){
    var cxt = canvas.getContext('2d');
    //å£°æ˜canvasçš„å®½é«˜
    var H = 100,W = 700;
    canvas.height = H;
    canvas.width = W;
    cxt.fillStyle = '#f00';
    cxt.fillRect(10,10,50,50);

    //å­˜å‚¨æ—¶é—´æ•°æ®
    var data = [];
    //å­˜å‚¨è¿åŠ¨çš„å°çƒ
    var balls = [];
    //è®¾ç½®ç²’å­åŠå¾„
    var R = canvas.height/20-1;
    (function(){
        var temp = /(\d)(\d):(\d)(\d):(\d)(\d)/.exec(new Date());
        //å­˜å‚¨æ—¶é—´æ•°å­—ï¼Œç”±åä½å°æ—¶ã€ä¸ªä½å°æ—¶ã€å†’å·ã€åä½åˆ†é’Ÿã€ä¸ªä½åˆ†é’Ÿã€å†’å·ã€åä½ç§’é’Ÿã€ä¸ªä½ç§’é’Ÿè¿™7ä¸ªæ•°å­—ç»„æˆ
        data.push(temp[1],temp[2],10,temp[3],temp[4],10,temp[5],temp[6]);
    })();

    /*ç”Ÿæˆç‚¹é˜µæ•°å­—*/
    function renderDigit(index,num){
        for(var i = 0; i < digit[num].length; i++){
            for(var j = 0; j < digit[num][i].length; j++){
                if(digit[num][i][j] == 1){
                    cxt.beginPath();
                    cxt.arc(14*(R+2)*index + j*2*(R+1)+(R+1),i*2*(R+1)+(R+1),R,0,2*Math.PI);
                    cxt.closePath();
                    cxt.fill();
                }
            }
        }
    }

    /*æ›´æ–°æ—¶é’Ÿ*/
    function updateDigitTime(){
        var changeNumArray = [];
        var temp = /(\d)(\d):(\d)(\d):(\d)(\d)/.exec(new Date());
        var NewData = [];
        NewData.push(temp[1],temp[2],10,temp[3],temp[4],10,temp[5],temp[6]);
        for(var i = data.length-1; i >=0 ; i--){
            //æ—¶é—´å‘ç”Ÿå˜åŒ–
            if(NewData[i] !== data[i]){
                //å°†å˜åŒ–çš„æ•°å­—å€¼å’Œåœ¨dataæ•°ç»„ä¸­çš„ç´¢å¼•å­˜å‚¨åœ¨changeNumArrayæ•°ç»„ä¸­
                changeNumArray.push(i+'_'+(Number(data[i])+1)%10);
            }
        }
        //å¢åŠ å°çƒ
        for(var i = 0; i< changeNumArray.length; i++){
            addBalls.apply(this,changeNumArray[i].split('_'));
        }
        data = NewData.concat();
    }

    /*æ›´æ–°å°çƒçŠ¶æ€*/
    function updateBalls(){
        for(var i = 0; i < balls.length; i++){
            balls[i].stepY += balls[i].disY;
            balls[i].x += balls[i].stepX;
            balls[i].y += balls[i].stepY;
            if(balls[i].x > W + R || balls[i].y > H + R){
                balls.splice(i,1);
                i--;
            }
        }
    }

    /*å¢åŠ è¦è¿åŠ¨çš„å°çƒ*/
    function addBalls(index,num){
        var numArray = [1,2,3];
        var colorArray =  ["#3BE","#09C","#A6C","#93C","#9C0","#690","#FB3","#F80","#F44","#C00"];
        for(var i = 0; i < digit[num].length; i++){
            for(var j = 0; j < digit[num][i].length; j++){
                if(digit[num][i][j] == 1){
                    var ball = {
                        x:14*(R+2)*index + j*2*(R+1)+(R+1),
                        y:i*2*(R+1)+(R+1),
                        stepX:Math.floor(Math.random() * 4 -2),
                        stepY:-2*numArray[Math.floor(Math.random()*numArray.length)],
                        color:colorArray[Math.floor(Math.random()*colorArray.length)],
                        disY:1
                    };
                    balls.push(ball);
                }
            }
        }
    }

    /*æ¸²æŸ“*/
    function render(){
        //é‡ç½®ç”»å¸ƒå®½åº¦ï¼Œè¾¾åˆ°æ¸…ç©ºç”»å¸ƒçš„æ•ˆæœ
        canvas.height = 100;
        //æ¸²æŸ“æ—¶é’Ÿ
        for(var i = 0; i < data.length; i++){
            renderDigit(i,data[i]);
        }
        //æ¸²æŸ“å°çƒ
        for(var i = 0; i < balls.length; i++){
            cxt.beginPath();
            cxt.arc(balls[i].x,balls[i].y,R,0,2*Math.PI);
            cxt.fillStyle = balls[i].color;
            cxt.closePath();
            cxt.fill();
        }
    }

    clearInterval(oTimer);
    var oTimer = setInterval(function(){
        //æ›´æ–°æ—¶é’Ÿ
        updateDigitTime();
        //æ›´æ–°å°çƒçŠ¶æ€
        updateBalls();
        //æ¸²æŸ“
        render();
    },50);
}

})();</script><!-- require APlayer --><link href=https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js></script><!-- require MetingJS --><script src=/js/meting-js.js></script><ul class="sidebar-nav motion-element"><li class=sidebar-nav-toc>æ–‡ç« ç›®å½•<li class=sidebar-nav-overview>ç«™ç‚¹æ¦‚è§ˆ</ul><!--noindex--><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class=nav><li class="nav-item nav-level-2"><a class=nav-link href=#Before-cmake><span class=nav-number>1.</span> <span class=nav-text>Before cmake</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#syntax><span class=nav-number>1.1.</span> <span class=nav-text>syntax</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#more-examples><span class=nav-number>1.2.</span> <span class=nav-text>more examples</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#clean><span class=nav-number>1.3.</span> <span class=nav-text>clean</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#variables><span class=nav-number>1.4.</span> <span class=nav-text>variables</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#Targets><span class=nav-number>1.5.</span> <span class=nav-text>Targets</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#automatic-variables-and-wildcards><span class=nav-number>1.6.</span> <span class=nav-text>automatic variables and wildcards</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#%E9%9A%90%E5%BC%8F%E8%A7%84%E5%88%99><span class=nav-number>1.7.</span> <span class=nav-text>éšå¼è§„åˆ™</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#%E6%9D%A1%E4%BB%B6><span class=nav-number>1.8.</span> <span class=nav-text>æ¡ä»¶</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#%E5%87%BD%E6%95%B0><span class=nav-number>1.9.</span> <span class=nav-text>å‡½æ•°</span></a></ol><li class="nav-item nav-level-2"><a class=nav-link href=#cmake-fundamental><span class=nav-number>2.</span> <span class=nav-text>cmake fundamental</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#%E5%B8%B8%E7%94%A8%E5%8F%98%E9%87%8F><span class=nav-number>3.</span> <span class=nav-text>å¸¸ç”¨å˜é‡</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#%E6%8C%87%E5%AE%9A%E7%94%9F%E6%88%90%E7%A8%8B%E5%BA%8F><span class=nav-number>4.</span> <span class=nav-text>æŒ‡å®šç”Ÿæˆç¨‹åº</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#%E6%B7%BB%E5%8A%A0%E5%A4%B4%E6%96%87%E4%BB%B6%E7%9B%AE%E5%BD%95%E5%92%8C%E5%BA%93><span class=nav-number>5.</span> <span class=nav-text>æ·»åŠ å¤´æ–‡ä»¶ç›®å½•å’Œåº“</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#find-package-amp-find-path-amp-find-library><span class=nav-number>6.</span> <span class=nav-text>find_package&find_path&find_library</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#%E7%BC%96%E8%AF%91%E6%97%B6%E6%B6%88%E6%81%AF%E8%BE%93%E5%87%BA><span class=nav-number>7.</span> <span class=nav-text>ç¼–è¯‘æ—¶æ¶ˆæ¯è¾“å‡º</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#%E8%AE%BE%E7%BD%AE%E5%8F%98%E9%87%8F><span class=nav-number>8.</span> <span class=nav-text>è®¾ç½®å˜é‡</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#%E6%8E%A7%E5%88%B6%E7%BB%93%E6%9E%84><span class=nav-number>9.</span> <span class=nav-text>æ§åˆ¶ç»“æ„</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#%E6%B7%BB%E5%8A%A0%E5%85%B6%E4%BB%96%E5%AD%90%E7%9B%AE%E5%BD%95><span class=nav-number>10.</span> <span class=nav-text>æ·»åŠ å…¶ä»–å­ç›®å½•</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#%E8%8E%B7%E5%8F%96%E6%96%87%E4%BB%B6><span class=nav-number>11.</span> <span class=nav-text>è·å–æ–‡ä»¶</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#vs%E4%B8%AD%E6%98%BE%E7%A4%BA%E5%A4%B4%E6%96%87%E4%BB%B6><span class=nav-number>12.</span> <span class=nav-text>vsä¸­æ˜¾ç¤ºå¤´æ–‡ä»¶</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#option%E4%B8%8Eadd-definitions><span class=nav-number>13.</span> <span class=nav-text>optionä¸add_definitions</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#%E7%94%9F%E6%88%90%E5%99%A8%E8%A1%A8%E7%A4%BA><span class=nav-number>13.1.</span> <span class=nav-text>ç”Ÿæˆå™¨è¡¨ç¤º</span></a></ol><li class="nav-item nav-level-2"><a class=nav-link href=#Advanced-cmake><span class=nav-number>14.</span> <span class=nav-text>Advanced cmake</span></a><ol class=nav-child><li class="nav-item nav-level-4"><a class=nav-link href=#Effective-CMake><span class=nav-number>14.0.1.</span> <span class=nav-text>Effective CMake</span></a><ol class=nav-child><li class="nav-item nav-level-5"><a class=nav-link href=#%E9%80%9A%E7%94%A8><span class=nav-number>14.0.1.1.</span> <span class=nav-text>é€šç”¨</span></a><li class="nav-item nav-level-5"><a class=nav-link href=#%E6%A8%A1%E5%9D%97Modules><span class=nav-number>14.0.1.2.</span> <span class=nav-text>æ¨¡å—Modules</span></a><li class="nav-item nav-level-5"><a class=nav-link href=#%E9%A1%B9%E7%9B%AEProjects><span class=nav-number>14.0.1.3.</span> <span class=nav-text>é¡¹ç›®Projects</span></a><li class="nav-item nav-level-5"><a class=nav-link href=#%E7%9B%AE%E6%A0%87-Targets-%E5%8F%8A%E5%85%B6%E5%B1%9E%E6%80%A7-Properties><span class=nav-number>14.0.1.4.</span> <span class=nav-text>ç›®æ ‡(Targets)åŠå…¶å±æ€§(Properties)</span></a><li class="nav-item nav-level-5"><a class=nav-link href=#%E5%87%BD%E6%95%B0%E4%B8%8E%E5%AE%8F><span class=nav-number>14.0.1.5.</span> <span class=nav-text>å‡½æ•°ä¸å®</span></a><li class="nav-item nav-level-5"><a class=nav-link href=#%E5%BE%AA%E7%8E%AF><span class=nav-number>14.0.1.6.</span> <span class=nav-text>å¾ªç¯</span></a><li class="nav-item nav-level-5"><a class=nav-link href=#%E5%8C%85><span class=nav-number>14.0.1.7.</span> <span class=nav-text>åŒ…</span></a><li class="nav-item nav-level-5"><a class=nav-link href=#%E4%BA%A4%E5%8F%89%E7%BC%96%E8%AF%91><span class=nav-number>14.0.1.8.</span> <span class=nav-text>äº¤å‰ç¼–è¯‘</span></a><li class="nav-item nav-level-5"><a class=nav-link href=#%E8%AD%A6%E5%91%8A%E4%B8%8E%E6%8A%A5%E9%94%99><span class=nav-number>14.0.1.9.</span> <span class=nav-text>è­¦å‘Šä¸æŠ¥é”™</span></a></ol></ol></ol><li class="nav-item nav-level-2"><a class=nav-link href=#%E5%AE%9E%E6%88%98><span class=nav-number>15.</span> <span class=nav-text>å®æˆ˜</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84><span class=nav-number>15.1.</span> <span class=nav-text>é¡¹ç›®ç»“æ„</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#%E5%88%9B%E5%BB%BA%E5%BA%93><span class=nav-number>15.2.</span> <span class=nav-text>åˆ›å»ºåº“</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#%E6%8E%A5%E5%8F%A3%E5%92%8C%E7%BA%AF%E5%A4%B4%E6%96%87%E4%BB%B6><span class=nav-number>15.3.</span> <span class=nav-text>æ¥å£å’Œçº¯å¤´æ–‡ä»¶</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#%E5%AF%B9%E8%B1%A1%E5%BA%93><span class=nav-number>15.4.</span> <span class=nav-text>å¯¹è±¡åº“</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#%E4%BD%BF%E7%94%A8%E5%BA%93><span class=nav-number>15.5.</span> <span class=nav-text>ä½¿ç”¨åº“</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#%E8%AE%BE%E7%BD%AE%E7%BC%96%E8%AF%91%E5%99%A8%E5%92%8C%E9%93%BE%E6%8E%A5%E5%99%A8%E9%80%89%E9%A1%B9><span class=nav-number>15.6.</span> <span class=nav-text>è®¾ç½®ç¼–è¯‘å™¨å’Œé“¾æ¥å™¨é€‰é¡¹</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#%E8%B0%83%E8%AF%95%E7%BC%96%E8%AF%91%E5%99%A8%E9%80%89%E9%A1%B9><span class=nav-number>15.7.</span> <span class=nav-text>è°ƒè¯•ç¼–è¯‘å™¨é€‰é¡¹</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#%E5%BA%93%E5%88%AB%E5%90%8D><span class=nav-number>15.8.</span> <span class=nav-text>åº“åˆ«å</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#%E6%89%93%E5%8C%85%E3%80%81%E9%83%A8%E7%BD%B2%E5%92%8C%E5%AE%89%E8%A3%85><span class=nav-number>15.9.</span> <span class=nav-text>æ‰“åŒ…ã€éƒ¨ç½²å’Œå®‰è£…</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99><span class=nav-number>15.10.</span> <span class=nav-text>å‚è€ƒèµ„æ–™</span></a></ol></div></div><!--/noindex--><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop=author itemscope itemtype=http://schema.org/Person><img alt=Sekyoro class=site-author-image itemprop=image src=https://i.loli.net/2021/05/17/YqoavnXdGTpPO9R.jpg><p class=site-author-name itemprop=name>Sekyoro<div class=site-description itemprop=description>ä»€ä¹ˆä¹Ÿæ— æ³•èˆå¼ƒçš„äººï¼Œä»€ä¹ˆä¹Ÿåšä¸äº†.</div></div><div class="site-state-wrap motion-element"><nav class=site-state><div class="site-state-item site-state-posts"><a href=/archives/> <span class=site-state-item-count>205</span> <span class=site-state-item-name>æ—¥å¿—</span> </a></div><div class="site-state-item site-state-categories"><a href=/categories/> <span class=site-state-item-count>17</span> <span class=site-state-item-name>åˆ†ç±»</span></a></div><div class="site-state-item site-state-tags"><a href=/tags/> <span class=site-state-item-count>196</span> <span class=site-state-item-name>æ ‡ç­¾</span></a></div></nav></div><div class="links-of-author motion-element"><span class=links-of-author-item> <a title="Personal Website â†’ http://proanimer.com" href=http://proanimer.com/ rel=noopener target=_blank><i class="fab fa-internet-explorer fa-fw"></i>Personal Website</a> </span><span class=links-of-author-item> <a title="GitHub â†’ https://github.com/drowning-in-codes" href=https://github.com/drowning-in-codes rel=noopener target=_blank><i class="fab fa-github fa-fw"></i>GitHub</a> </span><span class=links-of-author-item> <a title="E-Mail â†’ mailto:bukalala174@gmail.com" href=mailto:bukalala174@gmail.com rel=noopener target=_blank><i class="fa fa-envelope fa-fw"></i>E-Mail</a> </span><span class=links-of-author-item> <a title="wxPublicAccount â†’ https://mp.weixin.qq.com/s?__biz=Mzg3ODY1MDkzMg==&mid=2247483770&idx=1&sn=fdf88faab01d5c219ac609570a21c9d6&chksm=cf113221f866bb373938cfca03cf095ff4fe1e4dc37d68ef5de4cd4876ee1260fca0c015a4d6&token=1096259873&lang=zh_CN#rd" href=https://mp.weixin.qq.com/s?__biz=Mzg3ODY1MDkzMg==&mid=2247483770&idx=1&sn=fdf88faab01d5c219ac609570a21c9d6&chksm=cf113221f866bb373938cfca03cf095ff4fe1e4dc37d68ef5de4cd4876ee1260fca0c015a4d6&token=1096259873&lang=zh_CN#rd rel=noopener target=_blank><i class="fab fa-weixin fa-fw"></i>wxPublicAccount</a> </span><span class=links-of-author-item> <a title="RSS â†’ /atom.xml" href=/atom.xml><i class="fa fa-rss fa-fw"></i>RSS</a> </span><span class=links-of-author-item> <a title="CSDN â†’ https://blog.csdn.net/aqwca" href=https://blog.csdn.net/aqwca rel=noopener target=_blank><i class="fa fa-handshake fa-fw"></i>CSDN</a> </span><span class=links-of-author-item> <a title="æ‚é±¼åˆ†äº« â†’ https://my-astro-git-main-drowning-in-codes.vercel.app" href=https://my-astro-git-main-drowning-in-codes.vercel.app/ rel=noopener target=_blank><i class="fas fa-share fa-fw"></i>æ‚é±¼åˆ†äº«</a> </span></div><div class="links-of-blogroll motion-element"><div class=links-of-blogroll-title><i class="fa fa-link fa-fw"></i> å‹æƒ…é“¾æ¥</div><ul class=links-of-blogroll-list><li class=links-of-blogroll-item><a href=http://myqhs.top/ rel=noopener target=_blank title=http://myqhs.top/>myqhs</a><li class=links-of-blogroll-item><a href=https://www.lllomh.com/ rel=noopener target=_blank title=https://www.lllomh.com/>èŠˆæ¸¡</a><li class=links-of-blogroll-item><a href=https://protool-ten.vercel.app/ rel=noopener target=_blank title=https://protool-ten.vercel.app/>protools</a></ul></div><div class="motion-element announcement"><div class=title></div><p class=content><p class=date></div></div><meting-js id=6856787487 order=random server=netease type=playlist> </meting-js><div class=widget-wrap><h3 class=widget-title style=margin:0>æ–‡ç« è¯äº‘</h3><div class="widget tagcloud" id=myCanvasContainer><canvas height=250 id=resCanvas style=width:100% width=250><ul class=tag-list itemprop=keywords><li class=tag-list-item><a class=tag-list-link href=/tags/CMake/ rel=tag>CMake</a><span class=tag-list-count>1</span></ul></canvas></div></div><script id=clustrmaps src=https://clustrmaps.com/map_v2.js?d=xQdGTxqARTBiNIwX2aUban-ixkj2s6VaZQWo-aVCgY8&cl=ffffff&w=a></script><div class="back-to-top motion-element"><i class="fa fa-arrow-up"></i><span>0%</span></div><!-- è¾¹æ  --></div></aside> <div id=sidebar-dimmer></div> <footer class=footer><div class=footer-inner><div class=copyright>Â© Wed Apr 08 2020 08:00:00 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´) â€“ <span itemprop=copyrightYear>2024</span><span class=with-love> <i class="fa fa-heart"></i> </span><span class=author itemprop=copyrightHolder>Sekyoro</span><span class=post-meta-divider>|</span><span class=post-meta-item-icon> <i class="fa fa-chart-area"></i> </span><span title=ç«™ç‚¹æ€»å­—æ•°>1.7m</span><span class=post-meta-divider>|</span><span class=post-meta-item-icon> <i class="fa fa-coffee"></i> </span><span title=ç«™ç‚¹é˜…è¯»æ—¶é•¿>25:28</span></div><script async src=https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js></script><span id=busuanzi_container_site_pv>æ€»è®¿é—®é‡<span id=busuanzi_value_site_pv></span>æ¬¡</span><span class=post-meta-divider>|</span><span id=busuanzi_container_site_uv>æ€»è®¿å®¢æ•°<span id=busuanzi_value_site_uv></span>äºº</span><span class=post-meta-divider>|</span><!-- ä¸è’œå­è®¡æ•°åˆå§‹å€¼çº æ­£ --><script>$(document).ready(function() {

    var int = setInterval(fixCount, 50);  // 50mså‘¨æœŸæ£€æµ‹å‡½æ•°
    var countOffset = 20000;  // åˆå§‹åŒ–é¦–æ¬¡æ•°æ®

    function fixCount() {            
       if (document.getElementById("busuanzi_container_site_pv").style.display != "none")
        {
            $("#busuanzi_value_site_pv").html(parseInt($("#busuanzi_value_site_pv").html()) + countOffset); 
            clearInterval(int);
        }                  
        if ($("#busuanzi_container_site_pv").css("display") != "none")
        {
            $("#busuanzi_value_site_uv").html(parseInt($("#busuanzi_value_site_uv").html()) + countOffset); // åŠ ä¸Šåˆå§‹æ•°æ® 
            clearInterval(int); // åœæ­¢æ£€æµ‹
        }  
    }
       	
});</script><div><span id=timeDate>è½½å…¥å¤©æ•°...</span><span id=times>è½½å…¥æ—¶åˆ†ç§’...</span><script>var now = new Date();
    function createtime() {
        var grt= new Date("04/08/2021 20:00:00");
        now.setTime(now.getTime()+250);
        days = (now - grt ) / 1000 / 60 / 60 / 24; dnum = Math.floor(days);
        hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum); hnum = Math.floor(hours);
        if(String(hnum).length ==1 ){hnum = "0" + hnum;} minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum);
        mnum = Math.floor(minutes); if(String(mnum).length ==1 ){mnum = "0" + mnum;}
        seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum);
        snum = Math.round(seconds); if(String(snum).length ==1 ){snum = "0" + snum;}
        document.getElementById("timeDate").innerHTML = "æœ¬ç«™å·²å®‰å…¨è¿è¡Œ "+dnum+" å¤© ";
        document.getElementById("times").innerHTML = hnum + " å°æ—¶ " + mnum + " åˆ† " + snum + " ç§’";
    }
setInterval("createtime()",250);</script></div><div class=busuanzi-count><script async data-pjax src=https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><span style="display: none;" class=post-meta-item id=busuanzi_container_site_uv> <span class=post-meta-item-icon> <i class="fa fa-user"></i> </span> <span class=site-uv title=æ€»è®¿å®¢é‡> <span id=busuanzi_value_site_uv></span> </span> </span><span class=post-meta-divider>|</span><span style="display: none;" class=post-meta-item id=busuanzi_container_site_pv> <span class=post-meta-item-icon> <i class="fa fa-eye"></i> </span> <span class=site-pv title=æ€»è®¿é—®é‡> <span id=busuanzi_value_site_pv></span> </span> </span></div></div></footer> <script color=0,0,255 count=99 opacity=0.5 src=/lib/canvas-nest/canvas-nest.min.js zindex=-1></script> <script src=/lib/anime.min.js></script> <script src=https://cdn.jsdelivr.net/gh/theme-next/theme-next-pjax@0/pjax.min.js></script> <script src=https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js></script> <script src=https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js></script> <script src=https://cdn.jsdelivr.net/npm/lozad@1/dist/lozad.min.js></script> <script src=https://cdn.jsdelivr.net/npm/velocity-animate@1/velocity.min.js></script> <script src=https://cdn.jsdelivr.net/npm/velocity-animate@1/velocity.ui.min.js></script> <script src=/js/utils.js></script> <script src=/js/motion.js></script> <script src=/js/schemes/pisces.js></script> <script src=/js/next-boot.js></script> <script src=/js/bookmark.js></script> <script>var pjax = new Pjax({
  selectors: [
    'head title',
    '#page-configurations',
    '.content-wrap',
    '.post-toc-wrap',
    '.languages',
    '#pjax',
	'.widget-wrap'
  ],
  switches: {
    '.post-toc-wrap': Pjax.switches.innerHTML
  },
  analytics: false,
  cacheBust: false,
  scrollTo : !CONFIG.bookmark.enable
});

window.addEventListener('pjax:success', () => {
  document.querySelectorAll('script[data-pjax], script#page-configurations, #pjax script').forEach(element => {
    var code = element.text || element.textContent || element.innerHTML || '';
    var parent = element.parentNode;
    parent.removeChild(element);
    var script = document.createElement('script');
    if (element.id) {
      script.id = element.id;
    }
    if (element.className) {
      script.className = element.className;
    }
    if (element.type) {
      script.type = element.type;
    }
    if (element.src) {
      script.src = element.src;
      // Force synchronous loading of peripheral JS.
      script.async = false;
    }
    if (element.dataset.pjax !== undefined) {
      script.dataset.pjax = '';
    }
    if (code !== '') {
      script.appendChild(document.createTextNode(code));
    }
    parent.appendChild(script);
  });
 
  NexT.boot.refresh();
  // Define Motion Sequence & Bootstrap Motion.
  if (CONFIG.motion.enable) {
    NexT.motion.integrator
      .init()
      .add(NexT.motion.middleWares.subMenu)
      .add(NexT.motion.middleWares.postList)
      .bootstrap();
  }
  NexT.utils.updateSidebarPosition();
});</script> <script data-pjax>(function(){
      var canonicalURL, curProtocol;
      //Get the <link> tag
      var x=document.getElementsByTagName("link");
		//Find the last canonical URL
		if(x.length > 0){
			for (i=0;i<x.length;i++){
				if(x[i].rel.toLowerCase() == 'canonical' && x[i].href){
					canonicalURL=x[i].href;
				}
			}
		}
    //Get protocol
	    if (!canonicalURL){
	    	curProtocol = window.location.protocol.split(':')[0];
	    }
	    else{
	    	curProtocol = canonicalURL.split(':')[0];
	    }
      //Get current URL if the canonical URL does not exist
	    if (!canonicalURL) canonicalURL = window.location.href;
	    //Assign script content. Replace current URL with the canonical URL
      !function(){var e=/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi,r=canonicalURL,t=document.referrer;if(!e.test(r)){var n=(String(curProtocol).toLowerCase() === 'https')?"https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif":"//api.share.baidu.com/s.gif";t?(n+="?r="+encodeURIComponent(document.referrer),r&&(n+="&l="+r)):r&&(n+="?l="+r);var i=new Image;i.src=n}}(window);})();</script> <script src=https://cdn.jsdelivr.net/npm/algoliasearch@4/dist/algoliasearch-lite.umd.js></script> <script src=https://cdn.jsdelivr.net/npm/instantsearch.js@4/dist/instantsearch.production.min.js></script> <script src=/js/algolia-search.js></script> <script data-pjax>document.querySelectorAll('.pdfobject-container').forEach(element => {
  let url = element.dataset.target;
  let pdfOpenParams = {
    navpanes : 0,
    toolbar  : 0,
    statusbar: 0,
    pagemode : 'thumbs',
    view     : 'FitH'
  };
  let pdfOpenFragment = '#' + Object.entries(pdfOpenParams).map(([key, value]) => `${key}=${encodeURIComponent(value)}`).join('&');
  let fullURL = `/lib/pdf/web/viewer.html?file=${encodeURIComponent(url)}${pdfOpenFragment}`;

  if (NexT.utils.supportsPDFs()) {
    element.innerHTML = `<embed class="pdfobject" src="${url + pdfOpenFragment}" type="application/pdf" style="height: ${element.dataset.height};">`;
  } else {
    element.innerHTML = `<iframe src="${fullURL}" style="height: ${element.dataset.height};" frameborder="0"></iframe>`;
  }
});</script> <div id=pjax><script charset=utf-8 defer src=/js/outdate.js></script></div> <script charset=utf-8 defer src=/js/tagcanvas.js></script> <script charset=utf-8 defer src=/js/tagcloud.js></script> <script>NexT.utils.loadComments(document.querySelector('#lv-container'), () => {
  window.livereOptions = {
    refer: location.pathname.replace(CONFIG.root, '').replace('index.html', '')
  };
  (function(d, s) {
    var j, e = d.getElementsByTagName(s)[0];
    if (typeof LivereTower === 'function') { return; }
    j = d.createElement(s);
    j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
    j.async = true;
    e.parentNode.insertBefore(j, e);
  })(document, 'script');
});</script> <script>var OriginTitile = document.title;
  var titleTime;
  document.addEventListener("visibilitychange", function() {
    if (document.hidden) {
      document.title = "(ã¤ã‚§âŠ‚)æˆ‘è—å¥½äº†å“¦~" + OriginTitile;
      clearTimeout(titleTime);
    } else {
      document.title = "(*Â´âˆ‡ï½€*) è¢«ä½ å‘ç°å•¦~" + OriginTitile;
      titleTime = setTimeout(function() {
        document.title = OriginTitile;
      }, 2000);
    }
  });</script> <script src=/js/src/activate-power-mode.min.js></script> <script>POWERMODE.colorful = true;
    POWERMODE.shake = false;
    document.body.addEventListener('input', POWERMODE);</script> 