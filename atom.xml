<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Sekyoroçš„åšå®¢å°å±‹</title>
  
  
  <link href="https://www.sekyoro.top/atom.xml" rel="self"/>
  
  <link href="https://www.sekyoro.top/"/>
  <updated>2024-07-06T09:46:42.939Z</updated>
  <id>https://www.sekyoro.top/</id>
  
  <author>
    <name>Sekyoro</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>i3wm,Neovimä¸Alacrittyçš„ä½¿ç”¨ä¸é…ç½®</title>
    <link href="https://www.sekyoro.top/2024/07/06/i3wm%E3%80%81Neovim%E4%B8%8EAlacritty%E7%9A%84%E4%BD%BF%E7%94%A8%E4%B8%8E%E9%85%8D%E7%BD%AE/"/>
    <id>https://www.sekyoro.top/2024/07/06/i3wm%E3%80%81Neovim%E4%B8%8EAlacritty%E7%9A%84%E4%BD%BF%E7%94%A8%E4%B8%8E%E9%85%8D%E7%BD%AE/</id>
    <published>2024-07-06T03:54:41.000Z</published>
    <updated>2024-07-06T09:46:42.939Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>å¸¸ç”¨çš„çª—å£ç®¡ç†å™¨,ç¼–è¾‘å™¨ä¸ç»ˆç«¯æ¨¡æ‹Ÿå™¨ç­‰ç­‰<br><span id="more"></span><br>è¿™äº›å·¥å…·éƒ½æœ‰ç›¸å¯¹çš„ä¼˜åŠ£,æˆ‘ä¸ªäººè§‰å¾—<strong>ç”Ÿæ€</strong>,<strong>ç¨³å®šæ€§</strong>æ˜¯ä¸¤ä¸ªéå¸¸é‡è¦çš„å› ç´ . ç”Ÿæ€å¥½å°±ä¼šæœ‰ä¸æ–­çš„æ›´æ–°å’Œç»´æŠ¤,ç¨³å®šæ€§ä¼šè®©ç”¨æˆ·æ›´å¥½çš„é•¿æœŸé€‚åº”.</p><h3 id="i3wm"><a href="#i3wm" class="headerlink" title="i3wm"></a>i3wm</h3><p>i3wmæ˜¯ä¸ªåŸºäºx11çš„çª—å£ç®¡ç†å™¨,ç”Ÿæ€å¾ˆå¼º<a href="https://github.com/fz-wu/i3_user_guide_Chinese">fz-wu/i3_user_guide_Chinese: i3wmå®˜æ–¹æŒ‡å—,æ–¹ä¾¿åŒå­¦ä»¬å­¦ä¹ i3wm. i3æ˜¯ä¸€ä¸ªå¹³é“ºå¼çš„çª—å£ç®¡ç†å™¨ (github.com)</a></p><p><img data-src="https://i3wm.org/docs/modes.png" alt="Container modes"></p><p>ç±»ä¼¼çš„è¿˜æœ‰awesome wm,dwm,ä¹Ÿæœ‰åŸºäºwaylandçš„compositor hyprland(æ²¡æœ‰ä½¿ç”¨hyprlandä¹Ÿæ˜¯å› ä¸ºæ„Ÿè§‰è¿˜ä¸å¤ªç¨³å®š,ç­‰è¿‡æ®µæ—¶é—´å†çœ‹çœ‹).è¯¦æƒ…çœ‹<a href="https://wiki.archlinux.org/title/Comparison_of_tiling_window_managers">Comparison of tiling window managers - ArchWiki (archlinux.org)</a>å’Œ<a href="https://wiki.archlinux.org/title/Wayland#Tiling">Wayland - ArchWiki (archlinux.org)</a></p><p>å…·ä½“é…ç½®æ–‡æ¡£<a href="https://i3wm.org/docs/userguide.html#configuring">i3: i3 Userâ€™s Guide (i3wm.org)</a></p><p>ä¸€ä¸ªä¾‹å­<a href="https://github.com/levinit/i3wm-config/blob/master/i3/config">i3wm-config/i3/config at master Â· levinit/i3wm-config (github.com)</a></p><p>i3æœ¬èº«ä¸æ”¯æŒé€æ˜ç­‰åŠŸèƒ½,è¿˜éœ€è¦å®‰è£…å…¶ä»–å·¥å…·<a href="https://zocoxx.com/archlinux-i3wm.html">ArchLinuxç³»ç»Ÿi3wmé…ç½®åŠä½“éªŒè®°å½• â€“ ZocoXX</a>,<a href="https://levinit.github.io/i3wm-config/#:~:text=ç¼–è¾‘ i3%2Fconfig æ–‡ä»¶å¯åˆ‡æ¢æ¨¡å¼ã€‚,éšæœºæ¨¡å¼ï¼šè‡ªåŠ¨åˆ‡æ¢å£çº¸ï¼Œå°†è¦ç”¨ä½œå£çº¸çš„å›¾ç‰‡æ”¾åˆ° ~%2FPictures%2Fwallpapers å³å¯ã€‚">i3wm-config | my i3wm config (levinit.github.io)</a></p><h3 id="awesomewm"><a href="#awesomewm" class="headerlink" title="awesomewm"></a>awesomewm</h3><p>ä½¿ç”¨luaé…ç½®,ç›¸å¯¹i3çš„æ–‡æœ¬é…ç½®,ä¸ªäººè®¤ä¸ºæ›´å‹å¥½,ä¸Šæ‰‹é—¨æ§›æ›´ä½.<a href="https://github.com/atsepkov/awesome-awesome-wm">atsepkov/awesome-awesome-wm: A curated list of awesome tools/scripts/configs for Awesome Window Manager. (github.com)</a>,é™¤äº†æœ¬èº«çª—å£ç®¡ç†å¤–,è¿˜æœ‰æŸ¥çœ‹CPUèµ„æº,å›¾ç‰‡ç­‰å·¥å…·éœ€è¦é¢å¤–å®‰è£….</p><p>æ‰€ä»¥æ¯”è¾ƒæ–¹ä¾¿çš„åšæ³•å°±æ˜¯cloneå…¶ä»–äººçš„é…ç½®ğŸ˜…</p><p><strong>i3</strong></p><ul><li><a href="https://github.com/addy-dclxvi/i3-starterpack">addy-dclxvi/i3-starterpack: A simple guide (and example of configuration) to install i3 &amp; its and essentials packages, then make them look eye candy. (github.com)</a></li><li><a href="https://github.com/sainathadapa/i3-wm-config">sainathadapa/i3-wm-config: I3 tiling window manager configuration (github.com)</a></li><li><a href="https://github.com/levinit/i3wm-config">levinit/i3wm-config: my i3wm config (github.com)</a></li><li><a href="https://github.com/typecraft-dev/dotfiles">typecraft-dev/dotfiles (github.com)</a></li></ul><p><strong>awesome</strong></p><ul><li><a href="https://github.com/raven2cz/dotfiles">raven2cz/dotfiles: Dotfiles are the customization files in GNU/Linux. This repository assembly together all my others github config repos to one union. You can choose this global conf for your system or check other repos.</a></li><li><a href="https://github.com/pw4ever/awesome-wm-config">pw4ever/awesome-wm-config: awesome window manager config with persistent dynamic tagging (github.com)</a></li></ul><p><strong>hyprland</strong><a href="https://wiki.hyprland.org/Configuring/">Configuring â€“ Hyprland Wiki</a></p><ul><li><a href="https://github.com/SolDoesTech/hyprland">SolDoesTech/hyprland: collection of dot config files for hyprland with a simple install script for a fresh Arch linux with yay (github.com)</a></li><li><a href="https://github.com/notwidow/hyprland">notwidow/hyprland: hyprland config (github.com)</a></li></ul><h3 id="Neovim"><a href="#Neovim" class="headerlink" title="Neovim"></a>Neovim</h3><p>åŸºäºvimçš„ç¼–è¾‘å™¨,æ›´å¥½åœ°è¿›è¡Œé…ç½®ã€å®‰è£…æ’ä»¶.</p><p>ä¸»è¦æ˜¯éœ€è¦äº†è§£neovimçš„ä¸€äº›é…ç½®è¯­æ³•,å¦‚æœä¸ºäº†æ–¹ä¾¿ç›´æ¥ä½¿ç”¨lazyvimç­‰é…ç½®å³å¯.</p><p><a href="https://neovim.io/doc/user/lua-guide.html">Lua-guide - Neovim docs</a> neovimä½¿ç”¨vim.*ç­‰å˜é‡æ›¿ä»£äº†åŸæœ¬çš„vimscript,ä¸è¿‡ä½ ä¾ç„¶å¯ä»¥ä½¿ç”¨vim.cmdæ‰§è¡Œvimscript,ä½¿ç”¨vim.fnæ‰§è¡Œå‡½æ•°</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">vim.cmd(<span class="string">&quot;colorscheme habamax&quot;</span>)</span><br><span class="line">vim.cmd.highlight(&#123; <span class="string">&quot;Error&quot;</span>, <span class="string">&quot;guibg=red&quot;</span> &#125;)</span><br><span class="line"><span class="built_in">print</span>(vim.fn.printf(<span class="string">&#x27;Hello from %s&#x27;</span>, <span class="string">&#x27;Lua&#x27;</span>))</span><br><span class="line"><span class="keyword">local</span> reversed_list = vim.fn.<span class="built_in">reverse</span>(&#123; <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span> &#125;)</span><br><span class="line">vim.<span class="built_in">print</span>(reversed_list) <span class="comment">-- &#123; &quot;c&quot;, &quot;b&quot;, &quot;a&quot; &#125;</span></span><br><span class="line"><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">print_stdout</span><span class="params">(chan_id, data, name)</span></span></span><br><span class="line">  <span class="built_in">print</span>(data[<span class="number">1</span>])</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line">vim.fn.jobstart(<span class="string">&#x27;ls&#x27;</span>, &#123; on_stdout = print_stdout &#125;)</span><br></pre></td></tr></table></figure><h4 id="vim-å˜é‡"><a href="#vim-å˜é‡" class="headerlink" title="vim.*å˜é‡"></a>vim.*å˜é‡</h4><p><a href="https://neovim.io/doc/user/lua.html#vim.g">vim.g</a>: global variables (<a href="https://neovim.io/doc/user/eval.html#g%3A">g:</a>)</p><p><a href="https://neovim.io/doc/user/lua.html#vim.b">vim.b</a>: variables for the current buffer (<a href="https://neovim.io/doc/user/eval.html#b%3A">b:</a>)</p><p><a href="https://neovim.io/doc/user/lua.html#vim.w">vim.w</a>: variables for the current window (<a href="https://neovim.io/doc/user/eval.html#w%3A">w:</a>)</p><p><a href="https://neovim.io/doc/user/lua.html#vim.t">vim.t</a>: variables for the current tabpage (<a href="https://neovim.io/doc/user/eval.html#t%3A">t:</a>)</p><p><a href="https://neovim.io/doc/user/lua.html#vim.v">vim.v</a>: predefined Vim variables (<a href="https://neovim.io/doc/user/eval.html#v%3A">v:</a>)</p><p><a href="https://neovim.io/doc/user/lua.html#vim.env">vim.env</a>: environment variables defined in the editor session</p><h4 id="è®¾ç½®options"><a href="#è®¾ç½®options" class="headerlink" title="è®¾ç½®options"></a>è®¾ç½®options</h4><p>optionså°±æ˜¯vimä¸­çš„è¡¨ç°æ¯”å¦‚set smarttab</p><p>è®¾ç½®å…¨å±€å’Œæœ¬åœ°é€‰é¡¹ï¼ˆä¾‹å¦‚åœ¨ init.lua ä¸­ï¼‰æœ€æ–¹ä¾¿çš„æ–¹æ³•æ˜¯é€šè¿‡ vim.opt.<br>è®¾ç½®å…¨å±€å’Œæœ¬åœ°é€‰é¡¹æœ€æ–¹ä¾¿çš„æ–¹æ³•æ˜¯é€šè¿‡ vim.opt å’Œå®ƒçš„æœ‹å‹ä»¬ï¼š<br>vim.opt: è¡Œä¸ºç±»ä¼¼äº :set<br>vim.opt_global: è¡Œä¸ºç±»ä¼¼äº :setglobal<br>vim.opt_localï¼šè¡Œä¸ºç±»ä¼¼äº :setlocal</p><h5 id="vim-opt"><a href="#vim-opt" class="headerlink" title="vim.opt"></a>vim.opt</h5><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vim.opt.smarttab = <span class="literal">true</span></span><br><span class="line">vim.opt.smarttab = <span class="literal">false</span></span><br></pre></td></tr></table></figure><p>ä»£ä»·æ˜¯ä¸èƒ½ç›´æ¥è®¿é—®é€‰é¡¹å€¼ï¼Œè€Œå¿…é¡»<br>ä½¿ç”¨ vim.opt:get()ï¼š</p><h5 id="vim-o"><a href="#vim-o" class="headerlink" title="vim.o"></a>vim.o</h5><p>æœ‰ä¸€ç§æ›´ç›´æ¥çš„ç±»ä¼¼å˜é‡çš„è®¿é—®æ–¹å¼,ä½¿ç”¨ vim.o<br>vim.oï¼šè¡Œä¸ºç±»ä¼¼äº :set<br>vim.goï¼šè¡Œä¸ºç±»ä¼¼äº :setglobal<br>vim.boï¼šç”¨äºç¼“å†²åŒºé€‰é¡¹<br>vim.woï¼šç”¨äºçª—å£çš„é€‰é¡¹</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">vim.o.smarttab = <span class="literal">false</span> <span class="comment">-- :set nosmarttab</span></span><br><span class="line"><span class="built_in">print</span>(vim.o.smarttab)</span><br><span class="line"><span class="comment">--&gt; false</span></span><br><span class="line">vim.o.listchars = <span class="string">&#x27;space:_,tab:&gt;~&#x27;</span> <span class="comment">-- :set listchars=&#x27;space:_,tab:&gt;~&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(vim.o.listchars)</span><br><span class="line"><span class="comment">--&gt; &#x27;space:_,tab:&gt;~&#x27;</span></span><br><span class="line">vim.o.isfname = vim.o.isfname .. <span class="string">&#x27;,@-@&#x27;</span> <span class="comment">-- :set isfname+=@-@</span></span><br><span class="line"><span class="built_in">print</span>(vim.o.isfname)</span><br><span class="line"><span class="comment">--&gt; &#x27;@,48-57,/,.,-,_,+,,,#,$,%,~,=,@-@&#x27;</span></span><br><span class="line">vim.bo.shiftwidth = <span class="number">4</span> <span class="comment">-- :setlocal shiftwidth=4</span></span><br><span class="line"><span class="built_in">print</span>(vim.bo.shiftwidth)</span><br><span class="line"><span class="comment">--&gt; 4</span></span><br><span class="line">vim.bo[<span class="number">4</span>].expandtab = <span class="literal">true</span> <span class="comment">-- sets expandtab to true in buffer 4</span></span><br><span class="line">vim.wo.number = <span class="literal">true</span>       <span class="comment">-- sets number to true in current window</span></span><br><span class="line">vim.wo[<span class="number">0</span>].number = <span class="literal">true</span>    <span class="comment">-- same as above</span></span><br><span class="line">vim.wo[<span class="number">0</span>][<span class="number">0</span>].number = <span class="literal">true</span> <span class="comment">-- sets number to true in current buffer</span></span><br><span class="line">                           <span class="comment">-- in current window only</span></span><br><span class="line"><span class="built_in">print</span>(vim.wo[<span class="number">0</span>].number)    <span class="comment">--&gt; true</span></span><br></pre></td></tr></table></figure><h4 id="Mappings"><a href="#Mappings" class="headerlink" title="Mappings"></a>Mappings</h4><p>è®¾ç½®æ‰§è¡Œå‘½ä»¤çš„å¿«æ·é”®.</p><p>å¯ä»¥ä½¿ç”¨ vim.keymap.set() åˆ›å»ºæ˜ å°„ã€‚è¯¥å‡½æ•°éœ€è¦ä¸‰ä¸ªå‚æ•°ï¼š<br>{mode} æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²æˆ–å­—ç¬¦ä¸²è¡¨ï¼ŒåŒ…å«æ˜ å°„ç”Ÿæ•ˆçš„æ¨¡å¼å‰ç¼€ã€‚å‰ç¼€æ˜¯ :map-modes ä¸­åˆ—å‡ºçš„å‰ç¼€ï¼Œæˆ– :map! ä¸­çš„â€!â€ï¼Œæˆ– :map ä¸­çš„ç©ºå­—ç¬¦ä¸²ã€‚<br>{lhs} æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼ŒåŒ…å«åº”è§¦å‘æ˜ å°„çš„é”®åºåˆ—ã€‚<br>{rhs} æ˜¯åŒ…å« Vim å‘½ä»¤æˆ– Lua å‡½æ•°çš„å­—ç¬¦ä¸²ï¼Œå½“è¾“å…¥ {lhs} æ—¶åº”æ‰§è¡Œè¯¥å‘½ä»¤æˆ–å‡½æ•°ã€‚ç©ºå­—ç¬¦ä¸²ç­‰åŒäº <Nop>ï¼Œè¡¨ç¤ºç¦ç”¨æŒ‰é”®ã€‚</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- Normal mode mapping for Vim command</span></span><br><span class="line">vim.keymap.set(<span class="string">&#x27;n&#x27;</span>, <span class="string">&#x27;&lt;Leader&gt;ex1&#x27;</span>, <span class="string">&#x27;&lt;cmd&gt;echo &quot;Example 1&quot;&lt;cr&gt;&#x27;</span>)</span><br><span class="line"><span class="comment">-- Normal and Command-line mode mapping for Vim command</span></span><br><span class="line">vim.keymap.set(&#123;<span class="string">&#x27;n&#x27;</span>, <span class="string">&#x27;c&#x27;</span>&#125;, <span class="string">&#x27;&lt;Leader&gt;ex2&#x27;</span>, <span class="string">&#x27;&lt;cmd&gt;echo &quot;Example 2&quot;&lt;cr&gt;&#x27;</span>)</span><br><span class="line"><span class="comment">-- Normal mode mapping for Lua function</span></span><br><span class="line">vim.keymap.set(<span class="string">&#x27;n&#x27;</span>, <span class="string">&#x27;&lt;Leader&gt;ex3&#x27;</span>, vim.treesitter.start)</span><br><span class="line"><span class="comment">-- Normal mode mapping for Lua function with arguments</span></span><br><span class="line">vim.keymap.set(<span class="string">&#x27;n&#x27;</span>, <span class="string">&#x27;&lt;Leader&gt;ex4&#x27;</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span></span> <span class="built_in">print</span>(<span class="string">&#x27;Example 4&#x27;</span>) <span class="keyword">end</span>)</span><br></pre></td></tr></table></figure><h4 id="Autocommands"><a href="#Autocommands" class="headerlink" title="Autocommands"></a>Autocommands</h4><p>è‡ªåŠ¨å‘½ä»¤æ˜¯ä¸€ä¸ª Vim å‘½ä»¤æˆ–ä¸€ä¸ª Lua å‡½æ•°ï¼Œæ¯å½“è§¦å‘ä¸€ä¸ªæˆ–å¤šä¸ªäº‹ä»¶ï¼ˆå¦‚æ–‡ä»¶è¢«æ‰“å¼€ï¼‰æ—¶å°±ä¼šè‡ªåŠ¨æ‰§è¡Œã€‚</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">vim.api.nvim_create_autocmd(&#123;<span class="string">&quot;BufEnter&quot;</span>, <span class="string">&quot;BufWinEnter&quot;</span>&#125;, &#123;</span><br><span class="line">  pattern = &#123;<span class="string">&quot;*.c&quot;</span>, <span class="string">&quot;*.h&quot;</span>&#125;,</span><br><span class="line">  command = <span class="string">&quot;echo &#x27;Entering a C or C++ file&#x27;&quot;</span>,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">-- Same autocommand written with a Lua function instead</span></span><br><span class="line">vim.api.nvim_create_autocmd(&#123;<span class="string">&quot;BufEnter&quot;</span>, <span class="string">&quot;BufWinEnter&quot;</span>&#125;, &#123;</span><br><span class="line">  pattern = &#123;<span class="string">&quot;*.c&quot;</span>, <span class="string">&quot;*.h&quot;</span>&#125;,</span><br><span class="line">  callback = <span class="function"><span class="keyword">function</span><span class="params">()</span></span> <span class="built_in">print</span>(<span class="string">&quot;Entering a C or C++ file&quot;</span>) <span class="keyword">end</span>,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">-- User event triggered by MyPlugin</span></span><br><span class="line">vim.api.nvim_create_autocmd(<span class="string">&quot;User&quot;</span>, &#123;</span><br><span class="line">  pattern = <span class="string">&quot;MyPlugin&quot;</span>,</span><br><span class="line">  callback = <span class="function"><span class="keyword">function</span><span class="params">()</span></span> <span class="built_in">print</span>(<span class="string">&quot;My Plugin Works!&quot;</span>) <span class="keyword">end</span>,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="User-commands"><a href="#User-commands" class="headerlink" title="User commands"></a>User commands</h4><p>ç”¨æˆ·å‘½ä»¤å¯é€šè¿‡ nvim_create_user_command() åˆ›å»ºã€‚è¯¥å‡½æ•°é¡»è¦ä¸‰ä¸ªå‚æ•°ï¼š<br>å‘½ä»¤åç§°å­—ç¬¦ä¸²ï¼ˆå¿…é¡»ä»¥å¤§å†™å­—æ¯å¼€å¤´ï¼Œä»¥åŒºåˆ«äºå†…ç½®å‘½ä»¤ï¼‰ï¼›<br>ä¸€ä¸ªåŒ…å« Vim å‘½ä»¤æˆ– Lua å‡½æ•°çš„å­—ç¬¦ä¸²ï¼Œå‘½ä»¤è°ƒç”¨æ—¶æ‰§è¡Œè¯¥å­—ç¬¦ä¸²ï¼›<br>åŒ…å«å‘½ä»¤å±æ€§çš„è¡¨æ ¼ï¼›æ­¤å¤–ï¼Œå®ƒè¿˜å¯ä»¥åŒ…å«å…³é”®å­— descï¼ˆæè¿°å‘½ä»¤çš„å­—ç¬¦ä¸²ï¼‰ã€forceï¼ˆè®¾ç½®ä¸º false ä»¥é¿å…æ›¿æ¢å·²å­˜åœ¨çš„åŒåå‘½ä»¤ï¼‰å’Œ previewï¼ˆç”¨äº :command-preview çš„ Lua å‡½æ•°ï¼‰ã€‚</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim.api.nvim_create_user_command(<span class="string">&#x27;Test&#x27;</span>, <span class="string">&#x27;echo &quot;It works!&quot;&#x27;</span>, &#123;&#125;)</span><br><span class="line">vim.cmd.Test()</span><br><span class="line"><span class="comment">--&gt; It works!</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥ä½¿ç”¨lazyvimæˆ–è€…nvchadç­‰é…ç½®æ–‡ä»¶,å·²ç»ä¸ºæˆ‘ä»¬é…ç½®å¥½äº†å¾ˆå¤šä¸œè¥¿.</p><p>æ‹¿Lazyvimè·ç¦»,<code>options.lua</code>ä¸­é…ç½®äº†ä¸€äº›å…¨å±€å˜é‡ä»¥åŠvimè®¸å¤šå±æ€§.</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- This file is automatically loaded by plugins.core</span></span><br><span class="line">vim.g.mapleader = <span class="string">&quot; &quot;</span></span><br><span class="line">vim.g.maplocalleader = <span class="string">&quot;\\&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- LazyVim auto format</span></span><br><span class="line">vim.g.autoformat = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- LazyVim picker to use.</span></span><br><span class="line"><span class="comment">-- Can be one of: telescope, fzf</span></span><br><span class="line"><span class="comment">-- Leave it to &quot;auto&quot; to automatically use the picker</span></span><br><span class="line"><span class="comment">-- enabled with `:LazyExtras`</span></span><br><span class="line">vim.g.lazyvim_picker = <span class="string">&quot;auto&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- LazyVim root dir detection</span></span><br><span class="line"><span class="comment">-- Each entry can be:</span></span><br><span class="line"><span class="comment">-- * the name of a detector function like `lsp` or `cwd`</span></span><br><span class="line"><span class="comment">-- * a pattern or array of patterns like `.git` or `lua`.</span></span><br><span class="line"><span class="comment">-- * a function with signature `function(buf) -&gt; string|string[]`</span></span><br><span class="line">vim.g.root_spec = &#123; <span class="string">&quot;lsp&quot;</span>, &#123; <span class="string">&quot;.git&quot;</span>, <span class="string">&quot;lua&quot;</span> &#125;, <span class="string">&quot;cwd&quot;</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- LazyVim automatically configures lazygit:</span></span><br><span class="line"><span class="comment">--  * theme, based on the active colorscheme.</span></span><br><span class="line"><span class="comment">--  * editorPreset to nvim-remote</span></span><br><span class="line"><span class="comment">--  * enables nerd font icons</span></span><br><span class="line"><span class="comment">-- Set to false to disable.</span></span><br><span class="line">vim.g.lazygit_config = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- Options for the LazyVim statuscolumn</span></span><br><span class="line">vim.g.lazyvim_statuscolumn = &#123;</span><br><span class="line">  folds_open = <span class="literal">false</span>, <span class="comment">-- show fold sign when fold is open</span></span><br><span class="line">  folds_githl = <span class="literal">false</span>, <span class="comment">-- highlight fold sign with git sign color</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- Optionally setup the terminal to use</span></span><br><span class="line"><span class="comment">-- This sets `vim.o.shell` and does some additional configuration for:</span></span><br><span class="line"><span class="comment">-- * pwsh</span></span><br><span class="line"><span class="comment">-- * powershell</span></span><br><span class="line"><span class="comment">-- LazyVim.terminal.setup(&quot;pwsh&quot;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- Hide deprecation warnings</span></span><br><span class="line">vim.g.deprecation_warnings = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- Set filetype to `bigfile` for files larger than 1.5 MB</span></span><br><span class="line"><span class="comment">-- Only vim syntax will be enabled (with the correct filetype)</span></span><br><span class="line"><span class="comment">-- LSP, treesitter and other ft plugins will be disabled.</span></span><br><span class="line"><span class="comment">-- mini.animate will also be disabled.</span></span><br><span class="line">vim.g.bigfile_size = <span class="number">1024</span> * <span class="number">1024</span> * <span class="number">1.5</span> <span class="comment">-- 1.5 MB</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- Show the current document symbols location from Trouble in lualine</span></span><br><span class="line">vim.g.trouble_lualine = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> opt = vim.opt</span><br><span class="line"></span><br><span class="line">opt.autowrite = <span class="literal">true</span> <span class="comment">-- Enable auto write</span></span><br><span class="line"><span class="comment">-- only set clipboard if not in ssh, to make sure the OSC 52</span></span><br><span class="line"><span class="comment">-- integration works automatically. Requires Neovim &gt;= 0.10.0</span></span><br><span class="line">opt.clipboard = vim.env.SSH_TTY <span class="keyword">and</span> <span class="string">&quot;&quot;</span> <span class="keyword">or</span> <span class="string">&quot;unnamedplus&quot;</span> <span class="comment">-- Sync with system clipboard</span></span><br><span class="line">opt.completeopt = <span class="string">&quot;menu,menuone,noselect&quot;</span></span><br><span class="line">opt.conceallevel = <span class="number">2</span> <span class="comment">-- Hide * markup for bold and italic, but not markers with substitutions</span></span><br><span class="line">opt.confirm = <span class="literal">true</span> <span class="comment">-- Confirm to save changes before exiting modified buffer</span></span><br><span class="line">opt.cursorline = <span class="literal">true</span> <span class="comment">-- Enable highlighting of the current line</span></span><br><span class="line">opt.expandtab = <span class="literal">true</span> <span class="comment">-- Use spaces instead of tabs</span></span><br><span class="line">opt.fillchars = &#123;</span><br><span class="line">  foldopen = <span class="string">&quot;ï‘¼&quot;</span>,</span><br><span class="line">  foldclose = <span class="string">&quot;ï‘ &quot;</span>,</span><br><span class="line">  fold = <span class="string">&quot; &quot;</span>,</span><br><span class="line">  foldsep = <span class="string">&quot; &quot;</span>,</span><br><span class="line">  diff = <span class="string">&quot;â•±&quot;</span>,</span><br><span class="line">  eob = <span class="string">&quot; &quot;</span>,</span><br><span class="line">&#125;</span><br><span class="line">opt.foldlevel = <span class="number">99</span></span><br><span class="line">opt.formatexpr = <span class="string">&quot;v:lua.require&#x27;lazyvim.util&#x27;.format.formatexpr()&quot;</span></span><br><span class="line">opt.formatoptions = <span class="string">&quot;jcroqlnt&quot;</span> <span class="comment">-- tcqj</span></span><br><span class="line">opt.grepformat = <span class="string">&quot;%f:%l:%c:%m&quot;</span></span><br><span class="line">opt.grepprg = <span class="string">&quot;rg --vimgrep&quot;</span></span><br><span class="line">opt.ignorecase = <span class="literal">true</span> <span class="comment">-- Ignore case</span></span><br><span class="line">opt.inccommand = <span class="string">&quot;nosplit&quot;</span> <span class="comment">-- preview incremental substitute</span></span><br><span class="line">opt.jumpoptions = <span class="string">&quot;view&quot;</span></span><br><span class="line">opt.laststatus = <span class="number">3</span> <span class="comment">-- global statusline</span></span><br><span class="line">opt.linebreak = <span class="literal">true</span> <span class="comment">-- Wrap lines at convenient points</span></span><br><span class="line">opt.list = <span class="literal">true</span> <span class="comment">-- Show some invisible characters (tabs...</span></span><br><span class="line">opt.mouse = <span class="string">&quot;a&quot;</span> <span class="comment">-- Enable mouse mode</span></span><br><span class="line">opt.number = <span class="literal">true</span> <span class="comment">-- Print line number</span></span><br><span class="line">opt.pumblend = <span class="number">10</span> <span class="comment">-- Popup blend</span></span><br><span class="line">opt.pumheight = <span class="number">10</span> <span class="comment">-- Maximum number of entries in a popup</span></span><br><span class="line">opt.relativenumber = <span class="literal">true</span> <span class="comment">-- Relative line numbers</span></span><br><span class="line">opt.scrolloff = <span class="number">4</span> <span class="comment">-- Lines of context</span></span><br><span class="line">opt.sessionoptions = &#123; <span class="string">&quot;buffers&quot;</span>, <span class="string">&quot;curdir&quot;</span>, <span class="string">&quot;tabpages&quot;</span>, <span class="string">&quot;winsize&quot;</span>, <span class="string">&quot;help&quot;</span>, <span class="string">&quot;globals&quot;</span>, <span class="string">&quot;skiprtp&quot;</span>, <span class="string">&quot;folds&quot;</span> &#125;</span><br><span class="line">opt.shiftround = <span class="literal">true</span> <span class="comment">-- Round indent</span></span><br><span class="line">opt.shiftwidth = <span class="number">2</span> <span class="comment">-- Size of an indent</span></span><br><span class="line">opt.shortmess:append(&#123; W = <span class="literal">true</span>, I = <span class="literal">true</span>, c = <span class="literal">true</span>, C = <span class="literal">true</span> &#125;)</span><br><span class="line">opt.showmode = <span class="literal">false</span> <span class="comment">-- Dont show mode since we have a statusline</span></span><br><span class="line">opt.sidescrolloff = <span class="number">8</span> <span class="comment">-- Columns of context</span></span><br><span class="line">opt.signcolumn = <span class="string">&quot;yes&quot;</span> <span class="comment">-- Always show the signcolumn, otherwise it would shift the text each time</span></span><br><span class="line">opt.smartcase = <span class="literal">true</span> <span class="comment">-- Don&#x27;t ignore case with capitals</span></span><br><span class="line">opt.smartindent = <span class="literal">true</span> <span class="comment">-- Insert indents automatically</span></span><br><span class="line">opt.spelllang = &#123; <span class="string">&quot;en&quot;</span> &#125;</span><br><span class="line">opt.spelloptions:append(<span class="string">&quot;noplainbuffer&quot;</span>)</span><br><span class="line">opt.splitbelow = <span class="literal">true</span> <span class="comment">-- Put new windows below current</span></span><br><span class="line">opt.splitkeep = <span class="string">&quot;screen&quot;</span></span><br><span class="line">opt.splitright = <span class="literal">true</span> <span class="comment">-- Put new windows right of current</span></span><br><span class="line">opt.statuscolumn = <span class="string">[[%!v:lua.require&#x27;lazyvim.util&#x27;.ui.statuscolumn()]]</span></span><br><span class="line">opt.tabstop = <span class="number">2</span> <span class="comment">-- Number of spaces tabs count for</span></span><br><span class="line">opt.termguicolors = <span class="literal">true</span> <span class="comment">-- True color support</span></span><br><span class="line">opt.timeoutlen = vim.g.vscode <span class="keyword">and</span> <span class="number">1000</span> <span class="keyword">or</span> <span class="number">300</span> <span class="comment">-- Lower than default (1000) to quickly trigger which-key</span></span><br><span class="line">opt.undofile = <span class="literal">true</span></span><br><span class="line">opt.undolevels = <span class="number">10000</span></span><br><span class="line">opt.updatetime = <span class="number">200</span> <span class="comment">-- Save swap file and trigger CursorHold</span></span><br><span class="line">opt.virtualedit = <span class="string">&quot;block&quot;</span> <span class="comment">-- Allow cursor to move where there is no text in visual block mode</span></span><br><span class="line">opt.wildmode = <span class="string">&quot;longest:full,full&quot;</span> <span class="comment">-- Command-line completion mode</span></span><br><span class="line">opt.winminwidth = <span class="number">5</span> <span class="comment">-- Minimum window width</span></span><br><span class="line">opt.<span class="built_in">wrap</span> = <span class="literal">false</span> <span class="comment">-- Disable line wrap</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> vim.fn.has(<span class="string">&quot;nvim-0.10&quot;</span>) == <span class="number">1</span> <span class="keyword">then</span></span><br><span class="line">  opt.smoothscroll = <span class="literal">true</span></span><br><span class="line">  opt.foldexpr = <span class="string">&quot;v:lua.require&#x27;lazyvim.util&#x27;.ui.foldexpr()&quot;</span></span><br><span class="line">  opt.foldmethod = <span class="string">&quot;expr&quot;</span></span><br><span class="line">  opt.foldtext = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  opt.foldmethod = <span class="string">&quot;indent&quot;</span></span><br><span class="line">  opt.foldtext = <span class="string">&quot;v:lua.require&#x27;lazyvim.util&#x27;.ui.foldtext()&quot;</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- Fix markdown indentation settings</span></span><br><span class="line">vim.g.markdown_recommended_style = <span class="number">0</span></span><br></pre></td></tr></table></figure><p>è‡ªå®šä¹‰çš„ä¸€äº›keymapå¦‚ä¸‹</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- This file is automatically loaded by lazyvim.config.init</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- DO NOT USE `LazyVim.safe_keymap_set` IN YOUR OWN CONFIG!!</span></span><br><span class="line"><span class="comment">-- use `vim.keymap.set` instead</span></span><br><span class="line"><span class="keyword">local</span> map = LazyVim.safe_keymap_set</span><br><span class="line"></span><br><span class="line"><span class="comment">-- better up/down</span></span><br><span class="line">map(&#123; <span class="string">&quot;n&quot;</span>, <span class="string">&quot;x&quot;</span> &#125;, <span class="string">&quot;j&quot;</span>, <span class="string">&quot;v:count == 0 ? &#x27;gj&#x27; : &#x27;j&#x27;&quot;</span>, &#123; desc = <span class="string">&quot;Down&quot;</span>, expr = <span class="literal">true</span>, silent = <span class="literal">true</span> &#125;)</span><br><span class="line">map(&#123; <span class="string">&quot;n&quot;</span>, <span class="string">&quot;x&quot;</span> &#125;, <span class="string">&quot;&lt;Down&gt;&quot;</span>, <span class="string">&quot;v:count == 0 ? &#x27;gj&#x27; : &#x27;j&#x27;&quot;</span>, &#123; desc = <span class="string">&quot;Down&quot;</span>, expr = <span class="literal">true</span>, silent = <span class="literal">true</span> &#125;)</span><br><span class="line">map(&#123; <span class="string">&quot;n&quot;</span>, <span class="string">&quot;x&quot;</span> &#125;, <span class="string">&quot;k&quot;</span>, <span class="string">&quot;v:count == 0 ? &#x27;gk&#x27; : &#x27;k&#x27;&quot;</span>, &#123; desc = <span class="string">&quot;Up&quot;</span>, expr = <span class="literal">true</span>, silent = <span class="literal">true</span> &#125;)</span><br><span class="line">map(&#123; <span class="string">&quot;n&quot;</span>, <span class="string">&quot;x&quot;</span> &#125;, <span class="string">&quot;&lt;Up&gt;&quot;</span>, <span class="string">&quot;v:count == 0 ? &#x27;gk&#x27; : &#x27;k&#x27;&quot;</span>, &#123; desc = <span class="string">&quot;Up&quot;</span>, expr = <span class="literal">true</span>, silent = <span class="literal">true</span> &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- Move to window using the &lt;ctrl&gt; hjkl keys</span></span><br><span class="line">map(<span class="string">&quot;n&quot;</span>, <span class="string">&quot;&lt;C-h&gt;&quot;</span>, <span class="string">&quot;&lt;C-w&gt;h&quot;</span>, &#123; desc = <span class="string">&quot;Go to Left Window&quot;</span>, remap = <span class="literal">true</span> &#125;)</span><br><span class="line">map(<span class="string">&quot;n&quot;</span>, <span class="string">&quot;&lt;C-j&gt;&quot;</span>, <span class="string">&quot;&lt;C-w&gt;j&quot;</span>, &#123; desc = <span class="string">&quot;Go to Lower Window&quot;</span>, remap = <span class="literal">true</span> &#125;)</span><br><span class="line">map(<span class="string">&quot;n&quot;</span>, <span class="string">&quot;&lt;C-k&gt;&quot;</span>, <span class="string">&quot;&lt;C-w&gt;k&quot;</span>, &#123; desc = <span class="string">&quot;Go to Upper Window&quot;</span>, remap = <span class="literal">true</span> &#125;)</span><br><span class="line">map(<span class="string">&quot;n&quot;</span>, <span class="string">&quot;&lt;C-l&gt;&quot;</span>, <span class="string">&quot;&lt;C-w&gt;l&quot;</span>, &#123; desc = <span class="string">&quot;Go to Right Window&quot;</span>, remap = <span class="literal">true</span> &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- Resize window using &lt;ctrl&gt; arrow keys</span></span><br><span class="line">map(<span class="string">&quot;n&quot;</span>, <span class="string">&quot;&lt;C-Up&gt;&quot;</span>, <span class="string">&quot;&lt;cmd&gt;resize +2&lt;cr&gt;&quot;</span>, &#123; desc = <span class="string">&quot;Increase Window Height&quot;</span> &#125;)</span><br><span class="line">map(<span class="string">&quot;n&quot;</span>, <span class="string">&quot;&lt;C-Down&gt;&quot;</span>, <span class="string">&quot;&lt;cmd&gt;resize -2&lt;cr&gt;&quot;</span>, &#123; desc = <span class="string">&quot;Decrease Window Height&quot;</span> &#125;)</span><br><span class="line">map(<span class="string">&quot;n&quot;</span>, <span class="string">&quot;&lt;C-Left&gt;&quot;</span>, <span class="string">&quot;&lt;cmd&gt;vertical resize -2&lt;cr&gt;&quot;</span>, &#123; desc = <span class="string">&quot;Decrease Window Width&quot;</span> &#125;)</span><br><span class="line">map(<span class="string">&quot;n&quot;</span>, <span class="string">&quot;&lt;C-Right&gt;&quot;</span>, <span class="string">&quot;&lt;cmd&gt;vertical resize +2&lt;cr&gt;&quot;</span>, &#123; desc = <span class="string">&quot;Increase Window Width&quot;</span> &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- Move Lines</span></span><br><span class="line">map(<span class="string">&quot;n&quot;</span>, <span class="string">&quot;&lt;A-j&gt;&quot;</span>, <span class="string">&quot;&lt;cmd&gt;m .+1&lt;cr&gt;==&quot;</span>, &#123; desc = <span class="string">&quot;Move Down&quot;</span> &#125;)</span><br><span class="line">map(<span class="string">&quot;n&quot;</span>, <span class="string">&quot;&lt;A-k&gt;&quot;</span>, <span class="string">&quot;&lt;cmd&gt;m .-2&lt;cr&gt;==&quot;</span>, &#123; desc = <span class="string">&quot;Move Up&quot;</span> &#125;)</span><br><span class="line">map(<span class="string">&quot;i&quot;</span>, <span class="string">&quot;&lt;A-j&gt;&quot;</span>, <span class="string">&quot;&lt;esc&gt;&lt;cmd&gt;m .+1&lt;cr&gt;==gi&quot;</span>, &#123; desc = <span class="string">&quot;Move Down&quot;</span> &#125;)</span><br><span class="line">map(<span class="string">&quot;i&quot;</span>, <span class="string">&quot;&lt;A-k&gt;&quot;</span>, <span class="string">&quot;&lt;esc&gt;&lt;cmd&gt;m .-2&lt;cr&gt;==gi&quot;</span>, &#123; desc = <span class="string">&quot;Move Up&quot;</span> &#125;)</span><br><span class="line">map(<span class="string">&quot;v&quot;</span>, <span class="string">&quot;&lt;A-j&gt;&quot;</span>, <span class="string">&quot;:m &#x27;&gt;+1&lt;cr&gt;gv=gv&quot;</span>, &#123; desc = <span class="string">&quot;Move Down&quot;</span> &#125;)</span><br><span class="line">map(<span class="string">&quot;v&quot;</span>, <span class="string">&quot;&lt;A-k&gt;&quot;</span>, <span class="string">&quot;:m &#x27;&lt;-2&lt;cr&gt;gv=gv&quot;</span>, &#123; desc = <span class="string">&quot;Move Up&quot;</span> &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- buffers</span></span><br><span class="line">map(<span class="string">&quot;n&quot;</span>, <span class="string">&quot;&lt;S-h&gt;&quot;</span>, <span class="string">&quot;&lt;cmd&gt;bprevious&lt;cr&gt;&quot;</span>, &#123; desc = <span class="string">&quot;Prev Buffer&quot;</span> &#125;)</span><br><span class="line">map(<span class="string">&quot;n&quot;</span>, <span class="string">&quot;&lt;S-l&gt;&quot;</span>, <span class="string">&quot;&lt;cmd&gt;bnext&lt;cr&gt;&quot;</span>, &#123; desc = <span class="string">&quot;Next Buffer&quot;</span> &#125;)</span><br><span class="line">map(<span class="string">&quot;n&quot;</span>, <span class="string">&quot;[b&quot;</span>, <span class="string">&quot;&lt;cmd&gt;bprevious&lt;cr&gt;&quot;</span>, &#123; desc = <span class="string">&quot;Prev Buffer&quot;</span> &#125;)</span><br><span class="line">map(<span class="string">&quot;n&quot;</span>, <span class="string">&quot;]b&quot;</span>, <span class="string">&quot;&lt;cmd&gt;bnext&lt;cr&gt;&quot;</span>, &#123; desc = <span class="string">&quot;Next Buffer&quot;</span> &#125;)</span><br><span class="line">map(<span class="string">&quot;n&quot;</span>, <span class="string">&quot;&lt;leader&gt;bb&quot;</span>, <span class="string">&quot;&lt;cmd&gt;e #&lt;cr&gt;&quot;</span>, &#123; desc = <span class="string">&quot;Switch to Other Buffer&quot;</span> &#125;)</span><br><span class="line">map(<span class="string">&quot;n&quot;</span>, <span class="string">&quot;&lt;leader&gt;`&quot;</span>, <span class="string">&quot;&lt;cmd&gt;e #&lt;cr&gt;&quot;</span>, &#123; desc = <span class="string">&quot;Switch to Other Buffer&quot;</span> &#125;)</span><br><span class="line">map(<span class="string">&quot;n&quot;</span>, <span class="string">&quot;&lt;leader&gt;bd&quot;</span>, LazyVim.ui.bufremove, &#123; desc = <span class="string">&quot;Delete Buffer&quot;</span> &#125;)</span><br><span class="line">map(<span class="string">&quot;n&quot;</span>, <span class="string">&quot;&lt;leader&gt;bD&quot;</span>, <span class="string">&quot;&lt;cmd&gt;:bd&lt;cr&gt;&quot;</span>, &#123; desc = <span class="string">&quot;Delete Buffer and Window&quot;</span> &#125;)</span><br><span class="line">....</span><br></pre></td></tr></table></figure><p><code>autocmd.lua</code>å¦‚ä¸‹</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- This file is automatically loaded by lazyvim.config.init.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">augroup</span><span class="params">(name)</span></span></span><br><span class="line">  <span class="keyword">return</span> vim.api.nvim_create_augroup(<span class="string">&quot;lazyvim_&quot;</span> .. name, &#123; clear = <span class="literal">true</span> &#125;)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- Check if we need to reload the file when it changed</span></span><br><span class="line">vim.api.nvim_create_autocmd(&#123; <span class="string">&quot;FocusGained&quot;</span>, <span class="string">&quot;TermClose&quot;</span>, <span class="string">&quot;TermLeave&quot;</span> &#125;, &#123;</span><br><span class="line">  group = augroup(<span class="string">&quot;checktime&quot;</span>),</span><br><span class="line">  callback = <span class="function"><span class="keyword">function</span><span class="params">()</span></span></span><br><span class="line">    <span class="keyword">if</span> vim.o.buftype ~= <span class="string">&quot;nofile&quot;</span> <span class="keyword">then</span></span><br><span class="line">      vim.cmd(<span class="string">&quot;checktime&quot;</span>)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span>,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- Highlight on yank</span></span><br><span class="line">vim.api.nvim_create_autocmd(<span class="string">&quot;TextYankPost&quot;</span>, &#123;</span><br><span class="line">  group = augroup(<span class="string">&quot;highlight_yank&quot;</span>),</span><br><span class="line">  callback = <span class="function"><span class="keyword">function</span><span class="params">()</span></span></span><br><span class="line">    vim.highlight.on_yank()</span><br><span class="line">  <span class="keyword">end</span>,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- resize splits if window got resized</span></span><br><span class="line">vim.api.nvim_create_autocmd(&#123; <span class="string">&quot;VimResized&quot;</span> &#125;, &#123;</span><br><span class="line">  group = augroup(<span class="string">&quot;resize_splits&quot;</span>),</span><br><span class="line">  callback = <span class="function"><span class="keyword">function</span><span class="params">()</span></span></span><br><span class="line">    <span class="keyword">local</span> current_tab = vim.fn.tabpagenr()</span><br><span class="line">    vim.cmd(<span class="string">&quot;tabdo wincmd =&quot;</span>)</span><br><span class="line">    vim.cmd(<span class="string">&quot;tabnext &quot;</span> .. current_tab)</span><br><span class="line">  <span class="keyword">end</span>,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- go to last loc when opening a buffer</span></span><br><span class="line">vim.api.nvim_create_autocmd(<span class="string">&quot;BufReadPost&quot;</span>, &#123;</span><br><span class="line">  group = augroup(<span class="string">&quot;last_loc&quot;</span>),</span><br><span class="line">  callback = <span class="function"><span class="keyword">function</span><span class="params">(event)</span></span></span><br><span class="line">    <span class="keyword">local</span> exclude = &#123; <span class="string">&quot;gitcommit&quot;</span> &#125;</span><br><span class="line">    <span class="keyword">local</span> buf = event.buf</span><br><span class="line">    <span class="keyword">if</span> vim.tbl_contains(exclude, vim.bo[buf].filetype) <span class="keyword">or</span> vim.b[buf].lazyvim_last_loc <span class="keyword">then</span></span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    vim.b[buf].lazyvim_last_loc = <span class="literal">true</span></span><br><span class="line">    <span class="keyword">local</span> mark = vim.api.nvim_buf_get_mark(buf, <span class="string">&#x27;&quot;&#x27;</span>)</span><br><span class="line">    <span class="keyword">local</span> lcount = vim.api.nvim_buf_line_count(buf)</span><br><span class="line">    <span class="keyword">if</span> mark[<span class="number">1</span>] &gt; <span class="number">0</span> <span class="keyword">and</span> mark[<span class="number">1</span>] &lt;= lcount <span class="keyword">then</span></span><br><span class="line">      <span class="built_in">pcall</span>(vim.api.nvim_win_set_cursor, <span class="number">0</span>, mark)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span>,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- close some filetypes with &lt;q&gt;</span></span><br><span class="line">vim.api.nvim_create_autocmd(<span class="string">&quot;FileType&quot;</span>, &#123;</span><br><span class="line">  group = augroup(<span class="string">&quot;close_with_q&quot;</span>),</span><br><span class="line">  pattern = &#123;</span><br><span class="line">    <span class="string">&quot;PlenaryTestPopup&quot;</span>,</span><br><span class="line">    <span class="string">&quot;help&quot;</span>,</span><br><span class="line">    <span class="string">&quot;lspinfo&quot;</span>,</span><br><span class="line">    <span class="string">&quot;notify&quot;</span>,</span><br><span class="line">    <span class="string">&quot;qf&quot;</span>,</span><br><span class="line">    <span class="string">&quot;spectre_panel&quot;</span>,</span><br><span class="line">    <span class="string">&quot;startuptime&quot;</span>,</span><br><span class="line">    <span class="string">&quot;tsplayground&quot;</span>,</span><br><span class="line">    <span class="string">&quot;neotest-output&quot;</span>,</span><br><span class="line">    <span class="string">&quot;checkhealth&quot;</span>,</span><br><span class="line">    <span class="string">&quot;neotest-summary&quot;</span>,</span><br><span class="line">    <span class="string">&quot;neotest-output-panel&quot;</span>,</span><br><span class="line">    <span class="string">&quot;dbout&quot;</span>,</span><br><span class="line">    <span class="string">&quot;gitsigns.blame&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  callback = <span class="function"><span class="keyword">function</span><span class="params">(event)</span></span></span><br><span class="line">    vim.bo[event.buf].buflisted = <span class="literal">false</span></span><br><span class="line">    vim.keymap.set(<span class="string">&quot;n&quot;</span>, <span class="string">&quot;q&quot;</span>, <span class="string">&quot;&lt;cmd&gt;close&lt;cr&gt;&quot;</span>, &#123; buffer = event.buf, silent = <span class="literal">true</span> &#125;)</span><br><span class="line">  <span class="keyword">end</span>,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- make it easier to close man-files when opened inline</span></span><br><span class="line">vim.api.nvim_create_autocmd(<span class="string">&quot;FileType&quot;</span>, &#123;</span><br><span class="line">  group = augroup(<span class="string">&quot;man_unlisted&quot;</span>),</span><br><span class="line">  pattern = &#123; <span class="string">&quot;man&quot;</span> &#125;,</span><br><span class="line">  callback = <span class="function"><span class="keyword">function</span><span class="params">(event)</span></span></span><br><span class="line">    vim.bo[event.buf].buflisted = <span class="literal">false</span></span><br><span class="line">  <span class="keyword">end</span>,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- wrap and check for spell in text filetypes</span></span><br><span class="line">vim.api.nvim_create_autocmd(<span class="string">&quot;FileType&quot;</span>, &#123;</span><br><span class="line">  group = augroup(<span class="string">&quot;wrap_spell&quot;</span>),</span><br><span class="line">  pattern = &#123; <span class="string">&quot;*.txt&quot;</span>, <span class="string">&quot;*.tex&quot;</span>, <span class="string">&quot;*.typ&quot;</span>, <span class="string">&quot;gitcommit&quot;</span>, <span class="string">&quot;markdown&quot;</span> &#125;,</span><br><span class="line">  callback = <span class="function"><span class="keyword">function</span><span class="params">()</span></span></span><br><span class="line">    vim.opt_local.<span class="built_in">wrap</span> = <span class="literal">true</span></span><br><span class="line">    vim.opt_local.spell = <span class="literal">true</span></span><br><span class="line">  <span class="keyword">end</span>,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- Fix conceallevel for json files</span></span><br><span class="line">vim.api.nvim_create_autocmd(&#123; <span class="string">&quot;FileType&quot;</span> &#125;, &#123;</span><br><span class="line">  group = augroup(<span class="string">&quot;json_conceal&quot;</span>),</span><br><span class="line">  pattern = &#123; <span class="string">&quot;json&quot;</span>, <span class="string">&quot;jsonc&quot;</span>, <span class="string">&quot;json5&quot;</span> &#125;,</span><br><span class="line">  callback = <span class="function"><span class="keyword">function</span><span class="params">()</span></span></span><br><span class="line">    vim.opt_local.conceallevel = <span class="number">0</span></span><br><span class="line">  <span class="keyword">end</span>,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- Auto create dir when saving a file, in case some intermediate directory does not exist</span></span><br><span class="line">vim.api.nvim_create_autocmd(&#123; <span class="string">&quot;BufWritePre&quot;</span> &#125;, &#123;</span><br><span class="line">  group = augroup(<span class="string">&quot;auto_create_dir&quot;</span>),</span><br><span class="line">  callback = <span class="function"><span class="keyword">function</span><span class="params">(event)</span></span></span><br><span class="line">    <span class="keyword">if</span> event.<span class="built_in">match</span>:<span class="built_in">match</span>(<span class="string">&quot;^%w%w+:[\\/][\\/]&quot;</span>) <span class="keyword">then</span></span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">local</span> file = vim.uv.fs_realpath(event.<span class="built_in">match</span>) <span class="keyword">or</span> event.<span class="built_in">match</span></span><br><span class="line">    vim.fn.mkdir(vim.fn.fnamemodify(file, <span class="string">&quot;:p:h&quot;</span>), <span class="string">&quot;p&quot;</span>)</span><br><span class="line">  <span class="keyword">end</span>,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">vim.filetype.add(&#123;</span><br><span class="line">  pattern = &#123;</span><br><span class="line">    [<span class="string">&quot;.*&quot;</span>] = &#123;</span><br><span class="line">      <span class="function"><span class="keyword">function</span><span class="params">(path, buf)</span></span></span><br><span class="line">        <span class="keyword">return</span> vim.bo[buf]</span><br><span class="line">            <span class="keyword">and</span> vim.bo[buf].filetype ~= <span class="string">&quot;bigfile&quot;</span></span><br><span class="line">            <span class="keyword">and</span> <span class="built_in">path</span></span><br><span class="line">            <span class="keyword">and</span> vim.fn.getfsize(<span class="built_in">path</span>) &gt; vim.g.bigfile_size</span><br><span class="line">            <span class="keyword">and</span> <span class="string">&quot;bigfile&quot;</span></span><br><span class="line">          <span class="keyword">or</span> <span class="literal">nil</span></span><br><span class="line">      <span class="keyword">end</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">vim.api.nvim_create_autocmd(&#123; <span class="string">&quot;FileType&quot;</span> &#125;, &#123;</span><br><span class="line">  group = augroup(<span class="string">&quot;bigfile&quot;</span>),</span><br><span class="line">  pattern = <span class="string">&quot;bigfile&quot;</span>,</span><br><span class="line">  callback = <span class="function"><span class="keyword">function</span><span class="params">(ev)</span></span></span><br><span class="line">    vim.b.minianimate_disable = <span class="literal">true</span></span><br><span class="line">    vim.schedule(<span class="function"><span class="keyword">function</span><span class="params">()</span></span></span><br><span class="line">      vim.bo[ev.buf].syntax = vim.filetype.<span class="built_in">match</span>(&#123; buf = ev.buf &#125;) <span class="keyword">or</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">end</span>)</span><br><span class="line">  <span class="keyword">end</span>,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>å¦‚æœä½ æƒ³å­¦ä¹ vim,å¯ä»¥é€šè¿‡vim tutoræˆ–è€…åœ¨çº¿çš„vim adventureç»ƒä¹ .</p><h3 id="Alacritty"><a href="#Alacritty" class="headerlink" title="Alacritty"></a>Alacritty</h3><p>GPUåŠ é€Ÿçš„ç»ˆç«¯æ¨¡æ‹Ÿå™¨,ä¿æŒäº†æœ€å°çš„æ ¸å¿ƒåŠŸèƒ½,æ²¡æœ‰çª—å£åˆ†å‰²ç­‰(å¦‚æœæƒ³è¦æ›´å¤šåŠŸèƒ½,è€ƒè™‘ä½¿ç”¨wezterm,é…ç½®ä½¿ç”¨lua).</p><p>Alacrittyçš„é…ç½®éå¸¸è½»æ¾,ä½¿ç”¨.toml<a href="https://alacritty.org/config-alacritty.html">Alacritty</a></p><p>ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­</p><p><a href="https://github.com/TwiggieSmallz/Default-Alacritty-TOML-Config/blob/main/alacritty.toml">Default-Alacritty-TOML-Config/alacritty.toml at main Â· TwiggieSmallz/Default-Alacritty-TOML-Config (github.com)</a></p><figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[font]</span></span><br><span class="line"><span class="attr">size</span> = <span class="number">12.0</span></span><br><span class="line"></span><br><span class="line"><span class="section">[font.bold]</span></span><br><span class="line"><span class="attr">family</span> = <span class="string">&quot;monospace&quot;</span></span><br><span class="line"><span class="attr">style</span> = <span class="string">&quot;Bold&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="section">[font.bold_italic]</span></span><br><span class="line"><span class="attr">family</span> = <span class="string">&quot;monospace&quot;</span></span><br><span class="line"><span class="attr">style</span> = <span class="string">&quot;Bold Italic&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="section">[font.italic]</span></span><br><span class="line"><span class="attr">family</span> = <span class="string">&quot;monospace&quot;</span></span><br><span class="line"><span class="attr">style</span> = <span class="string">&quot;Italic&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="section">[font.normal]</span></span><br><span class="line"><span class="attr">family</span> = <span class="string">&quot;monospace&quot;</span></span><br><span class="line"><span class="attr">style</span> = <span class="string">&quot;Regular&quot;</span></span><br></pre></td></tr></table></figure><h3 id="åè¨€"><a href="#åè¨€" class="headerlink" title="åè¨€"></a>åè¨€</h3><p>å¦‚æœä½ æƒ³geekä¸€ç‚¹,ä½¿ç”¨archçš„æ–‡æ¡£ä»¥åŠå¸¸ç”¨çš„è½¯ä»¶<a href="https://wiki.archlinux.org/">ArchWiki (archlinux.org)</a>å’Œ<a href="https://github.com/ihchiz/Awesome-Linux-Software-zh_CN#çª—å£ç®¡ç†">ihchiz/Awesome-Linux-Software-zh_CN: ğŸ§ ä¸€ä¸ª Linux ä¸Šè¶…èµçš„åº”ç”¨ï¼Œè½¯ä»¶ï¼Œå·¥å…·ä»¥åŠå…¶å®ƒèµ„æºçš„é›†ä¸­åœ°ã€‚ (github.com)</a>,ä¸‹è½½å’Œä½¿ç”¨è¿™ç±»è½¯ä»¶éå¸¸å…¨é¢å’Œæ–¹ä¾¿. </p><p>ä¹Ÿå¯ä»¥çœ‹çœ‹æˆ‘ä»‹ç»çš„ä¸€äº›æ—¥å¸¸å¼€å‘setup<a href="https://protool-ten.vercel.app/setup/setup.html">protools (protool-ten.vercel.app)</a></p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;p&gt;å¸¸ç”¨çš„çª—å£ç®¡ç†å™¨,ç¼–è¾‘å™¨ä¸ç»ˆç«¯æ¨¡æ‹Ÿå™¨ç­‰ç­‰&lt;br&gt;</summary>
    
    
    
    
    <category term="setup" scheme="https://www.sekyoro.top/tags/setup/"/>
    
  </entry>
  
  <entry>
    <title>åä½œæ„ŸçŸ¥ç®—æ³•:ä¸‰</title>
    <link href="https://www.sekyoro.top/2024/06/30/%E5%8D%8F%E4%BD%9C%E6%84%9F%E7%9F%A5%E7%AE%97%E6%B3%95-%E4%B8%89/"/>
    <id>https://www.sekyoro.top/2024/06/30/%E5%8D%8F%E4%BD%9C%E6%84%9F%E7%9F%A5%E7%AE%97%E6%B3%95-%E4%B8%89/</id>
    <published>2024-06-30T05:46:08.000Z</published>
    <updated>2024-07-02T15:00:30.751Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>ä¸€äº›ç¨å¾®æ–°ä¸€ç‚¹æˆ–è€…ä¹‹å‰æ²¡çœ‹åˆ°çš„æƒ³æ³•è¿˜ä¸é”™çš„ååŒæ„ŸçŸ¥è®ºæ–‡<br><span id="more"></span></p><h2 id="æ™šæœŸå’Œä¸­æœŸååŒèåˆæ„ŸçŸ¥"><a href="#æ™šæœŸå’Œä¸­æœŸååŒèåˆæ„ŸçŸ¥" class="headerlink" title="æ™šæœŸå’Œä¸­æœŸååŒèåˆæ„ŸçŸ¥"></a>æ™šæœŸå’Œä¸­æœŸååŒèåˆæ„ŸçŸ¥</h2><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ol><li><a href="https://github.com/CatOneTwo/Collaborative-Perception-in-Autonomous-Driving/tree/main?tab=readme-ov-file">CatOneTwo/Collaborative-Perception-in-Autonomous-Driving: (2023 ITSM) Collaborative Perception in Autonomous Driving: Methods, Datasets and Challenges (github.com)</a></li></ol><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;p&gt;ä¸€äº›ç¨å¾®æ–°ä¸€ç‚¹æˆ–è€…ä¹‹å‰æ²¡çœ‹åˆ°çš„æƒ³æ³•è¿˜ä¸é”™çš„ååŒæ„ŸçŸ¥è®ºæ–‡&lt;br&gt;</summary>
    
    
    
    
    <category term="collaborative perception" scheme="https://www.sekyoro.top/tags/collaborative-perception/"/>
    
  </entry>
  
  <entry>
    <title>Rust learning:from germ to grave</title>
    <link href="https://www.sekyoro.top/2024/06/29/Rust-learning-from-germ-to-grave/"/>
    <id>https://www.sekyoro.top/2024/06/29/Rust-learning-from-germ-to-grave/</id>
    <published>2024-06-29T04:51:24.000Z</published>
    <updated>2024-06-29T14:41:54.273Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>Rustå®˜æ–¹æ¨èçš„ä¸‰ä¸ªèµ„æ–™,åˆ†åˆ«æ˜¯The Rust programming language,Rust by examplesä»¥åŠruslings,å·²ç»ç›¸å½“å……è¶³äº†.åŒ…æ‹¬ç›¸å¯¹å…¨é¢çš„ä¹¦,ä»£ç ä¾‹å­ä»¥åŠæ–¹ä¾¿çš„äº’åŠ¨å¼exercises.ä¸ªäººè§‰å¾—,the bookç›¸å½“äºå­—å…¸,è™½ç„¶å…¶å®è¿˜æœ‰å†…å®¹æ›´å¤šçš„reference,è€Œexamplesæ›´åŠ æ˜“æ‡‚ä¸Šæ‰‹,rustlingsç›¸å½“äºåˆ·é¢˜,æŠŠå…³é”®ä¸œè¥¿äº†è§£ä¸€é.</p><p>æ‰€ä»¥ä»è¿™ä¸‰ä¸ªä¸œè¥¿å…¥æ‰‹å¼€å§‹Rustå­¦ä¹ ä¹‹æ—…,ä¸€äº›åœ°æ–¹ä¼šè·Ÿc++å¯¹æ¯”.<br><span id="more"></span></p><h3 id="å®macro"><a href="#å®macro" class="headerlink" title="å®macro"></a>å®macro</h3><h3 id="å˜é‡binding"><a href="#å˜é‡binding" class="headerlink" title="å˜é‡binding"></a>å˜é‡binding</h3><p>çŸ¥è¯†ç‚¹:</p><ol><li>ä¸å˜æ€§ Rusté»˜è®¤ä¸å¯å˜,ä¸åƒc++åˆ°å¤„å£°æ˜const</li><li>scopeå’Œshadowing ä¸»è¦æœ‰variable shadowing,ä¹Ÿå°±æ˜¯å¯ä»¥é‡å£°æ˜,åœ¨c++ä¸­ä¸å…è®¸</li><li>å°†ä¸€ä¸ªmutçš„å€¼èµ‹å€¼ç»™non-mutçš„å€¼,åœ¨é‚£ä¸ªåŸŸå†…,non-muteçš„å€¼ä¹Ÿä¸èƒ½è¢«æ”¹å˜</li></ol><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut</span> x = <span class="number">3</span>;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Number &#123;&#125;&quot;</span>, x);</span><br><span class="line">    x = <span class="number">5</span>; </span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Number &#123;&#125;&quot;</span>, x);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> number = <span class="string">&quot;T-H-R-E-E&quot;</span>; <span class="comment">// don&#x27;t change this line</span></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Spell a Number : &#123;&#125;&quot;</span>, number);</span><br><span class="line">    <span class="keyword">let</span> number = <span class="number">3</span>; <span class="comment">// don&#x27;t rename this variable</span></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Number plus two is : &#123;&#125;&quot;</span>, number + <span class="number">2</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut</span> _mutable_integer = <span class="number">7i32</span>;</span><br><span class="line"></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// Shadowing by immutable `_mutable_integer`</span></span><br><span class="line">        <span class="keyword">let</span> <span class="keyword">mut</span> _mutable_integer = _mutable_integer;</span><br><span class="line">        </span><br><span class="line">        _mutable_integer = <span class="number">50</span>;</span><br><span class="line">       </span><br><span class="line">        <span class="comment">// `_mutable_integer` goes out of scope</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Ok! `_mutable_integer` is not frozen in this scope</span></span><br><span class="line">    _mutable_integer = <span class="number">3</span>;</span><br></pre></td></tr></table></figure><h3 id="Primitives"><a href="#Primitives" class="headerlink" title="Primitives"></a>Primitives</h3><h4 id="å­—é¢é‡å’Œæ“ä½œç¬¦"><a href="#å­—é¢é‡å’Œæ“ä½œç¬¦" class="headerlink" title="å­—é¢é‡å’Œæ“ä½œç¬¦"></a>å­—é¢é‡å’Œæ“ä½œç¬¦</h4><ol><li>æ¨èåœ¨ä½¿ç”¨å­—é¢é‡æ˜¯åé¢åŠ ä¸Šç±»å‹.</li><li>åŸç”Ÿç±»å‹æœ¬èº«å¯ä»¥printable</li></ol><p>å…ƒç»„ã€æ•°ç»„ä¸slices. </p><p>å…ƒç»„,é€šè¿‡()è¡¨ç¤º,é€šè¿‡.numç´¢å¼•,å¯ä»¥ä½¿ç”¨#[derive(Debug)]å®ç°æ–¹æ³•æ‰“å°.</p><p>æ•°ç»„ [T;length]å£°æ˜,ç¼–è¯‘æ—¶å·²çŸ¥.</p><p>åˆ‡ç‰‡(Slices)ä¸æ•°ç»„ç±»ä¼¼,ä½†å®ƒä»¬çš„é•¿åº¦åœ¨ç¼–è¯‘æ—¶æ˜¯æœªçŸ¥çš„ã€‚ç›¸å,åˆ‡ç‰‡æ˜¯ä¸€ä¸ªç”±ä¸¤ä¸ªå­—(word)ç»„æˆçš„å¯¹è±¡:ç¬¬ä¸€ä¸ªå­—æ˜¯æŒ‡å‘æ•°æ®çš„æŒ‡é’ˆ,ç¬¬äºŒä¸ªå­—æ˜¯åˆ‡ç‰‡çš„é•¿åº¦ã€‚å­—çš„å¤§å°ä¸ <code>usize</code> ç±»å‹ç›¸åŒ,ç”±å¤„ç†å™¨æ¶æ„å†³å®š,ä¾‹å¦‚åœ¨ x86-64 ä¸Šä¸º 64 ä½ã€‚åˆ‡ç‰‡å¯ç”¨äºå€Ÿç”¨æ•°ç»„çš„ä¸€éƒ¨åˆ†,å®ƒçš„ç±»å‹ç­¾åä¸º <code>&amp;[T]</code>ã€‚</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// This function borrows a slice.</span></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">analyze_slice</span></span>(slice: &amp;[<span class="built_in">i32</span>]) &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;First element of the slice: &#123;&#125;&quot;</span>, slice[<span class="number">0</span>]);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;The slice has &#123;&#125; elements&quot;</span>, slice.len());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> xs: [<span class="built_in">i32</span>; <span class="number">5</span>] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>];</span><br><span class="line"><span class="comment">// All elements can be initialized to the same value.</span></span><br><span class="line"><span class="keyword">let</span> ys: [<span class="built_in">i32</span>; <span class="number">500</span>] = [<span class="number">0</span>; <span class="number">500</span>];</span><br><span class="line"><span class="built_in">println!</span>(<span class="string">&quot;Borrow the whole array as a slice.&quot;</span>);</span><br><span class="line">analyze_slice(&amp;xs);</span><br></pre></td></tr></table></figure><h3 id="è‡ªå®šä¹‰ç±»å‹"><a href="#è‡ªå®šä¹‰ç±»å‹" class="headerlink" title="è‡ªå®šä¹‰ç±»å‹"></a>è‡ªå®šä¹‰ç±»å‹</h3><h4 id="structures"><a href="#structures" class="headerlink" title="structures"></a>structures</h4><p>ä½¿ç”¨ <code>struct</code> å…³é”®å­—å¯ä»¥åˆ›å»ºä¸‰ç§ç±»å‹çš„ç»“æ„ä½“(struct):</p><ol><li>å…ƒç»„ç»“æ„ä½“(Tuple structs)ï¼ŒåŸºæœ¬ä¸Šæ˜¯å‘½åå…ƒç»„ã€‚</li><li>ç»å…¸çš„ C é£æ ¼ç»“æ„ä½“ã€‚</li><li>æ— å­—æ®µçš„å•å…ƒç»“æ„ä½“(Unit structs)ï¼Œåœ¨æ³›å‹ç¼–ç¨‹ä¸­å¾ˆæœ‰ç”¨ã€‚</li></ol><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[derive(Debug)]</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Person</span></span> &#123;</span><br><span class="line">    name: <span class="built_in">String</span>,</span><br><span class="line">    age: <span class="built_in">u8</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// A unit struct</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Unit</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// A tuple struct</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Pair</span></span>(<span class="built_in">i32</span>, <span class="built_in">f32</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// A struct with two fields</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Point</span></span> &#123;</span><br><span class="line">    x: <span class="built_in">f32</span>,</span><br><span class="line">    y: <span class="built_in">f32</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// A tuple struct</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Pair</span></span>(<span class="built_in">i32</span>, <span class="built_in">f32</span>);</span><br><span class="line"><span class="comment">// Instantiate a tuple struct</span></span><br><span class="line"><span class="keyword">let</span> pair = Pair(<span class="number">1</span>, <span class="number">0.1</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Access the fields of a tuple struct</span></span><br><span class="line"><span class="built_in">println!</span>(<span class="string">&quot;pair contains &#123;:?&#125; and &#123;:?&#125;&quot;</span>, pair.<span class="number">0</span>, pair.<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Destructure a tuple struct</span></span><br><span class="line"><span class="keyword">let</span> Pair(integer, decimal) = pair;</span><br></pre></td></tr></table></figure><h4 id="Enums"><a href="#Enums" class="headerlink" title="Enums"></a>Enums</h4><p><code>enum</code>å…³é”®å­—å…è®¸åˆ›å»ºä¸€ä¸ªå¯ä»¥æ˜¯å‡ ç§ä¸åŒå˜ä½“(variant)ä¹‹ä¸€çš„ç±»å‹ã€‚ä»»ä½•åœ¨ç»“æ„ä½“(struct)ä¸­æœ‰æ•ˆçš„å˜ä½“,åœ¨æšä¸¾(enum)ä¸­ä¹Ÿæ˜¯æœ‰æ•ˆçš„ã€‚</p><h4 id="constants"><a href="#constants" class="headerlink" title="constants"></a>constants</h4><p>Rust æœ‰ä¸¤ç§ä¸åŒç±»å‹çš„å¸¸é‡,å¯ä»¥åœ¨ä»»ä½•ä½œç”¨åŸŸ(åŒ…æ‹¬å…¨å±€)ä¸­å£°æ˜ã€‚ä¸¤ç§å¸¸é‡éƒ½éœ€è¦æ˜¾å¼çš„ç±»å‹æ³¨è§£:</p><ol><li><code>const</code>: ä¸å¯å˜çš„å€¼(æœ€å¸¸è§çš„æƒ…å†µ)ã€‚</li><li><code>static</code>: å¯èƒ½æ˜¯å¯å˜çš„å˜é‡,æ‹¥æœ‰ <code>&#39;static</code> ç”Ÿå‘½å‘¨æœŸã€‚<code>&#39;static</code> ç”Ÿå‘½å‘¨æœŸæ˜¯è¢«æ¨æ–­å‡ºæ¥çš„,ä¸éœ€è¦æ˜¾å¼æŒ‡å®šã€‚è®¿é—®æˆ–ä¿®æ”¹å¯å˜çš„ <code>static</code> å˜é‡æ˜¯ä¸å®‰å…¨çš„</li></ol><h3 id="åè®°"><a href="#åè®°" class="headerlink" title="åè®°"></a>åè®°</h3><p>ä½œä¸ºååº•å±‚çš„ç¼–ç¨‹è¯­è¨€,c/c++,rust,zigç­‰ç›®å‰éƒ½è¿˜åœ¨å‘å±•,å³ä½¿c++å·²è¿‡äº”åå¹´,ä½†C++2aä¸­Concepts,Modules,Coroutinesç­‰æ–°ç‰¹æ€§éƒ½ä¸æ–­å‡ºç°,æ‰€ä»¥è¿˜æ˜¯åœ°ä½ä»åœ¨çš„.è€Œåä¸¤è€…åœ¨å‰ç«¯å·¥å…·æ„å»ºä¸Šå‡å¤§æ˜¾èº«æ‰‹,æœŸå¾…åç»­å‘å±•.</p><p>æˆ‘ä¹Ÿå¾ˆå–œæ¬¢ä½¿ç”¨C/C++,Go,Rustç­‰å†™ä¸€äº›å°ç¨‹åºdemo.</p><h3 id="FYI"><a href="#FYI" class="headerlink" title="FYI"></a>FYI</h3><p>ä¸€äº›è¯­è¨€é«˜çº§ç‰¹æ€§</p><ol><li><a href="https://draveness.me/metaprogramming/">è°ˆå…ƒç¼–ç¨‹ä¸è¡¨è¾¾èƒ½åŠ› - é¢å‘ä¿¡ä»°ç¼–ç¨‹ (draveness.me)</a></li><li><a href="https://mirrors.tuna.tsinghua.edu.cn/tuna/tunight/2020-04-25-generics-and-metaprogramming/slides.pdf">ä»æ³›å‹ (Generics) åˆ°å…ƒç¼–ç¨‹ (Metaprogramming) (tsinghua.edu.cn)</a></li></ol><p><img data-src="https://s2.loli.net/2024/06/29/5tfZJquDxgvKros.png" alt="image-20240629202803323"></p><p><img data-src="https://s2.loli.net/2024/06/29/gZaJPSIc5sdzM91.png" alt="image-20240629202943879"></p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;p&gt;Rustå®˜æ–¹æ¨èçš„ä¸‰ä¸ªèµ„æ–™,åˆ†åˆ«æ˜¯The Rust programming language,Rust by examplesä»¥åŠruslings,å·²ç»ç›¸å½“å……è¶³äº†.åŒ…æ‹¬ç›¸å¯¹å…¨é¢çš„ä¹¦,ä»£ç ä¾‹å­ä»¥åŠæ–¹ä¾¿çš„äº’åŠ¨å¼exercises.ä¸ªäººè§‰å¾—,the bookç›¸å½“äºå­—å…¸,è™½ç„¶å…¶å®è¿˜æœ‰å†…å®¹æ›´å¤šçš„reference,è€Œexamplesæ›´åŠ æ˜“æ‡‚ä¸Šæ‰‹,rustlingsç›¸å½“äºåˆ·é¢˜,æŠŠå…³é”®ä¸œè¥¿äº†è§£ä¸€é.&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥ä»è¿™ä¸‰ä¸ªä¸œè¥¿å…¥æ‰‹å¼€å§‹Rustå­¦ä¹ ä¹‹æ—…,ä¸€äº›åœ°æ–¹ä¼šè·Ÿc++å¯¹æ¯”.&lt;br&gt;</summary>
    
    
    
    
    <category term="Rust" scheme="https://www.sekyoro.top/tags/Rust/"/>
    
  </entry>
  
  <entry>
    <title>ä¸åŒç¼–ç¨‹è¯­è¨€ä¹‹é—´çš„äº’æ“ä½œ</title>
    <link href="https://www.sekyoro.top/2024/06/25/%E4%B8%8D%E5%90%8C%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80%E4%B9%8B%E9%97%B4%E7%9A%84%E4%BA%92%E6%93%8D%E4%BD%9C/"/>
    <id>https://www.sekyoro.top/2024/06/25/%E4%B8%8D%E5%90%8C%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80%E4%B9%8B%E9%97%B4%E7%9A%84%E4%BA%92%E6%93%8D%E4%BD%9C/</id>
    <published>2024-06-25T02:55:48.000Z</published>
    <updated>2024-06-26T14:30:06.066Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>å½“é¡¹ç›®æ¯”è¾ƒå¤§æ¶‰åŠåˆ°å¤šé—¨ç¼–ç¨‹è¯­è¨€æ—¶ä¼šæœ‰è¿™ç§éœ€æ±‚.é€šå¸¸æ˜¯è¦æ±‚è°ƒç”¨C/C++ç­‰.<br>æŸäº›è¯­è¨€ä¹‹é—´ç›¸å¯¹æ¥è¯´è°ƒç”¨å°±æ¯”è¾ƒç®€å•,æ¯”å¦‚Goå’ŒC,Rustå’ŒCç­‰.ä½†æ˜¯å…¶ä»–è¯­è¨€ç›¸å¯¹æ¥è¯´å°±éº»çƒ¦äº†.æœ¬æ–‡ä¸»è¦æ¶‰åŠPython,JS,Javaå’ŒC/C+çš„äº’ç›¸è°ƒç”¨,ä»¥å¤‡ä¸æ—¶ä¹‹éœ€.</p><p>TL;DR:Pythonä½¿ç”¨pybind11,JSä½¿ç”¨emcc,Javaä½¿ç”¨JNI.<br><span id="more"></span></p><h2 id="Pythonå’ŒCæˆ–Cpp"><a href="#Pythonå’ŒCæˆ–Cpp" class="headerlink" title="Pythonå’ŒCæˆ–Cpp"></a>Pythonå’ŒCæˆ–Cpp</h2><h3 id="Pythonè°ƒç”¨C-Cpp"><a href="#Pythonè°ƒç”¨C-Cpp" class="headerlink" title="Pythonè°ƒç”¨C/Cpp"></a>Pythonè°ƒç”¨C/Cpp</h3><h4 id="Ctypes"><a href="#Ctypes" class="headerlink" title="Ctypes"></a>Ctypes</h4><p>ctypes æ˜¯Pythonçš„å¤–éƒ¨å‡½æ•°åº“ã€‚å®ƒæä¾›äº†ä¸ Cè¯­è¨€å…¼å®¹çš„æ•°æ®ç±»å‹ï¼Œå¹¶å…è®¸è°ƒç”¨ DLL æˆ–å…±äº«åº“ä¸­çš„å‡½æ•°ã€‚å¯ä½¿ç”¨è¯¥æ¨¡å—ä»¥çº¯ Python å½¢å¼å¯¹è¿™äº›åº“è¿›è¡Œå°è£…</p><p>å†™ä¸€ä¸ªcæ–‡ä»¶</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// func.c</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">func</span><span class="params">(<span class="keyword">int</span> a)</span></span>&#123;</span><br><span class="line"><span class="keyword">return</span> a*a;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¼–è¯‘æˆåŠ¨æ€åº“</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc func.c -fPIC -shared -std=c99 -o func.so</span><br></pre></td></tr></table></figure><blockquote><p>-fPIC ä½œç”¨äºç¼–è¯‘é˜¶æ®µï¼Œå‘Šè¯‰ç¼–è¯‘å™¨äº§ç”Ÿ<strong>ä¸ä½ç½®æ— å…³ä»£ç </strong>(Position-Independent Code)ï¼Œåˆ™äº§ç”Ÿçš„ä»£ç ä¸­ï¼Œæ²¡æœ‰ç»å¯¹åœ°å€ï¼Œå…¨éƒ¨ä½¿ç”¨ç›¸å¯¹åœ°å€ï¼Œæ•…è€Œä»£ç å¯ä»¥è¢«åŠ è½½å™¨åŠ è½½åˆ°å†…å­˜çš„ä»»æ„ä½ç½®ï¼Œéƒ½å¯ä»¥æ­£ç¡®çš„æ‰§è¡Œã€‚è¿™æ­£æ˜¯å…±äº«åº“æ‰€è¦æ±‚çš„ï¼Œå…±äº«åº“è¢«åŠ è½½æ—¶ï¼Œåœ¨å†…å­˜çš„ä½ç½®ä¸æ˜¯å›ºå®šçš„ã€‚</p></blockquote><p>å¾—åˆ°åŠ¨æ€åº“åå°±èƒ½ç›´æ¥è°ƒç”¨äº†,æ³¨æ„åœ¨windowsä¸Š(å…¶å®æŒ‡çš„æ˜¯ä½¿ç”¨MSVCç”Ÿæˆdll)éœ€è¦ä½¿ç”¨<code>ctypes.WinDLL</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> ctypes</span><br><span class="line"><span class="keyword">from</span> ctypes <span class="keyword">import</span> cdll</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    f = cdll.LoadLibrary(<span class="string">&quot;./func.so&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(f.func(<span class="number">99</span>))</span><br></pre></td></tr></table></figure><p>è¿™ç§æ–¹æ³•ç¼ºç‚¹æ˜¯æ˜¯èƒ½è°ƒç”¨ä¸€äº›å·²æœ‰çš„åŠ¨æ€åº“,ä¸”ä¸æ¶‰åŠå¤æ‚æ•°æ®ç»“æ„,åªèƒ½æ˜¯cè¯­è¨€.</p><h4 id="C-C-æ‰©å±•Python"><a href="#C-C-æ‰©å±•Python" class="headerlink" title="C/C++æ‰©å±•Python"></a>C/C++æ‰©å±•Python</h4><p>ä½¿ç”¨<code>Python.h</code>å¤´æ–‡ä»¶</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;Python.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> PY_MAJOR_VERSION &gt;= 3</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> PyInt_Check PyLong_Check</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> PyInt_AsLong PyLong_AsLong</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> PyObject* <span class="title">list_sum</span><span class="params">(PyObject *self, PyObject *args)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    PyObject *pList;</span><br><span class="line">    PyObject *pItem;</span><br><span class="line">    Py_ssize_t n = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> result = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(!PyArg_ParseTuple(args, <span class="string">&quot;O!&quot;</span>, &amp;PyList_Type, &amp;pList))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    n = PyList_Size(pList);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;n; i++) &#123;</span><br><span class="line">        pItem = PyList_GetItem(pList, i);</span><br><span class="line">        <span class="keyword">if</span>(!PyInt_Check(pItem)) &#123;</span><br><span class="line">            PyErr_SetString(PyExc_TypeError, <span class="string">&quot;list items must be integers.&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        result += PyInt_AsLong(pItem);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> Py_BuildValue(<span class="string">&quot;i&quot;</span>, result);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> PyMethodDef methods[] = &#123;</span><br><span class="line">   &#123; <span class="string">&quot;sum&quot;</span>, (PyCFunction)list_sum, METH_VARARGS, <span class="string">&quot;sum method&quot;</span> &#125;,</span><br><span class="line">   &#123; <span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="number">0</span>, <span class="literal">NULL</span> &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">struct</span> <span class="title">PyModuleDef</span> <span class="title">python_api_sum_module</span> =</span> &#123;</span><br><span class="line">    PyModuleDef_HEAD_INIT,</span><br><span class="line">    <span class="string">&quot;python_api_sum&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Python interface for the array sum&quot;</span>,</span><br><span class="line">    <span class="number">-1</span>,</span><br><span class="line">    methods</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function">PyMODINIT_FUNC <span class="title">PyInit_python_api_sum</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   <span class="keyword">return</span> PyModule_Create(&amp;python_api_sum_module);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><a href="https://docs.python.org/zh-cn/3/extending/extending.html">1. ä½¿ç”¨ C æˆ– C++ æ‰©å±• Python â€” Python 3.12.4 æ–‡æ¡£</a></p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gcc -Wall -shared  -std=c99 -fPIC <span class="constructor">$(<span class="params">python3</span>-<span class="params">config</span> --<span class="params">includes</span>)</span> <span class="constructor">$(<span class="params">python3</span>-<span class="params">config</span> --<span class="params">ldflags</span>)</span> test.c -o test<span class="constructor">$(<span class="params">python3</span>-<span class="params">config</span> --<span class="params">extension</span>-<span class="params">suffix</span>)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>åœ¨windowsä¸Šæ¨èä½¿ç”¨msys2å·¥å…·ä¸‹è½½Mingwå·¥å…·é“¾,</p><h4 id="pybind11"><a href="#pybind11" class="headerlink" title="pybind11"></a>pybind11</h4><p>è¿™æ˜¯æœ€ç®€å•çš„æ–¹å¼</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install pybind11</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;pybind11/pybind11.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> j)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> i + j;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">PYBIND11_MODULE(example, m) &#123;</span><br><span class="line">    m.doc() = <span class="string">&quot;pybind11 example plugin&quot;</span>; <span class="comment">// optional module docstring</span></span><br><span class="line"></span><br><span class="line">    m.def(<span class="string">&quot;add&quot;</span>, &amp;add, <span class="string">&quot;A function that adds two numbers&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä¸¤ç§æ–¹å¼æ³¨æ„gccä¸pythonç‰ˆæœ¬é—®é¢˜,ä¸¤è€…éƒ½éœ€è¦é€šè¿‡gcc/g++è®¿é—®å…¶ä¸‹çš„pythonçš„includeå’Œlibç›®å½•. æˆ‘åœ¨windowsä¸ŠMingwçš„pythonç‰ˆæœ¬å¤ªä½,æ¯”å¦‚<code>--extension-suffix</code>æ€»æ˜¯æŠ¥é”™,æˆ‘å»ºè®®ç›´æ¥åœ¨Linuxä¸Šå†™.</p><h3 id="C-Cppè°ƒç”¨Python"><a href="#C-Cppè°ƒç”¨Python" class="headerlink" title="C/Cppè°ƒç”¨Python"></a>C/Cppè°ƒç”¨Python</h3><h4 id="C-C-æ‰©å±•Python-1"><a href="#C-C-æ‰©å±•Python-1" class="headerlink" title="C/C++æ‰©å±•Python"></a>C/C++æ‰©å±•Python</h4><p>ç±»ä¼¼ä¸Šé¢çš„æ“ä½œ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#include &lt;Python.h&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">int</span> main(<span class="built_in">int</span> argc, char *argv[]) &#123;</span><br><span class="line">  // åˆå§‹åŒ–pythonè§£é‡Šå™¨.C/C++ä¸­è°ƒç”¨Pythonä¹‹å‰å¿…é¡»å…ˆåˆå§‹åŒ–è§£é‡Šå™¨</span><br><span class="line">  Py_Initialize();</span><br><span class="line">  // æ‰§è¡Œä¸€ä¸ªç®€å•çš„æ‰§è¡Œpythonè„šæœ¬å‘½ä»¤</span><br><span class="line">  PyRun_SimpleString(<span class="string">&quot;print(&#x27;hello world&#x27;)\n&quot;</span>);</span><br><span class="line">  PyRun_SimpleString(<span class="string">&quot;import sys&quot;</span>);</span><br><span class="line">  PyRun_SimpleString(<span class="string">&quot;sys.path.append(&#x27;.&#x27;)&quot;</span>);</span><br><span class="line"></span><br><span class="line">  PyObject* pModule = PyImport_ImportModule(<span class="string">&quot;sum&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span>( pModule == NULL )&#123;</span><br><span class="line">        cout &lt;&lt;<span class="string">&quot;module not found&quot;</span> &lt;&lt; endl;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">    // <span class="number">4</span>ã€è°ƒç”¨å‡½æ•°</span><br><span class="line">    PyObject* pFunc = PyObject_GetAttrString(pModule, <span class="string">&quot;say&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span>( !pFunc || !PyCallable_Check(pFunc))&#123;</span><br><span class="line">        cout &lt;&lt;<span class="string">&quot;not found function add_num&quot;</span> &lt;&lt; endl;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    // </span><br><span class="line">    PyObject_CallObject(pFunc, NULL);</span><br><span class="line">  // æ’¤é”€Py_Initialize()å’Œéšåä½¿ç”¨Python/C APIå‡½æ•°è¿›è¡Œçš„æ‰€æœ‰åˆå§‹åŒ–</span><br><span class="line">  Py_Finalize();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="Pybind"><a href="#Pybind" class="headerlink" title="Pybind"></a>Pybind</h4><p>åŒä¸Š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;pybind11/pybind11.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;pybind11/stl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;pybind11/embed.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> py = pybind11;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span> </span>&#123;</span><br><span class="line">  py::scoped_interpreter guard&#123;&#125;; </span><br><span class="line">  py::object sum = py::module_::<span class="built_in"><span class="keyword">import</span></span>(<span class="string">&quot;sum&quot;</span>);</span><br><span class="line">  py::object py_list_sum = sum.<span class="built_in">attr</span>(<span class="string">&quot;py_list_sum&quot;</span>);</span><br><span class="line">  <span class="keyword">int</span> result = <span class="built_in">py_list_sum</span>(std::vector&lt;<span class="keyword">int</span>&gt;&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>&#125;).cast&lt;<span class="keyword">int</span>&gt;();</span><br><span class="line">  std::cout &lt;&lt; <span class="string">&quot;py_list_sum([1,2,3,4,5]) result:&quot;</span> &lt;&lt; result &lt;&lt; std::endl;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>äº‹å®ä¸Šè¿˜æœ‰æ›´å¤šæ–¹å¼,ä¸è¿‡ä¸Šé¢çš„å·²ç»è¶³å¤Ÿäº†,è¯¦ç»†çš„å¯ä»¥çœ‹çœ‹å…¶ä»–æ•™ç¨‹.</p><p><a href="https://www.hbblog.cn/python%26C%2B%2B/pythonå’ŒCçš„äº¤äº’/#32-pybind11python">ä¸€æ–‡æ€»ç»“Pythonå’ŒC/C++çš„äº¤äº’æ–¹å¼ - æµ·æ»¨çš„Blog (hbblog.cn)</a></p><p><a href="https://python3-cookbook-personal.readthedocs.io/zh-cn/latest/chapters/p15_c_extensions.html">ç¬¬åäº”ç« ï¼šCè¯­è¨€æ‰©å±• â€” python3-cookbook 2.0.0 æ–‡æ¡£ (python3-cookbook-personal.readthedocs.io)</a></p><p>è¿™é‡Œæ¨èpybindçš„æ–¹æ³•,ç›¸å¯¹åŠŸèƒ½æ›´å¼º,ä½¿ç”¨ä¹Ÿä¸å¤æ‚.</p><h2 id="JavaScriptå’ŒCæˆ–Cpp"><a href="#JavaScriptå’ŒCæˆ–Cpp" class="headerlink" title="JavaScriptå’ŒCæˆ–Cpp"></a>JavaScriptå’ŒCæˆ–Cpp</h2><h3 id="Jsè°ƒç”¨C-Cpp"><a href="#Jsè°ƒç”¨C-Cpp" class="headerlink" title="Jsè°ƒç”¨C/Cpp"></a>Jsè°ƒç”¨C/Cpp</h3><h4 id="WebAssembly"><a href="#WebAssembly" class="headerlink" title="WebAssembly"></a>WebAssembly</h4><p>å¯¹äºæµè§ˆå™¨ç«¯,è¿™åº”è¯¥æ˜¯æœ€é€šç”¨çš„æ–¹å¼äº†.ä½¿ç”¨Emscripten,å°†æºä»£ç è½¬ä¸ºassemblyæ ¼å¼é€šè¿‡æµè§ˆå™¨è°ƒç”¨.ä½†æ˜¯éœ€è¦æµè§ˆå™¨æ”¯æŒ. </p><p><a href="https://developer.mozilla.org/en-US/docs/WebAssembly/C_to_Wasm">Compiling a New C/C++ Module to WebAssembly - WebAssembly | MDN (mozilla.org)</a></p><p>æŒ‰ç…§å®˜ç½‘æ–¹å¼ä¸‹è½½å®‰è£…,</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> ** argv)</span> </span>&#123;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Hello World\n&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">emcc hello.c -s WASM=1 -o hello.html</span><br></pre></td></tr></table></figure><ul><li><code>-s WASM=1</code> â€” æŒ‡å®šæˆ‘ä»¬æƒ³è¦çš„ wasm è¾“å‡ºå½¢å¼ã€‚æœ€æ–°ç‰ˆemccé»˜è®¤ä¸º1,0è¡¨ç¤ºè¾“å‡ºasm.js</li><li><code>-o hello.html</code> â€” æŒ‡å®šè¿™ä¸ªé€‰é¡¹å°†ä¼šç”Ÿæˆ HTML é¡µé¢æ¥è¿è¡Œæˆ‘ä»¬çš„ä»£ç ï¼Œå¹¶ä¸”ä¼šç”Ÿæˆ wasm æ¨¡å—ï¼Œä»¥åŠç¼–è¯‘å’Œå®ä¾‹åŒ– wasm æ¨¡å—æ‰€éœ€è¦çš„â€œèƒ¶æ°´â€js ä»£ç ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ç›´æ¥åœ¨ web ç¯å¢ƒä¸­ä½¿ç”¨äº†ã€‚</li></ul><p>è¿™ä¸ªæ—¶å€™åœ¨ä½ çš„æºç æ–‡ä»¶å¤¹åº”è¯¥æœ‰ä¸‹åˆ—æ–‡ä»¶ï¼š</p><ul><li><code>hello.wasm</code> äºŒè¿›åˆ¶çš„ wasm æ¨¡å—ä»£ç </li><li><code>hello.js</code> ä¸€ä¸ªåŒ…å«äº†ç”¨æ¥åœ¨åŸç”Ÿ C å‡½æ•°å’Œ JavaScript/wasm ä¹‹é—´è½¬æ¢çš„èƒ¶æ°´ä»£ç çš„ JavaScript æ–‡ä»¶</li><li><code>hello.html</code> ä¸€ä¸ªç”¨æ¥åŠ è½½ï¼Œç¼–è¯‘ï¼Œå®ä¾‹åŒ–ä½ çš„ wasm ä»£ç å¹¶ä¸”å°†å®ƒè¾“å‡ºåœ¨æµè§ˆå™¨æ˜¾ç¤ºä¸Šçš„ä¸€ä¸ª HTML æ–‡ä»¶</li></ul><p>ä½¿ç”¨ä¸€ä¸ªæ”¯æŒ WebAssembly çš„æµè§ˆå™¨ï¼ŒåŠ è½½ç”Ÿæˆçš„ <code>hello.html</code>ã€‚è‡ªä» Firefox ç‰ˆæœ¬ 52ã€Chrome ç‰ˆæœ¬ 57 å’Œ Opera ç‰ˆæœ¬ 44 å¼€å§‹ï¼Œå·²ç»é»˜è®¤å¯ç”¨äº† WebAssembly(æ³¨æ„ä¸æ˜¯é€šè¿‡æ–‡ä»¶æ–¹å¼æ‰“å¼€)</p><p>ä¸Šé¢æ˜¯åœ¨htmlåŠ è½½åä¼šè°ƒç”¨mainå‡½æ•°ä¸­çš„ä»£ç </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;emscripten/emscripten.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> ** argv)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Hello World\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> __cplusplus</span></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> &#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> EMSCRIPTEN_KEEPALIVE <span class="title">myFunction</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> ** argv)</span> </span>&#123;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;æˆ‘çš„å‡½æ•°å·²è¢«è°ƒç”¨\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> __cplusplus</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">emcc -o hello3.html hello3.c -O3 -s WASM=1 -s <span class="string">&quot;EXPORTED_RUNTIME_METHODS=[&#x27;ccall&#x27;]&quot;</span> --shell-file html_template/shell_minimal.html</span><br></pre></td></tr></table></figure><p>å¦‚æœè¦å¯¼å…¥å‡½æ•°,é€šè¿‡è®¾ç½®EXPORTED_RUNTIME_METHODSå¯¼å‡ºccall,è€Œccallä¼šåœ¨ JS ä»£ç ä¹‹ä¸­è°ƒç”¨ C å‡½æ•°</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//&lt;button class=&quot;mybutton&quot;&gt;è¿è¡Œæˆ‘çš„å‡½æ•°&lt;/button&gt; //html</span></span><br><span class="line"><span class="built_in">document</span>.querySelector(<span class="string">&quot;.mybutton&quot;</span>).addEventListener(<span class="string">&quot;click&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  alert(<span class="string">&quot;æ£€æŸ¥æ§åˆ¶å°&quot;</span>);</span><br><span class="line">  <span class="keyword">var</span> result = Module.ccall(</span><br><span class="line">    <span class="string">&quot;myFunction&quot;</span>, <span class="comment">// name of C function</span></span><br><span class="line">    <span class="literal">null</span>, <span class="comment">// return type</span></span><br><span class="line">    <span class="literal">null</span>, <span class="comment">// argument types</span></span><br><span class="line">    <span class="literal">null</span>,</span><br><span class="line">  ); <span class="comment">// arguments</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><a href="https://ruanyifeng.com/blog/2017/09/asmjs_emscripten.html">asm.js å’Œ Emscripten å…¥é—¨æ•™ç¨‹ - é˜®ä¸€å³°çš„ç½‘ç»œæ—¥å¿— (ruanyifeng.com)</a></p><p>emccæ—¢æ”¯æŒasm.jsä¹Ÿæ”¯æŒWASM,ä¸¤è€…éƒ½èƒ½å®ç°ç±»ä¼¼çš„æ•ˆæœ,ä¸è¿‡ç›®å‰è¿˜æ˜¯WASMé£å¤´æ­£åŠ²</p><h4 id="c-addons"><a href="#c-addons" class="headerlink" title="c++ addons"></a>c++ addons</h4><p><a href="https://nodejs.org/docs/v20.15.0/api/addons.html#c-addons">C++ addons | Node.js v20.15.0 Documentation (nodejs.org)</a></p><p>ä½¿ç”¨<code>node.h</code>å¤´æ–‡ä»¶å¹¶ä¸‹è½½node-gypç¼–è¯‘å¾—åˆ°åŠ¨æ€åº“,å†é€šè¿‡nodeè°ƒç”¨.</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// hello.cc</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;node.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> demo &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> v8::FunctionCallbackInfo;</span><br><span class="line"><span class="keyword">using</span> v8::Isolate;</span><br><span class="line"><span class="keyword">using</span> v8::Local;</span><br><span class="line"><span class="keyword">using</span> v8::Object;</span><br><span class="line"><span class="keyword">using</span> v8::<span class="keyword">String</span>;</span><br><span class="line"><span class="keyword">using</span> v8::Value;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Method</span><span class="params">(<span class="keyword">const</span> FunctionCallbackInfo&lt;Value&gt;&amp; args)</span> </span>&#123;</span><br><span class="line">  Isolate* isolate = args.<span class="built_in">GetIsolate</span>();</span><br><span class="line">  args.<span class="built_in">GetReturnValue</span>().<span class="built_in">Set</span>(<span class="keyword">String</span>::<span class="built_in">NewFromUtf8</span>(</span><br><span class="line">      isolate, <span class="string">&quot;world&quot;</span>).<span class="built_in">ToLocalChecked</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Initialize</span><span class="params">(Local&lt;Object&gt; exports)</span> </span>&#123;</span><br><span class="line">  <span class="built_in">NODE_SET_METHOD</span>(exports, <span class="string">&quot;hello&quot;</span>, Method);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">NODE_MODULE</span>(NODE_GYP_MODULE_NAME, Initialize)</span><br><span class="line"></span><br><span class="line">&#125;  <span class="comment">// namespace demo</span></span><br></pre></td></tr></table></figure><p>è¿™ä¸ªä¹Ÿè¦æ³¨æ„ä½¿ç”¨çš„ç¼–è¯‘å™¨,æˆ‘åœ¨windowsä¸Šé»˜è®¤ä½¿ç”¨visual studio,éœ€è¦åç¼€.cpp.</p><p>åˆ›å»ºbinding.gyp,ç„¶åä½¿ç”¨node-gyp</p><figure class="highlight gyp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">&#x27;targets&#x27;</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">&#x27;target_name&#x27;</span>: <span class="string">&#x27;hello&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;sources&#x27;</span>: [ </span><br><span class="line">                <span class="string">&#x27;src/hello.cc&#x27;</span>,</span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">node-gyp configure</span><br><span class="line">node-gyp build</span><br></pre></td></tr></table></figure><p>ç¼–è¯‘åå¾—åˆ°.nodeæ–‡ä»¶ä½¿ç”¨jsè°ƒç”¨å³å¯</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">require</span>(<span class="string">&#x27;./build/Release/addon.node&#x27;</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">require</span>(<span class="string">&#x27;./build/Debug/addon.node&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Native-abstractions-for-Node-js"><a href="#Native-abstractions-for-Node-js" class="headerlink" title="Native abstractions for Node.js"></a>Native abstractions for Node.js</h4><p>Node-API æ˜¯ç”¨äºæ„å»ºnative addonsçš„ APIã€‚å®ƒ<strong>ç‹¬ç«‹äºåº•å±‚ JavaScript è¿è¡Œæ—¶</strong>ï¼ˆå¦‚ V8ï¼‰ï¼Œå¹¶ä½œä¸º Node.js è‡ªèº«çš„ä¸€éƒ¨åˆ†è¿›è¡Œç»´æŠ¤ã€‚è¯¥ API åœ¨ä¸åŒç‰ˆæœ¬çš„ Node.js ä¸­å…·æœ‰ç¨³å®šçš„åº”ç”¨äºŒè¿›åˆ¶æ¥å£ (ABI)<strong>ã€‚å…¶ç›®çš„æ˜¯ä½¿é™„åŠ ç»„ä»¶ä¸å—åº•å±‚ JavaScript å¼•æ“å˜åŒ–çš„å½±å“</strong>ï¼Œå¹¶å…è®¸ä¸ºæŸä¸€ç‰ˆæœ¬ç¼–è¯‘çš„æ¨¡å—æ— éœ€é‡æ–°ç¼–è¯‘å³å¯åœ¨ä»¥åç‰ˆæœ¬çš„ Node.js ä¸Šè¿è¡Œã€‚addonsä½¿ç”¨node-gyp ç­‰æ„å»º/æ‰“åŒ…ã€‚</p><p><a href="https://nodejs.org/docs/v20.15.0/api/addons.html#native-abstractions-for-nodejs">C++ addons | Node.js v20.15.0 Documentation (nodejs.org)</a></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// hello.cc using Node-API</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;node_api.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> demo &#123;</span><br><span class="line"></span><br><span class="line"><span class="function">napi_value <span class="title">Method</span><span class="params">(napi_env env, napi_callback_info args)</span> </span>&#123;</span><br><span class="line">  napi_value greeting;</span><br><span class="line">  napi_status status;</span><br><span class="line"></span><br><span class="line">  status = <span class="built_in">napi_create_string_utf8</span>(env, <span class="string">&quot;world&quot;</span>, NAPI_AUTO_LENGTH, &amp;greeting);</span><br><span class="line">  <span class="keyword">if</span> (status != napi_ok) <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">  <span class="keyword">return</span> greeting;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">napi_value <span class="title">init</span><span class="params">(napi_env env, napi_value exports)</span> </span>&#123;</span><br><span class="line">  napi_status status;</span><br><span class="line">  napi_value fn;</span><br><span class="line"></span><br><span class="line">  status = <span class="built_in">napi_create_function</span>(env, <span class="literal">nullptr</span>, <span class="number">0</span>, Method, <span class="literal">nullptr</span>, &amp;fn);</span><br><span class="line">  <span class="keyword">if</span> (status != napi_ok) <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line"></span><br><span class="line">  status = <span class="built_in">napi_set_named_property</span>(env, exports, <span class="string">&quot;hello&quot;</span>, fn);</span><br><span class="line">  <span class="keyword">if</span> (status != napi_ok) <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">  <span class="keyword">return</span> exports;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">NAPI_MODULE</span>(NODE_GYP_MODULE_NAME, init)</span><br><span class="line"></span><br><span class="line">&#125;  <span class="comment">// namespace demo</span></span><br></pre></td></tr></table></figure><p>å¥½å¤„æ˜¯å…¼å®¹æ€§æ›´é«˜,apiçœ‹èµ·æ¥ä¹Ÿæ›´æ˜“æ‡‚.</p><h3 id="C-Cppè°ƒç”¨Js"><a href="#C-Cppè°ƒç”¨Js" class="headerlink" title="C/Cppè°ƒç”¨Js"></a>C/Cppè°ƒç”¨Js</h3><h4 id="C-addons"><a href="#C-addons" class="headerlink" title="C addons"></a>C addons</h4><p>åŒä¸Š,å¯ä»¥è€ƒè™‘ä½¿ç”¨å›è°ƒç­‰æ–¹æ³•åœ¨cä¸­è°ƒç”¨js.</p><p><a href="https://ruanyifeng.com/blog/2017/09/asmjs_emscripten.html">asm.js å’Œ Emscripten å…¥é—¨æ•™ç¨‹ - é˜®ä¸€å³°çš„ç½‘ç»œæ—¥å¿— (ruanyifeng.com)</a></p><p>å¦‚æœæ˜¯nodeé‚£å°±æŒ‰ç…§å®˜æ–¹æ–‡æ¡£ä½¿ç”¨addons(äº‹å®ä¸Šä¹Ÿå¯ä»¥ä½¿ç”¨Emscripteè½¬ä¸ºasm.jsè¿›è¡Œè°ƒç”¨),å¦‚æœæ˜¯æµè§ˆå™¨,é‚£æ¨èä½¿ç”¨WASM,é™¤èƒ½è½¬æ¢c/c++ä¹‹å¤–è¿˜æœ‰Rustç­‰,åœ¨å‰ç«¯ä¹Ÿæ˜¯æœ‰å‰æ™¯çš„æŠ€æœ¯ä¹‹ä¸€.<a href="https://developer.mozilla.org/zh-CN/docs/WebAssembly/C_to_Wasm#ç¼–è¯‘_emscripten">Emscripten</a></p><p>é€šè¿‡asm.jsè°ƒç”¨c++ä»£ç ,æ–¹æ³•ç±»ä¼¼,ç›®å‰emccçš„WASMé»˜è®¤ä¸º1ä¹Ÿå°±æ˜¯é»˜è®¤ç”ŸæˆWASM,ä½†ä½¿ç”¨æ—¶é€šè¿‡ä¸‹é¢å‘½ä»¤å¾—åˆ°asm.js</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">emcc index.cpp -s <span class="string">&quot;EXPORTED_FUNCTIONS=[â€˜_mainâ€™,&#x27;_myFunction&#x27;]&quot;</span> -s WASM=0 -s EXPORTED_RUNTIME_METHODS=<span class="string">&quot;[&#x27;ccall&#x27;]&quot;</span> -o index.js</span><br></pre></td></tr></table></figure><p>åœ¨jsæ–‡ä»¶ä¸­è°ƒç”¨</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="built_in">module</span> = <span class="built_in">require</span>(<span class="string">&quot;./output.js&quot;</span>)</span><br><span class="line"><span class="keyword">let</span> resulst = <span class="built_in">module</span>.onRuntimeInitialized(<span class="function">()=&gt;</span>&#123;</span><br><span class="line"><span class="built_in">module</span>.ccall(<span class="string">&#x27;myFunction&#x27;</span>,&#123;</span><br><span class="line"><span class="literal">null</span>, <span class="comment">// return type</span></span><br><span class="line"><span class="literal">null</span>, <span class="comment">// argument type</span></span><br><span class="line"><span class="literal">null</span>, <span class="comment">// arguments</span></span><br><span class="line">&#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><blockquote><p>asm.js çš„æŠ€æœ¯èƒ½å°† C / C++ è½¬æˆ JS å¼•æ“å¯ä»¥è¿è¡Œçš„ä»£ç ã€‚é‚£ä¹ˆå®ƒä¸ WASMæœ‰ä½•åŒºåˆ«å‘¢ï¼Ÿ</p><p>å›ç­”æ˜¯ï¼Œä¸¤è€…çš„åŠŸèƒ½åŸºæœ¬ä¸€è‡´ï¼Œå°±æ˜¯è½¬å‡ºæ¥çš„ä»£ç ä¸ä¸€æ ·<strong>ï¼šasm.js æ˜¯æ–‡æœ¬ï¼ŒWebAssembly æ˜¯äºŒè¿›åˆ¶å­—èŠ‚ç </strong>ï¼Œå› æ­¤è¿è¡Œé€Ÿåº¦æ›´å¿«ã€ä½“ç§¯æ›´å°ã€‚ä»é•¿è¿œæ¥çœ‹ï¼ŒWebAssembly çš„å‰æ™¯æ›´å…‰æ˜ã€‚</p><p>ä½†æ˜¯ï¼Œè¿™å¹¶ä¸æ„å‘³ç€ asm.js è‚¯å®šä¼šè¢«æ·˜æ±°ï¼Œå› ä¸ºå®ƒæœ‰ä¸¤ä¸ªä¼˜ç‚¹ï¼šé¦–å…ˆï¼Œå®ƒæ˜¯æ–‡æœ¬ï¼Œäººç±»å¯è¯»ï¼Œæ¯”è¾ƒç›´è§‚ï¼›å…¶æ¬¡ï¼Œæ‰€æœ‰æµè§ˆå™¨éƒ½æ”¯æŒ asm.jsï¼Œä¸ä¼šæœ‰å…¼å®¹æ€§é—®é¢˜ã€‚</p></blockquote><h2 id="Javaå’ŒCæˆ–Cpp"><a href="#Javaå’ŒCæˆ–Cpp" class="headerlink" title="Javaå’ŒCæˆ–Cpp"></a>Javaå’ŒCæˆ–Cpp</h2><p>Javaè°ƒç”¨C/Cppæœ‰å¤šç§æ–¹å¼,è¿™é‡Œåªä»‹ç»ä¸€ç§.</p><p>JNI,é€šè¿‡nativeå£°æ˜</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">package org.example;</span><br><span class="line"><span class="comment">//TIP To &lt;b&gt;Run&lt;/b&gt; code, press &lt;shortcut actionId=&quot;Run&quot;/&gt; or</span></span><br><span class="line"><span class="comment">// click the &lt;icon src=&quot;AllIcons.Actions.Execute&quot;/&gt; icon in the gutter.</span></span><br><span class="line">public <span class="keyword">class</span> Main &#123;</span><br><span class="line">    public native void say<span class="constructor">Hello()</span>;</span><br><span class="line"></span><br><span class="line">    static &#123;</span><br><span class="line"><span class="comment">//        System.load(&quot;./sayHello.dll&quot;);</span></span><br><span class="line">        <span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>load<span class="constructor">Library(<span class="string">&quot;sayHello&quot;</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    public static void main(String<span class="literal">[]</span> args) &#123;</span><br><span class="line">        <span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out.println(<span class="string">&quot;Hi&quot;</span>);</span><br><span class="line">        <span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out.println(<span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>get<span class="constructor">Property(<span class="string">&quot;java.library.path&quot;</span>)</span>);</span><br><span class="line">        Main m = <span class="keyword">new</span> <span class="constructor">Main()</span>;</span><br><span class="line">        m.say<span class="constructor">Hello()</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨<code>javac -h ./ Main.java</code>è½¬ä¸ºå¤´æ–‡ä»¶,å†…å®¹å¦‚ä¸‹</p><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* DO NOT EDIT THIS FILE - it is machine generated */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;jni.h&gt;</span></span></span><br><span class="line"><span class="comment">/* Header for class org_example_Main */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> _Included_org_example_Main</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> _Included_org_example_Main</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> __cplusplus</span></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> &#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Class:     org_example_Main</span></span><br><span class="line"><span class="comment"> * Method:    sayHello</span></span><br><span class="line"><span class="comment"> * Signature: ()V</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">JNIEXPORT <span class="keyword">void</span> JNICALL <span class="title">Java_org_example_Main_sayHello</span></span></span><br><span class="line"><span class="function">  <span class="params">(JNIEnv *, jobject)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> __cplusplus</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç„¶åå†™ä¸€ä¸ªcppå»å®ç°æ–¹æ³•</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;org_example_Main.h&quot;</span></span></span><br><span class="line"><span class="function">JNIEXPORT <span class="keyword">void</span> JNICALL <span class="title">Java_org_example_Main_sayHello</span><span class="params">(JNIEnv *, jobject)</span> </span>&#123;</span><br><span class="line">  std::cout &lt;&lt; <span class="string">&quot;Hello im from cpp&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åç”Ÿæˆdllæ–‡ä»¶,æ³¨æ„å¤´æ–‡ä»¶è¦æœ‰jdkä¸­çš„å¤´æ–‡ä»¶</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">g++ -Wall -shared -fPIC -IC:/Users/proanimer/.jdks/openjdk-22.0.1/include -IC:/Users/proanimer/.jdks/openjdk-22.0.1/include/win32 sayHello.cpp -o sayHello.dll</span><br></pre></td></tr></table></figure><p>å¾—åˆ°çš„dllæ–‡ä»¶å°±èƒ½è¢«<code>`System.loadLibrary</code>åŠ è½½äº†,ä½†æ³¨æ„dllæ–‡ä»¶æ”¾çš„ä½ç½®,ä¼šå»ç¯å¢ƒå˜é‡ä¸­çš„PATHå»æ‰¾,å¦‚æœç›´æ¥æ”¾åœ¨åŒä¸€ç›®å½•ä¸‹æ²¡æœ‰é¢å¤–è®¾ç½®æ˜¯æ²¡æœ‰å¯¼å…¥çš„.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"><span class="comment">//TIP To &lt;b&gt;Run&lt;/b&gt; code, press &lt;shortcut actionId=&quot;Run&quot;/&gt; or</span></span><br><span class="line"><span class="comment">// click the &lt;icon src=&quot;AllIcons.Actions.Execute&quot;/&gt; icon in the gutter.</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">native</span> <span class="keyword">void</span> <span class="title">sayHello</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        System.loadLibrary(<span class="string">&quot;sayHello&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Hi&quot;</span>);</span><br><span class="line">        System.out.println(System.getProperty(<span class="string">&quot;java.library.path&quot;</span>));</span><br><span class="line">        Main m = <span class="keyword">new</span> Main();</span><br><span class="line">        m.sayHello();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥é€šè¿‡classæ‰“åŒ…ä¸ºjarråŒ…,ç„¶åç›´æ¥è°ƒç”¨jaråŒ…(jaråŒ…éœ€è¦è°ƒç”¨dll)å³å¯.</p><ol><li><code>java -jar &lt;jarfile&gt;</code>: è¿è¡ŒæŒ‡å®šçš„ Java å½’æ¡£æ–‡ä»¶(JAR æ–‡ä»¶)ã€‚</li><li><code>java -cp &lt;classpath&gt; &lt;main-class&gt;</code>: æŒ‡å®šç±»è·¯å¾„å¹¶è¿è¡ŒæŒ‡å®šçš„ä¸»ç±»ã€‚</li><li><code>java -D&lt;property&gt;=&lt;value&gt;</code>: è®¾ç½® Java ç³»ç»Ÿå±æ€§ã€‚</li><li><code>java -verbose</code>: å¼€å¯è¯¦ç»†è¾“å‡ºæ¨¡å¼ã€‚</li><li><code>java -version</code>: æ˜¾ç¤º Java ç‰ˆæœ¬ä¿¡æ¯ã€‚</li><li><code>java -help</code>: æ˜¾ç¤º Java å‘½ä»¤è¡Œå¸®åŠ©ã€‚</li></ol><p>å…¶ä»–æ–¹æ³•å¯ä»¥çœ‹çœ‹<a href="https://blog.csdn.net/giveaname/article/details/106615257">JNA â€”â€” Javaè°ƒç”¨C/C++åŠ¨æ€åº“_jnaè°ƒç”¨c++ç±»-CSDNåšå®¢</a></p><h3 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h3><ol><li><a href="https://blog.csdn.net/weixin_43552133/article/details/128377535">gccç”Ÿæˆé™æ€åº“ä¸åŠ¨æ€åº“ï¼ˆé™„å¸¦ä½¿ç”¨æ–¹æ³•ï¼‰_gcc ç”Ÿæˆé™æ€åº“-CSDNåšå®¢</a></li><li><a href="https://www.runoob.com/w3cnote/cpp-static-library-and-dynamic-library.html">C++é™æ€åº“ä¸åŠ¨æ€åº“ | èœé¸Ÿæ•™ç¨‹ (runoob.com)</a></li></ol><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;p&gt;å½“é¡¹ç›®æ¯”è¾ƒå¤§æ¶‰åŠåˆ°å¤šé—¨ç¼–ç¨‹è¯­è¨€æ—¶ä¼šæœ‰è¿™ç§éœ€æ±‚.é€šå¸¸æ˜¯è¦æ±‚è°ƒç”¨C/C++ç­‰.&lt;br&gt;æŸäº›è¯­è¨€ä¹‹é—´ç›¸å¯¹æ¥è¯´è°ƒç”¨å°±æ¯”è¾ƒç®€å•,æ¯”å¦‚Goå’ŒC,Rustå’ŒCç­‰.ä½†æ˜¯å…¶ä»–è¯­è¨€ç›¸å¯¹æ¥è¯´å°±éº»çƒ¦äº†.æœ¬æ–‡ä¸»è¦æ¶‰åŠPython,JS,Javaå’ŒC/C+çš„äº’ç›¸è°ƒç”¨,ä»¥å¤‡ä¸æ—¶ä¹‹éœ€.&lt;/p&gt;
&lt;p&gt;TL;DR:Pythonä½¿ç”¨pybind11,JSä½¿ç”¨emcc,Javaä½¿ç”¨JNI.&lt;br&gt;</summary>
    
    
    
    
    <category term="programming" scheme="https://www.sekyoro.top/tags/programming/"/>
    
  </entry>
  
  <entry>
    <title>å‡½æ•°å¼ç¼–ç¨‹ä»‹ç»ä¸å…¥é—¨</title>
    <link href="https://www.sekyoro.top/2024/06/23/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B%E4%BB%8B%E7%BB%8D%E4%B8%8E%E5%85%A5%E9%97%A8/"/>
    <id>https://www.sekyoro.top/2024/06/23/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B%E4%BB%8B%E7%BB%8D%E4%B8%8E%E5%85%A5%E9%97%A8/</id>
    <published>2024-06-23T12:21:01.000Z</published>
    <updated>2024-06-28T04:08:28.489Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>ä¹‹å‰åœ¨çœ‹å…¶ä»–äººäº¤æµå¸–å­çš„æ—¶å€™æåˆ°å­¦ä¹ å‡½æ•°å¼ç¼–ç¨‹æå‡æ€ç»´(è™½ç„¶æ„Ÿè§‰æœ‰ç‚¹å¤§è‚†å®£ä¼ çš„æ„Ÿè§‰),ä½†çœ‹äº†ä¸€äº›å‡½æ•°å¼ç¼–ç¨‹çš„ä¾‹å­,æ„Ÿè§‰åœ¨æ•°æ®å¤„ç†å’Œå¤šçº¿ç¨‹ä¸Šæœ‰ç‹¬ç‰¹çš„æ•ˆæœ,å¦‚æœä½¿ç”¨é¢å‘å¯¹è±¡,é‚£å°±ä¼šå˜å¾—æ¯”è¾ƒéº»çƒ¦,æ‰€ä»¥è¿™é‡Œä»…ä½œç®€å•ä»‹ç».<br><span id="more"></span><br>ä¸ªäººè®¤ä¸º,å‡½å¼ç¼–ç¨‹æ˜¯ä¸€ç§æ€æƒ³,è€Œä¸æ˜¯å…·ä½“æŸç§å·¥å…·. C++å¯ä»¥è¿›è¡Œå‡½æ•°å¼ç¼–ç¨‹,Javaä¹Ÿå¯ä»¥,åªä¸è¿‡çœ‹æ”¯æŒç¨‹åº¦è€Œå·².<strong>ç°ä»£çš„ç¼–ç¨‹è¯­è¨€å·²ç»æŠŠå‡½æ•°å¼ç¼–ç¨‹çš„æ€æƒ³èå…¥è¿›å»äº†</strong> .</p><p>ä»€ä¹ˆæ˜¯å‡½æ•°å¼ç¼–ç¨‹å‘¢ï¼Ÿåœ¨ç½‘ä¸Šä½ å¯ä»¥çœ‹åˆ°å¾ˆå¤šå®šä¹‰ï¼Œä½†å¤§éƒ½ç¦»ä¸å¼€è¿™äº›ç‰¹æ€§ã€‚</p><ul><li><strong>First Class</strong> å‡½æ•°ï¼šå‡½æ•°å¯ä»¥è¢«åº”ç”¨ï¼Œä¹Ÿå¯ä»¥è¢«å½“ä½œæ•°æ®ã€‚</li><li><strong>Pure</strong> çº¯å‡½æ•°ï¼Œæ— å‰¯ä½œç”¨ï¼šä»»æ„æ—¶åˆ»ä»¥ç›¸åŒå‚æ•°è°ƒç”¨å‡½æ•°ä»»æ„æ¬¡æ•°å¾—åˆ°çš„ç»“æœéƒ½ä¸€æ ·ã€‚</li><li><strong>Referential Transparency</strong> å¼•ç”¨é€æ˜ï¼šå¯ä»¥è¢«è¡¨è¾¾å¼æ›¿ä»£ã€‚</li><li><strong>Expression</strong> åŸºäºè¡¨è¾¾å¼ï¼šè¡¨è¾¾å¼å¯ä»¥è¢«è®¡ç®—ï¼Œä¿ƒè¿›æ•°æ®æµåŠ¨ï¼ŒçŠ¶æ€å£°æ˜å°±åƒæ˜¯ä¸€ä¸ªæš‚åœï¼Œå¥½åƒæ•°æ®åˆ°è¿™é‡Œå°±ä¼šåœæ»äº†ä¸€ä¸‹ã€‚</li><li><strong>Immutable</strong> ä¸å¯å˜æ€§ï¼šå‚æ•°ä¸å¯è¢«ä¿®æ”¹ã€å˜é‡ä¸å¯è¢«ä¿®æ”¹â€”å®å¯ç‰ºç‰²æ€§èƒ½ï¼Œä¹Ÿè¦äº§ç”Ÿæ–°çš„æ•°æ®ï¼ˆRustå†…å­˜æ¨¡å‹ä¾‹å¤–ï¼‰ã€‚</li><li><strong>High Order Function</strong> å¤§é‡ä½¿ç”¨é«˜é˜¶å‡½æ•°ï¼šå˜é‡å­˜å‚¨ã€é—­åŒ…åº”ç”¨ã€å‡½æ•°é«˜åº¦å¯ç»„åˆã€‚</li><li><strong>Curry</strong> æŸ¯é‡ŒåŒ–ï¼šå¯¹å‡½æ•°è¿›è¡Œé™ç»´ï¼Œæ–¹ä¾¿è¿›è¡Œç»„åˆã€‚</li><li><strong>Composition</strong> å‡½æ•°ç»„åˆï¼šå°†å¤šä¸ªå•å‡½æ•°è¿›è¡Œç»„åˆï¼Œåƒæµæ°´çº¿ä¸€æ ·å·¥ä½œã€‚</li></ul><p>å¦å¤–è¿˜æœ‰ä¸€äº›ç‰¹æ€§ï¼Œæœ‰çš„ä¼šæåˆ°ï¼Œæœ‰çš„ä¸€ç¬”å¸¦è¿‡ï¼Œä½†å®é™…ä¹Ÿæ˜¯ä¸€ä¸ªç‰¹æ€§ï¼ˆä»¥Haskellä¸ºä¾‹ï¼‰ã€‚</p><ul><li><strong>Type Inference</strong> ç±»å‹æ¨å¯¼ï¼šå¦‚æœæ— æ³•ç¡®å®šæ•°æ®çš„ç±»å‹ï¼Œé‚£å‡½æ•°æ€ä¹ˆå»ç»„åˆï¼Ÿï¼ˆå¸¸è§ï¼Œä½†éå¿…éœ€ï¼‰</li><li><strong>Lazy Evaluation</strong> æƒ°æ€§æ±‚å€¼ï¼šå‡½æ•°å¤©ç„¶å°±æ˜¯ä¸€ä¸ªæ‰§è¡Œç¯å¢ƒï¼Œæƒ°æ€§æ±‚å€¼æ˜¯å¾ˆè‡ªç„¶çš„é€‰æ‹©ã€‚</li><li><strong>Side Effect</strong> IOï¼šä¸€ç§ç±»å‹ï¼Œç”¨äºå¤„ç†å‰¯ä½œç”¨ã€‚ä¸€ä¸ªä¸èƒ½æ‰§è¡Œæ‰“å°æ–‡å­—ã€ä¿®æ”¹æ–‡ä»¶ç­‰æ“ä½œçš„ç¨‹åºï¼Œæ˜¯æ²¡æœ‰æ„ä¹‰çš„ï¼Œæ€»è¦æœ‰ä½ç½®å¤„ç†å‰¯ä½œç”¨ã€‚ï¼ˆè¾¹ç¼˜ï¼‰</li></ul><blockquote><p>å‡½æ•°å¼ç¼–ç¨‹è¯­è¨€çš„ä¸€äº›æ ¸å¿ƒç‰¹ç‚¹,å¦‚ä¸å¯å˜æ•°æ®ã€é«˜é˜¶å‡½æ•°ã€æƒ°æ€§æ±‚å€¼ç­‰ã€‚å®ƒä»¬ä¸ºç°ä»£è½¯ä»¶å¼€å‘å¸¦æ¥äº†æ–°çš„ç¼–ç¨‹æ¨¡å¼å’Œæ€ç»´æ–¹å¼ã€‚<br>æœ¬è´¨ä¸Šï¼Œå‡½æ•°å¼ç¼–ç¨‹åªæ˜¯èŒƒç•´è®ºçš„è¿ç®—æ–¹æ³•ï¼Œè·Ÿæ•°ç†é€»è¾‘ã€å¾®ç§¯åˆ†ã€è¡Œåˆ—å¼æ˜¯åŒä¸€ç±»ä¸œè¥¿ï¼Œéƒ½æ˜¯æ•°å­¦æ–¹æ³•ï¼Œåªæ˜¯ç¢°å·§å®ƒèƒ½ç”¨æ¥å†™ç¨‹åºã€‚</p></blockquote><ul><li><p>æ•°æ®æ˜¯ä¸å¯å˜(immutable)çš„ï¼š å¦‚æœè¦æ›´æ”¹æ•°æ®ï¼ˆå¦‚æ•°ç»„ï¼‰ï¼Œéœ€è¦è¿”å›ä¸€ä¸ªåŒ…å«æ›´æ”¹å†…å®¹çš„æ–°æ•°ç»„ï¼Œè€Œä¸æ˜¯åŸæ¥çš„æ•°ç»„ã€‚</p></li><li><p>å‡½æ•°æ˜¯æ— çŠ¶æ€çš„ï¼š å‡½æ•°æ¯æ¬¡éƒ½åƒç¬¬ä¸€æ¬¡ä¸€æ ·è¿è¡Œï¼æ¢å¥è¯è¯´ï¼Œå¯¹äºç›¸åŒçš„å‚æ•°ï¼Œå‡½æ•°æ€»æ˜¯ç»™å‡ºç›¸åŒçš„è¿”å›å€¼ã€‚</p></li></ul><p>ä¸€èˆ¬æ¥è¯´ï¼Œæ‚¨åº”è¯¥éµå¾ªä¸‰ä¸ªæœ€ä½³å®è·µï¼š</p><ol><li><strong>å‡½æ•°åº”è‡³å°‘æ¥å—ä¸€ä¸ªå‚æ•°ã€‚</strong></li><li><p><strong>å‡½æ•°åº”è¿”å›æ•°æ®æˆ–å¦ä¸€ä¸ªå‡½æ•°ã€‚</strong></p></li><li><p><strong>ä¸è¦ä½¿ç”¨å¾ªç¯</strong></p></li></ol><h3 id="å‡½æ•°ä¸€ç­‰å…¬æ°‘"><a href="#å‡½æ•°ä¸€ç­‰å…¬æ°‘" class="headerlink" title="å‡½æ•°ä¸€ç­‰å…¬æ°‘"></a>å‡½æ•°ä¸€ç­‰å…¬æ°‘</h3><ul><li>å‡½æ•°æ˜¯â€å¤´ç­‰å…¬æ°‘â€,å¯ä»¥ä½œä¸ºå‚æ•°ä¼ é€’,è¿”å›å€¼,èµ‹å€¼ç»™å˜é‡ç­‰ã€‚</li><li>å…è®¸ç¼–å†™é«˜é˜¶å‡½æ•°,å¢å¼ºäº†ä»£ç çš„çµæ´»æ€§å’Œè¡¨è¾¾åŠ›ã€‚</li></ul><blockquote><p>å‡½æ•°æ²¡ä»€ä¹ˆç‰¹æ®Šçš„ï¼Œä½ å¯ä»¥åƒå¯¹å¾…ä»»ä½•å…¶ä»–æ•°æ®ç±»å‹ä¸€æ ·å¯¹å¾…å®ƒä»¬â€”â€”æŠŠå®ƒä»¬å­˜åœ¨æ•°ç»„é‡Œï¼Œå½“ä½œå‚æ•°ä¼ é€’ï¼Œèµ‹å€¼ç»™å˜é‡â€¦ç­‰ç­‰ã€‚</p></blockquote><p>å…·ä½“æ¥è¯´,çœ‹çœ‹åˆ«äººçš„ä¾‹å­</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> hi = <span class="function"><span class="params">name</span> =&gt;</span> <span class="string">`Hi <span class="subst">$&#123;name&#125;</span>`</span>;</span><br><span class="line"><span class="keyword">const</span> greeting = <span class="function"><span class="params">name</span> =&gt;</span> hi(name); <span class="comment">// æ²¡æœ‰å¿…è¦çš„æ“ä½œ</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> greeting = hi; <span class="comment">// ç›¸åŒçš„ä½œç”¨</span></span><br><span class="line">greeting(<span class="string">&quot;times&quot;</span>); <span class="comment">// &quot;Hi times&quot;</span></span><br></pre></td></tr></table></figure><p>å†æ¥ä¸€ä¸ªä¾‹å­</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¿™è¡Œ</span></span><br><span class="line">ajaxCall(<span class="function"><span class="params">json</span> =&gt;</span> callback(json));</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç­‰ä»·äºè¿™è¡Œ</span></span><br><span class="line">ajaxCall(callback);</span><br><span class="line"></span><br><span class="line"><span class="comment">// é‚£ä¹ˆï¼Œé‡æ„ä¸‹ getServerStuff</span></span><br><span class="line"><span class="keyword">const</span> getServerStuff = <span class="function"><span class="params">callback</span> =&gt;</span> ajaxCall(callback);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ...å°±ç­‰äº</span></span><br><span class="line"><span class="keyword">const</span> getServerStuff = ajaxCall <span class="comment">// &lt;-- çœ‹ï¼Œæ²¡æœ‰æ‹¬å·å“¦</span></span><br></pre></td></tr></table></figure><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> BlogController = &#123;</span><br><span class="line">  <span class="built_in">index</span>(posts) &#123; <span class="keyword">return</span> Views.<span class="built_in">index</span>(posts); &#125;,</span><br><span class="line">  show(<span class="keyword">post</span>) &#123; <span class="keyword">return</span> Views.show(<span class="keyword">post</span>); &#125;,</span><br><span class="line">  create(attrs) &#123; <span class="keyword">return</span> <span class="keyword">Db</span>.create(attrs); &#125;,</span><br><span class="line">  <span class="keyword">update</span>(<span class="keyword">post</span>, attrs) &#123; <span class="keyword">return</span> <span class="keyword">Db</span>.<span class="keyword">update</span>(<span class="keyword">post</span>, attrs); &#125;,</span><br><span class="line">  destroy(<span class="keyword">post</span>) &#123; <span class="keyword">return</span> <span class="keyword">Db</span>.destroy(<span class="keyword">post</span>); &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> BlogController = &#123;</span><br><span class="line">  index: Views.index,</span><br><span class="line">  show: Views.show,</span><br><span class="line">  create: <span class="keyword">Db</span>.create,</span><br><span class="line">  <span class="keyword">update</span>: <span class="keyword">Db</span>.<span class="keyword">update</span>,</span><br><span class="line">  destroy: <span class="keyword">Db</span>.destroy,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>è¿™æ ·ä¿®æ”¹æœ‰ä»€ä¹ˆæ„ä¹‰?=&gt;é™¤äº†èŠ‚çœä»£ç ,å‡å°‘å†—ä½™ä¹‹å¤–,å¤–é¢çš„å‡½æ•°ä¿®æ”¹å,é‡Œé¢çš„å‡½æ•°å¯ä»¥ä¸ç”¨æ”¹äº†.è¿™ä¹Ÿå¢åŠ äº†å¯é‡ç”¨æ€§,è¯´åˆ°å¯é‡ç”¨æ€§,è¿˜æœ‰ä¸€ç‚¹å°±æ˜¯åœ¨ä¸æ¶‰åŠåˆ°å…·ä½“ä¸šåŠ¡çš„å‡½æ•°ä¸Šå‘½ååº”è¯¥æ›´åŠ é€šç”¨.</p><p>å¦å¤–æ¶‰åŠåˆ°ç±»ä¼¼jsä¸­çš„thiså€¼æ—¶æœ€å¥½ä½¿ç”¨bind,applyç­‰ç»‘å®šé¿å…å‡ºé”™.</p><h3 id="çº¯å‡½æ•°"><a href="#çº¯å‡½æ•°" class="headerlink" title="çº¯å‡½æ•°"></a>çº¯å‡½æ•°</h3><p>çº¯å‡½æ•°(Pure Function)æ˜¯å‡½æ•°å¼ç¼–ç¨‹ä¸­çš„ä¸€ä¸ªæ ¸å¿ƒæ¦‚å¿µã€‚å®ƒæœ‰ä»¥ä¸‹å‡ ä¸ªç‰¹ç‚¹:</p><ol><li><strong>æ— å‰¯ä½œç”¨(No Side Effects)</strong>:<ul><li><strong>çº¯å‡½æ•°ä¸ä¼šä¿®æ”¹å‡½æ•°å¤–éƒ¨çš„ä»»ä½•çŠ¶æ€</strong>,å¦‚å…¨å±€å˜é‡ã€I/Oæ“ä½œç­‰ã€‚</li><li><strong>åªä¾èµ–äºè¾“å…¥å‚æ•°</strong>,ä¸ä¼šäº§ç”Ÿæ„å¤–çš„è¾“å‡ºã€‚</li></ul></li><li><strong>ç¡®å®šæ€§(Deterministic)</strong>:<ul><li>å¯¹äºç›¸åŒçš„è¾“å…¥,çº¯å‡½æ•°æ€»æ˜¯è¿”å›ç›¸åŒçš„è¾“å‡ºã€‚</li><li>æ²¡æœ‰â€éšè—çš„â€ä¾èµ–æˆ–çŠ¶æ€ä¼šå½±å“å‡½æ•°çš„ç»“æœã€‚</li></ul></li><li><strong>å¯æµ‹è¯•æ€§(Testable)</strong>:<ul><li>çº¯å‡½æ•°æ˜“äºå•å…ƒæµ‹è¯•,å› ä¸ºä¸éœ€è¦è€ƒè™‘å¤–éƒ¨ç¯å¢ƒçš„å½±å“ã€‚</li><li>å¯ä»¥ç‹¬ç«‹åœ°æµ‹è¯•æ¯ä¸ªå‡½æ•°,ä¸ä¼šå—åˆ°å…¶ä»–å‡½æ•°çš„å¹²æ‰°ã€‚</li></ul></li><li><strong>å¯ç»„åˆæ€§(Composable)</strong>:<ul><li>çº¯å‡½æ•°å¯ä»¥è¢«è½»æ¾åœ°ç»„åˆæˆæ›´å¤æ‚çš„åŠŸèƒ½ã€‚</li><li>å‡½æ•°çš„è¾“å‡ºå¯ä»¥ä½œä¸ºå¦ä¸€ä¸ªå‡½æ•°çš„è¾“å…¥,å½¢æˆç®¡é“å¼çš„æ•°æ®å¤„ç†ã€‚</li></ul></li><li><strong>å¹¶å‘æ€§(Concurrency)</strong>:<ul><li>ç”±äºæ²¡æœ‰å‰¯ä½œç”¨,çº¯å‡½æ•°å¯ä»¥å®‰å…¨åœ°åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­å¹¶å‘æ‰§è¡Œã€‚</li><li>ä¸éœ€è¦æ‹…å¿ƒç«äº‰æ¡ä»¶å’ŒåŒæ­¥é—®é¢˜ã€‚</li></ul></li></ol><p>é€šå¸¸æˆ‘ä»¬å®šä¹‰è¾“å…¥è¾“å‡ºï¼ˆIOï¼‰æ˜¯ä¸çº¯çš„ï¼Œå› ä¸º<strong>IOæ“ä½œä¸ä»…æ“ä½œäº†æ•°æ®ï¼Œè¿˜æ“ä½œäº†è¿™ä¸ªæ•°æ®èŒƒç•´å¤–éƒ¨çš„ä¸–ç•Œï¼Œæ¯”å¦‚æ‰“å°ã€æ’­æ”¾å£°éŸ³ã€ä¿®æ”¹å˜é‡çŠ¶æ€ã€ç½‘ç»œè¯·æ±‚ç­‰ã€‚è¿™äº›æ“ä½œå¹¶ä¸æ˜¯è¯´å¯¹ç¨‹åºé€ æˆäº†ç ´åï¼Œç›¸åï¼Œä¸€ä¸ªå®Œæ•´çš„ç¨‹åºä¸€å®šæ˜¯éœ€è¦å®ƒä»¬çš„ï¼Œä¸ç„¶æˆ‘ä»¬çš„æ‰€æœ‰è®¡ç®—éƒ½å°†æ¯«æ— æ„ä¹‰</strong>ã€‚</p><p>ä½†çº¯å‡½æ•°æ˜¯å¯é¢„æµ‹çš„ï¼Œå¼•ç”¨é€æ˜çš„ï¼Œæˆ‘ä»¬å¸Œæœ›ä»£ç ä¸­æ›´å¤šåœ°å‡ºç°çº¯å‡½æ•°å¼çš„ä»£ç ï¼Œ<strong>è¿™æ ·çš„ä»£ç å¯ä»¥è¢«é¢„æµ‹ï¼Œå¯ä»¥è¢«è¡¨è¾¾å¼æ›¿æ¢ï¼Œè€Œæ›´å¤šåœ°æŠŠIOæ“ä½œæ”¾åˆ°ä¸€ä¸ªç»Ÿä¸€çš„ä½ç½®åšå¤„ç†</strong></p><blockquote><p><em>å‰¯ä½œç”¨</em>æ˜¯åœ¨è®¡ç®—ç»“æœçš„è¿‡ç¨‹ä¸­ï¼Œç³»ç»ŸçŠ¶æ€çš„ä¸€ç§å˜åŒ–ï¼Œæˆ–è€…ä¸å¤–éƒ¨ä¸–ç•Œè¿›è¡Œçš„<em>å¯è§‚å¯Ÿçš„äº¤äº’</em>ã€‚</p></blockquote><p>æ­¤å¤–ä¼šå¯¹è¾“å…¥æ•°æ®åŸåœ°æ”¹å˜çš„å‡½æ•°ä¹Ÿæ˜¯ä¸çº¯çš„ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> xs = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// çº¯çš„</span></span><br><span class="line">xs.slice(<span class="number">0</span>,<span class="number">3</span>);</span><br><span class="line"><span class="comment">//=&gt; [1,2,3]</span></span><br><span class="line"></span><br><span class="line">xs.slice(<span class="number">0</span>,<span class="number">3</span>);</span><br><span class="line"><span class="comment">//=&gt; [1,2,3]</span></span><br><span class="line"></span><br><span class="line">xs.slice(<span class="number">0</span>,<span class="number">3</span>);</span><br><span class="line"><span class="comment">//=&gt; [1,2,3]</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸çº¯çš„</span></span><br><span class="line">xs.splice(<span class="number">0</span>,<span class="number">3</span>);</span><br><span class="line"><span class="comment">//=&gt; [1,2,3]</span></span><br><span class="line"></span><br><span class="line">xs.splice(<span class="number">0</span>,<span class="number">3</span>);</span><br><span class="line"><span class="comment">//=&gt; [4,5]</span></span><br><span class="line"></span><br><span class="line">xs.splice(<span class="number">0</span>,<span class="number">3</span>);</span><br><span class="line"><span class="comment">//=&gt; []</span></span><br></pre></td></tr></table></figure><h4 id="è¿½æ±‚â€œçº¯â€çš„ç†ç”±"><a href="#è¿½æ±‚â€œçº¯â€çš„ç†ç”±" class="headerlink" title="è¿½æ±‚â€œçº¯â€çš„ç†ç”±"></a>è¿½æ±‚â€œçº¯â€çš„ç†ç”±</h4><p>from <a href="https://llh911001.gitbooks.io/mostly-adequate-guide-chinese/content/ch3.html">ç¬¬ 3 ç« : çº¯å‡½æ•°çš„å¥½å¤„ Â· å‡½æ•°å¼ç¼–ç¨‹æŒ‡åŒ— (gitbooks.io)</a></p><p><strong>å¯ç¼“å­˜æ€§ï¼ˆCacheableï¼‰</strong></p><p>é¦–å…ˆï¼Œçº¯å‡½æ•°æ€»èƒ½å¤Ÿæ ¹æ®è¾“å…¥æ¥åšç¼“å­˜ã€‚å®ç°ç¼“å­˜çš„ä¸€ç§å…¸å‹æ–¹å¼æ˜¯ memoize æŠ€æœ¯ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> squareNumber  = memoize(<span class="function"><span class="keyword">function</span>(<span class="params">x</span>)</span>&#123; <span class="keyword">return</span> x*x; &#125;);</span><br><span class="line"></span><br><span class="line">squareNumber(<span class="number">4</span>);</span><br><span class="line"><span class="comment">//=&gt; 16</span></span><br><span class="line"></span><br><span class="line">squareNumber(<span class="number">4</span>); <span class="comment">// ä»ç¼“å­˜ä¸­è¯»å–è¾“å…¥å€¼ä¸º 4 çš„ç»“æœ</span></span><br><span class="line"><span class="comment">//=&gt; 16</span></span><br><span class="line"></span><br><span class="line">squareNumber(<span class="number">5</span>);</span><br><span class="line"><span class="comment">//=&gt; 25</span></span><br><span class="line"></span><br><span class="line">squareNumber(<span class="number">5</span>); <span class="comment">// ä»ç¼“å­˜ä¸­è¯»å–è¾“å…¥å€¼ä¸º 5 çš„ç»“æœ</span></span><br><span class="line"><span class="comment">//=&gt; 25</span></span><br></pre></td></tr></table></figure><p>ä¸‹é¢çš„ä»£ç æ˜¯ä¸€ä¸ªç®€å•çš„å®ç°ï¼Œå°½ç®¡å®ƒä¸å¤ªå¥å£®ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> memoize = <span class="function"><span class="keyword">function</span>(<span class="params">f</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> cache = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> arg_str = <span class="built_in">JSON</span>.stringify(<span class="built_in">arguments</span>);</span><br><span class="line">    cache[arg_str] = cache[arg_str] || f.apply(f, <span class="built_in">arguments</span>);</span><br><span class="line">    <span class="keyword">return</span> cache[arg_str];</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>å€¼å¾—æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œå¯ä»¥é€šè¿‡å»¶è¿Ÿæ‰§è¡Œçš„æ–¹å¼æŠŠä¸çº¯çš„å‡½æ•°è½¬æ¢ä¸ºçº¯å‡½æ•°ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> pureHttpCall = memoize(<span class="function"><span class="keyword">function</span>(<span class="params">url, params</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="keyword">return</span> $.getJSON(url, params); &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæœ‰è¶£çš„åœ°æ–¹åœ¨äºæˆ‘ä»¬å¹¶æ²¡æœ‰çœŸæ­£å‘é€ http è¯·æ±‚â€”â€”åªæ˜¯è¿”å›äº†ä¸€ä¸ªå‡½æ•°ï¼Œå½“è°ƒç”¨å®ƒçš„æ—¶å€™æ‰ä¼šå‘è¯·æ±‚ã€‚è¿™ä¸ªå‡½æ•°ä¹‹æ‰€ä»¥æœ‰èµ„æ ¼æˆä¸ºçº¯å‡½æ•°ï¼Œæ˜¯å› ä¸ºå®ƒæ€»æ˜¯ä¼šæ ¹æ®ç›¸åŒçš„è¾“å…¥è¿”å›ç›¸åŒçš„è¾“å‡ºï¼šç»™å®šäº† <code>url</code> å’Œ <code>params</code> ä¹‹åï¼Œå®ƒå°±åªä¼šè¿”å›åŒä¸€ä¸ªå‘é€ http è¯·æ±‚çš„å‡½æ•°ã€‚</p><p>æˆ‘ä»¬çš„ <code>memoize</code> å‡½æ•°å·¥ä½œèµ·æ¥æ²¡æœ‰ä»»ä½•é—®é¢˜ï¼Œè™½ç„¶å®ƒç¼“å­˜çš„å¹¶ä¸æ˜¯ http è¯·æ±‚æ‰€è¿”å›çš„ç»“æœï¼Œè€Œæ˜¯ç”Ÿæˆçš„å‡½æ•°ã€‚</p><p>ç°åœ¨æ¥çœ‹è¿™ç§æ–¹å¼æ„ä¹‰ä¸å¤§ï¼Œä¸è¿‡å¾ˆå¿«æˆ‘ä»¬å°±ä¼šå­¦ä¹ ä¸€äº›æŠ€å·§æ¥å‘æ˜å®ƒçš„ç”¨å¤„ã€‚é‡ç‚¹æ˜¯<strong>å¯ä»¥ç¼“å­˜ä»»æ„ä¸€ä¸ªå‡½æ•°ï¼Œä¸ç®¡å®ƒä»¬çœ‹èµ·æ¥å¤šä¹ˆå…·æœ‰ç ´åæ€§</strong>ã€‚</p><p><strong>å¯ç§»æ¤æ€§ï¼è‡ªæ–‡æ¡£åŒ–ï¼ˆPortable / Self-Documentingï¼‰</strong></p><p>çº¯å‡½æ•°æ˜¯å®Œå…¨è‡ªç»™è‡ªè¶³çš„ï¼Œå®ƒéœ€è¦çš„æ‰€æœ‰ä¸œè¥¿éƒ½èƒ½è½»æ˜“è·å¾—ã€‚ä»”ç»†æ€è€ƒæ€è€ƒè¿™ä¸€ç‚¹â€¦è¿™ç§è‡ªç»™è‡ªè¶³çš„å¥½å¤„æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿé¦–å…ˆï¼Œçº¯å‡½æ•°çš„ä¾èµ–å¾ˆæ˜ç¡®ï¼Œå› æ­¤æ›´æ˜“äºè§‚å¯Ÿå’Œç†è§£â€”â€”æ²¡æœ‰å·å·æ‘¸æ‘¸çš„å°åŠ¨ä½œã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¸çº¯çš„</span></span><br><span class="line"><span class="keyword">var</span> signUp = <span class="function"><span class="keyword">function</span>(<span class="params">attrs</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> user = saveUser(attrs);</span><br><span class="line">  welcomeUser(user);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> saveUser = <span class="function"><span class="keyword">function</span>(<span class="params">attrs</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> user = Db.save(attrs);</span><br><span class="line">    ...</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> welcomeUser = <span class="function"><span class="keyword">function</span>(<span class="params">user</span>) </span>&#123;</span><br><span class="line">    Email(user, ...);</span><br><span class="line">    ...</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// çº¯çš„</span></span><br><span class="line"><span class="keyword">var</span> signUp = <span class="function"><span class="keyword">function</span>(<span class="params">Db, Email, attrs</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> user = saveUser(Db, attrs);</span><br><span class="line">    welcomeUser(Email, user);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> saveUser = <span class="function"><span class="keyword">function</span>(<span class="params">Db, attrs</span>) </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> welcomeUser = <span class="function"><span class="keyword">function</span>(<span class="params">Email, user</span>) </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªä¾‹å­è¡¨æ˜ï¼Œçº¯å‡½æ•°å¯¹äºå…¶ä¾èµ–å¿…é¡»è¦è¯šå®ï¼Œè¿™æ ·æˆ‘ä»¬å°±èƒ½çŸ¥é“å®ƒçš„ç›®çš„ã€‚ä»…ä»çº¯å‡½æ•°ç‰ˆæœ¬çš„ <code>signUp</code> çš„ç­¾åå°±å¯ä»¥çœ‹å‡ºï¼Œå®ƒå°†è¦ç”¨åˆ° <code>Db</code>ã€<code>Email</code> å’Œ <code>attrs</code>ï¼Œè¿™åœ¨æœ€å°ç¨‹åº¦ä¸Šç»™äº†æˆ‘ä»¬è¶³å¤Ÿå¤šçš„ä¿¡æ¯ã€‚</p><p>åé¢æˆ‘ä»¬ä¼šå­¦ä¹ å¦‚ä½•<strong>ä¸é€šè¿‡è¿™ç§ä»…ä»…æ˜¯å»¶è¿Ÿæ‰§è¡Œçš„æ–¹å¼æ¥è®©ä¸€ä¸ªå‡½æ•°å˜çº¯ï¼Œä¸è¿‡è¿™é‡Œçš„é‡ç‚¹åº”è¯¥å¾ˆæ¸…æ¥šï¼Œé‚£å°±æ˜¯ç›¸æ¯”ä¸çº¯çš„å‡½æ•°ï¼Œçº¯å‡½æ•°èƒ½å¤Ÿæä¾›å¤šå¾—å¤šçš„ä¿¡æ¯</strong></p><p>å…¶æ¬¡ï¼Œé€šè¿‡å¼ºè¿«â€œæ³¨å…¥â€ä¾èµ–ï¼Œæˆ–è€…æŠŠå®ƒä»¬å½“ä½œå‚æ•°ä¼ é€’ï¼Œæˆ‘ä»¬çš„åº”ç”¨ä¹Ÿæ›´åŠ çµæ´»ï¼›å› ä¸ºæ•°æ®åº“æˆ–è€…é‚®ä»¶å®¢æˆ·ç«¯ç­‰ç­‰éƒ½å‚æ•°åŒ–äº†ï¼ˆåˆ«æ‹…å¿ƒï¼Œæˆ‘ä»¬æœ‰åŠæ³•è®©è¿™ç§æ–¹å¼ä¸é‚£ä¹ˆå•è°ƒä¹å‘³ï¼‰ã€‚å¦‚æœè¦ä½¿ç”¨å¦ä¸€ä¸ª <code>Db</code>ï¼Œåªéœ€æŠŠå®ƒä¼ ç»™å‡½æ•°å°±è¡Œäº†ã€‚å¦‚æœæƒ³åœ¨ä¸€ä¸ªæ–°åº”ç”¨ä¸­ä½¿ç”¨è¿™ä¸ªå¯é çš„å‡½æ•°ï¼Œå°½ç®¡æŠŠæ–°çš„ <code>Db</code> å’Œ <code>Email</code> ä¼ é€’è¿‡å»å°±å¥½äº†ï¼Œéå¸¸ç®€å•ã€‚</p><p>åœ¨ JavaScript çš„è®¾å®šä¸­ï¼Œå¯ç§»æ¤æ€§å¯ä»¥æ„å‘³ç€æŠŠå‡½æ•°åºåˆ—åŒ–ï¼ˆserializingï¼‰å¹¶é€šè¿‡ socket å‘é€ã€‚ä¹Ÿå¯ä»¥æ„å‘³ç€ä»£ç èƒ½å¤Ÿåœ¨ web workers ä¸­è¿è¡Œã€‚æ€»ä¹‹ï¼Œå¯ç§»æ¤æ€§æ˜¯ä¸€ä¸ªéå¸¸å¼ºå¤§çš„ç‰¹æ€§ã€‚</p><p>å‘½ä»¤å¼ç¼–ç¨‹ä¸­â€œå…¸å‹â€çš„æ–¹æ³•å’Œè¿‡ç¨‹éƒ½æ·±æ·±åœ°æ ¹æ¤äºå®ƒä»¬æ‰€åœ¨çš„ç¯å¢ƒä¸­ï¼Œé€šè¿‡çŠ¶æ€ã€ä¾èµ–å’Œæœ‰æ•ˆä½œç”¨ï¼ˆavailable effectsï¼‰è¾¾æˆï¼›çº¯å‡½æ•°ä¸æ­¤ç›¸åï¼Œå®ƒä¸ç¯å¢ƒæ— å…³ï¼Œåªè¦æˆ‘ä»¬æ„¿æ„ï¼Œå¯ä»¥åœ¨ä»»ä½•åœ°æ–¹è¿è¡Œå®ƒã€‚</p><p>ä½ ä¸Šä¸€æ¬¡æŠŠæŸä¸ªç±»æ–¹æ³•æ‹·è´åˆ°æ–°çš„åº”ç”¨ä¸­æ˜¯ä»€ä¹ˆæ—¶å€™ï¼Ÿæˆ‘æœ€å–œæ¬¢çš„åè¨€ä¹‹ä¸€æ˜¯ Erlang è¯­è¨€çš„ä½œè€… Joe Armstrong è¯´çš„è¿™å¥è¯ï¼šâ€œé¢å‘å¯¹è±¡è¯­è¨€çš„é—®é¢˜æ˜¯ï¼Œå®ƒä»¬æ°¸è¿œéƒ½è¦éšèº«æºå¸¦é‚£äº›éšå¼çš„ç¯å¢ƒã€‚ä½ åªéœ€è¦ä¸€ä¸ªé¦™è•‰ï¼Œä½†å´å¾—åˆ°ä¸€ä¸ªæ‹¿ç€é¦™è•‰çš„å¤§çŒ©çŒ©â€¦ä»¥åŠæ•´ä¸ªä¸›æ—â€ã€‚</p><p><strong>å¯æµ‹è¯•æ€§ï¼ˆTestableï¼‰</strong></p><p>ç¬¬ä¸‰ç‚¹ï¼Œçº¯å‡½æ•°è®©æµ‹è¯•æ›´åŠ å®¹æ˜“ã€‚æˆ‘ä»¬ä¸éœ€è¦ä¼ªé€ ä¸€ä¸ªâ€œçœŸå®çš„â€æ”¯ä»˜ç½‘å…³ï¼Œæˆ–è€…æ¯ä¸€æ¬¡æµ‹è¯•ä¹‹å‰éƒ½è¦é…ç½®ã€ä¹‹åéƒ½è¦æ–­è¨€çŠ¶æ€ï¼ˆassert the stateï¼‰ã€‚åªéœ€ç®€å•åœ°ç»™å‡½æ•°ä¸€ä¸ªè¾“å…¥ï¼Œç„¶åæ–­è¨€è¾“å‡ºå°±å¥½äº†ã€‚</p><p>äº‹å®ä¸Šï¼Œæˆ‘ä»¬å‘ç°å‡½æ•°å¼ç¼–ç¨‹çš„ç¤¾åŒºæ­£åœ¨å¼€åˆ›ä¸€äº›æ–°çš„æµ‹è¯•å·¥å…·ï¼Œèƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬è‡ªåŠ¨ç”Ÿæˆè¾“å…¥å¹¶æ–­è¨€è¾“å‡ºã€‚è¿™è¶…å‡ºäº†æœ¬ä¹¦èŒƒå›´ï¼Œä½†æ˜¯æˆ‘å¼ºçƒˆæ¨èä½ å»è¯•è¯• <em>Quickcheck</em>â€”â€”ä¸€ä¸ªä¸ºå‡½æ•°å¼ç¯å¢ƒé‡èº«å®šåˆ¶çš„æµ‹è¯•å·¥å…·ã€‚</p><p><strong>åˆç†æ€§ï¼ˆReasonableï¼‰</strong></p><p>å¾ˆå¤šäººç›¸ä¿¡ä½¿ç”¨çº¯å‡½æ•°æœ€å¤§çš„å¥½å¤„æ˜¯<em>å¼•ç”¨é€æ˜æ€§</em>ï¼ˆreferential transparencyï¼‰ã€‚å¦‚æœä¸€æ®µä»£ç å¯ä»¥æ›¿æ¢æˆå®ƒæ‰§è¡Œæ‰€å¾—çš„ç»“æœï¼Œè€Œä¸”æ˜¯åœ¨ä¸æ”¹å˜æ•´ä¸ªç¨‹åºè¡Œä¸ºçš„å‰æä¸‹æ›¿æ¢çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±è¯´è¿™æ®µä»£ç æ˜¯å¼•ç”¨é€æ˜çš„ã€‚</p><p>ç”±äºçº¯å‡½æ•°æ€»æ˜¯èƒ½å¤Ÿæ ¹æ®ç›¸åŒçš„è¾“å…¥è¿”å›ç›¸åŒçš„è¾“å‡ºï¼Œæ‰€ä»¥å®ƒä»¬å°±èƒ½å¤Ÿä¿è¯æ€»æ˜¯è¿”å›åŒä¸€ä¸ªç»“æœï¼Œè¿™ä¹Ÿå°±ä¿è¯äº†å¼•ç”¨é€æ˜æ€§ã€‚æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¾‹å­ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Immutable = <span class="built_in">require</span>(<span class="string">&#x27;immutable&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> decrementHP = <span class="function"><span class="keyword">function</span>(<span class="params">player</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> player.set(<span class="string">&quot;hp&quot;</span>, player.hp-<span class="number">1</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> isSameTeam = <span class="function"><span class="keyword">function</span>(<span class="params">player1, player2</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> player1.team === player2.team;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> punch = <span class="function"><span class="keyword">function</span>(<span class="params">player, target</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(isSameTeam(player, target)) &#123;</span><br><span class="line">    <span class="keyword">return</span> target;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> decrementHP(target);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> jobe = Immutable.Map(&#123;<span class="attr">name</span>:<span class="string">&quot;Jobe&quot;</span>, <span class="attr">hp</span>:<span class="number">20</span>, <span class="attr">team</span>: <span class="string">&quot;red&quot;</span>&#125;);</span><br><span class="line"><span class="keyword">var</span> michael = Immutable.Map(&#123;<span class="attr">name</span>:<span class="string">&quot;Michael&quot;</span>, <span class="attr">hp</span>:<span class="number">20</span>, <span class="attr">team</span>: <span class="string">&quot;green&quot;</span>&#125;);</span><br><span class="line"></span><br><span class="line">punch(jobe, michael);</span><br><span class="line"><span class="comment">//=&gt; Immutable.Map(&#123;name:&quot;Michael&quot;, hp:19, team: &quot;green&quot;&#125;)</span></span><br></pre></td></tr></table></figure><p><code>decrementHP</code>ã€<code>isSameTeam</code> å’Œ <code>punch</code> éƒ½æ˜¯çº¯å‡½æ•°ï¼Œæ‰€ä»¥æ˜¯å¼•ç”¨é€æ˜çš„ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ç§å«åšâ€œç­‰å¼æ¨å¯¼â€ï¼ˆequational reasoningï¼‰çš„æŠ€æœ¯æ¥åˆ†æä»£ç ã€‚æ‰€è°“â€œç­‰å¼æ¨å¯¼â€å°±æ˜¯â€œä¸€å¯¹ä¸€â€æ›¿æ¢ï¼Œæœ‰ç‚¹åƒåœ¨ä¸è€ƒè™‘ç¨‹åºæ€§æ‰§è¡Œçš„æ€ªå¼‚è¡Œä¸ºï¼ˆquirks of programmatic evaluationï¼‰çš„æƒ…å†µä¸‹ï¼Œæ‰‹åŠ¨æ‰§è¡Œç›¸å…³ä»£ç ã€‚æˆ‘ä»¬å€ŸåŠ©å¼•ç”¨é€æ˜æ€§æ¥å‰–æä¸€ä¸‹è¿™æ®µä»£ç ã€‚</p><p>é¦–å…ˆå†…è” <code>isSameTeam</code> å‡½æ•°ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> punch = <span class="function"><span class="keyword">function</span>(<span class="params">player, target</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(player.team === target.team) &#123;</span><br><span class="line">    <span class="keyword">return</span> target;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> decrementHP(target);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>å› ä¸ºæ˜¯ä¸å¯å˜æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥æŠŠ <code>team</code> æ›¿æ¢ä¸ºå®é™…å€¼ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> punch = <span class="function"><span class="keyword">function</span>(<span class="params">player, target</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(<span class="string">&quot;red&quot;</span> === <span class="string">&quot;green&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> target;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> decrementHP(target);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><code>if</code> è¯­å¥æ‰§è¡Œç»“æœä¸º <code>false</code>ï¼Œæ‰€ä»¥å¯ä»¥æŠŠæ•´ä¸ª <code>if</code> è¯­å¥éƒ½åˆ æ‰ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> punch = <span class="function"><span class="keyword">function</span>(<span class="params">player, target</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> decrementHP(target);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>å¦‚æœå†å†…è” <code>decrementHP</code>ï¼Œæˆ‘ä»¬ä¼šå‘ç°è¿™ç§æƒ…å†µä¸‹ï¼Œ<code>punch</code> å˜æˆäº†ä¸€ä¸ªè®© <code>hp</code> çš„å€¼å‡ 1 çš„è°ƒç”¨ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> punch = <span class="function"><span class="keyword">function</span>(<span class="params">player, target</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> target.set(<span class="string">&quot;hp&quot;</span>, target.hp-<span class="number">1</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>æ€»ä¹‹ï¼Œç­‰å¼æ¨å¯¼å¸¦æ¥çš„åˆ†æä»£ç çš„èƒ½åŠ›å¯¹é‡æ„å’Œç†è§£ä»£ç éå¸¸é‡è¦ã€‚äº‹å®ä¸Šï¼Œæˆ‘ä»¬é‡æ„æµ·é¸¥ç¨‹åºä½¿ç”¨çš„æ­£æ˜¯è¿™é¡¹æŠ€æœ¯ï¼šåˆ©ç”¨åŠ å’Œä¹˜çš„ç‰¹æ€§ã€‚å¯¹è¿™äº›æŠ€æœ¯çš„ä½¿ç”¨å°†ä¼šè´¯ç©¿æœ¬ä¹¦ï¼ŒçœŸçš„ã€‚</p><p><strong>å¹¶è¡Œä»£ç </strong></p><p>å› ä¸ºå¯ä»¥å¹¶è¡Œè¿è¡Œä»»æ„çº¯å‡½æ•°ã€‚å› ä¸ºçº¯å‡½æ•°æ ¹æœ¬ä¸éœ€è¦è®¿é—®å…±äº«çš„å†…å­˜ï¼Œè€Œä¸”æ ¹æ®å…¶å®šä¹‰ï¼Œçº¯å‡½æ•°ä¹Ÿä¸ä¼šå› å‰¯ä½œç”¨è€Œè¿›å…¥ç«äº‰æ€ï¼ˆrace conditionï¼‰ã€‚</p><p>å¹¶è¡Œä»£ç åœ¨æœåŠ¡ç«¯ js ç¯å¢ƒä»¥åŠä½¿ç”¨äº† web worker çš„æµè§ˆå™¨é‚£é‡Œæ˜¯éå¸¸å®¹æ˜“å®ç°çš„ï¼Œå› ä¸ºå®ƒä»¬ä½¿ç”¨äº†çº¿ç¨‹ï¼ˆthreadï¼‰ã€‚ä¸è¿‡å‡ºäºå¯¹éçº¯å‡½æ•°å¤æ‚åº¦çš„è€ƒè™‘ï¼Œå½“å‰ä¸»æµè§‚ç‚¹è¿˜æ˜¯é¿å…ä½¿ç”¨è¿™ç§å¹¶è¡Œã€‚</p><h3 id="ç»„åˆ"><a href="#ç»„åˆ" class="headerlink" title="ç»„åˆ"></a>ç»„åˆ</h3><p>å¦‚æœä¸€ä¸ªå€¼è¦ç»è¿‡å¤šä¸ªå‡½æ•°ï¼Œæ‰èƒ½å˜æˆå¦å¤–ä¸€ä¸ªå€¼ï¼Œå°±å¯ä»¥æŠŠæ‰€æœ‰ä¸­é—´æ­¥éª¤åˆå¹¶æˆä¸€ä¸ªå‡½æ•°ï¼Œè¿™å«åšâ€å‡½æ•°çš„åˆæˆâ€ï¼ˆcomposeï¼‰</p><p>å°†è®¡ç®—è¿‡ç¨‹åˆ†è§£æˆå¯å¤ç”¨çš„å‡½æ•°ï¼Œå…¸å‹ä¾‹å­å°±æ˜¯<code>map</code>æ–¹æ³•å’Œ<code>reduce</code>æ–¹æ³•ç»„åˆè€ŒæˆMapReduceç®—æ³•</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">compose(f, compose(g, h))</span><br><span class="line"><span class="comment">// ç­‰åŒäº</span></span><br><span class="line">compose(compose(f, g), h)</span><br><span class="line"><span class="comment">// ç­‰åŒäº</span></span><br><span class="line">compose(f, g, h)</span><br></pre></td></tr></table></figure><h3 id="æŸ¯é‡ŒåŒ–"><a href="#æŸ¯é‡ŒåŒ–" class="headerlink" title="æŸ¯é‡ŒåŒ–"></a>æŸ¯é‡ŒåŒ–</h3><p>åœ¨å­¦ä¹ JSçš„æ—¶å€™,ä½ å¯èƒ½å·²ç»æ³¨æ„åˆ°è¿™ä¸ªæ¦‚å¿µäº†</p><p><code>f(x)</code>å’Œ<code>g(x)</code>åˆæˆä¸º<code>f(g(x))</code>ï¼Œæœ‰ä¸€ä¸ªéšè—çš„å‰æï¼Œå°±æ˜¯<code>f</code>å’Œ<code>g</code>éƒ½åªèƒ½æ¥å—ä¸€ä¸ªå‚æ•°ã€‚å¦‚æœå¯ä»¥æ¥å—å¤šä¸ªå‚æ•°ï¼Œæ¯”å¦‚<code>f(x, y)</code>å’Œ<code>g(a, b, c)</code>ï¼Œå‡½æ•°åˆæˆå°±éå¸¸éº»çƒ¦ã€‚</p><p>è¿™æ—¶å°±éœ€è¦å‡½æ•°æŸ¯é‡ŒåŒ–äº†ã€‚æ‰€è°“â€æŸ¯é‡ŒåŒ–â€ï¼Œå°±æ˜¯æŠŠä¸€ä¸ªå¤šå‚æ•°çš„å‡½æ•°ï¼Œè½¬åŒ–ä¸ºå•å‚æ•°å‡½æ•°ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æŸ¯é‡ŒåŒ–ä¹‹å‰</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">x, y</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> x + y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">add(<span class="number">1</span>, <span class="number">2</span>) <span class="comment">// 3</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æŸ¯é‡ŒåŒ–ä¹‹å</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addX</span>(<span class="params">y</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">x</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x + y;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">addX(<span class="number">2</span>)(<span class="number">1</span>) <span class="comment">// 3</span></span><br></pre></td></tr></table></figure><p>æœ‰äº†æŸ¯é‡ŒåŒ–ä»¥åï¼Œæˆ‘ä»¬å°±èƒ½åšåˆ°ï¼Œæ‰€æœ‰å‡½æ•°åªæ¥å—ä¸€ä¸ªå‚æ•°ã€‚åæ–‡çš„å†…å®¹é™¤éå¦æœ‰è¯´æ˜ï¼Œéƒ½é»˜è®¤å‡½æ•°åªæœ‰ä¸€ä¸ªå‚æ•°ï¼Œå°±æ˜¯æ‰€è¦å¤„ç†çš„é‚£ä¸ªå€¼ã€‚</p><p>é™¤äº†ä¸Šé¢æåˆ°çš„ä¹‹å¤–,è¿˜æœ‰å¾ˆå¤šå…¶ä»–ç‰¹æ€§,å°±éœ€è¦è‡ªå·±å­¦ä¹ äº†.</p><h3 id="Functor"><a href="#Functor" class="headerlink" title="Functor"></a>Functor</h3><blockquote><p>Functorå¯ä»¥ç®€å•åœ°ç†è§£ä¸ºä¸€ä¸ªèƒ½å¤Ÿä¿å­˜å€¼,å¹¶ä¸”èƒ½å¤Ÿå¯¹è¿™äº›å€¼æ‰§è¡ŒæŸäº›æ“ä½œçš„å®¹å™¨ã€‚æ›´å…·ä½“åœ°è¯´,Functoræ˜¯ä¸€ä¸ªå®ç°äº†<code>fmap</code>å‡½æ•°çš„ç±»å‹ç±»ã€‚<code>fmap</code>å‡½æ•°å…è®¸æˆ‘ä»¬å¯¹Functorä¸­åŒ…å«çš„å€¼æ‰§è¡ŒæŸç§å˜æ¢æ“ä½œ,å¹¶å°†ç»“æœåŒ…è£…åˆ°æ–°çš„Functorä¸­è¿”å›ã€‚</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®šä¹‰ä¸€ä¸ªåˆ—è¡¨</span></span><br><span class="line">numbers = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨fmapå¯¹åˆ—è¡¨ä¸­çš„å…ƒç´ è¿›è¡Œå¹³æ–¹å˜æ¢</span></span><br><span class="line">squared_numbers = <span class="built_in">list</span>(<span class="built_in">map</span>(<span class="keyword">lambda</span> x: x**<span class="number">2</span>, numbers))</span><br><span class="line"><span class="built_in">print</span>(squared_numbers) <span class="comment"># Output: [1, 4, 9, 16, 25]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Optional</span></span><br><span class="line"><span class="comment"># Optionç±»å‹ä½œä¸ºFunctor</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">safe_divide</span>(<span class="params">a: <span class="built_in">int</span>, b: <span class="built_in">int</span></span>) -&gt; <span class="type">Optional</span>[<span class="built_in">int</span>]:</span></span><br><span class="line">    <span class="keyword">if</span> b == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> a / b</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨fmapå¯¹Optionalç±»å‹æ‰§è¡Œå˜æ¢</span></span><br><span class="line">result1 = safe_divide(<span class="number">10</span>, <span class="number">2</span>)</span><br><span class="line"><span class="built_in">print</span>(result1)  <span class="comment"># Output: 5.0</span></span><br><span class="line"></span><br><span class="line">result2 = safe_divide(<span class="number">10</span>, <span class="number">0</span>)</span><br><span class="line"><span class="built_in">print</span>(result2)  <span class="comment"># Output: None</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨fmapå¯¹Maybeç±»å‹æ‰§è¡Œå˜æ¢</span></span><br><span class="line">doubled_result1 = <span class="keyword">lambda</span> x: x * <span class="number">2</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">list</span>(<span class="built_in">map</span>(doubled_result1, [result1, result2]))) <span class="comment"># Output: [10.0, None]</span></span><br></pre></td></tr></table></figure><h3 id="Monoid"><a href="#Monoid" class="headerlink" title="Monoid"></a>Monoid</h3><blockquote><p>Monoidæ˜¯ä¸€ä¸ªå…·æœ‰ä»¥ä¸‹ä¸¤ä¸ªç‰¹æ€§çš„ä»£æ•°ç»“æ„:</p><ol><li>äºŒå…ƒæ“ä½œ(ç§°ä¸ºâ€åˆå¹¶â€æ“ä½œ)</li><li>ä¸€ä¸ªç‰¹æ®Šçš„å•ä½å…ƒ</li></ol><p>æ›´å…·ä½“åœ°è¯´,ä¸€ä¸ªç±»å‹<code>T</code>æ˜¯ä¸€ä¸ªMonoid,å¦‚æœå®ƒæ»¡è¶³ä»¥ä¸‹ä¸¤ä¸ªæ¡ä»¶:</p><ol><li>å­˜åœ¨ä¸€ä¸ªäºŒå…ƒæ“ä½œ<code>combine(a: T, b: T) -&gt; T</code>ï¼Œè¯¥æ“ä½œæ˜¯<strong>associative</strong>çš„,å³<code>combine(a, combine(b, c)) = combine(combine(a, b), c)</code>ã€‚</li><li>å­˜åœ¨ä¸€ä¸ªç‰¹æ®Šçš„å€¼<code>empty: T</code>ï¼Œè¢«ç§°ä¸ºå•ä½å…ƒ,å¯¹äºä»»æ„<code>x: T</code>éƒ½æœ‰<code>combine(x, empty) = x</code>å’Œ<code>combine(empty, x) = x</code></li></ol></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ•´æ•°æ±‚å’Œæ“ä½œ</span></span><br><span class="line">numbers1 = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">numbers2 = [<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>]</span><br><span class="line">total = <span class="built_in">sum</span>(numbers1) + <span class="built_in">sum</span>(numbers2)</span><br><span class="line"><span class="built_in">print</span>(total)  <span class="comment"># Output: 21</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 0ä½œä¸ºå•ä½å…ƒ</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">sum</span>([]) + <span class="built_in">sum</span>(numbers1))  <span class="comment"># Output: 6</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">sum</span>(numbers1) + <span class="built_in">sum</span>([]))  <span class="comment"># Output: 6</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å­—ç¬¦ä¸²æ‹¼æ¥æ“ä½œ</span></span><br><span class="line">greeting1 = <span class="string">&quot;Hello, &quot;</span></span><br><span class="line">greeting2 = <span class="string">&quot;world!&quot;</span></span><br><span class="line">combined_greeting = greeting1 + greeting2</span><br><span class="line"><span class="built_in">print</span>(combined_greeting)  <span class="comment"># Output: &quot;Hello, world!&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç©ºå­—ç¬¦ä¸²ä½œä¸ºå•ä½å…ƒ</span></span><br><span class="line">empty_string = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">print</span>(empty_string + greeting1)  <span class="comment"># Output: &quot;Hello, &quot;</span></span><br><span class="line"><span class="built_in">print</span>(greeting1 + empty_string)  <span class="comment"># Output: &quot;Hello, &quot;</span></span><br></pre></td></tr></table></figure><h3 id="Monad"><a href="#Monad" class="headerlink" title="Monad"></a>Monad</h3><blockquote><p>å¯ä»¥è¢«è§†ä¸ºFunctorçš„ä¸€ç§ç‰¹æ®Šå½¢å¼,å…·æœ‰é¢å¤–çš„æ€§è´¨å’Œæ“ä½œã€‚</p><p>ç®€å•æ¥è¯´,Monadæ˜¯ä¸€ä¸ªæ»¡è¶³ä»¥ä¸‹æ¡ä»¶çš„ç±»å‹<code>M[_]</code>:</p><ol><li>å®ƒæ˜¯ä¸€ä¸ªFunctor,å³å­˜åœ¨<code>fmap</code>æ“ä½œ,å¯ä»¥å¯¹Monadå†…éƒ¨çš„å€¼è¿›è¡Œå˜æ¢ã€‚</li><li>å®ƒå…·æœ‰ä¸€ä¸ª<code>return</code>æ“ä½œ,å¯ä»¥å°†ä¸€ä¸ªå€¼åŒ…è£…è¿›Monadã€‚</li><li>å®ƒå…·æœ‰ä¸€ä¸ª<code>flatMap</code>(æˆ–<code>bind</code>)æ“ä½œ,å¯ä»¥å¯¹Monadå†…éƒ¨çš„å€¼è¿›è¡Œå˜æ¢å¹¶â€æ‰å¹³åŒ–â€ç»“æœã€‚</li></ol></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">multiply</span>(<span class="params">x: <span class="built_in">int</span></span>) -&gt; <span class="built_in">list</span>[<span class="built_in">int</span>]:</span></span><br><span class="line">    <span class="keyword">return</span> [x, x * <span class="number">2</span>, x * <span class="number">3</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨flatMapæ“ä½œ</span></span><br><span class="line">numbers = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">results = [y <span class="keyword">for</span> x <span class="keyword">in</span> numbers <span class="keyword">for</span> y <span class="keyword">in</span> multiply(x)]</span><br><span class="line"><span class="built_in">print</span>(results)  <span class="comment"># Output: [1, 2, 3, 2, 4, 6, 3, 6, 9]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨åˆ—è¡¨æ¨å¯¼å¼å®ç°flatMap</span></span><br><span class="line">results = [multiply(x) <span class="keyword">for</span> x <span class="keyword">in</span> numbers]</span><br><span class="line"><span class="built_in">print</span>(results)  <span class="comment"># Output: [[1, 2, 3], [2, 4, 6], [3, 6, 9]]</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><a href="https://ruanyifeng.com/blog/2015/07/monad.html">å›¾è§£ Monad - é˜®ä¸€å³°çš„ç½‘ç»œæ—¥å¿— (ruanyifeng.com)</a></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// IOç±»å‹</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IO</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">effect</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>._effect = effect;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// pureæ“ä½œ</span></span><br><span class="line">  <span class="keyword">static</span> <span class="function"><span class="title">of</span>(<span class="params">value</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> IO(<span class="function">() =&gt;</span> value);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// bindæ“ä½œ</span></span><br><span class="line">  <span class="function"><span class="title">bind</span>(<span class="params">fn</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> IO(<span class="function">() =&gt;</span> fn(<span class="built_in">this</span>._effect()).run());</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">run</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>._effect();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¤ºä¾‹</span></span><br><span class="line"><span class="keyword">const</span> greet = <span class="function"><span class="params">name</span> =&gt;</span> <span class="string">`Hello, <span class="subst">$&#123;name&#125;</span>!`</span>;</span><br><span class="line"><span class="keyword">const</span> getInput = <span class="function">() =&gt;</span> prompt(<span class="string">&#x27;What is your name?&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> sayHello = <span class="keyword">new</span> IO(getInput)</span><br><span class="line">  .bind(<span class="function"><span class="params">name</span> =&gt;</span> <span class="keyword">new</span> IO(<span class="function">() =&gt;</span> greet(name)))</span><br><span class="line">  .bind(<span class="function"><span class="params">message</span> =&gt;</span> <span class="keyword">new</span> IO(<span class="function">() =&gt;</span> alert(message)));</span><br><span class="line"></span><br><span class="line">sayHello.run(); <span class="comment">// å¼¹å‡ºå¯¹è¯æ¡†å¹¶æ˜¾ç¤º&#x27;Hello, &#123;è¾“å…¥çš„åå­—&#125;!&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="Applicative"><a href="#Applicative" class="headerlink" title="Applicative"></a>Applicative</h3><blockquote><p>Applicativeå¯ä»¥è¢«è§†ä¸ºFunctorçš„ä¸€ç§ç‰¹æ®Šå½¢å¼,å…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹:</p><ol><li>å®ƒæ˜¯ä¸€ä¸ªFunctor,å³å­˜åœ¨<code>fmap</code>æ“ä½œ,å¯ä»¥å¯¹Applicativeå†…éƒ¨çš„å€¼è¿›è¡Œå˜æ¢ã€‚</li><li>å®ƒå…·æœ‰ä¸€ä¸ª<code>pure</code>æ“ä½œ,å¯ä»¥å°†ä¸€ä¸ªå€¼åŒ…è£…è¿›Applicativeã€‚</li><li>å®ƒå…·æœ‰ä¸€ä¸ª<code>ap</code>(apply)æ“ä½œ,å¯ä»¥å°†ä¸€ä¸ªå‡½æ•°åŒ…è£…è¿›Applicativeåº”ç”¨åˆ°å¦ä¸€ä¸ªApplicativeä¸Š</li></ol></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Eitherç±»å‹</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Either</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">value</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>._value = value;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> <span class="function"><span class="title">of</span>(<span class="params">value</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Right(value);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> <span class="function"><span class="title">left</span>(<span class="params">value</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Left(value);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// apæ“ä½œ</span></span><br><span class="line">  <span class="function"><span class="title">ap</span>(<span class="params">other</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span> <span class="keyword">instanceof</span> Left) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (other <span class="keyword">instanceof</span> Left) &#123;</span><br><span class="line">      <span class="keyword">return</span> other;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Right(<span class="built_in">this</span>._value(other._value));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Right</span> <span class="keyword">extends</span> <span class="title">Either</span> </span>&#123;</span><br><span class="line">  <span class="comment">// pureæ“ä½œ</span></span><br><span class="line">  <span class="keyword">static</span> <span class="function"><span class="title">of</span>(<span class="params">value</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Right(value);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Left</span> <span class="keyword">extends</span> <span class="title">Either</span> </span>&#123;</span><br><span class="line">  <span class="comment">// pureæ“ä½œ</span></span><br><span class="line">  <span class="keyword">static</span> <span class="function"><span class="title">of</span>(<span class="params">value</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Left(value);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¤ºä¾‹</span></span><br><span class="line"><span class="keyword">const</span> add = <span class="function">(<span class="params">x, y</span>) =&gt;</span> x + y;</span><br><span class="line"><span class="keyword">const</span> result1 = Either.of(add).ap(Either.of(<span class="number">3</span>)).ap(Either.of(<span class="number">4</span>)); <span class="comment">// Right(7)</span></span><br><span class="line"><span class="keyword">const</span> result2 = Either.of(add).ap(Either.of(<span class="number">3</span>)).ap(Either.left(<span class="string">&#x27;error&#x27;</span>)); <span class="comment">// Left(&#x27;error&#x27;)</span></span><br></pre></td></tr></table></figure><p><a href="https://sxyz.blog/functors-applicatives-and-monads-in-pictures/">å›¾è§£ Functorã€Applicativeã€Monad (sxyz.blog)</a></p><p><a href="https://blog.forec.cn/2017/03/02/translation-adit-faamip/">å›¾è§£ Functor, Applicative å’Œ Monad | Forecâ€™s Notes</a></p><p><img data-src="https://p0.meituan.net/travelcube/652d533cc899998d4822ac6ed58cce89128094.png" alt="å›¾ 30" style="zoom:50%;" /></p><p><strong>ä½¿ç”¨å‡½æ•°å¼ç¼–ç¨‹çš„ä¸€äº›åŸå› </strong></p><ul><li>æ–¹ä¾¿debug</li></ul><p>å› ä¸ºå†™æˆäº†å‡½æ•°,æ–¹ä¾¿å†™å•å…ƒæµ‹è¯•è€Œä¸”ç”±äºæ˜¯çº¯å‡½æ•°ï¼Œè¾“å…¥å›ºå®šé‚£è¾“å‡ºå°±æ˜¯å›ºå®šçš„</p><ul><li>ä»£ç é‡ç”¨</li></ul><p>çº¯å‡½æ•°æ–¹ä¾¿ç»„åˆä¹Ÿæ–¹ä¾¿ä½¿ç”¨</p><ul><li>å¦ä¸€ç§æ€ç»´æ–¹å¼</li></ul><p>æ˜¯çš„ï¼Œé™¤äº†OOPä¹‹å¤–ï¼Œä½ å¯ä»¥ç«™åœ¨è¿™æ ·çš„è§’åº¦å†™ç‰¹åˆ«çš„ä»£ç </p><p>å¦‚æœä½ è¦å­¦ä¹ å…·ä½“æŸä¸ªå‡½æ•°å¼ç¼–ç¨‹è¯­è¨€,å¯ä»¥è€ƒè™‘Clojure,Elixir,Haskellæˆ–è€…æ›´åŠ æ–°çš„Ocaml.(æˆ‘ä¸ªäººæ¨è)</p><p>ä¸‹é¢ç»™ä¸€äº›å‡½æ•°å¼ç¼–ç¨‹è¯­è¨€åˆ†ä¸ªç±».</p><p>Lisp å®¶æ—</p><ul><li>Common Lisp</li><li>Scheme</li><li>Racket</li><li>Clojure</li></ul><p>è¿™äº›è¯­è¨€éƒ½å±äº Lisp è¯­è¨€å®¶æ—,å…·æœ‰å¼ºå¤§çš„å®ç³»ç»Ÿå’Œå…ƒç¼–ç¨‹èƒ½åŠ›,éå¸¸é€‚åˆè¿›è¡Œå‡½æ•°å¼å’Œå£°æ˜å¼ç¼–ç¨‹ã€‚</p><p>æ”¯æŒå‡½æ•°å¼ç¼–ç¨‹çš„å¤šèŒƒå¼è¯­è¨€</p><ul><li>Scala</li><li>F#</li><li>Clojure</li><li>Kotlin</li><li>Swift</li></ul><p>è¿™ç±»è¯­è¨€èåˆäº†å‡½æ•°å¼å’Œé¢å‘å¯¹è±¡ç­‰å¤šç§ç¼–ç¨‹èŒƒå¼,å…¼å…·å‡½æ•°å¼å’Œå‘½ä»¤å¼ç¼–ç¨‹çš„ç‰¹ç‚¹ã€‚å®ƒä»¬åœ¨å·¥ä¸šç•Œåº”ç”¨è¾ƒä¸ºå¹¿æ³›ã€‚</p><p>çº¯å‡½æ•°å¼è¯­è¨€</p><ul><li>Haskell</li><li>PureScript</li></ul><p>è¿™ç±»è¯­è¨€ä¸¥æ ¼éµå¾ªå‡½æ•°å¼ç¼–ç¨‹çš„åŸåˆ™,æ²¡æœ‰å¯å˜çŠ¶æ€,å¼ºè°ƒä»£æ•°ç±»å‹ç³»ç»Ÿå’Œæƒ°æ€§æ±‚å€¼ã€‚å®ƒä»¬æ›´åå‘äºå­¦æœ¯å’Œç ”ç©¶é¢†åŸŸã€‚</p><p>å¹¶å‘/åˆ†å¸ƒå¼å‡½æ•°å¼è¯­è¨€:</p><ul><li>Erlang</li><li>Elixir</li><li>OCaml</li></ul><p>è¿™äº›è¯­è¨€æ“…é•¿æ„å»ºé«˜å¹¶å‘ã€åˆ†å¸ƒå¼å’Œå®¹é”™çš„åº”ç”¨ç¨‹åº,åˆ©ç”¨å‡½æ•°å¼ç¼–ç¨‹çš„ä¼˜åŠ¿æ¥åº”å¯¹å¤æ‚çš„å¹¶å‘é—®é¢˜ã€‚</p><p>JavaScript è¡ç”Ÿè¯­è¨€</p><ul><li>PureScript</li><li>Elm</li><li>ReasonML</li><li>TypeScript</li></ul><p>è¿™ç±»è¯­è¨€åœ¨ JavaScript çš„åŸºç¡€ä¸Šå¢åŠ äº†é™æ€ç±»å‹ç³»ç»Ÿå’Œå…¶ä»–å‡½æ•°å¼ç‰¹æ€§,æ—¨åœ¨æé«˜ JavaScript çš„å¯é æ€§å’Œå¯ç»´æŠ¤æ€§</p><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ol><li><a href="https://github.com/readme/guides/functional-programming-basics">Functional Programming 101 (github.com)</a></li><li><a href="https://llh911001.gitbooks.io/mostly-adequate-guide-chinese/content/">Introduction Â· å‡½æ•°å¼ç¼–ç¨‹æŒ‡åŒ— (gitbooks.io)</a></li><li><a href="https://ruanyifeng.com/blog/2017/02/fp-tutorial.html">å‡½æ•°å¼ç¼–ç¨‹å…¥é—¨æ•™ç¨‹ - é˜®ä¸€å³°çš„ç½‘ç»œæ—¥å¿— (ruanyifeng.com)</a></li><li><a href="https://tech.meituan.com/2022/10/13/dive-into-functional-programming-01.html">æ·±å…¥ç†è§£å‡½æ•°å¼ç¼–ç¨‹ï¼ˆä¸Šï¼‰ - ç¾å›¢æŠ€æœ¯å›¢é˜Ÿ (meituan.com)</a></li></ol><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;p&gt;ä¹‹å‰åœ¨çœ‹å…¶ä»–äººäº¤æµå¸–å­çš„æ—¶å€™æåˆ°å­¦ä¹ å‡½æ•°å¼ç¼–ç¨‹æå‡æ€ç»´(è™½ç„¶æ„Ÿè§‰æœ‰ç‚¹å¤§è‚†å®£ä¼ çš„æ„Ÿè§‰),ä½†çœ‹äº†ä¸€äº›å‡½æ•°å¼ç¼–ç¨‹çš„ä¾‹å­,æ„Ÿè§‰åœ¨æ•°æ®å¤„ç†å’Œå¤šçº¿ç¨‹ä¸Šæœ‰ç‹¬ç‰¹çš„æ•ˆæœ,å¦‚æœä½¿ç”¨é¢å‘å¯¹è±¡,é‚£å°±ä¼šå˜å¾—æ¯”è¾ƒéº»çƒ¦,æ‰€ä»¥è¿™é‡Œä»…ä½œç®€å•ä»‹ç».&lt;br&gt;</summary>
    
    
    
    
    <category term="functional programming" scheme="https://www.sekyoro.top/tags/functional-programming/"/>
    
  </entry>
  
  <entry>
    <title>ä½¿ç”¨pytorchæ—¶ä½ å¯èƒ½éœ€è¦æ³¨æ„çš„åœ°æ–¹</title>
    <link href="https://www.sekyoro.top/2024/06/23/effective_pytorch/"/>
    <id>https://www.sekyoro.top/2024/06/23/effective_pytorch/</id>
    <published>2024-06-23T08:16:46.000Z</published>
    <updated>2024-07-06T06:17:16.206Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>Pytorchæ˜¯å¾ˆå¥½çš„æ·±åº¦å­¦ä¹ æ¡†æ¶,ä½†åœ¨ä½¿ç”¨æ—¶ä½ å¯èƒ½ä»ç„¶ä¸æ¸…æ¥šå…¶ä¸­ä¸€äº›æ¦‚å¿µ.è¿™é‡Œæˆ‘åªä»¥å®˜æ–¹æ–‡æ¡£ä¸ºä¾æ®å°è¯•è§£é‡Šå…¶ä¸­ä¸€äº›æ¦‚å¿µå’Œæ–¹æ³•. æˆ‘è¿™é‡Œå¯ä»¥ç§°ä½œEffective Pytorch.<br><span id="more"></span></p><blockquote><p>update:ä¸ºäº†æ›´å¥½çš„ç†è§£pytorch,ä¹Ÿè®¸å¯ä»¥ä»é›¶å†™ç‚¹ä»£ç <a href="https://github.com/karpathy/micrograd">karpathy/micrograd: A tiny scalar-valued autograd engine and a neural net library on top of it with PyTorch-like API (github.com)</a></p><p><a href="https://nrehiew.github.io/blog/pytorch/">Taking PyTorch for Granted | wh (nrehiew.github.io)</a></p></blockquote><h2 id="tensor"><a href="#tensor" class="headerlink" title="tensor"></a>tensor</h2><h3 id="Tensor"><a href="#Tensor" class="headerlink" title="Tensor"></a>Tensor</h3><p>pytorché»˜è®¤æµ®ç‚¹ç±»å‹æ˜¯torch.float32,å¯ä»¥ä½¿ç”¨<code>torch.set_default_dtype</code>ä¿®æ”¹</p><p>torch.zerosç­‰é»˜è®¤ç±»å‹å°±æ˜¯å°±æ˜¯torch.float32,ä½¿ç”¨<code>torch.set_default_dtype</code>ä¿®æ”¹é»˜è®¤ç±»å‹.</p><p>torch.tensor() æ€»æ˜¯å¤åˆ¶<code>data</code>(æ·±æ‹·è´,è¡¨ç¤ºåœ°å€ä¸ç›¸åŒ).å¦‚æœä½ æœ‰ä¸€ä¸ªå¼ é‡æ•°æ®,<strong>åªæ˜¯æƒ³æ›´æ”¹å®ƒçš„ requires<em>grad æ ‡å¿—,è¯·ä½¿ç”¨ requires_grad</em>() æˆ– detach() æ¥é¿å…å¤åˆ¶</strong>.</p><p>å¦‚æœä½ æœ‰ä¸€ä¸ª numpy æ•°ç»„,å¹¶<strong>å¸Œæœ›é¿å…å¤åˆ¶,è¯·ä½¿ç”¨ torch.as_tensor()</strong>.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">torch.device(<span class="string">&#x27;cuda:0&#x27;</span>)</span><br><span class="line"></span><br><span class="line">torch.device(<span class="string">&#x27;cpu&#x27;</span>)</span><br><span class="line"></span><br><span class="line">torch.device(<span class="string">&#x27;mps&#x27;</span>)</span><br><span class="line"></span><br><span class="line">torch.device(<span class="string">&#x27;cuda&#x27;</span>)  <span class="comment"># current cuda device</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">x = torch.tensor([[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>], [<span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>]])</span><br><span class="line">x.stride() <span class="comment">#(5,1)</span></span><br><span class="line"></span><br><span class="line">x.t().stride() <span class="comment">#(1,5)</span></span><br></pre></td></tr></table></figure><h3 id="Views"><a href="#Views" class="headerlink" title="Views"></a>Views</h3><p>PyTorch å…è®¸å¼ é‡æˆä¸ºç°æœ‰å¼ é‡çš„ â€œviewsâ€.<strong>è§†å›¾å¼ é‡ä¸å…¶åŸºç¡€å¼ é‡å…±äº«ç›¸åŒçš„åº•å±‚æ•°æ®</strong>.æ”¯æŒ â€œviews â€œå¯ä»¥é¿å…æ˜¾å¼æ•°æ®å¤åˆ¶,ä»è€Œä½¿æˆ‘ä»¬èƒ½å¤Ÿè¿›è¡Œå¿«é€Ÿã€é«˜æ•ˆçš„å†…å­˜é‡å¡‘ã€åˆ‡ç‰‡å’Œå…ƒç´ æ“ä½œ.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">t = torch.rand(<span class="number">4</span>, <span class="number">4</span>)</span><br><span class="line">b = t.view(<span class="number">2</span>, <span class="number">8</span>)</span><br><span class="line">t.storage().data_ptr() == b.storage().data_ptr()  <span class="comment"># `t` and `b` share the same underlying data.</span></span><br><span class="line">b[<span class="number">0</span>][<span class="number">0</span>] = <span class="number">3.14</span></span><br><span class="line">t[<span class="number">0</span>][<span class="number">0</span>]</span><br></pre></td></tr></table></figure><p>ç”±äºviewsä¸å…¶åŸºç¡€å¼ é‡å…±äº«åº•å±‚æ•°æ®,å› æ­¤å¦‚æœä¿®æ”¹viewsä¸­çš„æ•°æ®,ä¹Ÿä¼šåæ˜ åœ¨åŸºç¡€å¼ é‡ä¸­.</p><p>é€šå¸¸,PyTorch æ“ä½œä¼šè¿”å›ä¸€ä¸ªæ–°çš„å¼ é‡ä½œä¸ºè¾“å‡º,ä¾‹å¦‚ add().ä½†åœ¨è§†å›¾æ“ä½œä¸­,è¾“å‡ºæ˜¯è¾“å…¥å¼ é‡çš„è§†å›¾,ä»¥é¿å…ä¸å¿…è¦çš„æ•°æ®å¤åˆ¶.åˆ›å»ºè§†å›¾æ—¶ä¸ä¼šå‘ç”Ÿæ•°æ®ç§»åŠ¨,è§†å›¾å¼ é‡åªæ˜¯æ”¹å˜äº†è§£é‡Šç›¸åŒæ•°æ®çš„æ–¹å¼.</p><p><strong>å¯¹è¿ç»­å¼ é‡è¿›è¡Œè§†å›¾å¤„ç†å¯èƒ½ä¼šäº§ç”Ÿéè¿ç»­å¼ é‡</strong>.transpose() å°±æ˜¯ä¸€ä¸ªå¸¸è§çš„ä¾‹å­.(åŒ…æ‹¬view,transposeç­‰æ“ä½œéƒ½ä¼šè¿”å›view,ä¹Ÿå°±æ˜¯æ•°æ®å­˜å‚¨ä¸è¾“å…¥ç›¸åŒ)</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">base = torch.tensor([[<span class="number">0</span>, <span class="number">1</span>],[<span class="number">2</span>, <span class="number">3</span>]])</span><br><span class="line">base.is_contiguous()</span><br><span class="line">t = base.transpose(<span class="number">0</span>, <span class="number">1</span>)  <span class="comment"># `t` is a view of `base`. No data movement happened here.</span></span><br><span class="line">t.is_contiguous()</span><br><span class="line">c = t.contiguous()</span><br></pre></td></tr></table></figure><p><img data-src="https://s2.loli.net/2024/06/25/vKDYZ7A1jb3g9kO.png" alt="image-20240625212647753"></p><p><a href="https://zhuanlan.zhihu.com/p/342856639">é€šè¿‡å…¬å¼åˆ¤æ–­å¼ é‡æ˜¯å¦è¿ç»­ - çŸ¥ä¹ (zhihu.com)</a></p><h2 id="Extending-PyTorch"><a href="#Extending-PyTorch" class="headerlink" title="Extending PyTorch"></a>Extending PyTorch</h2><p>åŸæ–‡<a href="https://pytorch.org/docs/stable/notes/extending.html">Extending PyTorch â€” PyTorch 2.3 documentation</a></p><h3 id="extending-torch-autograd"><a href="#extending-torch-autograd" class="headerlink" title="extending torch.autograd"></a>extending torch.autograd</h3><p>ä¸º autograd æ·»åŠ æ“ä½œéœ€è¦ä¸ºæ¯ä¸ªæ“ä½œå®ç°ä¸€ä¸ªæ–°çš„ Function å­ç±».</p><h5 id="å¦‚ä½•ä½¿ç”¨"><a href="#å¦‚ä½•ä½¿ç”¨" class="headerlink" title="å¦‚ä½•ä½¿ç”¨"></a>å¦‚ä½•ä½¿ç”¨</h5><p>ä¸€èˆ¬æ¥è¯´,å¦‚æœæƒ³åœ¨æ¨¡å‹ä¸­<strong>æ‰§è¡Œä¸å¯å¾®åˆ†çš„è®¡ç®—æˆ–ä¾èµ–é PyTorch åº“</strong>ï¼ˆå¦‚ NumPyï¼‰,ä½†ä»å¸Œæœ›æ‚¨çš„æ“ä½œèƒ½ä¸å…¶ä»–æ“ä½œè¿é”å¹¶ä¸ autograd å¼•æ“ä¸€èµ·å·¥ä½œ,é‚£ä¹ˆè¯·ä½¿ç”¨è‡ªå®šä¹‰å‡½æ•°.</p><p>åœ¨æŸäº›æƒ…å†µä¸‹,ä¹Ÿå¯ä»¥<strong>ä½¿ç”¨è‡ªå®šä¹‰å‡½æ•°æ¥æé«˜æ€§èƒ½å’Œå†…å­˜ä½¿ç”¨ç‡</strong>: å¦‚æœæ‚¨ä½¿ç”¨ C++ æ‰©å±•å®ç°äº†å‰å‘å’Œåå‘ä¼ é€’,æ‚¨å¯ä»¥å°†å®ƒä»¬å°è£…åœ¨ Function ä¸­,ä»¥ä¾¿ä¸ autograd å¼•æ“å¯¹æ¥.å¦‚æœæ‚¨æƒ³å‡å°‘ä¸ºåå‘ä¼ é€’ä¿å­˜çš„ç¼“å†²åŒºæ•°é‡,å¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰å‡½æ•°å°†æ“ä½œç»„åˆåœ¨ä¸€èµ·.</p><p>å¦‚æœæƒ³åœ¨åå‘ä¼ é€’è¿‡ç¨‹ä¸­æ”¹å˜æ¢¯åº¦æˆ–æ‰§è¡Œå‰¯ä½œç”¨ï¼Œå¯ä»¥è€ƒè™‘registerä¸€ä¸ªå¼ é‡æˆ–æ¨¡å—hook</p><h5 id="ä»€ä¹ˆæ—¶å€™ä¸ç”¨"><a href="#ä»€ä¹ˆæ—¶å€™ä¸ç”¨" class="headerlink" title="ä»€ä¹ˆæ—¶å€™ä¸ç”¨"></a>ä»€ä¹ˆæ—¶å€™ä¸ç”¨</h5><p>å¦‚æœå·²ç»å¯ä»¥ç”¨ PyTorch çš„å†…ç½®æ“ä½œæ¥ç¼–å†™å‡½æ•°,é‚£ä¹ˆå®ƒçš„åå‘å›¾ï¼ˆå¾ˆå¯èƒ½ï¼‰å·²ç»å¯ä»¥è¢« autograd è®°å½•ä¸‹æ¥.åœ¨è¿™ç§æƒ…å†µä¸‹,ä¸éœ€è¦è‡ªå·±å®ç°åå‘å‡½æ•°.å¯ä»¥è€ƒè™‘ä½¿ç”¨ä¸€ä¸ªæ™®é€šçš„ Python å‡½æ•°ã€‚</p><p>å¦‚æœéœ€è¦ç»´æŠ¤çŠ¶æ€,å³å¯è®­ç»ƒå‚æ•°,åˆ™åº”ï¼ˆä¹Ÿå¯ä»¥ï¼‰ä½¿ç”¨è‡ªå®šä¹‰æ¨¡å—torch.nn. </p><p>å¦‚æœæƒ³åœ¨åå‘ä¼ é€’è¿‡ç¨‹ä¸­æ”¹å˜æ¢¯åº¦æˆ–æ‰§è¡Œå‰¯ä½œç”¨,å¯ä»¥è€ƒè™‘æ³¨å†Œä¸€ä¸ªå¼ é‡æˆ–æ¨¡å—é’©å­ã€‚</p><blockquote><p>æ³¨æ„,æˆ‘åœ¨çœ‹pytorch2.3æ—¶ register_backward_hookå·²ç»deprecatedäº†,ä½¿ç”¨register_full_backward_hook</p></blockquote><p>ä½¿ç”¨ä¸€ä¸ª<code>register_full_backward_hook</code>å°†æ¢¯åº¦å˜ä¸ºç›¸åæ•°.</p><p><code>hook(module, grad_input, grad_output) -&gt; tuple(Tensor) æˆ– None</code><br>grad_input å’Œ grad_output æ˜¯å…ƒç»„ï¼Œåˆ†åˆ«åŒ…å«<strong>ç›¸å¯¹äºè¾“å…¥å’Œè¾“å‡ºçš„æ¢¯åº¦</strong>ã€‚<strong>é’©å­ä¸åº”ä¿®æ”¹å…¶å‚æ•°</strong>,ä½†<strong>å¯ä»¥é€‰æ‹©è¿”å›ä¸€ä¸ªæ–°çš„ç›¸å¯¹äºè¾“å…¥çš„æ¢¯åº¦ï¼Œè¯¥æ¢¯åº¦å°†åœ¨åç»­è®¡ç®—ä¸­ä»£æ›¿ grad_input</strong>.å¯¹äºæ‰€æœ‰éå¼ é‡å‚æ•°ï¼Œgrad_input å’Œ grad_output ä¸­çš„æ¡ç›®å‡ä¸º â€œNoneâ€.</p><p>å¦‚æœæƒ³åœ¨åå‘ä¼ é€’è¿‡ç¨‹ä¸­æ”¹å˜æ¢¯åº¦æˆ–æ‰§è¡Œå‰¯ä½œç”¨ï¼Œå¯ä»¥è€ƒè™‘æ³¨å†Œä¸€ä¸ªå¼ é‡æˆ–æ¨¡å—é’©å­.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">backward_hook</span>(<span class="params">module, grad_input, grad_output</span>):</span></span><br><span class="line">    output_grad_input = - grad_input[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">return</span> (output_grad_input,)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">negGradient</span>(<span class="params">nn.Module</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">super</span>(negGradient, self).__init__()</span><br><span class="line">        self.register_full_backward_hook(backward_hook)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span>(<span class="params">self, x</span>):</span></span><br><span class="line">        <span class="keyword">return</span> x</span><br></pre></td></tr></table></figure><p>åœ¨domain adaptationçš„æ—©æœŸè®ºæ–‡æ¯”å¦‚DANNä¸­,ä¸€èˆ¬ä¼šä½¿ç”¨<code>Function</code>è¿›è¡Œæ¢¯åº¦å˜ä¸ºè´Ÿæ•°,å…¶å®ä¹Ÿå¯ä»¥æ³¨å†Œbackwardçš„hookå®ç°.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_GradReverseLayer</span>(<span class="params">Function</span>):</span></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span>(<span class="params">ctx, x, constant</span>):</span></span><br><span class="line">        <span class="keyword">assert</span> <span class="built_in">isinstance</span>(constant, <span class="built_in">int</span>) <span class="keyword">and</span> constant &gt; <span class="number">0</span></span><br><span class="line">        ctx.constant = constant</span><br><span class="line">        <span class="keyword">return</span> x.view_as(x)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">backward</span>(<span class="params">ctx, grad_output</span>):</span></span><br><span class="line">        <span class="keyword">return</span> grad_output.neg() * ctx.constant, <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GradReverseLayer</span>(<span class="params">nn.Module</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, weight</span>):</span></span><br><span class="line">        <span class="built_in">super</span>(GradReverseLayer, self).__init__()</span><br><span class="line">        self.weight = weight</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span>(<span class="params">self, x</span>):</span></span><br><span class="line">        <span class="keyword">return</span> _GradReverseLayer.apply(x, self.weight)</span><br></pre></td></tr></table></figure><p>æ—¢ç„¶ä»‹ç»äº†<code>register_full_backward_hook</code>,å†è¯´è¯´<code>register_forward_hook</code>,æ¯æ¬¡ forward() è®¡ç®—å®Œè¾“å‡ºåï¼Œéƒ½ä¼šè°ƒç”¨è¯¥é’©å­ã€‚å¦‚æœ with_kwargs ä¸º False æˆ–æœªæŒ‡å®šï¼Œè¾“å…¥å°†åªåŒ…å«ç»™æ¨¡å—çš„ä½ç½®å‚æ•°ã€‚å…³é”®å­—å‚æ•°ä¸ä¼šä¼ é€’ç»™é’©å­ï¼Œåªä¼šä¼ é€’ç»™ forwardã€‚<strong>é’©å­å¯ä»¥ä¿®æ”¹è¾“å‡º.é’©å­å¯ä»¥å°±åœ°ä¿®æ”¹è¾“å…¥,ä½†ä¸ä¼šå¯¹ forward äº§ç”Ÿå½±å“</strong>,å› ä¸ºé’©å­æ˜¯åœ¨è°ƒç”¨ forward() ä¹‹åæ‰è°ƒç”¨çš„.</p><p>å¯ä»¥çœ‹çœ‹è¿™ç¯‡æ–‡ç« <a href="https://blog.csdn.net/m0_51661400/article/details/135091359">æ·±å…¥ç†è§£PyTorchä¸­çš„Hookæœºåˆ¶ï¼šç‰¹å¾å¯è§†åŒ–çš„é‡è¦å·¥å…·ä¸å®è·µ-CSDNåšå®¢</a></p><h5 id="ä½¿ç”¨æ–¹æ³•"><a href="#ä½¿ç”¨æ–¹æ³•" class="headerlink" title="ä½¿ç”¨æ–¹æ³•"></a>ä½¿ç”¨æ–¹æ³•</h5><p>é‡‡å–ä»¥ä¸‹æ­¥éª¤ 1. ç»§æ‰¿ç±» Function å¹¶å®ç° forward()ã€ï¼ˆå¯é€‰ï¼‰setup_context() å’Œ backward() æ–¹æ³•ã€‚2. åœ¨ ctx å‚æ•°ä¸Šè°ƒç”¨é€‚å½“çš„æ–¹æ³•ã€‚3. å£°æ˜æ‚¨çš„å‡½æ•°æ˜¯å¦æ”¯æŒ double backwardã€‚4. ä½¿ç”¨ gradcheck éªŒè¯æ¢¯åº¦æ˜¯å¦æ­£ç¡®ã€‚</p><p>step1:</p><ol><li>forward() æ˜¯æ‰§è¡Œæ“ä½œçš„ä»£ç ã€‚å®ƒå¯ä»¥æ¥å—ä»»æ„å¤šä¸ªå‚æ•°,å¦‚æœæŒ‡å®šé»˜è®¤å€¼,å…¶ä¸­ä¸€äº›å‚æ•°æ˜¯å¯é€‰çš„.åœ¨è°ƒç”¨ä¹‹å‰,è·Ÿè¸ªå†å²çš„å¼ é‡å‚æ•°ï¼ˆå³ requires_grad=Trueï¼‰å°†è¢«è½¬æ¢ä¸ºä¸è·Ÿè¸ªå†å²çš„å‚æ•°,å®ƒä»¬çš„ä½¿ç”¨å°†è¢«è®°å½•åœ¨å›¾ä¸­ã€‚è¯·æ³¨æ„,æ­¤é€»è¾‘ä¸ä¼šéå†åˆ—è¡¨/æ•°æ®é›†/ä»»ä½•å…¶ä»–æ•°æ®ç»“æ„,åªä¼šè€ƒè™‘ä½œä¸ºè°ƒç”¨ç›´æ¥å‚æ•°çš„å¼ é‡.æ‚¨å¯ä»¥è¿”å›ä¸€ä¸ªå¼ é‡è¾“å‡ºï¼Œå¦‚æœæœ‰å¤šä¸ªè¾“å‡ºï¼Œä¹Ÿå¯ä»¥è¿”å›ä¸€ä¸ªå¼ é‡å…ƒç»„ã€‚</li><li>setup_context()ï¼ˆå¯é€‰ï¼‰ã€‚å¯ä»¥ç¼–å†™ä¸€ä¸ªæ¥å— ctx å¯¹è±¡çš„ â€œç»„åˆ â€œforward()ï¼Œæˆ–è€…ï¼ˆä» PyTorch 2.0 å¼€å§‹ï¼‰ç¼–å†™ä¸€ä¸ªä¸æ¥å— ctx çš„å•ç‹¬ forward()ï¼Œä»¥åŠä¸€ä¸ªç”¨äºä¿®æ”¹ ctx çš„ setup_context()æ–¹æ³•ã€‚forward() åº”è¯¥å…·æœ‰è®¡ç®—åŠŸèƒ½ï¼Œè€Œ <strong>setup_context() åº”è¯¥åªè´Ÿè´£ä¿®æ”¹ ctxï¼ˆè€Œä¸å…·æœ‰ä»»ä½•è®¡ç®—åŠŸèƒ½</strong>ï¼‰ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œç‹¬ç«‹çš„ forward() å’Œ setup_context()æ›´æ¥è¿‘ PyTorch æœ¬æœºæ“ä½œçš„å·¥ä½œæ–¹å¼ï¼Œå› æ­¤æ›´å®¹æ˜“ä¸å„ç§ PyTorch å­ç³»ç»Ÿå…¼å®¹ã€‚</li><li>backward()ï¼ˆæˆ– vjp()ï¼‰å®šä¹‰æ¢¯åº¦å…¬å¼ã€‚<strong>è¾“å‡ºæœ‰å¤šå°‘ä¸ªå¼ é‡å‚æ•°ï¼Œå®ƒå°±æœ‰å¤šå°‘ä¸ªå¼ é‡å‚æ•°ï¼Œæ¯ä¸ªå¼ é‡å‚æ•°éƒ½ä»£è¡¨è¯¥è¾“å‡ºçš„æ¢¯åº¦</strong>ã€‚<strong>åˆ‡å‹¿å°±åœ°ä¿®æ”¹è¿™äº›å‚æ•°ã€‚å®ƒåº”è¯¥è¿”å›ä¸è¾“å…¥ç›¸åŒæ•°é‡çš„å¼ é‡ï¼Œå…¶ä¸­æ¯ä¸ªå¼ é‡éƒ½åŒ…å«å¯¹åº”è¾“å…¥çš„æ¢¯åº¦ã€‚</strong>å¦‚æœè¾“å…¥ä¸éœ€è¦æ¢¯åº¦ï¼ˆneeds_input_grad æ˜¯ä¸€ä¸ªå¸ƒå°”å…ƒç»„ï¼Œè¡¨ç¤ºæ¯ä¸ªè¾“å…¥æ˜¯å¦éœ€è¦æ¢¯åº¦è®¡ç®—ï¼‰,æˆ–è€…æ˜¯éå¼ é‡å¯¹è±¡ï¼Œåˆ™å¯ä»¥è¿”å› python:Noneã€‚æ­¤å¤–,å¦‚æœ forward() çš„å‚æ•°æ˜¯å¯é€‰çš„,åªè¦å®ƒä»¬éƒ½æ˜¯ None,è¿”å›çš„æ¢¯åº¦å€¼å°±ä¼šå¤šäºè¾“å…¥å€¼ã€‚</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Exp</span>(<span class="params">Function</span>):</span></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span>(<span class="params">ctx, i</span>):</span></span><br><span class="line">        result = i.exp()</span><br><span class="line">        ctx.save_for_backward(result)</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">backward</span>(<span class="params">ctx, grad_output</span>):</span></span><br><span class="line">        result, = ctx.saved_tensors</span><br><span class="line">        <span class="keyword">return</span> grad_output * result</span><br><span class="line"><span class="comment"># Use it by calling the apply method:</span></span><br><span class="line">output = Exp.apply(<span class="built_in">input</span>)</span><br></pre></td></tr></table></figure><p>step 2ï¼šæ­£ç¡®ä½¿ç”¨ ctx ä¸­çš„å‡½æ•°ï¼Œä»¥ç¡®ä¿æ–°å‡½æ•°åœ¨ autograd å¼•æ“ä¸­æ­£å¸¸å·¥ä½œã€‚</p><p>ctxä¸Šæœ‰è®¸å¤šæ–¹æ³•å¯ç”¨äºè°ƒç”¨,æ¯”è¾ƒå¤šçš„å°±æ˜¯<code>save_for_backward</code></p><blockquote><p>å¿…é¡»<strong>ä½¿ç”¨ save_for_backward()æ¥ä¿å­˜è¦åœ¨åå‘ä¼ é€’ä¸­ä½¿ç”¨çš„å¼ é‡</strong>ã€‚<strong>éå¼ é‡åº”ç›´æ¥ä¿å­˜åœ¨ ctx ä¸Š</strong>ã€‚å¦‚æœæ—¢ä¸æ˜¯è¾“å…¥ä¹Ÿä¸æ˜¯è¾“å‡ºçš„å¼ é‡è¢«ä¿å­˜,é‚£å‡½æ•°å‡½æ•°å¯èƒ½ä¸æ”¯æŒdouble backward ã€‚</p></blockquote><p>æ­¤å¤–è¿˜æœ‰<code>set_materialize_grads</code></p><blockquote><p>set_materialize_grads()å¯ä»¥ç”¨æ¥å‘Šè¯‰ autograd å¼•æ“ï¼Œåœ¨è¾“å‡ºä¸ä¾èµ–äºè¾“å…¥çš„æƒ…å†µä¸‹ï¼Œ<strong>é€šè¿‡ä¸å¯¹åå‘å‡½æ•°ä¸­çš„æ¢¯åº¦å¼ é‡è¿›è¡Œå®ä½“åŒ–æ¥ä¼˜åŒ–æ¢¯åº¦è®¡ç®—</strong>ã€‚</p></blockquote><p>step3:å¦‚æœå‡½æ•°ä¸æ”¯æŒdouble backward ï¼Œåˆ™åº”é€šè¿‡ä½¿ç”¨ once_differentiable() å¯¹é€†è¿ç®—è¿›è¡Œè£…é¥°æ¥æ˜ç¡®å£°æ˜è¿™ä¸€ç‚¹ã€‚ä½¿ç”¨æ­¤è£…é¥°å™¨åï¼Œé€šè¿‡å‡½æ•°æ‰§è¡Œdouble backward çš„å°è¯•å°†äº§ç”Ÿé”™è¯¯ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">torch.autograd.gradcheck(Exp.apply, x)</span><br></pre></td></tr></table></figure><p>step4:å»ºè®®ä½¿ç”¨ torch.autograd.gradcheck() æ£€æŸ¥åå‘å‡½æ•°æ˜¯å¦èƒ½æ­£ç¡®è®¡ç®—å‰å‘æ¢¯åº¦,æ–¹æ³•æ˜¯ä½¿ç”¨åå‘å‡½æ•°è®¡ç®—é›…å„å¸ƒçŸ©é˜µ,å¹¶å°†è¯¥å€¼ä¸ä½¿ç”¨æœ‰é™å·®åˆ†æ³•æ•°å€¼è®¡ç®—çš„é›…å„å¸ƒå€¼è¿›è¡Œé€å…ƒç´ æ¯”è¾ƒã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Inherit from Function</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LinearFunction</span>(<span class="params">Function</span>):</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Note that forward, setup_context, and backward are @staticmethods</span></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span>(<span class="params"><span class="built_in">input</span>, weight, bias</span>):</span></span><br><span class="line">        output = <span class="built_in">input</span>.mm(weight.t())</span><br><span class="line">        <span class="keyword">if</span> bias <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            output += bias.unsqueeze(<span class="number">0</span>).expand_as(output)</span><br><span class="line">        <span class="keyword">return</span> output</span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="comment"># inputs is a Tuple of all of the inputs passed to forward.</span></span><br><span class="line">    <span class="comment"># output is the output of the forward().</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setup_context</span>(<span class="params">ctx, inputs, output</span>):</span></span><br><span class="line">        <span class="built_in">input</span>, weight, bias = inputs</span><br><span class="line">        ctx.save_for_backward(<span class="built_in">input</span>, weight, bias)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># This function has only a single output, so it gets only one gradient</span></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">backward</span>(<span class="params">ctx, grad_output</span>):</span></span><br><span class="line">        <span class="comment"># This is a pattern that is very convenient - at the top of backward</span></span><br><span class="line">        <span class="comment"># unpack saved_tensors and initialize all gradients w.r.t. inputs to</span></span><br><span class="line">        <span class="comment"># None. Thanks to the fact that additional trailing Nones are</span></span><br><span class="line">        <span class="comment"># ignored, the return statement is simple even when the function has</span></span><br><span class="line">        <span class="comment"># optional inputs.</span></span><br><span class="line">        <span class="built_in">input</span>, weight, bias = ctx.saved_tensors</span><br><span class="line">        grad_input = grad_weight = grad_bias = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># These needs_input_grad checks are optional and there only to</span></span><br><span class="line">        <span class="comment"># improve efficiency. If you want to make your code simpler, you can</span></span><br><span class="line">        <span class="comment"># skip them. Returning gradients for inputs that don&#x27;t require it is</span></span><br><span class="line">        <span class="comment"># not an error.</span></span><br><span class="line">        <span class="keyword">if</span> ctx.needs_input_grad[<span class="number">0</span>]:</span><br><span class="line">            grad_input = grad_output.mm(weight)</span><br><span class="line">        <span class="keyword">if</span> ctx.needs_input_grad[<span class="number">1</span>]:</span><br><span class="line">            grad_weight = grad_output.t().mm(<span class="built_in">input</span>)</span><br><span class="line">        <span class="keyword">if</span> bias <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">and</span> ctx.needs_input_grad[<span class="number">2</span>]:</span><br><span class="line">            grad_bias = grad_output.<span class="built_in">sum</span>(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> grad_input, grad_weight, grad_bias</span><br></pre></td></tr></table></figure><p>ä¸Šé¢è¿™ä¸ªä¾‹å­å·²ç»å†™å¾—å¾ˆå¥½äº†.ä¸ºäº†æ›´æ–¹ä¾¿åœ°ä½¿ç”¨è¿™äº›è‡ªå®šä¹‰æ“ä½œï¼Œ<strong>å»ºè®®å°†å®ƒä»¬åˆ«åæˆ–å°è£…åœ¨ä¸€ä¸ªå‡½æ•°ä¸­ã€‚</strong>ä½¿ç”¨å‡½æ•°å°è£…å¯ä»¥è®©æˆ‘ä»¬æ”¯æŒé»˜è®¤å‚æ•°å’Œå…³é”®å­—å‚æ•°</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Option 1: alias</span></span><br><span class="line">linear = LinearFunction.apply</span><br><span class="line"></span><br><span class="line"><span class="comment"># Option 2: wrap in a function, to support default args and keyword args.</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">linear</span>(<span class="params"><span class="built_in">input</span>, weight, bias=<span class="literal">None</span></span>):</span></span><br><span class="line">    <span class="keyword">return</span> LinearFunction.apply(<span class="built_in">input</span>, weight, bias)</span><br></pre></td></tr></table></figure><p>æ­¤å¤–è¿˜æœ‰è¾“å…¥æ²¡æœ‰tensorçš„æƒ…å†µ,</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MulConstant</span>(<span class="params">Function</span>):</span></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span>(<span class="params">tensor, constant</span>):</span></span><br><span class="line">        <span class="keyword">return</span> tensor * constant</span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setup_context</span>(<span class="params">ctx, inputs, output</span>):</span></span><br><span class="line">        <span class="comment"># ctx is a context object that can be used to stash information</span></span><br><span class="line">        <span class="comment"># for backward computation</span></span><br><span class="line">        tensor, constant = inputs</span><br><span class="line">        ctx.constant = constant <span class="comment"># æ³¨æ„è¿™é‡Œç›´æ¥ä½¿ç”¨ctx.xx = xx</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">backward</span>(<span class="params">ctx, grad_output</span>):</span></span><br><span class="line">        <span class="comment"># We return as many input gradients as there were arguments.</span></span><br><span class="line">        <span class="comment"># Gradients of non-Tensor arguments to forward must be None.</span></span><br><span class="line">        <span class="keyword">return</span> grad_output * ctx.constant, <span class="literal">None</span></span><br><span class="line">  <span class="comment"># ä¸Šé¢ä»£ç å¯ä»¥æ”¹ä¸º ä½¿ç”¨set_materialize_grads,å› ä¸ºè®¡ç®—æ¢¯åº¦ä¸éœ€è¦tensor.</span></span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">MulConstant</span>(<span class="params">Function</span>):</span></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span>(<span class="params">tensor, constant</span>):</span></span><br><span class="line">        <span class="keyword">return</span> tensor * constant</span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setup_context</span>(<span class="params">ctx, inputs, output</span>):</span></span><br><span class="line">        tensor, constant = inputs</span><br><span class="line">        ctx.set_materialize_grads(<span class="literal">False</span>)</span><br><span class="line">        ctx.constant = constant</span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">backward</span>(<span class="params">ctx, grad_output</span>):</span></span><br><span class="line">        <span class="comment"># Here we must handle None grad_output tensor. In this case we</span></span><br><span class="line">        <span class="comment"># can skip unnecessary computations and just return None.</span></span><br><span class="line">        <span class="keyword">if</span> grad_output <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span>, <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># We return as many input gradients as there were arguments.</span></span><br><span class="line">        <span class="comment"># Gradients of non-Tensor arguments to forward must be None.</span></span><br><span class="line">        <span class="keyword">return</span> grad_output * ctx.constant, <span class="literal">None</span></span><br><span class="line"> </span><br><span class="line">        </span><br></pre></td></tr></table></figure><p>å¦‚æœéœ€è¦ä¿å­˜åœ¨ forward() ä¸­è®¡ç®—çš„ä»»ä½• â€œä¸­é—´ â€œå¼ é‡ï¼Œå¿…é¡»å°†å®ƒä»¬ä½œä¸ºè¾“å‡ºè¿”å›ï¼Œæˆ–è€…å°† forward å’Œ setup_context()åˆå¹¶.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyCube</span>(<span class="params">torch.autograd.Function</span>):</span></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span>(<span class="params">x</span>):</span></span><br><span class="line">        <span class="comment"># We wish to save dx for backward. In order to do so, it must</span></span><br><span class="line">        <span class="comment"># be returned as an output.</span></span><br><span class="line">        dx = <span class="number">3</span> * x ** <span class="number">2</span></span><br><span class="line">        result = x ** <span class="number">3</span></span><br><span class="line">        <span class="keyword">return</span> result, dx</span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setup_context</span>(<span class="params">ctx, inputs, output</span>):</span></span><br><span class="line">        x, = inputs</span><br><span class="line">        result, dx = output</span><br><span class="line">        ctx.save_for_backward(x, dx)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">backward</span>(<span class="params">ctx, grad_output, grad_dx</span>):</span></span><br><span class="line">        x, dx = ctx.saved_tensors</span><br><span class="line">        <span class="comment"># In order for the autograd.Function to work with higher-order</span></span><br><span class="line">        <span class="comment"># gradients, we must add the gradient contribution of `dx`,</span></span><br><span class="line">        <span class="comment"># which is grad_dx * 6 * x.</span></span><br><span class="line">        result = grad_output * dx + grad_dx * <span class="number">6</span> * x</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"><span class="comment"># Wrap MyCube in a function so that it is clearer what the output is</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">my_cube</span>(<span class="params">x</span>):</span></span><br><span class="line">    result, dx = MyCube.apply(x)</span><br><span class="line">    <span class="keyword">return</span> result</span><br></pre></td></tr></table></figure><p>å°†forwardå’Œsetup_contextåˆåœ¨ä¸€èµ·</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LinearFunction</span>(<span class="params">Function</span>):</span></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="comment"># ctx is the first argument to forward</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span>(<span class="params">ctx, <span class="built_in">input</span>, weight, bias=<span class="literal">None</span></span>):</span></span><br><span class="line">        <span class="comment"># The forward pass can use ctx.</span></span><br><span class="line">        ctx.save_for_backward(<span class="built_in">input</span>, weight, bias)</span><br><span class="line">        output = <span class="built_in">input</span>.mm(weight.t())</span><br><span class="line">        <span class="keyword">if</span> bias <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            output += bias.unsqueeze(<span class="number">0</span>).expand_as(output)</span><br><span class="line">        <span class="keyword">return</span> output</span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">backward</span>(<span class="params">ctx, grad_output</span>):</span></span><br><span class="line">        <span class="built_in">input</span>, weight, bias = ctx.saved_tensors</span><br><span class="line">        grad_input = grad_weight = grad_bias = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> ctx.needs_input_grad[<span class="number">0</span>]:</span><br><span class="line">            grad_input = grad_output.mm(weight)</span><br><span class="line">        <span class="keyword">if</span> ctx.needs_input_grad[<span class="number">1</span>]:</span><br><span class="line">            grad_weight = grad_output.t().mm(<span class="built_in">input</span>)</span><br><span class="line">        <span class="keyword">if</span> bias <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">and</span> ctx.needs_input_grad[<span class="number">2</span>]:</span><br><span class="line">            grad_bias = grad_output.<span class="built_in">sum</span>(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> grad_input, grad_weight, grad_bias</span><br></pre></td></tr></table></figure><h3 id="extending-torch-nn"><a href="#extending-torch-nn" class="headerlink" title="extending torch.nn"></a>extending torch.nn</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Linear</span>(<span class="params">nn.Module</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, input_features, output_features, bias=<span class="literal">True</span></span>):</span></span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        self.input_features = input_features</span><br><span class="line">        self.output_features = output_features</span><br><span class="line"></span><br><span class="line">        <span class="comment"># nn.Parameter is a special kind of Tensor, that will get</span></span><br><span class="line">        <span class="comment"># automatically registered as Module&#x27;s parameter once it&#x27;s assigned</span></span><br><span class="line">        <span class="comment"># as an attribute. Parameters and buffers need to be registered, or</span></span><br><span class="line">        <span class="comment"># they won&#x27;t appear in .parameters() (doesn&#x27;t apply to buffers), and</span></span><br><span class="line">        <span class="comment"># won&#x27;t be converted when e.g. .cuda() is called. You can use</span></span><br><span class="line">        <span class="comment"># .register_buffer() to register buffers.</span></span><br><span class="line">        <span class="comment"># nn.Parameters require gradients by default.</span></span><br><span class="line">        self.weight = nn.Parameter(torch.empty(output_features, input_features))</span><br><span class="line">        <span class="keyword">if</span> bias:</span><br><span class="line">            self.bias = nn.Parameter(torch.empty(output_features))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># You should always register all possible parameters, but the</span></span><br><span class="line">            <span class="comment"># optional ones can be None if you want.</span></span><br><span class="line">            self.register_parameter(<span class="string">&#x27;bias&#x27;</span>, <span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Not a very smart way to initialize weights</span></span><br><span class="line">        nn.init.uniform_(self.weight, -<span class="number">0.1</span>, <span class="number">0.1</span>)</span><br><span class="line">        <span class="keyword">if</span> self.bias <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            nn.init.uniform_(self.bias, -<span class="number">0.1</span>, <span class="number">0.1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span>(<span class="params">self, <span class="built_in">input</span></span>):</span></span><br><span class="line">        <span class="comment"># See the autograd section for explanation of what happens here.</span></span><br><span class="line">        <span class="keyword">return</span> LinearFunction.apply(<span class="built_in">input</span>, self.weight, self.bias)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">extra_repr</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="comment"># (Optional)Set the extra information about this module. You can test</span></span><br><span class="line">        <span class="comment"># it by printing an object of this class.</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;input_features=&#123;&#125;, output_features=&#123;&#125;, bias=&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(</span><br><span class="line">            self.input_features, self.output_features, self.bias <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span></span><br><span class="line">        )</span><br></pre></td></tr></table></figure><p>å¯ä»¥é€šè¿‡å®šä¹‰å…·æœ‰ä¸ Tensor åŒ¹é…çš„æ–¹æ³•çš„è‡ªå®šä¹‰ç±»æ¥åˆ›å»ºæ¨¡æ‹Ÿ Tensor çš„è‡ªå®šä¹‰ç±»å‹ã€‚å¦‚æœè‡ªå®šä¹‰ Python ç±»å‹å®šä¹‰äº†åä¸º<code>__torch_function__</code>çš„æ–¹æ³•ï¼Œå½“æ‚¨çš„è‡ªå®šä¹‰ç±»çš„å®ä¾‹<strong>è¢«ä¼ é€’ç»™ torch å‘½åç©ºé—´ä¸­çš„å‡½æ•°æ—¶</strong>ï¼ŒPyTorch å°†è°ƒç”¨æ‚¨çš„ <code>__torch_function__</code>å®ç°ã€‚è¿™ä½¿å¾—ä¸º torch å‘½åç©ºé—´ä¸­çš„ä»»ä½•å‡½æ•°å®šä¹‰è‡ªå®šä¹‰å®ç°æˆä¸ºå¯èƒ½ï¼Œ<code>__torch_function__</code>å®ç°å¯ä»¥è°ƒç”¨è¿™äº›å‡½æ•°ï¼Œä»è€Œå…è®¸æ‚¨çš„ç”¨æˆ·åœ¨ä»–ä»¬å·²ç»ä¸º Tensor ç¼–å†™çš„ç°æœ‰ PyTorch å·¥ä½œæµä¸­ä½¿ç”¨æ‚¨çš„è‡ªå®šä¹‰ç±»å‹ã€‚</p><p>è¿™é€‚ç”¨äº<strong>ä¸ Tensor æ— å…³çš„ â€œduck â€œç±»å‹</strong>ä»¥åŠ <strong>Tensor å­ç±»</strong>ã€‚</p><h5 id="Extending-torch-Tensor-like-type"><a href="#Extending-torch-Tensor-like-type" class="headerlink" title="Extending torch Tensor-like type"></a>Extending torch Tensor-like type</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">HANDLED_FUNCTIONS = &#123;&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ScalarTensor</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, N, value</span>):</span></span><br><span class="line">        self._N = N</span><br><span class="line">        self._value = value</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;ScalarTensor(N=&#123;&#125;, value=&#123;&#125;)&quot;</span>.<span class="built_in">format</span>(self._N, self._value)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">tensor</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self._value * torch.eye(self._N)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__torch_function__</span>(<span class="params">cls, func, types, args=(<span class="params"></span>), kwargs=<span class="literal">None</span></span>):</span></span><br><span class="line">        <span class="keyword">if</span> kwargs <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            kwargs = &#123;&#125;</span><br><span class="line">        <span class="keyword">if</span> func <span class="keyword">not</span> <span class="keyword">in</span> HANDLED_FUNCTIONS <span class="keyword">or</span> <span class="keyword">not</span> <span class="built_in">all</span>(</span><br><span class="line">            <span class="built_in">issubclass</span>(t, (torch.Tensor, ScalarTensor))</span><br><span class="line">            <span class="keyword">for</span> t <span class="keyword">in</span> types</span><br><span class="line">        ):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">NotImplemented</span></span><br><span class="line">        <span class="keyword">return</span> HANDLED_FUNCTIONS[func](*args, **kwargs)</span><br></pre></td></tr></table></figure><p>ä¸º ScalarTensor æ·»åŠ  <code>__torch_function__</code> å®ç°å,ä¸Šè¿°æ“ä½œå°±æœ‰å¯èƒ½æˆåŠŸ.è¿™æ¬¡æ·»åŠ ä¸€ä¸ª<code>__torch_function__</code> å®ç°</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">HANDLED_FUNCTIONS = &#123;&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ScalarTensor</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, N, value</span>):</span></span><br><span class="line">        self._N = N</span><br><span class="line">        self._value = value</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;ScalarTensor(N=&#123;&#125;, value=&#123;&#125;)&quot;</span>.<span class="built_in">format</span>(self._N, self._value)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">tensor</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self._value * torch.eye(self._N)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__torch_function__</span>(<span class="params">cls, func, types, args=(<span class="params"></span>), kwargs=<span class="literal">None</span></span>):</span></span><br><span class="line">        <span class="keyword">if</span> kwargs <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            kwargs = &#123;&#125;</span><br><span class="line">        <span class="keyword">if</span> func <span class="keyword">not</span> <span class="keyword">in</span> HANDLED_FUNCTIONS <span class="keyword">or</span> <span class="keyword">not</span> <span class="built_in">all</span>(</span><br><span class="line">            <span class="built_in">issubclass</span>(t, (torch.Tensor, ScalarTensor))</span><br><span class="line">            <span class="keyword">for</span> t <span class="keyword">in</span> types</span><br><span class="line">        ):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">NotImplemented</span></span><br><span class="line">        <span class="keyword">return</span> HANDLED_FUNCTIONS[func](*args, **kwargs)</span><br></pre></td></tr></table></figure><p><code>__torch_function__</code>æ–¹æ³•éœ€è¦å››ä¸ªå‚æ•°:func,å¯¹è¦é‡è½½çš„ torch API å‡½æ•°çš„å¼•ç”¨ï¼›typesï¼Œå®ç° <code>__torch_function__</code>çš„ Tensor-likes ç±»å‹åˆ—è¡¨ï¼›args,ä¼ é€’ç»™å‡½æ•°çš„å‚æ•°å…ƒç»„ï¼›kwargs,ä¼ é€’ç»™å‡½æ•°çš„å…³é”®å­—å‚æ•° dict,å®ƒä½¿ç”¨åä¸º HANDLED_FUNCTIONS çš„å…¨å±€è°ƒåº¦è¡¨æ¥å­˜å‚¨è‡ªå®šä¹‰å®ç°.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> functools</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">implements</span>(<span class="params">torch_function</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;Register a torch function override for ScalarTensor&quot;&quot;&quot;</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">decorator</span>(<span class="params">func</span>):</span></span><br><span class="line">        functools.update_wrapper(func, torch_function)</span><br><span class="line">        HANDLED_FUNCTIONS[torch_function] = func</span><br><span class="line">        <span class="keyword">return</span> func</span><br><span class="line">    <span class="keyword">return</span> decorator</span><br><span class="line"></span><br><span class="line"><span class="meta">@implements(<span class="params">torch.mean</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">mean</span>(<span class="params"><span class="built_in">input</span></span>):</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">float</span>(<span class="built_in">input</span>._value) / <span class="built_in">input</span>._N</span><br><span class="line"></span><br><span class="line">d = ScalarTensor(<span class="number">5</span>, <span class="number">2</span>)</span><br><span class="line">torch.mean(d)</span><br></pre></td></tr></table></figure><p>ä» 1.7.0 ç‰ˆå¼€å§‹ï¼Œåº”ç”¨äº torch.Tensor å­ç±»çš„ <strong>torch.Tensor æ–¹æ³•</strong>å’Œ<strong>å…¬å…± torch.* å‘½åç©ºé—´ä¸­çš„å‡½æ•°</strong>å°†è¿”å›å­ç±»å®ä¾‹ï¼Œè€Œä¸æ˜¯ torch.Tensor å®ä¾‹.</p><p>å¦‚æœå¸Œæœ›å¯¹æ‰€æœ‰å¼ é‡æ–¹æ³•è¿›è¡Œå…¨å±€è¦†ç›–,å¯ä»¥ä½¿ç”¨<code>__torch_function__</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LoggingTensor</span>(<span class="params">torch.Tensor</span>):</span></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__torch_function__</span>(<span class="params">cls, func, types, args=(<span class="params"></span>), kwargs=<span class="literal">None</span></span>):</span></span><br><span class="line">        <span class="comment"># <span class="doctag">NOTE:</span> Logging calls Tensor.__repr__, so we can&#x27;t log __repr__ without infinite recursion</span></span><br><span class="line">        <span class="keyword">if</span> func <span class="keyword">is</span> <span class="keyword">not</span> torch.Tensor.__repr__:</span><br><span class="line">            logging.info(<span class="string">f&quot;func: <span class="subst">&#123;func.__name__&#125;</span>, args: <span class="subst">&#123;args!r&#125;</span>, kwargs: <span class="subst">&#123;kwargs!r&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> kwargs <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            kwargs = &#123;&#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>().__torch_function__(func, types, args, kwargs)</span><br></pre></td></tr></table></figure><p>åœ¨å­ç±»çš„<code>__torch_function__</code> ä¸­åº”æ³¨æ„å§‹ç»ˆè°ƒç”¨ super().<strong>torch_function</strong>(func,â€¦)ï¼Œè€Œä¸æ˜¯ç›´æ¥è°ƒç”¨ funcã€‚å¦‚æœä¸è¿™æ ·åšï¼Œå¯èƒ½ä¼šå¯¼è‡´ func è¿”å›åˆ° <code>__torch_function__</code>ä¸­ï¼Œä»è€Œå¼•èµ·æ— é™é€’å½’ã€‚</p><h2 id="torch-autograd"><a href="#torch-autograd" class="headerlink" title="torch.autograd"></a>torch.autograd</h2><p>torch.autograd æä¾›äº†å®ç°ä»»æ„æ ‡é‡å€¼å‡½æ•°è‡ªåŠ¨å¾®åˆ†çš„ç±»å’Œå‡½æ•°.</p><p>å®ƒåªéœ€å¯¹ç°æœ‰ä»£ç åšæå°‘çš„æ”¹åŠ¨â€”ä½ åªéœ€ç”¨ requires_grad=True å…³é”®å­—å£°æ˜éœ€è¦è®¡ç®—æ¢¯åº¦çš„å¼ é‡.</p><p>ç›®å‰åªæŒæµ®ç‚¹å¼ é‡ç±»å‹ï¼ˆåŠæµ®ç‚¹ã€æµ®ç‚¹ã€åŒæµ®ç‚¹å’Œ bfloat16ï¼‰å’Œå¤åˆå¼ é‡ç±»å‹ï¼ˆcfloatã€cdoubleï¼‰çš„ autograd.</p><h3 id="detach-è®¡ç®—å›¾ä¸leaf-tensor"><a href="#detach-è®¡ç®—å›¾ä¸leaf-tensor" class="headerlink" title="detach è®¡ç®—å›¾ä¸leaf tensor"></a>detach è®¡ç®—å›¾ä¸leaf tensor</h3><p><code>Tensor.detach()</code>è¿”å›ä¸€ä¸ªä»å½“å‰è®¡ç®—å›¾ä¸­åˆ†ç¦»å‡ºæ¥çš„æ–°å¼ é‡,ç”Ÿæˆçš„å¼ é‡æ°¸è¿œä¸éœ€è¦æ¢¯åº¦,ç›®å‰æ›¿ä»£äº†<code>.data</code>æ–¹æ³•.</p><p> PyTorch ä¸­,è®¡ç®—å›¾(Computation Graph)æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„æ¦‚å¿µ.å®ƒæ˜¯ä¸€ç§ç”¨äºè¡¨ç¤ºå’Œæ‰§è¡Œæœºå™¨å­¦ä¹ æ¨¡å‹çš„æ•°æ®ç»“æ„.</p><p>å…·ä½“æ¥è¯´,PyTorch ä¸­çš„è®¡ç®—å›¾ç”±ä»¥ä¸‹å‡ ä¸ªå…³é”®ç»„ä»¶ç»„æˆ:</p><ol><li><strong>å¼ é‡(Tensor)</strong>:è®¡ç®—å›¾çš„åŸºæœ¬å•å…ƒ,è¡¨ç¤ºè¾“å…¥æ•°æ®ã€ä¸­é—´ç»“æœå’Œæœ€ç»ˆè¾“å‡º.</li><li><strong>æ“ä½œ(Operation)</strong>:åœ¨å¼ é‡ä¸Šæ‰§è¡Œçš„å„ç§æ•°å­¦è¿ç®—,å¦‚åŠ æ³•ã€ä¹˜æ³•ã€å·ç§¯ç­‰.</li><li><strong>èŠ‚ç‚¹(Node)</strong>:è¡¨ç¤ºå¼ é‡å’Œæ“ä½œ,è®¡ç®—å›¾ç”±è¿™äº›èŠ‚ç‚¹ç»„æˆ.</li><li><strong>è¾¹(Edge)</strong>:è¡¨ç¤ºèŠ‚ç‚¹ä¹‹é—´çš„ä¾èµ–å…³ç³»,æ•°æ®æ²¿ç€è¾¹æµåŠ¨.</li></ol><p>å½“åœ¨ PyTorch ä¸­å®šä¹‰å’Œæ‰§è¡Œæœºå™¨å­¦ä¹ æ¨¡å‹æ—¶,PyTorch ä¼šè‡ªåŠ¨æ„å»ºä¸€ä¸ªè®¡ç®—å›¾æ¥è¡¨ç¤ºæ¨¡å‹çš„ç»“æ„å’Œæ•°æ®æµ.è¿™ä¸ªè®¡ç®—å›¾å¯ä»¥ç”¨äºä»¥ä¸‹å‡ ä¸ªæ–¹é¢:</p><ol><li><strong>å‰å‘ä¼ æ’­</strong>:é€šè¿‡è®¡ç®—å›¾,PyTorch å¯ä»¥è‡ªåŠ¨è®¡ç®—æ¨¡å‹çš„è¾“å‡º.</li><li><strong>åå‘ä¼ æ’­</strong>:å½“æ‚¨è°ƒç”¨ <code>loss.backward()</code> æ—¶,PyTorch ä¼šæ²¿ç€è®¡ç®—å›¾åå‘ä¼ æ’­æ¢¯åº¦,ä»è€Œæ›´æ–°æ¨¡å‹å‚æ•°.</li><li><strong>å¯è§†åŒ–</strong>:æ‚¨å¯ä»¥ä½¿ç”¨ PyTorch æä¾›çš„å·¥å…·(å¦‚ TensorBoard)æ¥å¯è§†åŒ–è®¡ç®—å›¾,æ›´å¥½åœ°ç†è§£æ¨¡å‹çš„ç»“æ„.</li><li><strong>ä¼˜åŒ–</strong>:PyTorch çš„ä¼˜åŒ–å™¨ä¼šåˆ©ç”¨è®¡ç®—å›¾çš„ç»“æ„æ¥æé«˜ä¼˜åŒ–æ•ˆç‡.</li></ol><p>detachä½¿å¾—tensorä»è®¡ç®—å›¾ä¸­åˆ†ç¦»å…·ä½“æ˜¯ä»€ä¹ˆå«ä¹‰?ç®€å•æ¥è¯´,ä½¿å¾—å®ƒæœ¬èº«requires_grad=False,å®ƒä¹‹å‰çš„è®¡ç®—ä¹Ÿè¢«é˜»æ–­äº†.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">input</span> = torch.randn(<span class="number">1</span>, <span class="number">20</span>, <span class="number">10</span>)</span><br><span class="line">model = nn.Linear(<span class="number">10</span>, <span class="number">3</span>)</span><br><span class="line">inter = model(<span class="built_in">input</span>)</span><br><span class="line">model2 = nn.Linear(<span class="number">3</span>, <span class="number">1</span>)</span><br><span class="line">output = model2(inter.detach())</span><br><span class="line">loss = torch.mean(output - <span class="number">1</span>)</span><br><span class="line">loss.backward()</span><br><span class="line"><span class="built_in">print</span>(model.weight.grad) <span class="comment"># None</span></span><br></pre></td></tr></table></figure><p>æŒ‰ç…§æƒ¯ä¾‹,æ‰€æœ‰<strong>requires_grad ä¸ºFalseçš„å¼ é‡éƒ½æ˜¯leaf tensor</strong>.</p><p>å¯¹äº<strong>requires_grad ä¸º True çš„å¼ é‡,å¦‚æœå®ƒä»¬æ˜¯ç”±ç”¨æˆ·åˆ›å»º(æ²¡æœ‰ç»è¿‡è®¡ç®—,åŒ…æ‹¬ç§»åŠ¨åˆ°GPUçš„æ“ä½œ)çš„,é‚£ä¹ˆå®ƒä»¬å°†æ˜¯å¶å­å¼ é‡</strong>.è¿™æ„å‘³ç€å®ƒä»¬ä¸æ˜¯æ“ä½œçš„ç»“æœ,å› æ­¤ grad_fn ä¸º None.</p><p>åªæœ‰å¶å­å¼ é‡æ‰ä¼šåœ¨è°ƒç”¨ backward() æ—¶è¢«å¡«å……æ¢¯åº¦.è¦ä¸ºéå¶å­å¼ é‡å¡«å……é˜¶å€¼,å¯ä»¥ä½¿ç”¨ retain_grad().</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">xx = torch.randn(<span class="number">1</span>, <span class="number">3</span>).requires_grad_(<span class="literal">True</span>)</span><br><span class="line"><span class="built_in">print</span>(xx.grad_fn, xx.is_leaf) <span class="comment"># None,True</span></span><br><span class="line">model = nn.Linear(<span class="number">3</span>, <span class="number">1</span>)</span><br><span class="line">output = model(xx)</span><br><span class="line">loss = torch.mean(output - <span class="number">1</span>)</span><br><span class="line">loss.backward()</span><br><span class="line"><span class="built_in">print</span>(xx.grad_fn, xx.grad) <span class="comment"># None,tensor([[.., ..,  ..]])</span></span><br><span class="line"><span class="built_in">print</span>(model.weight.grad_fn, model.weight.grad) <span class="comment"># None,,tensor([[.., ..,  ..]])</span></span><br><span class="line"><span class="built_in">print</span>(model.bias.grad_fn, model.bias.grad) <span class="comment"># None,tensor([1])</span></span><br><span class="line"><span class="built_in">print</span>(model.weight.is_leaf, model.bias.is_leaf) <span class="comment"># True,True</span></span><br></pre></td></tr></table></figure><p>åªèƒ½è·å–è®¡ç®—å›¾ä¸­å¶å­èŠ‚ç‚¹çš„æ¢¯åº¦å±æ€§,è¿™äº›èŠ‚ç‚¹çš„ requires_grad å±æ€§è®¾ç½®ä¸º True.å¯¹äºå›¾ä¸­çš„æ‰€æœ‰å…¶ä»–èŠ‚ç‚¹,æ¢¯åº¦å±æ€§å°†ä¸å¯ç”¨.</p><p>å‡ºäºæ€§èƒ½è€ƒè™‘,æˆ‘ä»¬åªèƒ½åœ¨ç»™å®šå›¾å½¢ä¸Šä½¿ç”¨ä¸€æ¬¡åå‘æ“ä½œæ‰§è¡Œæ¢¯åº¦è®¡ç®—.å¦‚æœæˆ‘ä»¬éœ€è¦åœ¨åŒä¸€å›¾å½¢ä¸Šæ‰§è¡Œå¤šæ¬¡ backward è°ƒç”¨,åˆ™éœ€è¦å‘ backward è°ƒç”¨ä¼ é€’ retain_graph=True å±æ€§.</p><p>å‡ ä¸ªé—®é¢˜:</p><p>leaf tensorçš„grad_fnä¸€å®šä¸ºç©ºå—? ä¸ä¸€å®š,ç”¨æˆ·åˆ›å»ºçš„requires_gradä¸ºTrueçš„tensorçš„grad_fnä¸ä¸ºç©º</p><p>leaf tensorä¸€å®šæ˜¯æ¨¡å‹è¾“å…¥å—?ä¸ä¸€å®š,äº‹å®ä¸Šç›´æ¥åˆ›å»ºä¸€ä¸ªæ¨¡å‹,å®ƒçš„weightå’Œbiasä¹Ÿæ˜¯leaf tensor</p><h3 id="å±äºæ—§æ—¶ä»£çš„Variableå’Œdata"><a href="#å±äºæ—§æ—¶ä»£çš„Variableå’Œdata" class="headerlink" title="å±äºæ—§æ—¶ä»£çš„Variableå’Œdata"></a>å±äºæ—§æ—¶ä»£çš„Variableå’Œdata</h3><p>Variable API å·²è¢«å¼ƒç”¨:ä½¿ç”¨å¼ é‡æ—¶,ä¸å†éœ€è¦Variable.å¦‚æœ requires_grad è®¾ç½®ä¸º True,Autograd å°†è‡ªåŠ¨æ”¯æŒå¼ é‡.</p><p>Variable(tensor) å’Œ Variable(tensor, requires_grad) ä»æŒ‰é¢„æœŸå·¥ä½œ,ä½†å®ƒä»¬è¿”å›çš„æ˜¯å¼ é‡è€Œä¸æ˜¯å˜é‡.</p><p>var.data ä¸ tensor.data ç›¸åŒ.</p><p>var.backward()ã€var.detach()ã€var.register_hook() ç­‰æ–¹æ³•ç°åœ¨å¯ä»¥åœ¨å…·æœ‰ç›¸åŒæ–¹æ³•åçš„å¼ é‡ä¸Šè¿è¡Œ.</p><p>æ­¤å¤–,ç°åœ¨è¿˜å¯ä»¥ä½¿ç”¨ torch.randn()ã€torch.zeros()ã€torch.none() ç­‰å·¥å‚æ–¹æ³•åˆ›å»º requires_grad=True çš„å¼ é‡:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">autograd_tensor = torch.randn((<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>), requires_grad=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><div class="table-container"><table><thead><tr><th>api</th><th>ä»‹ç»</th></tr></thead><tbody><tr><td><code>torch.Tensor.grad</code></td><td>This attribute is <code>None</code> by default and becomes a Tensor the first time a call to <a href="https://pytorch.org/docs/stable/generated/torch.autograd.backward.html#torch.autograd.backward"><code>backward()</code></a> computes gradients for <code>self</code></td></tr><tr><td><code>torch.Tensor.requires_grad</code></td><td>Is <code>True</code> if gradients need to be computed for this Tensor, <code>False</code> otherwise.</td></tr><tr><td><code>torch.Tensor.is_leaf</code></td><td>All Tensors that have <code>requires_grad</code> which is <code>False</code> will be leaf Tensors by convention.</td></tr><tr><td><code>torch.Tensor.backward</code>([gradient, â€¦])</td><td>Computes the gradient of current tensor wrt graph leaves.</td></tr><tr><td><code>torch.Tensor.detach</code></td><td>Returns a new Tensor, detached from the current graph.</td></tr><tr><td><code>torch.Tensor.detach_</code></td><td>Detaches the Tensor from the graph that created it, making it a leaf.</td></tr><tr><td><code>torch.Tensor.register_hook</code>(hook)</td><td>Registers a backward hook.</td></tr><tr><td><code>torch.Tensor.register_post_accumulate_grad_hook</code>(hook)</td><td>Registers a backward hook that runs after grad accumulation.</td></tr><tr><td><code>torch.Tensor.retain_grad</code>()</td><td>Enables this Tensor to have their <a href="https://pytorch.org/docs/stable/generated/torch.autograd.grad.html#torch.autograd.grad"><code>grad</code></a> populated during <a href="https://pytorch.org/docs/stable/generated/torch.autograd.backward.html#torch.autograd.backward"><code>backward()</code></a>.</td></tr></tbody></table></div><h3 id="Function"><a href="#Function" class="headerlink" title="Function"></a>Function</h3><p>è¦åˆ›å»ºè‡ªå®šä¹‰ autograd.Function,è¯·ç»§æ‰¿è¯¥ç±»å¹¶å®ç° forward() å’Œ backward() é™æ€æ–¹æ³•.ç„¶å,è¦åœ¨å‰å‘ä¼ é€’ä¸­ä½¿ç”¨è‡ªå®šä¹‰ op,è°ƒç”¨ç±»æ–¹æ³• apply.ä¸è¦ç›´æ¥è°ƒç”¨ forward().</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Exp</span>(<span class="params">Function</span>):</span></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span>(<span class="params">ctx, i</span>):</span></span><br><span class="line">        result = i.exp()</span><br><span class="line">        ctx.save_for_backward(result)</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">backward</span>(<span class="params">ctx, grad_output</span>):</span></span><br><span class="line">        result, = ctx.saved_tensors</span><br><span class="line">        <span class="keyword">return</span> grad_output * result</span><br><span class="line"></span><br><span class="line">Use it by calling the apply method:</span><br><span class="line">output = Exp.apply(<span class="built_in">input</span>)</span><br></pre></td></tr></table></figure><h2 id="ONNXæ ¼å¼"><a href="#ONNXæ ¼å¼" class="headerlink" title="ONNXæ ¼å¼"></a>ONNXæ ¼å¼</h2><p>åœ¨å®é™…éƒ¨ç½²æ—¶éå¸¸å¸¸ç”¨çš„æ¨¡å‹æ ¼å¼,æ˜¯å±è”½äº†æ¡†æ¶çš„.</p><p><a href="https://pytorch.org/tutorials/advanced/super_resolution_with_onnxruntime.html">(optional) Exporting a Model from PyTorch to ONNX and Running it using ONNX Runtime â€” PyTorch Tutorials 2.3.0+cu121 documentation</a></p><h3 id="ä¿å­˜æ¨¡å‹"><a href="#ä¿å­˜æ¨¡å‹" class="headerlink" title="ä¿å­˜æ¨¡å‹"></a>ä¿å­˜æ¨¡å‹</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torchvision</span><br><span class="line"></span><br><span class="line">dummy_input = torch.randn(<span class="number">10</span>, <span class="number">3</span>, <span class="number">224</span>, <span class="number">224</span>, device=<span class="string">&quot;cuda&quot;</span>)</span><br><span class="line">model = torchvision.models.alexnet(pretrained=<span class="literal">True</span>).cuda()</span><br><span class="line"></span><br><span class="line">input_names = [ <span class="string">&quot;actual_input_1&quot;</span> ] + [ <span class="string">&quot;learned_%d&quot;</span> % i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>) ]</span><br><span class="line">output_names = [ <span class="string">&quot;output1&quot;</span> ]</span><br><span class="line"></span><br><span class="line">torch.onnx.export(model, dummy_input, <span class="string">&quot;alexnet.onnx&quot;</span>, verbose=<span class="literal">True</span>, input_names=input_names, output_names=output_names)</span><br></pre></td></tr></table></figure><p>ç”Ÿæˆçš„ <code>alexnet.onnx</code> æ–‡ä»¶åŒ…å«ä¸€ä¸ª <a href="https://developers.google.com/protocol-buffers/">protocol buffer</a>,å…¶ä¸­åŒ…å«äº†å¯¼å‡ºçš„æ¨¡å‹(åœ¨æœ¬ä¾‹ä¸­ä¸º AlexNet)çš„ç½‘ç»œç»“æ„å’Œå‚æ•°.<code>verbose=True</code> å‚æ•°ä¼šå¯¼è‡´å¯¼å‡ºå™¨æ‰“å°å‡ºæ¨¡å‹çš„äººç±»å¯è¯»è¡¨ç¤º.</p><h4 id="åŠ è½½æ¨¡å‹"><a href="#åŠ è½½æ¨¡å‹" class="headerlink" title="åŠ è½½æ¨¡å‹"></a>åŠ è½½æ¨¡å‹</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install onnx</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> onnx</span><br><span class="line"><span class="comment"># Load the ONNX model</span></span><br><span class="line">model = onnx.load(<span class="string">&quot;alexnet.onnx&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Check that the model is well formed</span></span><br><span class="line">onnx.checker.check_model(model)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Print a human readable representation of the graph</span></span><br><span class="line"><span class="built_in">print</span>(onnx.helper.printable_graph(model.graph))</span><br><span class="line">You can also run the exported model <span class="keyword">with</span> one of the many runtimes that support ONNX. For example after installing ONNX Runtime, you can load <span class="keyword">and</span> run the model:</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> onnxruntime <span class="keyword">as</span> ort</span><br><span class="line"></span><br><span class="line">ort_session = ort.InferenceSession(<span class="string">&quot;alexnet.onnx&quot;</span>)</span><br><span class="line"></span><br><span class="line">outputs = ort_session.run(</span><br><span class="line">    <span class="literal">None</span>,</span><br><span class="line">    &#123;<span class="string">&quot;actual_input_1&quot;</span>: np.random.randn(<span class="number">10</span>, <span class="number">3</span>, <span class="number">224</span>, <span class="number">224</span>).astype(np.float32)&#125;,</span><br><span class="line">)</span><br><span class="line"><span class="built_in">print</span>(outputs[<span class="number">0</span>])</span><br><span class="line"><span class="comment"># Print a human readable representation of the graph</span></span><br><span class="line"><span class="built_in">print</span>(onnx.helper.printable_graph(model.graph))</span><br></pre></td></tr></table></figure><h3 id="æµç¨‹"><a href="#æµç¨‹" class="headerlink" title="æµç¨‹"></a>æµç¨‹</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Input to the model</span></span><br><span class="line">x = torch.randn(batch_size, <span class="number">1</span>, <span class="number">224</span>, <span class="number">224</span>, requires_grad=<span class="literal">True</span>)</span><br><span class="line">torch_out = torch_model(x)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Export the model</span></span><br><span class="line">torch.onnx.export(torch_model,               <span class="comment"># model being run</span></span><br><span class="line">                  x,                         <span class="comment"># model input (or a tuple for multiple inputs)</span></span><br><span class="line">                  <span class="string">&quot;super_resolution.onnx&quot;</span>,   <span class="comment"># where to save the model (can be a file or file-like object)</span></span><br><span class="line">                  export_params=<span class="literal">True</span>,        <span class="comment"># store the trained parameter weights inside the model file</span></span><br><span class="line">                  opset_version=<span class="number">10</span>,          <span class="comment"># the ONNX version to export the model to</span></span><br><span class="line">                  do_constant_folding=<span class="literal">True</span>,  <span class="comment"># whether to execute constant folding for optimization</span></span><br><span class="line">                  input_names = [<span class="string">&#x27;input&#x27;</span>],   <span class="comment"># the model&#x27;s input names</span></span><br><span class="line">                  output_names = [<span class="string">&#x27;output&#x27;</span>], <span class="comment"># the model&#x27;s output names</span></span><br><span class="line">                  dynamic_axes=&#123;<span class="string">&#x27;input&#x27;</span> : &#123;<span class="number">0</span> : <span class="string">&#x27;batch_size&#x27;</span>&#125;,    <span class="comment"># variable length axes</span></span><br><span class="line">                                <span class="string">&#x27;output&#x27;</span> : &#123;<span class="number">0</span> : <span class="string">&#x27;batch_size&#x27;</span>&#125;&#125;)</span><br></pre></td></tr></table></figure><p>åœ¨pytorchä¸­ç›´æ¥ä½¿ç”¨<code>torch.onnx.export</code>å³å¯.</p><p>å› ä¸ºå¯¼å‡ºè¿è¡Œäº†æ¨¡å‹,æˆ‘ä»¬éœ€è¦æä¾›ä¸€ä¸ªè¾“å…¥å¼ é‡ <code>x</code>.è¿™ä¸ªè¾“å…¥çš„å€¼å¯ä»¥æ˜¯éšæœºçš„,åªè¦å®ƒçš„ç±»å‹å’Œå¤§å°æ˜¯æ­£ç¡®çš„.è¯·æ³¨æ„,é™¤éæŒ‡å®šä¸ºdynamic_axes,å¦åˆ™å¯¼å‡ºçš„ ONNX å›¾ä¸­è¾“å…¥çš„æ‰€æœ‰ç»´åº¦å¤§å°éƒ½ä¼šè¢«å›ºå®šä¸‹æ¥.åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­,ä½¿ç”¨æ‰¹é‡å¤§å°ä¸º 1 çš„è¾“å…¥å¯¼å‡ºæ¨¡å‹,ä½†åœ¨ <code>torch.onnx.export()</code> çš„ <code>dynamic_axes</code> å‚æ•°ä¸­æŒ‡å®šäº†ç¬¬ä¸€ä¸ªç»´åº¦ä¸ºåŠ¨æ€çš„.å› æ­¤,å¯¼å‡ºçš„æ¨¡å‹å°†æ¥å—å¤§å°ä¸º <code>[batch_size, 1, 224, 224]</code> çš„è¾“å…¥,å…¶ä¸­ <code>batch_size</code> å¯ä»¥æ˜¯å¯å˜çš„.</p><p>åŒæ—¶è¿˜è®¡ç®—äº†æ¨¡å‹è¾“å‡º <code>torch_out</code>,æˆ‘ä»¬å°†ä½¿ç”¨å®ƒæ¥éªŒè¯åœ¨ ONNX Runtime ä¸­è¿è¡Œæ—¶å¯¼å‡ºçš„æ¨¡å‹æ˜¯å¦è®¡ç®—å‡ºç›¸åŒçš„å€¼.</p><p>ä½†åœ¨ä½¿ç”¨ ONNX Runtime éªŒè¯æ¨¡å‹è¾“å‡ºä¹‹å‰,æˆ‘ä»¬ä¼šå…ˆä½¿ç”¨ ONNX API æ£€æŸ¥ ONNX æ¨¡å‹.é¦–å…ˆ,<code>onnx.load(&quot;super_resolution.onnx&quot;)</code> ä¼šåŠ è½½ä¿å­˜çš„æ¨¡å‹,å¹¶è¾“å‡ºä¸€ä¸ª <code>onnx.ModelProto</code> ç»“æ„.ç„¶å,<code>onnx.checker.check_model(onnx_model)</code> ä¼šéªŒè¯æ¨¡å‹çš„ç»“æ„,å¹¶ç¡®è®¤æ¨¡å‹å…·æœ‰æœ‰æ•ˆçš„æ¶æ„.é€šè¿‡æ£€æŸ¥æ¨¡å‹çš„ç‰ˆæœ¬ã€å›¾ç»“æ„ä»¥åŠèŠ‚ç‚¹åŠå…¶è¾“å…¥å’Œè¾“å‡º,æ¥éªŒè¯ ONNX å›¾çš„æœ‰æ•ˆæ€§.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> onnx</span><br><span class="line">onnx_model = onnx.load(<span class="string">&quot;super_resolution.onnx&quot;</span>)</span><br><span class="line">onnx.checker.check_model(onnx_model)</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ ONNX Runtime çš„ Python API è®¡ç®—è¾“å‡º,é€šå¸¸æƒ…å†µä¸‹,è¿™ä¸€éƒ¨åˆ†å¯ä»¥åœ¨å•ç‹¬çš„è¿›ç¨‹ä¸­æˆ–å…¶ä»–æœºå™¨ä¸Šå®Œæˆ,ä½†æˆ‘ä»¬å°†ç»§ç»­åœ¨åŒä¸€è¿›ç¨‹ä¸­è¿›è¡Œ,è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥éªŒè¯ ONNX Runtime å’Œ PyTorch ä¸ºè¯¥ç½‘ç»œè®¡ç®—å‡ºçš„å€¼æ˜¯å¦ç›¸åŒ.</p><p>ä¸ºäº†ä½¿ç”¨ ONNX Runtime è¿è¡Œæ¨¡å‹,æˆ‘ä»¬éœ€è¦ä¸ºæ¨¡å‹åˆ›å»ºä¸€ä¸ªInferenceSession,å¹¶è®¾ç½®æ‰€éœ€çš„é…ç½®å‚æ•°(è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨é»˜è®¤é…ç½®).åˆ›å»ºä¼šè¯å,æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ <code>run()</code> API æ¥è¯„ä¼°æ¨¡å‹äº†.è¯¥è°ƒç”¨çš„è¾“å‡ºæ˜¯ä¸€ä¸ªåˆ—è¡¨,åŒ…å« ONNX Runtime è®¡ç®—å¾—å‡ºçš„æ¨¡å‹è¾“å‡º.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> onnxruntime</span><br><span class="line"></span><br><span class="line">ort_session = onnxruntime.InferenceSession(<span class="string">&quot;super_resolution.onnx&quot;</span>, providers=[<span class="string">&quot;CPUExecutionProvider&quot;</span>])</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">to_numpy</span>(<span class="params">tensor</span>):</span></span><br><span class="line">    <span class="keyword">return</span> tensor.detach().cpu().numpy() <span class="keyword">if</span> tensor.requires_grad <span class="keyword">else</span> tensor.cpu().numpy()</span><br><span class="line"></span><br><span class="line"><span class="comment"># compute ONNX Runtime output prediction</span></span><br><span class="line">ort_inputs = &#123;ort_session.get_inputs()[<span class="number">0</span>].name: to_numpy(x)&#125;</span><br><span class="line">ort_outs = ort_session.run(<span class="literal">None</span>, ort_inputs)</span><br><span class="line"></span><br><span class="line"><span class="comment"># compare ONNX Runtime and PyTorch results</span></span><br><span class="line">np.testing.assert_allclose(to_numpy(torch_out), ort_outs[<span class="number">0</span>], rtol=<span class="number">1e-03</span>, atol=<span class="number">1e-05</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Exported model has been tested with ONNXRuntime, and the result looks good!&quot;</span>)</span><br></pre></td></tr></table></figure><h4 id="æ³¨æ„"><a href="#æ³¨æ„" class="headerlink" title="æ³¨æ„"></a>æ³¨æ„</h4><p>åœ¨æ¨¡å‹ä¸­é¿å…ä½¿ç”¨numpy,tensor.data,tensor.shapeä¸èƒ½ä½¿ç”¨in_placeæ“ä½œ</p><h2 id="è‡ªåŠ¨æ··åˆç²¾åº¦"><a href="#è‡ªåŠ¨æ··åˆç²¾åº¦" class="headerlink" title="è‡ªåŠ¨æ··åˆç²¾åº¦"></a>è‡ªåŠ¨æ··åˆç²¾åº¦</h2><p>torch.amp ä¸ºæ··åˆç²¾åº¦æä¾›äº†æ–¹ä¾¿çš„æ–¹æ³•,å…¶ä¸­ä¸€äº›æ“ä½œä½¿ç”¨ torch.float32 ï¼ˆæµ®ç‚¹ï¼‰æ•°æ®ç±»å‹,å¦ä¸€äº›æ“ä½œä½¿ç”¨è¾ƒä½ç²¾åº¦çš„æµ®ç‚¹æ•°æ®ç±»å‹ (lower_precision_fp):torch.float16ï¼ˆåŠç²¾åº¦ï¼‰æˆ– torch.bfloat16.ä¸€äº›æ“ä½œ,å¦‚çº¿æ€§å±‚å’Œå·ç§¯,åœ¨ lower_precision_fp ä¸‹é€Ÿåº¦æ›´å¿«.å…¶ä»–æ“ä½œ,å¦‚è¿˜åŸ,é€šå¸¸éœ€è¦ float32 çš„åŠ¨æ€èŒƒå›´.æ··åˆç²¾åº¦è¯•å›¾å°†æ¯ä¸ªæ“ä½œä¸ç›¸åº”çš„æ•°æ®ç±»å‹ç›¸åŒ¹é….</p><p>é€šå¸¸,æ•°æ®ç±»å‹ä¸º torch.float16 çš„ â€œè‡ªåŠ¨æ··åˆç²¾åº¦è®­ç»ƒ â€œä½¿ç”¨ torch.autocast å’Œ torch.cpu.amp.GradScaler æˆ– torch.cuda.amp.GradScaler.</p><p>torch.autocast å®ä¾‹å¯å¯¹æ‰€é€‰ä¸Šä¸‹æ–‡è¿›è¡Œè‡ªåŠ¨casting.è‡ªåŠ¨castä¼šè‡ªåŠ¨é€‰æ‹© GPU è¿ç®—çš„ç²¾åº¦,ä»è€Œåœ¨ä¿æŒç²¾åº¦çš„åŒæ—¶æé«˜æ€§èƒ½.</p><p>torch.cuda.amp.GradScaler çš„å®ä¾‹æœ‰åŠ©äºæ–¹ä¾¿åœ°æ‰§è¡Œæ¢¯åº¦ç¼©æ”¾æ­¥éª¤.<strong>æ¢¯åº¦ç¼©æ”¾å¯æœ€å¤§é™åº¦åœ°å‡å°‘æ¢¯åº¦ä¸‹æº¢</strong>,ä»è€Œæ”¹å–„å…·æœ‰ float16 æ¢¯åº¦çš„ç½‘ç»œçš„æ”¶æ•›æ€§.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Creates model and optimizer in default precision</span></span><br><span class="line">model = Net().cuda()</span><br><span class="line">optimizer = optim.SGD(model.parameters(), ...)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Creates a GradScaler once at the beginning of training.</span></span><br><span class="line">scaler = GradScaler()  <span class="comment"># 1. åˆ›å»ºgradscaler</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> epoch <span class="keyword">in</span> epochs:</span><br><span class="line">    <span class="keyword">for</span> <span class="built_in">input</span>, target <span class="keyword">in</span> data:</span><br><span class="line">        optimizer.zero_grad()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Runs the forward pass with autocasting.</span></span><br><span class="line">        <span class="comment"># 2.ä½¿å¾—æ¨¡å‹è®­ç»ƒæ—¶ç›¸å…³å‚æ•°ç±»å‹è‡ªåŠ¨è½¬æ¢</span></span><br><span class="line">        <span class="keyword">with</span> autocast(device_type=<span class="string">&#x27;cuda&#x27;</span>, dtype=torch.float16):</span><br><span class="line">            output = model(<span class="built_in">input</span>)</span><br><span class="line">            loss = loss_fn(output, target)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Scales loss.  Calls backward() on scaled loss to create scaled gradients.</span></span><br><span class="line">        <span class="comment"># Backward passes under autocast are not recommended.</span></span><br><span class="line">        <span class="comment"># Backward ops run in the same dtype autocast chose for corresponding forward ops.</span></span><br><span class="line">        scaler.scale(loss).backward()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># scaler.step() first unscales the gradients of the optimizer&#x27;s assigned params.</span></span><br><span class="line">        <span class="comment"># If these gradients do not contain infs or NaNs, optimizer.step() is then called,</span></span><br><span class="line">        <span class="comment"># otherwise, optimizer.step() is skipped.</span></span><br><span class="line">        scaler.step(optimizer)   </span><br><span class="line">        <span class="comment"># Updates the scale for next iteration.</span></span><br><span class="line">        scaler.update()</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Creates model and optimizer in default precision</span></span><br><span class="line">model = Net().cuda()</span><br><span class="line">optimizer = optim.SGD(model.parameters(), ...)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> <span class="built_in">input</span>, target <span class="keyword">in</span> data:</span><br><span class="line">    optimizer.zero_grad()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Enables autocasting for the forward pass (model + loss)</span></span><br><span class="line">    <span class="keyword">with</span> torch.autocast(device_type=<span class="string">&quot;cuda&quot;</span>):</span><br><span class="line">        output = model(<span class="built_in">input</span>)</span><br><span class="line">        loss = loss_fn(output, target)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Exits the context manager before backward()</span></span><br><span class="line">    loss.backward()</span><br><span class="line">    optimizer.step()</span><br></pre></td></tr></table></figure><p>æ‰€æœ‰ç”± scaler.scale(loss).backward() ç”Ÿæˆçš„æ¢¯åº¦éƒ½æ˜¯æŒ‰æ¯”ä¾‹ç¼©æ”¾çš„.å¦‚æœè¦åœ¨ backward() å’Œ scaler.step(optimizer) ä¹‹é—´ä¿®æ”¹æˆ–æ£€æŸ¥å‚æ•°çš„ .grad å±æ€§,åº”é¦–å…ˆå–æ¶ˆç¼©æ”¾.</p><p><strong>æ¢¯åº¦æƒ©ç½š</strong></p><p>æ¢¯åº¦æƒ©ç½šçš„å®ç°é€šå¸¸ä½¿ç”¨ torch.autograd.grad() åˆ›å»ºæ¢¯åº¦,å°†å®ƒä»¬ç»„åˆèµ·æ¥åˆ›å»ºæƒ©ç½šå€¼,å¹¶å°†æƒ©ç½šå€¼æ·»åŠ åˆ°æŸå¤±ä¸­.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> epoch <span class="keyword">in</span> epochs:</span><br><span class="line">    <span class="keyword">for</span> <span class="built_in">input</span>, target <span class="keyword">in</span> data:</span><br><span class="line">        optimizer.zero_grad()</span><br><span class="line">        output = model(<span class="built_in">input</span>)</span><br><span class="line">        loss = loss_fn(output, target)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Creates gradients</span></span><br><span class="line">        grad_params = torch.autograd.grad(outputs=loss,</span><br><span class="line">                                          inputs=model.parameters(),</span><br><span class="line">                                          create_graph=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Computes the penalty term and adds it to the loss</span></span><br><span class="line">        grad_norm = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> grad <span class="keyword">in</span> grad_params:</span><br><span class="line">            grad_norm += grad.<span class="built_in">pow</span>(<span class="number">2</span>).<span class="built_in">sum</span>()</span><br><span class="line">        grad_norm = grad_norm.sqrt()</span><br><span class="line">        loss = loss + grad_norm</span><br><span class="line"></span><br><span class="line">        loss.backward()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># clip gradients here, if desired</span></span><br><span class="line"></span><br><span class="line">        optimizer.step()</span><br></pre></td></tr></table></figure><p>è¦é€šè¿‡æ¢¯åº¦ç¼©æ”¾å®ç°æ¢¯åº¦æƒ©ç½š,åº”ç¼©æ”¾ä¼ é€’ç»™ torch.autograd.grad() çš„è¾“å‡ºå¼ é‡.å› æ­¤,ç”Ÿæˆçš„æ¢¯åº¦ä¹Ÿå°†è¢«ç¼©æ”¾,åœ¨åˆå¹¶ç”Ÿæˆæƒ©ç½šå€¼ä¹‹å‰åº”å–æ¶ˆç¼©æ”¾.</p><p>æ­¤å¤–,æƒ©ç½šé¡¹çš„è®¡ç®—æ˜¯å‰å‘ä¼ é€’çš„ä¸€éƒ¨åˆ†,å› æ­¤åº”åœ¨è‡ªåŠ¨ä¼ é€’ä¸Šä¸‹æ–‡ä¸­è¿›è¡Œ.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">scaler = torch.cuda.amp.GradScaler()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> epoch <span class="keyword">in</span> epochs:</span><br><span class="line">    <span class="keyword">for</span> <span class="built_in">input</span>, target <span class="keyword">in</span> data:</span><br><span class="line">        optimizer0.zero_grad()</span><br><span class="line">        optimizer1.zero_grad()</span><br><span class="line">        <span class="keyword">with</span> autocast(device_type=<span class="string">&#x27;cuda&#x27;</span>, dtype=torch.float16):</span><br><span class="line">            output0 = model0(<span class="built_in">input</span>)</span><br><span class="line">            output1 = model1(<span class="built_in">input</span>)</span><br><span class="line">            loss0 = loss_fn(<span class="number">2</span> * output0 + <span class="number">3</span> * output1, target)</span><br><span class="line">            loss1 = loss_fn(<span class="number">3</span> * output0 - <span class="number">5</span> * output1, target)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># (retain_graph here is unrelated to amp, it&#x27;s present because in this</span></span><br><span class="line">        <span class="comment"># example, both backward() calls share some sections of graph.)</span></span><br><span class="line">        scaler.scale(loss0).backward(retain_graph=<span class="literal">True</span>)</span><br><span class="line">        scaler.scale(loss1).backward()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># You can choose which optimizers receive explicit unscaling, if you</span></span><br><span class="line">        <span class="comment"># want to inspect or modify the gradients of the params they own.</span></span><br><span class="line">        scaler.unscale_(optimizer0)</span><br><span class="line"></span><br><span class="line">        scaler.step(optimizer0)</span><br><span class="line">        scaler.step(optimizer1)</span><br><span class="line"></span><br><span class="line">        scaler.update()</span><br></pre></td></tr></table></figure><p>å¦‚æœç½‘ç»œæœ‰å¤šä¸ªæŸå¤±,åˆ™å¿…é¡»å¯¹æ¯ä¸ªæŸè€—å•ç‹¬è°ƒç”¨ scaler.scale.å¦‚æœçš„ç½‘ç»œæœ‰å¤šä¸ªä¼˜åŒ–å™¨,æ‚¨å¯ä»¥åœ¨ä»»ä½•ä¸€ä¸ªä¼˜åŒ–å™¨ä¸Šå•ç‹¬è°ƒç”¨ scaler.unscale_,å¹¶ä¸”å¿…é¡»åœ¨æ¯ä¸ªä¼˜åŒ–å™¨ä¸Šå•ç‹¬è°ƒç”¨ scaler.step.</p><p>autocastä¸åœ¨åœ¨ float64 æˆ–éæµ®ç‚¹ç±»å‹ä¸Šè¿›è¡Œè½¬æ¢.ã€‚ä¸ºäº†è·å¾—æœ€ä½³æ€§èƒ½å’Œç¨³å®šæ€§,åœ¨autocaståŒºåŸŸä¸­ä½¿ç”¨out-of-placeè¿ç®—,ä¹Ÿå°±æ˜¯ä½¿ç”¨ç±»ä¼¼a.addmm(b, c)è¿™ç§æ“ä½œ.</p><p>autocastä¼šå°†withä¸‹çš„åŒºåŸŸä¸­çš„è¿ç®—è‡ªåŠ¨è½¬æ¢,è‡ªåŠ¨è½¬å‘åº”åªåŒ…å«ç½‘ç»œçš„å‰å‘ä¼ é€’ï¼ŒåŒ…æ‹¬æŸå¤±è®¡ç®—ã€‚ </p><p>ä¸å»ºè®®ä½¿ç”¨è‡ªåŠ¨è½¬å‘çš„åå‘ä¼ é€’. åå‘æ“ä½œçš„è¿ç®—ç±»å‹æ˜¯autocastä¹‹å‰çš„ç±»å‹.</p><h4 id="cudaä¸Šä¼šè½¬ä¸ºfloat16çš„è¿ç®—"><a href="#cudaä¸Šä¼šè½¬ä¸ºfloat16çš„è¿ç®—" class="headerlink" title="cudaä¸Šä¼šè½¬ä¸ºfloat16çš„è¿ç®—"></a>cudaä¸Šä¼šè½¬ä¸ºfloat16çš„è¿ç®—</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">__matmul__`, `addbmm`, `addmm`, `addmv`, `addr`, `baddbmm`, `bmm`, `chain_matmul`, `multi_dot`, `conv1d`, `conv2d`, `conv3d`, `conv_transpose1d`, `conv_transpose2d`, `conv_transpose3d`, `GRUCell`, `linear`, `LSTMCell`, `matmul`, `mm`, `mv`, `prelu`, `RNNCell</span><br></pre></td></tr></table></figure><h4 id="cudaä¸Šä¼šè½¬ä¸ºfloat32çš„è¿ç®—"><a href="#cudaä¸Šä¼šè½¬ä¸ºfloat32çš„è¿ç®—" class="headerlink" title="cudaä¸Šä¼šè½¬ä¸ºfloat32çš„è¿ç®—"></a>cudaä¸Šä¼šè½¬ä¸ºfloat32çš„è¿ç®—</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">__pow__`, `__rdiv__`, `__rpow__`, `__rtruediv__`, `acos`, `asin`, `binary_cross_entropy_with_logits`, `cosh`, `cosine_embedding_loss`, `cdist`, `cosine_similarity`, `cross_entropy`, `cumprod`, `cumsum`, `dist`, `erfinv`, `exp`, `expm1`, `group_norm`, `hinge_embedding_loss`, `kl_div`, `l1_loss`, `layer_norm`, `log`, `log_softmax`, `log10`, `log1p`, `log2`, `margin_ranking_loss`, `mse_loss`, `multilabel_margin_loss`, `multi_margin_loss`, `nll_loss`, `norm`, `normalize`, `pdist`, `poisson_nll_loss`, `<span class="built_in">pow</span>`, `prod`, `reciprocal`, `rsqrt`, `sinh`, `smooth_l1_loss`, `soft_margin_loss`, `softmax`, `softmin`, `softplus`, `<span class="built_in">sum</span>`, `renorm`, `tan`, `triplet_margin_loss</span><br></pre></td></tr></table></figure><p>è¿˜æœ‰ä¸€äº›è¿ç®—éœ€è¦å¤šä¸ªè¾“å…¥,å¦‚æœè¾“å…¥å…¨æ˜¯float32é‚£è¾“å‡ºå°±æ˜¯float32.ä¹Ÿå°±æ˜¯promote to the widest input type</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">addcdiv`, `addcmul`, `atan2`, `bilinear`, `cross`, `dot`, `grid_sample`, `index_put`, `scatter_add`, `tensordot</span><br></pre></td></tr></table></figure><h4 id="CPUä¸Šä¼šè½¬ä¸ºbfloat16çš„è¿ç®—"><a href="#CPUä¸Šä¼šè½¬ä¸ºbfloat16çš„è¿ç®—" class="headerlink" title="CPUä¸Šä¼šè½¬ä¸ºbfloat16çš„è¿ç®—"></a>CPUä¸Šä¼šè½¬ä¸ºbfloat16çš„è¿ç®—</h4><p>bfloatæ˜¯æ¯”è¾ƒç‰¹æ®Šçš„æ•°æ®ç±»å‹,æ˜¯é’ˆå¯¹æ·±åº¦å­¦ä¹ è¿ç®—ç‰¹åˆ«è°ƒæ•´æŒ‡æ•°ä½å’Œå°æ•°ä½,ä½¿å¾—ç›¸å¯¹äºåŒç­‰ä½æ•°çš„float,å…¶ç²¾åº¦æ›´å°,ä½†èƒ½è¡¨ç¤ºçš„å€¼èŒƒå›´æ›´å¤§,è€Œä¸”é’ˆå¯¹æ˜¾å¡è¿ç®—æ›´å¿«(æ˜¾å¡å‚å•†è°ƒæ•´äº†)</p><div class="table-container"><table><thead><tr><th>Format</th><th>Bits</th><th>Exponent</th><th>Fraction</th><th>sign(ç¬¦å·)</th></tr></thead><tbody><tr><td>FP32</td><td>32</td><td>8</td><td>23</td><td>1</td></tr><tr><td>FP16</td><td>16</td><td>5</td><td>10</td><td>1</td></tr><tr><td>BF16</td><td>16</td><td>8</td><td>7</td><td>1</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conv1d`, `conv2d`, `conv3d`, `bmm`, `mm`, `baddbmm`, `addmm`, `addbmm`, `linear`, `matmul`, `_convolution</span><br></pre></td></tr></table></figure><h4 id="CPUä¸Šä¼šè½¬ä¸ºbfloat32çš„è¿ç®—"><a href="#CPUä¸Šä¼šè½¬ä¸ºbfloat32çš„è¿ç®—" class="headerlink" title="CPUä¸Šä¼šè½¬ä¸ºbfloat32çš„è¿ç®—"></a>CPUä¸Šä¼šè½¬ä¸ºbfloat32çš„è¿ç®—</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conv_transpose1d, conv_transpose2d, conv_transpose3d, avg_pool3d, binary_cross_entropy, grid_sampler, grid_sampler_2d, _grid_sampler_2d_cpu_fallback, grid_sampler_3d, polar, prod, quantile, nanquantile, stft, cdist, trace, view_as_complex, cholesky, cholesky_inverse, cholesky_solve, inverse, lu_solve, orgqr, inverse, ormqr, pinverse, max_pool3d, max_unpool2d, max_unpool3d, adaptive_avg_pool3d, reflection_pad1d, reflection_pad2d, replication_pad1d, replication_pad2d, replication_pad3d, mse_loss, ctc_loss, kl_div, multilabel_margin_loss, fft_fft, fft_ifft, fft_fft2, fft_ifft2, fft_fftn, fft_ifftn, fft_rfft, fft_irfft, fft_rfft2, fft_irfft2, fft_rfftn, fft_irfftn, fft_hfft, fft_ihfft, linalg_matrix_norm, linalg_cond, linalg_matrix_rank, linalg_solve, linalg_cholesky, linalg_svdvals, linalg_eigvals, linalg_eigvalsh, linalg_inv, linalg_householder_product, linalg_tensorinv, linalg_tensorsolve, fake_quantize_per_tensor_affine, eig, geqrf, lstsq, _lu_with_info, qr, solve, svd, symeig, triangular_solve, fractional_max_pool2d, fractional_max_pool3d, adaptive_max_pool3d, multilabel_margin_loss_forward, linalg_qr, linalg_cholesky_ex, linalg_svd, linalg_eig, linalg_eigh, linalg_lstsq, linalg_inv_ex</span><br></pre></td></tr></table></figure><p>ç±»ä¼¼çš„,cpuä¸Šä¹Ÿæœ‰promote to the widest input typeçš„è¿ç®—.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat, stack, index_copy</span><br></pre></td></tr></table></figure><h2 id="å•æœºå™¨-å¤šGPU-è®­ç»ƒæœ€ä½³å®è·µ"><a href="#å•æœºå™¨-å¤šGPU-è®­ç»ƒæœ€ä½³å®è·µ" class="headerlink" title="å•æœºå™¨(å¤šGPU)è®­ç»ƒæœ€ä½³å®è·µ"></a>å•æœºå™¨(å¤šGPU)è®­ç»ƒæœ€ä½³å®è·µ</h2><p>å¦‚æœæœ‰å¤šä¸ªGPU,æ¯ä¸ªGPUä¸Šè¿è¡Œå¤åˆ¶çš„æƒé‡ç›¸åŒçš„æ¨¡å‹,æ•°æ®åˆ†å‘åˆ°å¤šä¸ªGPUä¸Š,è¿™æ ·å°±èƒ½åŠ å¿«è®­ç»ƒ.ä½†æ˜¯æœ‰äº›ä½¿ç”¨ä¸€ä¸ªGPUä¸Šå®¹ä¸ä¸‹ä¸€ä¸ªå®Œæ•´çš„æ¨¡å‹,è¿™ä¸ªæ—¶å€™,å°†ä¸€ä¸ªæ¨¡å‹æ‹†åˆ°ä¸åŒçš„GPUä¸Šå°±æ˜¯ä¸€ä¸ªå¯è¡Œçš„æ–¹æ¡ˆ.</p><p>è¿™é‡Œå°±è¦æåˆ°model parallel(æ¨¡å‹å¹¶è¡Œ),æ¨¡å‹å¹¶è¡Œæ˜¯å°†ä¸€ä¸ªæ¨¡å‹çš„ä¸åŒå­ç½‘ç»œæ”¾åˆ°ä¸åŒçš„è®¾å¤‡ä¸Š,å¹¶ç›¸åº”åœ°forward,ä»¥ä¾¿åœ¨è®¾å¤‡é—´ç§»åŠ¨ä¸­é—´è¾“å‡º.</p><blockquote><p>å¦‚æœæ˜¯è·¨æœºå™¨,å¯ä»¥é€šè¿‡RPC<a href="https://pytorch.org/tutorials/intermediate/rpc_tutorial.html">Getting Started with Distributed RPC Framework â€” PyTorch Tutorials 2.3.0+cu121 documentation</a></p></blockquote><p>ä¸€ä¸ªç®€å•çš„ä¾‹å­</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torch.nn <span class="keyword">as</span> nn</span><br><span class="line"><span class="keyword">import</span> torch.optim <span class="keyword">as</span> optim</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ToyModel</span>(<span class="params">nn.Module</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">super</span>(ToyModel, self).__init__()</span><br><span class="line">        self.net1 = torch.nn.Linear(<span class="number">10</span>, <span class="number">10</span>).to(<span class="string">&#x27;cuda:0&#x27;</span>)</span><br><span class="line">        self.relu = torch.nn.ReLU()</span><br><span class="line">        self.net2 = torch.nn.Linear(<span class="number">10</span>, <span class="number">5</span>).to(<span class="string">&#x27;cuda:1&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span>(<span class="params">self, x</span>):</span></span><br><span class="line">        x = self.relu(self.net1(x.to(<span class="string">&#x27;cuda:0&#x27;</span>)))</span><br><span class="line">        <span class="keyword">return</span> self.net2(x.to(<span class="string">&#x27;cuda:1&#x27;</span>))</span><br><span class="line">model = ToyModel()</span><br><span class="line">loss_fn = nn.MSELoss()</span><br><span class="line">optimizer = optim.SGD(model.parameters(), lr=<span class="number">0.001</span>)</span><br><span class="line"></span><br><span class="line">optimizer.zero_grad()</span><br><span class="line">outputs = model(torch.randn(<span class="number">20</span>, <span class="number">10</span>))</span><br><span class="line">labels = torch.randn(<span class="number">20</span>, <span class="number">5</span>).to(<span class="string">&#x27;cuda:1&#x27;</span>)</span><br><span class="line">loss_fn(outputs, labels).backward()</span><br><span class="line">optimizer.step()</span><br></pre></td></tr></table></figure><p>æŠŠæ¨¡å‹ä¸åŒéƒ¨åˆ†æ”¾åœ¨äº†ä¸åŒGPUä¸Š,å¹¶ä¸”forwardæ—¶æŠŠæ•°æ®ä¹Ÿæ”¾åœ¨å¯¹åº”ä½ç½®.æ³¨æ„è®¡ç®—æŸå¤±æ—¶,labelä¹Ÿè¦æ”¾å¯¹åº”ä½ç½®.</p><p>åªéœ€ä¿®æ”¹å‡ è¡Œä»£ç ï¼Œå°±å¯ä»¥åœ¨å¤šä¸ª GPU ä¸Šè¿è¡Œç°æœ‰çš„å• GPU æ¨¡å—.ç»§æ‰¿ç°æœ‰çš„ ResNet æ¨¡å—,å¹¶åœ¨æ„å»ºè¿‡ç¨‹ä¸­å°†å„å±‚æ‹†åˆ†åˆ°ä¸¤ä¸ª GPU.ç„¶å,è¦†ç›–forwardæ–¹æ³•,é€šè¿‡ç›¸åº”ç§»åŠ¨ä¸­é—´è¾“å‡ºæ¥ç¼åˆä¸¤ä¸ªå­ç½‘ç»œ.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> torchvision.models.resnet <span class="keyword">import</span> ResNet, Bottleneck</span><br><span class="line"></span><br><span class="line">num_classes = <span class="number">1000</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ModelParallelResNet50</span>(<span class="params">ResNet</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, *args, **kwargs</span>):</span></span><br><span class="line">        <span class="built_in">super</span>(ModelParallelResNet50, self).__init__(</span><br><span class="line">            Bottleneck, [<span class="number">3</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">3</span>], num_classes=num_classes, *args, **kwargs)</span><br><span class="line"></span><br><span class="line">        self.seq1 = nn.Sequential(</span><br><span class="line">            self.conv1,</span><br><span class="line">            self.bn1,</span><br><span class="line">            self.relu,</span><br><span class="line">            self.maxpool,</span><br><span class="line"></span><br><span class="line">            self.layer1,</span><br><span class="line">            self.layer2</span><br><span class="line">        ).to(<span class="string">&#x27;cuda:0&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        self.seq2 = nn.Sequential(</span><br><span class="line">            self.layer3,</span><br><span class="line">            self.layer4,</span><br><span class="line">            self.avgpool,</span><br><span class="line">        ).to(<span class="string">&#x27;cuda:1&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        self.fc.to(<span class="string">&#x27;cuda:1&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span>(<span class="params">self, x</span>):</span></span><br><span class="line">        x = self.seq2(self.seq1(x).to(<span class="string">&#x27;cuda:1&#x27;</span>))</span><br><span class="line">        <span class="keyword">return</span> self.fc(x.view(x.size(<span class="number">0</span>), -<span class="number">1</span>))</span><br></pre></td></tr></table></figure><p>æœ€ååšäº†ç›¸å…³å®éªŒ,å‘ç°åœ¨å¤šä¸ªGPUä¸Šæ¨¡å‹å¹¶è¡Œæ‰§è¡Œæ—¶é—´æ›´é•¿,å› ä¸ºå¤šä¸ª GPU ä¸­åªæœ‰ä¸€ä¸ªåœ¨å·¥ä½œï¼Œè€Œå…¶ä»–çš„ä¹Ÿä¸åš,åŒæ—¶æ•°æ®ä»ä¸åŒGPUä¸­å¤åˆ¶æ—¶ä¹Ÿéœ€è¦æ—¶é—´.</p><p><img data-src="https://pytorch.org/tutorials/_images/mp_vs_rn.png" alt="img"></p><h2 id="å¤šGPUè®­ç»ƒ"><a href="#å¤šGPUè®­ç»ƒ" class="headerlink" title="å¤šGPUè®­ç»ƒ"></a>å¤šGPUè®­ç»ƒ</h2><h4 id="å¹¶è¡Œæ–¹æ¡ˆ"><a href="#å¹¶è¡Œæ–¹æ¡ˆ" class="headerlink" title="å¹¶è¡Œæ–¹æ¡ˆ"></a>å¹¶è¡Œæ–¹æ¡ˆ</h4><p><code>DataParallel</code>æ˜¯å•è¿›ç¨‹ã€å¤šçº¿ç¨‹çš„,åªèƒ½åœ¨å•å°æœºå™¨ä¸Š(å¯ä»¥å¤šGPU)è¿è¡Œ,è€Œ <code>DistributedDataParallel</code> æ˜¯å¤šè¿›ç¨‹çš„,å¯ä»¥åœ¨å•å°å’Œå¤šå°æœºå™¨ä¸Šè¿è¡Œ.</p><p>å³ä½¿åœ¨å•å°æœºå™¨ä¸Š,DataParallel é€šå¸¸ä¹Ÿæ¯” DistributedDataParallel æ…¢,è¿™æ˜¯å› ä¸ºçº¿ç¨‹é—´çš„ GIL ç«äº‰ã€æ¯æ¬¡è¿­ä»£çš„å¤åˆ¶æ¨¡å‹ï¼Œä»¥åŠåˆ†æ•£è¾“å…¥å’Œæ”¶é›†è¾“å‡ºæ‰€å¸¦æ¥çš„é¢å¤–å¼€é”€.</p><blockquote><p>å®é™…ä¸ºäº†æ–¹ä¾¿,é€šå¸¸ä½¿ç”¨DataParalleråœ¨å¤šGPUä¸Šè¿è¡Œå°±å¤Ÿäº†.</p></blockquote><div class="table-container"><table><thead><tr><th>DataParallel</th><th>disc</th></tr></thead><tbody><tr><td><a href="https://pytorch.org/docs/stable/generated/torch.nn.DataParallel.html#torch.nn.DataParallel"><code>nn.DataParallel</code></a></td><td>Implements data parallelism at the module level.</td></tr><tr><td><a href="https://pytorch.org/docs/stable/generated/torch.nn.parallel.DistributedDataParallel.html#torch.nn.parallel.DistributedDataParallel"><code>nn.parallel.DistributedDataParallel</code></a></td><td>Implement distributed data parallelism based on <code>torch.distributed</code> at module level.</td></tr></tbody></table></div><p>æ¨¡å‹å¹¶è¡Œ:å¦‚æœæ¨¡å‹å¤ªå¤§,æ— æ³•åœ¨å•ä¸ª GPU ä¸Šè¿è¡Œ,å°±å¿…é¡»ä½¿ç”¨æ¨¡å‹å¹¶è¡ŒåŠŸèƒ½å°†å…¶åˆ†å‰²åˆ°å¤šä¸ª GPU ä¸Š.</p><p>åˆ†å¸ƒå¼æ•°æ®å¹¶è¡Œï¼ˆDistributedDataParallel,DDPï¼‰å¯ä¸æ¨¡å‹å¹¶è¡Œä¸€èµ·ä½¿ç”¨ï¼Œè€Œæ•°æ®å¹¶è¡Œï¼ˆDataParallelï¼‰ç›®å‰è¿˜ä¸èƒ½ã€‚å½“ DDP ä¸æ¨¡å‹å¹¶è¡Œç›¸ç»“åˆæ—¶,æ¯ä¸ª DDP è¿›ç¨‹éƒ½å°†ä½¿ç”¨æ¨¡å‹å¹¶è¡Œ,è€Œæ‰€æœ‰è¿›ç¨‹éƒ½å°†ä½¿ç”¨æ•°æ®å¹¶è¡Œã€‚</p><p>å¤šGPUè®­ç»ƒæœ‰æ¯ä¸ªGPUä¸€ä¸ªçº¿ç¨‹</p><p><code>torch.nn.DataParallel</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">model = MyModel()</span><br><span class="line">dp_model = nn.DataParallel(model)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Sets autocast in the main thread</span></span><br><span class="line"><span class="keyword">with</span> autocast(device_type=<span class="string">&#x27;cuda&#x27;</span>, dtype=torch.float16):</span><br><span class="line">    <span class="comment"># dp_model&#x27;s internal threads will autocast.</span></span><br><span class="line">    output = dp_model(<span class="built_in">input</span>)</span><br><span class="line">    <span class="comment"># loss_fn also autocast</span></span><br><span class="line">    loss = loss_fn(output)</span><br></pre></td></tr></table></figure><p>ä¸Šé¢æ–¹æ³•æ˜¯æœ€ç®€å•çš„å¼Šç«¯æ˜¯åç»­çš„lossè®¡ç®—åªä¼šåœ¨<code>cuda:0</code>ä¸Šè¿›è¡Œ,æ²¡æ³•å¹¶è¡Œ,å› æ­¤ä¼šå¯¼è‡´è´Ÿè½½ä¸å‡è¡¡çš„é—®é¢˜</p><p>æ–‡æ¡£æ¨èä½¿ç”¨<code>DistributedDataParallel</code></p><blockquote><p>ä¸ºä»€ä¹ˆå°½ç®¡å¢åŠ äº†å¤æ‚æ€§,è¿˜æ˜¯ä¼šè€ƒè™‘ä½¿ç”¨ DistributedDataParallel è€Œä¸æ˜¯ DataParallel:</p><p>é¦–å…ˆ,DataParallel æ˜¯å•è¿›ç¨‹ã€å¤šçº¿ç¨‹çš„,åªèƒ½åœ¨å•æœºä¸Šè¿è¡Œ,è€Œ <strong>DistributedDataParallel æ˜¯å¤šè¿›ç¨‹çš„,å¯ä»¥åœ¨å•æœºå’Œå¤šæœºè®­ç»ƒä¸­è¿è¡Œ.å³ä½¿åœ¨å•å°æœºå™¨ä¸Š,DataParallel é€šå¸¸ä¹Ÿæ¯” DistributedDataParallel æ…¢,è¿™æ˜¯ç”±äºçº¿ç¨‹é—´çš„ GIL ç«äº‰ã€æ¯æ¬¡è¿­ä»£çš„å¤åˆ¶æ¨¡å‹,ä»¥åŠåˆ†æ•£è¾“å…¥å’Œæ”¶é›†è¾“å‡ºæ‰€å¸¦æ¥çš„é¢å¤–å¼€é”€.</strong></p><p>åˆ†å¸ƒå¼æ•°æ®å¹¶è¡Œï¼ˆDistributedDataParallelï¼‰å¯ä¸æ¨¡å‹å¹¶è¡Œä¸€èµ·ä½¿ç”¨,è€Œæ•°æ®å¹¶è¡Œï¼ˆDataParallelï¼‰ç›®å‰è¿˜ä¸èƒ½.å½“ DDP ä¸æ¨¡å‹å¹¶è¡Œç›¸ç»“åˆæ—¶,æ¯ä¸ª DDP è¿›ç¨‹éƒ½å°†ä½¿ç”¨æ¨¡å‹å¹¶è¡Œ,è€Œæ‰€æœ‰è¿›ç¨‹éƒ½å°†ä½¿ç”¨æ•°æ®å¹¶è¡Œ.</p><p>å¦‚æœæ¨¡å‹éœ€è¦è·¨è¶Šå¤šå°æœºå™¨,æˆ–è€…æ‚¨çš„ç”¨ä¾‹ä¸ç¬¦åˆæ•°æ®å¹¶è¡Œæ¨¡å¼,è¯·ä½¿ç”¨RPC API,ä»¥é€šç”¨çš„åˆ†å¸ƒå¼è®­ç»ƒ.</p></blockquote><p>åœ¨æ¨¡å—çº§åŸºäº torch.distributed å®ç°åˆ†å¸ƒå¼æ•°æ®å¹¶è¡Œ.<br>è¯¥å®¹å™¨é€šè¿‡åœ¨æ¯ä¸ªæ¨¡å‹å‰¯æœ¬ä¹‹é—´åŒæ­¥æ¢¯åº¦æ¥æä¾›æ•°æ®å¹¶è¡Œæ€§.è¦åŒæ­¥çš„è®¾å¤‡ç”±è¾“å…¥ process_group æŒ‡å®š,é»˜è®¤æƒ…å†µä¸‹æ˜¯æ•´ä¸ªä¸–ç•Œ.è¯·æ³¨æ„,DistributedDataParallel ä¸ä¼šåœ¨å‚ä¸çš„ GPU ä¹‹é—´å¯¹è¾“å…¥è¿›è¡Œåˆ†å—æˆ–åˆ†ç‰‡ï¼›ç”¨æˆ·è´Ÿè´£å®šä¹‰å¦‚ä½•è¿›è¡Œåˆ†å—æˆ–åˆ†ç‰‡,ä¾‹å¦‚é€šè¿‡ä½¿ç”¨ DistributedSampler.</p><p>æ­¤å¤–éœ€è¦è¿›è¡Œåˆå§‹åŒ– torch.distributed.init_process_group()</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torch.distributed <span class="keyword">as</span> dist</span><br><span class="line"><span class="keyword">import</span> torch.multiprocessing <span class="keyword">as</span> mp</span><br><span class="line"><span class="keyword">import</span> torch.nn <span class="keyword">as</span> nn</span><br><span class="line"><span class="keyword">import</span> torch.optim <span class="keyword">as</span> optim</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> torch.nn.parallel <span class="keyword">import</span> DistributedDataParallel <span class="keyword">as</span> DDP</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">example</span>(<span class="params">rank, world_size</span>):</span></span><br><span class="line">    <span class="comment"># create default process group</span></span><br><span class="line">    dist.init_process_group(<span class="string">&quot;gloo&quot;</span>, rank=rank, world_size=world_size)</span><br><span class="line">    <span class="comment"># create local model</span></span><br><span class="line">    model = nn.Linear(<span class="number">10</span>, <span class="number">10</span>).to(rank)</span><br><span class="line">    <span class="comment"># construct DDP model</span></span><br><span class="line">    ddp_model = DDP(model, device_ids=[rank])</span><br><span class="line">    <span class="comment"># define loss function and optimizer</span></span><br><span class="line">    loss_fn = nn.MSELoss()</span><br><span class="line">    optimizer = optim.SGD(ddp_model.parameters(), lr=<span class="number">0.001</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># forward pass</span></span><br><span class="line">    outputs = ddp_model(torch.randn(<span class="number">20</span>, <span class="number">10</span>).to(rank))</span><br><span class="line">    labels = torch.randn(<span class="number">20</span>, <span class="number">10</span>).to(rank)</span><br><span class="line">    <span class="comment"># backward pass</span></span><br><span class="line">    loss_fn(outputs, labels).backward()</span><br><span class="line">    <span class="comment"># update parameters</span></span><br><span class="line">    optimizer.step()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    world_size = <span class="number">2</span></span><br><span class="line">    mp.spawn(example,</span><br><span class="line">        args=(world_size,),</span><br><span class="line">        nprocs=world_size,</span><br><span class="line">        join=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="comment"># Environment variables which need to be</span></span><br><span class="line">    <span class="comment"># set when using c10d&#x27;s default &quot;env&quot;</span></span><br><span class="line">    <span class="comment"># initialization mode.</span></span><br><span class="line">    os.environ[<span class="string">&quot;MASTER_ADDR&quot;</span>] = <span class="string">&quot;localhost&quot;</span></span><br><span class="line">    os.environ[<span class="string">&quot;MASTER_PORT&quot;</span>] = <span class="string">&quot;29500&quot;</span></span><br><span class="line">    main()                                  </span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">demo_model_parallel</span>(<span class="params">rank, world_size</span>):</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Running DDP with model parallel example on rank <span class="subst">&#123;rank&#125;</span>.&quot;</span>)</span><br><span class="line">    setup(rank, world_size)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># setup mp_model and devices for this process</span></span><br><span class="line">    dev0 = rank * <span class="number">2</span></span><br><span class="line">    dev1 = rank * <span class="number">2</span> + <span class="number">1</span></span><br><span class="line">    mp_model = ToyMpModel(dev0, dev1)</span><br><span class="line">    ddp_mp_model = DDP(mp_model)</span><br><span class="line"></span><br><span class="line">    loss_fn = nn.MSELoss()</span><br><span class="line">    optimizer = optim.SGD(ddp_mp_model.parameters(), lr=<span class="number">0.001</span>)</span><br><span class="line"></span><br><span class="line">    optimizer.zero_grad()</span><br><span class="line">    <span class="comment"># outputs will be on dev1</span></span><br><span class="line">    outputs = ddp_mp_model(torch.randn(<span class="number">20</span>, <span class="number">10</span>))</span><br><span class="line">    labels = torch.randn(<span class="number">20</span>, <span class="number">5</span>).to(dev1)</span><br><span class="line">    loss_fn(outputs, labels).backward()</span><br><span class="line">    optimizer.step()</span><br><span class="line"></span><br><span class="line">    cleanup()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    n_gpus = torch.cuda.device_count()</span><br><span class="line">    <span class="keyword">assert</span> n_gpus &gt;= <span class="number">2</span>, <span class="string">f&quot;Requires at least 2 GPUs to run, but got <span class="subst">&#123;n_gpus&#125;</span>&quot;</span></span><br><span class="line">    world_size = n_gpus</span><br><span class="line">    run_demo(demo_basic, world_size)</span><br><span class="line">    run_demo(demo_checkpoint, world_size)</span><br><span class="line">    world_size = n_gpus//<span class="number">2</span></span><br><span class="line">    run_demo(demo_model_parallel, world_size)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sampler = DistributedSampler(dataset) <span class="keyword">if</span> is_distributed <span class="keyword">else</span> <span class="literal">None</span></span><br><span class="line">loader = DataLoader(dataset, shuffle=(sampler <span class="keyword">is</span> <span class="literal">None</span>),</span><br><span class="line">                    sampler=sampler)</span><br><span class="line"><span class="keyword">for</span> epoch <span class="keyword">in</span> <span class="built_in">range</span>(start_epoch, n_epochs):</span><br><span class="line">     <span class="keyword">if</span> is_distributed:</span><br><span class="line">         sampler.set_epoch(epoch)</span><br><span class="line">     train(loader)</span><br></pre></td></tr></table></figure><p>å®ƒä¸ torch.nn.parallel.DistributedDataParallel ç»“åˆä½¿ç”¨å°¤å…¶æœ‰ç”¨.åœ¨è¿™ç§æƒ…å†µä¸‹,<strong>æ¯ä¸ªè¿›ç¨‹éƒ½å¯ä»¥ä¼ é€’ä¸€ä¸ª DistributedSampler å®ä¾‹ä½œä¸º DataLoader é‡‡æ ·å™¨</strong>,å¹¶åŠ è½½å…¶ç‹¬æœ‰çš„åŸå§‹æ•°æ®é›†å­é›†.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch  </span><br><span class="line"><span class="keyword">import</span> torch.distributed <span class="keyword">as</span> dist  </span><br><span class="line"><span class="keyword">import</span> torch.nn <span class="keyword">as</span> nn  </span><br><span class="line"><span class="keyword">import</span> torch.optim <span class="keyword">as</span> optim  </span><br><span class="line"><span class="keyword">from</span> torch.utils.data <span class="keyword">import</span> DataLoader, Dataset, DistributedSampler  </span><br><span class="line"><span class="keyword">from</span> torch.nn.parallel <span class="keyword">import</span> DistributedDataParallel <span class="keyword">as</span> DDP  </span><br><span class="line">  </span><br><span class="line"><span class="comment">#### è‡ªå®šä¹‰æ•°æ®é›†å’Œæ¨¡å‹  </span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyDataset</span>(<span class="params">Dataset</span>):</span>  </span><br><span class="line">    <span class="comment"># å®ç°__len__å’Œ__getitem__æ–¹æ³•  </span></span><br><span class="line">    <span class="keyword">pass</span>  </span><br><span class="line">  </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyModel</span>(<span class="params">nn.Module</span>):</span>  </span><br><span class="line">    <span class="comment"># å®šä¹‰æ¨¡å‹ç»“æ„,å¯èƒ½éœ€è¦è€ƒè™‘å¦‚ä½•æ‹†åˆ†æ¨¡å‹  </span></span><br><span class="line">    <span class="keyword">pass</span>  </span><br><span class="line">  </span><br><span class="line"><span class="comment">#### åˆå§‹åŒ–åˆ†å¸ƒå¼ç¯å¢ƒ  </span></span><br><span class="line">dist.init_process_group(backend=<span class="string">&#x27;nccl&#x27;</span>, init_method=<span class="string">&#x27;tcp://localhost:23456&#x27;</span>, rank=<span class="number">0</span>, world_size=torch.cuda.device_count())  </span><br><span class="line">  </span><br><span class="line"><span class="comment">#### åˆå§‹åŒ–æ•°æ®é›†å’Œæ¨¡å‹  </span></span><br><span class="line">dataset = MyDataset()  </span><br><span class="line">sampler = DistributedSampler(dataset)  </span><br><span class="line">dataloader = DataLoader(dataset, batch_size=<span class="number">32</span>, shuffle=<span class="literal">False</span>, sampler=sampler)  </span><br><span class="line">model = MyModel()  </span><br><span class="line">  </span><br><span class="line"><span class="comment">#### æ‹†åˆ†æ¨¡å‹ï¼ˆè¿™é€šå¸¸éœ€è¦æ ¹æ®æ¨¡å‹çš„å…·ä½“ç»“æ„æ¥æ‰‹åŠ¨å®Œæˆï¼‰  </span></span><br><span class="line"><span class="comment">#### ä¾‹å¦‚,å¦‚æœæ¨¡å‹æœ‰ä¸¤ä¸ªä¸»è¦éƒ¨åˆ†,å¯ä»¥å°†å®ƒä»¬åˆ†åˆ«æ”¾åˆ°ä¸åŒçš„è®¾å¤‡ä¸Š  </span></span><br><span class="line">model_part1 = model.part1.to(<span class="string">&#x27;cuda:0&#x27;</span>)  </span><br><span class="line">model_part2 = model.part2.to(<span class="string">&#x27;cuda:1&#x27;</span>)  </span><br><span class="line">  </span><br><span class="line"><span class="comment">#### ä½¿ç”¨DistributedDataParallelåŒ…è£…æ¨¡å‹  </span></span><br><span class="line">model = DDP(model, device_ids=[torch.cuda.current_device()])  </span><br><span class="line">  </span><br><span class="line"><span class="comment">#### å®šä¹‰æŸå¤±å‡½æ•°å’Œä¼˜åŒ–å™¨  </span></span><br><span class="line">criterion = nn.CrossEntropyLoss()  </span><br><span class="line">optimizer = optim.Adam(model.parameters(), lr=<span class="number">0.001</span>)  </span><br><span class="line">  </span><br><span class="line"><span class="comment">#### è®­ç»ƒå¾ªç¯  </span></span><br><span class="line"><span class="keyword">for</span> epoch <span class="keyword">in</span> <span class="built_in">range</span>(num_epochs):  </span><br><span class="line">    <span class="keyword">for</span> inputs, labels <span class="keyword">in</span> dataloader:  </span><br><span class="line">        inputs, labels = inputs.to(model.device), labels.to(model.device)  </span><br><span class="line">        optimizer.zero_grad()  </span><br><span class="line">        outputs = model(inputs)  </span><br><span class="line">        loss = criterion(outputs, labels)  </span><br><span class="line">        loss.backward()  </span><br><span class="line">        optimizer.step()  </span><br><span class="line">  </span><br><span class="line"><span class="comment">#### é”€æ¯åˆ†å¸ƒå¼è¿›ç¨‹ç»„  </span></span><br><span class="line">dist.destroy_process_group()</span><br></pre></td></tr></table></figure><p><a href="https://github.com/jia-zhuang/pytorch-multi-gpu-training">jia-zhuang/pytorch-multi-gpu-training: æ•´ç† pytorch å•æœºå¤š GPU è®­ç»ƒæ–¹æ³•ä¸åŸç† (github.com)</a></p><h2 id="å¸¸ç”¨Container"><a href="#å¸¸ç”¨Container" class="headerlink" title="å¸¸ç”¨Container"></a>å¸¸ç”¨Container</h2><div class="table-container"><table><thead><tr><th>Containers</th><th>ä»‹ç»</th></tr></thead><tbody><tr><td><a href="https://pytorch.org/docs/stable/generated/torch.nn.Module.html#torch.nn.Module"><code>Module</code></a></td><td>Base class for all neural network modules.</td></tr><tr><td><a href="https://pytorch.org/docs/stable/generated/torch.nn.Sequential.html#torch.nn.Sequential"><code>Sequential</code></a></td><td>A sequential container.</td></tr><tr><td><a href="https://pytorch.org/docs/stable/generated/torch.nn.ModuleList.html#torch.nn.ModuleList"><code>ModuleList</code></a></td><td>Holds submodules in a list.</td></tr><tr><td><a href="https://pytorch.org/docs/stable/generated/torch.nn.ModuleDict.html#torch.nn.ModuleDict"><code>ModuleDict</code></a></td><td>Holds submodules in a dictionary.</td></tr><tr><td><a href="https://pytorch.org/docs/stable/generated/torch.nn.ParameterList.html#torch.nn.ParameterList"><code>ParameterList</code></a></td><td>Holds parameters in a list.</td></tr><tr><td><a href="https://pytorch.org/docs/stable/generated/torch.nn.ParameterDict.html#torch.nn.ParameterDict"><code>ParameterDict</code></a></td><td>Holds parameters in a dictionary.</td></tr></tbody></table></div><p><code>Module</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch.nn <span class="keyword">as</span> nn</span><br><span class="line"><span class="keyword">import</span> torch.nn.functional <span class="keyword">as</span> F</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Model</span>(<span class="params">nn.Module</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        self.conv1 = nn.Conv2d(<span class="number">1</span>, <span class="number">20</span>, <span class="number">5</span>)</span><br><span class="line">        self.conv2 = nn.Conv2d(<span class="number">20</span>, <span class="number">20</span>, <span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span>(<span class="params">self, x</span>):</span></span><br><span class="line">        x = F.relu(self.conv1(x))</span><br><span class="line">        <span class="keyword">return</span> F.relu(self.conv2(x))</span><br></pre></td></tr></table></figure><p><code>Sequential</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">model = nn.Sequential(</span><br><span class="line">          nn.Conv2d(<span class="number">1</span>,<span class="number">20</span>,<span class="number">5</span>),</span><br><span class="line">          nn.ReLU(),</span><br><span class="line">          nn.Conv2d(<span class="number">20</span>,<span class="number">64</span>,<span class="number">5</span>),</span><br><span class="line">          nn.ReLU()</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line"><span class="comment"># Using Sequential with OrderedDict. This is functionally the</span></span><br><span class="line"><span class="comment"># same as the above code</span></span><br><span class="line">model = nn.Sequential(OrderedDict([</span><br><span class="line">          (<span class="string">&#x27;conv1&#x27;</span>, nn.Conv2d(<span class="number">1</span>,<span class="number">20</span>,<span class="number">5</span>)),</span><br><span class="line">          (<span class="string">&#x27;relu1&#x27;</span>, nn.ReLU()),</span><br><span class="line">          (<span class="string">&#x27;conv2&#x27;</span>, nn.Conv2d(<span class="number">20</span>,<span class="number">64</span>,<span class="number">5</span>)),</span><br><span class="line">          (<span class="string">&#x27;relu2&#x27;</span>, nn.ReLU())</span><br><span class="line">        ]))</span><br></pre></td></tr></table></figure><p><code>ModuleList</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyModule</span>(<span class="params">nn.Module</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        self.linears = nn.ModuleList([nn.Linear(<span class="number">10</span>, <span class="number">10</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>)])</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span>(<span class="params">self, x</span>):</span></span><br><span class="line">        <span class="comment"># ModuleList can act as an iterable, or be indexed using ints</span></span><br><span class="line">        <span class="keyword">for</span> i, l <span class="keyword">in</span> <span class="built_in">enumerate</span>(self.linears):</span><br><span class="line">            x = self.linears[i // <span class="number">2</span>](x) + l(x)</span><br><span class="line">        <span class="keyword">return</span> x</span><br></pre></td></tr></table></figure><p><code>ModuleDict</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyModule</span>(<span class="params">nn.Module</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        self.choices = nn.ModuleDict(&#123;</span><br><span class="line">                <span class="string">&#x27;conv&#x27;</span>: nn.Conv2d(<span class="number">10</span>, <span class="number">10</span>, <span class="number">3</span>),</span><br><span class="line">                <span class="string">&#x27;pool&#x27;</span>: nn.MaxPool2d(<span class="number">3</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">        self.activations = nn.ModuleDict([</span><br><span class="line">                [<span class="string">&#x27;lrelu&#x27;</span>, nn.LeakyReLU()],</span><br><span class="line">                [<span class="string">&#x27;prelu&#x27;</span>, nn.PReLU()]</span><br><span class="line">        ])</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span>(<span class="params">self, x, choice, act</span>):</span></span><br><span class="line">        x = self.choices[choice](x)</span><br><span class="line">        x = self.activations[act](x)</span><br><span class="line">        <span class="keyword">return</span> x</span><br></pre></td></tr></table></figure><p><code>ParameterList</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyModule</span>(<span class="params">nn.Module</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        self.params = nn.ParameterList([nn.Parameter(torch.randn(<span class="number">10</span>, <span class="number">10</span>)) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>)])</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span>(<span class="params">self, x</span>):</span></span><br><span class="line">        <span class="comment"># ParameterList can act as an iterable, or be indexed using ints</span></span><br><span class="line">        <span class="keyword">for</span> i, p <span class="keyword">in</span> <span class="built_in">enumerate</span>(self.params):</span><br><span class="line">            x = self.params[i // <span class="number">2</span>].mm(x) + p.mm(x)</span><br><span class="line">        <span class="keyword">return</span> x</span><br></pre></td></tr></table></figure><p><code>ParameterDict</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyModule</span>(<span class="params">nn.Module</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        self.params = nn.ParameterDict(&#123;</span><br><span class="line">                <span class="string">&#x27;left&#x27;</span>: nn.Parameter(torch.randn(<span class="number">5</span>, <span class="number">10</span>)),</span><br><span class="line">                <span class="string">&#x27;right&#x27;</span>: nn.Parameter(torch.randn(<span class="number">5</span>, <span class="number">10</span>))</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span>(<span class="params">self, x, choice</span>):</span></span><br><span class="line">        x = self.params[choice].mm(x)</span><br><span class="line">        <span class="keyword">return</span> x</span><br></pre></td></tr></table></figure><h2 id="å®¹æ˜“æ··æ·†å’Œé—å¿˜çš„æ–¹æ³•"><a href="#å®¹æ˜“æ··æ·†å’Œé—å¿˜çš„æ–¹æ³•" class="headerlink" title="å®¹æ˜“æ··æ·†å’Œé—å¿˜çš„æ–¹æ³•"></a>å®¹æ˜“æ··æ·†å’Œé—å¿˜çš„æ–¹æ³•</h2><h3 id="torch-scatter"><a href="#torch-scatter" class="headerlink" title="torch.scatter"></a>torch.scatter</h3><p>Tensor.scatter_(<em>dim</em>, <em>index</em>, <em>src</em>, <em>**, </em>reduce=None*) â†’ <a href="https://pytorch.org/docs/stable/tensors.html#torch.Tensor">Tensor</a></p><p>æŒ‰ç…§ <code>index</code> å¼ é‡ä¸­æŒ‡å®šçš„ç´¢å¼•,å°†å¼ é‡ <code>src</code> ä¸­çš„æ‰€æœ‰å€¼å†™å…¥ <code>self</code> ä¸­.å¯¹äº <code>src</code> ä¸­çš„æ¯ä¸ªå€¼,å…¶è¾“å‡ºç´¢å¼•åœ¨ <code>dimension != dim</code> æ—¶ç”± <code>src</code> ä¸­çš„ç´¢å¼•æŒ‡å®š,åœ¨ <code>dimension = dim</code> æ—¶ç”± <code>index</code> ä¸­çš„ç›¸åº”å€¼æŒ‡å®š.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">self[index[i][j][k]][j][k] = src[i][j][k]  <span class="comment"># if dim == 0</span></span><br><span class="line">self[i][index[i][j][k]][k] = src[i][j][k]  <span class="comment"># if dim == 1</span></span><br><span class="line">self[i][j][index[i][j][k]] = src[i][j][k]  <span class="comment"># if dim == 2</span></span><br></pre></td></tr></table></figure><p>å¸¸ç”¨ä½œå†™one-hoté‡</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">index = torch.tensor([[<span class="number">0</span>, <span class="number">1</span>]])</span><br><span class="line">value = <span class="number">2</span></span><br><span class="line">torch.zeros(<span class="number">3</span>, <span class="number">5</span>).scatter_(<span class="number">0</span>, index, value)</span><br></pre></td></tr></table></figure><h3 id="torch-gather"><a href="#torch-gather" class="headerlink" title="torch.gather"></a>torch.gather</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">out[i][j][k] = <span class="built_in">input</span>[index[i][j][k]][j][k]  <span class="comment"># if dim == 0</span></span><br><span class="line">out[i][j][k] = <span class="built_in">input</span>[i][index[i][j][k]][k]  <span class="comment"># if dim == 1</span></span><br><span class="line">out[i][j][k] = <span class="built_in">input</span>[i][j][index[i][j][k]]  <span class="comment"># if dim == 2</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">t = torch.tensor([[<span class="number">1</span>, <span class="number">2</span>], [<span class="number">3</span>, <span class="number">4</span>]])</span><br><span class="line">torch.gather(t, <span class="number">1</span>, torch.tensor([[<span class="number">0</span>, <span class="number">0</span>], [<span class="number">1</span>, <span class="number">0</span>]]))</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä»£ç å°±æ˜¯æŠŠtæ ¹æ®index torch.tensor([[0, 0], [1, 0]])é‡æ–°å¾—åˆ°ä¸€ä¸ªtensor.</p><h3 id="torch-split"><a href="#torch-split" class="headerlink" title="torch.split"></a>torch.split</h3><p>torch.split(<em>tensor</em>, <em>split_size_or_sections</em>, <em>dim=0</em></p><p>å°†å¼ é‡åˆ†å‰²æˆå—.æ¯ä¸ªå—éƒ½æ˜¯åŸå§‹å¼ é‡çš„ä¸€ä¸ªview.</p><p>å¦‚æœ split_size_or_sections æ˜¯æ•´æ•°ç±»å‹,é‚£ä¹ˆå¼ é‡å°†è¢«åˆ†å‰²æˆå¤§å°ç›¸ç­‰çš„å—ï¼ˆå¦‚æœå¯èƒ½ï¼‰.å¦‚æœå¼ é‡åœ¨ç»™å®šç»´åº¦ dim ä¸Šçš„å¤§å°ä¸èƒ½è¢« split_size æ•´é™¤,åˆ™æœ€åä¸€ä¸ªå—çš„å¤§å°ä¼šå˜å°.</p><p>å¦‚æœ split_size_or_sections æ˜¯ä¸€ä¸ªåˆ—è¡¨,é‚£ä¹ˆå¼ é‡å°†è¢«åˆ†å‰²æˆ len(split_size_or_sections)å°å—,å…¶å¤§å°ä¸ split_size_or_sections ä¸€è‡´.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">a = torch.arange(<span class="number">10</span>).reshape(<span class="number">5</span>, <span class="number">2</span>)</span><br><span class="line">torch.split(a, <span class="number">2</span>)</span><br><span class="line">(tensor([[<span class="number">0</span>, <span class="number">1</span>],</span><br><span class="line">         [<span class="number">2</span>, <span class="number">3</span>]]),</span><br><span class="line"> tensor([[<span class="number">4</span>, <span class="number">5</span>],</span><br><span class="line">         [<span class="number">6</span>, <span class="number">7</span>]]),</span><br><span class="line"> tensor([[<span class="number">8</span>, <span class="number">9</span>]]))</span><br><span class="line">torch.split(a, [<span class="number">1</span>, <span class="number">4</span>])</span><br><span class="line">(tensor([[<span class="number">0</span>, <span class="number">1</span>]]),</span><br><span class="line"> tensor([[<span class="number">2</span>, <span class="number">3</span>],</span><br><span class="line">         [<span class="number">4</span>, <span class="number">5</span>],</span><br><span class="line">         [<span class="number">6</span>, <span class="number">7</span>],</span><br><span class="line">         [<span class="number">8</span>, <span class="number">9</span>]]))</span><br></pre></td></tr></table></figure><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;p&gt;Pytorchæ˜¯å¾ˆå¥½çš„æ·±åº¦å­¦ä¹ æ¡†æ¶,ä½†åœ¨ä½¿ç”¨æ—¶ä½ å¯èƒ½ä»ç„¶ä¸æ¸…æ¥šå…¶ä¸­ä¸€äº›æ¦‚å¿µ.è¿™é‡Œæˆ‘åªä»¥å®˜æ–¹æ–‡æ¡£ä¸ºä¾æ®å°è¯•è§£é‡Šå…¶ä¸­ä¸€äº›æ¦‚å¿µå’Œæ–¹æ³•. æˆ‘è¿™é‡Œå¯ä»¥ç§°ä½œEffective Pytorch.&lt;br&gt;</summary>
    
    
    
    
    <category term="pytorch" scheme="https://www.sekyoro.top/tags/pytorch/"/>
    
  </entry>
  
  <entry>
    <title>A better C:from C++, Go,Rust to Zig</title>
    <link href="https://www.sekyoro.top/2024/06/23/A-better-C-from-C-Go-Rust-to-Zig/"/>
    <id>https://www.sekyoro.top/2024/06/23/A-better-C-from-C-Go-Rust-to-Zig/</id>
    <published>2024-06-23T03:28:16.000Z</published>
    <updated>2024-06-25T03:09:37.398Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>ä»Cè¯­è¨€è¯ç”Ÿå·²ç»äº”åå¤šå¹´äº†,ç°åœ¨å·²ç»æœ‰äº†è®¸å¤šé«˜çº§è¯­è¨€,å…¶ä¸­å¾ˆå¤šèƒŒé å¤§å‚,æ¯”å¦‚Java,Go,C#,Dart,Swiftç­‰ç­‰(ç”²éª¨æ–‡,è°·æ­Œå¾®è½¯å’Œè‹¹æœ,è¿™ç±»è¯­è¨€é€šè¿‡å…¬å¸æ›´æ–°).ä¹Ÿæœ‰å¾ˆå¤šç¤¾åŒºçš„è¯­è¨€,æ¯”å¦‚Python,Rust,PHP,Rubyç­‰(è¿™ç±»è¯­è¨€å¾€å¾€é€šè¿‡æ—©æœŸåˆ›å»ºè€…å’Œä¸€äº›æ ¸å¿ƒæˆå‘˜æ›´æ–°å’Œç»´æŠ¤,è¿™é‡Œé¢ä¹Ÿæœ‰å¾ˆå¤šå¼€æºçš„è¯­è¨€,å…è®¸å…¶ä»–äººä¿®æ”¹).<br>ç›¸è¾ƒäºå…¬å¸æ——ä¸‹çš„è¯­è¨€,ç¤¾åŒºç±»å‹çš„è¯­è¨€å¾€å¾€æ›´åŠ ç®€æ´,åœ¨ä½¿ç”¨æˆ–è€…ç”Ÿäº§ä¸‹æ•ˆç‡é«˜,ä½†ä¹Ÿå­˜åœ¨ç”Ÿæ€ç›¸å¯¹è¾ƒå·®ã€å·¥å…·é“¾ä¸å¤Ÿã€æ›´æ–°å‘åŠ›ä¸å¤ŸæŒä¹…ã€æ–‡æ¡£ä¸å¤Ÿä¸°å¯Œçš„é—®é¢˜.</p><p>è€Œ A better Cçš„æ„æ€å°±æ˜¯åœ¨åé¢çš„è¯­è¨€ä¸­æ‰¾åˆ°æ€§èƒ½è¾ƒå¼º,ä½¿ç”¨å‹å¥½å¹¶ä¸”ç”Ÿæ€æŒç»­å‘å±•çš„è¯­è¨€.TLDR:åœ¨å¤§å‹é¡¹ç›®ä¸Šè¿˜æ˜¯ä½¿ç”¨C++,åœ¨ä¸€äº›å·¥å…·é“¾æˆ–è€…ä»£ç é‡æ„ä¸Šå¯ä»¥è€ƒè™‘Rust. </p><span id="more"></span><blockquote><p>â€œä¸–ä¸Šå…¶å®åªæœ‰ä¸¤ç§ç¼–ç¨‹è¯­è¨€ï¼Œä¸€ç§æ˜¯å¤§å®¶ä¸€ç›´å–·å®ƒéš¾ç”¨çš„ï¼Œä¸€ç§æ˜¯æ ¹æœ¬æ²¡äººç”¨çš„ã€‚â€ â€”â€” C++ çš„ä½œè€… Bjarne Stroustrup </p></blockquote><p>ç›¸å¯¹äºJava,C#è¿™ç§è¯­è¨€,æˆ‘ä»¬å°è¯•æ‰¾åˆ°ä½¿ç”¨ä¸Šæ›´åŠ è½»å‹(æŒ‡çš„æ˜¯ä¸ä¾èµ–æŸç§é¢†åŸŸ),æ€§èƒ½æ›´å¼ºå ç”¨æ›´å°çš„è¯­è¨€.</p><h2 id="Better-C"><a href="#Better-C" class="headerlink" title="Better C"></a>Better C</h2><h3 id="C"><a href="#C" class="headerlink" title="C++"></a>C++</h3><p>C++20ç›®å‰å·²ç»æœ‰äº†å¾ˆå¤šModernçš„ç‰¹æ€§,ä½†æ˜¯ç›®å‰ä»ç„¶ç¼ºä¹çš„ä¾ç„¶è¿˜æ˜¯<code>build system,test harness, linter</code>,C++ç¤¾åŒºæ•´ä½“æ¯”è¾ƒç¦»æ•£,ä¹Ÿæ²¡æœ‰å¤§å…¬å¸æ‹¿å‡ºç±»ä¼¼jsçš„all in oneçš„å·¥å…·é“¾,ç›®å‰ç”¨å¾—å¤šçš„æ˜¯vcpkg+cmake. ä¹Ÿæœ‰conanå’Œxmakeç­‰ç­‰,ä½†ç›¸å¯¹æ¥è¯´è¿˜æ˜¯æœ‰æ¬ ç¼º,ä¸»è¦åŸå› æ˜¯C++æ²¡æœ‰æ‰€è°“çš„å®˜æ–¹,åªæœ‰c++æ ‡å‡†å§”å‘˜ä¼š,ä¹Ÿä¸åƒå…¶ä»–å…¬å¸å¸¸ç”¨çš„ç¼–ç¨‹è¯­è¨€ä¼šæœ‰å…¬å¸æ¨å‡ºå·¥å…·é“¾.</p><p>ä½†C++è¯­è¨€æœ¬èº«è¿˜æ˜¯ä¸é”™çš„,è¶³å¤Ÿåº•å±‚,è¶³å¤Ÿå€¼å¾—å­¦ä¹ .</p><h3 id="Go"><a href="#Go" class="headerlink" title="Go"></a>Go</h3><p>GoèƒŒé è°·æ­Œ,ç”Ÿæ€ç›®å‰æ„Ÿè§‰è¿˜æ˜¯ä¸å¤Ÿæ˜æœ—,ä¸ªäººæ„Ÿè§‰å¯èƒ½æ˜¯äº‘åŸç”ŸåŸºç¡€è®¾æ–½ä¸Š,å¦‚æœä½ å†™è¿‡Go,å°±çŸ¥é“å¤§å‹Webé¡¹ç›®å†™Goè¿˜æ˜¯æœ‰æ‰€æ¬ ç¼º,æ‹¿æ¥å†™äº‹åŠ¡è¿˜æ˜¯éº»çƒ¦.</p><p>å¹¶ä¸”goçš„nilé”™è¯¯å¤„ç†,moduleç­‰ä¾ç„¶é­å—è¯Ÿç—….ä½†æ˜¯Goæœ¬èº«ä»£ç è¿˜æ˜¯å¾ˆå®¹æ˜“è¯»çš„,è€Œä¸”å·¥å…·é“¾ä¹Ÿç›¸å¯¹å®Œå–„,æœ‰åŒ…ç®¡ç†å·¥å…·,é¡¹ç›®æ„å»ºä¹Ÿå¯ä»¥ä½¿ç”¨cmake.</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;html/template&quot;</span></span><br><span class="line">    <span class="string">&quot;net/http&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Person <span class="keyword">struct</span> &#123;</span><br><span class="line">    Name <span class="keyword">string</span></span><br><span class="line">    Age  <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    http.HandleFunc(<span class="string">&quot;/&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">        p := Person&#123;</span><br><span class="line">            Name: <span class="string">&quot;John Doe&quot;</span>,</span><br><span class="line">            Age:  <span class="number">30</span>,</span><br><span class="line">        &#125;</span><br><span class="line">        t, err := template.ParseFiles(<span class="string">&quot;templates/index.html&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">            http.Error(w, err.Error(), http.StatusInternalServerError)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        t.Execute(w, p)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    fmt.Println(<span class="string">&quot;Starting server on :8080&quot;</span>)</span><br><span class="line">    http.ListenAndServe(<span class="string">&quot;:8080&quot;</span>, <span class="literal">nil</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">worker</span><span class="params">(wrkID <span class="keyword">int</span>, jobs &lt;-<span class="keyword">chan</span> <span class="keyword">int</span>, results <span class="keyword">chan</span>&lt;- <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> job := <span class="keyword">range</span> jobs &#123;</span><br><span class="line">        fmt.Printf(<span class="string">&quot;worker %d started job %d\n&quot;</span>, wrkID, job)</span><br><span class="line">        time.Sleep(time.Second)</span><br><span class="line">        fmt.Printf(<span class="string">&quot;worker %d finished job %d\n&quot;</span>, wrkID, job)</span><br><span class="line">        results &lt;- job * <span class="number">2</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    jobs := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>, <span class="number">100</span>)</span><br><span class="line">    results := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>, <span class="number">100</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Start workers</span></span><br><span class="line">    <span class="keyword">for</span> w := <span class="number">1</span>; w &lt;= <span class="number">3</span>; w++ &#123;</span><br><span class="line">        <span class="keyword">go</span> worker(w, jobs, results)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Send jobs</span></span><br><span class="line">    <span class="keyword">for</span> j := <span class="number">1</span>; j &lt;= <span class="number">9</span>; j++ &#123;</span><br><span class="line">        jobs &lt;- j</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">close</span>(jobs)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Collect results</span></span><br><span class="line">    <span class="keyword">for</span> a := <span class="number">1</span>; a &lt;= <span class="number">9</span>; a++ &#123;</span><br><span class="line">        fmt.Printf(<span class="string">&quot;Result: %d\n&quot;</span>, &lt;-results)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Rust"><a href="#Rust" class="headerlink" title="Rust"></a>Rust</h3><p>Rust,æœ€è¿‘å‡ å¹´çƒ­åº¦å¾ˆé«˜,ä½†æ˜¯ä¹Ÿå­˜åœ¨ä¸å°‘é—®é¢˜,ä¸Šæ‰‹é—¨æ§›é«˜,éœ€è¦é¢å¤–ç†è§£çš„æ¦‚å¿µä¸å°‘.</p><p>Rustçš„ä¸€äº›ä¼˜åŠ¿åŒ…æ‹¬ä»¥ä¸‹å‡ ç‚¹ï¼š</p><ul><li>å¹¶å‘å’Œå¹¶è¡Œï¼šRustå†…ç½®å¯¹å¹¶è¡Œç¼–ç¨‹çš„æ”¯æŒï¼Œä»¥åŠå®‰å…¨é«˜æ•ˆçš„å¤šçº¿ç¨‹ç‰¹æ€§</li><li>æ€§èƒ½ï¼šç”±äºRustä»£ç ä¸éœ€è¦è¿è¡Œæ—¶ï¼ŒåŒæ—¶å®ƒä¸éœ€è¦é¢å¤–çš„åƒåœ¾å›æ”¶å™¨åŠŸè€—ï¼Œä»è€Œå¯ä»¥ä½¿ç”¨æ›´å°‘çš„èµ„æºå¹¶æé«˜æ€§èƒ½ï¼Œ</li><li>å†…å­˜å®‰å…¨ä¸”æ— åƒåœ¾å›æ”¶ï¼šç”±äºæ‰€æœ‰æƒå’Œå€Ÿç”¨ç­‰è§„åˆ™ï¼ŒRuståœ¨æ²¡æœ‰åƒåœ¾å›æ”¶å™¨çš„æƒ…å†µä¸‹ç®¡ç†å†…å­˜ï¼Œä»è€Œå®ç°æ›´é«˜æ•ˆå’Œå¯é¢„æµ‹çš„æ€§èƒ½</li><li>è·¨å¹³å°å…¼å®¹æ€§ï¼šRustæ”¯æŒè·¨å¹³å°å¼€å‘ï¼Œæ„å‘³ç€å¯ä»¥åœ¨å¤šä¸ªç³»ç»Ÿä¸Šç¼–è¯‘ä»£ç è€Œä¸éœ€è¦å¤ªå¤šçš„ä¿®æ”¹ä»£ç </li><li>å¼ºå¤§çš„ç”Ÿæ€ç³»ç»Ÿï¼šRustæ‹¥æœ‰å¼ºå¤§çš„å·¥å…·å’Œåº“ç”Ÿæ€ç³»ç»Ÿã€‚å®ƒçš„åŒ…ç®¡ç†å™¨Cargoæ˜¾è‘—ç®€åŒ–äº†ä¾èµ–ç®¡ç†å’Œä¸å¤–éƒ¨åº“é›†æˆçš„éš¾åº¦</li></ul><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Person</span></span> &#123;</span><br><span class="line">    name: <span class="built_in">String</span>,</span><br><span class="line">    age: <span class="built_in">u32</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> Person &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">new</span></span>(name: &amp;<span class="built_in">str</span>, age: <span class="built_in">u32</span>) -&gt; Person &#123;</span><br><span class="line">        Person &#123;</span><br><span class="line">            name: <span class="built_in">String</span>::from(name),</span><br><span class="line">            age,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">greet</span></span>(&amp;<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;Hello, my name is &#123;&#125; and I&#x27;m &#123;&#125; years old.&quot;</span>, <span class="keyword">self</span>.name, <span class="keyword">self</span>.name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> alice = Person::new(<span class="string">&quot;Alice&quot;</span>, <span class="number">30</span>);</span><br><span class="line">    alice.greet();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">Direction</span></span> &#123;</span><br><span class="line">    Up,</span><br><span class="line">    Down,</span><br><span class="line">    Left,</span><br><span class="line">    Right,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">move_player</span></span>(direction: Direction) &#123;</span><br><span class="line">    <span class="keyword">match</span> direction &#123;</span><br><span class="line">        Direction::Up =&gt; <span class="built_in">println!</span>(<span class="string">&quot;Moving up&quot;</span>),</span><br><span class="line">        Direction::Down =&gt; <span class="built_in">println!</span>(<span class="string">&quot;Moving down&quot;</span>),</span><br><span class="line">        Direction::Left =&gt; <span class="built_in">println!</span>(<span class="string">&quot;Moving left&quot;</span>),</span><br><span class="line">        Direction::Right =&gt; <span class="built_in">println!</span>(<span class="string">&quot;Moving right&quot;</span>),</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    move_player(Direction::Up);</span><br><span class="line">    move_player(Direction::Left);</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="Zig"><a href="#Zig" class="headerlink" title="Zig"></a>Zig</h3><p>Zigå®˜æ–¹æ˜¯è¿™ä¹ˆè¯´çš„:Zig æ˜¯ä¸€ç§é€šç”¨çš„ç¼–ç¨‹è¯­è¨€å’Œå·¥å…·é“¾ï¼Œç”¨äºç»´æŠ¤<strong>å¥å£®</strong>ã€<strong>æœ€ä¼˜</strong>å’Œ<strong>å¯é‡ç”¨</strong>çš„è½¯ä»¶.</p><p>æ—¢ç„¶æœ‰äº†C++å’ŒRust,ä¸ºä»€ä¹ˆåˆè¦æè¿™ä¹ˆå¤šä¸œè¥¿?<a href="https://ziglang.org/zh/learn/why_zig_rust_d_cpp/">æœ‰äº† C++ã€D å’Œ Rustï¼Œä¸ºä»€ä¹ˆè¿˜éœ€è¦ Zigï¼Ÿ âš¡ Zig Programming Language (ziglang.org)</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">const std = @import(&quot;std&quot;);</span><br><span class="line">const parseInt = std.fmt.parseInt;</span><br><span class="line"></span><br><span class="line">test &quot;parse integers&quot; &#123;</span><br><span class="line">    const input = &quot;123 67 89,99&quot;;</span><br><span class="line">    const ally = std.testing.allocator;</span><br><span class="line"></span><br><span class="line">    var list = std.ArrayList(u32).init(ally);</span><br><span class="line">    // Ensure the list is freed at scope exit.</span><br><span class="line">    // Try commenting out this line!</span><br><span class="line">    defer list.deinit();</span><br><span class="line"></span><br><span class="line">    var it = std.mem.tokenizeAny(u8, input, &quot; ,&quot;);</span><br><span class="line">    while (it.next()) |num| &#123;</span><br><span class="line">        const n = try parseInt(u32, num, 10);</span><br><span class="line">        try list.append(n);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    const expected = [_]u32&#123; 123, 67, 89, 99 &#125;;</span><br><span class="line"></span><br><span class="line">    for (expected, list.items) |exp, actual| &#123;</span><br><span class="line">        try std.testing.expectEqual(exp, actual);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">const std = @import(&quot;std&quot;);</span><br><span class="line"></span><br><span class="line">pub fn main() !void &#123;</span><br><span class="line">    const x: i32 = 5;</span><br><span class="line">    const y: i32 = 10;</span><br><span class="line">    const sum = x + y;</span><br><span class="line">    std.log.info(&quot;The sum of &#123;&#125; and &#123;&#125; is &#123;&#125;&quot;, .&#123; x, y, sum &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">const std = @import(&quot;std&quot;);</span><br><span class="line"></span><br><span class="line">fn greet(name: []const u8) void &#123;</span><br><span class="line">    std.log.info(&quot;Hello, &#123;&#125;!&quot;, .&#123;name&#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">pub fn main() !void &#123;</span><br><span class="line">    greet(&quot;Alice&quot;);</span><br><span class="line">    greet(&quot;Bob&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®˜æ–¹æ–‡æ¡£é˜è¿°äº†éå¸¸å¤šZigçš„ä¼˜åŠ¿,çœ‹èµ·æ¥ç‰¹åˆ«å¸å¼•äºº,ä½†æ˜¯ç›®å‰ä½¿ç”¨çš„äººè¿˜æ˜¯ä¸å¤š.</p><p>Zigçš„ä¸€äº›<strong>åŠ£åŠ¿</strong>åŒ…æ‹¬ï¼š</p><ul><li>æœ‰é™çš„ç”Ÿæ€ç³»ç»Ÿï¼šå› ä¸ºå®ƒä»å¤„äºæ—©æœŸé˜¶æ®µï¼ŒZigè¯­è¨€çš„ç”Ÿæ€ç³»ç»Ÿæ¯”æˆç†Ÿè¯­è¨€æ›´å°</li><li>æˆç†Ÿåº¦å’Œå·¥å…·ï¼šZigæ˜¯ä¸€ç§æ–°è¯­è¨€ï¼Œè¿˜æœ‰æ”¹è¿›çš„ç©ºé—´ã€‚ä½†è¯·æ³¨æ„ï¼Œä»ç„¶æœ‰ä¸€ä¸ªå¼ºå¤§è€Œæ´»è·ƒçš„ç¤¾åŒºæ”¯æŒå®ƒ</li><li>æ–‡æ¡£å¯ç”¨æ€§ï¼šZigæ˜¯ä¸€ç§ç›¸å¯¹è¾ƒæ–°çš„è¯­è¨€ï¼Œå› æ­¤æ–‡æ¡£æœ‰é™ï¼Œç¤¾åŒºæ­£åœ¨åŠªåŠ›æé«˜æ–‡æ¡£çš„å¯ç”¨æ€§</li></ul><p>å¼€å‘è€…å¯ä»¥åœ¨ç³»ç»Ÿç¼–ç¨‹ä¸­ä½¿ç”¨Zigæ¥æ„å»ºæ“ä½œç³»ç»Ÿã€è®¾å¤‡é©±åŠ¨ç¨‹åºå’ŒåµŒå…¥å¼ç³»ç»Ÿã€‚å…¶è¿˜åœ¨<a href="https://cloud.tencent.com/product/cli?from_column=20065&amp;from=20065">å‘½ä»¤è¡Œå·¥å…·</a>ä¸­ä¹Ÿæœ‰å¾ˆå¤šåº”ç”¨åœºæ™¯ï¼Œå¯ç”¨äºåˆ›å»ºé«˜æ•ˆå’Œå¿«é€Ÿçš„å‘½ä»¤è¡Œç•Œé¢ï¼Œæ„å»ºç³»ç»Ÿè„šæœ¬ï¼Œæˆ–ä¼˜åŒ–ç°æœ‰å·¥å…·çš„æ€§èƒ½ã€‚</p><p>åœ¨ç¼–è¯‘å™¨å’Œè¯­è¨€å¼€å‘ä¸­ï¼ŒZigä»¥å…¶å…ƒç¼–ç¨‹èƒ½åŠ›å’Œå¯¹ç®€æ˜“æ€§çš„è¿½æ±‚è€Œé—»åã€‚æ¯”è¾ƒè‘—åçš„å¼€æºé¡¹ç›®æ˜¯Bunï¼Œå…¶æ˜¯ä¸€ä¸ªä½¿ç”¨Zigå¼€å‘çš„JavaScriptè¿è¡Œæ—¶ã€‚</p><p>ä¸Rustä¸€æ ·ï¼ŒZigä¹Ÿæœ‰ä¸€äº›æ›´ä¸ºä¸“ä¸šçš„ä½¿ç”¨åœºæ™¯ï¼š</p><ul><li>æ¸¸æˆå¼€å‘ï¼Œå› æ”¯æŒé«˜æ€§èƒ½æ¸¸æˆå¼•æ“ã€èƒ½å¤Ÿå®æ—¶æ¨¡æ‹Ÿ</li><li>åœ¨åµŒå…¥å¼ç³»ç»Ÿå’Œç‰©è”ç½‘ä¸­ï¼Œç”¨äºç¼–ç¨‹å¾®æ§åˆ¶å™¨ã€ä¼ æ„Ÿå™¨å’Œå…¶ä»–èµ„æºå—é™è®¾å¤‡</li><li>åœ¨å¯†ç åº”ç”¨ä¸­ï¼Œç”¨äºå®ç°åŠ å¯†ç®—æ³•ã€æ•°å­—ç­¾åã€å®‰å…¨é€šä¿¡åè®®å’Œå…¶ä»–å®‰å…¨æ•æ„Ÿç»„</li></ul><p>å°å°çš„Benchmark<a href="https://zserge.com/posts/better-c-benchmark/">A â€œBetter Câ€ Benchmark (zserge.com)</a></p><p>æˆ‘ä¸ºä»€ä¹ˆä¼šçœ‹ä¸Šé¢è¿™äº›è¯­è¨€çš„æ¯”è¾ƒ,ä¸»è¦åŸå› è¿˜æ˜¯:C++å¾ˆå¥½,ä½†æ²¡æœ‰å®Œå–„çš„å·¥å…·é“¾,å®ƒçš„æ ‡å‡†å§”å‘˜ä¼šä¹Ÿä¸ä¼šç®¡è¿™äº›,è€Œä¸€äº›å¤§å‚ä¹Ÿæ²¡æœ‰å¼€æºä¸€äº›å·¥å…·ä½¿ç”¨ï¼›</p><p>Goçš„ç”Ÿæ€ä½è·ŸC/C++å’ŒRustè¿™ç±»è¯­è¨€è¿˜ä¸ä¸€æ ·åè€…çš„ä¸€äº›ä¸œè¥¿ä¸ä¼šæ‹¿Goæ¥é‡æ„;Rustçš„ä¸Šæ‰‹é—¨æ§›é«˜,ä½†ç›®å‰çœ‹æ¥æ˜¯æœ€å¯è¡Œçš„C/C++åœ¨ç³»ç»Ÿç¼–ç¨‹ã€å·¥å…·é“¾é‡æ„ç”šè‡³äºä¸€äº›ä¸šåŠ¡å¤„ç†ä¸Šçš„å¯è¡Œå·¥å…·.</p><p>è€ŒZigè¿˜è¿œè¿œæ²¡æœ‰å®Œå–„,ä½†ä¸Šæ‰‹é—¨æ§›ç›¸å¯¹æ›´ä½,ä½†åº”è¯¥è¿˜æ˜¯éœ€è¦æ²‰æ·€,æ›´ä½•å†µcè¯­è¨€å³ä½¿åˆ°ä»Šå¤©ä¹Ÿåœ¨æ›´æ–°,ç”Ÿæ€è¿˜æ˜¯åœ¨çš„.</p><h2 id="é¢˜å¤–è¯"><a href="#é¢˜å¤–è¯" class="headerlink" title="é¢˜å¤–è¯"></a>é¢˜å¤–è¯</h2><p>ä¹‹å‰ä¸€æ®µæ—¶é—´æœ‰ä¸ªå«Mojoçš„ç¼–ç¨‹è¯­è¨€ä¸æ–­åœ¨å®£ä¼ è‡ªå·±çš„åœ¨AIé¢†åŸŸç¼–ç¨‹çš„åœ°ä½:æ¯”Cå’ŒPythonæ€§èƒ½æ›´å¥½.<a href="https://www.modular.com/max/mojo">Mojo ğŸ”¥: Programming language for all of AI (modular.com)</a></p><p>ç›®å‰è¿˜åœ¨å¹æ°´å»ºè®¾é˜¶æ®µ,çœ‹åç»­è¡¨ç°(å…¶å®å¤§ä¼—çœ‹çš„æ˜¯æœ‰æ²¡æœ‰ç›¸å…³å¤§å‚è¿›å±€).</p><p>æˆ‘å¸¸å¸¸ä¼šå…³æ³¨ä¸€äº›æœ¬èº«æ¯”è¾ƒè€ä½†ä½¿ç”¨å¹¶ä¸å°‘çš„ç¼–ç¨‹è¯­è¨€,å› ä¸ºè¿™ç±»ç¼–ç¨‹è¯­è¨€æœ‰è‡ªå·±çš„ç”Ÿæ€ä½,æ–‡æ¡£å¯èƒ½ä¸ç®—æ–°,å®˜æ–¹ç½‘ç«™ä¹Ÿå¾€å¾€çœ‹èµ·æ¥å¾ˆè€,ç”Ÿæ€ä¸Šä¹Ÿæ²¡æœ‰å¾ˆå¤§çš„æŒç»­å‘åŠ›ç‚¹,ä½†æ˜¯æˆ‘è¿˜æ˜¯ä¼šæ—¶ä¸æ—¶çœ‹çœ‹,æ¯•ç«Ÿå…¶ä¸­å¾ˆå¤šå¯èƒ½ä¹Ÿä¼šç”¨ä¸Š.</p><h3 id="PHP"><a href="#PHP" class="headerlink" title="PHP"></a>PHP</h3><p>ä¹‹å‰çš„æ–‡ç« æˆ‘ä¹Ÿæåˆ°è¿‡,phpç”Ÿæ€ä½å°±æ˜¯web,ä¹Ÿæ˜¯ä¸ºwebè€Œç”Ÿ.ä½ ç”šè‡³ä¸éœ€è¦ç‰¹æ„ä½¿ç”¨æŸäº›webæ¡†æ¶æ¥åˆ›å»ºåº”ç”¨,å®ƒæœ¬èº«å°±æ”¯æŒå¾ˆå¤šæ“ä½œ.ä½†æ˜¯phpæœ¬èº«æœ‰äº›è¯­æ³•è¿˜éœ€è¦é€‚åº”(å¾ˆå¤šäººè¯´è¯­æ³•ä¸‘é™‹).è€Œå®ƒçš„webæ¡†æ¶ä¹Ÿç‰¹åˆ«å¤š,ä»ç›¸å¯¹è½»é‡ThinkPHPã€Symfonyåˆ°é‡å‹çš„Laravel,éƒ½å¯ä»¥è¯•è¯•.Swooleæ¡†æ¶ä¹Ÿä½¿å¾—ä»Webåˆ° TCPã€UDPã€Socketä¸Š</p><p>è¿˜æœ‰ç›¸æ¯”swooleæ›´æ˜“å­¦ä¹ çš„workerman,workerman æ˜¯çº¯phpå†™çš„ç½‘ç»œæ¡†æ¶.æ”¯æŒTCPé•¿è¿æ¥ï¼Œæ”¯æŒWebsocketã€HTTPç­‰åè®®.ä»¥åŠåŸºäºworkermançš„webman,webmanç”¨äºæ›¿ä»£ä¼ ç»Ÿçš„php-fpmæ¶æ„ï¼Œæä¾›è¶…é«˜æ€§èƒ½å¯æ‰©å±•çš„HTTPæœåŠ¡ã€‚ä½ å¯ä»¥ç”¨webmanå¼€å‘ç½‘ç«™ï¼Œä¹Ÿå¯ä»¥å¼€å‘HTTPæ¥å£æˆ–è€…å¾®æœåŠ¡</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$numbers</span> = <span class="keyword">array</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;The first number is: &quot;</span> . <span class="variable">$numbers</span>[<span class="number">0</span>];</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;The length of the array is: &quot;</span> . count(<span class="variable">$numbers</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$person</span> = <span class="keyword">array</span>(</span><br><span class="line">    <span class="string">&quot;name&quot;</span> =&gt; <span class="string">&quot;Alice&quot;</span>,</span><br><span class="line">    <span class="string">&quot;age&quot;</span> =&gt; <span class="number">30</span></span><br><span class="line">);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;Name: &quot;</span> . <span class="variable">$person</span>[<span class="string">&quot;name&quot;</span>] . <span class="string">&quot;, Age: &quot;</span> . <span class="variable">$person</span>[<span class="string">&quot;age&quot;</span>];</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$name</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$age</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$age</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;name = <span class="variable">$name</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;age = <span class="variable">$age</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">greet</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Hello, my name is &quot;</span> . <span class="keyword">$this</span>-&gt;name . <span class="string">&quot; and I&#x27;m &quot;</span> . <span class="keyword">$this</span>-&gt;age . <span class="string">&quot; years old.&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$alice</span> = <span class="keyword">new</span> Person(<span class="string">&quot;Alice&quot;</span>, <span class="number">30</span>);</span><br><span class="line"><span class="variable">$alice</span>-&gt;greet(); <span class="comment">// è¾“å‡º &quot;Hello, my name is Alice and I&#x27;m 30 years old.&quot;</span></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">divide</span>(<span class="params"><span class="variable">$a</span>, <span class="variable">$b</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$b</span> == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> \<span class="built_in">Exception</span>(<span class="string">&quot;Division by zero&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$a</span> / <span class="variable">$b</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="variable">$result</span> = divide(<span class="number">10</span>, <span class="number">0</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span> (\<span class="built_in">Exception</span> <span class="variable">$e</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Error: &quot;</span> . <span class="variable">$e</span>-&gt;getMessage();</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$greet</span> = <span class="function"><span class="keyword">function</span>(<span class="params"><span class="variable">$name</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Hello, <span class="subst">$name</span>!&quot;</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="variable">$greet</span>(<span class="string">&quot;Alice&quot;</span>); <span class="comment">// è¾“å‡º &quot;Hello, Alice!&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$numbers</span> = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>];</span><br><span class="line"><span class="variable">$doubledNumbers</span> = array_map(<span class="function"><span class="keyword">function</span>(<span class="params"><span class="variable">$x</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$x</span> * <span class="number">2</span>;</span><br><span class="line">&#125;, <span class="variable">$numbers</span>);</span><br><span class="line"></span><br><span class="line">print_r(<span class="variable">$doubledNumbers</span>); <span class="comment">// è¾“å‡º [2, 4, 6, 8, 10]</span></span><br></pre></td></tr></table></figure><p><strong>æ¨èå­¦ä¹ </strong>:</p><ul><li><a href="https://docs.golaravel.com/">Laravel - ä¸º WEB è‰ºæœ¯å®¶åˆ›é€ çš„ PHP æ¡†æ¶ã€‚ (golaravel.com)</a></li><li><a href="https://symfony.com/">Symfony, High Performance PHP Framework for Web Development</a></li><li><a href="https://www.workerman.net/">é«˜æ€§èƒ½PHPåº”ç”¨å®¹å™¨ workerman</a></li><li><a href="https://www.workerman.net/doc/webman/README.html">webman æ‰‹å†Œ (workerman.net)</a></li></ul><h3 id="Ruby"><a href="#Ruby" class="headerlink" title="Ruby"></a>Ruby</h3><p>ä¹Ÿæ˜¯webç”Ÿæ€,æˆ–è€…è¯´åº”ä¸ºrailsè€ŒçŸ¥å.å›½å†…ç›¸å¯¹æ¥è¯´æ²¡é‚£ä¹ˆå¤šä½¿ç”¨rubyçš„.</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">numbers = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line">puts <span class="string">&quot;The first number is: <span class="subst">#&#123;numbers[<span class="number">0</span>]&#125;</span>&quot;</span></span><br><span class="line">puts <span class="string">&quot;The length of the array is: <span class="subst">#&#123;numbers.length&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line">person = &#123;</span><br><span class="line">  <span class="string">&quot;name&quot;</span> =&gt; <span class="string">&quot;Alice&quot;</span>,</span><br><span class="line">  <span class="string">&quot;age&quot;</span> =&gt; <span class="number">30</span></span><br><span class="line">&#125;</span><br><span class="line">puts <span class="string">&quot;Name: <span class="subst">#&#123;person[<span class="string">&quot;name&quot;</span>]&#125;</span>, Age: <span class="subst">#&#123;person[<span class="string">&quot;age&quot;</span>]&#125;</span>&quot;</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span></span></span><br><span class="line">  <span class="keyword">attr_accessor</span> <span class="symbol">:name</span>, <span class="symbol">:age</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">initialize</span><span class="params">(name, age)</span></span></span><br><span class="line">    <span class="variable">@name</span> = name</span><br><span class="line">    <span class="variable">@age</span> = age</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">greet</span></span></span><br><span class="line">    puts <span class="string">&quot;Hello, my name is <span class="subst">#&#123;<span class="variable">@name</span>&#125;</span> and I&#x27;m <span class="subst">#&#123;<span class="variable">@age</span>&#125;</span> years old.&quot;</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»º Person å¯¹è±¡å¹¶è°ƒç”¨æ–¹æ³•</span></span><br><span class="line">alice = Person.new(<span class="string">&quot;Alice&quot;</span>, <span class="number">30</span>)</span><br><span class="line">alice.greet <span class="comment"># è¾“å‡º &quot;Hello, my name is Alice and I&#x27;m 30 years old.&quot;</span></span><br></pre></td></tr></table></figure><p><strong>æ¨èå­¦ä¹ </strong>:</p><ul><li><a href="https://rubyonrails.org/">Ruby on Rails â€” A web-app framework that includes everything needed to create database-backed web applications according to the Model-View-Controller (MVC) pattern.</a></li></ul><h3 id="Lua"><a href="#Lua" class="headerlink" title="Lua"></a>Lua</h3><p>luaç”Ÿæ€ä½æ˜¯å†™ä¸€äº›æ¸¸æˆè„šæœ¬æˆ–è€…ä¸€äº›å·¥å…·çš„åŠŸèƒ½,æ¯”å¦‚neovimä¸­çš„ä¸€äº›æ’ä»¶å°±ä¼šä½¿ç”¨lua.å¦å¤–ä¸€äº›åµŒå…¥å¼è®¾å¤‡ä¹Ÿä¼šä½¿ç”¨,ä¸»è¦æ˜¯ä¸å…¶ä»–è¯­è¨€æ­é….è¿™é—¨è¯­è¨€æœ¬èº«éå¸¸å°,</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> x = <span class="number">5</span></span><br><span class="line"><span class="keyword">local</span> y = <span class="number">10</span></span><br><span class="line"><span class="keyword">local</span> sum = x + y</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;The sum of &quot;</span> .. x .. <span class="string">&quot; and &quot;</span> .. y .. <span class="string">&quot; is &quot;</span> .. sum)</span><br><span class="line"><span class="keyword">local</span> fruits = &#123;<span class="string">&quot;apple&quot;</span>, <span class="string">&quot;banana&quot;</span>, <span class="string">&quot;orange&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ä½¿ç”¨forå¾ªç¯éå†</span></span><br><span class="line"><span class="keyword">for</span> i=<span class="number">1</span>, #fruits <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">print</span>(fruits[i])</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- ä½¿ç”¨for-inå¾ªç¯éå†</span></span><br><span class="line"><span class="keyword">for</span> _, fruit <span class="keyword">in</span> <span class="built_in">ipairs</span>(fruits) <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">print</span>(fruit)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="comment">-- å®šä¹‰ä¸€ä¸ªPersonç±»</span></span><br><span class="line"><span class="keyword">local</span> Person = &#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person:new</span><span class="params">(name, age)</span></span></span><br><span class="line">    <span class="keyword">local</span> obj = &#123;</span><br><span class="line">        name = name,</span><br><span class="line">        age = age</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">setmetatable</span>(obj, <span class="built_in">self</span>)</span><br><span class="line">    <span class="built_in">self</span>.<span class="built_in">__index</span> = <span class="built_in">self</span></span><br><span class="line">    <span class="keyword">return</span> obj</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person:greet</span><span class="params">()</span></span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Hello, my name is &quot;</span> .. <span class="built_in">self</span>.name .. <span class="string">&quot; and I&#x27;m &quot;</span> .. <span class="built_in">self</span>.age .. <span class="string">&quot; years old.&quot;</span>)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- åˆ›å»ºPersonå¯¹è±¡å¹¶è°ƒç”¨æ–¹æ³•</span></span><br><span class="line"><span class="keyword">local</span> alice = Person:new(<span class="string">&quot;Alice&quot;</span>, <span class="number">30</span>)</span><br><span class="line">alice:greet()</span><br><span class="line"><span class="comment">-- å®šä¹‰ä¸€ä¸ªåç¨‹å‡½æ•°</span></span><br><span class="line"><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">count</span><span class="params">(n)</span></span></span><br><span class="line">    <span class="keyword">for</span> i=<span class="number">1</span>,n <span class="keyword">do</span></span><br><span class="line">        <span class="built_in">coroutine</span>.<span class="built_in">yield</span>(i)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- åˆ›å»ºå¹¶æ§åˆ¶åç¨‹</span></span><br><span class="line"><span class="keyword">local</span> co = <span class="built_in">coroutine</span>.<span class="built_in">create</span>(count)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">coroutine</span>.<span class="built_in">resume</span>(co, <span class="number">5</span>)) <span class="comment">-- è¾“å‡º 1</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">coroutine</span>.<span class="built_in">resume</span>(co)) <span class="comment">-- è¾“å‡º 2</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">coroutine</span>.<span class="built_in">resume</span>(co)) <span class="comment">-- è¾“å‡º 3</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">coroutine</span>.<span class="built_in">resume</span>(co)) <span class="comment">-- è¾“å‡º 4</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">coroutine</span>.<span class="built_in">resume</span>(co)) <span class="comment">-- è¾“å‡º 5</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">coroutine</span>.<span class="built_in">resume</span>(co)) <span class="comment">-- è¾“å‡º nil</span></span><br></pre></td></tr></table></figure><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- å®šä¹‰ä¸€ä¸ªVector2Dç±»</span></span><br><span class="line"><span class="keyword">local</span> Vector2D = &#123;&#125;</span><br><span class="line">Vector2D.<span class="built_in">__index</span> = Vector2D</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Vector2D:new</span><span class="params">(x, y)</span></span></span><br><span class="line">    <span class="keyword">local</span> obj = <span class="built_in">setmetatable</span>(&#123;x=x, y=y&#125;, Vector2D)</span><br><span class="line">    <span class="keyword">return</span> obj</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Vector2D:add</span><span class="params">(other)</span></span></span><br><span class="line">    <span class="keyword">return</span> Vector2D:new(<span class="built_in">self</span>.x + other.x, <span class="built_in">self</span>.y + other.y)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Vector2D:__tostring</span><span class="params">()</span></span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;(&quot;</span> .. <span class="built_in">self</span>.x .. <span class="string">&quot;, &quot;</span> .. <span class="built_in">self</span>.y .. <span class="string">&quot;)&quot;</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- åˆ›å»ºå’Œæ“ä½œVector2Då¯¹è±¡</span></span><br><span class="line"><span class="keyword">local</span> v1 = Vector2D:new(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line"><span class="keyword">local</span> v2 = Vector2D:new(<span class="number">3</span>, <span class="number">4</span>)</span><br><span class="line"><span class="keyword">local</span> v3 = v1:add(v2)</span><br><span class="line"><span class="built_in">print</span>(v3) <span class="comment">-- è¾“å‡º (4, 6)</span></span><br></pre></td></tr></table></figure><ul><li><a href="https://www.lua.org/">The Programming Language Lua</a></li></ul><h3 id="ä¸€äº›æœ‰è¶£çš„ä¸œè¥¿"><a href="#ä¸€äº›æœ‰è¶£çš„ä¸œè¥¿" class="headerlink" title="ä¸€äº›æœ‰è¶£çš„ä¸œè¥¿"></a>ä¸€äº›æœ‰è¶£çš„ä¸œè¥¿</h3><p>[<a href="https://www.codementor.io/blog/worst-languages-to-learn-3phycr98zk">Worst Programming Languages to Learn in 2018 (codementor.io)</a>è¿™ç¯‡æ–‡ç« åœ¨2018å¹´ç»™å‡ºäº†åœ¨å·¥ä½œä¸Šä¸æ¨èç¢°çš„è¯­è¨€,å…¶ä¸­åŒ…æ‹¬Dart,Rust,Ruby,Goç­‰,äº‹å®ä¸Šä»å·¥ä½œçš„è§’åº¦æ¥çœ‹,ä¸€äº›å‡½æ•°å¼ç¼–ç¨‹è¯­è¨€å’Œé—¨æ§›è¾ƒé«˜çš„è¯­è¨€ä¸Šæ¦œå¾ˆæ­£å¸¸,ä½†æ˜¯å¦å¤–æœ‰äº›æ›´å¯èƒ½æ˜¯å› ä¸ºç”Ÿæ€è¿˜ä¸å¤Ÿå¤§,ä½†æœ¬èº«æ˜¯åšåº”ç”¨çš„,æ¯”å¦‚Dartå’ŒGo,æ‰€ä»¥è¿˜éœ€è¦å®˜ç½‘.</p><p>è¿™ä»½æ¦œå•æ¯”è¾ƒæ¿€è¿›,ä½†æ€»ä½“è¿˜æ˜¯å¾ˆæœ‰è¶£çš„.åƒå‡½æ•°æ—¶è¯­è¨€Clojureå’ŒElixirå°±ç›¸æ¯”æ›´è€çš„Haskellå’ŒErlangå°±æ›´å¥½.</p><p>åœ¨2019å¹´<a href="https://www.codementor.io/blog/worst-languages-2019-6mvbfg3w9x">Study of Programming Languages Not to Learn in 2019 (codementor.io)</a></p><p>è¿™ä»½æ¦œå•å˜å¾—æ›´ç¬¦åˆæˆ‘çš„çŸ¥è§‰äº†,å½“ç„¶è¿™äº›ä¸œè¥¿åªæ˜¯çœ‹çœ‹è€Œå·²,æ¯”å¦‚ä¸‹é¢çš„äººå°±è¯´è‡ªå·±æ‹¿CoffeeScriptå†™åº”ç”¨åˆ°AppStoreä¸Šèµšäº†å¾ˆå¤šé’±,æ‰€ä»¥,è¿˜æ˜¯è¦çœ‹ç”Ÿæ€ä½.</p><p><img data-src="https://s2.loli.net/2024/06/23/OM87TjbGsdWXl4E.png" alt="image-20240623122150477"></p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;p&gt;ä»Cè¯­è¨€è¯ç”Ÿå·²ç»äº”åå¤šå¹´äº†,ç°åœ¨å·²ç»æœ‰äº†è®¸å¤šé«˜çº§è¯­è¨€,å…¶ä¸­å¾ˆå¤šèƒŒé å¤§å‚,æ¯”å¦‚Java,Go,C#,Dart,Swiftç­‰ç­‰(ç”²éª¨æ–‡,è°·æ­Œå¾®è½¯å’Œè‹¹æœ,è¿™ç±»è¯­è¨€é€šè¿‡å…¬å¸æ›´æ–°).ä¹Ÿæœ‰å¾ˆå¤šç¤¾åŒºçš„è¯­è¨€,æ¯”å¦‚Python,Rust,PHP,Rubyç­‰(è¿™ç±»è¯­è¨€å¾€å¾€é€šè¿‡æ—©æœŸåˆ›å»ºè€…å’Œä¸€äº›æ ¸å¿ƒæˆå‘˜æ›´æ–°å’Œç»´æŠ¤,è¿™é‡Œé¢ä¹Ÿæœ‰å¾ˆå¤šå¼€æºçš„è¯­è¨€,å…è®¸å…¶ä»–äººä¿®æ”¹).&lt;br&gt;ç›¸è¾ƒäºå…¬å¸æ——ä¸‹çš„è¯­è¨€,ç¤¾åŒºç±»å‹çš„è¯­è¨€å¾€å¾€æ›´åŠ ç®€æ´,åœ¨ä½¿ç”¨æˆ–è€…ç”Ÿäº§ä¸‹æ•ˆç‡é«˜,ä½†ä¹Ÿå­˜åœ¨ç”Ÿæ€ç›¸å¯¹è¾ƒå·®ã€å·¥å…·é“¾ä¸å¤Ÿã€æ›´æ–°å‘åŠ›ä¸å¤ŸæŒä¹…ã€æ–‡æ¡£ä¸å¤Ÿä¸°å¯Œçš„é—®é¢˜.&lt;/p&gt;
&lt;p&gt;è€Œ A better Cçš„æ„æ€å°±æ˜¯åœ¨åé¢çš„è¯­è¨€ä¸­æ‰¾åˆ°æ€§èƒ½è¾ƒå¼º,ä½¿ç”¨å‹å¥½å¹¶ä¸”ç”Ÿæ€æŒç»­å‘å±•çš„è¯­è¨€.TLDR:åœ¨å¤§å‹é¡¹ç›®ä¸Šè¿˜æ˜¯ä½¿ç”¨C++,åœ¨ä¸€äº›å·¥å…·é“¾æˆ–è€…ä»£ç é‡æ„ä¸Šå¯ä»¥è€ƒè™‘Rust. &lt;/p&gt;</summary>
    
    
    
    
    <category term="programming language" scheme="https://www.sekyoro.top/tags/programming-language/"/>
    
  </entry>
  
  <entry>
    <title>ä»è®ºæ–‡ä¸­çœ‹AIç»˜ç”»(äºŒ)</title>
    <link href="https://www.sekyoro.top/2024/06/18/%E4%BB%8E%E8%AE%BA%E6%96%87%E4%B8%AD%E7%9C%8BAI%E7%BB%98%E7%94%BB-%E4%BA%8C/"/>
    <id>https://www.sekyoro.top/2024/06/18/%E4%BB%8E%E8%AE%BA%E6%96%87%E4%B8%AD%E7%9C%8BAI%E7%BB%98%E7%94%BB-%E4%BA%8C/</id>
    <published>2024-06-18T08:33:38.000Z</published>
    <updated>2024-06-18T08:36:29.095Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>æ¥ç€ä¸Šä¸€ç¯‡ ä»è®ºæ–‡ä¸­çœ‹AIç»˜ç”»(ä¸€)å†™,ä¸»è¦å…³æ³¨animationç”šè‡³videoçº§åˆ«çš„ç”Ÿæˆäº†.</p><span id="more"></span><h2 id="Animate-Anyone-Consistent-and-Controllable-Image-to-Video-Synthesis-for-Character-Animation"><a href="#Animate-Anyone-Consistent-and-Controllable-Image-to-Video-Synthesis-for-Character-Animation" class="headerlink" title="Animate Anyone: Consistent and Controllable Image-to-Video Synthesis for Character Animation"></a>Animate Anyone: Consistent and Controllable Image-to-Video Synthesis for Character Animation</h2><p>TODO:</p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;p&gt;æ¥ç€ä¸Šä¸€ç¯‡ ä»è®ºæ–‡ä¸­çœ‹AIç»˜ç”»(ä¸€)å†™,ä¸»è¦å…³æ³¨animationç”šè‡³videoçº§åˆ«çš„ç”Ÿæˆäº†.&lt;/p&gt;</summary>
    
    
    
    
    <category term="deep learning" scheme="https://www.sekyoro.top/tags/deep-learning/"/>
    
    <category term="generative ai" scheme="https://www.sekyoro.top/tags/generative-ai/"/>
    
  </entry>
  
  <entry>
    <title>myJourneyToAI:æ·±åº¦å­¦ä¹ ä¹‹æ—…</title>
    <link href="https://www.sekyoro.top/2024/06/12/myJourneyToAI-%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E4%B9%8B%E6%97%85/"/>
    <id>https://www.sekyoro.top/2024/06/12/myJourneyToAI-%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E4%B9%8B%E6%97%85/</id>
    <published>2024-06-12T11:32:09.000Z</published>
    <updated>2024-06-25T03:12:11.169Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>æ€»ç»“ä¸€ä¸‹å­¦ä¹ äººå·¥æ™ºèƒ½/æ·±åº¦å­¦ä¹ è¿‡ç¨‹ä¸­ä¸ªäººè§‰å¾—é‡è¦çš„æ–¹æ³•å’Œç»éªŒ. </p><p>ä¸»è¦å…³äºæ¨¡å‹.<br><span id="more"></span></p><h1 id="è›®è’æ—¶ä»£"><a href="#è›®è’æ—¶ä»£" class="headerlink" title="è›®è’æ—¶ä»£"></a>è›®è’æ—¶ä»£</h1><blockquote><p>å¤§çº¦2010å¹´å¼€å§‹ï¼Œé‚£äº›åœ¨è®¡ç®—ä¸Šçœ‹èµ·æ¥ä¸å¯è¡Œçš„ç¥ç»ç½‘ç»œç®—æ³•å˜å¾—çƒ­é—¨èµ·æ¥ï¼Œå®é™…ä¸Šæ˜¯ä»¥ä¸‹ä¸¤ç‚¹å¯¼è‡´çš„ï¼š å…¶ä¸€ï¼Œéšç€äº’è”ç½‘çš„å…¬å¸çš„å‡ºç°ï¼Œä¸ºæ•°äº¿åœ¨çº¿ç”¨æˆ·æä¾›æœåŠ¡ï¼Œå¤§è§„æ¨¡æ•°æ®é›†å˜å¾—è§¦æ‰‹å¯åŠï¼› å¦å¤–ï¼Œå»‰ä»·åˆé«˜è´¨é‡çš„ä¼ æ„Ÿå™¨ã€å»‰ä»·çš„æ•°æ®å­˜å‚¨ï¼ˆå…‹è±å¾·å®šå¾‹ï¼‰ä»¥åŠå»‰ä»·è®¡ç®—ï¼ˆæ‘©å°”å®šå¾‹ï¼‰çš„æ™®åŠï¼Œç‰¹åˆ«æ˜¯GPUçš„æ™®åŠï¼Œä½¿å¤§è§„æ¨¡ç®—åŠ›å”¾æ‰‹å¯å¾—ã€‚</p></blockquote><h2 id="ç»å…¸CNNæ¨¡å‹"><a href="#ç»å…¸CNNæ¨¡å‹" class="headerlink" title="ç»å…¸CNNæ¨¡å‹"></a>ç»å…¸CNNæ¨¡å‹</h2><h3 id="LeNet"><a href="#LeNet" class="headerlink" title="LeNet"></a>LeNet</h3><p><img data-src="https://zh.d2l.ai/_images/lenet.svg" alt="../_images/lenet.svg">æ¯ä¸ªå·ç§¯å—ä¸­çš„åŸºæœ¬å•å…ƒæ˜¯ä¸€ä¸ªå·ç§¯å±‚ã€ä¸€ä¸ªsigmoidæ¿€æ´»å‡½æ•°å’Œå¹³å‡æ±‡èšå±‚ã€‚è¯·æ³¨æ„ï¼Œè™½ç„¶ReLUå’Œæœ€å¤§æ±‡èšå±‚æ›´æœ‰æ•ˆï¼Œä½†å®ƒä»¬åœ¨20ä¸–çºª90å¹´ä»£è¿˜æ²¡æœ‰å‡ºç°ã€‚æ¯ä¸ªå·ç§¯å±‚ä½¿ç”¨5Ã—5å·ç§¯æ ¸å’Œä¸€ä¸ªsigmoidæ¿€æ´»å‡½æ•°ã€‚è¿™äº›å±‚å°†è¾“å…¥æ˜ å°„åˆ°å¤šä¸ªäºŒç»´ç‰¹å¾è¾“å‡ºï¼Œé€šå¸¸åŒæ—¶å¢åŠ é€šé“çš„æ•°é‡ã€‚ç¬¬ä¸€å·ç§¯å±‚æœ‰6ä¸ªè¾“å‡ºé€šé“ï¼Œè€Œç¬¬äºŒä¸ªå·ç§¯å±‚æœ‰16ä¸ªè¾“å‡ºé€šé“ã€‚æ¯ä¸ª2Ã—2æ± æ“ä½œï¼ˆæ­¥å¹…2ï¼‰é€šè¿‡ç©ºé—´ä¸‹é‡‡æ ·å°†ç»´æ•°å‡å°‘4å€ã€‚å·ç§¯çš„è¾“å‡ºå½¢çŠ¶ç”±æ‰¹é‡å¤§å°ã€é€šé“æ•°ã€é«˜åº¦ã€å®½åº¦å†³å®šã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">from</span> torch <span class="keyword">import</span> nn</span><br><span class="line"></span><br><span class="line">net = nn.Sequential(</span><br><span class="line">    nn.Conv2d(<span class="number">1</span>, <span class="number">6</span>, kernel_size=<span class="number">5</span>, padding=<span class="number">2</span>), nn.Sigmoid(),</span><br><span class="line">    nn.AvgPool2d(kernel_size=<span class="number">2</span>, stride=<span class="number">2</span>),</span><br><span class="line">    nn.Conv2d(<span class="number">6</span>, <span class="number">16</span>, kernel_size=<span class="number">5</span>), nn.Sigmoid(),</span><br><span class="line">    nn.AvgPool2d(kernel_size=<span class="number">2</span>, stride=<span class="number">2</span>),</span><br><span class="line">    nn.Flatten(),</span><br><span class="line">    nn.Linear(<span class="number">16</span> * <span class="number">5</span> * <span class="number">5</span>, <span class="number">120</span>), nn.Sigmoid(),</span><br><span class="line">    nn.Linear(<span class="number">120</span>, <span class="number">84</span>), nn.Sigmoid(),</span><br><span class="line">    nn.Linear(<span class="number">84</span>, <span class="number">10</span>))</span><br></pre></td></tr></table></figure><p><img data-src="https://zh.d2l.ai/_images/lenet-vert.svg" alt="../_images/lenet-vert.svg"></p><h3 id="AlexNet"><a href="#AlexNet" class="headerlink" title="AlexNet"></a>AlexNet</h3><p><img data-src="https://zh.d2l.ai/_images/alexnet.svg" alt="../_images/alexnet.svg"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">from</span> torch <span class="keyword">import</span> nn</span><br><span class="line"></span><br><span class="line">net = nn.Sequential(</span><br><span class="line">    <span class="comment"># è¿™é‡Œä½¿ç”¨ä¸€ä¸ª11*11çš„æ›´å¤§çª—å£æ¥æ•æ‰å¯¹è±¡ã€‚</span></span><br><span class="line">    <span class="comment"># åŒæ—¶ï¼Œæ­¥å¹…ä¸º4ï¼Œä»¥å‡å°‘è¾“å‡ºçš„é«˜åº¦å’Œå®½åº¦ã€‚</span></span><br><span class="line">    <span class="comment"># å¦å¤–ï¼Œè¾“å‡ºé€šé“çš„æ•°ç›®è¿œå¤§äºLeNet</span></span><br><span class="line">    nn.Conv2d(<span class="number">1</span>, <span class="number">96</span>, kernel_size=<span class="number">11</span>, stride=<span class="number">4</span>, padding=<span class="number">1</span>), nn.ReLU(),</span><br><span class="line">    nn.MaxPool2d(kernel_size=<span class="number">3</span>, stride=<span class="number">2</span>),</span><br><span class="line">    <span class="comment"># å‡å°å·ç§¯çª—å£ï¼Œä½¿ç”¨å¡«å……ä¸º2æ¥ä½¿å¾—è¾“å…¥ä¸è¾“å‡ºçš„é«˜å’Œå®½ä¸€è‡´ï¼Œä¸”å¢å¤§è¾“å‡ºé€šé“æ•°</span></span><br><span class="line">    nn.Conv2d(<span class="number">96</span>, <span class="number">256</span>, kernel_size=<span class="number">5</span>, padding=<span class="number">2</span>), nn.ReLU(),</span><br><span class="line">    nn.MaxPool2d(kernel_size=<span class="number">3</span>, stride=<span class="number">2</span>),</span><br><span class="line">    <span class="comment"># ä½¿ç”¨ä¸‰ä¸ªè¿ç»­çš„å·ç§¯å±‚å’Œè¾ƒå°çš„å·ç§¯çª—å£ã€‚</span></span><br><span class="line">    <span class="comment"># é™¤äº†æœ€åçš„å·ç§¯å±‚ï¼Œè¾“å‡ºé€šé“çš„æ•°é‡è¿›ä¸€æ­¥å¢åŠ ã€‚</span></span><br><span class="line">    <span class="comment"># åœ¨å‰ä¸¤ä¸ªå·ç§¯å±‚ä¹‹åï¼Œæ±‡èšå±‚ä¸ç”¨äºå‡å°‘è¾“å…¥çš„é«˜åº¦å’Œå®½åº¦</span></span><br><span class="line">    nn.Conv2d(<span class="number">256</span>, <span class="number">384</span>, kernel_size=<span class="number">3</span>, padding=<span class="number">1</span>), nn.ReLU(),</span><br><span class="line">    nn.Conv2d(<span class="number">384</span>, <span class="number">384</span>, kernel_size=<span class="number">3</span>, padding=<span class="number">1</span>), nn.ReLU(),</span><br><span class="line">    nn.Conv2d(<span class="number">384</span>, <span class="number">256</span>, kernel_size=<span class="number">3</span>, padding=<span class="number">1</span>), nn.ReLU(),</span><br><span class="line">    nn.MaxPool2d(kernel_size=<span class="number">3</span>, stride=<span class="number">2</span>),</span><br><span class="line">    nn.Flatten(),</span><br><span class="line">    <span class="comment"># è¿™é‡Œï¼Œå…¨è¿æ¥å±‚çš„è¾“å‡ºæ•°é‡æ˜¯LeNetä¸­çš„å¥½å‡ å€ã€‚ä½¿ç”¨dropoutå±‚æ¥å‡è½»è¿‡æ‹Ÿåˆ</span></span><br><span class="line">    nn.Linear(<span class="number">6400</span>, <span class="number">4096</span>), nn.ReLU(),</span><br><span class="line">    nn.Dropout(p=<span class="number">0.5</span>),</span><br><span class="line">    nn.Linear(<span class="number">4096</span>, <span class="number">4096</span>), nn.ReLU(),</span><br><span class="line">    nn.Dropout(p=<span class="number">0.5</span>),</span><br><span class="line">    <span class="comment"># æœ€åæ˜¯è¾“å‡ºå±‚ã€‚ç”±äºè¿™é‡Œä½¿ç”¨Fashion-MNISTï¼Œæ‰€ä»¥ç”¨ç±»åˆ«æ•°ä¸º10ï¼Œè€Œéè®ºæ–‡ä¸­çš„1000</span></span><br><span class="line">    nn.Linear(<span class="number">4096</span>, <span class="number">10</span>))</span><br></pre></td></tr></table></figure><h3 id="VGG"><a href="#VGG" class="headerlink" title="VGG"></a>VGG</h3><p><img data-src="https://guandi1995.github.io/images/classical_cnn/vgg-16-simplified.PNG" alt="img"></p><p><img data-src="https://zh.d2l.ai/_images/vgg.svg" alt="../_images/vgg.svg"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">vgg</span>(<span class="params">conv_arch</span>):</span></span><br><span class="line">    conv_blks = []</span><br><span class="line">    in_channels = <span class="number">1</span></span><br><span class="line">    <span class="comment"># å·ç§¯å±‚éƒ¨åˆ†</span></span><br><span class="line">    <span class="keyword">for</span> (num_convs, out_channels) <span class="keyword">in</span> conv_arch:</span><br><span class="line">        conv_blks.append(vgg_block(num_convs, in_channels, out_channels))</span><br><span class="line">        in_channels = out_channels</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> nn.Sequential(</span><br><span class="line">        *conv_blks, nn.Flatten(),</span><br><span class="line">        <span class="comment"># å…¨è¿æ¥å±‚éƒ¨åˆ†</span></span><br><span class="line">        nn.Linear(out_channels * <span class="number">7</span> * <span class="number">7</span>, <span class="number">4096</span>), nn.ReLU(), nn.Dropout(<span class="number">0.5</span>),</span><br><span class="line">        nn.Linear(<span class="number">4096</span>, <span class="number">4096</span>), nn.ReLU(), nn.Dropout(<span class="number">0.5</span>),</span><br><span class="line">        nn.Linear(<span class="number">4096</span>, <span class="number">10</span>))</span><br><span class="line"></span><br><span class="line">net = vgg(conv_arch)</span><br></pre></td></tr></table></figure><h3 id="NiN"><a href="#NiN" class="headerlink" title="NiN"></a>NiN</h3><p><img data-src="https://zh.d2l.ai/_images/nin.svg" alt="../_images/nin.svg" style="zoom:50%;" /></p><p>NiNå’ŒAlexNetä¹‹é—´çš„ä¸€ä¸ªæ˜¾è‘—åŒºåˆ«æ˜¯NiNå®Œå…¨å–æ¶ˆäº†å…¨è¿æ¥å±‚ã€‚ ç›¸åï¼ŒNiNä½¿ç”¨ä¸€ä¸ªNiNå—ï¼Œå…¶è¾“å‡ºé€šé“æ•°ç­‰äºæ ‡ç­¾ç±»åˆ«çš„æ•°é‡ã€‚æœ€åæ”¾ä¸€ä¸ª<em>å…¨å±€å¹³å‡æ±‡èšå±‚</em>ï¼ˆglobal average pooling layerï¼‰ï¼Œç”Ÿæˆä¸€ä¸ªå¯¹æ•°å‡ ç‡ ï¼ˆlogitsï¼‰ã€‚NiNè®¾è®¡çš„ä¸€ä¸ªä¼˜ç‚¹æ˜¯ï¼Œå®ƒæ˜¾è‘—å‡å°‘äº†æ¨¡å‹æ‰€éœ€å‚æ•°çš„æ•°é‡ã€‚ç„¶è€Œï¼Œåœ¨å®è·µä¸­ï¼Œè¿™ç§è®¾è®¡æœ‰æ—¶ä¼šå¢åŠ è®­ç»ƒæ¨¡å‹çš„æ—¶é—´</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">nin_block</span>(<span class="params">in_channels, out_channels, kernel_size, strides, padding</span>):</span></span><br><span class="line">    <span class="keyword">return</span> nn.Sequential(</span><br><span class="line">        nn.Conv2d(in_channels, out_channels, kernel_size, strides, padding),</span><br><span class="line">        nn.ReLU(),</span><br><span class="line">        nn.Conv2d(out_channels, out_channels, kernel_size=<span class="number">1</span>), nn.ReLU(),</span><br><span class="line">        nn.Conv2d(out_channels, out_channels, kernel_size=<span class="number">1</span>), nn.ReLU())</span><br><span class="line">net = nn.Sequential(</span><br><span class="line">    nin_block(<span class="number">1</span>, <span class="number">96</span>, kernel_size=<span class="number">11</span>, strides=<span class="number">4</span>, padding=<span class="number">0</span>),</span><br><span class="line">    nn.MaxPool2d(<span class="number">3</span>, stride=<span class="number">2</span>),</span><br><span class="line">    nin_block(<span class="number">96</span>, <span class="number">256</span>, kernel_size=<span class="number">5</span>, strides=<span class="number">1</span>, padding=<span class="number">2</span>),</span><br><span class="line">    nn.MaxPool2d(<span class="number">3</span>, stride=<span class="number">2</span>),</span><br><span class="line">    nin_block(<span class="number">256</span>, <span class="number">384</span>, kernel_size=<span class="number">3</span>, strides=<span class="number">1</span>, padding=<span class="number">1</span>),</span><br><span class="line">    nn.MaxPool2d(<span class="number">3</span>, stride=<span class="number">2</span>),</span><br><span class="line">    nn.Dropout(<span class="number">0.5</span>),</span><br><span class="line">    <span class="comment"># æ ‡ç­¾ç±»åˆ«æ•°æ˜¯10</span></span><br><span class="line">    nin_block(<span class="number">384</span>, <span class="number">10</span>, kernel_size=<span class="number">3</span>, strides=<span class="number">1</span>, padding=<span class="number">1</span>),</span><br><span class="line">    nn.AdaptiveAvgPool2d((<span class="number">1</span>, <span class="number">1</span>)),</span><br><span class="line">    <span class="comment"># å°†å››ç»´çš„è¾“å‡ºè½¬æˆäºŒç»´çš„è¾“å‡ºï¼Œå…¶å½¢çŠ¶ä¸º(æ‰¹é‡å¤§å°,10)</span></span><br><span class="line">    nn.Flatten())</span><br></pre></td></tr></table></figure><h3 id="GoogleNet"><a href="#GoogleNet" class="headerlink" title="GoogleNet"></a>GoogleNet</h3><p><img data-src="https://zh.d2l.ai/_images/inception.svg" alt="../_images/inception.svg"></p><p>åœ¨GoogLeNetä¸­ï¼ŒåŸºæœ¬çš„å·ç§¯å—è¢«ç§°ä¸º<em>Inceptionå—</em>ï¼ˆInception blockï¼‰</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">from</span> torch <span class="keyword">import</span> nn</span><br><span class="line"><span class="keyword">from</span> torch.nn <span class="keyword">import</span> functional <span class="keyword">as</span> F</span><br><span class="line"><span class="keyword">from</span> d2l <span class="keyword">import</span> torch <span class="keyword">as</span> d2l</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Inception</span>(<span class="params">nn.Module</span>):</span></span><br><span class="line">    <span class="comment"># c1--c4æ˜¯æ¯æ¡è·¯å¾„çš„è¾“å‡ºé€šé“æ•°</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, in_channels, c1, c2, c3, c4, **kwargs</span>):</span></span><br><span class="line">        <span class="built_in">super</span>(Inception, self).__init__(**kwargs)</span><br><span class="line">        <span class="comment"># çº¿è·¯1ï¼Œå•1x1å·ç§¯å±‚</span></span><br><span class="line">        self.p1_1 = nn.Conv2d(in_channels, c1, kernel_size=<span class="number">1</span>)</span><br><span class="line">        <span class="comment"># çº¿è·¯2ï¼Œ1x1å·ç§¯å±‚åæ¥3x3å·ç§¯å±‚</span></span><br><span class="line">        self.p2_1 = nn.Conv2d(in_channels, c2[<span class="number">0</span>], kernel_size=<span class="number">1</span>)</span><br><span class="line">        self.p2_2 = nn.Conv2d(c2[<span class="number">0</span>], c2[<span class="number">1</span>], kernel_size=<span class="number">3</span>, padding=<span class="number">1</span>)</span><br><span class="line">        <span class="comment"># çº¿è·¯3ï¼Œ1x1å·ç§¯å±‚åæ¥5x5å·ç§¯å±‚</span></span><br><span class="line">        self.p3_1 = nn.Conv2d(in_channels, c3[<span class="number">0</span>], kernel_size=<span class="number">1</span>)</span><br><span class="line">        self.p3_2 = nn.Conv2d(c3[<span class="number">0</span>], c3[<span class="number">1</span>], kernel_size=<span class="number">5</span>, padding=<span class="number">2</span>)</span><br><span class="line">        <span class="comment"># çº¿è·¯4ï¼Œ3x3æœ€å¤§æ±‡èšå±‚åæ¥1x1å·ç§¯å±‚</span></span><br><span class="line">        self.p4_1 = nn.MaxPool2d(kernel_size=<span class="number">3</span>, stride=<span class="number">1</span>, padding=<span class="number">1</span>)</span><br><span class="line">        self.p4_2 = nn.Conv2d(in_channels, c4, kernel_size=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span>(<span class="params">self, x</span>):</span></span><br><span class="line">        p1 = F.relu(self.p1_1(x))</span><br><span class="line">        p2 = F.relu(self.p2_2(F.relu(self.p2_1(x))))</span><br><span class="line">        p3 = F.relu(self.p3_2(F.relu(self.p3_1(x))))</span><br><span class="line">        p4 = F.relu(self.p4_2(self.p4_1(x)))</span><br><span class="line">        <span class="comment"># åœ¨é€šé“ç»´åº¦ä¸Šè¿ç»“è¾“å‡º</span></span><br><span class="line">        <span class="keyword">return</span> torch.cat((p1, p2, p3, p4), dim=<span class="number">1</span>)</span><br></pre></td></tr></table></figure><p><img data-src="https://zh.d2l.ai/_images/inception-full.svg" alt="../_images/inception-full.svg"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">b1 = nn.Sequential(nn.Conv2d(<span class="number">1</span>, <span class="number">64</span>, kernel_size=<span class="number">7</span>, stride=<span class="number">2</span>, padding=<span class="number">3</span>),</span><br><span class="line">                   nn.ReLU(),</span><br><span class="line">                   nn.MaxPool2d(kernel_size=<span class="number">3</span>, stride=<span class="number">2</span>, padding=<span class="number">1</span>))</span><br><span class="line">b2 = nn.Sequential(nn.Conv2d(<span class="number">64</span>, <span class="number">64</span>, kernel_size=<span class="number">1</span>),</span><br><span class="line">                   nn.ReLU(),</span><br><span class="line">                   nn.Conv2d(<span class="number">64</span>, <span class="number">192</span>, kernel_size=<span class="number">3</span>, padding=<span class="number">1</span>),</span><br><span class="line">                   nn.ReLU(),</span><br><span class="line">                   nn.MaxPool2d(kernel_size=<span class="number">3</span>, stride=<span class="number">2</span>, padding=<span class="number">1</span>))    </span><br><span class="line">b3 = nn.Sequential(Inception(<span class="number">192</span>, <span class="number">64</span>, (<span class="number">96</span>, <span class="number">128</span>), (<span class="number">16</span>, <span class="number">32</span>), <span class="number">32</span>),</span><br><span class="line">                   Inception(<span class="number">256</span>, <span class="number">128</span>, (<span class="number">128</span>, <span class="number">192</span>), (<span class="number">32</span>, <span class="number">96</span>), <span class="number">64</span>),</span><br><span class="line">                   nn.MaxPool2d(kernel_size=<span class="number">3</span>, stride=<span class="number">2</span>, padding=<span class="number">1</span>))                </span><br><span class="line">b4 = nn.Sequential(Inception(<span class="number">480</span>, <span class="number">192</span>, (<span class="number">96</span>, <span class="number">208</span>), (<span class="number">16</span>, <span class="number">48</span>), <span class="number">64</span>),</span><br><span class="line">                   Inception(<span class="number">512</span>, <span class="number">160</span>, (<span class="number">112</span>, <span class="number">224</span>), (<span class="number">24</span>, <span class="number">64</span>), <span class="number">64</span>),</span><br><span class="line">                   Inception(<span class="number">512</span>, <span class="number">128</span>, (<span class="number">128</span>, <span class="number">256</span>), (<span class="number">24</span>, <span class="number">64</span>), <span class="number">64</span>),</span><br><span class="line">                   Inception(<span class="number">512</span>, <span class="number">112</span>, (<span class="number">144</span>, <span class="number">288</span>), (<span class="number">32</span>, <span class="number">64</span>), <span class="number">64</span>),</span><br><span class="line">                   Inception(<span class="number">528</span>, <span class="number">256</span>, (<span class="number">160</span>, <span class="number">320</span>), (<span class="number">32</span>, <span class="number">128</span>), <span class="number">128</span>),</span><br><span class="line">                   nn.MaxPool2d(kernel_size=<span class="number">3</span>, stride=<span class="number">2</span>, padding=<span class="number">1</span>))           </span><br><span class="line">b5 = nn.Sequential(Inception(<span class="number">832</span>, <span class="number">256</span>, (<span class="number">160</span>, <span class="number">320</span>), (<span class="number">32</span>, <span class="number">128</span>), <span class="number">128</span>),</span><br><span class="line">                   Inception(<span class="number">832</span>, <span class="number">384</span>, (<span class="number">192</span>, <span class="number">384</span>), (<span class="number">48</span>, <span class="number">128</span>), <span class="number">128</span>),</span><br><span class="line">                   nn.AdaptiveAvgPool2d((<span class="number">1</span>,<span class="number">1</span>)),</span><br><span class="line">                   nn.Flatten())</span><br><span class="line"></span><br><span class="line">net = nn.Sequential(b1, b2, b3, b4, b5, nn.Linear(<span class="number">1024</span>, <span class="number">10</span>))            X = torch.rand(size=(<span class="number">1</span>, <span class="number">1</span>, <span class="number">96</span>, <span class="number">96</span>))</span><br><span class="line"><span class="keyword">for</span> layer <span class="keyword">in</span> net:</span><br><span class="line">    X = layer(X)</span><br><span class="line">    <span class="built_in">print</span>(layer.__class__.__name__,<span class="string">&#x27;output shape:\t&#x27;</span>, X.shape)</span><br></pre></td></tr></table></figure><h3 id="ResNet"><a href="#ResNet" class="headerlink" title="ResNet"></a>ResNet</h3><p><img data-src="https://zh.d2l.ai/_images/residual-block.svg" alt="../_images/residual-block.svg"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">from</span> torch <span class="keyword">import</span> nn</span><br><span class="line"><span class="keyword">from</span> torch.nn <span class="keyword">import</span> functional <span class="keyword">as</span> F</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Residual</span>(<span class="params">nn.Module</span>):</span>  <span class="comment">#@save</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, input_channels, num_channels,</span></span></span><br><span class="line"><span class="params"><span class="function">                 use_1x1conv=<span class="literal">False</span>, strides=<span class="number">1</span></span>):</span></span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        self.conv1 = nn.Conv2d(input_channels, num_channels,</span><br><span class="line">                               kernel_size=<span class="number">3</span>, padding=<span class="number">1</span>, stride=strides)</span><br><span class="line">        self.conv2 = nn.Conv2d(num_channels, num_channels,</span><br><span class="line">                               kernel_size=<span class="number">3</span>, padding=<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">if</span> use_1x1conv:</span><br><span class="line">            self.conv3 = nn.Conv2d(input_channels, num_channels,</span><br><span class="line">                                   kernel_size=<span class="number">1</span>, stride=strides)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.conv3 = <span class="literal">None</span></span><br><span class="line">        self.bn1 = nn.BatchNorm2d(num_channels)</span><br><span class="line">        self.bn2 = nn.BatchNorm2d(num_channels)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span>(<span class="params">self, X</span>):</span></span><br><span class="line">        Y = F.relu(self.bn1(self.conv1(X)))</span><br><span class="line">        Y = self.bn2(self.conv2(Y))</span><br><span class="line">        <span class="keyword">if</span> self.conv3:</span><br><span class="line">            X = self.conv3(X)</span><br><span class="line">        Y += X</span><br><span class="line">        <span class="keyword">return</span> F.relu(Y)</span><br></pre></td></tr></table></figure><p><img data-src="https://zh.d2l.ai/_images/resnet-block.svg" alt="../_images/resnet-block.svg"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">b1 = nn.Sequential(nn.Conv2d(<span class="number">1</span>, <span class="number">64</span>, kernel_size=<span class="number">7</span>, stride=<span class="number">2</span>, padding=<span class="number">3</span>),</span><br><span class="line">                   nn.BatchNorm2d(<span class="number">64</span>), nn.ReLU(),</span><br><span class="line">                   nn.MaxPool2d(kernel_size=<span class="number">3</span>, stride=<span class="number">2</span>, padding=<span class="number">1</span>))</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">resnet_block</span>(<span class="params">input_channels, num_channels, num_residuals,</span></span></span><br><span class="line"><span class="params"><span class="function">                 first_block=<span class="literal">False</span></span>):</span></span><br><span class="line">    blk = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(num_residuals):</span><br><span class="line">        <span class="keyword">if</span> i == <span class="number">0</span> <span class="keyword">and</span> <span class="keyword">not</span> first_block:</span><br><span class="line">            blk.append(Residual(input_channels, num_channels,</span><br><span class="line">                                use_1x1conv=<span class="literal">True</span>, strides=<span class="number">2</span>))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            blk.append(Residual(num_channels, num_channels))</span><br><span class="line">    <span class="keyword">return</span> blk</span><br><span class="line">b2 = nn.Sequential(*resnet_block(<span class="number">64</span>, <span class="number">64</span>, <span class="number">2</span>, first_block=<span class="literal">True</span>))</span><br><span class="line">b3 = nn.Sequential(*resnet_block(<span class="number">64</span>, <span class="number">128</span>, <span class="number">2</span>))</span><br><span class="line">b4 = nn.Sequential(*resnet_block(<span class="number">128</span>, <span class="number">256</span>, <span class="number">2</span>))</span><br><span class="line">b5 = nn.Sequential(*resnet_block(<span class="number">256</span>, <span class="number">512</span>, <span class="number">2</span>))</span><br><span class="line"></span><br><span class="line">net = nn.Sequential(b1, b2, b3, b4, b5,</span><br><span class="line">                    nn.AdaptiveAvgPool2d((<span class="number">1</span>,<span class="number">1</span>)),</span><br><span class="line">                    nn.Flatten(), nn.Linear(<span class="number">512</span>, <span class="number">10</span>))</span><br><span class="line">X = torch.rand(size=(<span class="number">1</span>, <span class="number">1</span>, <span class="number">224</span>, <span class="number">224</span>))</span><br><span class="line"><span class="keyword">for</span> layer <span class="keyword">in</span> net:</span><br><span class="line">    X = layer(X)</span><br><span class="line">    <span class="built_in">print</span>(layer.__class__.__name__,<span class="string">&#x27;output shape:\t&#x27;</span>, X.shape)</span><br></pre></td></tr></table></figure><h3 id="DenseNet"><a href="#DenseNet" class="headerlink" title="DenseNet"></a>DenseNet</h3><p><img data-src="https://zh.d2l.ai/_images/densenet-block.svg" alt="../_images/densenet-block.svg"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">from</span> torch <span class="keyword">import</span> nn</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">conv_block</span>(<span class="params">input_channels, num_channels</span>):</span></span><br><span class="line">    <span class="keyword">return</span> nn.Sequential(</span><br><span class="line">        nn.BatchNorm2d(input_channels), nn.ReLU(),</span><br><span class="line">        nn.Conv2d(input_channels, num_channels, kernel_size=<span class="number">3</span>, padding=<span class="number">1</span>))</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DenseBlock</span>(<span class="params">nn.Module</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, num_convs, input_channels, num_channels</span>):</span></span><br><span class="line">        <span class="built_in">super</span>(DenseBlock, self).__init__()</span><br><span class="line">        layer = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(num_convs):</span><br><span class="line">            layer.append(conv_block(</span><br><span class="line">                num_channels * i + input_channels, num_channels))</span><br><span class="line">        self.net = nn.Sequential(*layer)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span>(<span class="params">self, X</span>):</span></span><br><span class="line">        <span class="keyword">for</span> blk <span class="keyword">in</span> self.net:</span><br><span class="line">            Y = blk(X)</span><br><span class="line">            <span class="comment"># è¿æ¥é€šé“ç»´åº¦ä¸Šæ¯ä¸ªå—çš„è¾“å…¥å’Œè¾“å‡º</span></span><br><span class="line">            X = torch.cat((X, Y), dim=<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">return</span> X</span><br></pre></td></tr></table></figure><p>ç¨ å¯†ç½‘ç»œä¸»è¦ç”±2éƒ¨åˆ†æ„æˆï¼š<em>ç¨ å¯†å—</em>ï¼ˆdense blockï¼‰å’Œ<em>è¿‡æ¸¡å±‚</em>ï¼ˆtransition layerï¼‰</p><p><img data-src="https://zh.d2l.ai/_images/densenet.svg" alt="../_images/densenet.svg"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">blk = DenseBlock(<span class="number">2</span>, <span class="number">3</span>, <span class="number">10</span>)</span><br><span class="line">X = torch.randn(<span class="number">4</span>, <span class="number">3</span>, <span class="number">8</span>, <span class="number">8</span>)</span><br><span class="line">Y = blk(X)</span><br><span class="line">Y.shape</span><br></pre></td></tr></table></figure><p>ç”±äºæ¯ä¸ªç¨ å¯†å—éƒ½ä¼šå¸¦æ¥é€šé“æ•°çš„å¢åŠ ï¼Œä½¿ç”¨è¿‡å¤šåˆ™ä¼šè¿‡äºå¤æ‚åŒ–æ¨¡å‹ã€‚ è€Œè¿‡æ¸¡å±‚å¯ä»¥ç”¨æ¥æ§åˆ¶æ¨¡å‹å¤æ‚åº¦ã€‚ å®ƒé€šè¿‡1Ã—1å·ç§¯å±‚æ¥å‡å°é€šé“æ•°ï¼Œå¹¶ä½¿ç”¨æ­¥å¹…ä¸º2çš„å¹³å‡æ±‡èšå±‚å‡åŠé«˜å’Œå®½ï¼Œä»è€Œè¿›ä¸€æ­¥é™ä½æ¨¡å‹å¤æ‚åº¦ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">transition_block</span>(<span class="params">input_channels, num_channels</span>):</span></span><br><span class="line">    <span class="keyword">return</span> nn.Sequential(</span><br><span class="line">        nn.BatchNorm2d(input_channels), nn.ReLU(),</span><br><span class="line">        nn.Conv2d(input_channels, num_channels, kernel_size=<span class="number">1</span>),</span><br><span class="line">        nn.AvgPool2d(kernel_size=<span class="number">2</span>, stride=<span class="number">2</span>))</span><br><span class="line">blk = transition_block(<span class="number">23</span>, <span class="number">10</span>)</span><br><span class="line">b1 = nn.Sequential(</span><br><span class="line">    nn.Conv2d(<span class="number">1</span>, <span class="number">64</span>, kernel_size=<span class="number">7</span>, stride=<span class="number">2</span>, padding=<span class="number">3</span>),</span><br><span class="line">    nn.BatchNorm2d(<span class="number">64</span>), nn.ReLU(),</span><br><span class="line">    nn.MaxPool2d(kernel_size=<span class="number">3</span>, stride=<span class="number">2</span>, padding=<span class="number">1</span>))</span><br><span class="line"><span class="comment"># num_channelsä¸ºå½“å‰çš„é€šé“æ•°</span></span><br><span class="line">num_channels, growth_rate = <span class="number">64</span>, <span class="number">32</span></span><br><span class="line">num_convs_in_dense_blocks = [<span class="number">4</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">4</span>]</span><br><span class="line">blks = []</span><br><span class="line"><span class="keyword">for</span> i, num_convs <span class="keyword">in</span> <span class="built_in">enumerate</span>(num_convs_in_dense_blocks):</span><br><span class="line">    blks.append(DenseBlock(num_convs, num_channels, growth_rate))</span><br><span class="line">    <span class="comment"># ä¸Šä¸€ä¸ªç¨ å¯†å—çš„è¾“å‡ºé€šé“æ•°</span></span><br><span class="line">    num_channels += num_convs * growth_rate</span><br><span class="line">    <span class="comment"># åœ¨ç¨ å¯†å—ä¹‹é—´æ·»åŠ ä¸€ä¸ªè½¬æ¢å±‚ï¼Œä½¿é€šé“æ•°é‡å‡åŠ</span></span><br><span class="line">    <span class="keyword">if</span> i != <span class="built_in">len</span>(num_convs_in_dense_blocks) - <span class="number">1</span>:</span><br><span class="line">        blks.append(transition_block(num_channels, num_channels // <span class="number">2</span>))</span><br><span class="line">        num_channels = num_channels // <span class="number">2</span></span><br><span class="line">net = nn.Sequential(</span><br><span class="line">    b1, *blks,</span><br><span class="line">    nn.BatchNorm2d(num_channels), nn.ReLU(),</span><br><span class="line">    nn.AdaptiveAvgPool2d((<span class="number">1</span>, <span class="number">1</span>)),</span><br><span class="line">    nn.Flatten(),</span><br><span class="line">    nn.Linear(num_channels, <span class="number">10</span>))</span><br></pre></td></tr></table></figure><h3 id="U-Net"><a href="#U-Net" class="headerlink" title="U-Net"></a>U-Net</h3><p><img data-src="https://s2.loli.net/2024/06/12/PIiVxGL71WYtqCy.png" alt="image-20240612201025297"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot; Parts of the U-Net model &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torch.nn <span class="keyword">as</span> nn</span><br><span class="line"><span class="keyword">import</span> torch.nn.functional <span class="keyword">as</span> F</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DoubleConv</span>(<span class="params">nn.Module</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;(convolution =&gt; [BN] =&gt; ReLU) * 2&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, in_channels, out_channels, mid_channels=<span class="literal">None</span></span>):</span></span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> mid_channels:</span><br><span class="line">            mid_channels = out_channels</span><br><span class="line">        self.double_conv = nn.Sequential(</span><br><span class="line">            nn.Conv2d(in_channels, mid_channels, kernel_size=<span class="number">3</span>, padding=<span class="number">1</span>, bias=<span class="literal">False</span>),</span><br><span class="line">            nn.BatchNorm2d(mid_channels),</span><br><span class="line">            nn.ReLU(inplace=<span class="literal">True</span>),</span><br><span class="line">            nn.Conv2d(mid_channels, out_channels, kernel_size=<span class="number">3</span>, padding=<span class="number">1</span>, bias=<span class="literal">False</span>),</span><br><span class="line">            nn.BatchNorm2d(out_channels),</span><br><span class="line">            nn.ReLU(inplace=<span class="literal">True</span>)</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span>(<span class="params">self, x</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.double_conv(x)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Down</span>(<span class="params">nn.Module</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;Downscaling with maxpool then double conv&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, in_channels, out_channels</span>):</span></span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        self.maxpool_conv = nn.Sequential(</span><br><span class="line">            nn.MaxPool2d(<span class="number">2</span>),</span><br><span class="line">            DoubleConv(in_channels, out_channels)</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span>(<span class="params">self, x</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.maxpool_conv(x)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Up</span>(<span class="params">nn.Module</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;Upscaling then double conv&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, in_channels, out_channels, bilinear=<span class="literal">True</span></span>):</span></span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># if bilinear, use the normal convolutions to reduce the number of channels</span></span><br><span class="line">        <span class="keyword">if</span> bilinear:</span><br><span class="line">            self.up = nn.Upsample(scale_factor=<span class="number">2</span>, mode=<span class="string">&#x27;bilinear&#x27;</span>, align_corners=<span class="literal">True</span>)</span><br><span class="line">            self.conv = DoubleConv(in_channels, out_channels, in_channels // <span class="number">2</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.up = nn.ConvTranspose2d(in_channels, in_channels // <span class="number">2</span>, kernel_size=<span class="number">2</span>, stride=<span class="number">2</span>)</span><br><span class="line">            self.conv = DoubleConv(in_channels, out_channels)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span>(<span class="params">self, x1, x2</span>):</span></span><br><span class="line">        x1 = self.up(x1)</span><br><span class="line">        <span class="comment"># input is CHW</span></span><br><span class="line">        diffY = x2.size()[<span class="number">2</span>] - x1.size()[<span class="number">2</span>]</span><br><span class="line">        diffX = x2.size()[<span class="number">3</span>] - x1.size()[<span class="number">3</span>]</span><br><span class="line"></span><br><span class="line">        x1 = F.pad(x1, [diffX // <span class="number">2</span>, diffX - diffX // <span class="number">2</span>,</span><br><span class="line">                        diffY // <span class="number">2</span>, diffY - diffY // <span class="number">2</span>])</span><br><span class="line"></span><br><span class="line">        x = torch.cat([x2, x1], dim=<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">return</span> self.conv(x)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OutConv</span>(<span class="params">nn.Module</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, in_channels, out_channels</span>):</span></span><br><span class="line">        <span class="built_in">super</span>(OutConv, self).__init__()</span><br><span class="line">        self.conv = nn.Conv2d(in_channels, out_channels, kernel_size=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span>(<span class="params">self, x</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.conv(x)</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UNet</span>(<span class="params">nn.Module</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, n_channels, n_classes, bilinear=<span class="literal">False</span></span>):</span></span><br><span class="line">        <span class="built_in">super</span>(UNet, self).__init__()</span><br><span class="line">        self.n_channels = n_channels</span><br><span class="line">        self.n_classes = n_classes</span><br><span class="line">        self.bilinear = bilinear</span><br><span class="line"></span><br><span class="line">        self.inc = (DoubleConv(n_channels, <span class="number">64</span>))</span><br><span class="line">        self.down1 = (Down(<span class="number">64</span>, <span class="number">128</span>))</span><br><span class="line">        self.down2 = (Down(<span class="number">128</span>, <span class="number">256</span>))</span><br><span class="line">        self.down3 = (Down(<span class="number">256</span>, <span class="number">512</span>))</span><br><span class="line">        factor = <span class="number">2</span> <span class="keyword">if</span> bilinear <span class="keyword">else</span> <span class="number">1</span></span><br><span class="line">        self.down4 = (Down(<span class="number">512</span>, <span class="number">1024</span> // factor))</span><br><span class="line">        self.up1 = (Up(<span class="number">1024</span>, <span class="number">512</span> // factor, bilinear))</span><br><span class="line">        self.up2 = (Up(<span class="number">512</span>, <span class="number">256</span> // factor, bilinear))</span><br><span class="line">        self.up3 = (Up(<span class="number">256</span>, <span class="number">128</span> // factor, bilinear))</span><br><span class="line">        self.up4 = (Up(<span class="number">128</span>, <span class="number">64</span>, bilinear))</span><br><span class="line">        self.outc = (OutConv(<span class="number">64</span>, n_classes))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span>(<span class="params">self, x</span>):</span></span><br><span class="line">        x1 = self.inc(x)</span><br><span class="line">        x2 = self.down1(x1)</span><br><span class="line">        x3 = self.down2(x2)</span><br><span class="line">        x4 = self.down3(x3)</span><br><span class="line">        x5 = self.down4(x4)</span><br><span class="line">        x = self.up1(x5, x4)</span><br><span class="line">        x = self.up2(x, x3)</span><br><span class="line">        x = self.up3(x, x2)</span><br><span class="line">        x = self.up4(x, x1)</span><br><span class="line">        logits = self.outc(x)</span><br><span class="line">        <span class="keyword">return</span> logits</span><br></pre></td></tr></table></figure><h3 id="SSD"><a href="#SSD" class="headerlink" title="SSD"></a>SSD</h3><p><img data-src="https://s2.loli.net/2024/06/12/XNfnA8pBt7cSZrw.png" alt="image-20240612223108822"  /></p><p><a href="https://zh.d2l.ai/chapter_computer-vision/ssd.html#id9">13.7. å•å‘å¤šæ¡†æ£€æµ‹ï¼ˆSSDï¼‰ â€” åŠ¨æ‰‹å­¦æ·±åº¦å­¦ä¹  2.0.0 documentation (d2l.ai)</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#  #!/usr/bin/env python</span></span><br><span class="line"><span class="comment">#  -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="comment">#  Copyleft (C) 2024 proanimer, Inc. All Rights Reserved</span></span><br><span class="line"><span class="comment">#   author:proanimer</span></span><br><span class="line"><span class="comment">#   createTime:2024/6/12 ä¸‹åˆ10:42</span></span><br><span class="line"><span class="comment">#   lastModifiedTime:2024/6/12 ä¸‹åˆ10:42</span></span><br><span class="line"><span class="comment">#   file:SSD.py</span></span><br><span class="line"><span class="comment">#   software: classicNets</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torch.nn <span class="keyword">as</span> nn</span><br><span class="line"><span class="keyword">from</span> torchvision.models <span class="keyword">import</span> vgg19</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SSD</span>(<span class="params">nn.Module</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        vgg = vgg19(pretrained=<span class="literal">True</span>)</span><br><span class="line">        vgg.<span class="built_in">eval</span>()</span><br><span class="line">        self.conv = vgg.features</span><br><span class="line">        self.conv1 = nn.Conv2d(<span class="number">512</span>, <span class="number">1024</span>, <span class="number">3</span>)</span><br><span class="line">        self.conv2 = nn.Conv2d(<span class="number">1024</span>, <span class="number">1024</span>, <span class="number">1</span>)</span><br><span class="line">        self.conv3 = nn.Sequential(</span><br><span class="line">            nn.Conv2d(<span class="number">1024</span>, <span class="number">256</span>, <span class="number">1</span>),</span><br><span class="line">            nn.Conv2d(<span class="number">256</span>, <span class="number">512</span>, <span class="number">3</span>)</span><br><span class="line">        )</span><br><span class="line">        self.conv4 = nn.Sequential(</span><br><span class="line">            nn.Conv2d(<span class="number">512</span>, <span class="number">128</span>, <span class="number">1</span>),</span><br><span class="line">            nn.Conv2d(<span class="number">128</span>, <span class="number">256</span>, <span class="number">3</span>)</span><br><span class="line">        )</span><br><span class="line">        self.conv5 = nn.Sequential(</span><br><span class="line">            nn.Conv2d(<span class="number">256</span>, <span class="number">128</span>, <span class="number">1</span>),</span><br><span class="line">            nn.Conv2d(<span class="number">128</span>, <span class="number">256</span>, <span class="number">3</span>)</span><br><span class="line">        )</span><br><span class="line">        self.conv6 = nn.Sequential(</span><br><span class="line">            nn.Conv2d(<span class="number">256</span>, <span class="number">128</span>, <span class="number">1</span>),</span><br><span class="line">            nn.Conv2d(<span class="number">128</span>, <span class="number">256</span>, <span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span>(<span class="params">self, x</span>):</span></span><br><span class="line">        feat_1 = self.conv(x)</span><br><span class="line">        feat = self.conv1(feat_1)</span><br><span class="line">        feat_2 = self.conv2(feat)</span><br><span class="line">        feat_3 = self.conv3(feat_2)</span><br><span class="line">        feat_4 = self.conv4(feat_3)</span><br><span class="line">        feat_5 = self.conv5(feat_4)</span><br><span class="line">        feat_6 = self.conv6(feat_5)</span><br><span class="line">        <span class="keyword">return</span> feat_1, feat_2, feat_3, feat_4, feat_5, feat_6</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="Feature-Pyramid-Networks-for-Object-Detection"><a href="#Feature-Pyramid-Networks-for-Object-Detection" class="headerlink" title="Feature Pyramid Networks for Object Detection"></a>Feature Pyramid Networks for Object Detection</h3><p><img data-src="https://s2.loli.net/2024/06/12/vBQ5meLa21hNuTW.png" alt="image-20240612201222802"></p><p><img data-src="https://upload-images.jianshu.io/upload_images/14932861-4a872d74db7a93ec.png?imageMogr2/auto-orient/strip|imageView2/2/w/760/format/webp" alt="img" style="zoom:33%;" /></p><p>æœ€åä¼šå°†ä¸åŒå°ºåº¦å¾—åˆ°çš„ç»“æœ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#  #!/usr/bin/env python</span></span><br><span class="line"><span class="comment">#  -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="comment">#  Copyleft (C) 2024 proanimer, Inc. All Rights Reserved</span></span><br><span class="line"><span class="comment">#   author:proanimer</span></span><br><span class="line"><span class="comment">#   createTime:2024/6/12 ä¸‹åˆ9:13</span></span><br><span class="line"><span class="comment">#   lastModifiedTime:2024/6/12 ä¸‹åˆ9:13</span></span><br><span class="line"><span class="comment">#   file:fpn.py</span></span><br><span class="line"><span class="comment">#   software: classicNets</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> torch.nn <span class="keyword">as</span> nn</span><br><span class="line"><span class="keyword">import</span> torch.nn.functional <span class="keyword">as</span> F</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">##å…ˆå®šä¹‰ResNetåŸºæœ¬ç±»ï¼Œæˆ–è€…å¯ä»¥è¯´ResNetçš„åŸºæœ¬ç –å—</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Bottleneck</span>(<span class="params">nn.Module</span>):</span></span><br><span class="line">    expansion = <span class="number">4</span>  <span class="comment">##é€šé“å€å¢æ•°</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, in_planes, planes, stride=<span class="number">1</span>, downsample=<span class="literal">None</span></span>):</span></span><br><span class="line">        <span class="built_in">super</span>(Bottleneck, self).__init__()</span><br><span class="line">        self.bottleneck = nn.Sequential(</span><br><span class="line">            nn.Conv2d(in_planes, planes, <span class="number">1</span>, bias=<span class="literal">False</span>),</span><br><span class="line">            nn.BatchNorm2d(planes),</span><br><span class="line">            nn.ReLU(inplace=<span class="literal">True</span>),</span><br><span class="line">            nn.Conv2d(planes, planes, <span class="number">3</span>, stride, <span class="number">1</span>, bias=<span class="literal">False</span>),</span><br><span class="line">            nn.BatchNorm2d(planes),</span><br><span class="line">            nn.ReLU(inplace=<span class="literal">True</span>),</span><br><span class="line">            nn.Conv2d(planes, self.expansion * planes, <span class="number">1</span>, bias=<span class="literal">False</span>),</span><br><span class="line">            nn.BatchNorm2d(self.expansion * planes),</span><br><span class="line">        )</span><br><span class="line">        self.relu = nn.ReLU(inplace=<span class="literal">True</span>)</span><br><span class="line">        self.downsample = downsample</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span>(<span class="params">self, x</span>):</span></span><br><span class="line">        identity = x</span><br><span class="line">        out = self.bottleneck(x)</span><br><span class="line">        <span class="keyword">if</span> self.downsample <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            identity = self.downsample(x)</span><br><span class="line">        out += identity</span><br><span class="line">        out = self.relu(out)</span><br><span class="line">        <span class="keyword">return</span> out</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">##FPNç±»</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FPN</span>(<span class="params">nn.Module</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, layers</span>):</span></span><br><span class="line">        <span class="built_in">super</span>(FPN, self).__init__()</span><br><span class="line">        self.inplanes = <span class="number">64</span></span><br><span class="line">        <span class="comment">###ä¸‹é¢å››å¥ä»£ç ä»£è¡¨å¤„ç†è¾“å…¥çš„C1æ¨¡å—--å¯¹åº”åšå®¢ä¸­çš„å›¾</span></span><br><span class="line">        self.conv1 = nn.Conv2d(<span class="number">3</span>, <span class="number">64</span>, <span class="number">7</span>, <span class="number">2</span>, <span class="number">3</span>, bias=<span class="literal">False</span>)</span><br><span class="line">        self.bn1 = nn.BatchNorm2d(<span class="number">64</span>)</span><br><span class="line">        self.relu = nn.ReLU(inplace=<span class="literal">True</span>)</span><br><span class="line">        self.maxpool = nn.MaxPool2d(<span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>)</span><br><span class="line">        <span class="comment">###æ­å»ºè‡ªä¸‹è€Œä¸Šçš„C2,C3,C4,C5</span></span><br><span class="line">        self.layer1 = self._make_layer(<span class="number">64</span>, layers[<span class="number">0</span>])</span><br><span class="line">        self.layer2 = self._make_layer(<span class="number">128</span>, layers[<span class="number">1</span>], <span class="number">2</span>)</span><br><span class="line">        self.layer3 = self._make_layer(<span class="number">256</span>, layers[<span class="number">2</span>], <span class="number">2</span>)</span><br><span class="line">        self.layer4 = self._make_layer(<span class="number">512</span>, layers[<span class="number">3</span>], <span class="number">2</span>)</span><br><span class="line">        <span class="comment">###å®šä¹‰toplayerå±‚ï¼Œå¯¹C5å‡å°‘é€šé“æ•°ï¼Œå¾—åˆ°P5</span></span><br><span class="line">        self.toplayer = nn.Conv2d(<span class="number">2048</span>, <span class="number">256</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>)</span><br><span class="line">        <span class="comment">###ä»£è¡¨3*3çš„å·ç§¯èåˆï¼Œç›®çš„æ˜¯æ¶ˆé™¤ä¸Šé‡‡æ ·è¿‡ç¨‹å¸¦æ¥çš„é‡å æ•ˆåº”ï¼Œä»¥ç”Ÿæˆæœ€ç»ˆçš„ç‰¹å¾å›¾ã€‚</span></span><br><span class="line">        self.smooth1 = nn.Conv2d(<span class="number">256</span>, <span class="number">256</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line">        self.smooth2 = nn.Conv2d(<span class="number">256</span>, <span class="number">256</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line">        self.smooth3 = nn.Conv2d(<span class="number">256</span>, <span class="number">256</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line">        <span class="comment">###æ¨ªå‘è¿æ¥ï¼Œä¿è¯é€šé“æ•°ç›®ç›¸åŒ</span></span><br><span class="line">        self.latlayer1 = nn.Conv2d(<span class="number">1024</span>, <span class="number">256</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>)</span><br><span class="line">        self.latlayer2 = nn.Conv2d(<span class="number">512</span>, <span class="number">256</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>)</span><br><span class="line">        self.latlayer3 = nn.Conv2d(<span class="number">256</span>, <span class="number">256</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">##ä½œç”¨ï¼šæ„å»ºC2-C5ç –å—ï¼Œæ³¨æ„strideä¸º1å’Œ2çš„åŒºåˆ«ï¼šå¾—åˆ°C2æ²¡æœ‰ç»å†ä¸‹é‡‡æ ·</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_make_layer</span>(<span class="params">self, planes, blocks, stride=<span class="number">1</span></span>):</span></span><br><span class="line">        downsample = <span class="literal">None</span></span><br><span class="line">        <span class="keyword">if</span> stride != <span class="number">1</span> <span class="keyword">or</span> self.inplanes != Bottleneck.expansion * planes:</span><br><span class="line">            downsample = nn.Sequential(</span><br><span class="line">                nn.Conv2d(self.inplanes, Bottleneck.expansion * planes, <span class="number">1</span>, stride, bias=<span class="literal">False</span>),</span><br><span class="line">                nn.BatchNorm2d(Bottleneck.expansion * planes)</span><br><span class="line">            )</span><br><span class="line">        <span class="comment">###åˆå§‹åŒ–éœ€è¦ä¸€ä¸ªlistï¼Œä»£è¡¨å·¦ä¾§ç½‘ç»œResNetæ¯ä¸€ä¸ªé˜¶æ®µçš„Bottleneckçš„æ•°é‡</span></span><br><span class="line">        layers = []</span><br><span class="line">        layers.append(Bottleneck(self.inplanes, planes, stride, downsample))</span><br><span class="line">        self.inplanes = planes * Bottleneck.expansion</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, blocks):</span><br><span class="line">            layers.append(Bottleneck(self.inplanes, planes))</span><br><span class="line">        <span class="keyword">return</span> nn.Sequential(*layers)</span><br><span class="line"></span><br><span class="line">    <span class="comment">###è‡ªä¸Šè€Œä¸‹çš„ä¸Šé‡‡æ ·æ¨¡å—</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_upsample_add</span>(<span class="params">self, x, y</span>):</span></span><br><span class="line">        _, _, H, W = y.shape</span><br><span class="line">        <span class="keyword">return</span> F.upsample(x, size=(H, W), mode=<span class="string">&#x27;bilinear&#x27;</span>) + y</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span>(<span class="params">self, x</span>):</span></span><br><span class="line">        <span class="comment">###è‡ªä¸‹è€Œä¸Š</span></span><br><span class="line">        c1 = self.maxpool(self.relu(self.bn1(self.conv1(x))))</span><br><span class="line">        c2 = self.layer1(c1)</span><br><span class="line">        c3 = self.layer2(c2)</span><br><span class="line">        c4 = self.layer3(c3)</span><br><span class="line">        c5 = self.layer4(c4)</span><br><span class="line">        <span class="comment">###è‡ªä¸Šè€Œä¸‹</span></span><br><span class="line">        p5 = self.toplayer(c5)</span><br><span class="line">        p4 = self._upsample_add(p5, self.latlayer1(c4))</span><br><span class="line">        p3 = self._upsample_add(p4, self.latlayer2(c3))</span><br><span class="line">        p2 = self._upsample_add(p3, self.latlayer3(c2))</span><br><span class="line">        <span class="comment">###å·ç§¯èåˆï¼Œå¹³æ»‘å¤„ç†</span></span><br><span class="line">        p4 = self.smooth1(p4)</span><br><span class="line">        p3 = self.smooth2(p3)</span><br><span class="line">        p2 = self.smooth3(p2)</span><br><span class="line">        <span class="keyword">return</span> p2, p3, p4, p5</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img data-src="https://img-blog.csdnimg.cn/img_convert/91f15dc3b7067e6ec693302399e05b0b.png" alt="img"></p><h3 id="Deformable-Conv"><a href="#Deformable-Conv" class="headerlink" title="Deformable Conv"></a>Deformable Conv</h3><p>å¯å˜å½¢çš„å·ç§¯,è¿˜æœ‰å¯å˜å½¢çš„attention. å³æ’å³ç”¨ç±»å‹.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DeformConv2d</span>(<span class="params">nn.Module</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, inc, outc, kernel_size=<span class="number">3</span>, padding=<span class="number">1</span>, stride=<span class="number">1</span>, bias=<span class="literal">None</span>, modulation=<span class="literal">False</span></span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Args:</span></span><br><span class="line"><span class="string">            modulation (bool, optional): If True, Modulated Defomable Convolution (Deformable ConvNets v2).</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="built_in">super</span>(DeformConv2d, self).__init__()</span><br><span class="line">        self.kernel_size = kernel_size</span><br><span class="line">        self.padding = padding</span><br><span class="line">        self.stride = stride</span><br><span class="line">        self.zero_padding = nn.ZeroPad2d(padding)</span><br><span class="line">        <span class="comment"># convåˆ™æ˜¯å®é™…è¿›è¡Œçš„å·ç§¯æ“ä½œï¼Œæ³¨æ„è¿™é‡Œæ­¥é•¿è®¾ç½®ä¸ºå·ç§¯æ ¸å¤§å°ï¼Œå› ä¸ºä¸è¯¥å·ç§¯æ ¸è¿›è¡Œå·ç§¯æ“ä½œçš„ç‰¹å¾å›¾æ˜¯ç”±è¾“å‡ºç‰¹å¾å›¾ä¸­æ¯ä¸ªç‚¹æ‰©å±•ä¸ºå…¶å¯¹åº”å·ç§¯æ ¸é‚£ä¹ˆå¤šä¸ªç‚¹åç”Ÿæˆçš„ã€‚</span></span><br><span class="line">        self.conv = nn.Conv2d(inc, outc, kernel_size=kernel_size, stride=kernel_size, bias=bias)</span><br><span class="line">        <span class="comment"># p_convæ˜¯ç”Ÿæˆoffsetsæ‰€ä½¿ç”¨çš„å·ç§¯ï¼Œè¾“å‡ºé€šé“æ•°ä¸ºå·ç§¯æ ¸å°ºå¯¸çš„å¹³æ–¹çš„2å€ï¼Œä»£è¡¨å¯¹åº”å·ç§¯æ ¸æ¯ä¸ªä½ç½®æ¨ªçºµåæ ‡éƒ½æœ‰åç§»é‡ã€‚</span></span><br><span class="line">        self.p_conv = nn.Conv2d(inc, <span class="number">2</span>*kernel_size*kernel_size, kernel_size=<span class="number">3</span>, padding=<span class="number">1</span>, stride=stride)</span><br><span class="line">        nn.init.constant_(self.p_conv.weight, <span class="number">0</span>)</span><br><span class="line">        self.p_conv.register_backward_hook(self._set_lr)</span><br><span class="line"> </span><br><span class="line">        self.modulation = modulation <span class="comment"># modulationæ˜¯å¯é€‰å‚æ•°,è‹¥è®¾ç½®ä¸ºTrue,é‚£ä¹ˆåœ¨è¿›è¡Œå·ç§¯æ“ä½œæ—¶,å¯¹åº”å·ç§¯æ ¸çš„æ¯ä¸ªä½ç½®éƒ½ä¼šåˆ†é…ä¸€ä¸ªæƒé‡ã€‚</span></span><br><span class="line">        <span class="keyword">if</span> modulation:</span><br><span class="line">            self.m_conv = nn.Conv2d(inc, kernel_size*kernel_size, kernel_size=<span class="number">3</span>, padding=<span class="number">1</span>, stride=stride)</span><br><span class="line">            nn.init.constant_(self.m_conv.weight, <span class="number">0</span>)</span><br><span class="line">            self.m_conv.register_backward_hook(self._set_lr)</span><br><span class="line"> </span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_set_lr</span>(<span class="params">module, grad_input, grad_output</span>):</span></span><br><span class="line">        grad_input = (grad_input[i] * <span class="number">0.1</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(grad_input)))</span><br><span class="line">        grad_output = (grad_output[i] * <span class="number">0.1</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(grad_output)))</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span>(<span class="params">self, x</span>):</span></span><br><span class="line">        offset = self.p_conv(x)</span><br><span class="line">        <span class="keyword">if</span> self.modulation:</span><br><span class="line">            m = torch.sigmoid(self.m_conv(x))</span><br><span class="line"> </span><br><span class="line">        dtype = offset.data.<span class="built_in">type</span>()</span><br><span class="line">        ks = self.kernel_size</span><br><span class="line">        N = offset.size(<span class="number">1</span>) // <span class="number">2</span></span><br><span class="line"> </span><br><span class="line">        <span class="keyword">if</span> self.padding:</span><br><span class="line">            x = self.zero_padding(x)</span><br><span class="line"> </span><br><span class="line">        <span class="comment"># (b, 2N, h, w)</span></span><br><span class="line">        p = self._get_p(offset, dtype)</span><br><span class="line"> </span><br><span class="line">        <span class="comment"># (b, h, w, 2N)</span></span><br><span class="line">        p = p.contiguous().permute(<span class="number">0</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>)</span><br><span class="line">        q_lt = p.detach().floor()</span><br><span class="line">        q_rb = q_lt + <span class="number">1</span></span><br><span class="line"> </span><br><span class="line">        q_lt = torch.cat([torch.clamp(q_lt[..., :N], <span class="number">0</span>, x.size(<span class="number">2</span>)-<span class="number">1</span>), torch.clamp(q_lt[..., N:], <span class="number">0</span>, x.size(<span class="number">3</span>)-<span class="number">1</span>)], dim=-<span class="number">1</span>).long()</span><br><span class="line">        q_rb = torch.cat([torch.clamp(q_rb[..., :N], <span class="number">0</span>, x.size(<span class="number">2</span>)-<span class="number">1</span>), torch.clamp(q_rb[..., N:], <span class="number">0</span>, x.size(<span class="number">3</span>)-<span class="number">1</span>)], dim=-<span class="number">1</span>).long()</span><br><span class="line">        q_lb = torch.cat([q_lt[..., :N], q_rb[..., N:]], dim=-<span class="number">1</span>)</span><br><span class="line">        q_rt = torch.cat([q_rb[..., :N], q_lt[..., N:]], dim=-<span class="number">1</span>)</span><br><span class="line"> </span><br><span class="line">        <span class="comment"># clip p</span></span><br><span class="line">        p = torch.cat([torch.clamp(p[..., :N], <span class="number">0</span>, x.size(<span class="number">2</span>)-<span class="number">1</span>), torch.clamp(p[..., N:], <span class="number">0</span>, x.size(<span class="number">3</span>)-<span class="number">1</span>)], dim=-<span class="number">1</span>)</span><br><span class="line"> </span><br><span class="line">        <span class="comment"># bilinear kernel (b, h, w, N)</span></span><br><span class="line">        g_lt = (<span class="number">1</span> + (q_lt[..., :N].type_as(p) - p[..., :N])) * (<span class="number">1</span> + (q_lt[..., N:].type_as(p) - p[..., N:]))</span><br><span class="line">        g_rb = (<span class="number">1</span> - (q_rb[..., :N].type_as(p) - p[..., :N])) * (<span class="number">1</span> - (q_rb[..., N:].type_as(p) - p[..., N:]))</span><br><span class="line">        g_lb = (<span class="number">1</span> + (q_lb[..., :N].type_as(p) - p[..., :N])) * (<span class="number">1</span> - (q_lb[..., N:].type_as(p) - p[..., N:]))</span><br><span class="line">        g_rt = (<span class="number">1</span> - (q_rt[..., :N].type_as(p) - p[..., :N])) * (<span class="number">1</span> + (q_rt[..., N:].type_as(p) - p[..., N:]))</span><br><span class="line"> </span><br><span class="line">        <span class="comment"># (b, c, h, w, N)</span></span><br><span class="line">        x_q_lt = self._get_x_q(x, q_lt, N)</span><br><span class="line">        x_q_rb = self._get_x_q(x, q_rb, N)</span><br><span class="line">        x_q_lb = self._get_x_q(x, q_lb, N)</span><br><span class="line">        x_q_rt = self._get_x_q(x, q_rt, N)</span><br><span class="line"> </span><br><span class="line">        <span class="comment"># (b, c, h, w, N)</span></span><br><span class="line">        x_offset = g_lt.unsqueeze(dim=<span class="number">1</span>) * x_q_lt + \</span><br><span class="line">                   g_rb.unsqueeze(dim=<span class="number">1</span>) * x_q_rb + \</span><br><span class="line">                   g_lb.unsqueeze(dim=<span class="number">1</span>) * x_q_lb + \</span><br><span class="line">                   g_rt.unsqueeze(dim=<span class="number">1</span>) * x_q_rt</span><br><span class="line"> </span><br><span class="line">        <span class="comment"># modulation</span></span><br><span class="line">        <span class="keyword">if</span> self.modulation:</span><br><span class="line">            m = m.contiguous().permute(<span class="number">0</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>)</span><br><span class="line">            m = m.unsqueeze(dim=<span class="number">1</span>)</span><br><span class="line">            m = torch.cat([m <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(x_offset.size(<span class="number">1</span>))], dim=<span class="number">1</span>)</span><br><span class="line">            x_offset *= m</span><br><span class="line"> </span><br><span class="line">        x_offset = self._reshape_x_offset(x_offset, ks)</span><br><span class="line">        out = self.conv(x_offset)</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">return</span> out</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_get_p_n</span>(<span class="params">self, N, dtype</span>):</span></span><br><span class="line">        <span class="comment"># ç”±äºå·ç§¯æ ¸ä¸­å¿ƒç‚¹ä½ç½®æ˜¯å…¶å°ºå¯¸çš„ä¸€åŠï¼Œäºæ˜¯ä¸­å¿ƒç‚¹å‘å·¦ï¼ˆä¸Šï¼‰æ–¹å‘ç§»åŠ¨å°ºå¯¸çš„ä¸€åŠå°±å¾—åˆ°èµ·å§‹ç‚¹ï¼Œå‘å³ï¼ˆä¸‹ï¼‰æ–¹å‘ç§»åŠ¨å¦ä¸€åŠå°±å¾—åˆ°ç»ˆæ­¢ç‚¹</span></span><br><span class="line">        p_n_x, p_n_y = torch.meshgrid(</span><br><span class="line">            torch.arange(-(self.kernel_size-<span class="number">1</span>)//<span class="number">2</span>, (self.kernel_size-<span class="number">1</span>)//<span class="number">2</span>+<span class="number">1</span>),</span><br><span class="line">            torch.arange(-(self.kernel_size-<span class="number">1</span>)//<span class="number">2</span>, (self.kernel_size-<span class="number">1</span>)//<span class="number">2</span>+<span class="number">1</span>))</span><br><span class="line">        <span class="comment"># (2N, 1)</span></span><br><span class="line">        p_n = torch.cat([torch.flatten(p_n_x), torch.flatten(p_n_y)], <span class="number">0</span>)</span><br><span class="line">        p_n = p_n.view(<span class="number">1</span>, <span class="number">2</span>*N, <span class="number">1</span>, <span class="number">1</span>).<span class="built_in">type</span>(dtype)</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">return</span> p_n</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_get_p_0</span>(<span class="params">self, h, w, N, dtype</span>):</span></span><br><span class="line">        <span class="comment"># p0_yã€p0_xå°±æ˜¯è¾“å‡ºç‰¹å¾å›¾æ¯ç‚¹æ˜ å°„åˆ°è¾“å…¥ç‰¹å¾å›¾ä¸Šçš„çºµã€æ¨ªåæ ‡å€¼ã€‚</span></span><br><span class="line">        p_0_x, p_0_y = torch.meshgrid(</span><br><span class="line">            torch.arange(<span class="number">1</span>, h*self.stride+<span class="number">1</span>, self.stride),</span><br><span class="line">            torch.arange(<span class="number">1</span>, w*self.stride+<span class="number">1</span>, self.stride))</span><br><span class="line">        </span><br><span class="line">        p_0_x = torch.flatten(p_0_x).view(<span class="number">1</span>, <span class="number">1</span>, h, w).repeat(<span class="number">1</span>, N, <span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line">        p_0_y = torch.flatten(p_0_y).view(<span class="number">1</span>, <span class="number">1</span>, h, w).repeat(<span class="number">1</span>, N, <span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line">        p_0 = torch.cat([p_0_x, p_0_y], <span class="number">1</span>).<span class="built_in">type</span>(dtype)</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">return</span> p_0</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># è¾“å‡ºç‰¹å¾å›¾ä¸Šæ¯ç‚¹ï¼ˆå¯¹åº”å·ç§¯æ ¸ä¸­å¿ƒï¼‰åŠ ä¸Šå…¶å¯¹åº”å·ç§¯æ ¸æ¯ä¸ªä½ç½®çš„ç›¸å¯¹ï¼ˆæ¨ªã€çºµï¼‰åæ ‡åå†åŠ ä¸Šè‡ªå­¦ä¹ çš„ï¼ˆæ¨ªã€çºµåæ ‡ï¼‰åç§»é‡ã€‚</span></span><br><span class="line">    <span class="comment"># p0å°±æ˜¯å°†è¾“å‡ºç‰¹å¾å›¾æ¯ç‚¹å¯¹åº”åˆ°å·ç§¯æ ¸ä¸­å¿ƒï¼Œç„¶åæ˜ å°„åˆ°è¾“å…¥ç‰¹å¾å›¾ä¸­çš„ä½ç½®ï¼›</span></span><br><span class="line">    <span class="comment"># pnåˆ™æ˜¯p0å¯¹åº”å·ç§¯æ ¸æ¯ä¸ªä½ç½®çš„ç›¸å¯¹åæ ‡ï¼›</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_get_p</span>(<span class="params">self, offset, dtype</span>):</span></span><br><span class="line">        N, h, w = offset.size(<span class="number">1</span>)//<span class="number">2</span>, offset.size(<span class="number">2</span>), offset.size(<span class="number">3</span>)</span><br><span class="line"> </span><br><span class="line">        <span class="comment"># (1, 2N, 1, 1)</span></span><br><span class="line">        p_n = self._get_p_n(N, dtype)</span><br><span class="line">        <span class="comment"># (1, 2N, h, w)</span></span><br><span class="line">        p_0 = self._get_p_0(h, w, N, dtype)</span><br><span class="line">        p = p_0 + p_n + offset</span><br><span class="line">        <span class="keyword">return</span> p</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_get_x_q</span>(<span class="params">self, x, q, N</span>):</span></span><br><span class="line">        <span class="comment"># è®¡ç®—åŒçº¿æ€§æ’å€¼ç‚¹çš„4é‚»åŸŸç‚¹å¯¹åº”çš„æƒé‡</span></span><br><span class="line">        b, h, w, _ = q.size()</span><br><span class="line">        padded_w = x.size(<span class="number">3</span>)</span><br><span class="line">        c = x.size(<span class="number">1</span>)</span><br><span class="line">        <span class="comment"># (b, c, h*w)</span></span><br><span class="line">        x = x.contiguous().view(b, c, -<span class="number">1</span>)</span><br><span class="line"> </span><br><span class="line">        <span class="comment"># (b, h, w, N)</span></span><br><span class="line">        index = q[..., :N]*padded_w + q[..., N:]  <span class="comment"># offset_x*w + offset_y</span></span><br><span class="line">        <span class="comment"># (b, c, h*w*N)</span></span><br><span class="line">        index = index.contiguous().unsqueeze(dim=<span class="number">1</span>).expand(-<span class="number">1</span>, c, -<span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>).contiguous().view(b, c, -<span class="number">1</span>)</span><br><span class="line"> </span><br><span class="line">        x_offset = x.gather(dim=-<span class="number">1</span>, index=index).contiguous().view(b, c, h, w, N)</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">return</span> x_offset</span><br><span class="line"> </span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_reshape_x_offset</span>(<span class="params">x_offset, ks</span>):</span></span><br><span class="line">        b, c, h, w, N = x_offset.size()</span><br><span class="line">        x_offset = torch.cat([x_offset[..., s:s+ks].contiguous().view(b, c, h, w*ks) <span class="keyword">for</span> s <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, N, ks)], dim=-<span class="number">1</span>)</span><br><span class="line">        x_offset = x_offset.contiguous().view(b, c, h*ks, w*ks)</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">return</span> x_offset</span><br></pre></td></tr></table></figure><p>è¿™äº›æ¨¡å‹ä¸­NiNçš„1x1convä»¥åŠResetNetçš„æ®‹å·®ä½œä¸ºåé¢æ›´å¤æ‚æ¨¡å‹å¸¸ç”¨çš„æ–¹æ³•,æ¯”å¦‚U-Net.è€ŒUNet,FPNè¿™æ ·çš„å¤šå°ºåº¦å’Œæ®‹å·®è¿æ¥åˆåœ¨è®¸å¤šç›®æ ‡æ£€æµ‹ç­‰ä»»åŠ¡ä¸­ä½¿ç”¨.</p><h2 id="RNN-GRU-LSTM"><a href="#RNN-GRU-LSTM" class="headerlink" title="RNN GRU LSTM"></a>RNN GRU LSTM</h2><p><img data-src="https://zh.d2l.ai/_images/rnn.svg" alt="../_images/rnn.svg"></p><p><img data-src="https://zh.d2l.ai/_images/gru-3.svg" alt="../_images/gru-3.svg"></p><p><img data-src="https://zh.d2l.ai/_images/lstm-3.svg" alt="../_images/lstm-3.svg"></p><h1 id="é»‘å¤œå‰çš„å…‰æ˜"><a href="#é»‘å¤œå‰çš„å…‰æ˜" class="headerlink" title="é»‘å¤œå‰çš„å…‰æ˜"></a>é»‘å¤œå‰çš„å…‰æ˜</h1><blockquote><p>åœ¨transformerä¹‹å‰,æˆ‘ä»¬è®¤ä¸ºæ³¡æ²«å³å°†å¹ç ´</p><p><a href="https://www.open-open.com/news/view/448d1219">æå¼€å¤è¯´2018å¹´æ˜¯AIæ³¡æ²«ç ´è£‚ä¹‹å¹´ LeCunç‚¹èµ - æå¼€å¤ - ITä¸šç•Œ - æ·±åº¦å¼€æº (open-open.com)</a></p><p><a href="https://www.thepaper.cn/newsDetail_forward_4103098">åˆ«å¹äº†ï¼ŒAIçš„æ³¡æ²«å¿«è¢«å¹ç ´äº†<em>æ¾æ¹ƒå·Â·æ¹ƒå®¢</em>æ¾æ¹ƒæ–°é—»-The Paper</a></p></blockquote><h2 id="Attention"><a href="#Attention" class="headerlink" title="Attention"></a>Attention</h2><p><img data-src="https://zh.d2l.ai/_images/seq2seq-attention-details.svg" alt="../_images/seq2seq-attention-details.svg"></p><p><img data-src="https://zh.d2l.ai/_images/multi-head-attention.svg" alt="../_images/multi-head-attention.svg"></p><h2 id="Transformer"><a href="#Transformer" class="headerlink" title="Transformer"></a>Transformer</h2><p><img data-src="https://zh.d2l.ai/_images/transformer.svg" alt="../_images/transformer.svg"></p><p><a href="https://nlp.seas.harvard.edu/annotated-transformer/#prelims">The Annotated Transformer (harvard.edu)</a></p><p>ä»å®è§‚è§’åº¦æ¥çœ‹ï¼ŒTransformerçš„ç¼–ç å™¨æ˜¯ç”±å¤šä¸ªç›¸åŒçš„å±‚å åŠ è€Œæˆçš„ï¼Œæ¯ä¸ªå±‚éƒ½æœ‰ä¸¤ä¸ªå­å±‚ï¼ˆå­å±‚è¡¨ç¤ºä¸ºsublayerï¼‰ã€‚ç¬¬ä¸€ä¸ªå­å±‚æ˜¯<em>å¤šå¤´è‡ªæ³¨æ„åŠ›</em>ï¼ˆmulti-head self-attentionï¼‰æ±‡èšï¼›ç¬¬äºŒä¸ªå­å±‚æ˜¯<em>åŸºäºä½ç½®çš„å‰é¦ˆç½‘ç»œ</em>ï¼ˆpositionwise feed-forward networkï¼‰ã€‚å…·ä½“æ¥è¯´ï¼Œåœ¨è®¡ç®—ç¼–ç å™¨çš„è‡ªæ³¨æ„åŠ›æ—¶ï¼ŒæŸ¥è¯¢ã€é”®å’Œå€¼éƒ½æ¥è‡ªå‰ä¸€ä¸ªç¼–ç å™¨å±‚çš„è¾“å‡ºã€‚å—ä¸­æ®‹å·®ç½‘ç»œçš„å¯å‘ï¼Œæ¯ä¸ªå­å±‚éƒ½é‡‡ç”¨äº†<em>æ®‹å·®è¿æ¥</em>ï¼ˆresidual connectionï¼‰ã€‚åœ¨Transformerä¸­ï¼Œå¯¹äºåºåˆ—ä¸­ä»»ä½•ä½ç½®çš„ä»»ä½•è¾“å…¥ğ‘¥âˆˆğ‘…ğ‘‘ï¼Œéƒ½è¦æ±‚æ»¡è¶³sublayer(ğ‘¥)âˆˆğ‘…ğ‘‘ï¼Œä»¥ä¾¿æ®‹å·®è¿æ¥æ»¡è¶³ğ‘¥+sublayer(ğ‘¥)âˆˆğ‘…ğ‘‘ã€‚åœ¨æ®‹å·®è¿æ¥çš„åŠ æ³•è®¡ç®—ä¹‹åï¼Œç´§æ¥ç€åº”ç”¨<em>å±‚è§„èŒƒåŒ–</em>ï¼ˆlayer normalizationï¼‰</p><p>å› æ­¤ï¼Œè¾“å…¥åºåˆ—å¯¹åº”çš„æ¯ä¸ªä½ç½®ï¼ŒTransformerç¼–ç å™¨éƒ½å°†è¾“å‡ºä¸€ä¸ªğ‘‘ç»´è¡¨ç¤ºå‘é‡ã€‚</p><p>Transformerè§£ç å™¨ä¹Ÿæ˜¯ç”±å¤šä¸ªç›¸åŒçš„å±‚å åŠ è€Œæˆçš„ï¼Œå¹¶ä¸”å±‚ä¸­ä½¿ç”¨äº†æ®‹å·®è¿æ¥å’Œå±‚è§„èŒƒåŒ–ã€‚é™¤äº†ç¼–ç å™¨ä¸­æè¿°çš„ä¸¤ä¸ªå­å±‚ä¹‹å¤–ï¼Œè§£ç å™¨è¿˜åœ¨è¿™ä¸¤ä¸ªå­å±‚ä¹‹é—´æ’å…¥äº†ç¬¬ä¸‰ä¸ªå­å±‚ï¼Œç§°ä¸º<em>ç¼–ç å™¨ï¼è§£ç å™¨æ³¨æ„åŠ›</em>ï¼ˆencoder-decoder attentionï¼‰å±‚ã€‚åœ¨ç¼–ç å™¨ï¼è§£ç å™¨æ³¨æ„åŠ›ä¸­ï¼ŒæŸ¥è¯¢æ¥è‡ªå‰ä¸€ä¸ªè§£ç å™¨å±‚çš„è¾“å‡ºï¼Œè€Œé”®å’Œå€¼æ¥è‡ªæ•´ä¸ªç¼–ç å™¨çš„è¾“å‡ºã€‚åœ¨è§£ç å™¨è‡ªæ³¨æ„åŠ›ä¸­ï¼ŒæŸ¥è¯¢ã€é”®å’Œå€¼éƒ½æ¥è‡ªä¸Šä¸€ä¸ªè§£ç å™¨å±‚çš„è¾“å‡ºã€‚ä½†æ˜¯ï¼Œè§£ç å™¨ä¸­çš„æ¯ä¸ªä½ç½®åªèƒ½è€ƒè™‘è¯¥ä½ç½®ä¹‹å‰çš„æ‰€æœ‰ä½ç½®ã€‚è¿™ç§<em>æ©è”½</em>ï¼ˆmaskedï¼‰æ³¨æ„åŠ›ä¿ç•™äº†<em>è‡ªå›å½’</em>ï¼ˆauto-regressiveï¼‰å±æ€§ï¼Œç¡®ä¿é¢„æµ‹ä»…ä¾èµ–äºå·²ç”Ÿæˆçš„è¾“å‡ºè¯å…ƒã€‚</p><blockquote><p>transformerç›®å‰æ˜¯é€šåƒçš„,åœ¨cv,nlp,speechç­‰é¢†åŸŸçš„å„ç§ä»»åŠ¡ä¸Šéƒ½æœ‰å®è·µ</p><p>ä¸‹é¢æ˜¯ä½¿ç”¨transformerçš„é€šç”¨ç›®æ ‡æ£€æµ‹æ–¹æ³•</p></blockquote><h3 id="DETR"><a href="#DETR" class="headerlink" title="DETR"></a>DETR</h3><p><img data-src="https://github.com/facebookresearch/detr/raw/main/.github/DETR.png" alt="DETR"></p><p>ä¸ä¼ ç»Ÿçš„è®¡ç®—æœºè§†è§‰æŠ€æœ¯ä¸åŒï¼ŒDETR å°†ç‰©ä½“æ£€æµ‹ä½œä¸ºä¸€ä¸ªç›´æ¥çš„é›†åˆé¢„æµ‹é—®é¢˜(a direct set prediction problem)æ¥å¤„ç†ã€‚å®ƒç”±ä¸€ä¸ªåŸºäºé›†åˆçš„å…¨å±€æŸå¤±å’Œä¸€ä¸ªå˜æ¢å™¨ç¼–ç å™¨-è§£ç å™¨æ¶æ„ç»„æˆï¼Œå‰è€…é€šè¿‡ä¸¤ç«¯åŒ¹é…å¼ºåˆ¶è¿›è¡Œå”¯ä¸€é¢„æµ‹ã€‚</p><p>ç»™å®šä¸€ä¸ªå›ºå®šçš„å°èŒƒå›´å·²å­¦å¯¹è±¡æŸ¥è¯¢é›†ï¼ŒDETR ä¼šå¯¹å¯¹è±¡å…³ç³»å’Œå…¨å±€å›¾åƒä¸Šä¸‹æ–‡è¿›è¡Œæ¨ç†ï¼Œä»è€Œç›´æ¥å¹¶è¡Œè¾“å‡ºæœ€ç»ˆçš„é¢„æµ‹é›†ã€‚ç”±äºè¿™ç§å¹¶è¡Œæ€§ï¼ŒDETR éå¸¸å¿«é€Ÿé«˜æ•ˆã€‚</p><p><a href="https://colab.research.google.com/github/facebookresearch/detr/blob/colab/notebooks/detr_demo.ipynb#scrollTo=h91rsIPl7tVl">detr_demo.ipynb - Colab (google.com)</a></p><h3 id="Deformable-DETR"><a href="#Deformable-DETR" class="headerlink" title="Deformable DETR"></a>Deformable DETR</h3><p><img data-src="https://s2.loli.net/2024/06/12/UdvnyZqNjWB51SH.png" alt="image-20240612220634309"></p><p><img data-src="https://s2.loli.net/2024/06/12/BpS6JWYKnGA5Rty.png" alt="image-20240612220643631"></p><h2 id="Diffusion-Models"><a href="#Diffusion-Models" class="headerlink" title="Diffusion Models"></a>Diffusion Models</h2><blockquote><p>åœ¨VAE,GANä¹‹åçš„ç”Ÿæˆå¼ä¹‹å…‰.</p></blockquote><p><img data-src="https://s2.loli.net/2024/06/12/XmtBQZG31L4Wi89.png" alt="image-20240612212239385"></p><p>å…·ä½“ä»£ç å‚çœ‹<a href="https://huggingface.co/blog/annotated-diffusion">The Annotated Diffusion Model (huggingface.co)</a></p><ul><li><a href="https://angusturner.github.io/generative_models/2021/06/29/diffusion-probabilistic-models-I.html">Diffusion Models as a kind of VAE | Angus Turner</a></li><li><a href="https://github.com/yangqy1110/Diffusion-Models?tab=readme-ov-file">yangqy1110/Diffusion-Models: æ‰©æ•£æ¨¡å‹åŸç†å’Œpytorchä»£ç å®ç°åˆå­¦èµ„æ–™æ±‡æ€» (github.com)</a></li><li><a href="https://github.com/mikonvergence/DiffusionFastForward/tree/master">mikonvergence/DiffusionFastForward: DiffusionFastForward: a free course and experimental framework for diffusion-based generative models (github.com)</a></li><li><a href="https://github.com/diff-usion/Awesome-Diffusion-Models?tab=readme-ov-file">diff-usion/Awesome-Diffusion-Models: A collection of resources and papers on Diffusion Models (github.com)</a></li></ul><h1 id="ç°ä»£å¤§æ¨¡å‹"><a href="#ç°ä»£å¤§æ¨¡å‹" class="headerlink" title="ç°ä»£å¤§æ¨¡å‹"></a>ç°ä»£å¤§æ¨¡å‹</h1><blockquote><p>ç›®å‰,å®ƒæ˜¯æ­£å¤„äºç»Ÿæ²»åœ°ä½. å½“ç„¶,äººä»¬ä¹Ÿå¸Œæœ›æœ‰å…¶ä»–æ–¹æ³•.</p></blockquote><h2 id="LLM"><a href="#LLM" class="headerlink" title="LLM"></a>LLM</h2><p><img data-src="https://s2.loli.net/2024/06/12/RHxAKYM4NFjnTpu.png" alt="image-20240612203226976"></p><p><img data-src="https://s2.loli.net/2024/06/12/pK6PTi7awbfCEBG.png" alt="image-20240612203251260"></p><p>å¯ä»¥è€ƒè™‘å‚è€ƒAndrej Karpathyçš„nanoGPTä»¥åŠGPT2å¤ç°.</p><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><p>å­¦ä¹ Pytorch<a href="https://www.learnpytorch.io/">Zero to Mastery Learn PyTorch for Deep Learning</a></p><p>å­¦ä¹ ç»å…¸<a href="https://zh.d2l.ai/">ã€ŠåŠ¨æ‰‹å­¦æ·±åº¦å­¦ä¹ ã€‹ â€” åŠ¨æ‰‹å­¦æ·±åº¦å­¦ä¹  2.0.0 documentation (d2l.ai)</a></p><p>å­¦ä¹ attentionä¸transformer</p><ul><li><a href="https://nlp.seas.harvard.edu/annotated-transformer/#prelims">The Annotated Transformer (harvard.edu)</a></li><li><p><a href="https://jalammar.github.io/illustrated-transformer/">The Illustrated Transformer â€“ Jay Alammar â€“ Visualizing machine learning one concept at a time. (jalammar.github.io)</a></p></li><li><p><a href="https://github.com/lucidrains/vit-pytorch">lucidrains/vit-pytorch: Implementation of Vision Transformer, a simple way to achieve SOTA in vision classification with only a single transformer encoder, in Pytorch (github.com)</a></p></li><li><p><a href="https://github.com/changzy00/pytorch-attention">changzy00/pytorch-attention: ğŸ¦–Pytorch implementation of popular Attention Mechanisms, Vision Transformers, MLP-Like models and CNNs.ğŸ”¥ğŸ”¥ğŸ”¥ (github.com)</a></p></li><li><a href="https://github.com/xmu-xiaoma666/External-Attention-pytorch">xmu-xiaoma666/External-Attention-pytorch: ğŸ€ Pytorch implementation of various Attention Mechanisms, MLP, Re-parameter, Convolution, which is helpful to further understand papers.â­â­â­ (github.com)</a></li></ul><p>å­¦ä¹ llm</p><ul><li><p><a href="https://github.com/rasbt/LLMs-from-scratch">https://github.com/rasbt/LLMs-from-scratch</a></p></li><li><p><a href="https://www.youtube.com/watch?v=kCc8FmEb1nY&amp;ab_channel=AndrejKarpathy">Letâ€™s build GPT: from scratch, in code, spelled out. (youtube.com)</a></p></li><li><p><a href="https://github.com/naklecha/llama3-from-scratch">naklecha/llama3-from-scratch: llama3 implementation one matrix multiplication at a time (github.com)</a></p></li><li><a href="https://cyrilzakka.github.io/llm-playbook/index.html">Introduction - The Large Language Model Playbook (cyrilzakka.github.io)</a></li></ul><p>å­¦ä¹ æ‰©æ•£æ¨¡å‹å’Œå¤§æ¨¡å‹çš„ä¸ªäººåšå®¢</p><ul><li><a href="https://spaces.ac.cn/">ç§‘å­¦ç©ºé—´|Scientific Spaces</a></li><li><a href="https://karpathy.github.io/">Andrej Karpathy blog</a></li><li><a href="https://lilianweng.github.io/">Lilâ€™Log (lilianweng.github.io)</a></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;p&gt;æ€»ç»“ä¸€ä¸‹å­¦ä¹ äººå·¥æ™ºèƒ½/æ·±åº¦å­¦ä¹ è¿‡ç¨‹ä¸­ä¸ªäººè§‰å¾—é‡è¦çš„æ–¹æ³•å’Œç»éªŒ. &lt;/p&gt;
&lt;p&gt;ä¸»è¦å…³äºæ¨¡å‹.&lt;br&gt;</summary>
    
    
    
    
    <category term="deep learning" scheme="https://www.sekyoro.top/tags/deep-learning/"/>
    
  </entry>
  
  <entry>
    <title>modern cpp learning(ä¸‰)</title>
    <link href="https://www.sekyoro.top/2024/06/10/modern-cpp-learning-%E4%B8%89/"/>
    <id>https://www.sekyoro.top/2024/06/10/modern-cpp-learning-%E4%B8%89/</id>
    <published>2024-06-10T12:18:08.000Z</published>
    <updated>2024-06-27T03:03:00.042Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>å¹¶è¡Œä¸å¹¶å‘,æ–‡ä»¶ç³»ç»Ÿä¸ä¸€äº›èµ„æ–™åˆ†äº«<br><span id="more"></span></p><h2 id="å¹¶è¡Œä¸å¹¶å‘"><a href="#å¹¶è¡Œä¸å¹¶å‘" class="headerlink" title="å¹¶è¡Œä¸å¹¶å‘"></a>å¹¶è¡Œä¸å¹¶å‘</h2><h3 id="å¹¶è¡ŒåŸºç¡€"><a href="#å¹¶è¡ŒåŸºç¡€" class="headerlink" title="å¹¶è¡ŒåŸºç¡€"></a>å¹¶è¡ŒåŸºç¡€</h3><p><code>std::thread</code> ç”¨äºåˆ›å»ºä¸€ä¸ªæ‰§è¡Œçš„çº¿ç¨‹å®ä¾‹ï¼Œæ‰€ä»¥å®ƒæ˜¯ä¸€åˆ‡å¹¶å‘ç¼–ç¨‹çš„åŸºç¡€ï¼Œä½¿ç”¨æ—¶éœ€è¦åŒ…å« <code>&lt;thread&gt;</code> å¤´æ–‡ä»¶ï¼Œ å®ƒæä¾›äº†å¾ˆå¤šåŸºæœ¬çš„çº¿ç¨‹æ“ä½œï¼Œä¾‹å¦‚ <code>get_id()</code> æ¥è·å–æ‰€åˆ›å»ºçº¿ç¨‹çš„çº¿ç¨‹ IDï¼Œä½¿ç”¨ <code>join()</code> æ¥ç­‰å¾…ä¸€ä¸ªçº¿ç¨‹ç»“æŸï¼ˆä¸è¯¥çº¿ç¨‹æ±‡åˆï¼‰ç­‰ç­‰ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;thread&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function">std::thread <span class="title">t</span><span class="params">([]()&#123;</span></span></span><br><span class="line"><span class="params"><span class="function">        std::cout &lt;&lt; <span class="string">&quot;hello world.&quot;</span> &lt;&lt; std::endl;</span></span></span><br><span class="line"><span class="params"><span class="function">    &#125;)</span></span>;</span><br><span class="line">    t.<span class="built_in">join</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹çš„åŸºæœ¬æ­¥éª¤å¦‚ä¸‹:</p><ol><li>å®šä¹‰ä¸€ä¸ªå‡½æ•°æˆ– lambda è¡¨è¾¾å¼ä½œä¸ºçº¿ç¨‹çš„æ‰§è¡Œä½“ã€‚</li><li>ä½¿ç”¨ <code>std::thread</code> ç±»çš„æ„é€ å‡½æ•°åˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹,å¹¶ä¼ å…¥çº¿ç¨‹æ‰§è¡Œä½“ã€‚</li><li>ç®¡ç†çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ,é€šå¸¸ä½¿ç”¨ <code>join()</code> æˆ– <code>detach()</code> æ–¹æ³•</li></ol><p><code>std::thread</code> ç±»æä¾›äº†ä»¥ä¸‹å¸¸ç”¨çš„æˆå‘˜å‡½æ•°:</p><ol><li><code>join()</code>: <strong>é˜»å¡å½“å‰çº¿ç¨‹</strong>,ç›´åˆ°è¢«å…³è”çš„çº¿ç¨‹æ‰§è¡Œå®Œæ¯•ã€‚</li><li><code>detach()</code>: å°†çº¿ç¨‹è®¾ç½®ä¸ºåˆ†ç¦»çŠ¶æ€,ä¸»<strong>çº¿ç¨‹ä¸ä¼šç­‰å¾…å­çº¿ç¨‹ç»“æŸ</strong>ã€‚</li><li><code>get_id()</code>: è·å–çº¿ç¨‹çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚</li><li><code>swap(other)</code>: äº¤æ¢ä¸¤ä¸ªçº¿ç¨‹å¯¹è±¡çš„åº•å±‚çº¿ç¨‹ã€‚</li><li><code>native_handle()</code>: è·å–åº•å±‚æ“ä½œç³»ç»Ÿçš„çº¿ç¨‹å¥æŸ„ã€‚</li></ol><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;functional&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">longRunningTask</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// æ¨¡æ‹Ÿä¸€ä¸ªè€—æ—¶çš„ä»»åŠ¡</span></span><br><span class="line">    std::this_thread::<span class="built_in">sleep_for</span>(std::chrono::<span class="built_in">seconds</span>(<span class="number">5</span>));</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Long running task completed.&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºå¹¶åˆ†ç¦»ä¸€ä¸ªæ–°çº¿ç¨‹</span></span><br><span class="line">    std::<span class="built_in">thread</span>(std::<span class="built_in">move</span>(longRunningTask)).<span class="built_in">detach</span>();</span><br><span class="line"></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Main thread continuing...&quot;</span> &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¸»çº¿ç¨‹ç»§ç»­æ‰§è¡Œå…¶ä»–ä»»åŠ¡</span></span><br><span class="line">    std::this_thread::<span class="built_in">sleep_for</span>(std::chrono::<span class="built_in">seconds</span>(<span class="number">2</span>));</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Main thread exiting.&quot;</span> &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="äº’æ–¥é‡ä¸ä¸´ç•ŒåŒº"><a href="#äº’æ–¥é‡ä¸ä¸´ç•ŒåŒº" class="headerlink" title="äº’æ–¥é‡ä¸ä¸´ç•ŒåŒº"></a>äº’æ–¥é‡ä¸ä¸´ç•ŒåŒº</h3><p>æˆ‘ä»¬åœ¨æ“ä½œç³»ç»Ÿã€äº¦æˆ–æ˜¯æ•°æ®åº“çš„ç›¸å…³çŸ¥è¯†ä¸­å·²ç»äº†è§£è¿‡äº†æœ‰å…³å¹¶å‘æŠ€æœ¯çš„åŸºæœ¬çŸ¥è¯†ï¼Œ<code>mutex</code> å°±æ˜¯å…¶ä¸­çš„æ ¸å¿ƒä¹‹ä¸€ã€‚ C++11 å¼•å…¥äº† <code>mutex</code> ç›¸å…³çš„ç±»ï¼Œå…¶æ‰€æœ‰ç›¸å…³çš„å‡½æ•°éƒ½æ”¾åœ¨ <code>&lt;mutex&gt;</code> å¤´æ–‡ä»¶ä¸­ã€‚</p><p><code>std::mutex</code> æ˜¯ C++11 ä¸­æœ€åŸºæœ¬çš„äº’æ–¥é‡ç±»ï¼Œå¯ä»¥<strong>é€šè¿‡æ„é€  <code>std::mutex</code> å¯¹è±¡åˆ›å»ºäº’æ–¥é‡ï¼Œ è€Œé€šè¿‡å…¶æˆå‘˜å‡½æ•° <code>lock()</code> å¯ä»¥è¿›è¡Œä¸Šé”ï¼Œ<code>unlock()</code> å¯ä»¥è¿›è¡Œè§£é”</strong>ã€‚ </p><p>ä½†æ˜¯åœ¨å®é™…ç¼–å†™ä»£ç çš„è¿‡ç¨‹ä¸­ï¼Œæœ€å¥½<strong>ä¸å»ç›´æ¥è°ƒç”¨æˆå‘˜å‡½æ•°ï¼Œ å› ä¸ºè°ƒç”¨æˆå‘˜å‡½æ•°å°±éœ€è¦åœ¨æ¯ä¸ªä¸´ç•ŒåŒºçš„å‡ºå£å¤„è°ƒç”¨ <code>unlock()</code></strong>ï¼Œå½“ç„¶ï¼Œè¿˜åŒ…æ‹¬å¼‚å¸¸ã€‚</p><p>è€Œ C++11 ä¸ºäº’æ–¥é‡æä¾›äº†ä¸€ä¸ª RAII æœºåˆ¶çš„æ¨¡æ¿ç±» <code>std::lock_guard</code>ã€‚</p><p>RAII åœ¨ä¸å¤±ä»£ç ç®€æ´æ€§çš„åŒæ—¶ï¼Œå¾ˆå¥½çš„ä¿è¯äº†ä»£ç çš„å¼‚å¸¸å®‰å…¨æ€§ã€‚</p><p>åœ¨ RAII ç”¨æ³•ä¸‹ï¼Œå¯¹äºä¸´ç•ŒåŒºçš„äº’æ–¥é‡çš„åˆ›å»ºåªéœ€è¦åœ¨ä½œç”¨åŸŸçš„å¼€å§‹éƒ¨åˆ†ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;mutex&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;thread&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> v = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">critical_section</span><span class="params">(<span class="keyword">int</span> change_v)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> std::mutex mtx;</span><br><span class="line">    <span class="function">std::lock_guard&lt;std::mutex&gt; <span class="title">lock</span><span class="params">(mtx)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ‰§è¡Œç«äº‰æ“ä½œ</span></span><br><span class="line">    v = change_v;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç¦»å¼€æ­¤ä½œç”¨åŸŸå mtx ä¼šè¢«é‡Šæ”¾</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function">std::thread <span class="title">t1</span><span class="params">(critical_section, <span class="number">2</span>)</span>, <span class="title">t2</span><span class="params">(critical_section, <span class="number">3</span>)</span></span>;</span><br><span class="line">    t1.<span class="built_in">join</span>();</span><br><span class="line">    t2.<span class="built_in">join</span>();</span><br><span class="line"></span><br><span class="line">    std::cout &lt;&lt; v &lt;&lt; std::endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p> C++ ä¿è¯äº†æ‰€æœ‰æ ˆå¯¹è±¡åœ¨ç”Ÿå‘½å‘¨æœŸç»“æŸæ—¶ä¼šè¢«é”€æ¯ï¼Œæ‰€ä»¥è¿™æ ·çš„ä»£ç ä¹Ÿæ˜¯å¼‚å¸¸å®‰å…¨çš„ã€‚</p><ul><li>è€Œ <code>std::unique_lock</code> åˆ™æ˜¯ç›¸å¯¹äº <code>std::lock_guard</code> å‡ºç°çš„ï¼Œ<code>std::unique_lock</code> æ›´åŠ çµæ´»ï¼Œ <strong><code>std::unique_lock</code> çš„å¯¹è±¡ä¼šä»¥ç‹¬å æ‰€æœ‰æƒï¼ˆæ²¡æœ‰å…¶ä»–çš„ <code>unique_lock</code> å¯¹è±¡åŒæ—¶æ‹¥æœ‰æŸä¸ª <code>mutex</code> å¯¹è±¡çš„æ‰€æœ‰æƒï¼‰ çš„æ–¹å¼ç®¡ç† <code>mutex</code> å¯¹è±¡ä¸Šçš„ä¸Šé”å’Œè§£é”</strong>çš„æ“ä½œã€‚æ‰€ä»¥åœ¨å¹¶å‘ç¼–ç¨‹ä¸­ï¼Œæ¨èä½¿ç”¨ <code>std::unique_lock</code>ã€‚</li><li><strong><code>std::lock_guard</code> ä¸èƒ½æ˜¾å¼çš„è°ƒç”¨ <code>lock</code> å’Œ <code>unlock</code>ï¼Œ è€Œ <code>std::unique_lock</code> å¯ä»¥åœ¨å£°æ˜åçš„ä»»æ„ä½ç½®è°ƒç”¨ï¼Œ</strong> å¯ä»¥ç¼©å°é”çš„ä½œç”¨èŒƒå›´ï¼Œæä¾›æ›´é«˜çš„å¹¶å‘åº¦ã€‚</li><li>å¦‚æœ<strong>ç”¨åˆ°äº†æ¡ä»¶å˜é‡ <code>std::condition_variable::wait</code> åˆ™å¿…é¡»ä½¿ç”¨ <code>std::unique_lock</code> ä½œä¸ºå‚æ•°</strong>ã€‚</li></ul><p>ä½¿ç”¨lock_guardä»£æ›¿lock,unlockæˆå‘˜å‡½æ•°-&gt;ä½¿ç”¨unique_lockæ›¿ä»£lock_guardå¯ä»¥ç‹¬å å¹¶æ˜¾å¼è°ƒç”¨lock,unlock.</p><blockquote><p><code>std::lock_guard</code> æ˜¯ä¸€ä¸ªéå¸¸ç®€å•çš„äº’æ–¥é”ç®¡ç†å™¨ã€‚<strong>å®ƒä¼šåœ¨æ„é€ æ—¶è‡ªåŠ¨è·å–äº’æ–¥é”,å¹¶åœ¨ææ„æ—¶è‡ªåŠ¨é‡Šæ”¾äº’æ–¥é”</strong>ã€‚è¿™æ ·å¯ä»¥ç¡®ä¿äº’æ–¥é”çš„æ­£ç¡®ä½¿ç”¨,å¹¶é¿å…æ‰‹åŠ¨è§£é”çš„é”™è¯¯ã€‚</p><p><code>std::unique_lock</code> æä¾›äº†<strong>æ›´å¤šçš„çµæ´»æ€§å’Œæ§åˆ¶</strong>ã€‚å®ƒå¯ä»¥<strong>æ‰‹åŠ¨é”å®šå’Œè§£é”äº’æ–¥é”</strong>,å¹¶æ”¯æŒ<strong>å»¶è¿Ÿé”å®š</strong>ã€<strong>æœ‰æ¡ä»¶åœ°ç­‰å¾…</strong>ç­‰åŠŸèƒ½</p></blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;mutex&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;thread&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> v = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">critical_section</span><span class="params">(<span class="keyword">int</span> change_v)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> std::mutex mtx;</span><br><span class="line">    <span class="function">std::unique_lock&lt;std::mutex&gt; <span class="title">lock</span><span class="params">(mtx)</span></span>;</span><br><span class="line">    <span class="comment">// æ‰§è¡Œç«äº‰æ“ä½œ</span></span><br><span class="line">    v = change_v;</span><br><span class="line">    std::cout &lt;&lt; v &lt;&lt; std::endl;</span><br><span class="line">    <span class="comment">// å°†é”è¿›è¡Œé‡Šæ”¾</span></span><br><span class="line">    lock.<span class="built_in">unlock</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åœ¨æ­¤æœŸé—´ï¼Œä»»ä½•äººéƒ½å¯ä»¥æŠ¢å¤º v çš„æŒæœ‰æƒ</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¼€å§‹å¦ä¸€ç»„ç«äº‰æ“ä½œï¼Œå†æ¬¡åŠ é”</span></span><br><span class="line">    lock.<span class="built_in">lock</span>();</span><br><span class="line">    v += <span class="number">1</span>;</span><br><span class="line">    std::cout &lt;&lt; v &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function">std::thread <span class="title">t1</span><span class="params">(critical_section, <span class="number">2</span>)</span>, <span class="title">t2</span><span class="params">(critical_section, <span class="number">3</span>)</span></span>;</span><br><span class="line">    t1.<span class="built_in">join</span>();</span><br><span class="line">    t2.<span class="built_in">join</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;mutex&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;condition_variable&gt;</span></span></span><br><span class="line"></span><br><span class="line">std::mutex mtx;</span><br><span class="line">std::condition_variable cv;</span><br><span class="line"><span class="keyword">bool</span> data_ready = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">producer_thread</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">        <span class="function">std::unique_lock&lt;std::mutex&gt; <span class="title">lk</span><span class="params">(mtx)</span></span>;</span><br><span class="line">        <span class="comment">// æ¨¡æ‹Ÿç”Ÿäº§æ•°æ®</span></span><br><span class="line">        std::this_thread::<span class="built_in">sleep_for</span>(std::chrono::<span class="built_in">seconds</span>(<span class="number">1</span>));</span><br><span class="line">        data_ready = <span class="literal">true</span>;</span><br><span class="line">        cv.<span class="built_in">notify_one</span>();</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">consumer_thread</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function">std::unique_lock&lt;std::mutex&gt; <span class="title">lk</span><span class="params">(mtx)</span></span>;</span><br><span class="line">    cv.<span class="built_in">wait</span>(lk, [] &#123; <span class="keyword">return</span> data_ready; &#125;);</span><br><span class="line">    <span class="comment">// æ¶ˆè´¹æ•°æ®</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Data consumed!&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function">std::thread <span class="title">producer</span><span class="params">(producer_thread)</span></span>;</span><br><span class="line">    <span class="function">std::thread <span class="title">consumer</span><span class="params">(consumer_thread)</span></span>;</span><br><span class="line">    producer.<span class="built_in">join</span>();</span><br><span class="line">    consumer.<span class="built_in">join</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æœŸç‰©-Future"><a href="#æœŸç‰©-Future" class="headerlink" title="æœŸç‰©(Future)"></a>æœŸç‰©(Future)</h3><p>æœŸç‰©ï¼ˆFutureï¼‰è¡¨ç°ä¸º <code>std::future</code>ï¼Œå®ƒ<strong>æä¾›äº†ä¸€ä¸ªè®¿é—®å¼‚æ­¥æ“ä½œç»“æœçš„é€”å¾„</strong>ï¼Œè¿™å¥è¯å¾ˆä¸å¥½ç†è§£ã€‚ ä¸ºäº†ç†è§£è¿™ä¸ªç‰¹æ€§ï¼Œæˆ‘ä»¬éœ€è¦å…ˆç†è§£ä¸€ä¸‹åœ¨ C++11 ä¹‹å‰çš„å¤šçº¿ç¨‹è¡Œä¸ºã€‚</p><p>è¯•æƒ³ï¼Œå¦‚æœæˆ‘ä»¬çš„<strong>ä¸»çº¿ç¨‹ A å¸Œæœ›æ–°å¼€è¾Ÿä¸€ä¸ªçº¿ç¨‹ B å»æ‰§è¡ŒæŸä¸ªæˆ‘ä»¬é¢„æœŸçš„ä»»åŠ¡ï¼Œå¹¶è¿”å›æˆ‘ä¸€ä¸ªç»“æœã€‚ è€Œè¿™æ—¶å€™ï¼Œçº¿ç¨‹ A å¯èƒ½æ­£åœ¨å¿™å…¶ä»–çš„äº‹æƒ…ï¼Œæ— æš‡é¡¾åŠ B çš„ç»“æœï¼Œ æ‰€ä»¥æˆ‘ä»¬ä¼šå¾ˆè‡ªç„¶çš„å¸Œæœ›èƒ½å¤Ÿåœ¨æŸä¸ªç‰¹å®šçš„æ—¶é—´è·å¾—çº¿ç¨‹ B çš„ç»“æœã€‚</strong></p><p>åœ¨ C++11 çš„ <code>std::future</code> è¢«å¼•å…¥ä¹‹å‰ï¼Œé€šå¸¸çš„åšæ³•æ˜¯ï¼š åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ Aï¼Œåœ¨çº¿ç¨‹ A é‡Œå¯åŠ¨ä»»åŠ¡ Bï¼Œ<strong>å½“å‡†å¤‡å®Œæ¯•åå‘é€ä¸€ä¸ªäº‹ä»¶ï¼Œå¹¶å°†ç»“æœä¿å­˜åœ¨å…¨å±€å˜é‡ä¸­ã€‚ è€Œä¸»å‡½æ•°çº¿ç¨‹ A é‡Œæ­£åœ¨åšå…¶ä»–çš„äº‹æƒ…ï¼Œå½“éœ€è¦ç»“æœçš„æ—¶å€™ï¼Œè°ƒç”¨ä¸€ä¸ªçº¿ç¨‹ç­‰å¾…å‡½æ•°æ¥è·å¾—æ‰§è¡Œçš„ç»“æœ</strong>ã€‚</p><p>C++11 æä¾›çš„ <code>std::future</code> ç®€åŒ–äº†è¿™ä¸ªæµç¨‹ï¼Œå¯ä»¥ç”¨æ¥è·å–å¼‚æ­¥ä»»åŠ¡çš„ç»“æœã€‚ è‡ªç„¶åœ°ï¼Œæˆ‘ä»¬å¾ˆå®¹æ˜“èƒ½å¤Ÿæƒ³è±¡åˆ°æŠŠå®ƒä½œä¸ºä¸€ç§ç®€å•çš„çº¿ç¨‹åŒæ­¥æ‰‹æ®µï¼Œå³å±éšœï¼ˆbarrierï¼‰</p><p>é¢å¤–ä½¿ç”¨ <code>std::packaged_task</code>ï¼Œå®ƒå¯ä»¥ç”¨æ¥å°è£…ä»»ä½•å¯ä»¥è°ƒç”¨çš„ç›®æ ‡ï¼Œä»è€Œç”¨äºå®ç°å¼‚æ­¥çš„è°ƒç”¨ã€‚ ä¸¾ä¾‹æ¥è¯´ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;future&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;thread&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// å°†ä¸€ä¸ªè¿”å›å€¼ä¸º7çš„ lambda è¡¨è¾¾å¼å°è£…åˆ° task ä¸­</span></span><br><span class="line">    <span class="comment">// std::packaged_task çš„æ¨¡æ¿å‚æ•°ä¸ºè¦å°è£…å‡½æ•°çš„ç±»å‹</span></span><br><span class="line">    <span class="function">std::packaged_task&lt;<span class="title">int</span><span class="params">()</span>&gt; <span class="title">task</span><span class="params">([]()&#123;<span class="keyword">return</span> <span class="number">7</span>;&#125;)</span></span>;</span><br><span class="line">    <span class="comment">// è·å¾— task çš„æœŸç‰©</span></span><br><span class="line">    std::future&lt;<span class="keyword">int</span>&gt; result = task.<span class="built_in">get_future</span>(); <span class="comment">// åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œ task</span></span><br><span class="line">    std::<span class="built_in">thread</span>(std::<span class="built_in">move</span>(task)).<span class="built_in">detach</span>();</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;waiting...&quot;</span>;</span><br><span class="line">    result.<span class="built_in">wait</span>(); <span class="comment">// åœ¨æ­¤è®¾ç½®å±éšœï¼Œé˜»å¡åˆ°æœŸç‰©çš„å®Œæˆ</span></span><br><span class="line">    <span class="comment">// è¾“å‡ºæ‰§è¡Œç»“æœ</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;done!&quot;</span> &lt;&lt; std:: endl &lt;&lt; <span class="string">&quot;future result is &quot;</span></span><br><span class="line">              &lt;&lt; result.<span class="built_in">get</span>() &lt;&lt; std::endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨å°è£…å¥½è¦è°ƒç”¨çš„ç›®æ ‡åï¼Œå¯ä»¥ä½¿ç”¨ <code>get_future()</code> æ¥è·å¾—ä¸€ä¸ª <code>std::future</code> å¯¹è±¡ï¼Œä»¥ä¾¿ä¹‹åå®æ–½çº¿ç¨‹åŒæ­¥ã€‚</p><blockquote><p>futureå¯¹è±¡æœ‰waitå’Œgetæ–¹æ³•åˆ†åˆ«ç­‰å¾…ä¸è·å¾—ç»“æœ.</p><p><code>std::promise</code> æ˜¯ C++11 æ ‡å‡†åº“ä¸­æä¾›çš„ä¸€ä¸ªç±»,å®ƒç”¨äºåœ¨å¼‚æ­¥ä»»åŠ¡ä¸­è®¾ç½®è¿”å›å€¼æˆ–å¼‚å¸¸ã€‚å®ƒé€šå¸¸ä¸ <code>std::future</code> é…åˆä½¿ç”¨,å½¢æˆä¸€ç§ç”Ÿäº§è€…-æ¶ˆè´¹è€…çš„æ¨¡å¼ã€‚</p><p>ç®€å•åœ°è¯´,<code>std::promise</code> å°±åƒä¸€ä¸ªâ€æ‰¿è¯ºâ€,å®ƒä»£è¡¨ç€ä¸€ä¸ªæ­£åœ¨è¿›è¡Œçš„å¼‚æ­¥æ“ä½œã€‚å½“è¿™ä¸ªå¼‚æ­¥æ“ä½œå®Œæˆæ—¶,<code>std::promise</code> å°±ä¼šâ€å…‘ç°â€è¿™ä¸ªæ‰¿è¯º,ä¹Ÿå°±æ˜¯è®¾ç½®è¿”å›å€¼æˆ–å¼‚å¸¸ã€‚è€Œ <code>std::future</code> åˆ™æ˜¯ç”¨æ¥â€æ¶ˆè´¹â€è¿™ä¸ªæ‰¿è¯º,ä¹Ÿå°±æ˜¯è·å–å¼‚æ­¥æ“ä½œçš„ç»“æœ.</p><p>å®ƒæ˜¯ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„å·¥å…·,å¯ä»¥å¸®åŠ©æ‚¨åœ¨å¼‚æ­¥ä»»åŠ¡ä¸­<strong>è®¾ç½®è¿”å›å€¼æˆ–å¼‚å¸¸,</strong>å¹¶ä¸ <code>std::future</code> ä¸€èµ·,æ„å»ºæ›´åŠ å¤æ‚å’Œå¼ºå¤§çš„å¹¶å‘ç¨‹åºã€‚</p></blockquote><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;future&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">worker_thread</span><span class="params">(std::promise&lt;<span class="keyword">int</span>&gt;&amp; prom)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// æ¨¡æ‹Ÿä¸€äº›è€—æ—¶çš„è®¡ç®—</span></span><br><span class="line">    std::this_thread::<span class="built_in">sleep_for</span>(std::chrono::<span class="built_in">seconds</span>(<span class="number">2</span>));</span><br><span class="line">    prom.<span class="built_in">set_value</span>(<span class="number">42</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::promise&lt;<span class="keyword">int</span>&gt; promise;</span><br><span class="line">    std::future&lt;<span class="keyword">int</span>&gt; future = promise.<span class="built_in">get_future</span>();</span><br><span class="line"></span><br><span class="line">    <span class="function">std::thread <span class="title">worker</span><span class="params">(worker_thread, std::ref(promise))</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> result = future.<span class="built_in">get</span>();</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Result: &quot;</span> &lt;&lt; result &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">    worker.<span class="built_in">join</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;future&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;chrono&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;thread&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡</span></span><br><span class="line">    std::future&lt;<span class="keyword">int</span>&gt; result = std::<span class="built_in">async</span>([] &#123;</span><br><span class="line">        std::this_thread::<span class="built_in">sleep_for</span>(std::chrono::<span class="built_in">seconds</span>(<span class="number">3</span>));</span><br><span class="line">        <span class="keyword">return</span> <span class="number">42</span>;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç­‰å¾…å¼‚æ­¥ä»»åŠ¡å®Œæˆ,æœ€å¤šç­‰å¾…2ç§’</span></span><br><span class="line">    std::future_status status = result.<span class="built_in">wait_for</span>(std::chrono::<span class="built_in">seconds</span>(<span class="number">2</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (status == std::future_status::ready) &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Async task completed, result: &quot;</span> &lt;&lt; result.<span class="built_in">get</span>() &lt;&lt; std::endl;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (status == std::future_status::timeout) &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Async task timed out.&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Async task was deferred.&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;future&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">worker_thread</span><span class="params">(std::promise&lt;<span class="keyword">int</span>&gt;&amp; prom)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// æ¨¡æ‹Ÿä¸€ä¸ªå¯èƒ½æŠ›å‡ºå¼‚å¸¸çš„æ“ä½œ</span></span><br><span class="line">        <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;Something went wrong!&quot;</span>);</span><br><span class="line">        prom.<span class="built_in">set_value</span>(<span class="number">42</span>);</span><br><span class="line">    &#125; <span class="built_in"><span class="keyword">catch</span></span> (...) &#123;</span><br><span class="line">        prom.<span class="built_in">set_exception</span>(std::<span class="built_in">current_exception</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::promise&lt;<span class="keyword">int</span>&gt; promise;</span><br><span class="line">    std::future&lt;<span class="keyword">int</span>&gt; future = promise.<span class="built_in">get_future</span>();</span><br><span class="line"></span><br><span class="line">    <span class="function">std::thread <span class="title">worker</span><span class="params">(worker_thread, std::ref(promise))</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">int</span> result = future.<span class="built_in">get</span>();</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Result: &quot;</span> &lt;&lt; result &lt;&lt; std::endl;</span><br><span class="line">    &#125; <span class="built_in"><span class="keyword">catch</span></span> (<span class="keyword">const</span> std::exception&amp; e) &#123;</span><br><span class="line">        std::cerr &lt;&lt; <span class="string">&quot;Error: &quot;</span> &lt;&lt; e.<span class="built_in">what</span>() &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    worker.<span class="built_in">join</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ¡ä»¶å˜é‡"><a href="#æ¡ä»¶å˜é‡" class="headerlink" title="æ¡ä»¶å˜é‡"></a>æ¡ä»¶å˜é‡</h3><p>æ¡ä»¶å˜é‡ <code>std::condition_variable</code> æ˜¯ä¸ºäº†è§£å†³æ­»é”è€Œç”Ÿï¼Œå½“äº’æ–¥æ“ä½œä¸å¤Ÿç”¨è€Œå¼•å…¥çš„ã€‚ æ¯”å¦‚ï¼Œ<strong>çº¿ç¨‹å¯èƒ½éœ€è¦ç­‰å¾…æŸä¸ªæ¡ä»¶ä¸ºçœŸæ‰èƒ½ç»§ç»­æ‰§è¡Œï¼Œ è€Œä¸€ä¸ªå¿™ç­‰å¾…å¾ªç¯ä¸­å¯èƒ½ä¼šå¯¼è‡´æ‰€æœ‰å…¶ä»–çº¿ç¨‹éƒ½æ— æ³•è¿›å…¥ä¸´ç•ŒåŒºä½¿å¾—æ¡ä»¶ä¸ºçœŸæ—¶ï¼Œå°±ä¼šå‘ç”Ÿæ­»é”</strong>ã€‚</p><p> æ‰€ä»¥ï¼Œ<code>condition_variable</code> å¯¹è±¡è¢«åˆ›å»ºå‡ºç°ä¸»è¦å°±æ˜¯ç”¨äº<strong>å”¤é†’ç­‰å¾…çº¿ç¨‹ä»è€Œé¿å…æ­»é”</strong>ã€‚ <strong><code>std::condition_variable</code>çš„ <code>notify_one()</code> ç”¨äºå”¤é†’ä¸€ä¸ªçº¿ç¨‹ï¼› <code>notify_all()</code> åˆ™æ˜¯é€šçŸ¥æ‰€æœ‰çº¿ç¨‹</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;chrono&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;mutex&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;condition_variable&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::queue&lt;<span class="keyword">int</span>&gt; produced_nums;</span><br><span class="line">    std::mutex mtx;</span><br><span class="line">    std::condition_variable cv;</span><br><span class="line">    <span class="keyword">bool</span> notified = <span class="literal">false</span>;  <span class="comment">// é€šçŸ¥ä¿¡å·</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç”Ÿäº§è€…</span></span><br><span class="line">    <span class="keyword">auto</span> producer = [&amp;]() &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; ; i++) &#123;</span><br><span class="line">            std::this_thread::<span class="built_in">sleep_for</span>(std::chrono::<span class="built_in">milliseconds</span>(<span class="number">900</span>));</span><br><span class="line">            <span class="function">std::unique_lock&lt;std::mutex&gt; <span class="title">lock</span><span class="params">(mtx)</span></span>;</span><br><span class="line">            std::cout &lt;&lt; <span class="string">&quot;producing &quot;</span> &lt;&lt; i &lt;&lt; std::endl;</span><br><span class="line">            produced_nums.<span class="built_in">push</span>(i);</span><br><span class="line">            notified = <span class="literal">true</span>;</span><br><span class="line">            cv.<span class="built_in">notify_all</span>(); <span class="comment">// æ­¤å¤„ä¹Ÿå¯ä»¥ä½¿ç”¨ notify_one</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">// æ¶ˆè´¹è€…</span></span><br><span class="line">    <span class="keyword">auto</span> consumer = [&amp;]() &#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            std::unique_lock&lt;std::mutex&gt; <span class="built_in">lock</span>(mtx);</span><br><span class="line">            <span class="keyword">while</span> (!notified) &#123;  <span class="comment">// é¿å…è™šå‡å”¤é†’</span></span><br><span class="line">                cv.<span class="built_in">wait</span>(lock);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// çŸ­æš‚å–æ¶ˆé”ï¼Œä½¿å¾—ç”Ÿäº§è€…æœ‰æœºä¼šåœ¨æ¶ˆè´¹è€…æ¶ˆè´¹ç©ºå‰ç»§ç»­ç”Ÿäº§</span></span><br><span class="line">            lock.<span class="built_in">unlock</span>();</span><br><span class="line">            <span class="comment">// æ¶ˆè´¹è€…æ…¢äºç”Ÿäº§è€…</span></span><br><span class="line">            std::this_thread::<span class="built_in">sleep_for</span>(std::chrono::<span class="built_in">milliseconds</span>(<span class="number">1000</span>));</span><br><span class="line">            lock.<span class="built_in">lock</span>();</span><br><span class="line">            <span class="keyword">while</span> (!produced_nums.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">                std::cout &lt;&lt; <span class="string">&quot;consuming &quot;</span> &lt;&lt; produced_nums.<span class="built_in">front</span>() &lt;&lt; std::endl;</span><br><span class="line">                produced_nums.<span class="built_in">pop</span>();</span><br><span class="line">            &#125;</span><br><span class="line">            notified = <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ†åˆ«åœ¨ä¸åŒçš„çº¿ç¨‹ä¸­è¿è¡Œ</span></span><br><span class="line">    <span class="function">std::thread <span class="title">p</span><span class="params">(producer)</span></span>;</span><br><span class="line">    std::thread cs[<span class="number">2</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; ++i) &#123;</span><br><span class="line">        cs[i] = std::<span class="built_in">thread</span>(consumer);</span><br><span class="line">    &#125;</span><br><span class="line">    p.<span class="built_in">join</span>();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; ++i) &#123;</span><br><span class="line">        cs[i].<span class="built_in">join</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å€¼å¾—ä¸€æçš„æ˜¯ï¼Œåœ¨ç”Ÿäº§è€…ä¸­æˆ‘ä»¬è™½ç„¶å¯ä»¥ä½¿ç”¨ <code>notify_one()</code>ï¼Œä½†å®é™…ä¸Šå¹¶ä¸å»ºè®®åœ¨æ­¤å¤„ä½¿ç”¨ï¼Œ å› ä¸º<strong>åœ¨å¤šæ¶ˆè´¹è€…çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬çš„æ¶ˆè´¹è€…å®ç°ä¸­ç®€å•æ”¾å¼ƒäº†é”çš„æŒæœ‰ï¼Œè¿™ä½¿å¾—å¯èƒ½è®©å…¶ä»–æ¶ˆè´¹è€…äº‰å¤ºæ­¤é”ï¼Œä»è€Œæ›´å¥½çš„åˆ©ç”¨å¤šä¸ªæ¶ˆè´¹è€…ä¹‹é—´çš„å¹¶å‘</strong>ã€‚</p><p>è¯è™½å¦‚æ­¤ï¼Œä½†å®é™…ä¸Š<strong>å› ä¸º <code>std::mutex</code> çš„æ’ä»–æ€§ï¼Œ æˆ‘ä»¬æ ¹æœ¬æ— æ³•æœŸå¾…å¤šä¸ªæ¶ˆè´¹è€…èƒ½çœŸæ­£æ„ä¹‰ä¸Šçš„å¹¶è¡Œæ¶ˆè´¹é˜Ÿåˆ—çš„ä¸­ç”Ÿäº§çš„å†…å®¹ï¼Œæˆ‘ä»¬ä»éœ€è¦ç²’åº¦æ›´ç»†çš„æ‰‹æ®µ</strong>ã€‚</p><h3 id="åŸå­æ“ä½œä¸å†…å­˜æ¨¡å‹"><a href="#åŸå­æ“ä½œä¸å†…å­˜æ¨¡å‹" class="headerlink" title="åŸå­æ“ä½œä¸å†…å­˜æ¨¡å‹"></a>åŸå­æ“ä½œä¸å†…å­˜æ¨¡å‹</h3><p>ä¸Šé¢çš„ä¾‹å­ä¸­,ç¼–è¯‘å™¨å¯èƒ½å¯¹å˜é‡ <code>notified</code> å­˜åœ¨ä¼˜åŒ–ï¼Œä¾‹å¦‚å°†å…¶ä½œä¸ºä¸€ä¸ªå¯„å­˜å™¨çš„å€¼ï¼Œ ä»è€Œå¯¼è‡´æ¶ˆè´¹è€…çº¿ç¨‹æ°¸è¿œæ— æ³•è§‚å¯Ÿåˆ°æ­¤å€¼çš„å˜åŒ–.</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> a = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">volatile</span> <span class="keyword">int</span> flag = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">std::thread <span class="title">t1</span><span class="params">([&amp;]() &#123;</span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="keyword">while</span> (flag != <span class="number">1</span>);</span></span></span><br><span class="line"><span class="params"><span class="function"></span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="keyword">int</span> b = a;</span></span></span><br><span class="line"><span class="params"><span class="function">        std::cout &lt;&lt; <span class="string">&quot;b = &quot;</span> &lt;&lt; b &lt;&lt; std::endl;</span></span></span><br><span class="line"><span class="params"><span class="function">    &#125;)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">std::thread <span class="title">t2</span><span class="params">([&amp;]() &#123;</span></span></span><br><span class="line"><span class="params"><span class="function">        a = <span class="number">5</span>;</span></span></span><br><span class="line"><span class="params"><span class="function">        flag = <span class="number">1</span>;</span></span></span><br><span class="line"><span class="params"><span class="function">    &#125;)</span></span>;</span><br><span class="line"></span><br><span class="line">    t1.<span class="built_in">join</span>();</span><br><span class="line">    t2.<span class="built_in">join</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»ç›´è§‚ä¸Šçœ‹ï¼Œ<code>t2</code> ä¸­ <code>a = 5;</code> è¿™ä¸€æ¡è¯­å¥ä¼¼ä¹æ€»åœ¨ <code>flag = 1;</code> ä¹‹å‰å¾—åˆ°æ‰§è¡Œï¼Œè€Œ <code>t1</code> ä¸­ <code>while (flag != 1)</code> ä¼¼ä¹ä¿è¯äº† <code>std::cout &lt;&lt; &quot;b = &quot; &lt;&lt; b &lt;&lt; std::endl;</code> ä¸ä¼šå†æ ‡è®°è¢«æ”¹å˜å‰æ‰§è¡Œã€‚ä»é€»è¾‘ä¸Šçœ‹ï¼Œä¼¼ä¹ <code>b</code> çš„å€¼åº”è¯¥ç­‰äº 5ã€‚ <strong>ä½†å®é™…æƒ…å†µè¿œæ¯”æ­¤å¤æ‚å¾—å¤šï¼Œæˆ–è€…è¯´è¿™æ®µä»£ç æœ¬èº«å±äºæœªå®šä¹‰çš„è¡Œä¸ºï¼Œå› ä¸ºå¯¹äº <code>a</code> å’Œ <code>flag</code> è€Œè¨€ï¼Œä»–ä»¬åœ¨ä¸¤ä¸ªå¹¶è¡Œçš„çº¿ç¨‹ä¸­è¢«è¯»å†™ï¼Œ å‡ºç°äº†ç«äº‰</strong>ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œå³ä¾¿æˆ‘ä»¬å¿½ç•¥ç«äº‰è¯»å†™ï¼Œä»ç„¶å¯èƒ½å— CPU çš„ä¹±åºæ‰§è¡Œï¼Œç¼–è¯‘å™¨å¯¹æŒ‡ä»¤çš„é‡æ’çš„å½±å“ï¼Œ å¯¼è‡´ <code>a = 5</code> å‘ç”Ÿåœ¨ <code>flag = 1</code> ä¹‹åã€‚ä»è€Œ <code>b</code> å¯èƒ½è¾“å‡º 0ã€‚</p><h4 id="åŸå­æ“ä½œ"><a href="#åŸå­æ“ä½œ" class="headerlink" title="åŸå­æ“ä½œ"></a>åŸå­æ“ä½œ</h4><p><code>std::mutex</code> å¯ä»¥è§£å†³ä¸Šé¢å‡ºç°çš„å¹¶å‘è¯»å†™çš„é—®é¢˜ï¼Œä½†<strong>äº’æ–¥é”æ˜¯æ“ä½œç³»ç»Ÿçº§çš„åŠŸèƒ½ï¼Œ è¿™æ˜¯å› ä¸ºä¸€ä¸ªäº’æ–¥é”çš„å®ç°é€šå¸¸åŒ…å«ä¸¤æ¡åŸºæœ¬åŸç†ï¼š</strong></p><ol><li><strong>æä¾›çº¿ç¨‹é—´è‡ªåŠ¨çš„çŠ¶æ€è½¬æ¢ï¼Œå³ã€é”ä½ã€è¿™ä¸ªçŠ¶æ€</strong></li><li><strong>ä¿éšœåœ¨äº’æ–¥é”æ“ä½œæœŸé—´ï¼Œæ‰€æ“ä½œå˜é‡çš„å†…å­˜ä¸ä¸´ç•ŒåŒºå¤–è¿›è¡Œéš”ç¦»</strong></li></ol><p><strong>è¿™æ˜¯ä¸€ç»„éå¸¸å¼ºçš„åŒæ­¥æ¡ä»¶ï¼Œæ¢å¥è¯è¯´å½“æœ€ç»ˆç¼–è¯‘ä¸º CPU æŒ‡ä»¤æ—¶ä¼šè¡¨ç°ä¸ºéå¸¸å¤šçš„æŒ‡ä»¤</strong>ï¼ˆæˆ‘ä»¬ä¹‹åå†æ¥çœ‹å¦‚ä½•å®ç°ä¸€ä¸ªç®€å•çš„äº’æ–¥é”ï¼‰ã€‚ è¿™å¯¹äºä¸€ä¸ªä»…éœ€åŸå­çº§æ“ä½œï¼ˆæ²¡æœ‰ä¸­é—´æ€ï¼‰çš„å˜é‡ï¼Œä¼¼ä¹å¤ªè‹›åˆ»äº†ã€‚</p><p>å…³äºåŒæ­¥æ¡ä»¶çš„ç ”ç©¶æœ‰ç€éå¸¸ä¹…è¿œçš„å†å²ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œä¸è¿›è¡Œèµ˜è¿°ã€‚è¯»è€…åº”è¯¥æ˜ç™½ï¼Œç°ä»£ CPU ä½“ç³»ç»“æ„æä¾›äº† CPU æŒ‡ä»¤çº§çš„åŸå­æ“ä½œï¼Œ å› æ­¤åœ¨<strong>å¤šçº¿ç¨‹ä¸‹å…±äº«å˜é‡çš„è¯»å†™è¿™ä¸€é—®é¢˜ä¸Šï¼Œ C++11 ä¸­è¿˜å¼•å…¥äº† <code>std::atomic</code> æ¨¡æ¿ï¼Œä½¿å¾—æˆ‘ä»¬èƒ½å®ä¾‹åŒ–åŸå­ç±»å‹ï¼Œå¹¶å°†ä¸€ä¸ªåŸå­å†™æ“ä½œä»ä¸€ç»„æŒ‡ä»¤ï¼Œæœ€å°åŒ–åˆ°å•ä¸ª CPU æŒ‡ä»¤</strong>ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">std::atomic&lt;<span class="keyword">int</span>&gt; counter;</span><br></pre></td></tr></table></figure><p>å…¶ä¸ºæ•´æ•°æˆ–æµ®ç‚¹æ•°çš„åŸå­ç±»å‹æä¾›äº†åŸºæœ¬çš„æ•°å€¼æˆå‘˜å‡½æ•°ï¼Œä¸¾ä¾‹æ¥è¯´ï¼Œ åŒ…æ‹¬ <code>fetch_add</code>, <code>fetch_sub</code> ç­‰ï¼ŒåŒæ—¶é€šè¿‡é‡è½½æ–¹ä¾¿çš„æä¾›äº†å¯¹åº”çš„ <code>+</code>ï¼Œ<code>-</code> ç‰ˆæœ¬</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;atomic&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line">std::atomic&lt;<span class="keyword">int</span>&gt; count = &#123;<span class="number">0</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function">std::thread <span class="title">t1</span><span class="params">([]()&#123;</span></span></span><br><span class="line"><span class="params"><span class="function">        count.fetch_add(<span class="number">1</span>);</span></span></span><br><span class="line"><span class="params"><span class="function">    &#125;)</span></span>;</span><br><span class="line">    <span class="function">std::thread <span class="title">t2</span><span class="params">([]()&#123;</span></span></span><br><span class="line"><span class="params"><span class="function">        count++;        <span class="comment">// ç­‰ä»·äº fetch_add</span></span></span></span><br><span class="line"><span class="params"><span class="function">        count += <span class="number">1</span>;     <span class="comment">// ç­‰ä»·äº fetch_add</span></span></span></span><br><span class="line"><span class="params"><span class="function">    &#125;)</span></span>;</span><br><span class="line">    t1.<span class="built_in">join</span>();</span><br><span class="line">    t2.<span class="built_in">join</span>();</span><br><span class="line">    std::cout &lt;&lt; count &lt;&lt; std::endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¹¶éæ‰€æœ‰çš„ç±»å‹éƒ½èƒ½æä¾›åŸå­æ“ä½œï¼Œè¿™æ˜¯å› ä¸ºåŸå­æ“ä½œçš„å¯è¡Œæ€§å–å†³äºå…·ä½“çš„ CPU æ¶æ„ï¼Œä»¥åŠæ‰€å®ä¾‹åŒ–çš„ç±»å‹ç»“æ„æ˜¯å¦èƒ½å¤Ÿæ»¡è¶³è¯¥ CPU æ¶æ„å¯¹å†…å­˜å¯¹é½ æ¡ä»¶çš„è¦æ±‚ï¼Œå› è€Œæˆ‘ä»¬æ€»æ˜¯å¯ä»¥é€šè¿‡ <code>std::atomic&lt;T&gt;::is_lock_free</code> æ¥æ£€æŸ¥è¯¥åŸå­ç±»å‹æ˜¯å¦éœ€æ”¯æŒåŸå­æ“ä½œ.</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;atomic&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">A</span> &#123;</span></span><br><span class="line">    <span class="keyword">float</span> x;</span><br><span class="line">    <span class="keyword">int</span> y;</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">long</span> z;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::atomic&lt;A&gt; a;</span><br><span class="line">    std::cout &lt;&lt; std::boolalpha &lt;&lt; a.<span class="built_in">is_lock_free</span>() &lt;&lt; std::endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ä¸€è‡´æ€§æ¨¡å‹"><a href="#ä¸€è‡´æ€§æ¨¡å‹" class="headerlink" title="ä¸€è‡´æ€§æ¨¡å‹"></a>ä¸€è‡´æ€§æ¨¡å‹</h4><p><strong>å¹¶è¡Œæ‰§è¡Œçš„å¤šä¸ªçº¿ç¨‹</strong>ï¼Œä»æŸç§å®è§‚å±‚é¢ä¸Šè®¨è®ºï¼Œå¯ä»¥<strong>ç²—ç•¥çš„è§†ä¸ºä¸€ç§åˆ†å¸ƒå¼ç³»ç»Ÿ</strong>ã€‚ <strong>åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œä»»ä½•é€šä¿¡ä¹ƒè‡³æœ¬åœ°æ“ä½œéƒ½éœ€è¦æ¶ˆè€—ä¸€å®šæ—¶é—´ï¼Œç”šè‡³å‡ºç°ä¸å¯é çš„é€šä¿¡</strong>ã€‚</p><p>å¦‚æœæˆ‘ä»¬å¼ºè¡Œå°†ä¸€ä¸ªå˜é‡ <code>v</code> åœ¨å¤šä¸ªçº¿ç¨‹ä¹‹é—´çš„æ“ä½œè®¾ä¸ºåŸå­æ“ä½œï¼Œå³ä»»ä½•ä¸€ä¸ªçº¿ç¨‹åœ¨æ“ä½œå®Œ <code>v</code> åï¼Œ å…¶ä»–çº¿ç¨‹å‡èƒ½<strong>åŒæ­¥</strong>æ„ŸçŸ¥åˆ° <code>v</code> çš„å˜åŒ–ï¼Œåˆ™å¯¹äºå˜é‡ <code>v</code> è€Œè¨€ï¼Œè¡¨ç°ä¸ºé¡ºåºæ‰§è¡Œçš„ç¨‹åºï¼Œå®ƒå¹¶æ²¡æœ‰ç”±äºå¼•å…¥å¤šçº¿ç¨‹ è€Œå¾—åˆ°ä»»ä½•æ•ˆç‡ä¸Šçš„æ”¶ç›Šã€‚å¯¹æ­¤æœ‰ä»€ä¹ˆåŠæ³•èƒ½å¤Ÿé€‚å½“çš„åŠ é€Ÿå‘¢ï¼Ÿç­”æ¡ˆä¾¿æ˜¯å‰Šå¼±åŸå­æ“ä½œçš„åœ¨è¿›ç¨‹é—´çš„åŒæ­¥æ¡ä»¶ã€‚</p><p>ä»åŸç†ä¸Šçœ‹ï¼Œæ¯ä¸ªçº¿ç¨‹å¯ä»¥å¯¹åº”ä¸ºä¸€ä¸ªé›†ç¾¤èŠ‚ç‚¹ï¼Œè€Œçº¿ç¨‹é—´çš„é€šä¿¡ä¹Ÿå‡ ä¹ç­‰ä»·äºé›†ç¾¤èŠ‚ç‚¹é—´çš„é€šä¿¡ã€‚ å‰Šå¼±è¿›ç¨‹é—´çš„åŒæ­¥æ¡ä»¶ï¼Œé€šå¸¸æˆ‘ä»¬ä¼šè€ƒè™‘å››ç§ä¸åŒçš„ä¸€è‡´æ€§æ¨¡å‹ï¼š</p><ol><li><p>çº¿æ€§ä¸€è‡´æ€§ï¼šåˆç§°å¼ºä¸€è‡´æ€§æˆ–åŸå­ä¸€è‡´æ€§ã€‚å®ƒè¦æ±‚ä»»ä½•ä¸€æ¬¡è¯»æ“ä½œéƒ½èƒ½è¯»åˆ°æŸä¸ªæ•°æ®çš„æœ€è¿‘ä¸€æ¬¡å†™çš„æ•°æ®ï¼Œå¹¶ä¸”æ‰€æœ‰çº¿ç¨‹çš„æ“ä½œé¡ºåºä¸å…¨å±€æ—¶é’Ÿä¸‹çš„é¡ºåºæ˜¯ä¸€è‡´çš„ã€‚</p></li><li><p>```</p><pre><code>    x.store(1)      x.load()</code></pre><p>T1 â€”â€”â€”â€”-+â€”â€”â€”â€”â€”â€”â€”â€”+â€”â€”â€”&gt;</p></li></ol><p>   T2 â€”â€”â€”â€”â€”â€”â€”â€”â€”-+â€”â€”â€”â€”â€”â€”-&gt;<br>                   x.store(2)<br>   <figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">   åœ¨è¿™ç§æƒ…å†µä¸‹çº¿ç¨‹ `T1`, `T2` å¯¹ `x` çš„ä¸¤æ¬¡å†™æ“ä½œæ˜¯åŸå­çš„ï¼Œä¸” `x.store(<span class="number">1</span>)` æ˜¯ä¸¥æ ¼çš„å‘ç”Ÿåœ¨ `x.store(<span class="number">2</span>)` ä¹‹å‰ï¼Œ`x.store(<span class="number">2</span>)` ä¸¥æ ¼çš„å‘ç”Ÿåœ¨ `x.load()` ä¹‹å‰ã€‚ å€¼å¾—ä¸€æçš„æ˜¯ï¼Œçº¿æ€§ä¸€è‡´æ€§å¯¹å…¨å±€æ—¶é’Ÿçš„è¦æ±‚æ˜¯éš¾ä»¥å®ç°çš„ï¼Œè¿™ä¹Ÿæ˜¯äººä»¬ä¸æ–­ç ”ç©¶æ¯”è¿™ä¸ªä¸€è‡´æ€§æ›´å¼±æ¡ä»¶ä¸‹å…¶ä»–ä¸€è‡´æ€§çš„ç®—æ³•çš„åŸå› ã€‚</span><br><span class="line"></span><br><span class="line"><span class="number">2</span>. é¡ºåºä¸€è‡´æ€§ï¼šåŒæ ·è¦æ±‚ä»»ä½•ä¸€æ¬¡è¯»æ“ä½œéƒ½èƒ½è¯»åˆ°æ•°æ®æœ€è¿‘ä¸€æ¬¡å†™å…¥çš„æ•°æ®ï¼Œä½†æœªè¦æ±‚ä¸å…¨å±€æ—¶é’Ÿçš„é¡ºåºä¸€è‡´ã€‚</span><br><span class="line"></span><br></pre></td></tr></table></figure><br>           x.store(1)  x.store(3)   x.load()<br>   T1 â€”â€”â€”â€”-+â€”â€”â€”â€”â€”-+â€”â€”â€”â€”â€”+â€”â€”-&gt;</p><p>   T2 â€”â€”â€”â€”â€”â€”â€”-+â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”&gt;<br>                 x.store(2)</p><p>   æˆ–è€…</p><pre><code>       x.store(1)  x.store(3)   x.load()</code></pre><p>   T1 â€”â€”â€”â€”-+â€”â€”â€”â€”â€”-+â€”â€”â€”â€”â€”+â€”â€”-&gt;</p><p>   T2 â€”â€”â€”+â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”-&gt;<br>         x.store(2)<br>   <figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">   åœ¨é¡ºåºä¸€è‡´æ€§çš„è¦æ±‚ä¸‹ï¼Œ`x.load()` å¿…é¡»è¯»åˆ°æœ€è¿‘ä¸€æ¬¡å†™å…¥çš„æ•°æ®ï¼Œå› æ­¤ `x.store(<span class="number">2</span>)` ä¸ `x.store(<span class="number">1</span>)` å¹¶æ— ä»»ä½•å…ˆåä¿éšœï¼Œå³ åªè¦ `T2` çš„ `x.store(<span class="number">2</span>)` å‘ç”Ÿåœ¨ `x.store(<span class="number">3</span>)` ä¹‹å‰å³å¯ã€‚</span><br><span class="line"></span><br><span class="line"><span class="number">3</span>. å› æœä¸€è‡´æ€§ï¼šå®ƒçš„è¦æ±‚è¿›ä¸€æ­¥é™ä½ï¼Œåªéœ€è¦æœ‰å› æœå…³ç³»çš„æ“ä½œé¡ºåºå¾—åˆ°ä¿éšœï¼Œè€Œéå› æœå…³ç³»çš„æ“ä½œé¡ºåºåˆ™ä¸åšè¦æ±‚ã€‚</span><br><span class="line"></span><br></pre></td></tr></table></figure><br>         a = 1      b = 2<br>   T1 â€”â€”+â€”â€”â€”â€”â€”-+â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”&gt;</p><p>   T2 â€”â€”â€”+â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”+â€”â€”â€”â€”+â€”â€”â€”â€”&gt;<br>         x.store(3)         c = a + b    y.load()</p><p>   æˆ–è€…</p><pre><code>     a = 1      b = 2</code></pre><p>   T1 â€”â€”+â€”â€”â€”â€”â€”-+â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”&gt;</p><p>   T2 â€”â€”â€”+â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”+â€”â€”â€”â€”+â€”â€”â€”â€”&gt;<br>         x.store(3)          y.load()   c = a + b</p><p>   äº¦æˆ–è€…</p><pre><code>    b = 2       a = 1</code></pre><p>   T1 â€”â€”+â€”â€”â€”â€”â€”-+â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”&gt;</p><p>   T2 â€”â€”â€”+â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”+â€”â€”â€”â€”+â€”â€”â€”â€”&gt;<br>         y.load()            c = a + b  x.store(3)<br>   <figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">   ä¸Šé¢ç»™å‡ºçš„ä¸‰ç§ä¾‹å­éƒ½æ˜¯å±äºå› æœä¸€è‡´çš„ï¼Œå› ä¸ºæ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œåªæœ‰ `c` å¯¹ `a` å’Œ `b` äº§ç”Ÿä¾èµ–ï¼Œè€Œ `x` å’Œ `y` åœ¨æ­¤ä¾‹å­ä¸­è¡¨ç°ä¸ºæ²¡æœ‰å…³ç³»ï¼ˆä½†å®é™…æƒ…å†µä¸­æˆ‘ä»¬éœ€è¦æ›´è¯¦ç»†çš„ä¿¡æ¯æ‰èƒ½ç¡®å®š `x` ä¸ `y` ç¡®å®æ— å…³ï¼‰</span><br><span class="line"></span><br><span class="line"><span class="number">4</span>. æœ€ç»ˆä¸€è‡´æ€§ï¼šæ˜¯æœ€å¼±çš„ä¸€è‡´æ€§è¦æ±‚ï¼Œå®ƒåªä¿éšœæŸä¸ªæ“ä½œåœ¨æœªæ¥çš„æŸä¸ªæ—¶é—´èŠ‚ç‚¹ä¸Šä¼šè¢«è§‚å¯Ÿåˆ°ï¼Œä½†å¹¶æœªè¦æ±‚è¢«è§‚å¯Ÿåˆ°çš„æ—¶é—´ã€‚å› æ­¤æˆ‘ä»¬ç”šè‡³å¯ä»¥å¯¹æ­¤æ¡ä»¶ç¨ä½œåŠ å¼ºï¼Œä¾‹å¦‚è§„å®šæŸä¸ªæ“ä½œè¢«è§‚å¯Ÿåˆ°çš„æ—¶é—´æ€»æ˜¯æœ‰ç•Œçš„ã€‚å½“ç„¶è¿™å·²ç»ä¸åœ¨æˆ‘ä»¬çš„è®¨è®ºèŒƒå›´ä¹‹å†…äº†ã€‚</span><br><span class="line"></span><br></pre></td></tr></table></figure><br>       x.store(3)  x.store(4)<br>   T1 â€”â€”+â€”â€”â€”â€”â€”-+â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”&gt;</p><p>   T2 â€”â€”â€”â€”-+â€”â€”â€”â€”â€”â€”+â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”+â€”â€”â€”â€”+â€”â€”â€”â€”&gt;<br>            x.read      x.read()           x.read()   x.read()<br>   <figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">åœ¨ä¸Šé¢çš„æƒ…å†µä¸­ï¼Œå¦‚æœæˆ‘ä»¬å‡è®¾ x çš„åˆå§‹å€¼ä¸º <span class="number">0</span>ï¼Œåˆ™ `T2` ä¸­å››æ¬¡ `x.read()` ç»“æœå¯èƒ½ä½†ä¸é™äºä»¥ä¸‹æƒ…å†µï¼š</span><br><span class="line"></span><br></pre></td></tr></table></figure><br>   3 4 4 4 // x çš„å†™æ“ä½œè¢«å¾ˆå¿«è§‚å¯Ÿåˆ°<br>   0 3 3 4 // x çš„å†™æ“ä½œè¢«è§‚å¯Ÿåˆ°çš„æ—¶é—´å­˜åœ¨ä¸€å®šå»¶è¿Ÿ<br>   0 0 0 4 // æœ€åä¸€æ¬¡è¯»æ“ä½œè¯»åˆ°äº† x çš„æœ€ç»ˆå€¼ï¼Œä½†æ­¤å‰çš„å˜åŒ–å¹¶æœªè§‚å¯Ÿåˆ°<br>   0 0 0 0 // åœ¨å½“å‰æ—¶é—´æ®µå†… x çš„å†™æ“ä½œå‡æœªè¢«è§‚å¯Ÿåˆ°ï¼Œ<br>           // ä½†æœªæ¥æŸä¸ªæ—¶é—´ç‚¹ä¸Šä¸€å®šèƒ½è§‚å¯Ÿåˆ° x ä¸º 4 çš„æƒ…å†µ<br>   <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#### å†…å­˜é¡ºåº</span><br><span class="line"></span><br><span class="line">ä¸ºäº†è¿½æ±‚æè‡´çš„æ€§èƒ½ï¼Œå®ç°å„ç§å¼ºåº¦è¦æ±‚çš„ä¸€è‡´æ€§ï¼ŒC++<span class="number">11</span> ä¸ºåŸå­æ“ä½œå®šä¹‰äº†å…­ç§ä¸åŒçš„å†…å­˜é¡ºåº `std::memory_order` çš„é€‰é¡¹ï¼Œè¡¨è¾¾äº†å››ç§å¤šçº¿ç¨‹é—´çš„åŒæ­¥æ¨¡å‹ï¼š</span><br><span class="line"></span><br><span class="line"><span class="number">1.</span> å®½æ¾æ¨¡å‹ï¼šåœ¨æ­¤æ¨¡å‹ä¸‹ï¼Œå•ä¸ªçº¿ç¨‹å†…çš„åŸå­æ“ä½œéƒ½æ˜¯é¡ºåºæ‰§è¡Œçš„ï¼Œä¸å…è®¸æŒ‡ä»¤é‡æ’ï¼Œä½†ä¸åŒçº¿ç¨‹é—´åŸå­æ“ä½œçš„é¡ºåºæ˜¯ä»»æ„çš„ã€‚ç±»å‹é€šè¿‡ `std::memory_order_relaxed` æŒ‡å®šã€‚æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼š</span><br><span class="line"></span><br><span class="line">   ```cpp</span><br><span class="line">   std::atomic&lt;<span class="keyword">int</span>&gt; counter = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">   std::vector&lt;std::thread&gt; vt;</span><br><span class="line">   <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; ++i) &#123;</span><br><span class="line">       vt.<span class="built_in">emplace_back</span>([&amp;]()&#123;</span><br><span class="line">           counter.<span class="built_in">fetch_add</span>(<span class="number">1</span>, std::memory_order_relaxed);</span><br><span class="line">       &#125;);</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">for</span> (<span class="keyword">auto</span>&amp; t : vt) &#123;</span><br><span class="line">       t.<span class="built_in">join</span>();</span><br><span class="line">   &#125;</span><br><span class="line">   std::cout &lt;&lt; <span class="string">&quot;current counter:&quot;</span> &lt;&lt; counter &lt;&lt; std::endl;</span><br></pre></td></tr></table></figure></p><ol><li><p>é‡Šæ”¾/æ¶ˆè´¹æ¨¡å‹ï¼šåœ¨æ­¤æ¨¡å‹ä¸­ï¼Œæˆ‘ä»¬å¼€å§‹é™åˆ¶è¿›ç¨‹é—´çš„æ“ä½œé¡ºåºï¼Œå¦‚æœæŸä¸ªçº¿ç¨‹éœ€è¦ä¿®æ”¹æŸä¸ªå€¼ï¼Œä½†å¦ä¸€ä¸ªçº¿ç¨‹ä¼šå¯¹è¯¥å€¼çš„æŸæ¬¡æ“ä½œäº§ç”Ÿä¾èµ–ï¼Œå³åè€…ä¾èµ–å‰è€…ã€‚å…·ä½“è€Œè¨€ï¼Œçº¿ç¨‹ A å®Œæˆäº†ä¸‰æ¬¡å¯¹ <code>x</code> çš„å†™æ“ä½œï¼Œçº¿ç¨‹ <code>B</code> ä»…ä¾èµ–å…¶ä¸­ç¬¬ä¸‰æ¬¡ <code>x</code> çš„å†™æ“ä½œï¼Œä¸ <code>x</code> çš„å‰ä¸¤æ¬¡å†™è¡Œä¸ºæ— å…³ï¼Œåˆ™å½“ <code>A</code> ä¸»åŠ¨ <code>x.release()</code> æ—¶å€™ï¼ˆå³ä½¿ç”¨ <code>std::memory_order_release</code>ï¼‰ï¼Œé€‰é¡¹ <code>std::memory_order_consume</code> èƒ½å¤Ÿç¡®ä¿ <code>B</code> åœ¨è°ƒç”¨ <code>x.load()</code> æ—¶å€™è§‚å¯Ÿåˆ° <code>A</code> ä¸­ç¬¬ä¸‰æ¬¡å¯¹ <code>x</code> çš„å†™æ“ä½œã€‚æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆå§‹åŒ–ä¸º nullptr é˜²æ­¢ consumer çº¿ç¨‹ä»é‡æŒ‡é’ˆè¿›è¡Œè¯»å–</span></span><br><span class="line"><span class="function">std::atomic&lt;<span class="keyword">int</span>*&gt; <span class="title">ptr</span><span class="params">(<span class="literal">nullptr</span>)</span></span>;</span><br><span class="line"><span class="keyword">int</span> v;</span><br><span class="line"><span class="function">std::thread <span class="title">producer</span><span class="params">([&amp;]() &#123;</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">int</span>* p = <span class="keyword">new</span> <span class="keyword">int</span>(<span class="number">42</span>);</span></span></span><br><span class="line"><span class="params"><span class="function">    v = <span class="number">1024</span>;</span></span></span><br><span class="line"><span class="params"><span class="function">    ptr.store(p, std::memory_order_release);</span></span></span><br><span class="line"><span class="params"><span class="function">&#125;)</span></span>;</span><br><span class="line"><span class="function">std::thread <span class="title">consumer</span><span class="params">([&amp;]() &#123;</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">int</span>* p;</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">while</span>(!(p = ptr.load(std::memory_order_consume)));</span></span></span><br><span class="line"><span class="params"><span class="function"></span></span></span><br><span class="line"><span class="params"><span class="function">    std::cout &lt;&lt; <span class="string">&quot;p: &quot;</span> &lt;&lt; *p &lt;&lt; std::endl;</span></span></span><br><span class="line"><span class="params"><span class="function">    std::cout &lt;&lt; <span class="string">&quot;v: &quot;</span> &lt;&lt; v &lt;&lt; std::endl;</span></span></span><br><span class="line"><span class="params"><span class="function">&#125;)</span></span>;</span><br><span class="line">producer.<span class="built_in">join</span>();</span><br><span class="line">consumer.<span class="built_in">join</span>();</span><br></pre></td></tr></table></figure></li><li><p>é‡Šæ”¾/è·å–æ¨¡å‹ï¼šåœ¨æ­¤æ¨¡å‹ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥è¿›ä¸€æ­¥åŠ ç´§å¯¹ä¸åŒçº¿ç¨‹é—´åŸå­æ“ä½œçš„é¡ºåºçš„é™åˆ¶ï¼Œåœ¨é‡Šæ”¾ <code>std::memory_order_release</code> å’Œè·å– <code>std::memory_order_acquire</code> ä¹‹é—´è§„å®šæ—¶åºï¼Œå³å‘ç”Ÿåœ¨é‡Šæ”¾ï¼ˆreleaseï¼‰æ“ä½œä¹‹å‰çš„<strong>æ‰€æœ‰</strong>å†™æ“ä½œï¼Œå¯¹å…¶ä»–çº¿ç¨‹çš„ä»»ä½•è·å–ï¼ˆacquireï¼‰æ“ä½œéƒ½æ˜¯å¯è§çš„ï¼Œäº¦å³å‘ç”Ÿé¡ºåºï¼ˆhappens-beforeï¼‰ã€‚</p><p>å¯ä»¥çœ‹åˆ°ï¼Œ<code>std::memory_order_release</code> ç¡®ä¿äº†å®ƒä¹‹å‰çš„å†™æ“ä½œä¸ä¼šå‘ç”Ÿåœ¨é‡Šæ”¾æ“ä½œä¹‹åï¼Œæ˜¯ä¸€ä¸ªå‘åçš„å±éšœï¼ˆbackwardï¼‰ï¼Œè€Œ <code>std::memory_order_acquire</code> ç¡®ä¿äº†å®ƒä¹‹å‰çš„å†™è¡Œä¸ºä¸ä¼šå‘ç”Ÿåœ¨è¯¥è·å–æ“ä½œä¹‹åï¼Œæ˜¯ä¸€ä¸ªå‘å‰çš„å±éšœï¼ˆforwardï¼‰ã€‚å¯¹äºé€‰é¡¹ <code>std::memory_order_acq_rel</code> è€Œè¨€ï¼Œåˆ™ç»“åˆäº†è¿™ä¸¤è€…çš„ç‰¹ç‚¹ï¼Œå”¯ä¸€ç¡®å®šäº†ä¸€ä¸ªå†…å­˜å±éšœï¼Œä½¿å¾—å½“å‰çº¿ç¨‹å¯¹å†…å­˜çš„è¯»å†™ä¸ä¼šè¢«é‡æ’å¹¶è¶Šè¿‡æ­¤æ“ä½œçš„å‰åï¼š</p><p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">std::vector&lt;<span class="keyword">int</span>&gt; v;</span><br><span class="line">std::atomic&lt;<span class="keyword">int</span>&gt; flag = &#123;<span class="number">0</span>&#125;;</span><br><span class="line"><span class="function">std::thread <span class="title">release</span><span class="params">([&amp;]() &#123;</span></span></span><br><span class="line"><span class="params"><span class="function">    v.push_back(<span class="number">42</span>);</span></span></span><br><span class="line"><span class="params"><span class="function">    flag.store(<span class="number">1</span>, std::memory_order_release);</span></span></span><br><span class="line"><span class="params"><span class="function">&#125;)</span></span>;</span><br><span class="line"><span class="function">std::thread <span class="title">acqrel</span><span class="params">([&amp;]() &#123;</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">int</span> expected = <span class="number">1</span>; <span class="comment">// must before compare_exchange_strong</span></span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">while</span>(!flag.compare_exchange_strong(expected, <span class="number">2</span>, std::memory_order_acq_rel))</span></span></span><br><span class="line"><span class="params"><span class="function">        expected = <span class="number">1</span>; <span class="comment">// must after compare_exchange_strong</span></span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="comment">// flag has changed to 2</span></span></span></span><br><span class="line"><span class="params"><span class="function">&#125;)</span></span>;</span><br><span class="line"><span class="function">std::thread <span class="title">acquire</span><span class="params">([&amp;]() &#123;</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">while</span>(flag.load(std::memory_order_acquire) &lt; <span class="number">2</span>);</span></span></span><br><span class="line"><span class="params"><span class="function"></span></span></span><br><span class="line"><span class="params"><span class="function">    std::cout &lt;&lt; v.at(<span class="number">0</span>) &lt;&lt; std::endl; <span class="comment">// must be 42</span></span></span></span><br><span class="line"><span class="params"><span class="function">&#125;)</span></span>;</span><br><span class="line">release.<span class="built_in">join</span>();</span><br><span class="line">acqrel.<span class="built_in">join</span>();</span><br><span class="line">acquire.<span class="built_in">join</span>();</span><br></pre></td></tr></table></figure><p>åœ¨æ­¤ä¾‹ä¸­æˆ‘ä»¬ä½¿ç”¨äº† <code>compare_exchange_strong</code> æ¯”è¾ƒäº¤æ¢åŸè¯­ï¼ˆCompare-and-swap primitiveï¼‰ï¼Œå®ƒæœ‰ä¸€ä¸ªæ›´å¼±çš„ç‰ˆæœ¬ï¼Œå³ <code>compare_exchange_weak</code>ï¼Œå®ƒå…è®¸å³ä¾¿äº¤æ¢æˆåŠŸï¼Œä¹Ÿä»ç„¶è¿”å› <code>false</code> å¤±è´¥ã€‚å…¶åŸå› æ˜¯å› ä¸ºåœ¨æŸäº›å¹³å°ä¸Šè™šå‡æ•…éšœå¯¼è‡´çš„ï¼Œå…·ä½“è€Œè¨€ï¼Œå½“ CPU è¿›è¡Œä¸Šä¸‹æ–‡åˆ‡æ¢æ—¶ï¼Œå¦ä¸€çº¿ç¨‹åŠ è½½åŒä¸€åœ°å€äº§ç”Ÿçš„ä¸ä¸€è‡´ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œ<code>compare_exchange_strong</code> çš„æ€§èƒ½å¯èƒ½ç¨å·®äº <code>compare_exchange_weak</code>ï¼Œä½†å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œé‰´äºå…¶ä½¿ç”¨çš„å¤æ‚åº¦è€Œè¨€ï¼Œ<code>compare_exchange_weak</code> åº”è¯¥è¢«æœ‰é™è€ƒè™‘ã€‚</p></li><li><p>é¡ºåºä¸€è‡´æ¨¡å‹ï¼šåœ¨æ­¤æ¨¡å‹ä¸‹ï¼ŒåŸå­æ“ä½œæ»¡è¶³é¡ºåºä¸€è‡´æ€§ï¼Œè¿›è€Œå¯èƒ½å¯¹æ€§èƒ½äº§ç”ŸæŸè€—ã€‚å¯æ˜¾å¼çš„é€šè¿‡ <code>std::memory_order_seq_cst</code> è¿›è¡ŒæŒ‡å®šã€‚æœ€åæ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">std::atomic&lt;<span class="keyword">int</span>&gt; counter = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">std::vector&lt;std::thread&gt; vt;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; ++i) &#123;</span><br><span class="line">    vt.<span class="built_in">emplace_back</span>([&amp;]()&#123;</span><br><span class="line">        counter.<span class="built_in">fetch_add</span>(<span class="number">1</span>, std::memory_order_seq_cst);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">auto</span>&amp; t : vt) &#123;</span><br><span class="line">    t.<span class="built_in">join</span>();</span><br><span class="line">&#125;</span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;current counter:&quot;</span> &lt;&lt; counter &lt;&lt; std::endl;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªä¾‹å­ä¸ç¬¬ä¸€ä¸ªå®½æ¾æ¨¡å‹çš„ä¾‹å­æœ¬è´¨ä¸Šæ²¡æœ‰åŒºåˆ«ï¼Œä»…ä»…åªæ˜¯å°†åŸå­æ“ä½œçš„å†…å­˜é¡ºåºä¿®æ”¹ä¸ºäº† <code>memory_order_seq_cst</code>ï¼Œæœ‰å…´è¶£çš„è¯»è€…å¯ä»¥è‡ªè¡Œç¼–å†™ç¨‹åºæµ‹é‡è¿™ä¸¤ç§ä¸åŒå†…å­˜é¡ºåºå¯¼è‡´çš„æ€§èƒ½å·®å¼‚ã€‚</p></li></ol><p>C++11 è¯­è¨€å±‚æä¾›äº†å¹¶å‘ç¼–ç¨‹çš„ç›¸å…³æ”¯æŒï¼Œæ¯”å¦‚<code>std::thread</code>, <code>std::mutex</code>, <code>std::future</code> è¿™äº›å¹¶å‘ç¼–ç¨‹ä¸­ä¸å¯å›é¿çš„é‡è¦å·¥å…·ã€‚</p><p> é™¤æ­¤ä¹‹å¤–è¿˜ä»‹ç»äº† C++11 æœ€é‡è¦çš„å‡ ä¸ªç‰¹æ€§ä¹‹ä¸€çš„ã€å†…å­˜æ¨¡å‹ã€ï¼Œ å®ƒä»¬ä¸º C++ åœ¨æ ‡å‡†åŒ–é«˜æ€§èƒ½è®¡ç®—ä¸­æä¾›äº†é‡è¦çš„åŸºç¡€ã€‚</p><h2 id="æ–‡ä»¶ç³»ç»Ÿ"><a href="#æ–‡ä»¶ç³»ç»Ÿ" class="headerlink" title="æ–‡ä»¶ç³»ç»Ÿ"></a>æ–‡ä»¶ç³»ç»Ÿ</h2><blockquote><p>æ–‡ä»¶ç³»ç»Ÿåº“æä¾›äº†æ–‡ä»¶ç³»ç»Ÿã€è·¯å¾„ã€å¸¸è§„æ–‡ä»¶ã€ç›®å½•ç­‰ç­‰ç›¸å…³ç»„ä»¶è¿›è¡Œæ“ä½œçš„ç›¸å…³åŠŸèƒ½ã€‚å’Œæ­£åˆ™è¡¨è¾¾å¼åº“ç±»ä¼¼ï¼Œä»–ä¹Ÿæ˜¯æœ€å…ˆç”± boost å‘èµ·ï¼Œå¹¶æœ€ç»ˆè¢«åˆå¹¶ä¸º C++ æ ‡å‡†çš„ä¼—å¤šåº“ä¹‹ä¸€ã€‚</p><p>C++17 å¼•å…¥äº†æ–‡ä»¶ç³»ç»Ÿæ ‡å‡†åº“(<code>&lt;filesystem&gt;</code>)æ¥æä¾›å¯¹æ–‡ä»¶ç³»ç»Ÿçš„æ“ä½œæ”¯æŒã€‚è¯¥æ ‡å‡†åº“å®šä¹‰äº†ä¸€ç»„ä¸æ–‡ä»¶ç³»ç»Ÿç›¸å…³çš„ç±»å’Œå‡½æ•°,ä½¿å¾—åœ¨C++ç¨‹åºä¸­æ“ä½œæ–‡ä»¶å’Œç›®å½•å˜å¾—æ›´åŠ æ–¹ä¾¿å’Œè·¨å¹³å°</p></blockquote><ol><li><strong>æ–‡ä»¶ç³»ç»Ÿ</strong>:<ul><li><code>std::filesystem</code> å‘½åç©ºé—´åŒ…å«äº†ä¸æ–‡ä»¶ç³»ç»Ÿç›¸å…³çš„ç±»å’Œå‡½æ•°ã€‚</li><li>ä¸»è¦ç±»å‹åŒ…æ‹¬ <code>path</code>ã€<code>directory_entry</code>ã€<code>directory_iterator</code> å’Œ <code>recursive_directory_iterator</code>ã€‚</li><li>è¿™äº›ç±»å‹å…è®¸ä½ æŸ¥è¯¢ã€éå†å’Œæ“ä½œæ–‡ä»¶ç³»ç»Ÿä¸­çš„ç›®å½•å’Œæ–‡ä»¶ã€‚</li></ul></li><li><strong>è·¯å¾„</strong>:<ul><li><code>std::filesystem::path</code> ç±»ç”¨äºè¡¨ç¤ºæ–‡ä»¶ç³»ç»Ÿä¸­çš„è·¯å¾„ã€‚</li><li>å®ƒå¯ä»¥è¡¨ç¤ºç»å¯¹è·¯å¾„å’Œç›¸å¯¹è·¯å¾„,å¹¶æä¾›äº†è®¸å¤šå¤„ç†è·¯å¾„çš„æ–¹æ³•,å¦‚æ‹¼æ¥ã€åˆ†å‰²ç­‰ã€‚</li><li>ä½ å¯ä»¥ä½¿ç”¨ <code>operator/</code> æ¥æ‹¼æ¥è·¯å¾„,å¦‚ <code>path1 / &quot;subdir&quot; / &quot;file.txt&quot;</code>ã€‚</li></ul></li><li><p><strong>å¸¸è§„æ–‡ä»¶</strong>:</p><ul><li><code>std::filesystem</code> åº“æä¾›äº†ä¸€äº›å‡½æ•°æ¥æ“ä½œå¸¸è§„æ–‡ä»¶,å¦‚ <code>std::filesystem::exists()</code>ã€<code>std::filesystem::file_size()</code>ã€<code>std::filesystem::copy_file()</code> å’Œ <code>std::filesystem::remove()</code>ã€‚</li><li>è¿™äº›å‡½æ•°å¯ä»¥å¸®åŠ©ä½ æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨ã€è·å–æ–‡ä»¶å¤§å°ã€å¤åˆ¶æ–‡ä»¶ä»¥åŠåˆ é™¤æ–‡ä»¶ç­‰ã€‚</li></ul><p><code>&lt;filesystem&gt;</code> æ ‡å‡†åº“è¿˜æä¾›äº†ä¸€äº›ä¸æ–‡ä»¶ç³»ç»Ÿé“¾æ¥ç›¸å…³çš„åŠŸèƒ½</p></li><li><p><strong>ç¡¬é“¾æ¥å’Œè½¯é“¾æ¥</strong>:</p><ul><li><code>std::filesystem::create_hard_link()</code>å‡½æ•°å¯ä»¥åˆ›å»ºæ–‡ä»¶çš„ç¡¬é“¾æ¥ã€‚</li><li><code>std::filesystem::create_symlink()</code>å‡½æ•°å¯ä»¥åˆ›å»ºæ–‡ä»¶æˆ–ç›®å½•çš„è½¯é“¾æ¥(ç¬¦å·é“¾æ¥)ã€‚</li><li><code>std::filesystem::is_symlink()</code>å‡½æ•°å¯ä»¥æ£€æŸ¥æŸä¸ªè·¯å¾„æ˜¯å¦ä¸ºè½¯é“¾æ¥ã€‚</li></ul></li><li><strong>æ–‡ä»¶è·¯å¾„è§„èŒƒåŒ–</strong>:<ul><li><code>std::filesystem::canonical()</code>å‡½æ•°å¯ä»¥è·å–æŸä¸ªè·¯å¾„çš„æ ‡å‡†å½¢å¼(è§„èŒƒè·¯å¾„)ã€‚</li><li>è¿™åœ¨å¤„ç†æ¶‰åŠè½¯é“¾æ¥çš„è·¯å¾„æ—¶å¾ˆæœ‰å¸®åŠ©,å¯ä»¥æ¶ˆé™¤è½¯é“¾æ¥å¸¦æ¥çš„è·¯å¾„æ­§ä¹‰ã€‚</li></ul></li><li><strong>è·¯å¾„æ¯”è¾ƒ</strong>:<ul><li><code>std::filesystem::equivalent()</code>å‡½æ•°å¯ä»¥åˆ¤æ–­ä¸¤ä¸ªè·¯å¾„æ˜¯å¦æŒ‡å‘åŒä¸€ä¸ªæ–‡ä»¶æˆ–ç›®å½•ã€‚</li><li>å³ä½¿è·¯å¾„å­—ç¬¦ä¸²ä¸åŒ,å¦‚æœæŒ‡å‘åŒä¸€ä¸ªå®ä½“,ä¹Ÿä¼šè¿”å›trueã€‚</li></ul></li><li><strong>è·¯å¾„è§£æ</strong>:<ul><li><code>std::filesystem::proximate()</code>å‡½æ•°å¯ä»¥è·å–æŸä¸ªè·¯å¾„ç›¸å¯¹äºå¦ä¸€ä¸ªè·¯å¾„çš„ç›¸å¯¹è·¯å¾„ã€‚</li><li>è¿™åœ¨å¤„ç†æ¶‰åŠå¤šä¸ªç›®å½•çš„è·¯å¾„æ—¶å¾ˆæœ‰ç”¨</li></ul></li></ol><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;filesystem&gt;</span></span></span><br><span class="line"><span class="keyword">namespace</span> fs = std::filesystem;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    fs::path file_path = <span class="string">&quot;example.txt&quot;</span>;</span><br><span class="line">    fs::path link_path = <span class="string">&quot;example_link.txt&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ›å»ºç¡¬é“¾æ¥</span></span><br><span class="line">    fs::<span class="built_in">create_hard_link</span>(file_path, link_path);</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Hard link created: &quot;</span> &lt;&lt; link_path &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ›å»ºè½¯é“¾æ¥</span></span><br><span class="line">    fs::<span class="built_in">create_symlink</span>(file_path, <span class="string">&quot;example_symlink.txt&quot;</span>);</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Symbolic link created&quot;</span> &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–è§„èŒƒè·¯å¾„</span></span><br><span class="line">    fs::path canonical_path = fs::<span class="built_in">canonical</span>(link_path);</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Canonical path: &quot;</span> &lt;&lt; canonical_path &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ¤æ–­è·¯å¾„æ˜¯å¦ç­‰ä»·</span></span><br><span class="line">    <span class="keyword">if</span> (fs::<span class="built_in">equivalent</span>(file_path, canonical_path)) &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Paths are equivalent&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–ç›¸å¯¹è·¯å¾„</span></span><br><span class="line">    fs::path relative_path = fs::<span class="built_in">proximate</span>(canonical_path, fs::<span class="built_in">current_path</span>());</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Relative path: &quot;</span> &lt;&lt; relative_path &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>C++17 æ–‡ä»¶ç³»ç»Ÿæ ‡å‡†åº“çš„ä¸€äº›ä¸»è¦ç»„æˆéƒ¨åˆ†:</p><h4 id="æ–‡ä»¶ç³»ç»Ÿ-1"><a href="#æ–‡ä»¶ç³»ç»Ÿ-1" class="headerlink" title="æ–‡ä»¶ç³»ç»Ÿ"></a>æ–‡ä»¶ç³»ç»Ÿ</h4><ol><li><code>std::filesystem::path</code>: è¡¨ç¤ºæ–‡ä»¶ç³»ç»Ÿè·¯å¾„çš„ç±»ã€‚å¯ä»¥ç”¨äºåˆ›å»ºã€æŸ¥è¯¢å’Œæ“ä½œè·¯å¾„ã€‚</li><li><code>std::filesystem::directory_entry</code>: è¡¨ç¤ºç›®å½•é¡¹çš„ç±»,åŒ…å«æ–‡ä»¶æˆ–ç›®å½•çš„ä¿¡æ¯ã€‚</li><li><code>std::filesystem::directory_iterator</code>: ç›®å½•è¿­ä»£å™¨,å¯ç”¨äºéå†ç›®å½•ä¸­çš„å†…å®¹ã€‚</li><li><code>std::filesystem::recursive_directory_iterator</code>: é€’å½’ç›®å½•è¿­ä»£å™¨,å¯ç”¨äºéå†ç›®å½•åŠå…¶å­ç›®å½•ã€‚</li><li>ä¸€äº›å¸¸ç”¨å‡½æ•°:<ul><li><code>std::filesystem::exists()</code>: æ£€æŸ¥è·¯å¾„æ˜¯å¦å­˜åœ¨</li><li><code>std::filesystem::is_regular_file()</code>: æ£€æŸ¥è·¯å¾„æ˜¯å¦ä¸ºå¸¸è§„æ–‡ä»¶</li><li><code>std::filesystem::is_directory()</code>: æ£€æŸ¥è·¯å¾„æ˜¯å¦ä¸ºç›®å½•</li><li><code>std::filesystem::file_size()</code>: è·å–æ–‡ä»¶å¤§å°</li><li><code>std::filesystem::copy_file()</code>: å¤åˆ¶æ–‡ä»¶</li><li><code>std::filesystem::remove()</code>: åˆ é™¤æ–‡ä»¶æˆ–ç›®å½•</li><li><code>std::filesystem::create_directory()</code>: åˆ›å»ºç›®å½•</li></ul></li></ol><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;filesystem&gt;</span></span></span><br><span class="line"><span class="keyword">namespace</span> fs = std::filesystem;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// è·å–å½“å‰å·¥ä½œç›®å½•</span></span><br><span class="line">    fs::path current_path = fs::<span class="built_in">current_path</span>();</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Current path: &quot;</span> &lt;&lt; current_path &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// éå†å½“å‰ç›®å½•ä¸‹çš„æ–‡ä»¶å’Œç›®å½•</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; entry : fs::<span class="built_in">directory_iterator</span>(current_path)) &#123;</span><br><span class="line">        std::cout &lt;&lt; entry.<span class="built_in">path</span>() &lt;&lt; <span class="string">&quot; (&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span> (fs::<span class="built_in">is_regular_file</span>(entry)) &#123;</span><br><span class="line">            std::cout &lt;&lt; <span class="string">&quot;file, size: &quot;</span> &lt;&lt; fs::<span class="built_in">file_size</span>(entry) &lt;&lt; <span class="string">&quot; bytes&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (fs::<span class="built_in">is_directory</span>(entry)) &#123;</span><br><span class="line">            std::cout &lt;&lt; <span class="string">&quot;directory&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;)&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ›å»ºä¸€ä¸ªæ–°ç›®å½•</span></span><br><span class="line">    fs::path new_dir = current_path / <span class="string">&quot;new_folder&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span> (fs::<span class="built_in">create_directory</span>(new_dir)) &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Directory created: &quot;</span> &lt;&lt; new_dir &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å¸¸ç”¨å®"><a href="#å¸¸ç”¨å®" class="headerlink" title="å¸¸ç”¨å®"></a>å¸¸ç”¨å®</h3><p>c++å…¼å®¹c</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> __cplusplus</span></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> &#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">funcc</span><span class="params">(<span class="keyword">int</span> a)</span> </span>&#123;</span><br><span class="line">  std::cout &lt;&lt; <span class="string">&quot;funcc&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> __cplusplus</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure><p>å®šä¹‰æŠ¥é”™logger</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LOG(format, ...)                                                \</span></span><br><span class="line"><span class="meta">  fprintf(stderr, <span class="meta-string">&quot;[Date:%s|Time:%s][%s:%s:%d] &quot;</span> format <span class="meta-string">&quot;\n&quot;</span>, __DATE__, \</span></span><br><span class="line"><span class="meta">          __TIME__, __FILE__, __func__, __LINE__, ##__VA_ARGS__)</span></span><br></pre></td></tr></table></figure><p>ä½¿ç”¨</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">LOG</span>(<span class="string">&quot;Error: %d, %s&quot;</span>, <span class="number">42</span>, <span class="string">&quot;message&quot;</span>);</span><br></pre></td></tr></table></figure><h3 id="ç›¸å…³èµ„æ–™"><a href="#ç›¸å…³èµ„æ–™" class="headerlink" title="ç›¸å…³èµ„æ–™"></a>ç›¸å…³èµ„æ–™</h3><p><a href="https://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines">C++ Core Guidelines (isocpp.github.io)</a></p><p><strong>æ¨¡æ¿ç¼–ç¨‹</strong></p><p><a href="https://mq-b.github.io/Modern-Cpp-templates-tutorial/md/README">é˜…è¯»é¡»çŸ¥ | ç°ä»£ C++ æ¨¡æ¿æ•™ç¨‹ (mq-b.github.io)</a></p><p><a href="https://itlanyan.com/template-in-cpp/">C++æ¨¡æ¿ç¼–ç¨‹ - tlanyan (itlanyan.com)</a></p><p><strong>å¹¶å‘ç¼–ç¨‹</strong></p><p><a href="https://nj.gitbooks.io/c/content/">Introduction Â· C++å¹¶å‘ç¼–ç¨‹å®æˆ˜ (gitbooks.io)</a></p><p><a href="https://mq-bai.gitbook.io/modern-cpp-concurrent-programming">é¦–é¡µ | ç°ä»£C++å¹¶å‘ç¼–ç¨‹æ•™ç¨‹ (gitbook.io)</a></p><p>ä¹‹åçš„<strong>C++20</strong><br><a href="https://en.cppreference.com/w/cpp/20">C++20 - cppreference.com</a><br><a href="https://github.com/xiaoweiChen/CXX20-The-Complete-Guide">xiaoweiChen/CXX20-The-Complete-Guide: ã€ŠC++20 The Complete Guideã€‹çš„éä¸“ä¸šä¸ªäººç¿»è¯‘ (github.com)</a><br>è™½ç„¶è¯´äº†å¾ˆå¤šæ¬¡,ä½†æˆ‘è¿˜æ˜¯æƒ³è°ˆè°ˆc++æœ¬èº«çš„åº”ç”¨,åœ¨<strong>å­˜å‚¨</strong>å’Œ<strong>ç½‘ç»œ</strong>ä¸Šéƒ½å¾ˆå¤š,ä½ ä¹Ÿå¯ä»¥ç”¨å®ƒæ¥é€ å…¶ä»–è½®å­.<br><strong>åº”ç”¨</strong></p><ul><li>ç½‘ç»œç¼–ç¨‹/LinuxæœåŠ¡å™¨ç¼–ç¨‹</li><li>è®¡ç®—æœºå›¾å½¢å­¦</li><li>æ¡Œé¢åº”ç”¨ç¼–ç¨‹</li><li>éŸ³è§†é¢‘ç¼–ç¨‹</li><li>å­˜å‚¨/æ•°æ®åº“</li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;p&gt;å¹¶è¡Œä¸å¹¶å‘,æ–‡ä»¶ç³»ç»Ÿä¸ä¸€äº›èµ„æ–™åˆ†äº«&lt;br&gt;</summary>
    
    
    
    
    <category term="cpp" scheme="https://www.sekyoro.top/tags/cpp/"/>
    
  </entry>
  
  <entry>
    <title>modern cpp learning(äºŒ)</title>
    <link href="https://www.sekyoro.top/2024/06/09/modern-cpp-learning-%E4%BA%8C/"/>
    <id>https://www.sekyoro.top/2024/06/09/modern-cpp-learning-%E4%BA%8C/</id>
    <published>2024-06-09T04:46:41.000Z</published>
    <updated>2024-06-17T03:33:58.680Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>å®¹å™¨ã€æ™ºèƒ½æŒ‡é’ˆä¸æ­£åˆ™è¡¨è¾¾å¼.<br><span id="more"></span></p><h2 id="å®¹å™¨"><a href="#å®¹å™¨" class="headerlink" title="å®¹å™¨"></a>å®¹å™¨</h2><p>å¸¸ç”¨çš„å®¹å™¨å¦‚ä¸‹:</p><ol><li><strong>std::vector</strong>:<ul><li>åŠ¨æ€æ•°ç»„å®¹å™¨,æ”¯æŒéšæœºè®¿é—®ã€‚</li><li>å¯ä»¥åŠ¨æ€å¢åŠ æˆ–å‡å°‘å®¹å™¨å¤§å°ã€‚</li><li>é€‚ç”¨äºéœ€è¦å¿«é€Ÿéšæœºè®¿é—®çš„åœºæ™¯ã€‚</li></ul></li><li><strong>std::list</strong>:<ul><li>åŒå‘é“¾è¡¨å®¹å™¨,æ”¯æŒé«˜æ•ˆçš„æ’å…¥å’Œåˆ é™¤æ“ä½œã€‚</li><li>ä¸æ”¯æŒéšæœºè®¿é—®,ä½†åœ¨éœ€è¦é¢‘ç¹æ’å…¥/åˆ é™¤çš„åœºæ™¯ä¸‹æ€§èƒ½æ›´å¥½ã€‚</li><li>é€‚ç”¨äºéœ€è¦é¢‘ç¹æ’å…¥/åˆ é™¤çš„æ•°æ®ç»“æ„,å¦‚æ ˆã€é˜Ÿåˆ—ç­‰ã€‚</li></ul></li><li><strong>std::deque</strong>(åŒç«¯é˜Ÿåˆ—):<ul><li>åŒç«¯é˜Ÿåˆ—å®¹å™¨,æ”¯æŒåœ¨å¤´å°¾å¿«é€Ÿæ’å…¥å’Œåˆ é™¤ã€‚</li><li>å®ç°ä¸Šç»“åˆäº†æ•°ç»„å’Œé“¾è¡¨çš„ä¼˜ç‚¹ã€‚</li><li>é€‚ç”¨äºéœ€è¦åœ¨å¤´å°¾é«˜æ•ˆæ’å…¥/åˆ é™¤çš„åœºæ™¯ã€‚</li></ul></li><li><strong>std::set</strong>/<strong>std::unordered_set</strong>:<ul><li>æœ‰åºé›†åˆå’Œæ— åºé›†åˆå®¹å™¨,è‡ªåŠ¨æ’åº/æ•£åˆ—å­˜å‚¨å…ƒç´ ã€‚</li><li>æ”¯æŒé«˜æ•ˆçš„æŸ¥æ‰¾ã€æ’å…¥å’Œåˆ é™¤æ“ä½œã€‚</li><li>é€‚ç”¨äºéœ€è¦å»é‡å’Œå¿«é€ŸæŸ¥æ‰¾çš„åœºæ™¯ã€‚</li></ul></li><li><strong>std::map</strong>/<strong>std::unordered_map</strong>:<ul><li>å…³è”æ•°ç»„å®¹å™¨,ä»¥é”®-å€¼å¯¹çš„å½¢å¼å­˜å‚¨å…ƒç´ ã€‚</li><li>æœ‰åºæ˜ å°„å’Œæ— åºæ˜ å°„,æ”¯æŒé«˜æ•ˆçš„æŸ¥æ‰¾ã€æ’å…¥å’Œåˆ é™¤ã€‚</li><li>é€‚ç”¨äºéœ€è¦å¿«é€ŸæŸ¥æ‰¾æˆ–å­˜å‚¨é”®å€¼å¯¹çš„åœºæ™¯ã€‚</li></ul></li><li><strong>std::stack</strong>/<strong>std::queue</strong>:<ul><li>æ ˆå’Œé˜Ÿåˆ—å®¹å™¨,æä¾›å…ˆè¿›å…ˆå‡º(FIFO)å’Œåè¿›å…ˆå‡º(LIFO)çš„æ“ä½œã€‚</li><li>åŸºäºå…¶ä»–å®¹å™¨(å¦‚ <code>std::deque</code>)å®ç°ã€‚</li><li>é€‚ç”¨äºéœ€è¦å®ç°æ ˆå’Œé˜Ÿåˆ—æ•°æ®ç»“æ„çš„åœºæ™¯ã€‚</li></ul></li></ol><p>ä¸»è¦çš„ STL ç®—æ³•:</p><ol><li><strong>æ’åºç®—æ³•</strong>:<ul><li><code>std::sort()</code>: ä½¿ç”¨å¿«é€Ÿæ’åºç®—æ³•å¯¹å…ƒç´ è¿›è¡Œæ’åºã€‚</li><li><code>std::stable_sort()</code>: ä½¿ç”¨ç¨³å®šæ’åºç®—æ³•(å¦‚å½’å¹¶æ’åº)å¯¹å…ƒç´ è¿›è¡Œæ’åºã€‚</li><li><code>std::partial_sort()</code>: å°†å‰ N ä¸ªå…ƒç´ æ’åº,å…¶ä»–å…ƒç´ ä¿æŒåŸæœ‰é¡ºåºã€‚</li><li><code>std::nth_element()</code>: å°†ç¬¬ N ä¸ªå…ƒç´ æ”¾åˆ°æ­£ç¡®çš„ä½ç½®,å…¶ä»–å…ƒç´ çš„ç›¸å¯¹é¡ºåºä¸å˜ã€‚</li></ul></li><li><strong>æŸ¥æ‰¾ç®—æ³•</strong>:<ul><li><code>std::find()</code>: åœ¨åºåˆ—ä¸­æŸ¥æ‰¾æŒ‡å®šå…ƒç´ ã€‚</li><li><code>std::find_if()</code>: ä½¿ç”¨è‡ªå®šä¹‰æ¡ä»¶åœ¨åºåˆ—ä¸­æŸ¥æ‰¾å…ƒç´ ã€‚</li><li><code>std::binary_search()</code>: åœ¨å·²æ’åºçš„åºåˆ—ä¸­è¿›è¡ŒäºŒåˆ†æŸ¥æ‰¾ã€‚</li><li><code>std::lower_bound()</code>: è¿”å›æŒ‡å‘åºåˆ—ä¸­ç¬¬ä¸€ä¸ªä¸å°äºç»™å®šå€¼çš„å…ƒç´ çš„è¿­ä»£å™¨ã€‚</li><li><code>std::upper_bound()</code>: è¿”å›æŒ‡å‘åºåˆ—ä¸­ç¬¬ä¸€ä¸ªå¤§äºç»™å®šå€¼çš„å…ƒç´ çš„è¿­ä»£å™¨ã€‚</li></ul></li><li><strong>ä¿®æ”¹ç®—æ³•</strong>:<ul><li><code>std::transform()</code>: å¯¹åºåˆ—ä¸­çš„æ¯ä¸ªå…ƒç´ åº”ç”¨ç»™å®šçš„å‡½æ•°ã€‚</li><li><code>std::replace()</code>: ç”¨æ–°å€¼æ›¿æ¢åºåˆ—ä¸­æ»¡è¶³æ¡ä»¶çš„å…ƒç´ ã€‚</li><li><code>std::reverse()</code>: åè½¬åºåˆ—ä¸­çš„å…ƒç´ ã€‚</li><li><code>std::rotate()</code>: å°†åºåˆ—ä¸­çš„å…ƒç´ å¾ªç¯ç§»åŠ¨æŒ‡å®šçš„è·ç¦»ã€‚</li></ul></li><li><strong>æ•°å€¼ç®—æ³•</strong>:<ul><li><code>std::accumulate()</code>: è®¡ç®—åºåˆ—ä¸­å…ƒç´ çš„ç´¯åŠ å’Œã€‚</li><li><code>std::inner_product()</code>: è®¡ç®—ä¸¤ä¸ªåºåˆ—çš„ç‚¹ç§¯ã€‚</li><li><code>std::partial_sum()</code>: è®¡ç®—åºåˆ—ä¸­å‰ N ä¸ªå…ƒç´ çš„ç´¯åŠ å’Œã€‚</li></ul></li><li><strong>é›†åˆç®—æ³•</strong>:<ul><li><code>std::merge()</code>: å°†ä¸¤ä¸ªæœ‰åºåºåˆ—åˆå¹¶æˆä¸€ä¸ªæœ‰åºåºåˆ—ã€‚</li><li><code>std::set_union()</code>: è®¡ç®—ä¸¤ä¸ªé›†åˆçš„å¹¶é›†ã€‚</li><li><code>std::set_intersection()</code>: è®¡ç®—ä¸¤ä¸ªé›†åˆçš„äº¤é›†ã€‚</li><li><code>std::set_difference()</code>: è®¡ç®—ä¸¤ä¸ªé›†åˆçš„å·®é›†ã€‚</li></ul></li></ol><p><strong>å¸¸ç”¨å¤´æ–‡ä»¶</strong></p><ol><li>å®¹å™¨:<ul><li><code>std::vector</code>: <code>&lt;vector&gt;</code></li><li><code>std::list</code>: <code>&lt;list&gt;</code></li><li><code>std::deque</code>: <code>&lt;deque&gt;</code></li><li><code>std::set</code>: <code>&lt;set&gt;</code></li><li><code>std::unordered_set</code>: <code>&lt;unordered_set&gt;</code></li><li><code>std::map</code>: <code>&lt;map&gt;</code></li><li><code>std::unordered_map</code>: <code>&lt;unordered_map&gt;</code></li><li><code>std::stack</code>: <code>&lt;stack&gt;</code></li><li><code>std::queue</code>: <code>&lt;queue&gt;</code></li></ul></li><li>ç®—æ³•:<ul><li><code>std::sort</code>: <code>&lt;algorithm&gt;</code></li><li><code>std::find</code>: <code>&lt;algorithm&gt;</code></li><li><code>std::accumulate</code>: <code>&lt;numeric&gt;</code></li><li><code>std::transform</code>: <code>&lt;algorithm&gt;</code></li><li><code>std::copy</code>: <code>&lt;algorithm&gt;</code></li></ul></li><li>å…¶ä»–å¸¸ç”¨å¤´æ–‡ä»¶:<ul><li><code>&lt;iostream&gt;</code>: ç”¨äºè¾“å…¥è¾“å‡º</li><li><code>&lt;string&gt;</code>: ç”¨äºå­—ç¬¦ä¸²æ“ä½œ</li><li><code>&lt;memory&gt;</code>: ç”¨äºæ™ºèƒ½æŒ‡é’ˆ</li><li><code>&lt;functional&gt;</code>: ç”¨äºå‡½æ•°å¯¹è±¡å’Œ lambda è¡¨è¾¾å¼</li></ul></li></ol><h3 id="çº¿æ€§å®¹å™¨"><a href="#çº¿æ€§å®¹å™¨" class="headerlink" title="çº¿æ€§å®¹å™¨"></a>çº¿æ€§å®¹å™¨</h3><h4 id="std-array"><a href="#std-array" class="headerlink" title="std::array"></a>std::array</h4><p>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨è¿™ä¸ª?</p><ul><li>èŠ‚çœå†…å­˜</li><li>ç›¸æ¯”äºæ™®é€šæ•°ç»„æ›´åŠ ç°ä»£åŒ–</li></ul><p>ä¸ <code>std::vector</code> ä¸åŒï¼Œ<code>std::array</code> å¯¹è±¡çš„å¤§å°æ˜¯å›ºå®šçš„ï¼Œå¦‚æœå®¹å™¨å¤§å°æ˜¯å›ºå®šçš„ï¼Œé‚£ä¹ˆå¯ä»¥ä¼˜å…ˆè€ƒè™‘ä½¿ç”¨ <code>std::array</code> å®¹å™¨ã€‚ å¦å¤–ç”±äº <code>std::vector</code> æ˜¯è‡ªåŠ¨æ‰©å®¹çš„ï¼Œå½“å­˜å…¥å¤§é‡çš„æ•°æ®åï¼Œå¹¶ä¸”å¯¹å®¹å™¨è¿›è¡Œäº†åˆ é™¤æ“ä½œï¼Œ å®¹å™¨å¹¶ä¸ä¼šè‡ªåŠ¨å½’è¿˜è¢«åˆ é™¤å…ƒç´ ç›¸åº”çš„å†…å­˜ï¼Œè¿™æ—¶å€™å°±éœ€è¦æ‰‹åŠ¨è¿è¡Œ <code>shrink_to_fit()</code> é‡Šæ”¾è¿™éƒ¨åˆ†å†…å­˜</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">  std::vector&lt;<span class="keyword">int</span>&gt; v;</span><br><span class="line">  std::cout &lt;&lt; <span class="string">&quot;size:&quot;</span> &lt;&lt; v.<span class="built_in">size</span>() &lt;&lt; std::endl;</span><br><span class="line">  std::cout &lt;&lt; <span class="string">&quot;capacity:&quot;</span> &lt;&lt; v.<span class="built_in">capacity</span>() &lt;&lt; std::endl;</span><br><span class="line">  v.<span class="built_in">push_back</span>(<span class="number">1</span>);</span><br><span class="line">  v.<span class="built_in">push_back</span>(<span class="number">2</span>);</span><br><span class="line">  v.<span class="built_in">push_back</span>(<span class="number">3</span>);</span><br><span class="line">  std::cout &lt;&lt; <span class="string">&quot;size:&quot;</span> &lt;&lt; v.<span class="built_in">size</span>() &lt;&lt; std::endl;  <span class="comment">// è¾“å‡º 3</span></span><br><span class="line">  std::cout &lt;&lt; <span class="string">&quot;capacity:&quot;</span> &lt;&lt; v.<span class="built_in">capacity</span>() &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">  v.<span class="built_in">clear</span>();</span><br><span class="line">  std::cout &lt;&lt; <span class="string">&quot;size:&quot;</span> &lt;&lt; v.<span class="built_in">size</span>() &lt;&lt; std::endl;  <span class="comment">// è¾“å‡º 3</span></span><br><span class="line">  std::cout &lt;&lt; <span class="string">&quot;capacity:&quot;</span> &lt;&lt; v.<span class="built_in">capacity</span>() &lt;&lt; std::endl;</span><br><span class="line">v.<span class="built_in">shrink_to_fit</span>();</span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;size:&quot;</span> &lt;&lt; v.<span class="built_in">size</span>() &lt;&lt; std::endl;         <span class="comment">// è¾“å‡º 0</span></span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;capacity:&quot;</span> &lt;&lt; v.<span class="built_in">capacity</span>() &lt;&lt; std::endl; </span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ <code>std::array</code> èƒ½å¤Ÿè®©ä»£ç å˜å¾—æ›´åŠ â€œç°ä»£åŒ–â€ï¼Œè€Œä¸”å°è£…äº†ä¸€äº›æ“ä½œå‡½æ•°ï¼Œæ¯”å¦‚è·å–æ•°ç»„å¤§å°ä»¥åŠæ£€æŸ¥æ˜¯å¦éç©ºï¼ŒåŒæ—¶è¿˜èƒ½å¤Ÿå‹å¥½çš„ä½¿ç”¨æ ‡å‡†åº“ä¸­çš„å®¹å™¨ç®—æ³•ï¼Œæ¯”å¦‚ <code>std::sort</code></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">std::array&lt;<span class="keyword">int</span>, 4&gt; arr = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>&#125;;</span><br><span class="line"></span><br><span class="line">arr.<span class="built_in">empty</span>(); <span class="comment">// æ£€æŸ¥å®¹å™¨æ˜¯å¦ä¸ºç©º</span></span><br><span class="line">arr.<span class="built_in">size</span>();  <span class="comment">// è¿”å›å®¹çº³çš„å…ƒç´ æ•°</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿­ä»£å™¨æ”¯æŒ</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">auto</span> &amp;i : arr)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç”¨ lambda è¡¨è¾¾å¼æ’åº</span></span><br><span class="line">std::<span class="built_in">sort</span>(arr.<span class="built_in">begin</span>(), arr.<span class="built_in">end</span>(), [](<span class="keyword">int</span> a, <span class="keyword">int</span> b) &#123;</span><br><span class="line">    <span class="keyword">return</span> b &lt; a;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ•°ç»„å¤§å°å‚æ•°å¿…é¡»æ˜¯å¸¸é‡è¡¨è¾¾å¼</span></span><br><span class="line"><span class="keyword">constexpr</span> <span class="keyword">int</span> len = <span class="number">4</span>;</span><br><span class="line">std::array&lt;<span class="keyword">int</span>, len&gt; arr = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// éæ³•,ä¸åŒäº C é£æ ¼æ•°ç»„ï¼Œstd::array ä¸ä¼šè‡ªåŠ¨é€€åŒ–æˆ T*</span></span><br><span class="line"><span class="comment">// int *arr_p = arr;</span></span><br></pre></td></tr></table></figure><p>å½“æˆ‘ä»¬å¼€å§‹ç”¨ä¸Šäº† <code>std::array</code> æ—¶ï¼Œéš¾å…ä¼šé‡åˆ°è¦å°†å…¶å…¼å®¹ C é£æ ¼çš„æ¥å£ï¼Œè¿™é‡Œæœ‰ä¸‰ç§åšæ³•ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">foo</span><span class="params">(<span class="keyword">int</span> *p, <span class="keyword">int</span> len)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">std::array&lt;<span class="keyword">int</span>, 4&gt; arr = &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// C é£æ ¼æ¥å£ä¼ å‚</span></span><br><span class="line"><span class="comment">// foo(arr, arr.size()); // éæ³•, æ— æ³•éšå¼è½¬æ¢</span></span><br><span class="line"><span class="built_in">foo</span>(&amp;arr[<span class="number">0</span>], arr.<span class="built_in">size</span>());</span><br><span class="line"><span class="built_in">foo</span>(arr.<span class="built_in">data</span>(), arr.<span class="built_in">size</span>());</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨ `std::sort`</span></span><br><span class="line">std::<span class="built_in">sort</span>(arr.<span class="built_in">begin</span>(), arr.<span class="built_in">end</span>());</span><br></pre></td></tr></table></figure><h4 id="std-forward-list"><a href="#std-forward-list" class="headerlink" title="std::forward_list"></a>std::forward_list</h4><p><code>std::forward_list</code> æ˜¯ä¸€ä¸ªåˆ—è¡¨å®¹å™¨ï¼Œä½¿ç”¨æ–¹æ³•å’Œ <code>std::list</code> åŸºæœ¬ç±»ä¼¼</p><p>éœ€è¦çŸ¥é“çš„æ˜¯ï¼Œå’Œ <code>std::list</code> çš„åŒå‘é“¾è¡¨çš„å®ç°ä¸åŒï¼Œ<code>std::forward_list</code> <strong>ä½¿ç”¨å•å‘é“¾è¡¨è¿›è¡Œå®ç°ï¼Œ æä¾›äº† <code>O(1)</code> å¤æ‚åº¦çš„å…ƒç´ æ’å…¥ï¼Œä¸æ”¯æŒå¿«é€Ÿéšæœºè®¿é—®</strong>ï¼ˆè¿™ä¹Ÿæ˜¯é“¾è¡¨çš„ç‰¹ç‚¹ï¼‰ï¼Œ ä¹Ÿæ˜¯æ ‡å‡†åº“å®¹å™¨ä¸­å”¯ä¸€ä¸€ä¸ªä¸æä¾› <code>size()</code> æ–¹æ³•çš„å®¹å™¨ã€‚<strong>å½“ä¸éœ€è¦åŒå‘è¿­ä»£æ—¶ï¼Œå…·æœ‰æ¯” <code>std::list</code> æ›´é«˜çš„ç©ºé—´åˆ©ç”¨ç‡</strong></p><h3 id="æ— åºå®¹å™¨"><a href="#æ— åºå®¹å™¨" class="headerlink" title="æ— åºå®¹å™¨"></a>æ— åºå®¹å™¨</h3><p>æˆ‘ä»¬å·²ç»ç†ŸçŸ¥äº†ä¼ ç»Ÿ C++ ä¸­çš„æœ‰åºå®¹å™¨ <code>std::map</code>/<code>std::set</code>ï¼Œè¿™äº›å…ƒç´ å†…éƒ¨é€šè¿‡çº¢é»‘æ ‘è¿›è¡Œå®ç°ï¼Œ æ’å…¥å’Œæœç´¢çš„å¹³å‡å¤æ‚åº¦å‡ä¸º <strong><code>O(log(size))</code></strong>ã€‚<strong>åœ¨æ’å…¥å…ƒç´ æ—¶å€™ï¼Œä¼šæ ¹æ® <code>&lt;</code> æ“ä½œç¬¦æ¯”è¾ƒå…ƒç´ å¤§å°å¹¶åˆ¤æ–­å…ƒç´ æ˜¯å¦ç›¸åŒï¼Œ å¹¶é€‰æ‹©åˆé€‚çš„ä½ç½®æ’å…¥åˆ°å®¹å™¨ä¸­ã€‚</strong>å½“å¯¹è¿™ä¸ªå®¹å™¨ä¸­çš„å…ƒç´ è¿›è¡Œéå†æ—¶ï¼Œè¾“å‡ºç»“æœä¼šæŒ‰ç…§ <code>&lt;</code> æ“ä½œç¬¦çš„é¡ºåºæ¥é€ä¸ªéå†ã€‚</p><p>è€Œæ— åºå®¹å™¨ä¸­çš„å…ƒç´ æ˜¯ä¸è¿›è¡Œæ’åºçš„ï¼Œå†…éƒ¨é€šè¿‡ Hash è¡¨å®ç°ï¼Œæ’å…¥å’Œæœç´¢å…ƒç´ çš„å¹³å‡å¤æ‚åº¦ä¸º <code>O(constant)</code>ï¼Œ åœ¨ä¸å…³å¿ƒå®¹å™¨å†…éƒ¨å…ƒç´ é¡ºåºæ—¶ï¼Œèƒ½å¤Ÿè·å¾—æ˜¾è‘—çš„æ€§èƒ½æå‡.</p><p>C++11 å¼•å…¥äº†çš„ä¸¤ç»„æ— åºå®¹å™¨åˆ†åˆ«æ˜¯ï¼š<code>std::unordered_map</code>/<code>std::unordered_multimap</code> å’Œ <code>std::unordered_set</code>/<code>std::unordered_multiset</code>,å®ƒä»¬çš„ç”¨æ³•å’ŒåŸæœ‰çš„ <code>std::map</code>/<code>std::multimap</code>/<code>std::set</code>/<code>set::multiset</code> åŸºæœ¬ç±»ä¼¼</p><blockquote><p>æ— åºå®¹å™¨æ’å…¥å’Œæœç´¢å…ƒç´ çš„å¹³å‡å¤æ‚åº¦O(1),æ‰€ä»¥ä¸éœ€è¦æ’åºæ—¶å¯ä»¥è€ƒè™‘ä½¿ç”¨</p></blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unordered_map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;map&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ä¸¤ç»„ç»“æ„æŒ‰åŒæ ·çš„é¡ºåºåˆå§‹åŒ–</span></span><br><span class="line">    std::unordered_map&lt;<span class="keyword">int</span>, std::string&gt; u = &#123;</span><br><span class="line">        &#123;<span class="number">1</span>, <span class="string">&quot;1&quot;</span>&#125;,</span><br><span class="line">        &#123;<span class="number">3</span>, <span class="string">&quot;3&quot;</span>&#125;,</span><br><span class="line">        &#123;<span class="number">2</span>, <span class="string">&quot;2&quot;</span>&#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    std::map&lt;<span class="keyword">int</span>, std::string&gt; v = &#123;</span><br><span class="line">        &#123;<span class="number">1</span>, <span class="string">&quot;1&quot;</span>&#125;,</span><br><span class="line">        &#123;<span class="number">3</span>, <span class="string">&quot;3&quot;</span>&#125;,</span><br><span class="line">        &#123;<span class="number">2</span>, <span class="string">&quot;2&quot;</span>&#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ†åˆ«å¯¹ä¸¤ç»„ç»“æ„è¿›è¡Œéå†</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;std::unordered_map&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">const</span> <span class="keyword">auto</span> &amp; n : u)</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Key:[&quot;</span> &lt;&lt; n.first &lt;&lt; <span class="string">&quot;] Value:[&quot;</span> &lt;&lt; n.second &lt;&lt; <span class="string">&quot;]\n&quot;</span>;</span><br><span class="line"></span><br><span class="line">    std::cout &lt;&lt; std::endl;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;std::map&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    <span class="keyword">for</span>( <span class="keyword">const</span> <span class="keyword">auto</span> &amp; n : v)</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Key:[&quot;</span> &lt;&lt; n.first &lt;&lt; <span class="string">&quot;] Value:[&quot;</span> &lt;&lt; n.second &lt;&lt; <span class="string">&quot;]\n&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å…ƒç»„"><a href="#å…ƒç»„" class="headerlink" title="å…ƒç»„"></a>å…ƒç»„</h3><p>çºµè§‚ä¼ ç»Ÿ C++ ä¸­çš„å®¹å™¨ï¼Œé™¤äº† <code>std::pair</code> å¤–ï¼Œ ä¼¼ä¹æ²¡æœ‰ç°æˆçš„ç»“æ„èƒ½å¤Ÿç”¨æ¥å­˜æ”¾ä¸åŒç±»å‹çš„æ•°æ®ï¼ˆé€šå¸¸æˆ‘ä»¬ä¼šè‡ªå·±å®šä¹‰ç»“æ„ï¼‰ã€‚ ä½† <code>std::pair</code> çš„ç¼ºé™·æ˜¯æ˜¾è€Œæ˜“è§çš„ï¼Œåªèƒ½ä¿å­˜ä¸¤ä¸ªå…ƒç´ ã€‚</p><p><strong>æ ¸å¿ƒæ“ä½œ</strong></p><p>å…³äºå…ƒç»„çš„ä½¿ç”¨æœ‰ä¸‰ä¸ªæ ¸å¿ƒçš„å‡½æ•°ï¼š</p><ol><li><code>std::make_tuple</code>: æ„é€ å…ƒç»„(è£…åŒ…)</li><li><code>std::get</code>: è·å¾—å…ƒç»„æŸä¸ªä½ç½®çš„å€¼</li><li><code>std::tie</code>: å…ƒç»„æ‹†åŒ…</li></ol><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;tuple&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">auto</span> <span class="title">get_student</span><span class="params">(<span class="keyword">int</span> id)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// è¿”å›ç±»å‹è¢«æ¨æ–­ä¸º std::tuple&lt;double, char, std::string&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (id == <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span> std::<span class="built_in">make_tuple</span>(<span class="number">3.8</span>, <span class="string">&#x27;A&#x27;</span>, <span class="string">&quot;å¼ ä¸‰&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (id == <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">return</span> std::<span class="built_in">make_tuple</span>(<span class="number">2.9</span>, <span class="string">&#x27;C&#x27;</span>, <span class="string">&quot;æå››&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (id == <span class="number">2</span>)</span><br><span class="line">        <span class="keyword">return</span> std::<span class="built_in">make_tuple</span>(<span class="number">1.7</span>, <span class="string">&#x27;D&#x27;</span>, <span class="string">&quot;ç‹äº”&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> std::<span class="built_in">make_tuple</span>(<span class="number">0.0</span>, <span class="string">&#x27;D&#x27;</span>, <span class="string">&quot;null&quot;</span>);</span><br><span class="line">    <span class="comment">// å¦‚æœåªå†™ 0 ä¼šå‡ºç°æ¨æ–­é”™è¯¯, ç¼–è¯‘å¤±è´¥</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">auto</span> student = <span class="built_in">get_student</span>(<span class="number">0</span>);</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;ID: 0, &quot;</span></span><br><span class="line">    &lt;&lt; <span class="string">&quot;GPA: &quot;</span> &lt;&lt; std::get&lt;<span class="number">0</span>&gt;(student) &lt;&lt; <span class="string">&quot;, &quot;</span></span><br><span class="line">    &lt;&lt; <span class="string">&quot;æˆç»©: &quot;</span> &lt;&lt; std::get&lt;<span class="number">1</span>&gt;(student) &lt;&lt; <span class="string">&quot;, &quot;</span></span><br><span class="line">    &lt;&lt; <span class="string">&quot;å§“å: &quot;</span> &lt;&lt; std::get&lt;<span class="number">2</span>&gt;(student) &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">double</span> gpa;</span><br><span class="line">    <span class="keyword">char</span> grade;</span><br><span class="line">    std::string name;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å…ƒç»„è¿›è¡Œæ‹†åŒ…</span></span><br><span class="line">    std::<span class="built_in">tie</span>(gpa, grade, name) = <span class="built_in">get_student</span>(<span class="number">1</span>);</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;ID: 1, &quot;</span></span><br><span class="line">    &lt;&lt; <span class="string">&quot;GPA: &quot;</span> &lt;&lt; gpa &lt;&lt; <span class="string">&quot;, &quot;</span></span><br><span class="line">    &lt;&lt; <span class="string">&quot;æˆç»©: &quot;</span> &lt;&lt; grade &lt;&lt; <span class="string">&quot;, &quot;</span></span><br><span class="line">    &lt;&lt; <span class="string">&quot;å§“å: &quot;</span> &lt;&lt; name &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br></pre></td></tr></table></figure><p><code>std::get</code> é™¤äº†ä½¿ç”¨å¸¸é‡è·å–å…ƒç»„å¯¹è±¡å¤–ï¼ŒC++14 å¢åŠ äº†<strong>ä½¿ç”¨ç±»å‹æ¥è·å–å…ƒç»„ä¸­çš„å¯¹è±¡</strong>ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">std::tuple&lt;std::string, <span class="keyword">double</span>, <span class="keyword">double</span>, <span class="keyword">int</span>&gt; <span class="title">t</span><span class="params">(<span class="string">&quot;123&quot;</span>, <span class="number">4.5</span>, <span class="number">6.7</span>, <span class="number">8</span>)</span></span>;</span><br><span class="line">std::cout &lt;&lt; std::get&lt;std::string&gt;(t) &lt;&lt; std::endl;</span><br><span class="line">std::cout &lt;&lt; std::get&lt;<span class="keyword">double</span>&gt;(t) &lt;&lt; std::endl; <span class="comment">// éæ³•, å¼•å‘ç¼–è¯‘æœŸé”™è¯¯</span></span><br><span class="line">std::cout &lt;&lt; std::get&lt;<span class="number">3</span>&gt;(t) &lt;&lt; std::endl;</span><br></pre></td></tr></table></figure><h4 id="è¿è¡ŒæœŸç´¢å¼•"><a href="#è¿è¡ŒæœŸç´¢å¼•" class="headerlink" title="è¿è¡ŒæœŸç´¢å¼•"></a>è¿è¡ŒæœŸç´¢å¼•</h4><p>å¦‚æœä½ ä»”ç»†æ€è€ƒä¸€ä¸‹å¯èƒ½å°±ä¼šå‘ç°ä¸Šé¢ä»£ç çš„é—®é¢˜ï¼Œ<code>std::get&lt;&gt;</code> ä¾èµ–ä¸€ä¸ªç¼–è¯‘æœŸçš„å¸¸é‡ï¼Œæ‰€ä»¥ä¸‹é¢çš„æ–¹å¼æ˜¯ä¸åˆæ³•çš„ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> index = <span class="number">1</span>;</span><br><span class="line">std::get&lt;index&gt;(t);</span><br></pre></td></tr></table></figure><blockquote><p>å¯ä»¥é€šè¿‡constexprè§£å†³è¿™ä¸ªé—®é¢˜</p></blockquote><p>å¦‚æœæƒ³é€šè¿‡è¿è¡ŒæœŸè¦æ€ä¹ˆå¤„ç†ï¼Ÿç­”æ¡ˆæ˜¯ï¼Œä½¿ç”¨ <code>std::variant&lt;&gt;</code>ï¼ˆC++ 17 å¼•å…¥ï¼‰ï¼Œæä¾›ç»™ <code>variant&lt;&gt;</code> çš„ç±»å‹æ¨¡æ¿å‚æ•° å¯ä»¥è®©ä¸€ä¸ª <code>variant&lt;&gt;</code> ä»è€Œå®¹çº³æä¾›çš„å‡ ç§ç±»å‹çš„å˜é‡ï¼ˆåœ¨å…¶ä»–è¯­è¨€ï¼Œä¾‹å¦‚ Python/JavaScript ç­‰ï¼Œ<strong>è¡¨ç°ä¸ºåŠ¨æ€ç±»å‹</strong>ï¼‰ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;variant&gt;</span></span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">size_t</span> n, <span class="keyword">typename</span>... T&gt;</span><br><span class="line"><span class="keyword">constexpr</span> std::variant&lt;T...&gt; _tuple_index(<span class="keyword">const</span> std::tuple&lt;T...&gt;&amp; tpl, <span class="keyword">size_t</span> i) &#123;</span><br><span class="line">    <span class="function"><span class="keyword">if</span> <span class="title">constexpr</span> <span class="params">(n &gt;= <span class="keyword">sizeof</span>...(T))</span></span></span><br><span class="line"><span class="function">        <span class="keyword">throw</span> <span class="title">std::out_of_range</span><span class="params">(<span class="string">&quot;è¶Šç•Œ.&quot;</span>)</span></span>;</span><br><span class="line">    <span class="keyword">if</span> (i == n)</span><br><span class="line">        <span class="keyword">return</span> std::variant&lt;T...&gt;&#123; std::in_place_index&lt;n&gt;, std::get&lt;n&gt;(tpl) &#125;;</span><br><span class="line">    <span class="keyword">return</span> _tuple_index&lt;(n &lt; <span class="keyword">sizeof</span>...(T)<span class="number">-1</span> ? n+<span class="number">1</span> : <span class="number">0</span>)&gt;(tpl, i);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span>... T&gt;</span><br><span class="line"><span class="function"><span class="keyword">constexpr</span> std::variant&lt;T...&gt; <span class="title">tuple_index</span><span class="params">(<span class="keyword">const</span> std::tuple&lt;T...&gt;&amp; tpl, <span class="keyword">size_t</span> i)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> _tuple_index&lt;<span class="number">0</span>&gt;(tpl, i);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T0, <span class="keyword">typename</span> ... Ts&gt;</span><br><span class="line">std::ostream &amp; <span class="keyword">operator</span>&lt;&lt; (std::ostream &amp; s, std::variant&lt;T0, Ts...&gt; <span class="keyword">const</span> &amp; v) &#123; </span><br><span class="line">    std::<span class="built_in">visit</span>([&amp;](<span class="keyword">auto</span> &amp;&amp; x)&#123; s &lt;&lt; x;&#125;, v); </span><br><span class="line">    <span class="keyword">return</span> s;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·æˆ‘ä»¬å°±èƒ½ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> i = <span class="number">1</span>;</span><br><span class="line">std::cout &lt;&lt; <span class="built_in">tuple_index</span>(t, i) &lt;&lt; std::endl;</span><br></pre></td></tr></table></figure><h4 id="å…ƒç»„åˆå¹¶ä¸éå†"><a href="#å…ƒç»„åˆå¹¶ä¸éå†" class="headerlink" title="å…ƒç»„åˆå¹¶ä¸éå†"></a>å…ƒç»„åˆå¹¶ä¸éå†</h4><p>è¿˜æœ‰ä¸€ä¸ªå¸¸è§çš„éœ€æ±‚å°±æ˜¯<strong>åˆå¹¶ä¸¤ä¸ªå…ƒç»„</strong>ï¼Œè¿™å¯ä»¥é€šè¿‡ <code>std::tuple_cat</code> æ¥å®ç°ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">std::tuple t = std::<span class="built_in">make_tuple</span>(<span class="number">1</span>, <span class="number">2.0</span>, <span class="string">&quot;3&quot;</span>);</span><br><span class="line"> <span class="keyword">auto</span> new_tuple = std::<span class="built_in">tuple_cat</span>(<span class="built_in">get_student</span>(<span class="number">1</span>), std::<span class="built_in">move</span>(t));</span><br></pre></td></tr></table></figure><p>é©¬ä¸Šå°±èƒ½å¤Ÿå‘ç°ï¼Œåº”è¯¥å¦‚ä½•å¿«é€Ÿéå†ä¸€ä¸ªå…ƒç»„ï¼Ÿä½†æ˜¯æˆ‘ä»¬åˆšæ‰ä»‹ç»äº†å¦‚ä½•åœ¨è¿è¡ŒæœŸé€šè¿‡éå¸¸æ•°ç´¢å¼•ä¸€ä¸ª <code>tuple</code> é‚£ä¹ˆéå†å°±å˜å¾—ç®€å•äº†ï¼Œ é¦–å…ˆæˆ‘ä»¬éœ€è¦çŸ¥é“ä¸€ä¸ªå…ƒç»„çš„é•¿åº¦ï¼Œå¯ä»¥ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function"><span class="keyword">auto</span> <span class="title">tuple_len</span><span class="params">(T &amp;tpl)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> std::tuple_size&lt;T&gt;::value;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±èƒ½å¤Ÿå¯¹å…ƒç»„è¿›è¡Œè¿­ä»£äº†ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¿­ä»£</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i != <span class="built_in">tuple_len</span>(new_tuple); ++i)</span><br><span class="line">    <span class="comment">// è¿è¡ŒæœŸç´¢å¼•</span></span><br><span class="line">    std::cout &lt;&lt; <span class="built_in">tuple_index</span>(new_tuple, i) &lt;&lt; std::endl;</span><br></pre></td></tr></table></figure><h2 id="æ™ºèƒ½æŒ‡é’ˆå’Œå†…å­˜ç®¡ç†"><a href="#æ™ºèƒ½æŒ‡é’ˆå’Œå†…å­˜ç®¡ç†" class="headerlink" title="æ™ºèƒ½æŒ‡é’ˆå’Œå†…å­˜ç®¡ç†"></a>æ™ºèƒ½æŒ‡é’ˆå’Œå†…å­˜ç®¡ç†</h2><p>åœ¨ä¼ ç»Ÿ C++ ä¸­ï¼Œã€è®°å¾—ã€æ‰‹åŠ¨é‡Šæ”¾èµ„æºï¼Œæ€»ä¸æ˜¯æœ€ä½³å®è·µã€‚å› ä¸ºæˆ‘ä»¬å¾ˆæœ‰å¯èƒ½å°±å¿˜è®°äº†å»é‡Šæ”¾èµ„æºè€Œå¯¼è‡´æ³„éœ²ã€‚ æ‰€ä»¥é€šå¸¸çš„åšæ³•æ˜¯å¯¹äºä¸€ä¸ªå¯¹è±¡è€Œè¨€ï¼Œæˆ‘ä»¬<strong>åœ¨æ„é€ å‡½æ•°çš„æ—¶å€™ç”³è¯·ç©ºé—´ï¼Œè€Œåœ¨ææ„å‡½æ•°ï¼ˆåœ¨ç¦»å¼€ä½œç”¨åŸŸæ—¶è°ƒç”¨ï¼‰çš„æ—¶å€™é‡Šæ”¾ç©ºé—´</strong>ï¼Œ ä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„ RAII èµ„æºè·å–å³åˆå§‹åŒ–æŠ€æœ¯ã€‚</p><p>å‡¡äº‹éƒ½æœ‰ä¾‹å¤–ï¼Œ<strong>æˆ‘ä»¬æ€»ä¼šæœ‰éœ€è¦å°†å¯¹è±¡åœ¨è‡ªç”±å­˜å‚¨ä¸Šåˆ†é…çš„éœ€æ±‚</strong>(å †ç©ºé—´,æŒ‡é’ˆç­‰)ï¼Œåœ¨ä¼ ç»Ÿ C++ é‡Œæˆ‘ä»¬åªå¥½ä½¿ç”¨ <code>new</code> å’Œ <code>delete</code> å» ã€è®°å¾—ã€å¯¹èµ„æºè¿›è¡Œé‡Šæ”¾ã€‚è€Œ C++11 å¼•å…¥äº†æ™ºèƒ½æŒ‡é’ˆçš„æ¦‚å¿µï¼Œä½¿ç”¨äº†å¼•ç”¨è®¡æ•°çš„æƒ³æ³•ï¼Œè®©ç¨‹åºå‘˜ä¸å†éœ€è¦å…³å¿ƒæ‰‹åŠ¨é‡Šæ”¾å†…å­˜ã€‚ è¿™äº›æ™ºèƒ½æŒ‡é’ˆåŒ…æ‹¬ <code>std::shared_ptr</code>/<code>std::unique_ptr</code>/<code>std::weak_ptr</code>ï¼Œä½¿ç”¨å®ƒä»¬éœ€è¦åŒ…å«å¤´æ–‡ä»¶ <code>&lt;memory&gt;</code>ã€‚</p><blockquote><p>æ³¨æ„ï¼š<strong>å¼•ç”¨è®¡æ•°ä¸æ˜¯åƒåœ¾å›æ”¶ï¼Œå¼•ç”¨è®¡æ•°èƒ½å¤Ÿå°½å¿«æ”¶å›ä¸å†è¢«ä½¿ç”¨çš„å¯¹è±¡</strong>ï¼ŒåŒæ—¶åœ¨å›æ”¶çš„è¿‡ç¨‹ä¸­ä¹Ÿä¸ä¼šé€ æˆé•¿æ—¶é—´çš„ç­‰å¾…ï¼Œ æ›´èƒ½å¤Ÿæ¸…æ™°æ˜ç¡®çš„è¡¨æ˜èµ„æºçš„ç”Ÿå‘½å‘¨æœŸã€‚</p></blockquote><h4 id="std-shared-ptr"><a href="#std-shared-ptr" class="headerlink" title="std::shared_ptr"></a>std::shared_ptr</h4><p><code>std::shared_ptr</code> æ˜¯ä¸€ç§æ™ºèƒ½æŒ‡é’ˆï¼Œå®ƒèƒ½å¤Ÿè®°å½•å¤šå°‘ä¸ª <code>shared_ptr</code> å…±åŒæŒ‡å‘ä¸€ä¸ªå¯¹è±¡ï¼Œä»è€Œæ¶ˆé™¤æ˜¾å¼çš„è°ƒç”¨ <code>delete</code>ï¼Œå½“å¼•ç”¨è®¡æ•°å˜ä¸ºé›¶çš„æ—¶å€™å°±ä¼šå°†å¯¹è±¡è‡ªåŠ¨åˆ é™¤ã€‚</p><p>ä½†è¿˜ä¸å¤Ÿï¼Œå› ä¸ºä½¿ç”¨ <code>std::shared_ptr</code> ä»ç„¶éœ€è¦ä½¿ç”¨ <code>new</code> æ¥è°ƒç”¨ï¼Œè¿™ä½¿å¾—ä»£ç å‡ºç°äº†æŸç§ç¨‹åº¦ä¸Šçš„ä¸å¯¹ç§°ã€‚</p><p><code>std::make_shared</code> å°±èƒ½å¤Ÿç”¨æ¥æ¶ˆé™¤æ˜¾å¼çš„ä½¿ç”¨ <code>new</code>ï¼Œæ‰€ä»¥<code>std::make_shared</code> ä¼šåˆ†é…åˆ›å»ºä¼ å…¥å‚æ•°ä¸­çš„å¯¹è±¡ï¼Œ å¹¶è¿”å›è¿™ä¸ªå¯¹è±¡ç±»å‹çš„<code>std::shared_ptr</code>æŒ‡é’ˆã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;memory&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">foo</span><span class="params">(std::shared_ptr&lt;<span class="keyword">int</span>&gt; i)</span> </span>&#123;</span><br><span class="line">    (*i)++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// auto pointer = new int(10); // illegal, no direct assignment</span></span><br><span class="line">    <span class="comment">// Constructed a std::shared_ptr</span></span><br><span class="line">    <span class="keyword">auto</span> pointer = std::make_shared&lt;<span class="keyword">int</span>&gt;(<span class="number">10</span>);</span><br><span class="line">    <span class="built_in">foo</span>(pointer);</span><br><span class="line">    std::cout &lt;&lt; *pointer &lt;&lt; std::endl; <span class="comment">// 11</span></span><br><span class="line">    <span class="comment">// The shared_ptr will be destructed before leaving the scope</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>std::shared_ptr</code> å¯ä»¥é€šè¿‡ <code>get()</code> æ–¹æ³•æ¥è·å–åŸå§‹æŒ‡é’ˆï¼Œé€šè¿‡ <code>reset()</code> æ¥å‡å°‘ä¸€ä¸ªå¼•ç”¨è®¡æ•°ï¼Œ å¹¶é€šè¿‡<code>use_count()</code>æ¥æŸ¥çœ‹ä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨è®¡æ•°ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">auto</span> pointer = std::make_shared&lt;<span class="keyword">int</span>&gt;(<span class="number">10</span>);</span><br><span class="line"><span class="keyword">auto</span> pointer2 = pointer; <span class="comment">// å¼•ç”¨è®¡æ•°+1</span></span><br><span class="line"><span class="keyword">auto</span> pointer3 = pointer; <span class="comment">// å¼•ç”¨è®¡æ•°+1</span></span><br><span class="line"><span class="keyword">int</span> *p = pointer.<span class="built_in">get</span>();  <span class="comment">// è¿™æ ·ä¸ä¼šå¢åŠ å¼•ç”¨è®¡æ•°</span></span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;pointer.use_count() = &quot;</span> &lt;&lt; pointer.<span class="built_in">use_count</span>() &lt;&lt; std::endl;   <span class="comment">// 3</span></span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;pointer2.use_count() = &quot;</span> &lt;&lt; pointer2.<span class="built_in">use_count</span>() &lt;&lt; std::endl; <span class="comment">// 3</span></span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;pointer3.use_count() = &quot;</span> &lt;&lt; pointer3.<span class="built_in">use_count</span>() &lt;&lt; std::endl; <span class="comment">// 3</span></span><br><span class="line"></span><br><span class="line">pointer2.<span class="built_in">reset</span>();</span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;reset pointer2:&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;pointer.use_count() = &quot;</span> &lt;&lt; pointer.<span class="built_in">use_count</span>() &lt;&lt; std::endl;   <span class="comment">// 2</span></span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;pointer2.use_count() = &quot;</span></span><br><span class="line">          &lt;&lt; pointer2.<span class="built_in">use_count</span>() &lt;&lt; std::endl;           <span class="comment">// pointer2 å·² reset; 0</span></span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;pointer3.use_count() = &quot;</span> &lt;&lt; pointer3.<span class="built_in">use_count</span>() &lt;&lt; std::endl; <span class="comment">// 2</span></span><br><span class="line">pointer3.<span class="built_in">reset</span>();</span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;reset pointer3:&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;pointer.use_count() = &quot;</span> &lt;&lt; pointer.<span class="built_in">use_count</span>() &lt;&lt; std::endl;   <span class="comment">// 1</span></span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;pointer2.use_count() = &quot;</span> &lt;&lt; pointer2.<span class="built_in">use_count</span>() &lt;&lt; std::endl; <span class="comment">// 0</span></span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;pointer3.use_count() = &quot;</span></span><br><span class="line">          &lt;&lt; pointer3.<span class="built_in">use_count</span>() &lt;&lt; std::endl;           <span class="comment">// pointer3 å·² reset; 0</span></span><br></pre></td></tr></table></figure><h4 id="std-unique-ptr"><a href="#std-unique-ptr" class="headerlink" title="std::unique_ptr"></a>std::unique_ptr</h4><p><code>std::unique_ptr</code> æ˜¯ä¸€ç§ç‹¬å çš„æ™ºèƒ½æŒ‡é’ˆï¼Œå®ƒ<strong>ç¦æ­¢å…¶ä»–æ™ºèƒ½æŒ‡é’ˆä¸å…¶å…±äº«åŒä¸€ä¸ªå¯¹è±¡</strong>ï¼Œä»è€Œä¿è¯ä»£ç çš„å®‰å…¨</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">std::unique_ptr&lt;<span class="keyword">int</span>&gt; pointer = std::make_unique&lt;<span class="keyword">int</span>&gt;(<span class="number">10</span>); <span class="comment">// make_unique ä» C++14 å¼•å…¥std::unique_ptr&lt;int&gt; pointer2 = pointer; // éæ³•</span></span><br></pre></td></tr></table></figure><p>C++11 æ²¡æœ‰æä¾› <code>std::make_unique</code>ï¼Œå¯ä»¥è‡ªè¡Œå®ç°ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T, <span class="keyword">typename</span> ...Args&gt;</span></span><br><span class="line"><span class="function">std::unique_ptr&lt;T&gt; <span class="title">make_unique</span><span class="params">( Args&amp;&amp; ...args )</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> std::unique_ptr&lt;T&gt;( <span class="keyword">new</span> <span class="built_in">T</span>( std::forward&lt;Args&gt;(args)... ) );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ—¢ç„¶æ˜¯ç‹¬å ï¼Œæ¢å¥è¯è¯´å°±æ˜¯ä¸å¯å¤åˆ¶ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬å¯<strong>ä»¥åˆ©ç”¨ <code>std::move</code> å°†å…¶è½¬ç§»ç»™å…¶ä»–çš„ <code>unique_ptr</code></strong>ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;memory&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Foo</span> &#123;</span></span><br><span class="line">    <span class="built_in">Foo</span>() &#123; std::cout &lt;&lt; <span class="string">&quot;Foo::Foo&quot;</span> &lt;&lt; std::endl; &#125;</span><br><span class="line">    ~<span class="built_in">Foo</span>() &#123; std::cout &lt;&lt; <span class="string">&quot;Foo::~Foo&quot;</span> &lt;&lt; std::endl; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">foo</span><span class="params">()</span> </span>&#123; std::cout &lt;&lt; <span class="string">&quot;Foo::foo&quot;</span> &lt;&lt; std::endl; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">f</span><span class="params">(<span class="keyword">const</span> Foo &amp;)</span> </span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;f(const Foo&amp;)&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function">std::unique_ptr&lt;Foo&gt; <span class="title">p1</span><span class="params">(std::make_unique&lt;Foo&gt;())</span></span>;</span><br><span class="line">    <span class="comment">// p1 ä¸ç©º, è¾“å‡º</span></span><br><span class="line">    <span class="keyword">if</span> (p1) p1-&gt;<span class="built_in">foo</span>();</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function">std::unique_ptr&lt;Foo&gt; <span class="title">p2</span><span class="params">(std::move(p1))</span></span>;</span><br><span class="line">        <span class="comment">// p2 ä¸ç©º, è¾“å‡º</span></span><br><span class="line">        <span class="built_in">f</span>(*p2);</span><br><span class="line">        <span class="comment">// p2 ä¸ç©º, è¾“å‡º</span></span><br><span class="line">        <span class="keyword">if</span>(p2) p2-&gt;<span class="built_in">foo</span>();</span><br><span class="line">        <span class="comment">// p1 ä¸ºç©º, æ— è¾“å‡º</span></span><br><span class="line">        <span class="keyword">if</span>(p1) p1-&gt;<span class="built_in">foo</span>();</span><br><span class="line">        p1 = std::<span class="built_in">move</span>(p2);</span><br><span class="line">        <span class="comment">// p2 ä¸ºç©º, æ— è¾“å‡º</span></span><br><span class="line">        <span class="keyword">if</span>(p2) p2-&gt;<span class="built_in">foo</span>();</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;p2 è¢«é”€æ¯&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// p1 ä¸ç©º, è¾“å‡º</span></span><br><span class="line">    <span class="keyword">if</span> (p1) p1-&gt;<span class="built_in">foo</span>();</span><br><span class="line">    <span class="comment">// Foo çš„å®ä¾‹ä¼šåœ¨ç¦»å¼€ä½œç”¨åŸŸæ—¶è¢«é”€æ¯</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ä½¿ç”¨ <code>std::move(p1)</code> å°† <code>p1</code> çš„æ‰€æœ‰æƒè½¬ç§»ç»™ <code>p2</code> æ—¶, <code>p1</code> ä¼šå˜ä¸ºç©ºæŒ‡é’ˆçš„åŸå› å¦‚ä¸‹:</p><ol><li><code>std::unique_ptr</code> æ˜¯ä¸€ç§ç‹¬å å¼çš„æ™ºèƒ½æŒ‡é’ˆ,è¿™æ„å‘³ç€ä¸€ä¸ª <code>std::unique_ptr</code> å¯¹è±¡åªèƒ½æ‹¥æœ‰ä¸€ä¸ªåŠ¨æ€åˆ†é…çš„å¯¹è±¡çš„æ‰€æœ‰æƒã€‚</li><li>å½“ä½ ä½¿ç”¨ <code>std::move(p1)</code> æ—¶, <code>p1</code> çš„æ‰€æœ‰æƒè¢«è½¬ç§»ç»™äº† <code>p2</code>ã€‚è¿™æ˜¯å› ä¸º <code>std::move</code> å‡½æ•°å°† <code>p1</code> è½¬æ¢ä¸ºä¸€ä¸ªå³å€¼å¼•ç”¨,ä»è€Œä½¿æ‰€æœ‰æƒä» <code>p1</code> è½¬ç§»åˆ° <code>p2</code>ã€‚</li><li>ä¸€æ—¦æ‰€æœ‰æƒè¢«è½¬ç§»,<code>p1</code> å°±ä¸å†æ‹¥æœ‰ä»»ä½•åŠ¨æ€åˆ†é…çš„å¯¹è±¡ã€‚å› æ­¤, <code>p1</code> è¢«è®¾ç½®ä¸ºç©ºæŒ‡é’ˆ,ä»¥ç¡®ä¿å®ƒä¸ä¼šè¢«ç”¨äºè®¿é—®å·²ç»è¢«è½¬ç§»æ‰€æœ‰æƒçš„å¯¹è±¡ã€‚</li></ol><p>è¿™ç§è¡Œä¸ºæ˜¯ <code>std::unique_ptr</code> è®¾è®¡çš„ä¸€éƒ¨åˆ†,æ—¨åœ¨ç¡®ä¿ç¨‹åºå‘˜ä¸ä¼šæ„å¤–åœ°ä½¿ç”¨å·²ç»å¤±å»æ‰€æœ‰æƒçš„æŒ‡é’ˆã€‚è¿™æ ·å¯ä»¥å¸®åŠ©æˆ‘ä»¬é¿å…æ‚¬ç©ºæŒ‡é’ˆå’Œå†…å­˜æ³„æ¼ç­‰å¸¸è§çš„é”™è¯¯</p></blockquote><p>ä¸Šé¢ä»£ç å¯ä»¥çœ‹å‡ºunique_ptrå­˜åœ¨ä½œç”¨åŸŸ,åœ¨ä½œç”¨åŸŸå†…å¦‚æœè¢«è½¬ç§»åˆ°å…¶ä»–unque_pträ¸Šç¦»å¼€ä½œç”¨åŸŸè¢«é”€æ¯,åŒæ—¶åŸæœ¬çš„åœ¨å…¶ä»–ä½œç”¨åŸŸå†…ä¸å—å½±å“.</p><h3 id="std-weak-ptr"><a href="#std-weak-ptr" class="headerlink" title="std::weak_ptr"></a>std::weak_ptr</h3><p>å¦‚æœä½ ä»”ç»†æ€è€ƒ <code>std::shared_ptr</code> å°±ä¼šå‘ç°ä¾ç„¶å­˜åœ¨ç€èµ„æºæ— æ³•é‡Šæ”¾çš„é—®é¢˜ã€‚çœ‹ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">A</span>;</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">B</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">A</span> &#123;</span></span><br><span class="line">    std::shared_ptr&lt;B&gt; pointer;</span><br><span class="line">    ~<span class="built_in">A</span>() &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;A è¢«é”€æ¯&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">B</span> &#123;</span></span><br><span class="line">    std::shared_ptr&lt;A&gt; pointer;</span><br><span class="line">    ~<span class="built_in">B</span>() &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;B è¢«é”€æ¯&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">auto</span> a = std::make_shared&lt;A&gt;();</span><br><span class="line">    <span class="keyword">auto</span> b = std::make_shared&lt;B&gt;();</span><br><span class="line">    a-&gt;pointer = b;</span><br><span class="line">    b-&gt;pointer = a;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œç»“æœæ˜¯ A, B éƒ½ä¸ä¼šè¢«é”€æ¯ï¼Œè¿™æ˜¯å› ä¸º a,b å†…éƒ¨çš„ pointer åŒæ—¶åˆå¼•ç”¨äº† <code>a,b</code>ï¼Œè¿™ä½¿å¾— <code>a,b</code> çš„å¼•ç”¨è®¡æ•°å‡å˜ä¸ºäº† 2ï¼Œè€Œç¦»å¼€ä½œç”¨åŸŸæ—¶ï¼Œ<code>a,b</code> æ™ºèƒ½æŒ‡é’ˆè¢«ææ„ï¼Œå´åªèƒ½é€ æˆè¿™å—åŒºåŸŸçš„å¼•ç”¨è®¡æ•°å‡ä¸€ï¼Œè¿™æ ·å°±å¯¼è‡´äº† <code>a,b</code> å¯¹è±¡æŒ‡å‘çš„å†…å­˜åŒºåŸŸå¼•ç”¨è®¡æ•°ä¸ä¸ºé›¶ï¼Œè€Œå¤–éƒ¨å·²ç»æ²¡æœ‰åŠæ³•æ‰¾åˆ°è¿™å—åŒºåŸŸäº†ï¼Œä¹Ÿå°±é€ æˆäº†å†…å­˜æ³„éœ²</p><p><img data-src="https://changkun.de/modern-cpp/assets/figures/pointers1.png" alt="å›¾ 5.1"></p><p>è§£å†³è¿™ä¸ªé—®é¢˜çš„åŠæ³•å°±æ˜¯ä½¿ç”¨å¼±å¼•ç”¨æŒ‡é’ˆ <code>std::weak_ptr</code>ï¼Œ<code>std::weak_ptr</code>æ˜¯ä¸€ç§å¼±å¼•ç”¨ï¼ˆç›¸æ¯”è¾ƒè€Œè¨€ <code>std::shared_ptr</code> å°±æ˜¯ä¸€ç§å¼ºå¼•ç”¨ï¼‰ã€‚<strong>å¼±å¼•ç”¨ä¸ä¼šå¼•èµ·å¼•ç”¨è®¡æ•°å¢åŠ ï¼Œå½“æ¢ç”¨å¼±å¼•ç”¨æ—¶å€™</strong>ï¼Œæœ€ç»ˆçš„é‡Šæ”¾æµç¨‹å¦‚å›¾.</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">AA</span>;</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">B</span>;</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">AA</span> &#123;</span></span><br><span class="line">  std::weak_ptr&lt;B&gt; pointer;</span><br><span class="line">  ~<span class="built_in">AA</span>() &#123; std::cout &lt;&lt; <span class="string">&quot;AA::~AA&quot;</span> &lt;&lt; std::endl; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">B</span> &#123;</span></span><br><span class="line">  std::weak_ptr&lt;AA&gt; pointer;</span><br><span class="line">  ~<span class="built_in">B</span>() &#123; std::cout &lt;&lt; <span class="string">&quot;B::~B&quot;</span> &lt;&lt; std::endl; &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><img data-src="https://changkun.de/modern-cpp/assets/figures/pointers2.png" alt="å›¾ 5.2" style="zoom:67%;" /></p><blockquote><p><code>std::weak_ptr</code> ä¸ä¼šå¢åŠ å¼•ç”¨è®¡æ•°,ä½¿å¾—a,bé‡Šæ”¾ååŸæœ¬å¯¹è±¡æ²¡æœ‰äº†å¼•ç”¨.</p></blockquote><p>æœ€åä¸€æ­¥åªå‰©ä¸‹ Bï¼Œè€Œ B å¹¶æ²¡æœ‰ä»»ä½•æ™ºèƒ½æŒ‡é’ˆå¼•ç”¨å®ƒï¼Œå› æ­¤è¿™å—å†…å­˜èµ„æºä¹Ÿä¼šè¢«é‡Šæ”¾ã€‚</p><p><strong><code>std::weak_ptr</code> æ²¡æœ‰ <code>*</code> è¿ç®—ç¬¦å’Œ <code>-&gt;</code> è¿ç®—ç¬¦</strong>ï¼Œæ‰€ä»¥ä¸èƒ½å¤Ÿå¯¹èµ„æºè¿›è¡Œæ“ä½œï¼Œå®ƒå¯ä»¥ç”¨äºæ£€æŸ¥ <code>std::shared_ptr</code> æ˜¯å¦å­˜åœ¨ï¼Œå…¶ <strong><code>expired()</code> æ–¹æ³•èƒ½åœ¨èµ„æºæœªè¢«é‡Šæ”¾æ—¶ï¼Œä¼šè¿”å› <code>false</code>ï¼Œå¦åˆ™è¿”å› <code>true</code></strong>ï¼›é™¤æ­¤ä¹‹å¤–ï¼Œå®ƒä¹Ÿå¯ä»¥ç”¨äºè·å–æŒ‡å‘åŸå§‹å¯¹è±¡çš„ <code>std::shared_ptr</code> æŒ‡é’ˆï¼Œå…¶ <strong><code>lock()</code> æ–¹æ³•åœ¨åŸå§‹å¯¹è±¡æœªè¢«é‡Šæ”¾æ—¶ï¼Œè¿”å›ä¸€ä¸ªæŒ‡å‘åŸå§‹å¯¹è±¡çš„ <code>std::shared_ptr</code> æŒ‡é’ˆï¼Œè¿›è€Œè®¿é—®åŸå§‹å¯¹è±¡çš„èµ„æºï¼Œå¦åˆ™è¿”å›<code>nullptr</code>ã€‚</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">auto</span> aa = std::make_shared&lt;AA&gt;();</span><br><span class="line"> <span class="keyword">auto</span> bb = std::make_shared&lt;B&gt;();</span><br><span class="line"> aa-&gt;pointer = bb;</span><br><span class="line"> bb-&gt;pointer = aa;</span><br><span class="line"> <span class="keyword">if</span> (!aa-&gt;pointer.<span class="built_in">expired</span>()) &#123;</span><br><span class="line">   <span class="keyword">auto</span> shared = aa-&gt;pointer.<span class="built_in">lock</span>();</span><br><span class="line">   std::cout &lt;&lt; <span class="string">&quot;shared:&quot;</span> &lt;&lt; shared.<span class="built_in">use_count</span>() &lt;&lt; std::endl;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><h2 id="æ­£åˆ™è¡¨è¾¾å¼"><a href="#æ­£åˆ™è¡¨è¾¾å¼" class="headerlink" title="æ­£åˆ™è¡¨è¾¾å¼"></a>æ­£åˆ™è¡¨è¾¾å¼</h2><p>æ­£åˆ™è¡¨è¾¾å¼æè¿°äº†ä¸€ç§å­—ç¬¦ä¸²åŒ¹é…çš„æ¨¡å¼ã€‚ä¸€èˆ¬ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ä¸»è¦æ˜¯å®ç°ä¸‹é¢ä¸‰ä¸ªéœ€æ±‚ï¼š</p><ol><li><strong>æ£€æŸ¥ä¸€ä¸ªä¸²æ˜¯å¦åŒ…å«</strong>æŸç§å½¢å¼çš„å­ä¸²ï¼›</li><li>å°†åŒ¹é…çš„<strong>å­ä¸²æ›¿æ¢</strong>ï¼›</li><li>ä»<strong>æŸä¸ªä¸²ä¸­å–å‡ºç¬¦åˆæ¡ä»¶çš„å­ä¸²</strong>ã€‚</li></ol><blockquote><p>æ£€æŸ¥åŒ…å«,æ›¿æ¢å­—ä¸²,å–å‡ºå­—ä¸²</p></blockquote><p>æ­£åˆ™è¡¨è¾¾å¼æ˜¯ç”±æ™®é€šå­—ç¬¦ï¼ˆä¾‹å¦‚ a åˆ° zï¼‰ä»¥åŠç‰¹æ®Šå­—ç¬¦ç»„æˆçš„æ–‡å­—æ¨¡å¼ã€‚æ¨¡å¼æè¿°åœ¨æœç´¢æ–‡æœ¬æ—¶è¦åŒ¹é…çš„ä¸€ä¸ªæˆ–å¤šä¸ªå­—ç¬¦ä¸²ã€‚ æ­£åˆ™è¡¨è¾¾å¼ä½œä¸ºä¸€ä¸ªæ¨¡æ¿ï¼Œå°†æŸä¸ªå­—ç¬¦æ¨¡å¼ä¸æ‰€æœç´¢çš„å­—ç¬¦ä¸²è¿›è¡ŒåŒ¹é…ã€‚</p><h4 id="æ™®é€šå­—ç¬¦"><a href="#æ™®é€šå­—ç¬¦" class="headerlink" title="æ™®é€šå­—ç¬¦"></a>æ™®é€šå­—ç¬¦</h4><p>æ™®é€šå­—ç¬¦åŒ…æ‹¬æ²¡æœ‰æ˜¾å¼æŒ‡å®šä¸ºå…ƒå­—ç¬¦çš„æ‰€æœ‰å¯æ‰“å°å’Œä¸å¯æ‰“å°å­—ç¬¦ã€‚è¿™åŒ…æ‹¬æ‰€æœ‰å¤§å†™å’Œå°å†™å­—æ¯ã€æ‰€æœ‰æ•°å­—ã€æ‰€æœ‰æ ‡ç‚¹ç¬¦å·å’Œä¸€äº›å…¶ä»–ç¬¦å·ã€‚</p><h4 id="ç‰¹æ®Šå­—ç¬¦"><a href="#ç‰¹æ®Šå­—ç¬¦" class="headerlink" title="ç‰¹æ®Šå­—ç¬¦"></a>ç‰¹æ®Šå­—ç¬¦</h4><p>ç‰¹æ®Šå­—ç¬¦æ˜¯æ­£åˆ™è¡¨è¾¾å¼é‡Œæœ‰ç‰¹æ®Šå«ä¹‰çš„å­—ç¬¦ï¼Œä¹Ÿæ˜¯æ­£åˆ™è¡¨è¾¾å¼çš„æ ¸å¿ƒåŒ¹é…è¯­æ³•ã€‚å‚è§ä¸‹è¡¨ï¼š</p><div class="table-container"><table><thead><tr><th style="text-align:left">ç‰¹åˆ«å­—ç¬¦</th><th style="text-align:left">æè¿°</th></tr></thead><tbody><tr><td style="text-align:left"><code>$</code></td><td style="text-align:left">åŒ¹é…è¾“å…¥å­—ç¬¦ä¸²çš„ç»“å°¾ä½ç½®ã€‚</td></tr><tr><td style="text-align:left"><code>(</code>,<code>)</code></td><td style="text-align:left">æ ‡è®°ä¸€ä¸ªå­è¡¨è¾¾å¼çš„å¼€å§‹å’Œç»“æŸä½ç½®ã€‚å­è¡¨è¾¾å¼å¯ä»¥è·å–ä¾›ä»¥åä½¿ç”¨ã€‚</td></tr><tr><td style="text-align:left"><code>*</code></td><td style="text-align:left">åŒ¹é…å‰é¢çš„å­è¡¨è¾¾å¼é›¶æ¬¡æˆ–å¤šæ¬¡ã€‚</td></tr><tr><td style="text-align:left"><code>+</code></td><td style="text-align:left">åŒ¹é…å‰é¢çš„å­è¡¨è¾¾å¼ä¸€æ¬¡æˆ–å¤šæ¬¡ã€‚</td></tr><tr><td style="text-align:left"><code>.</code></td><td style="text-align:left">åŒ¹é…é™¤æ¢è¡Œç¬¦ <code>\n</code> ä¹‹å¤–çš„ä»»ä½•å•å­—ç¬¦ã€‚</td></tr><tr><td style="text-align:left"><code>[</code></td><td style="text-align:left">æ ‡è®°ä¸€ä¸ªä¸­æ‹¬å·è¡¨è¾¾å¼çš„å¼€å§‹ã€‚</td></tr><tr><td style="text-align:left"><code>?</code></td><td style="text-align:left">åŒ¹é…å‰é¢çš„å­è¡¨è¾¾å¼é›¶æ¬¡æˆ–ä¸€æ¬¡ï¼Œæˆ–æŒ‡æ˜ä¸€ä¸ªéè´ªå©ªé™å®šç¬¦ã€‚</td></tr><tr><td style="text-align:left"><code>\</code></td><td style="text-align:left">å°†ä¸‹ä¸€ä¸ªå­—ç¬¦æ ‡è®°ä¸ºæˆ–ç‰¹æ®Šå­—ç¬¦ã€æˆ–åŸä¹‰å­—ç¬¦ã€æˆ–å‘åå¼•ç”¨ã€æˆ–å…«è¿›åˆ¶è½¬ä¹‰ç¬¦ã€‚ä¾‹å¦‚ï¼Œ <code>n</code> åŒ¹é…å­—ç¬¦ <code>n</code>ã€‚<code>\n</code> åŒ¹é…æ¢è¡Œç¬¦ã€‚åºåˆ— <code>\\</code> åŒ¹é… <code>&#39;\&#39;</code> å­—ç¬¦ï¼Œè€Œ <code>\(</code> åˆ™åŒ¹é… <code>&#39;(&#39;</code> å­—ç¬¦ã€‚</td></tr><tr><td style="text-align:left"><code>^</code></td><td style="text-align:left">åŒ¹é…è¾“å…¥å­—ç¬¦ä¸²çš„å¼€å§‹ä½ç½®ï¼Œé™¤éåœ¨æ–¹æ‹¬å·è¡¨è¾¾å¼ä¸­ä½¿ç”¨ï¼Œæ­¤æ—¶å®ƒè¡¨ç¤ºä¸æ¥å—è¯¥å­—ç¬¦é›†åˆã€‚</td></tr><tr><td style="text-align:left"><code>&#123;</code></td><td style="text-align:left">æ ‡è®°é™å®šç¬¦è¡¨è¾¾å¼çš„å¼€å§‹ã€‚</td></tr><tr><td style="text-align:left">`</td><td style="text-align:left">`</td><td>æŒ‡æ˜ä¸¤é¡¹ä¹‹é—´çš„ä¸€ä¸ªé€‰æ‹©</td></tr></tbody></table></div><p>ä¸€äº›æ­£åˆ™è¡¨è¾¾å¼ç¤ºä¾‹:</p><ul><li><p><code>\s</code> æ˜¯<strong>åŒ¹é…æ‰€æœ‰ç©ºç™½ç¬¦,åŒ…æ‹¬æ¢è¡Œ</strong>,\S éç©ºç™½ç¬¦,ä¸åŒ…æ‹¬æ¢è¡Œ</p></li><li><p><code>\d+</code>: åŒ¹é…ä¸€ä¸ªæˆ–å¤šä¸ªæ•°å­—</p></li><li><code>\b</code> åŒ¹é…ä¸€ä¸ªå•è¯è¾¹ç•Œï¼Œä¹Ÿå°±æ˜¯æŒ‡å•è¯å’Œç©ºæ ¼é—´çš„ä½ç½®.ä¾‹å¦‚, â€˜er\bâ€™ å¯ä»¥åŒ¹é…â€neverâ€ ä¸­çš„ â€˜erâ€™ï¼Œä½†ä¸èƒ½åŒ¹é… â€œverbâ€ ä¸­çš„ â€˜erâ€™.</li><li><code>\w+</code>: åŒ¹é…ä¸€ä¸ªæˆ–å¤šä¸ªå­—æ¯ã€æ•°å­—æˆ–ä¸‹åˆ’çº¿å­—ç¬¦</li><li><code>\s+</code>: åŒ¹é…ä¸€ä¸ªæˆ–å¤šä¸ªç©ºç™½å­—ç¬¦</li><li><code>[aeiou]</code>: åŒ¹é…ä»»æ„ä¸€ä¸ªå…ƒéŸ³å­—æ¯</li><li><code>[a-zA-Z0-9_]+</code>: åŒ¹é…ä¸€ä¸ªæˆ–å¤šä¸ªå­—æ¯ã€æ•°å­—æˆ–ä¸‹åˆ’çº¿</li><li><code>\b\w+\b</code>: åŒ¹é…ç‹¬ç«‹çš„å•è¯</li><li><code>^[a-z]+$</code>: åŒ¹é…å…¨éƒ¨ç”±å°å†™å­—æ¯ç»„æˆçš„å­—ç¬¦ä¸².</li></ul><div class="table-container"><table><thead><tr><th>åŒ¹é…</th><th>è§£é‡Š</th></tr></thead><tbody><tr><td>(pattern)</td><td><strong>åŒ¹é… pattern å¹¶è·å–è¿™ä¸€åŒ¹é…</strong>ã€‚æ‰€è·å–çš„åŒ¹é…å¯ä»¥ä»äº§ç”Ÿçš„ Matches é›†åˆå¾—åˆ°ï¼Œåœ¨VBScript ä¸­ä½¿ç”¨ SubMatches é›†åˆï¼Œåœ¨JScript ä¸­åˆ™ä½¿ç”¨ $0â€¦$9 å±æ€§ã€‚è¦åŒ¹é…åœ†æ‹¬å·å­—ç¬¦ï¼Œè¯·ä½¿ç”¨ â€˜(â€˜ æˆ– â€˜)â€˜ã€‚</td></tr><tr><td>(?:pattern)</td><td><strong>åŒ¹é… pattern ä½†ä¸è·å–åŒ¹é…ç»“æœ</strong>ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™æ˜¯ä¸€ä¸ªéè·å–åŒ¹é…ï¼Œä¸è¿›è¡Œå­˜å‚¨ä¾›ä»¥åä½¿ç”¨ã€‚è¿™åœ¨ä½¿ç”¨ â€œæˆ–â€ å­—ç¬¦ (\</td><td>) æ¥ç»„åˆä¸€ä¸ªæ¨¡å¼çš„å„ä¸ªéƒ¨åˆ†æ˜¯å¾ˆæœ‰ç”¨ã€‚ä¾‹å¦‚ï¼Œ â€˜industr(?:y\</td><td>ies) å°±æ˜¯ä¸€ä¸ªæ¯” â€˜industry\</td><td>industriesâ€™ æ›´ç®€ç•¥çš„è¡¨è¾¾å¼ã€‚</td></tr><tr><td>(?=pattern)</td><td>æ­£å‘è‚¯å®šé¢„æŸ¥ï¼ˆlook ahead positive assertï¼‰ï¼Œåœ¨ä»»ä½•åŒ¹é…patternçš„å­—ç¬¦ä¸²å¼€å§‹å¤„åŒ¹é…æŸ¥æ‰¾å­—ç¬¦ä¸²ã€‚è¿™æ˜¯ä¸€ä¸ªéè·å–åŒ¹é…ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¯¥åŒ¹é…ä¸éœ€è¦è·å–ä¾›ä»¥åä½¿ç”¨ã€‚ä¾‹å¦‚ï¼Œâ€Windows(?=95\</td><td>98\</td><td>NT\</td><td>2000)â€èƒ½åŒ¹é…â€Windows2000â€ä¸­çš„â€Windowsâ€ï¼Œä½†ä¸èƒ½åŒ¹é…â€Windows3.1â€ä¸­çš„â€Windowsâ€ã€‚<strong>é¢„æŸ¥ä¸æ¶ˆè€—å­—ç¬¦</strong>ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨ä¸€ä¸ªåŒ¹é…å‘ç”Ÿåï¼Œåœ¨æœ€åä¸€æ¬¡åŒ¹é…ä¹‹åç«‹å³å¼€å§‹ä¸‹ä¸€æ¬¡åŒ¹é…çš„æœç´¢ï¼Œè€Œä¸æ˜¯ä»åŒ…å«é¢„æŸ¥çš„å­—ç¬¦ä¹‹åå¼€å§‹ã€‚</td></tr><tr><td>(?!pattern)</td><td>æ­£å‘å¦å®šé¢„æŸ¥(negative assert)ï¼Œåœ¨ä»»ä½•ä¸åŒ¹é…patternçš„å­—ç¬¦ä¸²å¼€å§‹å¤„åŒ¹é…æŸ¥æ‰¾å­—ç¬¦ä¸²ã€‚è¿™æ˜¯ä¸€ä¸ªéè·å–åŒ¹é…ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¯¥åŒ¹é…ä¸éœ€è¦è·å–ä¾›ä»¥åä½¿ç”¨ã€‚ä¾‹å¦‚â€Windows(?!95\</td><td>98\</td><td>NT\</td><td>2000)â€èƒ½åŒ¹é…â€Windows3.1â€ä¸­çš„â€Windowsâ€ï¼Œä½†ä¸èƒ½åŒ¹é…â€Windows2000â€ä¸­çš„â€Windowsâ€ã€‚<strong>é¢„æŸ¥ä¸æ¶ˆè€—å­—ç¬¦</strong>ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨ä¸€ä¸ªåŒ¹é…å‘ç”Ÿåï¼Œåœ¨æœ€åä¸€æ¬¡åŒ¹é…ä¹‹åç«‹å³å¼€å§‹ä¸‹ä¸€æ¬¡åŒ¹é…çš„æœç´¢ï¼Œè€Œä¸æ˜¯ä»åŒ…å«é¢„æŸ¥çš„å­—ç¬¦ä¹‹åå¼€å§‹ã€‚</td></tr><tr><td>(?&lt;=pattern)</td><td>åå‘(look behind)è‚¯å®šé¢„æŸ¥ï¼Œä¸æ­£å‘è‚¯å®šé¢„æŸ¥ç±»ä¼¼ï¼Œåªæ˜¯æ–¹å‘ç›¸åã€‚ä¾‹å¦‚ï¼Œâ€`(?&lt;=95</td><td>98</td><td>NT</td><td>2000)Windows<code>&quot;èƒ½åŒ¹é…&quot;</code>2000Windows<code>&quot;ä¸­çš„&quot;</code>Windows<code>&quot;ï¼Œä½†ä¸èƒ½åŒ¹é…&quot;</code>3.1Windows<code>&quot;ä¸­çš„&quot;</code>Windows`â€ã€‚</td></tr><tr><td>(?&lt;!pattern)</td><td>åå‘å¦å®šé¢„æŸ¥ï¼Œä¸æ­£å‘å¦å®šé¢„æŸ¥ç±»ä¼¼ï¼Œåªæ˜¯æ–¹å‘ç›¸åã€‚ä¾‹å¦‚â€`(?&lt;!95</td><td>98</td><td>NT</td><td>2000)Windows<code>&quot;èƒ½åŒ¹é…&quot;</code>3.1Windows<code>&quot;ä¸­çš„&quot;</code>Windows<code>&quot;ï¼Œä½†ä¸èƒ½åŒ¹é…&quot;</code>2000Windows<code>&quot;ä¸­çš„&quot;</code>Windows`â€ã€‚</td></tr></tbody></table></div><h4 id="é™å®šç¬¦"><a href="#é™å®šç¬¦" class="headerlink" title="é™å®šç¬¦"></a>é™å®šç¬¦</h4><p>é™å®šç¬¦ç”¨æ¥æŒ‡å®š<strong>æ­£åˆ™è¡¨è¾¾å¼çš„ä¸€ä¸ªç»™å®šçš„ç»„ä»¶å¿…é¡»è¦å‡ºç°å¤šå°‘æ¬¡æ‰èƒ½æ»¡è¶³åŒ¹é…</strong>ã€‚è§ä¸‹è¡¨ï¼š</p><div class="table-container"><table><thead><tr><th style="text-align:left">å­—ç¬¦</th><th style="text-align:left">æè¿°</th></tr></thead><tbody><tr><td style="text-align:left"><code>*</code></td><td style="text-align:left">åŒ¹é…å‰é¢çš„å­è¡¨è¾¾å¼é›¶æ¬¡æˆ–å¤šæ¬¡ã€‚ä¾‹å¦‚ï¼Œ<code>foo*</code> èƒ½åŒ¹é… <code>fo</code> ä»¥åŠ <code>foooo</code>ã€‚<code>*</code> ç­‰ä»·äº<code>&#123;0,&#125;</code>ã€‚</td></tr><tr><td style="text-align:left"><code>+</code></td><td style="text-align:left">åŒ¹é…å‰é¢çš„å­è¡¨è¾¾å¼ä¸€æ¬¡æˆ–å¤šæ¬¡ã€‚ä¾‹å¦‚ï¼Œ<code>foo+</code> èƒ½åŒ¹é… <code>foo</code> ä»¥åŠ <code>foooo</code>ï¼Œä½†ä¸èƒ½åŒ¹é… <code>fo</code>ã€‚<code>+</code> ç­‰ä»·äº <code>&#123;1,&#125;</code>ã€‚</td></tr><tr><td style="text-align:left"><code>?</code></td><td style="text-align:left">åŒ¹é…å‰é¢çš„å­è¡¨è¾¾å¼é›¶æ¬¡æˆ–ä¸€æ¬¡ã€‚ä¾‹å¦‚ï¼Œ<code>Your(s)?</code> å¯ä»¥åŒ¹é… <code>Your</code> æˆ– <code>Yours</code> ä¸­çš„<code>Your</code> ã€‚<code>?</code> ç­‰ä»·äº <code>&#123;0,1&#125;</code>ã€‚</td></tr><tr><td style="text-align:left"><code>&#123;n&#125;</code></td><td style="text-align:left"><code>n</code> æ˜¯ä¸€ä¸ªéè´Ÿæ•´æ•°ã€‚åŒ¹é…ç¡®å®šçš„ <code>n</code> æ¬¡ã€‚ä¾‹å¦‚ï¼Œ<code>o&#123;2&#125;</code> ä¸èƒ½åŒ¹é… <code>for</code> ä¸­çš„ <code>o</code>ï¼Œä½†æ˜¯èƒ½åŒ¹é… <code>foo</code> ä¸­çš„ä¸¤ä¸ª <code>o</code>ã€‚</td></tr><tr><td style="text-align:left"><code>&#123;n,&#125;</code></td><td style="text-align:left"><code>n</code> æ˜¯ä¸€ä¸ªéè´Ÿæ•´æ•°ã€‚è‡³å°‘åŒ¹é… <code>n</code> æ¬¡ã€‚ä¾‹å¦‚ï¼Œ<code>o&#123;2,&#125;</code> ä¸èƒ½åŒ¹é… <code>for</code> ä¸­çš„ <code>o</code>ï¼Œä½†èƒ½åŒ¹é… <code>foooooo</code> ä¸­çš„æ‰€æœ‰ <code>o</code>ã€‚<code>o&#123;1,&#125;</code> ç­‰ä»·äº <code>o+</code>ã€‚<code>o&#123;0,&#125;</code> åˆ™ç­‰ä»·äº <code>o*</code>ã€‚</td></tr><tr><td style="text-align:left"><code>&#123;n,m&#125;</code></td><td style="text-align:left"><code>m</code> å’Œ <code>n</code> å‡ä¸ºéè´Ÿæ•´æ•°ï¼Œå…¶ä¸­ <code>n</code> å°äºç­‰äº <code>m</code>ã€‚æœ€å°‘åŒ¹é… <code>n</code> æ¬¡ä¸”æœ€å¤šåŒ¹é… <code>m</code> æ¬¡ã€‚ä¾‹å¦‚ï¼Œ<code>o&#123;1,3&#125;</code> å°†åŒ¹é… <code>foooooo</code> ä¸­çš„å‰ä¸‰ä¸ª <code>o</code>ã€‚<code>o&#123;0,1&#125;</code> ç­‰ä»·äº <code>o?</code>ã€‚æ³¨æ„ï¼Œåœ¨é€—å·å’Œä¸¤ä¸ªæ•°ä¹‹é—´ä¸èƒ½æœ‰ç©ºæ ¼ã€‚</td></tr></tbody></table></div><h3 id="std-regex-åŠå…¶ç›¸å…³"><a href="#std-regex-åŠå…¶ç›¸å…³" class="headerlink" title="std::regex åŠå…¶ç›¸å…³"></a>std::regex åŠå…¶ç›¸å…³</h3><p>å¯¹å­—ç¬¦ä¸²å†…å®¹è¿›è¡ŒåŒ¹é…çš„æœ€å¸¸è§æ‰‹æ®µå°±æ˜¯ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ã€‚ å¯æƒœ<strong>åœ¨ä¼ ç»Ÿ C++ ä¸­æ­£åˆ™è¡¨è¾¾å¼ä¸€ç›´æ²¡æœ‰å¾—åˆ°è¯­è¨€å±‚é¢çš„æ”¯æŒï¼Œæ²¡æœ‰çº³å…¥æ ‡å‡†åº“</strong>ï¼Œ è€Œ C++ ä½œä¸ºä¸€é—¨é«˜æ€§èƒ½è¯­è¨€ï¼Œåœ¨åå°æœåŠ¡çš„å¼€å‘ä¸­ï¼Œå¯¹ URL èµ„æºé“¾æ¥è¿›è¡Œåˆ¤æ–­æ—¶ï¼Œ ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ä¹Ÿæ˜¯å·¥ä¸šç•Œæœ€ä¸ºæˆç†Ÿçš„æ™®éåšæ³•ã€‚</p><p>ä¸€èˆ¬çš„è§£å†³æ–¹æ¡ˆå°±æ˜¯ä½¿ç”¨ <code>boost</code> çš„æ­£åˆ™è¡¨è¾¾å¼åº“ã€‚ è€Œ <strong>C++11 æ­£å¼å°†æ­£åˆ™è¡¨è¾¾å¼çš„çš„å¤„ç†æ–¹æ³•çº³å…¥æ ‡å‡†åº“çš„è¡Œåˆ—</strong>ï¼Œä»è¯­è¨€çº§ä¸Šæä¾›äº†æ ‡å‡†çš„æ”¯æŒï¼Œ ä¸å†ä¾èµ–ç¬¬ä¸‰æ–¹ã€‚</p><p>C++11 æä¾›çš„æ­£åˆ™è¡¨è¾¾å¼åº“æ“ä½œ <code>std::string</code> å¯¹è±¡ï¼Œ æ¨¡å¼ <code>std::regex</code> (æœ¬è´¨æ˜¯ <code>std::basic_regex</code>)è¿›è¡Œåˆå§‹åŒ–ï¼Œ é€šè¿‡ <code>std::regex_match</code> è¿›è¡ŒåŒ¹é…ï¼Œ ä»è€Œäº§ç”Ÿ <code>std::smatch</code> ï¼ˆæœ¬è´¨æ˜¯ <code>std::match_results</code> å¯¹è±¡ï¼‰</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">std::string fnames[] = &#123;<span class="string">&quot;foot.txt&quot;</span>, <span class="string">&quot;bar.txt&quot;</span>, <span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;a0.txt&quot;</span>&#125;;</span><br><span class="line">  <span class="function">std::regex <span class="title">txt_regex</span><span class="params">(<span class="string">&quot;[a-z]+\\.txt&quot;</span>)</span></span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; fname : fnames) &#123;</span><br><span class="line">    std::cout &lt;&lt; fname &lt;&lt; <span class="string">&quot;: &quot;</span> &lt;&lt; std::<span class="built_in">regex_match</span>(fname, txt_regex)</span><br><span class="line">              &lt;&lt; std::endl;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>å¦ä¸€ç§å¸¸ç”¨çš„å½¢å¼å°±æ˜¯ä¾æ¬¡ä¼ å…¥ <code>std::string</code>/<code>std::smatch</code>/<code>std::regex</code> ä¸‰ä¸ªå‚æ•°ï¼Œ å…¶ä¸­ <code>std::smatch</code> çš„æœ¬è´¨å…¶å®æ˜¯ <code>std::match_results</code>ã€‚ æ•…è€Œåœ¨æ ‡å‡†åº“çš„å®ç°ä¸­ï¼Œ <code>std::smatch</code> è¢«å®šä¹‰ä¸ºäº† <code>std::match_results&lt;std::string::const_iterator&gt;</code>ï¼Œ ä¹Ÿå°±æ˜¯ä¸€ä¸ªå­ä¸²è¿­ä»£å™¨ç±»å‹çš„ <code>match_results</code>ã€‚ ä½¿ç”¨ <code>std::smatch</code> å¯ä»¥æ–¹ä¾¿çš„å¯¹åŒ¹é…çš„ç»“æœè¿›è¡Œè·å–ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">std::regex <span class="title">base_regex</span><span class="params">(<span class="string">&quot;([a-z]+)\\.txt&quot;</span>)</span></span>;</span><br><span class="line">std::smatch base_match;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">const</span> <span class="keyword">auto</span> &amp;fname: fnames) &#123;</span><br><span class="line">    <span class="keyword">if</span> (std::<span class="built_in">regex_match</span>(fname, base_match, base_regex)) &#123;</span><br><span class="line">        <span class="comment">// std::smatch çš„ç¬¬ä¸€ä¸ªå…ƒç´ åŒ¹é…æ•´ä¸ªå­—ç¬¦ä¸²</span></span><br><span class="line">        <span class="comment">// std::smatch çš„ç¬¬äºŒä¸ªå…ƒç´ åŒ¹é…äº†ç¬¬ä¸€ä¸ªæ‹¬å·è¡¨è¾¾å¼</span></span><br><span class="line">        <span class="keyword">if</span> (base_match.<span class="built_in">size</span>() == <span class="number">2</span>) &#123;</span><br><span class="line">            std::string base = base_match[<span class="number">1</span>].<span class="built_in">str</span>();</span><br><span class="line">            std::cout &lt;&lt; <span class="string">&quot;sub-match[0]: &quot;</span> &lt;&lt; base_match[<span class="number">0</span>].<span class="built_in">str</span>() &lt;&lt; std::endl;</span><br><span class="line">            std::cout &lt;&lt; fname &lt;&lt; <span class="string">&quot; sub-match[1]: &quot;</span> &lt;&lt; base &lt;&lt; std::endl;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;p&gt;å®¹å™¨ã€æ™ºèƒ½æŒ‡é’ˆä¸æ­£åˆ™è¡¨è¾¾å¼.&lt;br&gt;</summary>
    
    
    
    
    <category term="cpp" scheme="https://www.sekyoro.top/tags/cpp/"/>
    
  </entry>
  
  <entry>
    <title>è·¨å¹³å°åº”ç”¨å¼€å‘çš„è‹¥å¹²è§£å†³æ–¹æ¡ˆ</title>
    <link href="https://www.sekyoro.top/2024/06/08/%E8%B7%A8%E5%B9%B3%E5%8F%B0%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91%E7%9A%84%E8%8B%A5%E5%B9%B2%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/"/>
    <id>https://www.sekyoro.top/2024/06/08/%E8%B7%A8%E5%B9%B3%E5%8F%B0%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91%E7%9A%84%E8%8B%A5%E5%B9%B2%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/</id>
    <published>2024-06-08T05:33:08.000Z</published>
    <updated>2024-06-15T06:50:55.460Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>å¾ˆä¹…æ²¡æœ‰å†™è¿™ç±»high-levelçš„æ–‡ç« äº†,æœ¬èº«è¿™ç±»æ¡†æ¶å°±ä¸€ç›´å±‚å‡ºä¸ç©·,ä½†æ˜¯å…¶ä¸­å†ä¹…å¼¥åš,åšéŸ§ä¸æ‹”çš„æ¡†æ¶åˆæœ‰å¤šå°‘å‘¢?<br><span id="more"></span><br>é¦–å…ˆè€ƒè™‘åˆ°å­¦ä¹ æˆæœ¬ä»¥åŠæŒæ¡ä¸€äº›ç¼–ç¨‹è¯­è¨€åœ¨å·¥ä½œã€å­¦ä¹ ç”Ÿæ€ä¸Šçš„ä»·å€¼,ç»™è¿™äº›ä¸œè¥¿é€‚ç”¨ç”Ÿæ€åˆ’åˆ†ä¸€ä¸‹.</p><h3 id="React-Native"><a href="#React-Native" class="headerlink" title="React Native"></a>React Native</h3><blockquote><p>React Native å…è®¸äº†è§£ <strong>React çš„å¼€å‘äººå‘˜åˆ›å»ºåŸç”Ÿåº”ç”¨ç¨‹åº</strong>ã€‚åŒæ—¶ï¼ŒåŸç”Ÿå¼€å‘äººå‘˜å¯ä»¥ä½¿ç”¨ React Native ç¼–å†™ä¸€æ¬¡é€šç”¨åŠŸèƒ½ï¼Œä»è€Œè·å¾—<strong>åŸç”Ÿå¹³å°</strong>ä¹‹é—´çš„å¹³ç­‰æ€§ã€‚</p></blockquote><p><a href="https://reactnative.dev/docs/environment-setup">Get Started with React Native Â· React Native</a></p><p>ä½¿ç”¨å‰ç«¯æŠ€æœ¯å¼€å‘ç§»åŠ¨ç«¯å’Œwebç¨‹åº. é€šå¸¸ä¸Expoæ­é…,åè€…æ˜¯ä¸€ä¸ªç”Ÿäº§çº§çš„ React Native æ¡†æ¶ã€‚Expo æä¾›å¼€å‘äººå‘˜å·¥å…·ï¼Œä½¿åº”ç”¨ç¨‹åºçš„å¼€å‘æ›´åŠ è½»æ¾ï¼Œä¾‹å¦‚åŸºäºæ–‡ä»¶çš„è·¯ç”±ã€åŸç”Ÿæ¨¡å—æ ‡å‡†åº“ç­‰.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx create-expo-app StickerSmash --template blank &amp;&amp; <span class="built_in">cd</span> StickerSmash</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; StyleSheet, Text, View &#125; <span class="keyword">from</span> <span class="string">&#x27;react-native&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">View</span> <span class="attr">style</span>=<span class="string">&#123;styles.container&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">Text</span>&gt;</span>Hello world!<span class="tag">&lt;/<span class="name">Text</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">View</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> styles = StyleSheet.create(&#123;</span><br><span class="line">  <span class="attr">container</span>: &#123;</span><br><span class="line">    <span class="attr">flex</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">backgroundColor</span>: <span class="string">&#x27;#fff&#x27;</span>,</span><br><span class="line">    <span class="attr">alignItems</span>: <span class="string">&#x27;center&#x27;</span>,</span><br><span class="line">    <span class="attr">justifyContent</span>: <span class="string">&#x27;center&#x27;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ä¸€äº›åº“çš„è¯ç›´æ¥å°±æ˜¯npm,è·Ÿå‰ç«¯å¼€å‘ç±»ä¼¼.</p><p>ç¼ºç‚¹çš„è¯å°±æ˜¯ä½¿ç”¨å‰ç«¯å’Œandroid studioæ··åˆæ­é…ä¼˜ç‚¹ä¹±å§,è€Œä¸”å¯èƒ½è¿˜æœ‰ä¸€äº›å‘. </p><p><del>å¦‚æœä½ ä¸å–œæ¬¢React,å¯ä»¥è¯•è¯•Ionic<a href="https://ionicframework.com/">Ionic Framework - The Cross-Platform App Development Leader</a></del>å…¶å®åœ¨è¿™é‡Œæˆ‘å¹¶ä¸æƒ³æ¨èå…¶ä»–æŠ€æœ¯äº†.</p><p>æ›´å¤šå‰ç«¯æŠ€æœ¯,å‚çœ‹<a href="https://risingstars.js.org/2023/en">2023 JavaScript Rising Stars</a></p><p>ä¼˜ç‚¹:</p><ul><li>å¼ºå¤§çš„ç”Ÿæ€å’Œç¤¾åŒº(æ¯•ç«ŸèƒŒé æŠ˜è…¾çš„å‰å®³çš„å‰ç«¯),<strong>æ–‡æ¡£éå¸¸å‹å–„</strong></li><li>ä¸“æ³¨ç”¨æˆ·ç•Œé¢,å‘ˆç°åŸç”Ÿå¹³å°çš„ç”¨æˆ·ç•Œé¢ç»„ä»¶</li><li>fast refresh,ä½¿å¾—å¼€å‘æ—¶èƒ½ç«‹å³çœ‹è§æ”¹åŠ¨</li><li>æœ‰äº†debuggerå·¥å…·,æä¾›log viewer, interactive layout inspector, å’Œnetwork inspector.</li></ul><h3 id="Flutter"><a href="#Flutter" class="headerlink" title="Flutter"></a>Flutter</h3><p><a href="https://docs.flutter.dev/get-started/install">Install | Flutter</a></p><p>è™½ç„¶å‰æ®µæ—¶é—´å¬è¯´flutteré­é‡,è¢«google layoffäº†ä¸€äº›äºº.</p><p>å¹¿æ³›æ–‡æ¡£ä¹Ÿä¸é”™,ç›®å‰æ”¯æŒmobile, webç”šè‡³desktop(beta).</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">ListView(</span><br><span class="line">  children: <span class="keyword">const</span> &lt;Widget&gt;[</span><br><span class="line">    ListTile(</span><br><span class="line">      leading: Icon(Icons.map),</span><br><span class="line">      title: Text(<span class="string">&#x27;Map&#x27;</span>),</span><br><span class="line">    ),</span><br><span class="line">    ListTile(</span><br><span class="line">      leading: Icon(Icons.photo_album),</span><br><span class="line">      title: Text(<span class="string">&#x27;Album&#x27;</span>),</span><br><span class="line">    ),</span><br><span class="line">    ListTile(</span><br><span class="line">      leading: Icon(Icons.phone),</span><br><span class="line">      title: Text(<span class="string">&#x27;Phone&#x27;</span>),</span><br><span class="line">    ),</span><br><span class="line">  ],</span><br><span class="line">),</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨Dartè¯­è¨€çš„å‘½ä»¤å¼UI,ç›®å‰å¾ˆå¤šæ¡†æ¶éƒ½ä½¿ç”¨è¿™ç§æ–¹å¼äº†.å…¶å®ä¹Ÿç±»ä¼¼jsx,æ— éæ˜¯åˆ©ç”¨ç¼–ç¨‹è¯­è¨€å±‚å±‚åµŒå¥—æ›¿ä»£åŸæœ¬çš„xmlé…ç½®çš„æ–¹å¼. </p><p>Jetpack composeå’ŒQtçš„qmlä¹Ÿéƒ½ç±»ä¼¼è¿™ç§äº†,åˆ†åˆ«æ›¿ä»£äº†åŸæœ¬xmlå’Œwidget.</p><p>åˆ©ç”¨Dartçš„pub.devè£…ä¸€äº›åº“<a href="https://pub.dev/">The official repository for Dart and Flutter packages. (pub.dev)</a>,ä¼—æ‰€å‘¨çŸ¥,æåˆ°php,rubyå°±æ˜¯web,é‚£ä¹ˆæåˆ°dartå°±æ˜¯flutteräº†,å› æ­¤dartçš„å¾ˆå¤šåº“ä¹Ÿæ˜¯æ–¹ä¾¿flutterå¼€å‘çš„.</p><p>ç¼ºç‚¹å°±æ˜¯Dartä¹Ÿæœ‰ä¸Šæ‰‹é—¨æ§›,ä¸è¿‡å¦‚æœä½ ç†Ÿæ‚‰ç±»ä¼¼Kotlin,</p><p>Swiftè¿™ç§è¯­è¨€,å…¶å®å®ƒå‘è¿™äº›è¯­è¨€å­¦ä¹ äº†å¾ˆå¤š.</p><p>ä¼˜ç‚¹:</p><ul><li>Flutter çš„çƒ­é‡è½½åŠŸèƒ½å¯è®©æ‚¨åœ¨ä¿®æ”¹ä»£ç åç«‹å³æŸ¥çœ‹åº”ç”¨ç¨‹åºçš„å˜åŒ–ï¼Œè€Œæ— éœ€é‡æ–°ç¼–è¯‘ã€‚</li><li>Flutter æ”¯æŒè°·æ­Œçš„ Material Design,è¿™æ˜¯ä¸€ç§å¸®åŠ©å¼€å‘äººå‘˜æ„å»ºæ•°å­—ä½“éªŒçš„è®¾è®¡ç³»ç»Ÿ.åœ¨æ„å»ºåº”ç”¨ç¨‹åºæ—¶,æ‚¨å¯ä»¥ä½¿ç”¨å¤šç§è§†è§‰å’Œè¡Œä¸ºå°éƒ¨ä»¶ã€‚</li><li>Flutter ä¸ä¾èµ–æµè§ˆå™¨æŠ€æœ¯.ç›¸å,å®ƒæ‹¥æœ‰è‡ªå·±çš„æ¸²æŸ“å¼•æ“æ¥ç»˜åˆ¶éƒ¨ä»¶</li></ul><h3 id="Kotlin-Multiplatform"><a href="#Kotlin-Multiplatform" class="headerlink" title="Kotlin Multiplatform"></a>Kotlin Multiplatform</h3><p>å¦‚æœä½ å·²ç»ç†Ÿæ‚‰Jetpack Compose,é‚£è¿™ä¸ªå°±æ˜¯å¤šå¹³å°ä¸‹çš„å¼€å‘æ¡†æ¶,ä¾¿äºå†™ios,webç­‰ç­‰. æˆ‘ä¸ªäººæ„Ÿè§‰å®ƒå’ŒFlutterå°±æ˜¯è¿™æ–¹é¢çš„leaderäº†,å¦‚æœä½ å¯¹desktopæ²¡æœ‰è¦æ±‚,é‚£ä¹Ÿå¯ä»¥ä½¿ç”¨React Native.</p><p><a href="https://www.jetbrains.com/zh-cn/lp/compose-multiplatform/">Compose Multiplatform UI æ¡†æ¶ | JetBrains | JetBrains: Developer Tools for Professionals and Teams</a></p><p><img data-src="https://kotlinlang.org/docs/images/kotlin-multiplatform.svg" alt="Kotlin Multiplatform"></p><p>ä½†è¯´å®è¯,ç›®å‰è¿˜éœ€è¦å†ç­‰ä¸€ç­‰.æ¯•ç«Ÿå®ƒçš„æ—¶é—´è¿˜ä¸åƒå‰ä¸¤è€…é‚£ä¹ˆä¹….</p><p>é¦–å…ˆéœ€è¦<a href="https://kmp.jetbrains.com/?_gl=1*1owgdm2*_gcl_au*NTAxNzM2NDkuMTcxNjg4ODAzMA..*_ga*MTk2NDM1MDMwNS4xNzEyMDI4ODQ4*_ga_9J976DJZ68*MTcxNzgyODcyNy43LjEuMTcxNzgyODg1MS42MC4wLjA.#newProject">Kotlin Multiplatform Wizard | JetBrains</a>ä¸‹è½½éœ€è¦çš„åº“,ç„¶åè¿›è¡Œä¸€å †é…ç½®,ç›®å‰çœ‹æ¥è¿˜æ˜¯éœ€è¦å†ç­‰ç­‰,å…ˆç†Ÿæ‚‰ç†Ÿæ‚‰Jetpack Composeæ›´å¥½.</p><p>å½“ç„¶,å‰ææ¡ä»¶éƒ½æ˜¯å¿…é¡»è¦ä¼šKotlinçš„åŸºæœ¬è¯­æ³•.</p><h3 id="NET-MAUI"><a href="#NET-MAUI" class="headerlink" title=".NET MAUI"></a>.NET MAUI</h3><p>Flutteræ˜¯è°·æ­Œçš„æŠ€æœ¯,React Nativeæ˜¯Metaçš„æŠ€æœ¯,è€ŒMAUIå°±æ˜¯å¾®è½¯çš„æŠ€æœ¯. ä½¿ç”¨C#å’ŒXAML(ç±»ä¼¼xml)å¼€å‘mobileå’Œdesktopç¨‹åº.å¦‚æœä½ è¿˜æƒ³è¦web,å¯ä»¥ç»“åˆBlazor.</p><p><a href="https://dotnet.microsoft.com/en-us/apps/maui">.NET Multi-platform App UI (.NET MAUI) | .NET (microsoft.com)</a></p><p>ç›®å‰å¾®è½¯æ­£åœ¨å¤§æ¨,è€Œä¹‹å‰çš„æ¡Œé¢å¼€å‘åº”ç”¨æ¯”å¦‚WPFç­‰å·²ç»æ²¡æœ‰ä»€ä¹ˆå¤§æ›´æ–°äº†,ä½†æ˜¯è¿˜æ˜¯æœ‰ä¸€äº›å…¬å¸(å¯èƒ½ä¸æ˜¯é‚£ä¹ˆäº’è”ç½‘çš„å…¬å¸)æ­£åœ¨ä½¿ç”¨.</p><p>å¦‚æœä½ æ²¡æœ‰é‚£ä¹ˆå¼ºè°ƒè·¨å¹³å°,æˆ‘è§‰å¾—WPFå®Œå…¨å¤Ÿç”¨äº†.</p><p>è¿˜æ˜¯ä½¿ç”¨çš„æ˜¯åˆ©ç”¨æ–‡ä»¶é…ç½®å£°æ˜UIæ§ä»¶,ç„¶åä»£ç å†™äº‹åŠ¡é€»è¾‘.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;</span><br><span class="line">&lt;ContentPage xmlns=&quot;http://schemas.microsoft.com/dotnet/2021/maui&quot;</span><br><span class="line">             xmlns:x=&quot;http://schemas.microsoft.com/winfx/2009/xaml&quot;</span><br><span class="line">             x:Class=&quot;Notes.AboutPage&quot;&gt;</span><br><span class="line">    &lt;VerticalStackLayout Spacing=&quot;10&quot; Margin=&quot;10&quot;&gt;</span><br><span class="line">        &lt;HorizontalStackLayout Spacing=&quot;10&quot;&gt;</span><br><span class="line">            &lt;Image Source=&quot;dotnet_bot.png&quot;</span><br><span class="line">                   SemanticProperties.Description=&quot;The dot net bot waving hello!&quot;</span><br><span class="line">                   HeightRequest=&quot;64&quot; /&gt;</span><br><span class="line">            &lt;Label FontSize=&quot;22&quot; FontAttributes=&quot;Bold&quot; Text=&quot;Notes&quot; VerticalOptions=&quot;End&quot; /&gt;</span><br><span class="line">            &lt;Label FontSize=&quot;22&quot; Text=&quot;v1.0&quot; VerticalOptions=&quot;End&quot; /&gt;</span><br><span class="line">        &lt;/HorizontalStackLayout&gt;</span><br><span class="line"></span><br><span class="line">        &lt;Label Text=&quot;This app is written in XAML and C# with .NET MAUI.&quot; /&gt;</span><br><span class="line">        &lt;Button Text=&quot;Learn more...&quot; Clicked=&quot;LearnMore_Clicked&quot; /&gt;</span><br><span class="line">    &lt;/VerticalStackLayout&gt;</span><br><span class="line">&lt;/ContentPage&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">private async void LearnMore_Clicked(object sender, EventArgs e)</span><br><span class="line">&#123;</span><br><span class="line">    // Navigate to the specified URL in the system browser.</span><br><span class="line">    await Launcher.Default.OpenAsync(&quot;https://aka.ms/maui&quot;);</span><br><span class="line">&#125;private void OnCounterClicked(object sender, EventArgs e)</span><br><span class="line">&#123;</span><br><span class="line">    count++;</span><br><span class="line"></span><br><span class="line">    if (count == 1)</span><br><span class="line">        CounterBtn.Text = $&quot;Clicked &#123;count&#125; time&quot;;</span><br><span class="line">    else</span><br><span class="line">        CounterBtn.Text = $&quot;Clicked &#123;count&#125; times&quot;;</span><br><span class="line"></span><br><span class="line">    SemanticScreenReader.Announce(CounterBtn.Text);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img data-src="https://dotnet.microsoft.com/blob-assets/images/tutorials/maui/solution-explorer-mainpage.png" alt="Solution Explorer pane with MainPage.xaml file highlighted."></p><p>C#è¯­è¨€æœ¬èº«æˆ‘ä¸ªäººè¿˜æ˜¯éå¸¸å–œæ¬¢çš„,å±äºå†ä¹…å¼¥åš.ä½¿ç”¨.NETå¼€å‘ç§»åŠ¨ç¨‹åºåŸºæœ¬ä¸Šè¦æ­é…visual studioäº†(æˆ–è€…ä¹Ÿå¯ä»¥ä½¿ç”¨Jetbrainsçš„Rider),å¯èƒ½ä¸€äº›æ“ä½œä¸ç†Ÿæ‚‰.</p><p>æ­¤å¤–ä¹Ÿæœ‰ç¬¬ä¸‰æ–¹çš„Avalonia<a href="https://docs.avaloniaui.net/zh-Hans/docs/welcome">æ¬¢è¿ | Avalonia Docs (avaloniaui.net)</a>å’ŒUno,ä¹Ÿæ˜¯å¯ä»¥è€ƒè™‘çš„. ä½†ç›®å‰å¯èƒ½ä»ç„¶å­˜åœ¨ä¸€äº›å‘,ç”Ÿæ€ä¸Šèµ„æºå¯èƒ½ä¹Ÿæ²¡æœ‰é‚£ä¹ˆä¸°å¯Œ.</p><p>ä¼˜ç‚¹:</p><ul><li>.NET MAUI æä¾›è·¨å¹³å° APIï¼Œç”¨äºè®¿é—®æœ¬åœ°è®¾å¤‡åŠŸèƒ½ï¼Œå¦‚ GPSã€åŠ é€Ÿè®¡ã€ç”µæ± å’Œç½‘ç»œçŠ¶æ€ã€‚</li><li>å®ƒæœ‰ä¸€ä¸ªå•ä¸€çš„é¡¹ç›®ç³»ç»Ÿï¼Œå¯ä½¿ç”¨å¤šç›®æ ‡åŠŸèƒ½é’ˆå¯¹ Androidã€iOSã€macOS å’Œ Windows å¯ç”¨ã€‚</li><li>ç”±äºæ”¯æŒ .NET hot reloadï¼Œå¼€å‘äººå‘˜å¯ä»¥åœ¨åº”ç”¨ç¨‹åºè¿è¡Œæ—¶ä¿®æ”¹æ‰˜ç®¡æºä»£ç </li></ul><p>è¿™å¯èƒ½ä¸å¤ªäº’è”ç½‘å’Œå¼€æº,ä½†æˆ‘è¿˜æ˜¯æƒ³è¯´è¯´:</p><h3 id="Qt"><a href="#Qt" class="headerlink" title="Qt"></a>Qt</h3><p>Qtæœ€æ–°å·²ç»åˆ°äº†6.xç‰ˆæœ¬,å®˜æ–¹ä¹Ÿæ¨èQuick application,å¦å¤–è¿˜æœ‰design studioæ–¹ä¾¿ç•Œé¢è®¾è®¡. å®˜æ–¹æ–‡æ—¦ä¹Ÿå¾ˆä¸é”™.</p><p><a href="https://doc.qt.io/qt-5/gettingstarted.html"><a href="https://doc.qt.io/">Qt Documentation | Home</a></a></p><p><a href="https://doc.qt.io/qt.html">Qt Documentation | Modules</a></p><p><img data-src="https://s2.loli.net/2024/06/08/Dv4qziapdwCQVOA.png" alt="image-20240608144743992"></p><p>éšä¾¿æ–°å»ºä¸€ä¸ªé¡¹ç›®,è®¾ç½®å…è®¸ä½¿ç”¨design studioæ‰“å¼€çš„æ ¼å¼,è¿™æ ·ä¸‹é¢æ–‡ä»¶ä¼šå¤šä¸€äº›ä¸œè¥¿.</p><p><img data-src="https://s2.loli.net/2024/06/08/ZQywH4stDL69rXu.png" alt="image-20240608150703433"></p><p>å¯ä»¥çœ‹åˆ°ä½¿ç”¨qmlå’Œcppè¿›è¡Œå¼€å‘,qmlé‡Œå¯ä»¥å†™UIä¹Ÿå¯ä»¥å†™ä¸€äº›ç®€å•é€»è¾‘,ç±»ä¼¼MAUIå’ŒWPF.</p><p> Qtç›®å‰æ”¯æŒæ¡Œé¢å’Œandroidç­‰<a href="https://blog.csdn.net/csdnofhaner/article/details/135733657">ã€Qtã€‘å¦‚ä½•ä»é›¶é…ç½®Qt Androidå®‰å“ç¯å¢ƒ_qt å®‰å“ç¯å¢ƒæ­å»º</a>,ä½†æˆ‘ä¹Ÿä¸æ¨èä½¿ç”¨qtå¼€å‘ç§»åŠ¨åº”ç”¨ã€‚</p><p>è€Œæ˜¯ä½¿ç”¨qmlæŠ€æœ¯å¼€å‘è·¨å¹³å°æ¡Œé¢åº”ç”¨(æ¯•ç«Ÿé’ˆå¯¹ä¸åŒIDEè®¾ç½®ä¸€ä¸ªandroidæ¨¡æ‹Ÿå™¨è¿˜æ˜¯æŒºéº»çƒ¦çš„).</p><p>å¦åˆ™è·Ÿä¸‹é¢ä¸€æ ·</p><p><img data-src="https://s2.loli.net/2024/06/08/yLbGiplSnVNXr45.png" alt="image-20240608155750208"></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QGuiApplication&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QQmlApplicationEngine&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">QGuiApplication <span class="title">app</span><span class="params">(argc, argv)</span></span>;</span><br><span class="line"></span><br><span class="line">    QQmlApplicationEngine engine;</span><br><span class="line">    <span class="function"><span class="keyword">const</span> QUrl <span class="title">url</span><span class="params">(<span class="string">u&quot;qrc:/ada/Main.qml&quot;</span>_qs)</span></span>;</span><br><span class="line">    QObject::<span class="built_in">connect</span>(</span><br><span class="line">        &amp;engine,</span><br><span class="line">        &amp;QQmlApplicationEngine::objectCreationFailed,</span><br><span class="line">        &amp;app,</span><br><span class="line">        []() &#123; QCoreApplication::<span class="built_in">exit</span>(<span class="number">-1</span>); &#125;,</span><br><span class="line">        Qt::QueuedConnection);</span><br><span class="line">    engine.<span class="built_in">load</span>(url);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> app.<span class="built_in">exec</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight qml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> QtQuick</span><br><span class="line"><span class="keyword">import</span> QtQuick.Controls</span><br><span class="line"></span><br><span class="line"><span class="title">Window</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">640</span></span><br><span class="line">    <span class="attribute">height</span>: <span class="number">480</span></span><br><span class="line">    <span class="attribute">visible</span>: <span class="literal">true</span></span><br><span class="line">    <span class="attribute">title</span>: qsTr(<span class="string">&quot;Hello World&quot;</span>)</span><br><span class="line">    <span class="title">Rectangle</span> &#123;</span><br><span class="line">        <span class="attribute">anchors.fill</span>: <span class="built_in">parent</span></span><br><span class="line">        <span class="attribute">color</span>: <span class="string">&quot;red&quot;</span></span><br><span class="line">        <span class="title">Column</span> &#123;</span><br><span class="line">            <span class="attribute">spacing</span>: <span class="number">20</span></span><br><span class="line">            <span class="title">Text</span> &#123;</span><br><span class="line">                <span class="attribute">text</span>: qsTr(<span class="string">&quot;Hello World&quot;</span>)</span><br><span class="line">                <span class="attribute">font.pixelSize</span>: <span class="number">254</span></span><br><span class="line">                <span class="attribute">font.bold</span>: <span class="literal">true</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="title">Button</span> &#123;</span><br><span class="line">                <span class="attribute">text</span>: qsTr(<span class="string">&quot;Hi, press me!&quot;</span>)</span><br><span class="line">                <span class="attribute">onClicked</span>: <span class="built_in">console</span>.log(<span class="string">&quot;Button clicked!&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="title">Button</span> &#123;</span><br><span class="line">                <span class="attribute">text</span>: qsTr(<span class="string">&quot;Hi, press me!&quot;</span>)</span><br><span class="line">                <span class="attribute">onClicked</span>: <span class="built_in">console</span>.log(<span class="string">&quot;Button clicked!&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è€Œä¸”Qtä¸åªæ˜¯ä¸€ä¸ªUIåº“,å®ƒåŒ…æ‹¬cppçš„å„ç§å°è£…ä¸å·¥å…·,qmlä¹Ÿæ”¯æŒjsæ‰§è¡Œ.</p><p>ä¸è¿‡å¼€å‘ä¸Šqtæœ¬èº«å¹¶ä¸æ”¯æŒçƒ­é‡è½½,æ¯æ¬¡æ”¹å®Œè¿˜è¦é‡æ–°è¿è¡Œ.</p><p>æˆ‘ä¸ä¼šè¯´c++å¾ˆéš¾,ä½†è¿™æ˜¯ä¸ªäº‹å®,ä¸è¿‡Qtå·²ç»æ–¹ä¾¿ä½ å¾ˆå¤šäº†.æ„å»ºå·¥å…·ä¹Ÿä»åŸæœ¬Qtè‡ªå·±çš„qmakeå˜æˆäº†cmakeä¼˜å…ˆ.</p><p>å¦å¤–Qtå’Œvisual studioä¹Ÿæ˜¯æˆ‘å¾ˆå–œæ¬¢çš„c++çš„IDE,æœ€è¿‘jetbrainsåˆå‘åŠ›æäº†clion novaæ®è¯´å ç”¨å†…å­˜å°äº†,ä¹Ÿå¯ä»¥è¯•è¯•.</p><p>ä½†å¯èƒ½ç”±äºå„ç§åŸå› ,Qtçš„ç”Ÿæ€è·Ÿå‰é¢å‡ è€…ä¸å¤ªç›¸åŒ,è¿™é‡Œå¼•ç”¨ä¸€å¥.</p><blockquote><p>ä»¥å¾€QTéœ€æ±‚æ¯”è¾ƒå¼ºçƒˆçš„é¢†åŸŸä¸»è¦é›†ä¸­äºå†›å·¥ã€å®‰é˜²ã€è½¦è”ç½‘ã€å·¥ä¸šæ§åˆ¶ã€ç”µåŠ›ç­‰ç›¸å¯¹åä¼ ç»Ÿçš„è¡Œä¸šé¢†åŸŸï¼Œæ•´ä½“éœ€æ±‚æ¯”è¾ƒç¨³å®šã€‚ä½†æ˜¯è¿‘å¹´æ¥ç”±äºâ€¦ï¼Œé‡‡ç”¨â€¦.ï¼Œå®ç°â€¦ã€‚è¿™ä¹Ÿå°±æ„å‘³ç€ï¼ŒåƒQTè¿™ç§GUIæ¡†æ¶å¿…ç„¶ä¼šè¶Šå—é’çã€‚</p><p>ä½œè€…ï¼šé£æ´<br>é“¾æ¥ï¼š<a href="https://juejin.cn/post/7076273798311313439">https://juejin.cn/post/7076273798311313439</a><br>æ¥æºï¼šç¨€åœŸæ˜é‡‘<br>è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p></blockquote><p>æˆ‘å¹¶ä¸æ˜¯è§‰å¾—Qtéœ€è¦æœ‰å¤šä¹ˆå—é’ç,ä½†æ˜¯å®ƒçš„éœ€æ±‚ç¡®å®å¦‚ä¸Šé¢æ‰€è¯´,å¯¼è‡´å¾ˆå¤šäººæ‹¿æ¥å·¥ä½œçš„å¹¶ä¸å¤š.</p><h3 id="One-more-thing"><a href="#One-more-thing" class="headerlink" title="One more thing"></a>One more thing</h3><p>äº‹å®ä¸Šå¾ˆå¤šæ—¶å€™å¹¶ä¸éœ€è¦è·¨å¹³å°å¼€å‘,å¼•å…¥è·¨å¹³å°å¼€å‘ä¼šæ¯«æ— ç–‘é—®åœ°å¢åŠ è´Ÿæ‹…. å¦‚æœåªæ˜¯è·¨æ¡Œé¢çš„è¯ä¹Ÿå¯ä»¥è€ƒè™‘electron,tauri(æœ¬è´¨ä¸Šæ˜¯webviewå‰ç«¯æŠ€æœ¯)ç­‰.</p><p><strong>å½“ä½ åªéœ€è¦å•ä¸ªå¹³å°æ—¶,å¯ä»¥æœ‰æ›´å¤šé€‰æ‹©</strong>. æ¯”å¦‚åœ¨Windowsæˆ–è€…å¾®è½¯çš„ä¸€äº›å¹³å°ä¸Š,ä½¿ç”¨WPF,winui3ç­‰. æ¯”å¦‚å•ç‹¬çš„å®‰å“å¼€å‘ä½¿ç”¨kotlin compose. å‡å°‘äº†è·¨å¹³å°å¼€å‘å¸¦æ¥çš„ä¸ä¸€è‡´æ€§é—®é¢˜.</p><p><img data-src="https://github.com/robloo/PublicDocs/raw/master/XAMLFrameworkEvolution.png?raw=true" alt="img"></p><p>å…³äºwindowsä¸Šçš„UIæ¡†æ¶,å¾®è½¯è¿˜æ˜¯æœ‰ç‚¹å¤šå˜äº†(å¾®è½¯çš„ä¸œè¥¿è¿˜æ˜¯è¦ç­‰å®ƒæ›´æˆç†Ÿå†ç”¨,æ¯”å¦‚WPF),å…·ä½“å¯ä»¥çœ‹çœ‹ä¸‹é¢ä»‹ç»</p><ul><li><a href="https://github.com/microsoft/microsoft-ui-xaml/blob/main/docs/roadmap.md#benefits-of-winui">microsoft-ui-xaml/docs/roadmap.md at main Â· microsoft/microsoft-ui-xaml (github.com)</a></li><li><a href="https://github.com/robloo/PublicDocs/blob/master/UWPvsWPF.md">PublicDocs/UWPvsWPF.md at master Â· robloo/PublicDocs (github.com)</a></li></ul><p>å¦å¤–å‚è€ƒæŸäº›å¤§ä½¬çš„å»ºè®®</p><blockquote><p>QtWidgets å¯¹æ ‡ WinFormï¼ŒQtQuick å¯¹æ ‡ WPFï¼ŒQtWebEngine å¯¹æ ‡ cef/electron/react nativeï¼Œå¯ä»¥åœ¨åŒä¸€ä¸ªé‡ŒåŒæ—¶ä½¿ç”¨å¤šç§å¼€å‘æ¨¡å¼æ··åˆå¼€å‘</p><p>æ¯”å¦‚ä¸»ç•Œé¢ç”¨ QtWidgets åšï¼Œè€Œå„ç§å¿«é€Ÿè¿­ä»£çš„ç•Œé¢ç”¨ QtWebEngine + web æŠ€æœ¯å¼€å‘ï¼Œè€Œä¸æ˜¯å•ä¸€çš„åªæä¾›ä¸€ç§ã€‚</p></blockquote><p><a href="https://www.zhihu.com/question/476748969">ç‹¬ç«‹å¼€å‘æ¡Œé¢ç¨‹åºï¼ˆWindowsï¼‰UIæ¡†æ¶é€‰æ‹©å“ªä¸ªæ›´å¥½ï¼Ÿ - çŸ¥ä¹ (zhihu.com)</a></p><h3 id="FYI"><a href="#FYI" class="headerlink" title="FYI"></a>FYI</h3><ol><li><a href="https://www.jetbrains.com/help/kotlin-multiplatform-dev/cross-platform-frameworks.html#what-is-a-cross-platform-app-development-framework">The Six Most Popular Cross-Platform App Development Frameworks | Kotlin Multiplatform Development Documentation (jetbrains.com)</a></li></ol><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;p&gt;å¾ˆä¹…æ²¡æœ‰å†™è¿™ç±»high-levelçš„æ–‡ç« äº†,æœ¬èº«è¿™ç±»æ¡†æ¶å°±ä¸€ç›´å±‚å‡ºä¸ç©·,ä½†æ˜¯å…¶ä¸­å†ä¹…å¼¥åš,åšéŸ§ä¸æ‹”çš„æ¡†æ¶åˆæœ‰å¤šå°‘å‘¢?&lt;br&gt;</summary>
    
    
    
    
  </entry>
  
  <entry>
    <title>modern cpp learning(ä¸€)</title>
    <link href="https://www.sekyoro.top/2024/06/02/modern-cpp-learning(%E4%B8%80)/"/>
    <id>https://www.sekyoro.top/2024/06/02/modern-cpp-learning(%E4%B8%80)/</id>
    <published>2024-06-02T14:31:56.000Z</published>
    <updated>2024-06-09T07:38:46.946Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>cpp,å¤è€åˆä¼ ç»Ÿçš„è¯­è¨€,ä½†å®ƒä¾ç„¶æ˜¯è®¸å¤šè¯­è¨€å¸Œæœ›æ›¿ä»£æˆ˜èƒœçš„.è¿™é‡Œä»‹ç»ä¸€äº›æ–°ç‰¹æ€§.<br><span id="more"></span></p><p>ç”±äºcppåªæœ‰è¯­è¨€æ ‡å‡†,ä¸åŒç¼–è¯‘å™¨å…·ä½“å®ç°ä¸åŒ,è¿™é‡Œä½¿ç”¨çš„æ˜¯clang.</p><p>é¢„å¤‡çŸ¥è¯†:C++98 ä¸»è¦åŒ…æ‹¬æŒ‡é’ˆ(å¯¹äºc/c++å¾ˆé‡è¦çš„ä¸œè¥¿),ç»“æ„ä½“,ç±»(å°¤å…¶æ˜¯<strong>ä¸åŒçš„æ„é€ å‡½æ•°</strong>),<strong>lambdaå‡½æ•°</strong>,STL,å¼•ç”¨,å‘½åç©ºé—´ä»¥åŠ<strong>æ¨¡æ¿ç¼–ç¨‹</strong>.</p><p><a href="https://www.runoob.com/cplusplus/cpp-tutorial.html">C++ æ•™ç¨‹ | èœé¸Ÿæ•™ç¨‹ (runoob.com)</a></p><p><a href="https://www.learncpp.com/">Learn C++ â€“ Skill up with our free tutorials (learncpp.com)</a></p><p><a href="https://zh.cppreference.com/w/">cppreference.com</a></p><p><a href="http://staff.ustc.edu.cn/~lgliu/Courses/ComputerGraphics_2020_spring-summer/default.htm#è¯¾ç¨‹ä½œä¸š">åˆ˜åˆ©åˆšã€Šè®¡ç®—æœºå›¾å½¢å­¦ã€‹2020 (ustc.edu.cn)</a></p><h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>åœ¨å­¦ä¹ ç°ä»£ C++ ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆäº†è§£ä¸€ä¸‹ä» C++11 å¼€å§‹ï¼Œè¢«å¼ƒç”¨çš„ä¸»è¦ç‰¹æ€§ï¼š</p><blockquote><p><strong>æ³¨æ„</strong>ï¼šå¼ƒç”¨å¹¶éå½»åº•ä¸èƒ½ç”¨ï¼Œåªæ˜¯ç”¨äºæš—ç¤ºç¨‹åºå‘˜è¿™äº›ç‰¹æ€§å°†ä»æœªæ¥çš„æ ‡å‡†ä¸­æ¶ˆå¤±ï¼Œåº”è¯¥å°½é‡é¿å…ä½¿ç”¨ã€‚ä½†æ˜¯ï¼Œå·²å¼ƒç”¨çš„ç‰¹æ€§ä¾ç„¶æ˜¯æ ‡å‡†åº“çš„ä¸€éƒ¨åˆ†ï¼Œå¹¶ä¸”å‡ºäºå…¼å®¹æ€§çš„è€ƒè™‘ï¼Œå¤§éƒ¨åˆ†ç‰¹æ€§å…¶å®ä¼šã€æ°¸ä¹…ã€ä¿ç•™ã€‚</p></blockquote><ul><li><p><strong>ä¸å†å…è®¸å­—ç¬¦ä¸²å­—é¢å€¼å¸¸é‡èµ‹å€¼ç»™ä¸€ä¸ª <code>char \*</code>ã€‚å¦‚æœéœ€è¦ç”¨å­—ç¬¦ä¸²å­—é¢å€¼å¸¸é‡èµ‹å€¼å’Œåˆå§‹åŒ–ä¸€ä¸ª <code>char \*</code>ï¼Œåº”è¯¥ä½¿ç”¨ <code>const char \*</code> æˆ–è€… <code>auto</code>ã€‚</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">char</span> *str = <span class="string">&quot;hello world!&quot;</span>; <span class="comment">// å°†å‡ºç°å¼ƒç”¨è­¦å‘Š</span></span><br></pre></td></tr></table></figure></li><li><p><strong>C++98 å¼‚å¸¸è¯´æ˜ã€ <code>unexpected_handler</code>ã€<code>set_unexpected()</code> ç­‰ç›¸å…³ç‰¹æ€§è¢«å¼ƒç”¨ï¼Œåº”è¯¥ä½¿ç”¨ <code>noexcept</code>ã€‚</strong></p></li><li><p><strong><code>auto_ptr</code> è¢«å¼ƒç”¨ï¼Œåº”ä½¿ç”¨ <code>unique_ptr</code>ã€‚</strong></p></li><li><p><strong><code>register</code> å…³é”®å­—è¢«å¼ƒç”¨ï¼Œå¯ä»¥ä½¿ç”¨ä½†ä¸å†å…·å¤‡ä»»ä½•å®é™…å«ä¹‰ã€‚</strong></p></li><li><p><strong><code>bool</code> ç±»å‹çš„ <code>++</code> æ“ä½œè¢«å¼ƒç”¨ã€‚</strong></p></li><li><p><strong>å¦‚æœä¸€ä¸ªç±»æœ‰ææ„å‡½æ•°ï¼Œä¸ºå…¶ç”Ÿæˆæ‹·è´æ„é€ å‡½æ•°å’Œæ‹·è´èµ‹å€¼è¿ç®—ç¬¦çš„ç‰¹æ€§è¢«å¼ƒç”¨äº†ã€‚</strong></p></li><li><p><strong>C è¯­è¨€é£æ ¼çš„ç±»å‹è½¬æ¢è¢«å¼ƒç”¨ï¼ˆå³åœ¨å˜é‡å‰ä½¿ç”¨ <code>(convert_type)</code>ï¼‰ï¼Œåº”è¯¥ä½¿ç”¨ <code>static_cast</code>ã€<code>reinterpret_cast</code>ã€<code>const_cast</code> æ¥è¿›è¡Œç±»å‹è½¬æ¢ã€‚</strong></p></li><li><p><strong>ç‰¹åˆ«åœ°ï¼Œåœ¨æœ€æ–°çš„ C++17 æ ‡å‡†ä¸­å¼ƒç”¨äº†ä¸€äº›å¯ä»¥ä½¿ç”¨çš„ C æ ‡å‡†åº“ï¼Œä¾‹å¦‚ <code>&lt;ccomplex&gt;</code>ã€<code>&lt;cstdalign&gt;</code>ã€<code>&lt;cstdbool&gt;</code> ä¸ <code>&lt;ctgmath&gt;</code> ç­‰</strong></p></li></ul><p><strong>C++ ä¸æ˜¯ C çš„ä¸€ä¸ªè¶…é›†</strong></p><p>åœ¨ç¼–å†™ C++ æ—¶ï¼Œä¹Ÿåº”è¯¥å°½å¯èƒ½çš„é¿å…ä½¿ç”¨è¯¸å¦‚ <code>void*</code> ä¹‹ç±»çš„ç¨‹åºé£æ ¼ã€‚è€Œåœ¨ä¸å¾—ä¸ä½¿ç”¨ C æ—¶ï¼Œåº”è¯¥æ³¨æ„ä½¿ç”¨ <code>extern &quot;C&quot;</code> è¿™ç§ç‰¹æ€§ï¼Œå°† C è¯­è¨€çš„ä»£ç ä¸ C++ä»£ç è¿›è¡Œåˆ†ç¦»ç¼–è¯‘ï¼Œå†ç»Ÿä¸€é“¾æ¥è¿™ç§åšæ³•ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// foo.h</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> __cplusplus</span></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> &#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> __cplusplus</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// foo.c</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x+y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1.1.cpp</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;foo.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;functional&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    [out = std::<span class="built_in">ref</span>(std::cout &lt;&lt; <span class="string">&quot;Result from C code: &quot;</span> &lt;&lt; <span class="built_in">add</span>(<span class="number">1</span>, <span class="number">2</span>))]()&#123;</span><br><span class="line">        out.<span class="built_in">get</span>() &lt;&lt; <span class="string">&quot;.\n&quot;</span>;</span><br><span class="line">    &#125;();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åº”å…ˆä½¿ç”¨ <code>gcc</code> ç¼–è¯‘ C è¯­è¨€çš„ä»£ç ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc -c foo.c</span><br></pre></td></tr></table></figure><p>ç¼–è¯‘å‡º <code>foo.o</code> æ–‡ä»¶ï¼Œå†ä½¿ç”¨ <code>clang++</code> å°† C++ ä»£ç å’Œ <code>.o</code> æ–‡ä»¶é“¾æ¥èµ·æ¥ï¼ˆæˆ–è€…éƒ½ç¼–è¯‘ä¸º <code>.o</code> å†ç»Ÿä¸€é“¾æ¥ï¼‰ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">clang++ 1.1.cpp foo.o -std=c++2a -o 1.1</span><br></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>Makefile</code> æ¥ç¼–è¯‘ä¸Šé¢çš„ä»£ç ï¼š</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">C = gcc</span><br><span class="line">CXX = clang++</span><br><span class="line"></span><br><span class="line">SOURCE_C = foo.c</span><br><span class="line">OBJECTS_C = foo.o</span><br><span class="line"></span><br><span class="line">SOURCE_CXX = 1.1.cpp</span><br><span class="line"></span><br><span class="line">TARGET = 1.1</span><br><span class="line">LDFLAGS_COMMON = -std=c++2a</span><br><span class="line"></span><br><span class="line"><span class="section">all:</span></span><br><span class="line"><span class="variable">$(C)</span> -c <span class="variable">$(SOURCE_C)</span></span><br><span class="line"><span class="variable">$(CXX)</span> <span class="variable">$(SOURCE_CXX)</span> <span class="variable">$(OBJECTS_C)</span> <span class="variable">$(LDFLAGS_COMMON)</span> -o <span class="variable">$(TARGET)</span></span><br><span class="line"><span class="section">clean:</span></span><br><span class="line">rm -rf *.o <span class="variable">$(TARGET)</span></span><br></pre></td></tr></table></figure><p>C++98æ ‡å‡†: ä¼šç”Ÿæˆé»˜è®¤æ„é€ å‡½æ•°, ææ„å‡½æ•°, å¤åˆ¶æ„é€ å‡½æ•°, å¤åˆ¶èµ‹å€¼è¿ç®—ç¬¦</p><p>C++11æ ‡å‡†: é™¤äº†C++98æ ‡å‡†ä¸­ç”Ÿæˆçš„å‡½æ•°å¤–, è¿˜ä¼šç”Ÿæˆç§»åŠ¨æ„é€ å‡½æ•°å’Œç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦</p><p>ä»¥ç±»Aä¸ºä¾‹, ä¸Šè¿°å‡½æ•°è¡¨ç¤ºå¦‚ä¸‹:</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> &#123;</span></span><br><span class="line"> <span class="keyword">public</span>:</span><br><span class="line">  <span class="built_in">A</span>() = <span class="keyword">default</span>;                    <span class="comment">// æ„é€ å‡½æ•°</span></span><br><span class="line">  ~<span class="built_in">A</span>() = <span class="keyword">default</span>;                   <span class="comment">// ææ„å‡½æ•°</span></span><br><span class="line">  <span class="built_in">A</span>(<span class="keyword">const</span> A&amp;) = <span class="keyword">default</span>;            <span class="comment">// å¤åˆ¶æ„é€ å‡½æ•°</span></span><br><span class="line">  A&amp; <span class="keyword">operator</span>=(<span class="keyword">const</span> A&amp;) = <span class="keyword">default</span>; <span class="comment">// å¤åˆ¶èµ‹å€¼è¿ç®—ç¬¦</span></span><br><span class="line">  <span class="built_in">A</span>(A&amp;&amp;) = <span class="keyword">default</span>;                 <span class="comment">// ç§»åŠ¨æ„é€ å‡½æ•°</span></span><br><span class="line">  A&amp; <span class="keyword">operator</span>=(A&amp;&amp;) = <span class="keyword">default</span>;      <span class="comment">// ç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>C++11æ ‡å‡†ä¸­ä¸Šè¿°å‡½æ•°çš„ç”Ÿæˆè§„å¾‹:</p><ul><li><p>åªè¦æŒ‡å®šäº†ä¸€ä¸ªè¦æ±‚ä¼ å‚çš„æ„é€ å‡½æ•°, å°±ä¼šé˜»æ­¢ç¼–è¯‘å™¨ç”Ÿæˆé»˜è®¤æ„é€ å‡½æ•°</p></li><li><p>ä¸¤ç§å¤åˆ¶æ“ä½œæ˜¯å½¼æ­¤ç‹¬ç«‹çš„, å³æ˜¾å¼å£°æ˜äº†å…¶ä¸­ä¸€ä¸ª, ä¸ä¼šé˜»æ­¢ç¼–è¯‘å™¨é»˜è®¤ç”Ÿæˆå¦ä¸€ä¸ª</p></li><li><p>ä¸¤ç§ç§»åŠ¨æ“ä½œå¹¶ä¸å½¼æ­¤ç‹¬ç«‹, å³æ˜¾å¼å£°æ˜äº†å…¶ä¸­ä¸€ä¸ª, å°±ä¼šé˜»æ­¢ç¼–è¯‘å™¨é»˜è®¤ç”Ÿæˆå¦ä¸€ä¸ª</p></li><li><p>ä¸€æ—¦<strong>æ˜¾å¼å£°æ˜äº†å¤åˆ¶æ“ä½œ, å°±ä¼šé˜»æ­¢ç¼–è¯‘å™¨é»˜è®¤ç”Ÿæˆç§»åŠ¨æ“ä½œ</strong></p></li><li><p>ä¸€æ—¦<strong>æ˜¾å¼å£°æ˜äº†ç§»åŠ¨æ“ä½œ, å°±ä¼šé˜»æ­¢ç¼–è¯‘å™¨é»˜è®¤ç”Ÿæˆå¤åˆ¶æ“ä½œ</strong></p></li><li><p>ä¸€æ—¦<strong>æ˜¾å¼ç”³æ˜äº†ææ„å‡½æ•°, å°±ä¼šé˜»æ­¢ç¼–è¯‘å™¨é»˜è®¤ç”Ÿæˆç§»åŠ¨æ“ä½œ</strong></p></li></ul><p>å¦‚æœç¼–è¯‘å™¨é»˜è®¤ç”Ÿæˆçš„ä¸Šè¿°å‡½æ•°èƒ½æ»¡è¶³ä½ çš„éœ€æ±‚, ä½†ç”±äºå„ä¸ªè§„åˆ™è¢«æŠ‘åˆ¶ç”Ÿæˆçš„è¯, å¯ä»¥<strong>é€šè¿‡= defaultæ¥æ˜¾å¼è¡¨è¾¾è¿™ä¸ªæƒ³æ³•</strong>, å¦‚ä¸Šè¿°Aç±»æ‰€ç¤º</p><p>å¤§ä¸‰å¾‹ (Rule of Three)<br><strong>å¦‚æœä½ å£°æ˜äº†å¤åˆ¶æ„é€ å‡½æ•°, å¤åˆ¶èµ‹å€¼è¿ç®—ç¬¦, æˆ–ææ„å‡½æ•°çš„ä»»ä½•ä¸€ä¸ª, ä½ å°±å¾—åŒæ—¶å£°æ˜æ‰€æœ‰è¿™ä¸‰ä¸ª</strong>ã€‚è¿™ä¸ªæ€æƒ³æºäº: å¦‚æœæœ‰æ”¹å†™å¤åˆ¶æ“ä½œçš„éœ€æ±‚, å¾€å¾€æ„å‘³ç€è¯¥ç±»éœ€è¦æ‰§è¡ŒæŸç§èµ„æºç®¡ç†, è€Œè¿™å°±æ„å‘³ç€:</p><ul><li><p>åœ¨ä¸€ç§å¤åˆ¶æ“ä½œä¸­è¿›è¡Œçš„ä»»ä½•èµ„æºç®¡ç†, ä¹Ÿææœ‰å¯èƒ½åœ¨å¦ä¸€ç§å¤åˆ¶æ“ä½œä¸­ä¹Ÿéœ€è¦è¿›è¡Œ</p></li><li><p>è¯¥ç±»çš„ææ„å‡½æ•°ä¹Ÿä¼šå‚ä¸åˆ°è¯¥èµ„æºçš„ç®¡ç†ä¸­(é€šå¸¸æ˜¯é‡Šæ”¾)</p></li></ul><h2 id="å¯ç”¨æ€§çš„å¢å¼º"><a href="#å¯ç”¨æ€§çš„å¢å¼º" class="headerlink" title="å¯ç”¨æ€§çš„å¢å¼º"></a>å¯ç”¨æ€§çš„å¢å¼º</h2><h3 id="å¸¸é‡"><a href="#å¸¸é‡" class="headerlink" title="å¸¸é‡"></a>å¸¸é‡</h3><h4 id="NULLä¸nullptr"><a href="#NULLä¸nullptr" class="headerlink" title="NULLä¸nullptr"></a>NULLä¸nullptr</h4><p>NULLåœ¨ä¸åŒç¼–è¯‘å™¨ä¸­å®ç°ä¸åŒ,é€šå¸¸æ˜¯0æˆ–è€…((void<em>)0).ä½†æ˜¯:C++ <strong>ä¸å…è®¸</strong>ç›´æ¥å°† `void </em><code>éšå¼è½¬æ¢åˆ°å…¶ä»–ç±»å‹ï¼Œä»è€Œ</code>((void*)0)<code>ä¸æ˜¯</code>NULL` çš„åˆæ³•å®ç°ã€‚</p><p>æ²¡æœ‰äº† <code>void *</code> éšå¼è½¬æ¢çš„ C++ åªå¥½å°† <code>NULL</code> å®šä¹‰ä¸º <code>0</code>ã€‚è€Œè¿™ä¾ç„¶ä¼šäº§ç”Ÿæ–°çš„é—®é¢˜ï¼Œå°† <code>NULL</code> å®šä¹‰æˆ <code>0</code> å°†å¯¼è‡´ <code>C++</code> ä¸­é‡è½½ç‰¹æ€§å‘ç”Ÿæ··ä¹±</p><p>ç›´æ¥ä½¿ç”¨nullptr.</p><h4 id="constexpr"><a href="#constexpr" class="headerlink" title="constexpr"></a>constexpr</h4><p>C++ æœ¬èº«å·²ç»å…·å¤‡äº†å¸¸é‡è¡¨è¾¾å¼çš„æ¦‚å¿µï¼Œæ¯”å¦‚ <code>1+2</code>, <code>3*4</code> è¿™ç§è¡¨è¾¾å¼æ€»æ˜¯ä¼šäº§ç”Ÿç›¸åŒçš„ç»“æœå¹¶ä¸”æ²¡æœ‰ä»»ä½•å‰¯ä½œç”¨ã€‚å¦‚æœç¼–è¯‘å™¨èƒ½å¤Ÿåœ¨ç¼–è¯‘æ—¶å°±æŠŠè¿™äº›è¡¨è¾¾å¼ç›´æ¥ä¼˜åŒ–å¹¶æ¤å…¥åˆ°ç¨‹åºè¿è¡Œæ—¶ï¼Œå°†èƒ½å¢åŠ ç¨‹åºçš„æ€§èƒ½ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">char</span> arr_1[<span class="number">10</span>];</span><br><span class="line"><span class="keyword">char</span> arr_2[LEN];</span><br><span class="line"></span><br><span class="line"><span class="keyword">constexpr</span> <span class="keyword">int</span> len2_constexpr = <span class="number">1</span> + <span class="number">2</span> + <span class="number">3</span>;</span><br><span class="line"><span class="keyword">char</span> arr_4[len2_constexpr]</span><br></pre></td></tr></table></figure><h3 id="å˜é‡åˆå§‹åŒ–"><a href="#å˜é‡åˆå§‹åŒ–" class="headerlink" title="å˜é‡åˆå§‹åŒ–"></a>å˜é‡åˆå§‹åŒ–</h3><h4 id="åœ¨if-switchä¸­åˆå§‹åŒ–å˜é‡"><a href="#åœ¨if-switchä¸­åˆå§‹åŒ–å˜é‡" class="headerlink" title="åœ¨if/switchä¸­åˆå§‹åŒ–å˜é‡"></a>åœ¨if/switchä¸­åˆå§‹åŒ–å˜é‡</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å°†ä¸´æ—¶å˜é‡æ”¾åˆ° if è¯­å¥å†…</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">const</span> std::vector&lt;<span class="keyword">int</span>&gt;::iterator itr = std::<span class="built_in">find</span>(vec.<span class="built_in">begin</span>(), vec.<span class="built_in">end</span>(), <span class="number">3</span>);</span><br><span class="line">    itr != vec.<span class="built_in">end</span>()) &#123;</span><br><span class="line">    *itr = <span class="number">4</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="åˆå§‹åŒ–åˆ—è¡¨"><a href="#åˆå§‹åŒ–åˆ—è¡¨" class="headerlink" title="åˆå§‹åŒ–åˆ—è¡¨"></a>åˆå§‹åŒ–åˆ—è¡¨</h4><p>åˆå§‹åŒ–æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„è¯­è¨€ç‰¹æ€§ï¼Œæœ€å¸¸è§çš„å°±æ˜¯åœ¨å¯¹è±¡è¿›è¡Œåˆå§‹åŒ–æ—¶è¿›è¡Œä½¿ç”¨ã€‚ åœ¨ä¼ ç»Ÿ C++ ä¸­ï¼Œä¸åŒçš„å¯¹è±¡æœ‰ç€ä¸åŒçš„åˆå§‹åŒ–æ–¹æ³•ï¼Œä¾‹å¦‚<strong>æ™®é€šæ•°ç»„</strong>ã€ POD ï¼ˆ<strong>P</strong>lain <strong>O</strong>ld <strong>D</strong>ataï¼Œå³<strong>æ²¡æœ‰æ„é€ ã€ææ„å’Œè™šå‡½æ•°çš„ç±»æˆ–ç»“æ„ä½“</strong>ï¼‰ ç±»å‹éƒ½å¯ä»¥ä½¿ç”¨ <code>&#123;&#125;</code> è¿›è¡Œåˆå§‹åŒ–ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„åˆå§‹åŒ–åˆ—è¡¨ã€‚ </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">char</span>* ch = &#123;<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;c&#x27;</span>&#125;</span><br></pre></td></tr></table></figure><p>å¯¹äº<strong>ç±»å¯¹è±¡çš„åˆå§‹åŒ–</strong>ï¼Œè¦ä¹ˆéœ€è¦é€šè¿‡<strong>æ‹·è´æ„é€ </strong>ã€è¦ä¹ˆå°±éœ€è¦<strong>ä½¿ç”¨ <code>()</code> è¿›è¡Œ</strong></p><p>è¿™äº›ä¸åŒæ–¹æ³•éƒ½é’ˆå¯¹å„è‡ªå¯¹è±¡ï¼Œ<strong>ä¸èƒ½é€šç”¨</strong></p><p>ä¸ºè§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒC++11 é¦–å…ˆæŠŠåˆå§‹åŒ–åˆ—è¡¨çš„æ¦‚å¿µç»‘å®šåˆ°ç±»å‹ä¸Šï¼Œç§°å…¶ä¸º <code>std::initializer_list</code>ï¼Œå…è®¸æ„é€ å‡½æ•°æˆ–å…¶ä»–å‡½æ•°åƒå‚æ•°ä¸€æ ·ä½¿ç”¨åˆå§‹åŒ–åˆ—è¡¨ï¼Œè¿™å°±ä¸ºç±»å¯¹è±¡çš„åˆå§‹åŒ–ä¸æ™®é€šæ•°ç»„å’Œ POD çš„åˆå§‹åŒ–æ–¹æ³•æä¾›äº†ç»Ÿä¸€çš„æ¡¥æ¢</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MagicFoo</span> &#123;</span></span><br><span class="line"> <span class="keyword">public</span>:</span><br><span class="line">  std::vector&lt;<span class="keyword">int</span>&gt; vec;</span><br><span class="line">  <span class="built_in">MagicFoo</span>() = <span class="keyword">default</span>;</span><br><span class="line">  <span class="built_in">MagicFoo</span>(std::initializer_list&lt;<span class="keyword">int</span>&gt; list) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> it = list.<span class="built_in">begin</span>(); it != list.<span class="built_in">end</span>(); ++it) &#123;</span><br><span class="line">      vec.<span class="built_in">push_back</span>(*it);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">  MagicFoo magicFoo = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>åˆå§‹åŒ–åˆ—è¡¨é™¤äº†ç”¨åœ¨å¯¹è±¡æ„é€ ä¸Šï¼Œè¿˜èƒ½å°†å…¶ä½œä¸ºæ™®é€šå‡½æ•°çš„å½¢å‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span>:    <span class="function"><span class="keyword">void</span> <span class="title">foo</span><span class="params">(std::initializer_list&lt;<span class="keyword">int</span>&gt; list)</span> </span>&#123;        <span class="keyword">for</span> (std::initializer_list&lt;<span class="keyword">int</span>&gt;::iterator it = list.<span class="built_in">begin</span>();            it != list.<span class="built_in">end</span>(); ++it) vec.<span class="built_in">push_back</span>(*it);    &#125;magicFoo.<span class="built_in">foo</span>(&#123;<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>&#125;);</span><br></pre></td></tr></table></figure><p>è€ƒè™‘å¯ä»¥æ›¿ä»£éº»çƒ¦çš„va_list?</p><p>C++11è¿˜æä¾›äº†ç»Ÿä¸€çš„è¯­æ³•æ¥åˆå§‹åŒ–ä»»æ„çš„å¯¹è±¡</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MagicFoo magicFoo  &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>&#125;;</span><br></pre></td></tr></table></figure><h4 id="ç»“æ„åŒ–ç»‘å®š"><a href="#ç»“æ„åŒ–ç»‘å®š" class="headerlink" title="ç»“æ„åŒ–ç»‘å®š"></a>ç»“æ„åŒ–ç»‘å®š</h4><p>ç»“æ„åŒ–ç»‘å®šæä¾›äº†ç±»ä¼¼å…¶ä»–è¯­è¨€ä¸­æä¾›çš„å¤šè¿”å›å€¼çš„åŠŸèƒ½ã€‚åœ¨å®¹å™¨ä¸€ç« ä¸­ï¼Œæˆ‘ä»¬ä¼šå­¦åˆ° C++11 æ–°å¢äº† <code>std::tuple</code> å®¹å™¨ç”¨äºæ„é€ ä¸€ä¸ªå…ƒç»„ï¼Œè¿›è€Œå›Šæ‹¬å¤šä¸ªè¿”å›å€¼ã€‚ä½†ç¼ºé™·æ˜¯ï¼ŒC++11/14 å¹¶æ²¡æœ‰æä¾›ä¸€ç§ç®€å•çš„æ–¹æ³•ç›´æ¥ä»å…ƒç»„ä¸­æ‹¿åˆ°å¹¶å®šä¹‰å…ƒç»„ä¸­çš„å…ƒç´ ï¼Œå°½ç®¡æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>std::tie</code> å¯¹å…ƒç»„è¿›è¡Œæ‹†åŒ…ï¼Œä½†æˆ‘ä»¬ä¾ç„¶å¿…é¡»éå¸¸æ¸…æ¥šè¿™ä¸ªå…ƒç»„åŒ…å«å¤šå°‘ä¸ªå¯¹è±¡ï¼Œå„ä¸ªå¯¹è±¡æ˜¯ä»€ä¹ˆç±»å‹ï¼Œéå¸¸éº»çƒ¦ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">std::tuple&lt;<span class="keyword">int</span>, <span class="keyword">double</span>, std::string&gt; <span class="title">f</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> std::<span class="built_in">make_tuple</span>(<span class="number">1</span>, <span class="number">2.3</span>, <span class="string">&quot;456&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">  <span class="keyword">auto</span> [x,y,z] = <span class="built_in">f</span>();</span><br><span class="line">  std::cout &lt;&lt; x &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; y &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; z &lt;&lt; std::endl;</span><br></pre></td></tr></table></figure><blockquote><p>å…¶å®å°±æ˜¯æ–¹ä¾¿äº†è¿”å›å€¼çš„è·å–.</p></blockquote><p>åœ¨ä¼ ç»Ÿ C å’Œ C++ ä¸­ï¼Œå‚æ•°çš„ç±»å‹éƒ½å¿…é¡»æ˜ç¡®å®šä¹‰ï¼Œè¿™å…¶å®å¯¹æˆ‘ä»¬å¿«é€Ÿè¿›è¡Œç¼–ç æ²¡æœ‰ä»»ä½•å¸®åŠ©ï¼Œå°¤å…¶æ˜¯<strong>å½“æˆ‘ä»¬é¢å¯¹ä¸€å¤§å †å¤æ‚çš„æ¨¡æ¿ç±»å‹æ—¶ï¼Œå¿…é¡»æ˜ç¡®çš„æŒ‡å‡ºå˜é‡çš„ç±»å‹æ‰èƒ½è¿›è¡Œåç»­çš„ç¼–ç ï¼Œè¿™ä¸ä»…æ‹–æ…¢æˆ‘ä»¬çš„å¼€å‘æ•ˆç‡ï¼Œä¹Ÿè®©ä»£ç å˜å¾—åˆè‡­åˆé•¿</strong>ã€‚</p><p>C++11 å¼•å…¥äº† <code>auto</code> å’Œ <code>decltype</code> è¿™ä¸¤ä¸ªå…³é”®å­—å®ç°äº†ç±»å‹æ¨å¯¼ï¼Œè®©ç¼–è¯‘å™¨æ¥æ“å¿ƒå˜é‡çš„ç±»å‹ã€‚è¿™ä½¿å¾— C++ ä¹Ÿå…·æœ‰äº†å’Œå…¶ä»–ç°ä»£ç¼–ç¨‹è¯­è¨€ä¸€æ ·ï¼ŒæŸç§æ„ä¹‰ä¸Šæä¾›äº†æ— éœ€æ“å¿ƒå˜é‡ç±»å‹çš„ä½¿ç”¨ä¹ æƒ¯ã€‚</p><h3 id="ç±»å‹æ¨å¯¼"><a href="#ç±»å‹æ¨å¯¼" class="headerlink" title="ç±»å‹æ¨å¯¼"></a>ç±»å‹æ¨å¯¼</h3><h4 id="auto"><a href="#auto" class="headerlink" title="auto"></a>auto</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">auto</span> i = <span class="number">5</span>;              <span class="comment">// i è¢«æ¨å¯¼ä¸º int</span></span><br><span class="line"><span class="keyword">auto</span> arr = <span class="keyword">new</span> <span class="built_in"><span class="keyword">auto</span></span>(<span class="number">10</span>); <span class="comment">// arr è¢«æ¨å¯¼ä¸º int *</span></span><br></pre></td></tr></table></figure><p>ä» C++ 14 èµ·ï¼Œ<code>auto</code> èƒ½ç”¨äº lambda è¡¨è¾¾å¼ä¸­çš„å‡½æ•°ä¼ å‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">auto</span> add14 = [](<span class="keyword">auto</span> x, <span class="keyword">auto</span> y) -&gt; <span class="keyword">int</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> x+y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">add20</span><span class="params">(<span class="keyword">auto</span> x, <span class="keyword">auto</span> y)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x+y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">auto</span> i = <span class="number">5</span>; <span class="comment">// type int</span></span><br><span class="line"><span class="keyword">auto</span> j = <span class="number">6</span>; <span class="comment">// type int</span></span><br><span class="line">std::cout &lt;&lt; <span class="built_in">add14</span>(i, j) &lt;&lt; std::endl;</span><br><span class="line">std::cout &lt;&lt; <span class="built_in">add20</span>(i, j) &lt;&lt; std::endl;</span><br></pre></td></tr></table></figure><h4 id="decltype"><a href="#decltype" class="headerlink" title="decltype"></a>decltype</h4><p><code>decltype</code> å…³é”®å­—æ˜¯ä¸ºäº†è§£å†³ <code>auto</code> å…³é”®å­—åªèƒ½å¯¹å˜é‡è¿›è¡Œç±»å‹æ¨å¯¼çš„ç¼ºé™·è€Œå‡ºç°çš„ã€‚å®ƒçš„ç”¨æ³•å’Œ <code>typeof</code> å¾ˆç›¸ä¼¼</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">auto</span> x = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">auto</span> y = <span class="number">2</span>;</span><br><span class="line"><span class="keyword">decltype</span>(x+y) z; <span class="comment">// åˆ©ç”¨å…¶å®ƒå˜é‡ç±»å‹å£°æ˜å˜é‡</span></span><br></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (std::is_same&lt;<span class="keyword">decltype</span>(x), <span class="keyword">int</span>&gt;::value)</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;type x == int&quot;</span> &lt;&lt; std::endl;</span><br><span class="line"><span class="keyword">if</span> (std::is_same&lt;<span class="keyword">decltype</span>(x), <span class="keyword">float</span>&gt;::value)</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;type x == float&quot;</span> &lt;&lt; std::endl;</span><br><span class="line"><span class="keyword">if</span> (std::is_same&lt;<span class="keyword">decltype</span>(x), <span class="keyword">decltype</span>(z)&gt;::value)</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;type z == type x&quot;</span> &lt;&lt; std::endl;</span><br></pre></td></tr></table></figure><p>åˆ¤æ–­ç±»å‹æ˜¯å¦ç›¸åŒ</p><h4 id="å°¾è¿”å›ç±»å‹æ¨å¯¼"><a href="#å°¾è¿”å›ç±»å‹æ¨å¯¼" class="headerlink" title="å°¾è¿”å›ç±»å‹æ¨å¯¼"></a>å°¾è¿”å›ç±»å‹æ¨å¯¼</h4><p>æ¥çœ‹ä¸‹é¢ä»£ç çš„è¿›åŒ–.ä¸€å¼€å§‹,è¿™æ ·çš„ä»£ç å¾ˆä¸‘é™‹ï¼Œå› ä¸ºç¨‹åºå‘˜åœ¨ä½¿ç”¨è¿™ä¸ªæ¨¡æ¿å‡½æ•°çš„æ—¶å€™ï¼Œå¿…é¡»æ˜ç¡®æŒ‡å‡ºè¿”å›ç±»å‹ã€‚ä½†äº‹å®ä¸Šæˆ‘ä»¬å¹¶ä¸çŸ¥é“ <code>add()</code> è¿™ä¸ªå‡½æ•°ä¼šåšä»€ä¹ˆæ ·çš„æ“ä½œï¼Œä»¥åŠè·å¾—ä¸€ä¸ªä»€ä¹ˆæ ·çš„è¿”å›ç±»å‹</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> R, <span class="keyword">typename</span> T, <span class="keyword">typename</span> U&gt;</span><br><span class="line"><span class="function">R <span class="title">add</span><span class="params">(T x, U y)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> x + y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T, <span class="keyword">typename</span> U&gt;</span><br><span class="line"><span class="function"><span class="keyword">auto</span> <span class="title">add</span><span class="params">(T x, U y)</span>-&gt;<span class="title">decltype</span><span class="params">(x + y)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> x + y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T, <span class="keyword">typename</span> U&gt;</span><br><span class="line"><span class="function"><span class="keyword">auto</span> <span class="title">add</span><span class="params">(T x, U y)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> x + y;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ C++11 ä¸­è¿™ä¸ªé—®é¢˜å¾—åˆ°è§£å†³ã€‚è™½ç„¶ä½ å¯èƒ½é©¬ä¸Šä¼šååº”å‡ºæ¥ä½¿ç”¨ <code>decltype</code> æ¨å¯¼ <code>x+y</code> çš„ç±»å‹ï¼Œå†™å‡ºè¿™æ ·çš„ä»£ç ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">decltype</span>(x+y) <span class="built_in">add</span>(T x, U y)</span><br></pre></td></tr></table></figure><p>ä½†äº‹å®ä¸Šè¿™æ ·çš„å†™æ³•å¹¶ä¸èƒ½é€šè¿‡ç¼–è¯‘ã€‚è¿™æ˜¯å› ä¸ºåœ¨ç¼–è¯‘å™¨è¯»åˆ° decltype(x+y) æ—¶ï¼Œ<code>x</code> å’Œ <code>y</code> å°šæœªè¢«å®šä¹‰ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒC++11 è¿˜å¼•å…¥äº†ä¸€ä¸ªå«åšå°¾è¿”å›ç±»å‹ï¼ˆtrailing return typeï¼‰ï¼Œåˆ©ç”¨ <code>auto</code> å…³é”®å­—å°†è¿”å›ç±»å‹åç½®.</p><p>ä» C++14 å¼€å§‹æ˜¯å¯ä»¥ç›´æ¥è®©æ™®é€šå‡½æ•°å…·å¤‡è¿”å›å€¼æ¨å¯¼ï¼Œå› æ­¤ç¬¬ä¸‰ç§å†™æ³•ä¹Ÿæ­£ç¡®.</p><blockquote><p>typename å’Œ class åœ¨æ¨¡æ¿å‚æ•°åˆ—è¡¨ä¸­æ²¡æœ‰åŒºåˆ«ï¼Œåœ¨ typename è¿™ä¸ªå…³é”®å­—å‡ºç°ä¹‹å‰ï¼Œéƒ½æ˜¯ä½¿ç”¨ class æ¥å®šä¹‰æ¨¡æ¿å‚æ•°çš„ã€‚ä½†åœ¨æ¨¡æ¿ä¸­å®šä¹‰æœ‰<a href="https://en.cppreference.com/w/cpp/language/dependent_name#The_typename_disambiguator_for_dependent_names">åµŒå¥—ä¾èµ–ç±»å‹</a>çš„å˜é‡æ—¶ï¼Œéœ€è¦ç”¨ typename æ¶ˆé™¤æ­§ä¹‰</p></blockquote><p>åµŒå¥—ä¾èµ–ç±»å‹çš„ä¾‹å­å¦‚ä¸‹</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Base</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">typedef</span> <span class="keyword">int</span> value_type;</span><br><span class="line">    value_type x;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Derived</span> :</span> <span class="keyword">public</span> Base&lt;T&gt; &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// åœ¨è¿™é‡Œ,Derivedç±»éœ€è¦å‘Šè¯‰ç¼–è¯‘å™¨ value_type æ˜¯ä¸€ä¸ªç±»å‹,è€Œä¸æ˜¯å˜é‡</span></span><br><span class="line">    <span class="keyword">typedef</span> <span class="keyword">typename</span> Base&lt;T&gt;::value_type value_type;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">foo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// è¿™é‡Œå¯ä»¥ç›´æ¥ä½¿ç”¨ value_type,å› ä¸ºå·²ç»åœ¨ä¸Šé¢å£°æ˜äº†</span></span><br><span class="line">        value_type y = <span class="number">42</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Derived&lt;<span class="keyword">double</span>&gt; d;</span><br><span class="line">    d.<span class="built_in">foo</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Base</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">typedef</span> <span class="keyword">int</span> value_type;</span><br><span class="line">    value_type x;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Derived</span> :</span> <span class="keyword">public</span> Base&lt;T&gt; &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">foo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// åœ¨æˆå‘˜å‡½æ•°ä¸­ä½¿ç”¨åŸºç±»çš„æˆå‘˜ç±»å‹,éœ€è¦ä½¿ç”¨ typename å…³é”®å­—</span></span><br><span class="line">        <span class="keyword">typename</span> Base&lt;T&gt;::value_type y = <span class="number">42</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h4 id="decltype-auto"><a href="#decltype-auto" class="headerlink" title="decltype(auto)"></a>decltype(auto)</h4><p> C++14 å¼€å§‹æä¾›çš„ä¸€ä¸ªç•¥å¾®å¤æ‚çš„ç”¨æ³•</p><p>ç®€å•æ¥è¯´ï¼Œ<code>decltype(auto)</code> ä¸»è¦<strong>ç”¨äºå¯¹è½¬å‘å‡½æ•°æˆ–å°è£…çš„è¿”å›ç±»å‹è¿›è¡Œæ¨å¯¼</strong>ï¼Œå®ƒä½¿æˆ‘ä»¬<strong>æ— éœ€æ˜¾å¼çš„æŒ‡å®š <code>decltype</code> çš„å‚æ•°è¡¨è¾¾å¼</strong>.</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">std::string  <span class="title">lookup1</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function">std::string&amp; <span class="title">lookup2</span><span class="params">()</span></span>;</span><br><span class="line">\\åœ¨ C++<span class="number">11</span> ä¸­ï¼Œå°è£…å®ç°æ˜¯å¦‚ä¸‹å½¢å¼ï¼š</span><br><span class="line"></span><br><span class="line"><span class="function">std::string <span class="title">look_up_a_string_1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">lookup1</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">std::string&amp; <span class="title">look_up_a_string_2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">lookup2</span>();</span><br><span class="line">&#125;</span><br><span class="line">è€Œæœ‰äº† <span class="keyword">decltype</span>(<span class="keyword">auto</span>)ï¼Œæˆ‘ä»¬å¯ä»¥è®©ç¼–è¯‘å™¨å®Œæˆè¿™ä¸€ä»¶çƒ¦äººçš„å‚æ•°è½¬å‘ï¼š</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">decltype</span>(<span class="keyword">auto</span>) <span class="title">look_up_a_string_1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">lookup1</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">decltype</span>(<span class="keyword">auto</span>) <span class="title">look_up_a_string_2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">lookup2</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ§åˆ¶æµ"><a href="#æ§åˆ¶æµ" class="headerlink" title="æ§åˆ¶æµ"></a>æ§åˆ¶æµ</h3><h4 id="if-constexpr"><a href="#if-constexpr" class="headerlink" title="if constexpr"></a>if constexpr</h4><p>constexprå°†è¡¨è¾¾å¼æˆ–å‡½æ•°ç¼–è¯‘ä¸ºå¸¸é‡ç»“æœ.å¦‚æœæˆ‘ä»¬æŠŠè¿™ä¸€ç‰¹æ€§å¼•å…¥åˆ°æ¡ä»¶åˆ¤æ–­ä¸­å»ï¼Œè®©ä»£ç åœ¨ç¼–è¯‘æ—¶å°±å®Œæˆåˆ†æ”¯åˆ¤æ–­ï¼Œå²‚ä¸æ˜¯èƒ½è®©ç¨‹åºæ•ˆç‡æ›´é«˜ï¼ŸC++17 å°† <code>constexpr</code> è¿™ä¸ªå…³é”®å­—å¼•å…¥åˆ° <code>if</code> è¯­å¥ä¸­ï¼Œå…è®¸åœ¨ä»£ç ä¸­å£°æ˜å¸¸é‡è¡¨è¾¾å¼çš„åˆ¤æ–­æ¡ä»¶</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">auto</span> <span class="title">print_type_info</span><span class="params">(<span class="keyword">const</span> T&amp; t)</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">if</span> <span class="title">constexpr</span> <span class="params">(std::is_integral&lt;T&gt;::value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> t + <span class="number">1</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> t + <span class="number">0.001</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="built_in">print_type_info</span>(<span class="number">5</span>) &lt;&lt; std::endl;</span><br><span class="line">    std::cout &lt;&lt; <span class="built_in">print_type_info</span>(<span class="number">3.14</span>) &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="åŒºé—´forè¿­ä»£"><a href="#åŒºé—´forè¿­ä»£" class="headerlink" title="åŒºé—´forè¿­ä»£"></a>åŒºé—´forè¿­ä»£</h4><p>C++11 å¼•å…¥äº†åŸºäºèŒƒå›´çš„è¿­ä»£å†™æ³•ï¼Œæˆ‘ä»¬æ‹¥æœ‰äº†èƒ½å¤Ÿå†™å‡ºåƒ Python ä¸€æ ·ç®€æ´çš„å¾ªç¯è¯­å¥</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::vector&lt;<span class="keyword">int</span>&gt; vec = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>&#125;;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">auto</span> itr = std::<span class="built_in">find</span>(vec.<span class="built_in">begin</span>(), vec.<span class="built_in">end</span>(), <span class="number">3</span>); itr != vec.<span class="built_in">end</span>()) *itr = <span class="number">4</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> element : vec)</span><br><span class="line">        std::cout &lt;&lt; element &lt;&lt; std::endl; <span class="comment">// read only</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> &amp;element : vec) &#123;</span><br><span class="line">        element += <span class="number">1</span>;                      <span class="comment">// writeable</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> element : vec)</span><br><span class="line">        std::cout &lt;&lt; element &lt;&lt; std::endl; <span class="comment">// read only</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ¨¡æ¿"><a href="#æ¨¡æ¿" class="headerlink" title="æ¨¡æ¿"></a>æ¨¡æ¿</h3><p>C++ çš„æ¨¡æ¿ä¸€ç›´æ˜¯è¿™é—¨è¯­è¨€çš„ä¸€ç§ç‰¹æ®Šçš„è‰ºæœ¯ï¼Œæ¨¡æ¿ç”šè‡³å¯ä»¥ç‹¬ç«‹ä½œä¸ºä¸€é—¨æ–°çš„è¯­è¨€æ¥è¿›è¡Œä½¿ç”¨ã€‚<strong>æ¨¡æ¿çš„å“²å­¦åœ¨äºå°†ä¸€åˆ‡èƒ½å¤Ÿåœ¨ç¼–è¯‘æœŸå¤„ç†çš„é—®é¢˜ä¸¢åˆ°ç¼–è¯‘æœŸè¿›è¡Œå¤„ç†</strong>ï¼Œ<strong>ä»…åœ¨è¿è¡Œæ—¶å¤„ç†é‚£äº›æœ€æ ¸å¿ƒçš„åŠ¨æ€æœåŠ¡</strong>ï¼Œè¿›è€Œå¤§å¹…ä¼˜åŒ–è¿è¡ŒæœŸçš„æ€§èƒ½ã€‚å› æ­¤æ¨¡æ¿ä¹Ÿè¢«å¾ˆå¤šäººè§†ä½œ C++ çš„é»‘é­”æ³•ä¹‹ä¸€</p><h4 id="å¤–éƒ¨æ¨¡æ¿"><a href="#å¤–éƒ¨æ¨¡æ¿" class="headerlink" title="å¤–éƒ¨æ¨¡æ¿"></a>å¤–éƒ¨æ¨¡æ¿</h4><p>ä¼ ç»Ÿ C++ ä¸­ï¼Œæ¨¡æ¿åªæœ‰åœ¨ä½¿ç”¨æ—¶æ‰ä¼šè¢«ç¼–è¯‘å™¨å®ä¾‹åŒ–ã€‚æ¢å¥è¯è¯´ï¼Œåªè¦åœ¨æ¯ä¸ªç¼–è¯‘å•å…ƒï¼ˆæ–‡ä»¶ï¼‰ä¸­ç¼–è¯‘çš„ä»£ç ä¸­é‡åˆ°äº†è¢«å®Œæ•´å®šä¹‰çš„æ¨¡æ¿ï¼Œéƒ½ä¼šå®ä¾‹åŒ–ã€‚è¿™å°±äº§ç”Ÿäº†é‡å¤å®ä¾‹åŒ–è€Œå¯¼è‡´çš„ç¼–è¯‘æ—¶é—´çš„å¢åŠ ã€‚å¹¶ä¸”ï¼Œæˆ‘ä»¬æ²¡æœ‰åŠæ³•é€šçŸ¥ç¼–è¯‘å™¨ä¸è¦è§¦å‘æ¨¡æ¿çš„å®ä¾‹åŒ–ã€‚</p><p>ä¸ºæ­¤ï¼ŒC++11 å¼•å…¥äº†å¤–éƒ¨æ¨¡æ¿ï¼Œæ‰©å……äº†åŸæ¥çš„å¼ºåˆ¶ç¼–è¯‘å™¨åœ¨ç‰¹å®šä½ç½®å®ä¾‹åŒ–æ¨¡æ¿çš„è¯­æ³•ï¼Œä½¿æˆ‘ä»¬èƒ½å¤Ÿæ˜¾å¼çš„é€šçŸ¥ç¼–è¯‘å™¨ä½•æ—¶è¿›è¡Œæ¨¡æ¿çš„å®ä¾‹åŒ–</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> <span class="class"><span class="keyword">class</span> <span class="title">std</span>:</span>:vector&lt;<span class="keyword">bool</span>&gt;;          <span class="comment">// å¼ºè¡Œå®ä¾‹åŒ–</span></span><br><span class="line"><span class="keyword">extern</span> <span class="keyword">template</span> <span class="class"><span class="keyword">class</span> <span class="title">std</span>:</span>:vector&lt;<span class="keyword">double</span>&gt;; <span class="comment">// ä¸åœ¨è¯¥å½“å‰ç¼–è¯‘æ–‡ä»¶ä¸­å®ä¾‹åŒ–æ¨¡æ¿</span></span><br></pre></td></tr></table></figure><blockquote><p>ä¹Ÿå°±æ˜¯åœ¨ç¼–è¯‘å¤šä¸ªå•å…ƒå¼ä½¿å¾—ç›¸åŒå®ä¾‹åŒ–æ¨¡æ¿åªç¼–è¯‘ä¸€æ¬¡</p></blockquote><h4 id="å°–æ‹¬å·â€-gt-â€"><a href="#å°–æ‹¬å·â€-gt-â€" class="headerlink" title="å°–æ‹¬å·â€&gt;â€"></a>å°–æ‹¬å·â€&gt;â€</h4><p>åœ¨ä¼ ç»Ÿ C++ çš„ç¼–è¯‘å™¨ä¸­ï¼Œ<code>&gt;&gt;</code>ä¸€å¾‹è¢«å½“åšå³ç§»è¿ç®—ç¬¦æ¥è¿›è¡Œå¤„ç†ã€‚ä½†å®é™…ä¸Šæˆ‘ä»¬å¾ˆå®¹æ˜“å°±å†™å‡ºäº†åµŒå¥—æ¨¡æ¿çš„ä»£ç ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">std::vector&lt;std::vector&lt;<span class="keyword">int</span>&gt;&gt; matrix;</span><br></pre></td></tr></table></figure><p>è¿™åœ¨ä¼ ç»Ÿ C++ ç¼–è¯‘å™¨ä¸‹æ˜¯ä¸èƒ½å¤Ÿè¢«ç¼–è¯‘çš„ï¼Œè€Œ C++11 å¼€å§‹ï¼Œè¿ç»­çš„å³å°–æ‹¬å·å°†å˜å¾—åˆæ³•ï¼Œå¹¶ä¸”èƒ½å¤Ÿé¡ºåˆ©é€šè¿‡ç¼–è¯‘ã€‚ç”šè‡³äºåƒä¸‹é¢è¿™ç§å†™æ³•éƒ½èƒ½å¤Ÿé€šè¿‡ç¼–è¯‘ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">bool</span> T&gt;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MagicType</span> &#123;</span></span><br><span class="line">    <span class="keyword">bool</span> magic = T;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// in main function:</span></span><br><span class="line">std::vector&lt;MagicType&lt;(1&gt;<span class="number">2</span>)&gt;&gt; magic; <span class="comment">// åˆæ³•, ä½†ä¸å»ºè®®å†™å‡ºè¿™æ ·çš„ä»£ç </span></span><br></pre></td></tr></table></figure><h4 id="ç±»å‹åˆ«åæ¨¡æ¿"><a href="#ç±»å‹åˆ«åæ¨¡æ¿" class="headerlink" title="ç±»å‹åˆ«åæ¨¡æ¿"></a>ç±»å‹åˆ«åæ¨¡æ¿</h4><p><strong>æ¨¡æ¿æ˜¯ç”¨æ¥äº§ç”Ÿç±»å‹çš„ã€‚</strong>åœ¨ä¼ ç»Ÿ C++ ä¸­ï¼Œ<code>typedef</code> å¯ä»¥ä¸ºç±»å‹å®šä¹‰ä¸€ä¸ªæ–°çš„åç§°ï¼Œä½†æ˜¯å´æ²¡æœ‰åŠæ³•ä¸ºæ¨¡æ¿å®šä¹‰ä¸€ä¸ªæ–°çš„åç§°ã€‚å› ä¸ºï¼Œæ¨¡æ¿ä¸æ˜¯ç±»å‹.</p><p>ä½¿ç”¨usingæ›¿ä»£typedef</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">template &lt;typename T, typename U&gt;</span><br><span class="line">class MagicType &#123;</span><br><span class="line"> public:</span><br><span class="line">  T dark;</span><br><span class="line">  U magic;</span><br><span class="line">&#125;;</span><br><span class="line">template &lt;typename T&gt;</span><br><span class="line">using NewProcess = MagicType&lt;std::vector&lt;T&gt;, std::string&gt;;</span><br></pre></td></tr></table></figure><blockquote><p>é€šå¸¸æˆ‘ä»¬ä½¿ç”¨ <code>typedef</code> å®šä¹‰åˆ«åçš„è¯­æ³•æ˜¯ï¼š<code>typedef åŸåç§° æ–°åç§°;</code>ï¼Œä½†æ˜¯å¯¹å‡½æ•°æŒ‡é’ˆç­‰åˆ«åçš„å®šä¹‰è¯­æ³•å´ä¸ç›¸åŒï¼Œè¿™é€šå¸¸ç»™ç›´æ¥é˜…è¯»é€ æˆäº†ä¸€å®šç¨‹åº¦çš„å›°éš¾ã€‚</p></blockquote><h4 id="å˜é•¿å‚æ•°æ¨¡æ¿"><a href="#å˜é•¿å‚æ•°æ¨¡æ¿" class="headerlink" title="å˜é•¿å‚æ•°æ¨¡æ¿"></a>å˜é•¿å‚æ•°æ¨¡æ¿</h4><p>C++11 åŠ å…¥äº†æ–°çš„è¡¨ç¤ºæ–¹æ³•ï¼Œ <strong>å…è®¸ä»»æ„ä¸ªæ•°ã€ä»»æ„ç±»åˆ«çš„æ¨¡æ¿å‚æ•°ï¼ŒåŒæ—¶ä¹Ÿä¸éœ€è¦åœ¨å®šä¹‰æ—¶å°†å‚æ•°çš„ä¸ªæ•°å›ºå®š</strong>ã€‚</p><p><strong>å˜é•¿å‚æ•°æ¨¡æ¿ä¹Ÿèƒ½è¢«ç›´æ¥è°ƒæ•´åˆ°åˆ°æ¨¡æ¿å‡½æ•°ä¸Š</strong>ã€‚ä¼ ç»Ÿ C ä¸­çš„ <code>printf</code> å‡½æ•°ï¼Œ è™½ç„¶ä¹Ÿèƒ½è¾¾æˆä¸å®šä¸ªæ•°çš„å½¢å‚çš„è°ƒç”¨ï¼Œä½†å…¶å¹¶éç±»åˆ«å®‰å…¨ã€‚ è€Œ C++11 é™¤äº†èƒ½å®šä¹‰ç±»åˆ«å®‰å…¨çš„å˜é•¿å‚æ•°å‡½æ•°å¤–ï¼Œ è¿˜å¯ä»¥ä½¿ç±»ä¼¼ <code>printf</code> çš„å‡½æ•°èƒ½è‡ªç„¶åœ°å¤„ç†éè‡ªå¸¦ç±»åˆ«çš„å¯¹è±¡ã€‚ é™¤äº†<strong>åœ¨æ¨¡æ¿å‚æ•°ä¸­èƒ½ä½¿ç”¨ <code>...</code> è¡¨ç¤ºä¸å®šé•¿æ¨¡æ¿å‚æ•°å¤–</strong>ï¼Œ <strong>å‡½æ•°å‚æ•°ä¹Ÿä½¿ç”¨åŒæ ·çš„è¡¨ç¤ºæ³•ä»£è¡¨ä¸å®šé•¿å‚æ•°</strong>ï¼Œ è¿™ä¹Ÿå°±ä¸ºæˆ‘ä»¬ç®€å•ç¼–å†™å˜é•¿å‚æ•°å‡½æ•°æä¾›äº†ä¾¿æ·çš„æ‰‹æ®µï¼Œ</p><p>å®šä¹‰äº†å˜é•¿çš„æ¨¡æ¿å‚æ•°ï¼Œå¦‚ä½•å¯¹å‚æ•°è¿›è¡Œè§£åŒ…å‘¢ï¼Ÿ</p><p>é¦–å…ˆå¯ä»¥ä½¿ç”¨ <code>sizeof...</code> æ¥è®¡ç®—å‚æ•°çš„ä¸ªæ•°ï¼Œï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span>... Ts&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">magic</span><span class="params">(Ts... args)</span> </span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="keyword">sizeof</span>...(args) &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯¹å‚æ•°è¿›è¡Œè§£åŒ…ï¼Œåˆ°ç›®å‰ä¸ºæ­¢è¿˜æ²¡æœ‰ä¸€ç§ç®€å•çš„æ–¹æ³•èƒ½å¤Ÿå¤„ç†å‚æ•°åŒ…ï¼Œä½†æœ‰ä¸¤ç§ç»å…¸çš„å¤„ç†æ‰‹æ³•,ä¸€ç§ä½¿ç”¨é€’å½’(c++17ä¹‹åå¯ä»¥ä½¿ç”¨å˜å‚æ¨¡æ¿å±•å¼€)å¦ä¸€ç§ä½¿ç”¨åˆå§‹åŒ–åˆ—è¡¨å±•å¼€.</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T0&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">printf1</span><span class="params">(T0 value)</span> </span>&#123;</span><br><span class="line">    std::cout &lt;&lt; value &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T, <span class="keyword">typename</span>... Ts&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">printf1</span><span class="params">(T value, Ts... args)</span> </span>&#123;</span><br><span class="line">    std::cout &lt;&lt; value &lt;&lt; std::endl;</span><br><span class="line">    <span class="built_in">printf1</span>(args...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">printf1</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="string">&quot;123&quot;</span>, <span class="number">1.1</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ C++17 ä¸­å¢åŠ äº†<strong>å˜å‚æ¨¡æ¿å±•å¼€</strong>çš„æ”¯æŒï¼Œäºæ˜¯ä½ å¯ä»¥åœ¨ä¸€ä¸ªå‡½æ•°ä¸­å®Œæˆ <code>printf</code> çš„ç¼–å†™ï¼š</p><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">template&lt;typename T0, typename<span class="params">...</span> T&gt;</span><br><span class="line"><span class="literal">void</span> printf2(T0 t0, T<span class="params">...</span> t) &#123;</span><br><span class="line">    std<span class="type">::cout</span> &lt;&lt; t0 &lt;&lt; std<span class="type">::endl</span>;</span><br><span class="line">    <span class="keyword">if</span> constexpr (sizeof<span class="params">...</span>(t) &gt; <span class="number">0</span>) printf2(t<span class="params">...</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>äº‹å®ä¸Šï¼Œæœ‰æ—¶å€™æˆ‘ä»¬è™½ç„¶ä½¿ç”¨äº†å˜å‚æ¨¡æ¿ï¼Œå´ä¸ä¸€å®šéœ€è¦å¯¹å‚æ•°åšé€ä¸ªéå†ï¼Œæˆ‘ä»¬å¯ä»¥<strong>åˆ©ç”¨ <code>std::bind</code> åŠå®Œç¾è½¬å‘ç­‰ç‰¹æ€§å®ç°å¯¹å‡½æ•°å’Œå‚æ•°çš„ç»‘å®š</strong>ï¼Œä»è€Œè¾¾åˆ°æˆåŠŸè°ƒç”¨çš„ç›®çš„ã€‚</p></blockquote><p>é€’å½’æ¨¡æ¿å‡½æ•°æ˜¯ä¸€ç§æ ‡å‡†çš„åšæ³•ï¼Œä½†ç¼ºç‚¹æ˜¾è€Œæ˜“è§çš„åœ¨äºå¿…é¡»å®šä¹‰ä¸€ä¸ªç»ˆæ­¢é€’å½’çš„å‡½æ•°ã€‚</p><p>è¿™é‡Œä»‹ç»ä¸€ç§ä½¿ç”¨<strong>åˆå§‹åŒ–åˆ—è¡¨å±•å¼€</strong>çš„é»‘é­”æ³•ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T, <span class="keyword">typename</span>... Ts&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">auto</span> <span class="title">printf3</span><span class="params">(T value, Ts... args)</span> </span>&#123;</span><br><span class="line">    std::cout &lt;&lt; value &lt;&lt; std::endl;</span><br><span class="line">    (<span class="keyword">void</span>) std::initializer_list&lt;T&gt;&#123;([&amp;args] &#123;</span><br><span class="line">        std::cout &lt;&lt; args &lt;&lt; std::endl;</span><br><span class="line">    &#125;(), value)...&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªä»£ç ä¸­ï¼Œé¢å¤–ä½¿ç”¨äº† C++11 ä¸­æä¾›çš„åˆå§‹åŒ–åˆ—è¡¨ä»¥åŠ Lambda è¡¨è¾¾å¼çš„ç‰¹æ€§.</p><p>é€šè¿‡åˆå§‹åŒ–åˆ—è¡¨ï¼Œ<code>(lambda è¡¨è¾¾å¼, value)...</code> å°†ä¼šè¢«å±•å¼€ã€‚ç”±äºé€—å·è¡¨è¾¾å¼çš„å‡ºç°ï¼Œé¦–å…ˆä¼šæ‰§è¡Œå‰é¢çš„ lambda è¡¨è¾¾å¼ï¼Œå®Œæˆå‚æ•°çš„è¾“å‡ºã€‚ ä¸ºäº†é¿å…ç¼–è¯‘å™¨è­¦å‘Šï¼Œæˆ‘ä»¬å¯ä»¥å°† <code>std::initializer_list</code> æ˜¾å¼çš„è½¬ä¸º <code>void</code></p><h4 id="æŠ˜å è¡¨è¾¾å¼"><a href="#æŠ˜å è¡¨è¾¾å¼" class="headerlink" title="æŠ˜å è¡¨è¾¾å¼"></a>æŠ˜å è¡¨è¾¾å¼</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> ... T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">auto</span> <span class="title">sum</span><span class="params">(T ... t)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (t + ...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="built_in">sum</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>) &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="éç±»å‹æ¨¡æ¿å‚æ•°æ¨å¯¼"><a href="#éç±»å‹æ¨¡æ¿å‚æ•°æ¨å¯¼" class="headerlink" title="éç±»å‹æ¨¡æ¿å‚æ•°æ¨å¯¼"></a>éç±»å‹æ¨¡æ¿å‚æ•°æ¨å¯¼</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T, <span class="keyword">int</span> BufSize&gt;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">buffer_t</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">T&amp; <span class="title">alloc</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">free</span><span class="params">(T&amp; item)</span></span>;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    T data[BufSize];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">buffer_t</span>&lt;<span class="keyword">int</span>, <span class="number">100</span>&gt; buf; <span class="comment">// 100 ä½œä¸ºæ¨¡æ¿å‚æ•°</span></span><br></pre></td></tr></table></figure><p>æ—¢ç„¶æ­¤å¤„çš„æ¨¡æ¿å‚æ•° ä»¥å…·ä½“çš„å­—é¢é‡è¿›è¡Œä¼ é€’ï¼Œèƒ½å¦è®©ç¼–è¯‘å™¨è¾…åŠ©æˆ‘ä»¬è¿›è¡Œç±»å‹æ¨å¯¼ï¼Œ é€šè¿‡ä½¿ç”¨å ä½ç¬¦ <code>auto</code> ä»è€Œä¸å†éœ€è¦æ˜ç¡®æŒ‡æ˜ç±»å‹ï¼Ÿ å¹¸è¿çš„æ˜¯ï¼ŒC++17 å¼•å…¥äº†è¿™ä¸€ç‰¹æ€§ï¼Œæˆ‘ä»¬çš„ç¡®å¯ä»¥ <code>auto</code> å…³é”®å­—ï¼Œè®©ç¼–è¯‘å™¨è¾…åŠ©å®Œæˆå…·ä½“ç±»å‹çš„æ¨å¯¼ï¼Œ ä¾‹å¦‚ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">auto</span> value&gt; <span class="function"><span class="keyword">void</span> <span class="title">foo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::cout &lt;&lt; value &lt;&lt; std::endl;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    foo&lt;<span class="number">10</span>&gt;();  <span class="comment">// value è¢«æ¨å¯¼ä¸º int ç±»å‹</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="é¢å‘å¯¹è±¡"><a href="#é¢å‘å¯¹è±¡" class="headerlink" title="é¢å‘å¯¹è±¡"></a>é¢å‘å¯¹è±¡</h3><p>C++11 å¼•å…¥äº†å§”æ‰˜æ„é€ çš„æ¦‚å¿µï¼Œè¿™ä½¿å¾—æ„é€ å‡½æ•°å¯ä»¥åœ¨åŒä¸€ä¸ªç±»ä¸­ä¸€ä¸ªæ„é€ å‡½æ•°è°ƒç”¨å¦ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œä»è€Œè¾¾åˆ°ç®€åŒ–ä»£ç çš„ç›®çš„</p><h4 id="å§”æ‰˜æ„é€ "><a href="#å§”æ‰˜æ„é€ " class="headerlink" title="å§”æ‰˜æ„é€ "></a>å§”æ‰˜æ„é€ </h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Base</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">int</span> value1;</span><br><span class="line">    <span class="keyword">int</span> value2;</span><br><span class="line">    <span class="built_in">Base</span>() &#123;</span><br><span class="line">        value1 = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">Base</span>(<span class="keyword">int</span> value) : <span class="built_in">Base</span>() &#123; <span class="comment">// å§”æ‰˜ Base() æ„é€ å‡½æ•°</span></span><br><span class="line">        value2 = value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function">Base <span class="title">b</span><span class="params">(<span class="number">2</span>)</span></span>;</span><br><span class="line">    std::cout &lt;&lt; b.value1 &lt;&lt; std::endl;</span><br><span class="line">    std::cout &lt;&lt; b.value2 &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ç»§æ‰¿æ„é€ "><a href="#ç»§æ‰¿æ„é€ " class="headerlink" title="ç»§æ‰¿æ„é€ "></a>ç»§æ‰¿æ„é€ </h4><p>åœ¨ä¼ ç»Ÿ C++ ä¸­ï¼Œ<strong>æ„é€ å‡½æ•°å¦‚æœéœ€è¦ç»§æ‰¿æ˜¯éœ€è¦å°†å‚æ•°ä¸€ä¸€ä¼ é€’çš„ï¼Œè¿™å°†å¯¼è‡´æ•ˆç‡ä½ä¸‹</strong>ã€‚C++11 åˆ©ç”¨å…³é”®å­— <code>using</code> å¼•å…¥äº†ç»§æ‰¿æ„é€ å‡½æ•°çš„æ¦‚å¿µ</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Base</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">int</span> value1;</span><br><span class="line">    <span class="keyword">int</span> value2;</span><br><span class="line">    <span class="built_in">Base</span>() &#123;</span><br><span class="line">        value1 = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">Base</span>(<span class="keyword">int</span> value) : <span class="built_in">Base</span>() &#123; <span class="comment">// å§”æ‰˜ Base() æ„é€ å‡½æ•°</span></span><br><span class="line">        value2 = value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Subclass</span> :</span> <span class="keyword">public</span> Base &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">using</span> Base::Base; <span class="comment">// ç»§æ‰¿æ„é€ </span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function">Subclass <span class="title">s</span><span class="params">(<span class="number">3</span>)</span></span>;</span><br><span class="line">    std::cout &lt;&lt; s.value1 &lt;&lt; std::endl;</span><br><span class="line">    std::cout &lt;&lt; s.value2 &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ˜¾ç¤ºè™šå‡½æ•°é‡è½½"><a href="#æ˜¾ç¤ºè™šå‡½æ•°é‡è½½" class="headerlink" title="æ˜¾ç¤ºè™šå‡½æ•°é‡è½½"></a>æ˜¾ç¤ºè™šå‡½æ•°é‡è½½</h4><p>åœ¨c++ä¸­é€šè¿‡virtualå£°æ˜å¯é‡è½½çš„æ–¹æ³•,ç§°ä¸ºè™šå‡½æ•°,ä½†åªè¦ä¸æ˜¯çº¯è™šå‡½æ•°,å­ç±»å°±å¯ä»¥ä¸ç”¨å»é‡è½½å®ç°.</p><p>ä½†æ˜¯å¦‚æœå®ç°äº†ä¸€ä¸ªåŒåæ–¹æ³•,é€šè¿‡overrideçœ‹æœ‰æ²¡æœ‰å¯¹åº”çš„åŸºç±»æ–¹æ³•.</p><p>é€šè¿‡finalè®©ç±»æˆ–è€…æ–¹æ³•ä¸èƒ½è¢«ç»§æ‰¿å’Œé‡è½½.</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Base</span> &#123;</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">foo</span><span class="params">(<span class="keyword">int</span>)</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">SubClass</span>:</span> Base &#123;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">foo</span><span class="params">(<span class="keyword">int</span>)</span> <span class="keyword">override</span></span>; <span class="comment">// åˆæ³•</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">foo</span><span class="params">(<span class="keyword">float</span>)</span> <span class="keyword">override</span></span>; <span class="comment">// éæ³•, çˆ¶ç±»æ²¡æœ‰æ­¤è™šå‡½æ•°</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><code>final</code> åˆ™æ˜¯ä¸ºäº†é˜²æ­¢ç±»è¢«ç»§ç»­ç»§æ‰¿ä»¥åŠç»ˆæ­¢è™šå‡½æ•°ç»§ç»­é‡è½½å¼•å…¥çš„ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Base</span> &#123;</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">foo</span><span class="params">()</span> <span class="keyword">final</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">SubClass1</span> <span class="keyword">final</span>:</span> Base &#123;</span><br><span class="line">&#125;; <span class="comment">// åˆæ³•</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">SubClass2</span> :</span> SubClass1 &#123;</span><br><span class="line">&#125;; <span class="comment">// éæ³•, SubClass1 å·² final</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">SubClass3</span>:</span> Base &#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">foo</span><span class="params">()</span></span>; <span class="comment">// éæ³•, foo å·² final</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h4 id="æ˜¾ç¤ºç¦ç”¨é»˜è®¤å‡½æ•°"><a href="#æ˜¾ç¤ºç¦ç”¨é»˜è®¤å‡½æ•°" class="headerlink" title="æ˜¾ç¤ºç¦ç”¨é»˜è®¤å‡½æ•°"></a>æ˜¾ç¤ºç¦ç”¨é»˜è®¤å‡½æ•°</h4><p>åœ¨ä¼ ç»Ÿ C++ ä¸­ï¼Œå¦‚æœç¨‹åºå‘˜æ²¡æœ‰æä¾›ï¼Œ<strong>ç¼–è¯‘å™¨ä¼šé»˜è®¤ä¸ºå¯¹è±¡ç”Ÿæˆé»˜è®¤æ„é€ å‡½æ•°ã€ å¤åˆ¶æ„é€ ã€èµ‹å€¼ç®—ç¬¦ä»¥åŠææ„å‡½æ•°</strong>ã€‚ å¦å¤–ï¼ŒC++ ä¹Ÿä¸ºæ‰€æœ‰ç±»å®šä¹‰äº†è¯¸å¦‚ <code>new</code> <code>delete</code> è¿™æ ·çš„è¿ç®—ç¬¦ã€‚ å½“ç¨‹åºå‘˜æœ‰éœ€è¦æ—¶ï¼Œå¯ä»¥é‡è½½è¿™éƒ¨åˆ†å‡½æ•°</p><p>è¿™å°±å¼•å‘äº†ä¸€äº›éœ€æ±‚ï¼š<strong>æ— æ³•ç²¾ç¡®æ§åˆ¶é»˜è®¤å‡½æ•°çš„ç”Ÿæˆè¡Œä¸º</strong>ã€‚ ä¾‹å¦‚<strong>ç¦æ­¢ç±»çš„æ‹·è´æ—¶ï¼Œå¿…é¡»å°†å¤åˆ¶æ„é€ å‡½æ•°ä¸èµ‹å€¼ç®—ç¬¦å£°æ˜ä¸º <code>private</code></strong>ã€‚ å°è¯•ä½¿ç”¨è¿™äº›æœªå®šä¹‰çš„å‡½æ•°å°†å¯¼è‡´ç¼–è¯‘æˆ–é“¾æ¥é”™è¯¯ï¼Œåˆ™æ˜¯ä¸€ç§éå¸¸ä¸ä¼˜é›…çš„æ–¹å¼ã€‚</p><p>ç¼–è¯‘å™¨äº§ç”Ÿçš„é»˜è®¤æ„é€ å‡½æ•°ä¸ç”¨æˆ·å®šä¹‰çš„æ„é€ å‡½æ•°æ— æ³•åŒæ—¶å­˜åœ¨ã€‚ è‹¥ç”¨æˆ·å®šä¹‰äº†ä»»ä½•æ„é€ å‡½æ•°ï¼Œç¼–è¯‘å™¨å°†ä¸å†ç”Ÿæˆé»˜è®¤æ„é€ å‡½æ•°.</p><p>C++11 æä¾›äº†ä¸Šè¿°éœ€æ±‚çš„è§£å†³æ–¹æ¡ˆï¼Œå…è®¸æ˜¾å¼çš„å£°æ˜é‡‡ç”¨æˆ–æ‹’ç»ç¼–è¯‘å™¨è‡ªå¸¦çš„å‡½æ•°ï¼Œ ä½†<strong>æœ‰æ—¶å€™æˆ‘ä»¬å´å¸Œæœ›åŒæ—¶æ‹¥æœ‰è¿™ä¸¤ç§æ„é€ å‡½æ•°</strong>ï¼Œè¿™å°±é€ æˆäº†å°´å°¬</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">class Magic &#123;</span><br><span class="line">    public:</span><br><span class="line">    Magic() = default; // æ˜¾å¼å£°æ˜ä½¿ç”¨ç¼–è¯‘å™¨ç”Ÿæˆçš„æ„é€ </span><br><span class="line">    Magic&amp; operator=(const Magic&amp;) = delete; // æ˜¾å¼å£°æ˜æ‹’ç»ç¼–è¯‘å™¨ç”Ÿæˆæ„é€ </span><br><span class="line">    Magic(int magic_number);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å¼ºç±»å‹æšä¸¾"><a href="#å¼ºç±»å‹æšä¸¾" class="headerlink" title="å¼ºç±»å‹æšä¸¾"></a>å¼ºç±»å‹æšä¸¾</h4><p>åœ¨ä¼ ç»Ÿ C++ä¸­ï¼Œæšä¸¾ç±»å‹å¹¶éç±»å‹å®‰å…¨ï¼Œæšä¸¾ç±»å‹ä¼šè¢«è§†ä½œæ•´æ•°ï¼Œåˆ™ä¼šè®©ä¸¤ç§å®Œå…¨ä¸åŒçš„æšä¸¾ç±»å‹å¯ä»¥è¿›è¡Œç›´æ¥çš„æ¯”è¾ƒï¼ˆè™½ç„¶ç¼–è¯‘å™¨ç»™å‡ºäº†æ£€æŸ¥ï¼Œä½†å¹¶éæ‰€æœ‰ï¼‰ï¼Œ<strong>ç”šè‡³åŒä¸€ä¸ªå‘½åç©ºé—´ä¸­çš„ä¸åŒæšä¸¾ç±»å‹çš„æšä¸¾å€¼åå­—ä¸èƒ½ç›¸åŒ</strong>ï¼Œè¿™é€šå¸¸ä¸æ˜¯æˆ‘ä»¬å¸Œæœ›çœ‹åˆ°çš„ç»“æœã€‚</p><blockquote><p>enum classæ›¿ä»£enum</p></blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="keyword">class</span> <span class="title">Color</span> :</span> <span class="keyword">uint8_t</span> &#123; RED = <span class="number">1</span>, GREEN = <span class="number">2</span>, BLUE = <span class="number">3</span> &#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿™æ ·å®šä¹‰çš„æšä¸¾<strong>å®ç°äº†ç±»å‹å®‰å…¨</strong>ï¼Œé¦–å…ˆ<strong>ä»–ä¸èƒ½å¤Ÿè¢«éšå¼çš„è½¬æ¢ä¸ºæ•´æ•°</strong>ï¼ŒåŒæ—¶<strong>ä¹Ÿä¸èƒ½å¤Ÿå°†å…¶ä¸æ•´æ•°æ•°å­—è¿›è¡Œæ¯”è¾ƒ</strong>ï¼Œ <strong>æ›´ä¸å¯èƒ½å¯¹ä¸åŒçš„æšä¸¾ç±»å‹çš„æšä¸¾å€¼è¿›è¡Œæ¯”è¾ƒ</strong>ã€‚<strong>ä½†ç›¸åŒæšä¸¾å€¼ä¹‹é—´å¦‚æœæŒ‡å®šçš„å€¼ç›¸åŒï¼Œé‚£ä¹ˆå¯ä»¥è¿›è¡Œæ¯”è¾ƒ</strong></p><p>æˆ‘ä»¬å¸Œæœ›è·å¾—æšä¸¾å€¼çš„å€¼æ—¶ï¼Œå°†å¿…é¡»æ˜¾å¼çš„è¿›è¡Œç±»å‹è½¬æ¢ï¼Œä¸è¿‡æˆ‘ä»¬å¯ä»¥é€šè¿‡é‡è½½ <code>&lt;&lt;</code> è¿™ä¸ªç®—ç¬¦æ¥è¿›è¡Œè¾“å‡º</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line">std::ostream&amp; <span class="keyword">operator</span>&lt;&lt;(</span><br><span class="line">    <span class="keyword">typename</span> std::enable_if&lt;std::is_enum&lt;T&gt;::value, std::ostream&gt;::type&amp; stream,</span><br><span class="line">    <span class="keyword">const</span> T&amp; e) &#123;</span><br><span class="line">  <span class="keyword">return</span> stream &lt;&lt; <span class="keyword">static_cast</span>&lt;<span class="keyword">typename</span> std::underlying_type&lt;T&gt;::type&gt;(e);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ä½œä¸š</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> Key, <span class="keyword">typename</span> Value, <span class="keyword">typename</span> F&gt;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">(std::map&lt;Key, Value&gt;&amp; m, F foo)</span> </span>&#123;</span><br><span class="line">  <span class="comment">// <span class="doctag">TODO:</span></span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">auto</span>&amp;&amp; [key, value] : m) &#123;</span><br><span class="line">    value = <span class="built_in">foo</span>(key);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span>... T&gt;</span><br><span class="line"><span class="function"><span class="keyword">float</span> <span class="title">average</span><span class="params">(T... t)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (t + ...) / <span class="keyword">sizeof</span>...(t);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>é‡ç‚¹</strong></p><ol><li><code>auto</code> ç±»å‹æ¨å¯¼</li><li>èŒƒå›´ <code>for</code> è¿­ä»£</li><li>åˆå§‹åŒ–åˆ—è¡¨</li><li>å˜å‚æ¨¡æ¿</li></ol><h2 id="è¿è¡ŒæœŸçš„å¼ºåŒ–"><a href="#è¿è¡ŒæœŸçš„å¼ºåŒ–" class="headerlink" title="è¿è¡ŒæœŸçš„å¼ºåŒ–"></a>è¿è¡ŒæœŸçš„å¼ºåŒ–</h2><h3 id="Lambdaè¡¨è¾¾å¼"><a href="#Lambdaè¡¨è¾¾å¼" class="headerlink" title="Lambdaè¡¨è¾¾å¼"></a>Lambdaè¡¨è¾¾å¼</h3><p>Lambda è¡¨è¾¾å¼æ˜¯ç°ä»£ C++ ä¸­æœ€é‡è¦çš„ç‰¹æ€§ä¹‹ä¸€ï¼Œè€Œ Lambda è¡¨è¾¾å¼ï¼Œ<strong>å®é™…ä¸Šå°±æ˜¯æä¾›äº†ä¸€ä¸ªç±»ä¼¼åŒ¿åå‡½æ•°çš„ç‰¹æ€§ï¼Œ è€ŒåŒ¿åå‡½æ•°åˆ™æ˜¯åœ¨éœ€è¦ä¸€ä¸ªå‡½æ•°ï¼Œä½†æ˜¯åˆä¸æƒ³è´¹åŠ›å»å‘½åä¸€ä¸ªå‡½æ•°çš„æƒ…å†µä¸‹å»ä½¿ç”¨çš„ã€‚</strong>è¿™æ ·çš„åœºæ™¯å…¶å®æœ‰å¾ˆå¤šå¾ˆå¤šï¼Œ æ‰€ä»¥åŒ¿åå‡½æ•°å‡ ä¹æ˜¯ç°ä»£ç¼–ç¨‹è¯­è¨€çš„æ ‡é…ã€‚</p><p>Lambda è¡¨è¾¾å¼çš„åŸºæœ¬è¯­æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-attr">[æ•è·åˆ—è¡¨]</span>(å‚æ•°åˆ—è¡¨) <span class="selector-tag">mutable</span>(å¯é€‰) å¼‚å¸¸å±æ€§ <span class="selector-tag">-</span>&gt; è¿”å›ç±»å‹ &#123;</span><br><span class="line"><span class="comment">// å‡½æ•°ä½“</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰€è°“æ•è·åˆ—è¡¨ï¼Œå…¶å®å¯ä»¥ç†è§£ä¸ºå‚æ•°çš„ä¸€ç§ç±»å‹ï¼ŒLambda è¡¨è¾¾å¼å†…éƒ¨å‡½æ•°ä½“åœ¨é»˜è®¤æƒ…å†µä¸‹æ˜¯ä¸èƒ½å¤Ÿä½¿ç”¨å‡½æ•°ä½“å¤–éƒ¨çš„å˜é‡çš„ï¼Œ è¿™æ—¶å€™æ•è·åˆ—è¡¨å¯ä»¥èµ·åˆ°ä¼ é€’å¤–éƒ¨æ•°æ®çš„ä½œç”¨</p><h4 id="å€¼æ•è·"><a href="#å€¼æ•è·" class="headerlink" title="å€¼æ•è·"></a>å€¼æ•è·</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">lambda_value_capture</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> value = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">auto</span> copy_value = [value] &#123;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;;</span><br><span class="line">    value = <span class="number">100</span>;</span><br><span class="line">    <span class="keyword">auto</span> stored_value = <span class="built_in">copy_value</span>();</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;stored_value = &quot;</span> &lt;&lt; stored_value &lt;&lt; std::endl;</span><br><span class="line">    <span class="comment">// è¿™æ—¶, stored_value == 1, è€Œ value == 100.</span></span><br><span class="line">    <span class="comment">// å› ä¸º copy_value åœ¨åˆ›å»ºæ—¶å°±ä¿å­˜äº†ä¸€ä»½ value çš„æ‹·è´</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å¼•ç”¨æ•è·"><a href="#å¼•ç”¨æ•è·" class="headerlink" title="å¼•ç”¨æ•è·"></a>å¼•ç”¨æ•è·</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">lambda_reference_capture</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> value = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">auto</span> copy_value = [&amp;value] &#123;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;;</span><br><span class="line">    value = <span class="number">100</span>;</span><br><span class="line">    <span class="keyword">auto</span> stored_value = <span class="built_in">copy_value</span>();</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;stored_value = &quot;</span> &lt;&lt; stored_value &lt;&lt; std::endl;</span><br><span class="line">    <span class="comment">// è¿™æ—¶, stored_value == 100, value == 100.</span></span><br><span class="line">    <span class="comment">// å› ä¸º copy_value ä¿å­˜çš„æ˜¯å¼•ç”¨</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="éšå¼æ•è·"><a href="#éšå¼æ•è·" class="headerlink" title="éšå¼æ•è·"></a>éšå¼æ•è·</h4><p>æ‰‹åŠ¨ä¹¦å†™æ•è·åˆ—è¡¨æœ‰æ—¶å€™æ˜¯éå¸¸å¤æ‚çš„ï¼Œè¿™ç§æœºæ¢°æ€§çš„å·¥ä½œå¯ä»¥äº¤ç»™ç¼–è¯‘å™¨æ¥å¤„ç†ï¼Œè¿™æ—¶å€™å¯ä»¥åœ¨æ•è·åˆ—è¡¨ä¸­å†™ä¸€ä¸ª <code>&amp;</code> æˆ– <code>=</code> å‘ç¼–è¯‘å™¨å£°æ˜é‡‡ç”¨å¼•ç”¨æ•è·æˆ–è€…å€¼æ•è·.</p><p>æ€»ç»“ä¸€ä¸‹ï¼Œæ•è·æä¾›äº† Lambda è¡¨è¾¾å¼å¯¹å¤–éƒ¨å€¼è¿›è¡Œä½¿ç”¨çš„åŠŸèƒ½ï¼Œæ•è·åˆ—è¡¨çš„æœ€å¸¸ç”¨çš„å››ç§å½¢å¼å¯ä»¥æ˜¯ï¼š</p><ul><li>[] ç©ºæ•è·åˆ—è¡¨</li><li>[name1, name2, â€¦] æ•è·ä¸€ç³»åˆ—å˜é‡</li><li>[&amp;] å¼•ç”¨æ•è·, ä»å‡½æ•°ä½“å†…çš„ä½¿ç”¨ç¡®å®šå¼•ç”¨æ•è·åˆ—è¡¨</li><li>[=] å€¼æ•è·, ä»å‡½æ•°ä½“å†…çš„ä½¿ç”¨ç¡®å®šå€¼æ•è·åˆ—è¡¨</li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[]      <span class="comment">// æ²’æœ‰å®šä¹‰ä»»ä½•å˜é‡ã€‚ä½¿ç”¨æœªå®šä¹‰å˜é‡ä¼šå¼•å‘é”™è¯¯ã€‚</span></span><br><span class="line">[x, &amp;y] <span class="comment">// xä»¥ä¼ å€¼æ–¹å¼ä¼ å…¥ï¼ˆé»˜è®¤ï¼‰ï¼Œyä»¥å¼•ç”¨æ–¹å¼ä¼ å…¥ã€‚</span></span><br><span class="line">[&amp;]     <span class="comment">// ä»»ä½•è¢«ä½¿ç”¨åˆ°çš„å¤–éƒ¨å˜é‡éƒ½éšå¼åœ°ä»¥å¼•ç”¨æ–¹å¼åŠ ä»¥å¼•ç”¨ã€‚</span></span><br><span class="line">[=]     <span class="comment">// ä»»ä½•è¢«ä½¿ç”¨åˆ°çš„å¤–éƒ¨å˜é‡éƒ½éšå¼åœ°ä»¥ä¼ å€¼æ–¹å¼åŠ ä»¥å¼•ç”¨ã€‚</span></span><br><span class="line">[&amp;, x]  <span class="comment">// xæ˜¾å¼åœ°ä»¥ä¼ å€¼æ–¹å¼åŠ ä»¥å¼•ç”¨ã€‚å…¶ä½™å˜é‡ä»¥å¼•ç”¨æ–¹å¼åŠ ä»¥å¼•ç”¨ã€‚</span></span><br><span class="line">[=, &amp;z] <span class="comment">// zæ˜¾å¼åœ°ä»¥å¼•ç”¨æ–¹å¼åŠ ä»¥å¼•ç”¨ã€‚å…¶ä½™å˜é‡ä»¥ä¼ å€¼æ–¹å¼åŠ ä»¥å¼•ç”¨ã€‚</span></span><br></pre></td></tr></table></figure><h4 id="è¡¨è¾¾å¼æ•è·"><a href="#è¡¨è¾¾å¼æ•è·" class="headerlink" title="è¡¨è¾¾å¼æ•è·"></a>è¡¨è¾¾å¼æ•è·</h4><p>ä¸Šé¢æåˆ°çš„å€¼æ•è·ã€å¼•ç”¨æ•è·éƒ½æ˜¯å·²ç»åœ¨å¤–å±‚ä½œç”¨åŸŸå£°æ˜çš„å˜é‡ï¼Œå› æ­¤è¿™äº›æ•è·æ–¹å¼<strong>æ•è·çš„å‡ä¸ºå·¦å€¼ï¼Œè€Œä¸èƒ½æ•è·å³å€¼</strong>ã€‚</p><blockquote><p>å®ƒè¡¨ç¤ºä¸€ä¸ªå³å°†è¢«é”€æ¯çš„ä¸´æ—¶å¯¹è±¡æˆ–è¡¨è¾¾å¼çš„ç»“æœã€‚ä¸ä¹‹ç›¸å¯¹åº”çš„æ˜¯å·¦å€¼(lvalue)ï¼Œå®ƒè¡¨ç¤ºä¸€ä¸ªå¯ä»¥å–åœ°å€çš„å¯¹è±¡ã€‚ä¸‹é¢è®©æˆ‘ä»¬è¯¦ç»†è§£é‡Šä¸€ä¸‹å³å€¼çš„æ¦‚å¿µ:</p><ol><li><strong>ä¸´æ—¶å¯¹è±¡</strong>:<ul><li>å³å€¼é€šå¸¸æŒ‡çš„æ˜¯ä¸´æ—¶å¯¹è±¡,è¿™äº›å¯¹è±¡æ˜¯è¡¨è¾¾å¼çš„ç»“æœ,åœ¨è¡¨è¾¾å¼ç»“æŸåå°±ä¼šè¢«é”€æ¯ã€‚</li><li>ä¾‹å¦‚: <code>std::string(&quot;hello&quot;)</code> æ˜¯ä¸€ä¸ªä¸´æ—¶çš„ <code>std::string</code> å¯¹è±¡,å®ƒæ˜¯ä¸€ä¸ªå³å€¼ã€‚</li></ul></li><li><strong>è¡¨è¾¾å¼ç»“æœ</strong>:<ul><li>ä»»ä½•è¡¨è¾¾å¼çš„ç»“æœéƒ½æ˜¯ä¸€ä¸ªå³å€¼,é™¤éè¯¥è¡¨è¾¾å¼çš„ç»“æœæ˜¯ä¸€ä¸ªå¯ä»¥å–åœ°å€çš„å¯¹è±¡(å³å·¦å€¼)ã€‚</li><li>ä¾‹å¦‚: <code>1 + 2</code> çš„ç»“æœæ˜¯ä¸€ä¸ªå³å€¼,å› ä¸ºå®ƒåªæ˜¯ä¸€ä¸ªä¸´æ—¶çš„æ•°å€¼ã€‚</li></ul></li><li><strong>æ— åå¯¹è±¡</strong>:<ul><li>åœ¨ C++ ä¸­,æ— åå¯¹è±¡ä¹Ÿæ˜¯å³å€¼ã€‚æ— åå¯¹è±¡æ˜¯æ²¡æœ‰å˜é‡åç§°çš„ä¸´æ—¶å¯¹è±¡ã€‚</li><li>ä¾‹å¦‚: <code>MyClass()</code> åˆ›å»ºçš„æ˜¯ä¸€ä¸ªæ— åçš„ <code>MyClass</code> å¯¹è±¡,å®ƒæ˜¯ä¸€ä¸ªå³å€¼ã€‚</li></ul></li><li><strong>ç§»åŠ¨è¯­ä¹‰</strong>:<ul><li>åœ¨ C++11 ä¸­å¼•å…¥äº†ç§»åŠ¨è¯­ä¹‰çš„æ¦‚å¿µ,å®ƒåˆ©ç”¨äº†å³å€¼çš„ç‰¹æ€§æ¥ä¼˜åŒ–æ€§èƒ½ã€‚</li><li>å½“ä¸€ä¸ªå¯¹è±¡ä½œä¸ºå³å€¼ä¼ é€’æ—¶,æˆ‘ä»¬å¯ä»¥â€ç§»åŠ¨â€å®ƒçš„èµ„æº,è€Œä¸æ˜¯å¤åˆ¶å®ƒ,ä»è€Œé¿å…ä¸å¿…è¦çš„å†…å­˜åˆ†é…å’Œå¤åˆ¶æ“ä½œã€‚</li></ul></li></ol></blockquote><p>C++14 ç»™ä¸äº†æˆ‘ä»¬æ–¹ä¾¿ï¼Œ<strong>å…è®¸æ•è·çš„æˆå‘˜ç”¨ä»»æ„çš„è¡¨è¾¾å¼è¿›è¡Œåˆå§‹åŒ–ï¼Œè¿™å°±å…è®¸äº†å³å€¼çš„æ•è·</strong>ï¼Œ è¢«å£°æ˜çš„æ•è·å˜é‡ç±»å‹ä¼šæ ¹æ®è¡¨è¾¾å¼è¿›è¡Œåˆ¤æ–­ï¼Œåˆ¤æ–­æ–¹å¼ä¸ä½¿ç”¨ <code>auto</code> æœ¬è´¨ä¸Šæ˜¯ç›¸åŒçš„</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;memory&gt;</span>  <span class="comment">// std::make_unique</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;utility&gt;</span> <span class="comment">// std::move</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">lambda_expression_capture</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">auto</span> important = std::make_unique&lt;<span class="keyword">int</span>&gt;(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">auto</span> add = [v1 = <span class="number">1</span>, v2 = std::<span class="built_in">move</span>(important)](<span class="keyword">int</span> x, <span class="keyword">int</span> y) -&gt; <span class="keyword">int</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> x+y+v1+(*v2);</span><br><span class="line">    &#125;;</span><br><span class="line">    std::cout &lt;&lt; <span class="built_in">add</span>(<span class="number">3</span>,<span class="number">4</span>) &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­<strong>ï¼Œimportant æ˜¯ä¸€ä¸ªç‹¬å æŒ‡é’ˆï¼Œæ˜¯ä¸èƒ½å¤Ÿè¢« â€œ=â€ å€¼æ•è·åˆ°ï¼Œè¿™æ—¶å€™æˆ‘ä»¬å¯ä»¥å°†å…¶è½¬ç§»ä¸ºå³å€¼</strong>ï¼Œåœ¨è¡¨è¾¾å¼ä¸­åˆå§‹åŒ–</p><h4 id="æ³›å‹lambda"><a href="#æ³›å‹lambda" class="headerlink" title="æ³›å‹lambda"></a>æ³›å‹lambda</h4><p><code>auto</code> å…³é”®å­—ä¸èƒ½å¤Ÿç”¨åœ¨å‚æ•°è¡¨é‡Œï¼Œè¿™æ˜¯å› ä¸ºè¿™æ ·çš„å†™æ³•ä¼šä¸æ¨¡æ¿çš„åŠŸèƒ½äº§ç”Ÿå†²çªã€‚ ä½†æ˜¯ Lambda è¡¨è¾¾å¼å¹¶ä¸æ˜¯æ™®é€šå‡½æ•°ï¼Œæ‰€ä»¥åœ¨æ²¡æœ‰æ˜ç¡®æŒ‡æ˜å‚æ•°è¡¨ç±»å‹çš„æƒ…å†µä¸‹ï¼ŒLambda è¡¨è¾¾å¼å¹¶ä¸èƒ½å¤Ÿæ¨¡æ¿åŒ–ã€‚ å¹¸è¿çš„æ˜¯ï¼Œè¿™ç§éº»çƒ¦åªå­˜åœ¨äº C++11 ä¸­ï¼Œä» C++14 å¼€å§‹ï¼ŒLambda å‡½æ•°çš„å½¢å¼å‚æ•°å¯ä»¥ä½¿ç”¨ <code>auto</code> å…³é”®å­—æ¥äº§ç”Ÿæ„ä¹‰ä¸Šçš„æ³›å‹</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">auto</span> add = [](<span class="keyword">auto</span> x, <span class="keyword">auto</span> y) &#123;</span><br><span class="line">    <span class="keyword">return</span> x+y;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">add</span>(<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line"><span class="built_in">add</span>(<span class="number">1.1</span>, <span class="number">2.2</span>);</span><br></pre></td></tr></table></figure><h3 id="å‡½æ•°å¯¹è±¡åŒ…è£…å™¨"><a href="#å‡½æ•°å¯¹è±¡åŒ…è£…å™¨" class="headerlink" title="å‡½æ•°å¯¹è±¡åŒ…è£…å™¨"></a>å‡½æ•°å¯¹è±¡åŒ…è£…å™¨</h3><h4 id="std-function"><a href="#std-function" class="headerlink" title="std::function"></a>std::function</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> foo = <span class="built_in"><span class="keyword">void</span></span>(<span class="keyword">int</span>); <span class="comment">// å®šä¹‰å‡½æ•°ç±»å‹, using çš„ä½¿ç”¨è§ä¸Šä¸€èŠ‚ä¸­çš„åˆ«åè¯­æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">functional</span><span class="params">(foo f)</span> </span>&#123; <span class="comment">// å‚æ•°åˆ—è¡¨ä¸­å®šä¹‰çš„å‡½æ•°ç±»å‹ foo è¢«è§†ä¸ºé€€åŒ–åçš„å‡½æ•°æŒ‡é’ˆç±»å‹ foo*</span></span><br><span class="line">    <span class="built_in">f</span>(<span class="number">1</span>); <span class="comment">// é€šè¿‡å‡½æ•°æŒ‡é’ˆè°ƒç”¨å‡½æ•°</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">auto</span> f = [](<span class="keyword">int</span> value) &#123;</span><br><span class="line">        std::cout &lt;&lt; value &lt;&lt; std::endl;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="built_in">functional</span>(f); <span class="comment">// ä¼ é€’é—­åŒ…å¯¹è±¡ï¼Œéšå¼è½¬æ¢ä¸º foo* ç±»å‹çš„å‡½æ•°æŒ‡é’ˆå€¼</span></span><br><span class="line">    <span class="built_in">f</span>(<span class="number">1</span>); <span class="comment">// lambda è¡¨è¾¾å¼è°ƒç”¨</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç§æ˜¯å°† Lambda ä½œä¸ºå‡½æ•°ç±»å‹ä¼ é€’è¿›è¡Œè°ƒç”¨ï¼Œ è€Œå¦ä¸€ç§åˆ™æ˜¯ç›´æ¥è°ƒç”¨ Lambda è¡¨è¾¾å¼ï¼Œåœ¨ C++11 ä¸­ï¼Œç»Ÿä¸€äº†è¿™äº›æ¦‚å¿µï¼Œå°†èƒ½å¤Ÿè¢«è°ƒç”¨çš„å¯¹è±¡çš„ç±»å‹ï¼Œ ç»Ÿä¸€ç§°ä¹‹ä¸ºå¯è°ƒç”¨ç±»å‹ã€‚è€Œè¿™ç§ç±»å‹ï¼Œä¾¿æ˜¯é€šè¿‡ <code>std::function</code> å¼•å…¥çš„ã€‚</p><p>C++11 <code>std::function</code> æ˜¯ä¸€ç§é€šç”¨ã€å¤šæ€çš„å‡½æ•°å°è£…ï¼Œ å®ƒçš„å®ä¾‹å¯ä»¥å¯¹ä»»ä½•å¯ä»¥è°ƒç”¨çš„ç›®æ ‡å®ä½“è¿›è¡Œå­˜å‚¨ã€å¤åˆ¶å’Œè°ƒç”¨æ“ä½œï¼Œ å®ƒä¹Ÿæ˜¯å¯¹ C++ ä¸­ç°æœ‰çš„å¯è°ƒç”¨å®ä½“çš„ä¸€ç§ç±»å‹å®‰å…¨çš„åŒ…è£¹ï¼ˆç›¸å¯¹æ¥è¯´ï¼Œå‡½æ•°æŒ‡é’ˆçš„è°ƒç”¨ä¸æ˜¯ç±»å‹å®‰å…¨çš„ï¼‰ï¼Œ æ¢å¥è¯è¯´ï¼Œ<strong>å°±æ˜¯å‡½æ•°çš„å®¹å™¨ã€‚å½“æˆ‘ä»¬æœ‰äº†å‡½æ•°çš„å®¹å™¨ä¹‹åä¾¿èƒ½å¤Ÿæ›´åŠ æ–¹ä¾¿çš„å°†å‡½æ•°ã€å‡½æ•°æŒ‡é’ˆä½œä¸ºå¯¹è±¡è¿›è¡Œå¤„ç†</strong>ã€‚ ä¾‹å¦‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;functional&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">foo</span><span class="params">(<span class="keyword">int</span> para)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> para;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// std::function åŒ…è£…äº†ä¸€ä¸ªè¿”å›å€¼ä¸º int, å‚æ•°ä¸º int çš„å‡½æ•°</span></span><br><span class="line">    std::function&lt;<span class="built_in"><span class="keyword">int</span></span>(<span class="keyword">int</span>)&gt; func = foo;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> important = <span class="number">10</span>;</span><br><span class="line">    std::function&lt;<span class="built_in"><span class="keyword">int</span></span>(<span class="keyword">int</span>)&gt; func2 = [&amp;](<span class="keyword">int</span> value) -&gt; <span class="keyword">int</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>+value+important;</span><br><span class="line">    &#125;;</span><br><span class="line">    std::cout &lt;&lt; <span class="built_in">func</span>(<span class="number">10</span>) &lt;&lt; std::endl;</span><br><span class="line">    std::cout &lt;&lt; <span class="built_in">func2</span>(<span class="number">10</span>) &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="std-bindå’Œstd-placeholder"><a href="#std-bindå’Œstd-placeholder" class="headerlink" title="std::bindå’Œstd::placeholder"></a>std::bind<code>å’Œ</code>std::placeholder</h4><p>è€Œ <code>std::bind</code> åˆ™æ˜¯ç”¨æ¥ç»‘å®šå‡½æ•°è°ƒç”¨çš„å‚æ•°çš„ï¼Œ å®ƒè§£å†³çš„éœ€æ±‚æ˜¯æˆ‘ä»¬æœ‰æ—¶å€™å¯èƒ½å¹¶ä¸ä¸€å®šèƒ½å¤Ÿä¸€æ¬¡æ€§è·å¾—è°ƒç”¨æŸä¸ªå‡½æ•°çš„å…¨éƒ¨å‚æ•°ï¼Œé€šè¿‡è¿™ä¸ªå‡½æ•°ï¼Œ æˆ‘ä»¬å¯ä»¥å°†éƒ¨åˆ†è°ƒç”¨å‚æ•°æå‰ç»‘å®šåˆ°å‡½æ•°èº«ä¸Šæˆä¸ºä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œç„¶ååœ¨å‚æ•°é½å…¨åï¼Œå®Œæˆè°ƒç”¨ã€‚ ä¾‹å¦‚ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">foo</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b, <span class="keyword">int</span> c)</span> </span>&#123;</span><br><span class="line">    ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// å°†å‚æ•°1,2ç»‘å®šåˆ°å‡½æ•° foo ä¸Šï¼Œ</span></span><br><span class="line">    <span class="comment">// ä½†ä½¿ç”¨ std::placeholders::_1 æ¥å¯¹ç¬¬ä¸€ä¸ªå‚æ•°è¿›è¡Œå ä½</span></span><br><span class="line">    <span class="keyword">auto</span> bindFoo = std::<span class="built_in">bind</span>(foo, std::placeholders::_1, <span class="number">1</span>,<span class="number">2</span>);</span><br><span class="line">    <span class="comment">// è¿™æ—¶è°ƒç”¨ bindFoo æ—¶ï¼Œåªéœ€è¦æä¾›ç¬¬ä¸€ä¸ªå‚æ•°å³å¯</span></span><br><span class="line">    <span class="built_in">bindFoo</span>(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å³å€¼å¼•ç”¨"><a href="#å³å€¼å¼•ç”¨" class="headerlink" title="å³å€¼å¼•ç”¨"></a>å³å€¼å¼•ç”¨</h3><p>å³å€¼å¼•ç”¨æ˜¯ C++11 å¼•å…¥çš„<strong>ä¸ Lambda è¡¨è¾¾å¼é½åçš„é‡è¦ç‰¹æ€§ä¹‹ä¸€</strong>ã€‚å®ƒçš„<strong>å¼•å…¥è§£å†³äº† C++ ä¸­å¤§é‡çš„å†å²é—ç•™é—®é¢˜ï¼Œ æ¶ˆé™¤äº†è¯¸å¦‚ <code>std::vector</code>ã€<code>std::string</code> ä¹‹ç±»çš„é¢å¤–å¼€é”€</strong>ï¼Œ ä¹Ÿæ‰ä½¿å¾—å‡½æ•°å¯¹è±¡å®¹å™¨ <code>std::function</code> æˆä¸ºäº†å¯èƒ½</p><p>å·¦å€¼å¼•ç”¨ å·¦å€¼  å³å€¼</p><p><strong>å·¦å€¼</strong> (lvalue, left value)ï¼Œé¡¾åæ€ä¹‰å°±æ˜¯èµ‹å€¼ç¬¦å·å·¦è¾¹çš„å€¼ã€‚å‡†ç¡®æ¥è¯´ï¼Œ <strong>å·¦å€¼æ˜¯è¡¨è¾¾å¼ï¼ˆä¸ä¸€å®šæ˜¯èµ‹å€¼è¡¨è¾¾å¼ï¼‰åä¾ç„¶å­˜åœ¨çš„æŒä¹…å¯¹è±¡</strong>ã€‚</p><p> C++11 ä¸­ä¸ºäº†å¼•å…¥å¼ºå¤§çš„å³å€¼å¼•ç”¨ï¼Œå°†å³å€¼çš„æ¦‚å¿µè¿›è¡Œäº†è¿›ä¸€æ­¥çš„åˆ’åˆ†ï¼Œåˆ†ä¸ºï¼šçº¯å³å€¼ã€å°†äº¡å€¼ã€‚</p><p><strong>çº¯å³å€¼</strong> (prvalue, pure rvalue)ï¼Œçº¯ç²¹çš„å³å€¼ï¼Œè¦ä¹ˆæ˜¯çº¯ç²¹çš„å­—é¢é‡ï¼Œä¾‹å¦‚ <code>10</code>, <code>true</code>ï¼› è¦ä¹ˆæ˜¯æ±‚å€¼ç»“æœç›¸å½“äºå­—é¢é‡æˆ–åŒ¿åä¸´æ—¶å¯¹è±¡ï¼Œä¾‹å¦‚ <code>1+2</code>ã€‚éå¼•ç”¨è¿”å›çš„ä¸´æ—¶å˜é‡ã€<strong>è¿ç®—è¡¨è¾¾å¼äº§ç”Ÿçš„ä¸´æ—¶å˜é‡</strong>ã€ åŸ<strong>å§‹å­—é¢é‡</strong>ã€<strong>Lambda è¡¨è¾¾å¼éƒ½å±äºçº¯å³å€¼</strong>ã€‚</p><p>å­—é¢é‡é™¤äº†å­—ç¬¦ä¸²å­—é¢é‡ä»¥å¤–ï¼Œå‡ä¸ºçº¯å³å€¼ã€‚è€Œ<strong>å­—ç¬¦ä¸²å­—é¢é‡æ˜¯ä¸€ä¸ªå·¦å€¼</strong>ï¼Œç±»å‹ä¸º <code>const char</code> æ•°ç»„</p><p>å°†äº¡å€¼å¯èƒ½ç¨æœ‰äº›éš¾ä»¥ç†è§£ï¼Œæˆ‘ä»¬æ¥çœ‹è¿™æ ·çš„ä»£ç ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">std::vector&lt;<span class="keyword">int</span>&gt; <span class="title">foo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::vector&lt;<span class="keyword">int</span>&gt; temp = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>&#125;;</span><br><span class="line">    <span class="keyword">return</span> temp;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">std::vector&lt;<span class="keyword">int</span>&gt; v = <span class="built_in">foo</span>();</span><br></pre></td></tr></table></figure><p>åœ¨è¿™æ ·çš„ä»£ç ä¸­ï¼Œå°±ä¼ ç»Ÿçš„ç†è§£è€Œè¨€ï¼Œå‡½æ•° <code>foo</code> çš„è¿”å›å€¼ <code>temp</code> åœ¨å†…éƒ¨åˆ›å»ºç„¶åè¢«èµ‹å€¼ç»™ <code>v</code>ï¼Œ ç„¶è€Œ <code>v</code> è·å¾—è¿™ä¸ªå¯¹è±¡æ—¶ï¼Œä¼šå°†æ•´ä¸ª <code>temp</code> æ‹·è´ä¸€ä»½ï¼Œç„¶åæŠŠ <code>temp</code> é”€æ¯ï¼Œå¦‚æœè¿™ä¸ª <code>temp</code> éå¸¸å¤§ï¼Œ è¿™å°†é€ æˆå¤§é‡é¢å¤–çš„å¼€é”€ï¼ˆè¿™ä¹Ÿå°±æ˜¯ä¼ ç»Ÿ C++ ä¸€ç›´è¢«è¯Ÿç—…çš„é—®é¢˜ï¼‰ã€‚åœ¨æœ€åä¸€è¡Œä¸­ï¼Œ<code>v</code> æ˜¯å·¦å€¼ã€ <code>foo()</code> è¿”å›çš„å€¼å°±æ˜¯å³å€¼ï¼ˆä¹Ÿæ˜¯çº¯å³å€¼ï¼‰ã€‚ä½†æ˜¯ï¼Œ<code>v</code> å¯ä»¥è¢«åˆ«çš„å˜é‡æ•è·åˆ°ï¼Œ è€Œ <code>foo()</code> äº§ç”Ÿçš„é‚£ä¸ªè¿”å›å€¼ä½œä¸ºä¸€ä¸ªä¸´æ—¶å€¼ï¼Œä¸€æ—¦è¢« <code>v</code> å¤åˆ¶åï¼Œå°†ç«‹å³è¢«é”€æ¯ï¼Œæ— æ³•è·å–ã€ä¹Ÿä¸èƒ½ä¿®æ”¹ã€‚ è€Œå°†äº¡å€¼å°±å®šä¹‰äº†è¿™æ ·ä¸€ç§è¡Œä¸ºï¼šä¸´æ—¶çš„å€¼èƒ½å¤Ÿè¢«è¯†åˆ«ã€åŒæ—¶åˆèƒ½å¤Ÿè¢«ç§»åŠ¨ã€‚</p><p>åœ¨ C++11 ä¹‹åï¼Œç¼–è¯‘å™¨ä¸ºæˆ‘ä»¬åšäº†ä¸€äº›å·¥ä½œï¼Œ<strong>æ­¤å¤„çš„å·¦å€¼ <code>temp</code> ä¼šè¢«è¿›è¡Œæ­¤éšå¼å³å€¼è½¬æ¢ï¼Œ ç­‰ä»·äº <code>static_cast&lt;std::vector&lt;int&gt; &amp;&amp;&gt;(temp)</code>ï¼Œè¿›è€Œæ­¤å¤„çš„ <code>v</code> ä¼šå°† <code>foo</code> å±€éƒ¨è¿”å›çš„å€¼è¿›è¡Œç§»åŠ¨</strong>ã€‚ ä¹Ÿå°±æ˜¯åé¢æˆ‘ä»¬å°†ä¼šæåˆ°çš„ç§»åŠ¨è¯­ä¹‰ã€‚</p><p>è¦æ‹¿åˆ°ä¸€ä¸ªå°†äº¡å€¼ï¼Œå°±éœ€è¦ç”¨åˆ°å³å€¼å¼•ç”¨ï¼š<code>T &amp;&amp;</code>ï¼Œå…¶ä¸­ <code>T</code> æ˜¯ç±»å‹ã€‚ å³å€¼å¼•ç”¨çš„å£°æ˜è®©è¿™ä¸ªä¸´æ—¶å€¼çš„ç”Ÿå‘½å‘¨æœŸå¾—ä»¥å»¶é•¿ã€åªè¦å˜é‡è¿˜æ´»ç€ï¼Œé‚£ä¹ˆå°†äº¡å€¼å°†ç»§ç»­å­˜æ´»ã€‚</p><p>C++11 æä¾›äº† <code>std::move</code> è¿™ä¸ªæ–¹æ³•å°†å·¦å€¼å‚æ•°æ— æ¡ä»¶çš„è½¬æ¢ä¸ºå³å€¼ï¼Œ æœ‰äº†å®ƒæˆ‘ä»¬å°±èƒ½å¤Ÿæ–¹ä¾¿çš„è·å¾—ä¸€ä¸ªå³å€¼ä¸´æ—¶å¯¹è±¡ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">reference</span><span class="params">(std::string&amp; str)</span> </span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;å·¦å€¼&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">reference</span><span class="params">(std::string&amp;&amp; str)</span> </span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;å³å€¼&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::string lv1 = <span class="string">&quot;string,&quot;</span>; <span class="comment">// lv1 æ˜¯ä¸€ä¸ªå·¦å€¼</span></span><br><span class="line">    <span class="comment">// std::string&amp;&amp; r1 = lv1; // éæ³•, å³å€¼å¼•ç”¨ä¸èƒ½å¼•ç”¨å·¦å€¼</span></span><br><span class="line">    std::string&amp;&amp; rv1 = std::<span class="built_in">move</span>(lv1); <span class="comment">// åˆæ³•, std::moveå¯ä»¥å°†å·¦å€¼è½¬ç§»ä¸ºå³å€¼</span></span><br><span class="line">    std::cout &lt;&lt; rv1 &lt;&lt; std::endl; <span class="comment">// string,</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> std::string&amp; lv2 = lv1 + lv1; <span class="comment">// åˆæ³•, å¸¸é‡å·¦å€¼å¼•ç”¨èƒ½å¤Ÿå»¶é•¿ä¸´æ—¶å˜é‡çš„ç”Ÿå‘½å‘¨æœŸ</span></span><br><span class="line">    <span class="comment">// lv2 += &quot;Test&quot;; // éæ³•, å¸¸é‡å¼•ç”¨æ— æ³•è¢«ä¿®æ”¹</span></span><br><span class="line">    std::cout &lt;&lt; lv2 &lt;&lt; std::endl; <span class="comment">// string,string,</span></span><br><span class="line"></span><br><span class="line">    std::string&amp;&amp; rv2 = lv1 + lv2; <span class="comment">// åˆæ³•, å³å€¼å¼•ç”¨å»¶é•¿ä¸´æ—¶å¯¹è±¡ç”Ÿå‘½å‘¨æœŸ</span></span><br><span class="line">    rv2 += <span class="string">&quot;Test&quot;</span>; <span class="comment">// åˆæ³•, éå¸¸é‡å¼•ç”¨èƒ½å¤Ÿä¿®æ”¹ä¸´æ—¶å˜é‡</span></span><br><span class="line">    std::cout &lt;&lt; rv2 &lt;&lt; std::endl; <span class="comment">// string,string,string,Test</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">reference</span>(rv2); <span class="comment">// è¾“å‡ºå·¦å€¼</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å†å²é—ç•™é—®é¢˜:</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// int &amp;a = std::move(1);    // ä¸åˆæ³•ï¼Œéå¸¸é‡å·¦å¼•ç”¨æ— æ³•å¼•ç”¨å³å€¼</span></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> &amp;b = std::<span class="built_in">move</span>(<span class="number">1</span>); <span class="comment">// åˆæ³•, å¸¸é‡å·¦å¼•ç”¨å…è®¸å¼•ç”¨å³å€¼</span></span><br><span class="line"></span><br><span class="line">    std::cout &lt;&lt; a &lt;&lt; b &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œä¸ºä»€ä¹ˆä¸å…è®¸éå¸¸é‡å¼•ç”¨ç»‘å®šåˆ°éå·¦å€¼ï¼Ÿè¿™æ˜¯å› ä¸ºè¿™ç§åšæ³•å­˜åœ¨é€»è¾‘é”™è¯¯ï¼š</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">increase</span><span class="params">(<span class="keyword">int</span> &amp; v)</span> </span>&#123;</span><br><span class="line">    v++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">foo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">double</span> s = <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">increase</span>(s);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”±äº <code>int&amp;</code> ä¸èƒ½å¼•ç”¨ <code>double</code> ç±»å‹çš„å‚æ•°ï¼Œå› æ­¤å¿…é¡»äº§ç”Ÿä¸€ä¸ªä¸´æ—¶å€¼æ¥ä¿å­˜ <code>s</code> çš„å€¼ï¼Œ ä»è€Œå½“ <code>increase()</code> ä¿®æ”¹è¿™ä¸ªä¸´æ—¶å€¼æ—¶ï¼Œè°ƒç”¨å®Œæˆå <code>s</code> æœ¬èº«å¹¶æ²¡æœ‰è¢«ä¿®æ”¹ã€‚</p><p>ç¬¬äºŒä¸ªé—®é¢˜ï¼Œä¸ºä»€ä¹ˆå¸¸é‡å¼•ç”¨å…è®¸ç»‘å®šåˆ°éå·¦å€¼ï¼ŸåŸå› å¾ˆç®€å•ï¼Œå› ä¸º Fortran éœ€è¦</p><p>æ€»ç»“ä¸€ä¸‹,éå¸¸é‡å·¦å€¼å¼•ç”¨èƒ½å¤Ÿå¼•ç”¨å·¦å€¼ä»¥åŠå³å€¼.å·¦å€¼å¼•ç”¨ä½œä¸ºå‡½æ•°çš„å‚æ•°ï¼Œèƒ½å¤Ÿå‡å°‘æ‹·è´, å·¦å€¼å¼•ç”¨å¯ä»¥å¼•ç”¨å‡½æ•°è¿”å›å€¼ï¼Œä¹Ÿå¯ä»¥å‡å°‘æ‹·è´æ„é€ </p><p><strong>å³å€¼æ˜¯ä¸èƒ½å–å‡ºåœ°å€çš„</strong>ï¼Œä½†æ˜¯å½“å³å€¼å–åˆ«ååï¼Œè¿™ä¸ªå³å€¼ä¼šè¢«å­˜åˆ°ç‰¹å®šçš„ä½ç½®ï¼Œä¸”å¯ä»¥å–åˆ°è¯¥å€¼çš„åœ°å€ï¼Œä¹Ÿå°±æ˜¯è¯´å³å€¼å¼•ç”¨å€¼æ˜¯ä¸€ä¸ªå·¦å€¼ã€‚</p><p>å³å€¼å¼•ç”¨åªèƒ½å¼•ç”¨å³å€¼.  <code>std::move</code>èƒ½å°†å·¦å€¼/å³å€¼éƒ½è½¬ä¸ºå³å€¼å¼•ç”¨</p><p>æ‹¿åˆ°å³å€¼å¼•ç”¨åå°±èƒ½ä½¿ç”¨ç§»åŠ¨æ„é€ å’Œèµ‹å€¼è¿›è¡ŒèŠ‚çœå†…å­˜äº†.</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Vector&amp; <span class="title">func1</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function">Vector&amp;&amp; <span class="title">func2</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function">Vector <span class="title">func3</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    Vector a;</span><br><span class="line">a;              <span class="comment">//å·¦å€¼è¡¨è¾¾å¼</span></span><br><span class="line"><span class="built_in">func1</span>();        <span class="comment">//å·¦å€¼è¡¨è¾¾å¼ï¼Œè¿”è¿˜å€¼æ˜¯ä¸´æ—¶çš„ï¼Œè¿”è¿˜ç±»å‹æ˜¯å·¦å€¼å¼•ç”¨ï¼Œå› æ­¤è¢«è®¤ä¸ºä¸å¯ç§»åŠ¨ã€‚</span></span><br><span class="line"><span class="built_in">func2</span>();        <span class="comment">//å°†äº¡å€¼è¡¨è¾¾å¼ï¼Œè¿”è¿˜å€¼æ˜¯ä¸´æ—¶çš„ï¼Œè¿”è¿˜ç±»å‹æ˜¯å³å€¼å¼•ç”¨ï¼Œå› æ­¤æŒ‡ä»£çš„å¯¹è±¡å³ä½¿éä¸´æ—¶ä¹Ÿä¼šè¢«è®¤ä¸ºå¯ç§»åŠ¨ã€‚</span></span><br><span class="line"><span class="built_in">func3</span>();        <span class="comment">//çº¯å³å€¼è¡¨è¾¾å¼ï¼Œè¿”è¿˜å€¼ä¸ºä¸´æ—¶å€¼ã€‚</span></span><br><span class="line">std::<span class="built_in">move</span>(a)ï¼›  <span class="comment">//å°†äº¡å€¼è¡¨è¾¾å¼ï¼Œstd::moveæœ¬è´¨ä¹Ÿæ˜¯ä¸ªå‡½æ•°ï¼ŒåŒä¸Šã€‚</span></span><br><span class="line"><span class="built_in">Vector</span>();       <span class="comment">//çº¯å³å€¼è¡¨è¾¾å¼</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><blockquote><p>å³å€¼å¼•ç”¨&amp;&amp;ç±»ä¼¼ä¸€ç§æ ‡è®°,ä¸»è¦ç”¨äºç§»åŠ¨æ„é€ å’Œèµ‹å€¼èŠ‚çœæ‹·è´æ“ä½œ,å¦åˆ™æ‹·è´æ„é€ å’Œèµ‹å€¼ä¼šå°†å‡½æ•°è¿”å›å€¼å…ˆæ‹·è´åˆ°ä¸´æ—¶å€¼,ä¸´æ—¶å€¼å†æ‹·è´åˆ°åˆ°å‡½æ•°æ¥æ”¶å€¼ä¸Šé€ æˆæµªè´¹(ç¼–è¯‘å™¨ä¸ä¼˜åŒ–çš„æƒ…å†µä¸‹).</p><p>std::moveå°±æ˜¯ä¸€ç§æ–¹ä¾¿æ“ä½œå°†å·¦å³å€¼éƒ½è½¬ä¸ºå³å€¼å¼•ç”¨.</p><p>std::forwardè¿›è¡Œå®Œç¾è½¬å‘,ä¹Ÿå°±æ˜¯å°†å·¦å€¼å¾—åˆ°å·¦å€¼,å³å€¼ä¾ç„¶æ˜¯å³å€¼.</p></blockquote><p>tips:</p><ul><li><strong>å³å€¼å¼•ç”¨ç±»å‹åªæ˜¯ç”¨äºåŒ¹é…å³å€¼ï¼Œè€Œå¹¶éè¡¨ç¤ºä¸€ä¸ªå³å€¼ã€‚å› æ­¤ï¼Œå°½é‡ä¸è¦å£°æ˜å³å€¼å¼•ç”¨ç±»å‹çš„å˜é‡ï¼Œè€Œåªåœ¨å‡½æ•°å½¢å‚ä½¿ç”¨å®ƒä»¥åŒ¹é…å³å€¼</strong></li><li>å®å‚ä¼ é€’ç»™å½¢å‚ï¼Œå³å½¢å‚ä¼šæ ¹æ®å®å‚æ¥æ„é€ ã€‚å…¶ç»“æœæ˜¯è°ƒç”¨äº†ç§»åŠ¨æ„é€ å‡½æ•°ï¼›å‡½æ•°ç»“æŸæ—¶åˆ™é‡Šæ”¾å½¢å‚ã€‚</li></ul><p><strong>æ‹·è´æ„é€ ä¸ç§»åŠ¨æ„é€ </strong></p><p>æ‹·è´æ„é€ å‡½æ•°ï¼Œåˆç§°å¤åˆ¶æ„é€ å‡½æ•°ï¼Œæ˜¯ä¸€ç§ç‰¹æ®Šçš„æ„é€ å‡½æ•°ï¼Œå®ƒç”±ç¼–è¯‘å™¨è°ƒç”¨æ¥å®Œæˆä¸€äº›åŸºäºåŒä¸€ç±»çš„å…¶ä»–å¯¹è±¡çš„æ„å»ºåŠåˆå§‹åŒ–ã€‚å…¶å½¢å‚å¿…é¡»æ˜¯å¼•ç”¨ï¼Œä½†å¹¶ä¸é™åˆ¶ä¸ºconstï¼Œä¸€èˆ¬æ™®éçš„ä¼šåŠ ä¸Šconsté™åˆ¶.</p><p>æ­¤å‡½æ•°ç»å¸¸ç”¨åœ¨<strong>å‡½æ•°è°ƒç”¨æ—¶ç”¨æˆ·å®šä¹‰ç±»å‹çš„å€¼ä¼ é€’åŠè¿”å›</strong>ã€‚æ‹·è´æ„é€ å‡½æ•°è¦è°ƒç”¨åŸºç±»çš„æ‹·è´æ„é€ å‡½æ•°å’Œæˆå‘˜å‡½æ•°ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CExample</span>(<span class="keyword">const</span> CExample &amp; c)</span><br><span class="line">  &#123;</span><br><span class="line">      a=c.a;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;copy constructor is called\n&quot;</span>);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>ç§»åŠ¨æ„é€ ï¼ˆMove Constructorï¼‰æ˜¯ä¸€ç§ç‰¹æ®Šçš„æ„é€ å‡½æ•°ï¼Œå®ƒé€šè¿‡<strong>æ¥æ”¶ä¸€ä¸ªå³å€¼å¼•ç”¨å‚æ•°æ¥åˆ›å»ºæ–°å¯¹è±¡ï¼Œå¹¶ä»ä¼ å…¥çš„å¯¹è±¡ä¸­â€œç§»åŠ¨â€èµ„æºè€Œä¸æ˜¯æ‰§è¡Œæ·±æ‹·è´</strong>ã€‚</p><p>ç§»åŠ¨æ„é€ çš„ä½¿ç”¨åœºæ™¯ï¼š</p><ul><li><p>åœ¨å‡½æ•°ä¸­è¿”å›ä¸´æ—¶å¯¹è±¡æ—¶ï¼Œå¯ä»¥é€šè¿‡ç§»åŠ¨æ„é€ å‡½æ•°é¿å…ä¸å¿…è¦çš„æ‹·è´æ“ä½œã€‚</p></li><li><p>åœ¨å®¹å™¨ä¸­æ’å…¥ä¸´æ—¶å¯¹è±¡æ—¶ï¼Œå¯ä»¥é€šè¿‡ç§»åŠ¨æ„é€ å‡½æ•°å®ç°é«˜æ•ˆæ’å…¥å’Œåˆ é™¤æ“ä½œã€‚</p></li><li><p>åœ¨è¿›è¡Œèµ„æºç®¡ç†æ—¶ï¼Œé€šè¿‡ç§»åŠ¨æ„é€ å‡½æ•°å¯ä»¥ä»ä¸€ä¸ªå¯¹è±¡è½¬ç§»èµ„æºæ‰€æœ‰æƒï¼Œæé«˜æ€§èƒ½</p></li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClass</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// ç§»åŠ¨æ„é€ å‡½æ•°</span></span><br><span class="line">    <span class="built_in">MyClass</span>(MyClass&amp;&amp; other) &#123;</span><br><span class="line">        <span class="comment">// èµ„æºçš„è½¬ç§»æˆ–äº¤æ¢æ“ä½œ</span></span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>å®ç°çš„ æ‹·è´æ„é€  çš„å‚æ•°æ˜¯<strong>const ç±»å‹</strong>ï¼Œæ‰€ä»¥<strong>æ—¢å¯ä»¥è¿›è¡Œå·¦å€¼å¼•ç”¨ä¹Ÿå¯ä»¥è¿›è¡Œå³å€¼å¼•ç”¨</strong> <strong>å½“å­˜åœ¨ç§»åŠ¨æ„é€ æ—¶ï¼Œä¼ å…¥å³å€¼ä¼˜å…ˆè°ƒç”¨ç§»åŠ¨æ„é€ </strong>ï¼Œå¦åˆ™æ„é€ æ­¤æ—¶çš„æ‹·è´æ„é€ ã€‚</p><p><strong>æ‹·è´èµ‹å€¼ä¸ç§»åŠ¨èµ‹å€¼</strong></p><p><strong>èµ‹å€¼æ“ä½œç¬¦åˆ™æ˜¯å¤„ç†ä¸€ä¸ªå·²ç»å­˜åœ¨çš„å¯¹è±¡ã€‚å¯¹ä¸€ä¸ªå¯¹è±¡èµ‹å€¼ï¼Œå½“å®ƒä¸€æ¬¡å‡ºç°æ—¶ï¼Œå®ƒå°†è°ƒç”¨å¤åˆ¶æ„é€ å‡½æ•°ï¼Œä»¥åæ¯æ¬¡å‡ºç°ï¼Œéƒ½è°ƒç”¨èµ‹å€¼æ“ä½œç¬¦</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">string&amp; <span class="keyword">operator</span>=(<span class="keyword">const</span> string &amp;s);</span><br></pre></td></tr></table></figure><p>ç§»åŠ¨èµ‹å€¼ï¼ˆMove Assignmentï¼‰æ˜¯ä¸€ç§åœ¨ç¼–ç¨‹è¯­è¨€ä¸­ç”¨äº<strong>å°†ä¸€ä¸ªå¯¹è±¡çš„èµ„æºï¼ˆå¦‚å†…å­˜ç©ºé—´ï¼‰è½¬ç§»åˆ°å¦ä¸€ä¸ªå¯¹è±¡</strong>çš„æ“ä½œ</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç§»åŠ¨èµ‹å€¼</span></span><br><span class="line">string&amp; <span class="keyword">operator</span>=(string&amp;&amp; s)</span><br><span class="line">&#123;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;string&amp; operator=(string&amp;&amp; s) &lt;---&gt; ç§»åŠ¨èµ‹å€¼(èµ„æºç§»åŠ¨)&quot;</span> &lt;&lt; endl;</span><br><span class="line"><span class="built_in">swap</span>(s);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ç§»åŠ¨è¯­ä¹‰"><a href="#ç§»åŠ¨è¯­ä¹‰" class="headerlink" title="ç§»åŠ¨è¯­ä¹‰"></a>ç§»åŠ¨è¯­ä¹‰</h4><p>ä¼ ç»Ÿ C++ é€šè¿‡æ‹·è´æ„é€ å‡½æ•°å’Œèµ‹å€¼æ“ä½œç¬¦ä¸ºç±»å¯¹è±¡è®¾è®¡äº†æ‹·è´/å¤åˆ¶çš„æ¦‚å¿µï¼Œä½†ä¸ºäº†å®ç°å¯¹èµ„æºçš„ç§»åŠ¨æ“ä½œï¼Œ è°ƒç”¨è€…å¿…é¡»ä½¿ç”¨å…ˆå¤åˆ¶ã€å†ææ„çš„æ–¹å¼ï¼Œå¦åˆ™å°±éœ€è¦è‡ªå·±å®ç°ç§»åŠ¨å¯¹è±¡çš„æ¥å£ã€‚ è¯•æƒ³ï¼Œæ¬å®¶çš„æ—¶å€™æ˜¯æŠŠå®¶é‡Œçš„ä¸œè¥¿ç›´æ¥æ¬åˆ°æ–°å®¶å»ï¼Œè€Œä¸æ˜¯å°†æ‰€æœ‰ä¸œè¥¿å¤åˆ¶ä¸€ä»½ï¼ˆé‡ä¹°ï¼‰å†æ”¾åˆ°æ–°å®¶ã€ å†æŠŠåŸæ¥çš„ä¸œè¥¿å…¨éƒ¨æ‰”æ‰ï¼ˆé”€æ¯ï¼‰ï¼Œè¿™æ˜¯éå¸¸åäººç±»çš„ä¸€ä»¶äº‹æƒ…ã€‚</p><p>ä¼ ç»Ÿçš„ C++ æ²¡æœ‰åŒºåˆ†ã€ç§»åŠ¨ã€å’Œã€æ‹·è´ã€çš„æ¦‚å¿µï¼Œé€ æˆäº†å¤§é‡çš„æ•°æ®æ‹·è´ï¼Œæµªè´¹æ—¶é—´å’Œç©ºé—´ã€‚ å³å€¼å¼•ç”¨çš„å‡ºç°æ°å¥½å°±è§£å†³äº†è¿™ä¸¤ä¸ªæ¦‚å¿µçš„æ··æ·†é—®é¢˜ï¼Œ</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">int</span> *pointer;</span><br><span class="line">    <span class="built_in">A</span>():<span class="built_in">pointer</span>(<span class="keyword">new</span> <span class="built_in"><span class="keyword">int</span></span>(<span class="number">1</span>)) &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;æ„é€ &quot;</span> &lt;&lt; pointer &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">A</span>(A&amp; a):<span class="built_in">pointer</span>(<span class="keyword">new</span> <span class="built_in"><span class="keyword">int</span></span>(*a.pointer)) &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;æ‹·è´&quot;</span> &lt;&lt; pointer &lt;&lt; std::endl;</span><br><span class="line">    &#125; <span class="comment">// æ— æ„ä¹‰çš„å¯¹è±¡æ‹·è´</span></span><br><span class="line">    <span class="built_in">A</span>(A&amp;&amp; a):<span class="built_in">pointer</span>(a.pointer) &#123;</span><br><span class="line">        a.pointer = <span class="literal">nullptr</span>;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;ç§»åŠ¨&quot;</span> &lt;&lt; pointer &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    ~<span class="built_in">A</span>()&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;ææ„&quot;</span> &lt;&lt; pointer &lt;&lt; std::endl;</span><br><span class="line">        <span class="keyword">delete</span> pointer;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// é˜²æ­¢ç¼–è¯‘å™¨ä¼˜åŒ–</span></span><br><span class="line"><span class="function">A <span class="title">return_rvalue</span><span class="params">(<span class="keyword">bool</span> test)</span> </span>&#123;</span><br><span class="line">    A a,b;</span><br><span class="line">    <span class="keyword">if</span>(test) <span class="keyword">return</span> a; <span class="comment">// ç­‰ä»·äº static_cast&lt;A&amp;&amp;&gt;(a);</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> b;     <span class="comment">// ç­‰ä»·äº static_cast&lt;A&amp;&amp;&gt;(b);</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    A obj = <span class="built_in">return_rvalue</span>(<span class="literal">false</span>);</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;obj:&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    std::cout &lt;&lt; obj.pointer &lt;&lt; std::endl;</span><br><span class="line">    std::cout &lt;&lt; *obj.pointer &lt;&lt; std::endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å®Œç¾è½¬å‘"><a href="#å®Œç¾è½¬å‘" class="headerlink" title="å®Œç¾è½¬å‘"></a>å®Œç¾è½¬å‘</h4><p>å½“æˆ‘ä»¬ä½¿ç”¨äº†ä¸‡èƒ½å¼•ç”¨æ—¶ï¼Œå³ä½¿å¯ä»¥åŒæ—¶åŒ¹é…å·¦å€¼ã€å³å€¼ï¼Œä½†éœ€è¦è½¬å‘å‚æ•°ç»™å…¶ä»–å‡½æ•°æ—¶ï¼Œä¼šä¸¢å¤±å¼•ç”¨æ€§è´¨ï¼ˆå½¢å‚æ˜¯ä¸ªå·¦å€¼ï¼Œä»è€Œæ— æ³•åˆ¤æ–­åˆ°åº•åŒ¹é…çš„æ˜¯ä¸ªå·¦å€¼è¿˜æ˜¯å³å€¼ï¼‰.ä¸€ä¸ªå£°æ˜çš„å³å€¼å¼•ç”¨å…¶å®æ˜¯ä¸€ä¸ªå·¦å€¼ã€‚è¿™å°±ä¸ºæˆ‘ä»¬è¿›è¡Œå‚æ•°è½¬å‘ï¼ˆä¼ é€’ï¼‰é€ æˆäº†é—®é¢˜</p><p>å®Œç¾è½¬å‘å‡½æ•° <strong>std:forward<T></strong> ã€‚å®ƒå¯ä»¥åœ¨æ¨¡æ¿å‡½æ•°å†…ç»™å¦ä¸€ä¸ªå‡½æ•°ä¼ é€’å‚æ•°æ—¶ï¼Œå°†å‚æ•°ç±»å‹ä¿æŒåŸæœ¬çŠ¶æ€ä¼ å…¥ï¼ˆå¦‚æœå½¢å‚æ¨å¯¼å‡ºæ˜¯å³å€¼å¼•ç”¨åˆ™ä½œä¸ºå³å€¼ä¼ å…¥ï¼Œå¦‚æœæ˜¯å·¦å€¼å¼•ç”¨åˆ™ä½œä¸ºå·¦å€¼ä¼ å…¥ï¼‰</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">reference</span><span class="params">(<span class="keyword">int</span>&amp; v)</span> </span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;å·¦å€¼&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">reference</span><span class="params">(<span class="keyword">int</span>&amp;&amp; v)</span> </span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;å³å€¼&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">pass</span><span class="params">(T&amp;&amp; v)</span> </span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;æ™®é€šä¼ å‚:&quot;</span>;</span><br><span class="line">    <span class="built_in">reference</span>(v); <span class="comment">// å§‹ç»ˆè°ƒç”¨ reference(int&amp;)</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;ä¼ é€’å³å€¼:&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    <span class="built_in">pass</span>(<span class="number">1</span>); <span class="comment">// 1æ˜¯å³å€¼, ä½†è¾“å‡ºæ˜¯å·¦å€¼</span></span><br><span class="line"></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;ä¼ é€’å·¦å€¼:&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    <span class="keyword">int</span> l = <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">pass</span>(l); <span class="comment">// l æ˜¯å·¦å€¼, è¾“å‡ºå·¦å€¼</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯¹äº <code>pass(1)</code> æ¥è¯´ï¼Œè™½ç„¶ä¼ é€’çš„æ˜¯å³å€¼ï¼Œä½†ç”±äº <code>v</code> æ˜¯ä¸€ä¸ªå¼•ç”¨ï¼Œæ‰€ä»¥åŒæ—¶ä¹Ÿæ˜¯å·¦å€¼ã€‚ å› æ­¤ <code>reference(v)</code> ä¼šè°ƒç”¨ <code>reference(int&amp;)</code>ï¼Œè¾“å‡ºã€å·¦å€¼ã€ã€‚ è€Œå¯¹äº<code>pass(l)</code>è€Œè¨€ï¼Œ<code>l</code>æ˜¯ä¸€ä¸ªå·¦å€¼ï¼Œä¸ºä»€ä¹ˆä¼šæˆåŠŸä¼ é€’ç»™ <code>pass(T&amp;&amp;)</code> å‘¢ï¼Ÿ</p><p>è¿™æ˜¯åŸºäº<strong>å¼•ç”¨åç¼©è§„åˆ™</strong>çš„ï¼šåœ¨ä¼ ç»Ÿ C++ ä¸­ï¼Œæˆ‘ä»¬ä¸èƒ½å¤Ÿå¯¹ä¸€ä¸ªå¼•ç”¨ç±»å‹ç»§ç»­è¿›è¡Œå¼•ç”¨ï¼Œ ä½† C++ ç”±äºå³å€¼å¼•ç”¨çš„å‡ºç°è€Œæ”¾å®½äº†è¿™ä¸€åšæ³•ï¼Œä»è€Œäº§ç”Ÿäº†å¼•ç”¨åç¼©è§„åˆ™ï¼Œå…è®¸æˆ‘ä»¬å¯¹å¼•ç”¨è¿›è¡Œå¼•ç”¨ï¼Œ æ—¢èƒ½å·¦å¼•ç”¨ï¼Œåˆèƒ½å³å¼•ç”¨ã€‚ä½†æ˜¯å´éµå¾ªå¦‚ä¸‹è§„åˆ™ï¼š</p><div class="table-container"><table><thead><tr><th style="text-align:left">å‡½æ•°å½¢å‚ç±»å‹</th><th style="text-align:left">å®å‚å‚æ•°ç±»å‹</th><th style="text-align:left">æ¨å¯¼åå‡½æ•°å½¢å‚ç±»å‹</th></tr></thead><tbody><tr><td style="text-align:left">T&amp;</td><td style="text-align:left">å·¦å¼•ç”¨</td><td style="text-align:left">T&amp;</td></tr><tr><td style="text-align:left">T&amp;</td><td style="text-align:left">å³å¼•ç”¨</td><td style="text-align:left">T&amp;</td></tr><tr><td style="text-align:left">T&amp;&amp;</td><td style="text-align:left">å·¦å¼•ç”¨</td><td style="text-align:left">T&amp;</td></tr><tr><td style="text-align:left">T&amp;&amp;</td><td style="text-align:left">å³å¼•ç”¨</td><td style="text-align:left">T&amp;&amp;</td></tr></tbody></table></div><p>å› æ­¤ï¼Œæ¨¡æ¿å‡½æ•°ä¸­ä½¿ç”¨ <code>T&amp;&amp;</code> ä¸ä¸€å®šèƒ½è¿›è¡Œå³å€¼å¼•ç”¨ï¼Œå½“ä¼ å…¥å·¦å€¼æ—¶ï¼Œæ­¤å‡½æ•°çš„å¼•ç”¨å°†è¢«æ¨å¯¼ä¸ºå·¦å€¼ã€‚ æ›´å‡†ç¡®çš„è®²ï¼Œ<strong>æ— è®ºæ¨¡æ¿å‚æ•°æ˜¯ä»€ä¹ˆç±»å‹çš„å¼•ç”¨ï¼Œå½“ä¸”ä»…å½“å®å‚ç±»å‹ä¸ºå³å¼•ç”¨æ—¶ï¼Œæ¨¡æ¿å‚æ•°æ‰èƒ½è¢«æ¨å¯¼ä¸ºå³å¼•ç”¨ç±»å‹</strong>ã€‚ è¿™æ‰ä½¿å¾— <code>v</code> ä½œä¸ºå·¦å€¼çš„æˆåŠŸä¼ é€’ã€‚</p><p>è°“å®Œç¾è½¬å‘ï¼Œå°±æ˜¯ä¸ºäº†è®©æˆ‘ä»¬åœ¨ä¼ é€’å‚æ•°çš„æ—¶å€™ï¼Œ ä¿æŒåŸæ¥çš„å‚æ•°ç±»å‹ï¼ˆå·¦å¼•ç”¨ä¿æŒå·¦å¼•ç”¨ï¼Œå³å¼•ç”¨ä¿æŒå³å¼•ç”¨ï¼‰ã€‚ ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬åº”è¯¥ä½¿ç”¨ <code>std::forward</code> æ¥è¿›è¡Œå‚æ•°çš„è½¬å‘ï¼ˆä¼ é€’ï¼‰ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;utility&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">reference</span><span class="params">(<span class="keyword">int</span>&amp; v)</span> </span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;å·¦å€¼å¼•ç”¨&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">reference</span><span class="params">(<span class="keyword">int</span>&amp;&amp; v)</span> </span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;å³å€¼å¼•ç”¨&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">pass</span><span class="params">(T&amp;&amp; v)</span> </span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;              æ™®é€šä¼ å‚: &quot;</span>;</span><br><span class="line">    <span class="built_in">reference</span>(v);</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;       std::move ä¼ å‚: &quot;</span>;</span><br><span class="line">    <span class="built_in">reference</span>(std::<span class="built_in">move</span>(v));</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;    std::forward ä¼ å‚: &quot;</span>;</span><br><span class="line">    <span class="built_in">reference</span>(std::forward&lt;T&gt;(v));</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;static_cast&lt;T&amp;&amp;&gt; ä¼ å‚: &quot;</span>;</span><br><span class="line">    <span class="built_in">reference</span>(<span class="keyword">static_cast</span>&lt;T&amp;&amp;&gt;(v));</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;ä¼ é€’å³å€¼:&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    <span class="built_in">pass</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;ä¼ é€’å·¦å€¼:&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    <span class="keyword">int</span> v = <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">pass</span>(v);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœä¸ºï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">ä¼ é€’å³å€¼:</span><br><span class="line">              æ™®é€šä¼ å‚: å·¦å€¼å¼•ç”¨</span><br><span class="line">       std::move ä¼ å‚: å³å€¼å¼•ç”¨</span><br><span class="line">    std::forward ä¼ å‚: å³å€¼å¼•ç”¨</span><br><span class="line"><span class="keyword">static_cast</span>&lt;T&amp;&amp;&gt; ä¼ å‚: å³å€¼å¼•ç”¨</span><br><span class="line">ä¼ é€’å·¦å€¼:</span><br><span class="line">              æ™®é€šä¼ å‚: å·¦å€¼å¼•ç”¨</span><br><span class="line">       std::move ä¼ å‚: å³å€¼å¼•ç”¨</span><br><span class="line">    std::forward ä¼ å‚: å·¦å€¼å¼•ç”¨</span><br><span class="line"><span class="keyword">static_cast</span>&lt;T&amp;&amp;&gt; ä¼ å‚: å·¦å€¼å¼•ç”¨</span><br></pre></td></tr></table></figure><p>æ— è®ºä¼ é€’å‚æ•°ä¸ºå·¦å€¼è¿˜æ˜¯å³å€¼ï¼Œæ™®é€šä¼ å‚éƒ½ä¼šå°†å‚æ•°ä½œä¸ºå·¦å€¼è¿›è¡Œè½¬å‘ï¼› ç”±äºç±»ä¼¼çš„åŸå› ï¼Œ<code>std::move</code> æ€»ä¼šæ¥å—åˆ°ä¸€ä¸ªå·¦å€¼ï¼Œä»è€Œè½¬å‘è°ƒç”¨äº†<code>reference(int&amp;&amp;)</code> è¾“å‡ºå³å€¼å¼•ç”¨ã€‚</p><p>å”¯ç‹¬ <code>std::forward</code> å³æ²¡æœ‰é€ æˆä»»ä½•å¤šä½™çš„æ‹·è´ï¼ŒåŒæ—¶<strong>å®Œç¾è½¬å‘</strong>(ä¼ é€’)äº†å‡½æ•°çš„å®å‚ç»™äº†å†…éƒ¨è°ƒç”¨çš„å…¶ä»–å‡½æ•°ã€‚</p><p><code>std::forward</code> å’Œ <code>std::move</code> ä¸€æ ·ï¼Œæ²¡æœ‰åšä»»ä½•äº‹æƒ…ï¼Œ<code>std::move</code> å•çº¯çš„å°†å·¦å€¼è½¬åŒ–ä¸ºå³å€¼ï¼Œ <code>std::forward</code> ä¹Ÿåªæ˜¯å•çº¯çš„å°†å‚æ•°åšäº†ä¸€ä¸ªç±»å‹çš„è½¬æ¢ï¼Œä»ç°è±¡ä¸Šæ¥çœ‹ï¼Œ <code>std::forward&lt;T&gt;(v)</code> å’Œ <code>static_cast&lt;T&amp;&amp;&gt;(v)</code> æ˜¯å®Œå…¨ä¸€æ ·çš„ã€‚</p><p><strong>1. æˆ‘ä»¬åº”è¯¥é¦–å…ˆæŠŠç¼–å†™å³å€¼å¼•ç”¨ç±»å‹ç›¸å…³çš„ä»»åŠ¡é‡ç‚¹æ”¾åœ¨å¯¹è±¡çš„æ„é€ ã€èµ‹å€¼å‡½æ•°ä¸Šã€‚ä»æºå¤´ä¸Šå‡ºå‘ï¼Œåœ¨ç¼–å†™å…¶å®ƒä»£ç æ—¶ä¼šè‡ªç„¶è€Œç„¶äº«å—åˆ°äº†ç§»åŠ¨æ„é€ ã€ç§»åŠ¨èµ‹å€¼çš„ä¼˜åŒ–æ•ˆæœã€‚</strong></p><p><strong>2. å½¢å‚ï¼šä»ä¼˜åŒ–çš„è§’åº¦ä¸Šçœ‹ï¼Œè‹¥å‚æ•°æœ‰æ”¯æŒç§»åŠ¨æ„é€ ï¼ˆæˆ–ç§»åŠ¨èµ‹å€¼ï¼‰çš„ç±»å‹ï¼Œåº”æä¾›å·¦å€¼å¼•ç”¨å’Œå³å€¼å¼•ç”¨çš„é‡è½½ç‰ˆæœ¬ã€‚ç§»åŠ¨å¼€é”€å¾ˆä½æ—¶ï¼Œåªæä¾›ä¸€ä¸ªéå¼•ç”¨ç±»å‹çš„ç‰ˆæœ¬ä¹Ÿæ˜¯å¯ä»¥æ¥å—çš„ã€‚</strong></p><p><strong>3. è¿”è¿˜å€¼ï¼šä¸è¦ä¸”æ²¡å¿…è¦ç¼–å†™è¿”è¿˜å³å€¼å¼•ç”¨ç±»å‹çš„å‡½æ•°ï¼Œé™¤éæœ‰ç‰¹æ®Šç”¨é€”ã€‚</strong></p><h2 id="å¯èƒ½é‡åˆ°çš„æŠ¥é”™"><a href="#å¯èƒ½é‡åˆ°çš„æŠ¥é”™" class="headerlink" title="å¯èƒ½é‡åˆ°çš„æŠ¥é”™"></a>å¯èƒ½é‡åˆ°çš„æŠ¥é”™</h2><ol><li>éå¸¸é‡å¼•ç”¨çš„åˆå§‹å€¼å¿…é¡»ä¸ºå·¦å€¼</li></ol><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> x = <span class="number">10</span>;</span><br><span class="line"><span class="keyword">int</span>&amp; ref = x; <span class="comment">// x æ˜¯ä¸€ä¸ªå·¦å€¼è¡¨è¾¾å¼</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> y = <span class="number">20</span>;</span><br><span class="line"><span class="keyword">int</span> z = y + <span class="number">5</span>; <span class="comment">// y + 5 æ˜¯ä¸€ä¸ªå³å€¼è¡¨è¾¾å¼</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> x = <span class="number">10</span>;</span><br><span class="line"><span class="keyword">int</span>&amp; ref1 = x;  <span class="comment">// æ­£ç¡®,x æ˜¯ä¸€ä¸ªå·¦å€¼</span></span><br><span class="line"><span class="keyword">int</span> y = <span class="number">20</span>;</span><br><span class="line"><span class="keyword">int</span>&amp; ref2 = y + <span class="number">5</span>; <span class="comment">// é”™è¯¯,y + 5 æ˜¯ä¸€ä¸ªå³å€¼è¡¨è¾¾å¼</span></span><br></pre></td></tr></table></figure><p>è¿™ä¸ªè§„åˆ™çš„ç›®çš„æ˜¯ä¸ºäº†ç¡®ä¿å¼•ç”¨å˜é‡åœ¨åˆå§‹åŒ–åèƒ½å¤Ÿç»§ç»­æŒ‡å‘ä¸€ä¸ªå¯ä¿®æ”¹çš„å¯¹è±¡ã€‚å¦‚æœå…è®¸å¼•ç”¨ç»‘å®šåˆ°ä¸€ä¸ªä¸´æ—¶çš„å³å€¼è¡¨è¾¾å¼,é‚£ä¹ˆå½“è¿™ä¸ªä¸´æ—¶å¯¹è±¡è¢«é”€æ¯å,å¼•ç”¨å°±ä¼šæ‚¬ç©º(dangle),è¿™ä¼šå¯¼è‡´ç¨‹åºå‡ºç°é”™è¯¯</p><h3 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h3><ol><li><a href="https://changkun.de/modern-cpp/zh-cn/01-intro/">ç¬¬ 1 ç«  è¿ˆå‘ç°ä»£ C++ ç°ä»£ C++ æ•™ç¨‹: é«˜é€Ÿä¸Šæ‰‹ C++ 11/14/17/20 - Modern C++ Tutorial: C++ 11/14/17/20 On the Fly (changkun.de)</a></li><li><a href="https://www.cnblogs.com/KillerAery/p/12802771.html">é€å½»ç†è§£C++11 ç§»åŠ¨è¯­ä¹‰ï¼šå³å€¼ã€å³å€¼å¼•ç”¨ã€std::moveã€std::forward - KillerAery - åšå®¢å›­ (cnblogs.com)</a></li></ol><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;p&gt;cpp,å¤è€åˆä¼ ç»Ÿçš„è¯­è¨€,ä½†å®ƒä¾ç„¶æ˜¯è®¸å¤šè¯­è¨€å¸Œæœ›æ›¿ä»£æˆ˜èƒœçš„.è¿™é‡Œä»‹ç»ä¸€äº›æ–°ç‰¹æ€§.&lt;br&gt;</summary>
    
    
    
    
    <category term="cpp" scheme="https://www.sekyoro.top/tags/cpp/"/>
    
  </entry>
  
  <entry>
    <title>æ·±åº¦å­¦ä¹ å¯è§£é‡Šæ€§åˆ†æ</title>
    <link href="https://www.sekyoro.top/2024/05/29/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E5%8F%AF%E8%A7%A3%E9%87%8A%E6%80%A7%E5%88%86%E6%9E%90/"/>
    <id>https://www.sekyoro.top/2024/05/29/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E5%8F%AF%E8%A7%A3%E9%87%8A%E6%80%A7%E5%88%86%E6%9E%90/</id>
    <published>2024-05-29T07:37:15.000Z</published>
    <updated>2024-05-31T09:37:20.532Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>è¿™ç§åˆ†æè²Œä¼¼åœ¨å¤§æ¨¡å‹æ—¶ä»£æ²¡æœ‰ä½¿ç”¨é‚£ä¹ˆå¤šäº†,æ‰€ä»¥è¿™é‡Œå¤§æ¦‚äº†è§£ä¸€ä¸‹.<br><span id="more"></span></p><p>ä¸»è¦äº†è§£CAM,Grad-CAMå¯è§†åŒ–æ–¹æ³•ä»¥åŠSillancy mapçš„æ¦‚å¿µ</p><h3 id="Learning-Deep-Features-for-Discriminative-Localization"><a href="#Learning-Deep-Features-for-Discriminative-Localization" class="headerlink" title="Learning Deep Features for Discriminative Localization"></a>Learning Deep Features for Discriminative Localization</h3><p><img data-src="https://s2.loli.net/2024/05/31/yOYfGdwV7c8JhmW.png" alt="image-20240531153653129" style="zoom:50%;" /></p><p>å¯¹äºç»™å®šçš„å›¾åƒ,ä»¤f~k~( x , y)è¡¨ç¤ºç©ºé—´ä½ç½®( x , y)å¤„æœ€åä¸€ä¸ªå·ç§¯å±‚ä¸­å•å…ƒkçš„æ¿€æ´»å€¼.ç„¶å,å¯¹äºå•å…ƒk,æ‰§è¡Œå…¨å±€å¹³å‡æ± åŒ–çš„ç»“æœF^k^ä¸ºâˆ‘~x,y~ f~k~( x ,y).å› æ­¤,å¯¹äºç»™å®šçš„ç±»c,softmaxçš„è¾“å…¥S~c~=âˆ‘~k~ w^c^ ~k~F~k~,å…¶ä¸­w^c^~k~æ˜¯å•ä½kå¯¹åº”äºç±»cçš„æƒé‡.æœ¬è´¨ä¸Š,w^c^~k~è¡¨ç¤ºF~k~å¯¹cç±»çš„é‡è¦æ€§.</p><p>æœ€åé€šè¿‡exp(S~c~ )/âˆ‘~c~ exp(S~c~ )ç»™å‡ºç±»c,P~c~çš„softmaxçš„è¾“å‡º.</p><p><img data-src="https://s2.loli.net/2024/05/31/1yp7RFxnXhuAbaN.png" alt="image-20240531154551531"></p><p>é€šè¿‡å°†F~k~ =âˆ‘~x,y~f~k~( x,y)æ’å…¥ç±»å¾—åˆ†S~c~,å¾—åˆ°</p><script type="math/tex; mode=display">\begin{aligned}S_{c}& =\sum_kw_k^c\sum_{x,y}f_k(x,y)  \\&=\sum_{x,y}\sum_{k}w_{k}^{c}f_{k}(x,y).\end{aligned}</script><p>å°†M~c~å®šä¹‰ä¸ºcç±»çš„ç±»æ¿€æ´»æ˜ å°„,å…¶ä¸­æ¯ä¸ªç©ºé—´å…ƒç´ ç”±S~c~ =âˆ‘~x,y~M~c~( x ,y),å› æ­¤M~c~( x , y)ç›´æ¥è¡¨æ˜ç©ºé—´ç½‘æ ¼( x , y)ä¸Šçš„æ¿€æ´»å¯¼è‡´å›¾åƒåˆ†ç±»åˆ°cç±»çš„é‡è¦æ€§.</p><p>æ‰€ä»¥è¿™é‡Œçš„class activation mapæ˜¯æ ¹æ®å·ç§¯å±‚ç‰¹å¾æ¥çš„,æƒé‡å€¼è®¡ç®—ä¾èµ–äºglobal pooling.</p><h3 id="Grad-CAM-Visual-Explanations-from-Deep-Networks-via-Gradient-based-Localization"><a href="#Grad-CAM-Visual-Explanations-from-Deep-Networks-via-Gradient-based-Localization" class="headerlink" title="Grad-CAM: Visual Explanations from Deep Networks via Gradient-based Localization"></a>Grad-CAM: Visual Explanations from Deep Networks via Gradient-based Localization</h3><blockquote><p>CAMå¯¹äºç½‘ç»œç»“æ„æœ‰è¦æ±‚ï¼Œä¸é‡‡ç”¨GAPæ–¹æ³•ä¸èƒ½ä½¿ç”¨ï¼›ä¸”åªèƒ½å¯è§†åŒ–æœ€åä¸€å±‚çš„å·ç§¯</p></blockquote><p>æå‡ºäº†ä¸€ç§ä»åŸºäºå·ç§¯ç¥ç»ç½‘ç»œ( Convolutional Neural Networkï¼ŒCNN )çš„ä¸€å¤§ç±»æ¨¡å‹ä¸­ä¸ºå†³ç­–äº§ç”Ÿâ€è§†è§‰è§£é‡Šâ€çš„æŠ€æœ¯,ä½¿å…¶æ›´åŠ é€æ˜å’Œå¯è§£é‡Š.</p><p>æˆ‘ä»¬çš„æ–¹æ³•- -æ¢¯åº¦åŠ æƒç±»æ¿€æ´»æ˜ å°„( Gradient-weighted Class Activation Mappingï¼ŒGrad-CAM )ï¼Œåˆ©ç”¨ä»»æ„ç›®æ ‡æ¦‚å¿µ(åœ¨åˆ†ç±»ç½‘ç»œä¸­è¯´â€™ç‹—â€™ ,æˆ–è€…åœ¨æè¿°ç½‘ç»œä¸­è¯´è¯åºåˆ—)æµå…¥æœ€ç»ˆå·ç§¯å±‚çš„æ¢¯åº¦ï¼Œäº§ç”Ÿä¸€ä¸ªç²—ç•¥çš„å®šä½å›¾ï¼Œçªå‡ºå›¾åƒä¸­çš„é‡è¦åŒºåŸŸï¼Œç”¨äºé¢„æµ‹æ¦‚å¿µ</p><p>ä¸ä»¥å‰çš„æ–¹æ³•ä¸åŒï¼ŒGrad - CAMé€‚ç”¨äºå„ç§å„æ ·çš„CNNæ¨¡å‹å®¶æ—ï¼š( 1 )å…·æœ‰å…¨è¿æ¥å±‚çš„CNN (ä¾‹å¦‚. VGG ),( 2 )ç”¨äºç»“æ„åŒ–è¾“å‡ºçš„CNNs (å¦‚å­—å¹•),( 3 )ç”¨äºå…·æœ‰å¤šæ¨¡æ€è¾“å…¥(ä¾‹å¦‚,è§†è§‰é—®ç­”)æˆ–å¼ºåŒ–å­¦ä¹ çš„ä»»åŠ¡çš„CNNsï¼Œéƒ½æ²¡æœ‰æ¶æ„å˜åŒ–æˆ–é‡æ–°è®­ç»ƒ.</p><p><img data-src="https://s2.loli.net/2024/05/31/btfxHFEojOwuhAy.png" alt="image-20240531162540520"></p><script type="math/tex; mode=display">\alpha_k^c=\overbrace{\frac1Z\sum_i\sum_j}^{\text{global average pooling}}\underbrace{\frac{\partial y^c}{\partial A_{ij}^k}}_{\text{gradients via backprop}}</script><script type="math/tex; mode=display">L_{\text{Grad-CAM}}^c=ReLU\underbrace{\left(\sum\alpha_k^cA^k\right)}_{\text{linear combination}}</script><p>å…¶ä¸­A^k^æ˜¯ç‰¹å¾å›¾çš„å€¼,æƒé‡ç”±è‡ªå·±å®šå˜æˆäº†æ¢¯åº¦.</p><p><img data-src="https://s2.loli.net/2024/05/31/rjbTCeuOVwna2h9.png" alt="image-20240531162743950"></p><p>ä¸ºäº†å¾—åˆ°å¯¹ä»»æ„ç±»cçš„å®½uå’Œé«˜vçš„ç±»åˆ¤åˆ«å±€éƒ¨åŒ–æ˜ å°„Grad - CAM Lc Grad-CAMâˆˆR^uÃ—v^ï¼Œæˆ‘ä»¬é¦–å…ˆè®¡ç®—ç±»cçš„å¾—åˆ†y~c~ (åœ¨softmaxä¹‹å‰)å…³äºå·ç§¯å±‚çš„ç‰¹å¾å›¾æ¿€æ´»A~k~çš„æ¢¯åº¦ï¼Œå³âˆ‘y~c~âˆ‘A~k~ã€‚</p><h3 id="Grad-CAM-Generalized-Gradient-based-Visual-Explanations-for-Deep-Convolutional-Networks"><a href="#Grad-CAM-Generalized-Gradient-based-Visual-Explanations-for-Deep-Convolutional-Networks" class="headerlink" title="Grad-CAM++: Generalized Gradient-based Visual Explanations for Deep Convolutional Networks"></a>Grad-CAM++: Generalized Gradient-based Visual Explanations for Deep Convolutional Networks</h3><p>æœ¬æ–‡çš„å·¥ä½œä¸»è¦å—åˆ°ä¸¤ç§ç®—æ³•çš„å¯å‘ï¼Œå³CAMå’ŒGrad - CAM,è¿™ä¸¤ç§ç®—æ³•åœ¨å½“ä»Šè¢«å¹¿æ³›ä½¿ç”¨.</p><p>CAMå’ŒGrad - CAMéƒ½åŸºäºä¸€ä¸ªåŸºæœ¬å‡è®¾,å³<strong>å¯¹äºç‰¹å®šç±»åˆ«cçš„æœ€ç»ˆå¾—åˆ†Y~c~å¯ä»¥å†™æˆå…¶å…¨å±€å¹³å‡æ± åŒ–æœ€åä¸€ä¸ªå·ç§¯å±‚ç‰¹å¾å›¾A~k~çš„çº¿æ€§ç»„åˆ</strong></p><p><img data-src="https://s2.loli.net/2024/05/31/yXqhk83Tb4KQIsR.png" alt="image-20240531170624521"></p><script type="math/tex; mode=display">Y^c=\sum_kw_k^c.\sum_i\sum_jA_{ij}^k</script><p>åœ¨Grad - CAMå’ŒCAMä¸­åŸºäºæ¢¯åº¦çš„å¯è§†åŒ–æŠ€æœ¯çš„åŸºç¡€ä¸Šæå‡ºäº†ä¸€ç§å¹¿ä¹‰çš„æ–¹æ³•ï¼Œç§°ä¸ºGrad - CAM + +ï¼Œå®ƒæ˜¯é€šè¿‡æ˜¾å¼åœ°å»ºæ¨¡CNNç‰¹å¾å›¾ä¸­æ¯ä¸ªåƒç´ å¯¹æœ€ç»ˆè¾“å‡ºçš„è´¡çŒ®æ¥åˆ¶å®šçš„ã€‚</p><script type="math/tex; mode=display">w_k^c=\sum_i\sum_j\alpha_{ij}^{kc}.relu(\frac{\partial Y^c}{\partial A_{ij}^k})</script><p><img data-src="https://s2.loli.net/2024/05/31/HQbnsrTIEe8o7Gd.png" alt="image-20240531172032414"></p><script type="math/tex; mode=display">Y^{c}=\sum_{k}[\sum_{i}\sum_{j}\{\sum_{a}\sum_{b}\alpha_{ab}^{kc}.relu(\frac{\partial Y^{c}}{\partial A_{ab}^{k}})\}A_{ij}^{k}]</script><h3 id="Smooth-Grad-CAM-An-Enhanced-Inference-Level-Visualization-Technique-for-Deep-Convolutional-Neural-Network-Models"><a href="#Smooth-Grad-CAM-An-Enhanced-Inference-Level-Visualization-Technique-for-Deep-Convolutional-Neural-Network-Models" class="headerlink" title="Smooth Grad-CAM++: An Enhanced Inference Level Visualization Technique for Deep Convolutional Neural Network Models"></a>Smooth Grad-CAM++: An Enhanced Inference Level Visualization Technique for Deep Convolutional Neural Network Models</h3><p>åŠ å…¥å™ªå£°</p><script type="math/tex; mode=display">M_c(I)=\frac1n\sum_1^nM_c(I+\mathcal{N}(0,\sigma^2))</script><script type="math/tex; mode=display">M_c(x,y)=\sum_kw_c^kf^k(x,y)=\sum_kw_c^k\cdot\frac1n\sum_1^n(f_{x,y|I+\mathcal{N}(0,\sigma^2)}^k)</script><blockquote><p>ç”±äºæ·»åŠ äº†å™ªå£°ï¼Œæ‰€ä»¥æ›´èƒ½å¤Ÿçªå‡ºç‰¹å¾å›¾åœ¨å™ªå£°ä¸­robustçš„éƒ¨åˆ†ï¼Œè¿™éƒ¨åˆ†è¢«è®¤ä¸ºæ›´é‡è¦ï¼›æ­¤æ–¹æ³•å¯ä»¥ç”¨æ¥æ¯”è¾ƒå›¾ç‰‡ä¸åŒä½ç½®å¯¹ç¥ç»å…ƒçš„æ¿€æ´»å¼ºåº¦ï¼Œæ‰€ä»¥å¯ä»¥è¿›è¡Œchoosing neuronsçš„æ“ä½œ</p></blockquote><h3 id="Saliency-map"><a href="#Saliency-map" class="headerlink" title="Saliency map"></a>Saliency map</h3><p>è¡¨ç¤ºæ˜¾è‘—æ€§.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">normalize</span>(<span class="params">image</span>):</span></span><br><span class="line">  <span class="keyword">return</span> (image - image.<span class="built_in">min</span>()) / (image.<span class="built_in">max</span>() - image.<span class="built_in">min</span>())</span><br><span class="line">  <span class="comment"># return torch.log(image)/torch.log(image.max())</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">compute_saliency_maps</span>(<span class="params">x, y, model</span>):</span></span><br><span class="line">  model.<span class="built_in">eval</span>()</span><br><span class="line">  x = x.cuda()</span><br><span class="line"></span><br><span class="line">  <span class="comment"># we want the gradient of the input x</span></span><br><span class="line">  x.requires_grad_()</span><br><span class="line">  </span><br><span class="line">  y_pred = model(x)</span><br><span class="line">  loss_func = torch.nn.CrossEntropyLoss()</span><br><span class="line">  loss = loss_func(y_pred, y.cuda())</span><br><span class="line">  loss.backward()</span><br><span class="line"></span><br><span class="line">  <span class="comment"># saliencies = x.grad.abs().detach().cpu()</span></span><br><span class="line">  saliencies, _ = torch.<span class="built_in">max</span>(x.grad.data.<span class="built_in">abs</span>().detach().cpu(),dim=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment"># We need to normalize each image, because their gradients might vary in scale</span></span><br><span class="line">  saliencies = torch.stack([normalize(item) <span class="keyword">for</span> item <span class="keyword">in</span> saliencies])</span><br><span class="line">  <span class="keyword">return</span> saliencies</span><br><span class="line">  <span class="comment"># images, labels = train_set.getbatch(img_indices)</span></span><br><span class="line">saliencies = compute_saliency_maps(images, labels, model)</span><br><span class="line"></span><br><span class="line"><span class="comment"># visualize</span></span><br><span class="line">fig, axs = plt.subplots(<span class="number">2</span>, <span class="built_in">len</span>(img_indices), figsize=(<span class="number">15</span>, <span class="number">8</span>))</span><br><span class="line"><span class="keyword">for</span> row, target <span class="keyword">in</span> <span class="built_in">enumerate</span>([images, saliencies]):</span><br><span class="line">  <span class="keyword">for</span> column, img <span class="keyword">in</span> <span class="built_in">enumerate</span>(target):</span><br><span class="line">    <span class="keyword">if</span> row==<span class="number">0</span>:</span><br><span class="line">      axs[row][column].imshow(img.permute(<span class="number">1</span>, <span class="number">2</span>, <span class="number">0</span>).numpy())</span><br><span class="line">      <span class="comment"># What is permute?</span></span><br><span class="line">      <span class="comment"># In pytorch, the meaning of each dimension of image tensor is (channels, height, width)</span></span><br><span class="line">      <span class="comment"># In matplotlib, the meaning of each dimension of image tensor is (height, width, channels)</span></span><br><span class="line">      <span class="comment"># permute is a tool for permuting dimensions of tensors</span></span><br><span class="line">      <span class="comment"># For example, img.permute(1, 2, 0) means that,</span></span><br><span class="line">      <span class="comment"># - 0 dimension is the 1 dimension of the original tensor, which is height</span></span><br><span class="line">      <span class="comment"># - 1 dimension is the 2 dimension of the original tensor, which is width</span></span><br><span class="line">      <span class="comment"># - 2 dimension is the 0 dimension of the original tensor, which is channels</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">      axs[row][column].imshow(img.numpy(), cmap=plt.cm.hot)</span><br><span class="line">    </span><br><span class="line">plt.show()</span><br><span class="line">plt.close()</span><br></pre></td></tr></table></figure><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ol><li><a href="https://github.com/inseq-team/inseq?tab=readme-ov-file">inseq-team/inseq: Interpretability for sequence generation models ğŸ› ğŸ” (github.com)</a></li><li><a href="https://www.youtube.com/watch?v=WQY85vaQfTI&amp;ab_channel=Hung-yiLee">ã€æ©Ÿå™¨å­¸ç¿’2021ã€‘æ©Ÿå™¨å­¸ç¿’æ¨¡å‹çš„å¯è§£é‡‹æ€§ (Explainable ML) (ä¸Š) â€“ ç‚ºä»€éº¼é¡ç¥ç¶“ç¶²è·¯å¯ä»¥æ­£ç¢ºåˆ†è¾¨å¯¶å¯å¤¢å’Œæ•¸ç¢¼å¯¶è²å‘¢ï¼Ÿ (youtube.com)</a></li><li><a href="https://www.youtube.com/watch?v=RRGZs5qTeuQ&amp;ab_channel=Hung-yiLee">ã€æ©Ÿå™¨å­¸ç¿’2023ã€‘ HW9 - Explainable AI (youtube.com)</a></li><li><a href="https://weichengan.com/2020/11/30/paper_notes/cam_notes/">è®ºæ–‡ç¬”è®°ï¼šCAMã€Grad-CAMã€Grad-CAM++å’ŒSmooth Grad-CAM++ | CassiniWeiâ€™s Blog (weichengan.com)</a></li></ol><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;p&gt;è¿™ç§åˆ†æè²Œä¼¼åœ¨å¤§æ¨¡å‹æ—¶ä»£æ²¡æœ‰ä½¿ç”¨é‚£ä¹ˆå¤šäº†,æ‰€ä»¥è¿™é‡Œå¤§æ¦‚äº†è§£ä¸€ä¸‹.&lt;br&gt;</summary>
    
    
    
    
  </entry>
  
  <entry>
    <title>ååŒæ„ŸçŸ¥æ•°æ®é›†å’Œä»£ç åº“ä»‹ç»</title>
    <link href="https://www.sekyoro.top/2024/05/23/%E5%8D%8F%E5%90%8C%E6%84%9F%E7%9F%A5%E6%95%B0%E6%8D%AE%E9%9B%86%E4%BB%8B%E7%BB%8D/"/>
    <id>https://www.sekyoro.top/2024/05/23/%E5%8D%8F%E5%90%8C%E6%84%9F%E7%9F%A5%E6%95%B0%E6%8D%AE%E9%9B%86%E4%BB%8B%E7%BB%8D/</id>
    <published>2024-05-23T02:10:14.000Z</published>
    <updated>2024-07-06T09:19:00.716Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>ç›®å‰æ·±åº¦å­¦ä¹ çš„æ–¹æ³•éƒ½æ˜¯æ•°æ®é©±åŠ¨çš„,åœ¨ååŒæ„ŸçŸ¥æ–¹é¢,æ•°æ®é›†ç›®å‰ä¸ç®—ç‰¹åˆ«å¤š,ä¸»è¦å­˜åœ¨1)çœŸå®æ•°æ®è¾ƒå°‘2)ä¸åŒæ•°æ®é›†ä¹‹é—´é…ç½®å·®å¼‚è¾ƒå¤§,éœ€è¦è‡ªè¡Œä¿®æ”¹ç­‰.</p><span id="more"></span><h2 id="ååŒæ„ŸçŸ¥æ•°æ®é›†"><a href="#ååŒæ„ŸçŸ¥æ•°æ®é›†" class="headerlink" title="ååŒæ„ŸçŸ¥æ•°æ®é›†"></a>ååŒæ„ŸçŸ¥æ•°æ®é›†</h2><p><img data-src="https://s2.loli.net/2024/05/28/XfzY8nQyI3adCNM.png" alt="image-20240528181153135"></p><p>ç›®å‰æ‰¾åˆ°çš„æ•°æ®é›†è¿˜æ˜¯ä¸å°‘çš„.</p><h3 id="OPV2V-2022"><a href="#OPV2V-2022" class="headerlink" title="OPV2V 2022"></a>OPV2V 2022</h3><p>æ¨å‡ºäº†é¦–ä¸ªå¤§è§„æ¨¡å¼€æ”¾å¼è½¦å¯¹è½¦æ„ŸçŸ¥æ¨¡æ‹Ÿæ•°æ®é›†ã€‚è¯¥æ•°æ®é›†åŒ…å« <strong>70 å¤šä¸ªåœºæ™¯ã€11,464 ä¸ªå¸§å’Œ 232,913 ä¸ªæ³¨é‡Šä¸‰ç»´è½¦è¾†è¾¹ç•Œæ¡†</strong>ï¼Œ<strong>æ”¶é›†è‡ª CARLA çš„ 8 ä¸ªåŸé•‡å’Œæ´›æ‰çŸ¶å¡å°”å¼—åŸçš„ä¸€ä¸ªæ•°å­—åŸé•‡</strong>ã€‚ç„¶åæ„å»ºäº†ä¸€ä¸ªåŒ…å« 16 ä¸ªå®æ–½æ¨¡å‹çš„ç»¼åˆåŸºå‡†ï¼Œä»¥è¯„ä¼°å‡ ç§ä¿¡æ¯èåˆç­–ç•¥ï¼ˆå³æ—©æœŸã€åæœŸå’Œä¸­é—´èåˆï¼‰ä¸æœ€å…ˆè¿›çš„æ¿€å…‰é›·è¾¾æ£€æµ‹ç®—æ³•ã€‚</p><h3 id="V2XSet-2022"><a href="#V2XSet-2022" class="headerlink" title="V2XSet 2022"></a>V2XSet 2022</h3><p>ç ”ç©¶äº†å¦‚ä½•åº”ç”¨ â€œè½¦å¯¹ç‰©â€ï¼ˆV2Xï¼‰é€šä¿¡æ¥æé«˜è‡ªåŠ¨é©¾é©¶æ±½è½¦çš„æ„ŸçŸ¥æ€§èƒ½ã€‚æˆ‘ä»¬åˆ©ç”¨æ–°é¢–çš„è§†è§‰è½¬æ¢å™¨ï¼ˆVision Transformerï¼‰æå‡ºäº†ä¸€ä¸ªå…·æœ‰ V2X é€šä¿¡åŠŸèƒ½çš„ç¨³å¥åˆä½œæ„ŸçŸ¥æ¡†æ¶ã€‚å…·ä½“æ¥è¯´ï¼Œæˆ‘ä»¬å»ºç«‹äº†ä¸€ä¸ªæ•´ä½“æ³¨æ„åŠ›æ¨¡å‹ï¼Œå³ V2X-ViTï¼Œä»¥æœ‰æ•ˆèåˆé“è·¯ä»£ç†ï¼ˆå³è½¦è¾†å’ŒåŸºç¡€è®¾æ–½ï¼‰ä¹‹é—´çš„ä¿¡æ¯ã€‚V2X-ViT ç”±å¼‚æ„å¤šä»£ç†è‡ªæˆ‘æ³¨æ„å’Œå¤šå°ºåº¦çª—å£è‡ªæˆ‘æ³¨æ„äº¤æ›¿å±‚ç»„æˆï¼Œå¯æ•æ‰ä»£ç†é—´çš„äº¤äº’å’Œæ¯ä¸ªä»£ç†çš„ç©ºé—´å…³ç³»ã€‚è¿™äº›å…³é”®æ¨¡å—é‡‡ç”¨ç»Ÿä¸€çš„ Transformer æ¶æ„è®¾è®¡ï¼Œä»¥åº”å¯¹å¸¸è§çš„ V2X æŒ‘æˆ˜ï¼ŒåŒ…æ‹¬å¼‚æ­¥ä¿¡æ¯å…±äº«ã€å§¿åŠ¿é”™è¯¯å’Œ V2X ç»„ä»¶çš„å¼‚æ„æ€§ã€‚</p><p><img data-src="https://s2.loli.net/2024/03/22/3dLmHN96vbuVBtY.png" alt="image-20240322144729411"></p><p>è½¦ä¸é“è·¯  CARLAå’ŒOPENCDAåˆ›å»ºçš„æ¨¡æ‹Ÿæ•°æ®é›†</p><h3 id="DAIR-V2X-2022"><a href="#DAIR-V2X-2022" class="headerlink" title="DAIR-V2X 2022"></a>DAIR-V2X 2022</h3><p>ä¸ºäº†åŠ é€Ÿè½¦è¾†-åŸºç¡€è®¾æ–½ååŒè‡ªåŠ¨é©¾é©¶ï¼ˆVICADï¼‰çš„è®¡ç®—æœºè§†è§‰ç ”ç©¶å’Œåˆ›æ–°ï¼Œæˆ‘ä»¬å‘å¸ƒäº† DAIR-V2X æ•°æ®é›†ï¼Œè¿™æ˜¯<strong>é¦–ä¸ªç”¨äº VICAD çš„å¤§è§„æ¨¡ã€å¤šæ¨¡æ€ã€å¤šè§†è§’çœŸå®åœºæ™¯æ•°æ®é›†</strong>ã€‚</p><h3 id="V2X-Sim-2022"><a href="#V2X-Sim-2022" class="headerlink" title="V2X-Sim 2022"></a>V2X-Sim 2022</h3><p>è½¦å¯¹ç‰©ï¼ˆV2Xï¼‰é€šä¿¡æŠ€æœ¯å®ç°äº†è½¦è¾†ä¸é‚»è¿‘ç¯å¢ƒä¸­è®¸å¤šå…¶ä»–å®ä½“ä¹‹é—´çš„åä½œï¼Œå¯ä»¥ä»æ ¹æœ¬ä¸Šæ”¹å–„è‡ªåŠ¨é©¾é©¶çš„æ„ŸçŸ¥ç³»ç»Ÿã€‚ç„¶è€Œï¼Œå…¬å…±æ•°æ®é›†çš„ç¼ºä¹æå¤§åœ°é™åˆ¶äº†ååŒæ„ŸçŸ¥çš„ç ”ç©¶è¿›å±•ã€‚ä¸ºäº†å¡«è¡¥è¿™ä¸€ç©ºç™½ï¼Œæˆ‘ä»¬æå‡ºäº† V2X-Simâ€”ä¸€ä¸ª<strong>ç”¨äº V2X è¾…åŠ©è‡ªåŠ¨é©¾é©¶çš„ç»¼åˆæ¨¡æ‹Ÿå¤šä»£ç†æ„ŸçŸ¥æ•°æ®é›†</strong>ã€‚V2XSim æä¾›ï¼šï¼ˆ1ï¼‰æ¥è‡ªè·¯è¾¹è£…ç½®ï¼ˆRSUï¼‰å’Œå¤šè¾†è½¦çš„å¤šä»£ç†ä¼ æ„Ÿå™¨è®°å½•ï¼Œå¯å®ç°ååŒæ„ŸçŸ¥ï¼›ï¼ˆ2ï¼‰å¤šæ¨¡æ€ä¼ æ„Ÿå™¨æµï¼Œå¯ä¿ƒè¿›å¤šæ¨¡æ€æ„ŸçŸ¥ï¼›ä»¥åŠï¼ˆ3ï¼‰å¤šç§åœ°é¢å®å†µï¼Œå¯æ”¯æŒå„ç§æ„ŸçŸ¥ä»»åŠ¡ã€‚åŒæ—¶ï¼Œæˆ‘ä»¬å»ºç«‹äº†ä¸€ä¸ªå¼€æºæµ‹è¯•å¹³å°ï¼Œå¹¶åœ¨æ£€æµ‹ã€è·Ÿè¸ªå’Œåˆ†å‰²ç­‰ä¸‰ä¸ªä»»åŠ¡ä¸Šä¸ºæœ€å…ˆè¿›çš„ååŒæ„ŸçŸ¥ç®—æ³•æä¾›äº†åŸºå‡†ã€‚V2X-Sim è¯•å›¾åœ¨ç°å®æ•°æ®é›†å¹¿æ³›å¯ç”¨ä¹‹å‰ï¼Œä¿ƒè¿›è‡ªåŠ¨é©¾é©¶çš„ååŒæ„ŸçŸ¥ç ”ç©¶ã€‚</p><h3 id="V2V4Real-2023"><a href="#V2V4Real-2023" class="headerlink" title="V2V4Real 2023"></a>V2V4Real 2023</h3><p>æœ€è¿‘çš„ç ”ç©¶è¡¨æ˜ï¼Œè½¦å¯¹è½¦ï¼ˆV2Vï¼‰ååŒæ„ŸçŸ¥ç³»ç»Ÿåœ¨å½»åº•æ”¹å˜è‡ªåŠ¨é©¾é©¶è¡Œä¸šæ–¹é¢å…·æœ‰å·¨å¤§æ½œåŠ›ã€‚ç„¶è€Œï¼ŒçœŸå®ä¸–ç•Œæ•°æ®é›†çš„ç¼ºä¹é˜»ç¢äº†è¿™ä¸€é¢†åŸŸçš„å‘å±•ã€‚ä¸ºäº†ä¿ƒè¿›ååŒæ„ŸçŸ¥çš„å‘å±•ï¼Œæˆ‘ä»¬æå‡ºäº† V2V4Realï¼Œè¿™æ˜¯é¦–ä¸ª<strong>å¤§è§„æ¨¡çœŸå®ä¸–ç•Œå¤šæ¨¡æ€ V2V æ„ŸçŸ¥æ•°æ®é›†</strong>ã€‚</p><h4 id="æ‘˜è¦"><a href="#æ‘˜è¦" class="headerlink" title="æ‘˜è¦"></a>æ‘˜è¦</h4><p>ç°ä»£è‡ªåŠ¨é©¾é©¶æ„ŸçŸ¥ååŒå¯¹äºé®æŒ¡æ•æ„Ÿå¹¶ä¸”ç¼ºä¹é•¿èŒƒå›´æ„ŸçŸ¥èƒ½åŠ›,è¿™æ˜¯é˜»ç¢äº”çº§è‡ªåŠ¨é©¾é©¶çš„å…³é”®ç“¶é¢ˆä¹‹ä¸€.</p><p>æœ€è¿‘çš„ç ”ç©¶è¡¨æ˜ï¼Œ<strong>è½¦å¯¹è½¦ï¼ˆV2Vï¼‰åä½œæ„ŸçŸ¥ç³»ç»Ÿå…·æœ‰å½»åº•æ”¹å˜è‡ªåŠ¨é©¾é©¶è¡Œä¸šçš„å·¨å¤§æ½œåŠ›</strong>ã€‚ç„¶è€Œï¼Œ<strong>ç¼ºä¹çœŸå®ä¸–ç•Œçš„æ•°æ®é›†é˜»ç¢äº†è¯¥é¢†åŸŸçš„è¿›æ­¥ã€‚ä¸ºäº†ä¿ƒè¿›åˆä½œæ„ŸçŸ¥çš„å‘å±•ï¼Œæˆ‘ä»¬æå‡ºäº† V2V4Real</strong>ï¼Œè¿™æ˜¯ç¬¬ä¸€ä¸ªç”¨äº V2V æ„ŸçŸ¥çš„å¤§è§„æ¨¡ç°å®ä¸–ç•Œå¤šæ¨¡æ€æ•°æ®é›†ã€‚è¿™äº›æ•°æ®æ˜¯ç”±ä¸¤è¾†é…å¤‡å¤šæ¨¡æ€ä¼ æ„Ÿå™¨çš„è½¦è¾†åœ¨ä¸åŒåœºæ™¯ä¸­ä¸€èµ·è¡Œé©¶æ”¶é›†çš„ã€‚æˆ‘ä»¬çš„ V2V4Real æ•°æ®é›†è¦†ç›–äº† <strong>410 å…¬é‡Œçš„é©¾é©¶åŒºåŸŸï¼ŒåŒ…æ‹¬ 20K LiDAR å¸§ã€40K RGB å¸§ã€240K 5 ä¸ªç±»åˆ«çš„å¸¦æ³¨é‡Š 3D è¾¹ç•Œæ¡†ä»¥åŠè¦†ç›–æ‰€æœ‰é©¾é©¶è·¯çº¿çš„ HDMap</strong>ã€‚</p><blockquote><p>è‡ªåŠ¨é©¾é©¶æŠ€æœ¯åœ¨å›½é™…ä¸Šæœ‰ä¸€ä¸ªä¸¥æ ¼çš„åˆ†çº§æ ‡å‡†ï¼Œè€Œç¾å›½äº¤é€šéƒ¨é€‰æ‹©çš„æ˜¯ç¾å›½æ±½è½¦å·¥ç¨‹å¸ˆå­¦ä¼š(Society of Automotive Engineers)ç»™å‡ºçš„è¯„å®šæ ‡å‡†ï¼Œå…¶ä¸»è¦å†…å®¹æ˜¯ï¼š</p><p>0çº§ï¼šæ— è‡ªåŠ¨é©¾é©¶ï¼Œç”±äººç±»é©¾é©¶å‘˜å…¨æƒæ“æ§æ±½è½¦ï¼Œå¯ä»¥å¾—åˆ°è­¦å‘Šæˆ–å¹²é¢„ç³»ç»Ÿçš„è¾…åŠ©;</p><p>1çº§ï¼šé©¾é©¶æ”¯æ´ï¼Œé€šè¿‡é©¾é©¶ç¯å¢ƒå¯¹æ–¹å‘ç›˜å’ŒåŠ å‡é€Ÿä¸­çš„ä¸€é¡¹æ“ä½œæä¾›é©¾é©¶æ”¯æŒï¼Œå…¶ä»–çš„é©¾é©¶åŠ¨ä½œéƒ½ç”±äººç±»é©¾é©¶å‘˜è¿›è¡Œæ“ä½œ;</p><p>2çº§ï¼šéƒ¨åˆ†è‡ªåŠ¨åŒ–ï¼Œé€šè¿‡é©¾é©¶ç¯å¢ƒå¯¹æ–¹å‘ç›˜å’ŒåŠ å‡é€Ÿä¸­çš„å¤šé¡¹æ“ä½œæä¾›é©¾é©¶æ”¯æŒï¼Œå…¶ä»–çš„é©¾é©¶åŠ¨ä½œéƒ½ç”±äººç±»é©¾é©¶å‘˜è¿›è¡Œæ“ä½œã€‚</p><p>3çº§ï¼šæœ‰æ¡ä»¶è‡ªåŠ¨åŒ–ï¼Œç”±è‡ªåŠ¨é©¾é©¶ç³»ç»Ÿå®Œæˆæ‰€æœ‰çš„é©¾é©¶æ“ä½œã€‚æ ¹æ®ç³»ç»Ÿè¦æ±‚ï¼Œäººç±»é©¾é©¶è€…éœ€è¦åœ¨é€‚å½“çš„æ—¶å€™æä¾›åº”ç­”ã€‚</p><p>4çº§ï¼šé«˜åº¦è‡ªåŠ¨åŒ–ï¼Œç”±è‡ªåŠ¨é©¾é©¶ç³»ç»Ÿå®Œæˆæ‰€æœ‰çš„é©¾é©¶æ“ä½œã€‚æ ¹æ®ç³»ç»Ÿè¦æ±‚ï¼Œäººç±»é©¾é©¶è€…ä¸ä¸€å®šéœ€è¦å¯¹æ‰€æœ‰çš„ç³»ç»Ÿè¯·æ±‚åšå‡ºåº”ç­”ï¼ŒåŒ…æ‹¬é™å®šé“è·¯å’Œç¯å¢ƒæ¡ä»¶ç­‰ã€‚</p><p>5çº§ï¼šå®Œå…¨è‡ªåŠ¨åŒ–ï¼Œåœ¨æ‰€æœ‰äººç±»é©¾é©¶è€…å¯ä»¥åº”ä»˜çš„é“è·¯å’Œç¯å¢ƒæ¡ä»¶ä¸‹ï¼Œå‡å¯ä»¥ç”±è‡ªåŠ¨é©¾é©¶ç³»ç»Ÿè‡ªä¸»å®Œæˆæ‰€æœ‰çš„é©¾é©¶æ“ä½œã€‚</p></blockquote><p>V2V4Real å¼•å…¥äº†ä¸‰ä¸ªæ„ŸçŸ¥ä»»åŠ¡ï¼ŒåŒ…æ‹¬åä½œ 3D å¯¹è±¡æ£€æµ‹ã€åä½œ 3D å¯¹è±¡è·Ÿè¸ªå’Œç”¨äºåä½œæ„ŸçŸ¥çš„ Sim2Real åŸŸè‡ªé€‚åº”ã€‚æˆ‘ä»¬æä¾›äº†è¿‘æœŸåä½œæ„ŸçŸ¥ç®—æ³•åœ¨ä¸‰ä¸ªä»»åŠ¡ä¸Šçš„ç»¼åˆåŸºå‡†ã€‚ V2V4Real æ•°æ®é›†å’Œä»£ç åº“å¯ä»¥åœ¨ Research.seas.ucla.edu/mobility-lab/v2v4real ä¸Šæ‰¾åˆ°ã€‚</p><p>æˆ‘ä»¬æ”¶é›†äº† 19 ä¸ªå°æ—¶çš„ 310K å¸§çš„é©¾é©¶æ•°æ®ã€‚æˆ‘ä»¬æ‰‹åŠ¨é€‰æ‹©æœ€å…·ä»£è¡¨æ€§çš„ 67 ä¸ªåœºæ™¯ï¼Œæ¯ä¸ªåœºæ™¯æ—¶é•¿ 10-20 ç§’ã€‚æˆ‘ä»¬ä»¥ 10Hz çš„é¢‘ç‡å¯¹å¸§è¿›è¡Œé‡‡æ ·ï¼Œå¾—åˆ°æ€»å…± 20K å¸§çš„ LiDAR ç‚¹äº‘å’Œ 40K å¸§çš„ RGB å›¾åƒã€‚å¯¹äºæ¯ä¸ªåœºæ™¯ï¼Œæˆ‘ä»¬ç¡®ä¿ä¸¤è¾†è½¦ä¼ æ„Ÿå™¨ç³»ç»Ÿä¹‹é—´çš„å¼‚æ­¥å°äº 50 æ¯«ç§’ã€‚æ‰€æœ‰åœºæ™¯éƒ½ä¸åŒ…å«å¯è¡Œé©¶åŒºåŸŸã€é“è·¯è¾¹ç•Œä»¥åŠè™šçº¿çš„åœ°å›¾å¯¹é½ã€‚</p><ul><li>åä½œè€…çš„ç›¸å¯¹ä½å§¿å­˜åœ¨ä¸å¯é¿å…çš„è¯¯å·®ï¼Œè¿™åœ¨å°†æ•°æ®è½¬æ¢åˆ°ç»Ÿä¸€åæ ‡ç³»æ—¶ä¼šäº§ç”Ÿå…¨å±€é”™ä½ã€‚</li><li>åä½œè€…çš„ä¼ æ„Ÿå™¨æµ‹é‡é€šå¸¸ä¸åŒæ­¥ï¼Œè¿™æ˜¯ç”±ä¸åŒä¼ æ„Ÿå™¨ç³»ç»Ÿçš„å¼‚æ­¥ä»¥åŠæ•°æ®ä¼ è¾“è¿‡ç¨‹ä¸­çš„é€šä¿¡å»¶è¿Ÿé€ æˆçš„</li><li>å…¸å‹çš„V2Vé€šä¿¡æŠ€æœ¯éœ€è¦æœ‰é™çš„å¸¦å®½ï¼Œè¿™é™åˆ¶äº†ä¼ è¾“æ•°æ®çš„å¤§å°[31,40,49]ã€‚å› æ­¤ï¼Œåä½œæ£€æµ‹ç®—æ³•å¿…é¡»è€ƒè™‘ç²¾åº¦å’Œå¸¦å®½è¦æ±‚ä¹‹é—´çš„æƒè¡¡</li></ul><p><strong>è®­ç»ƒç»†èŠ‚.</strong>å¯¹äºæ‰€æœ‰ä¸‰ä¸ªä»»åŠ¡ï¼Œæ•°æ®é›†åˆ†ä¸ºè®­ç»ƒ/éªŒè¯/æµ‹è¯•é›†ï¼Œåˆ†åˆ«å…·æœ‰ <strong>14,210/2,000/3,986 å¸§</strong>ã€‚æ‰€æœ‰æ£€æµ‹æ¨¡å‹å‡é‡‡ç”¨ PointPillar  ä½œä¸ºéª¨å¹²ä»ç‚¹äº‘ä¸­æå– 2D ç‰¹å¾ã€‚æˆ‘ä»¬ç”¨ 60 ä¸ª epoch è®­ç»ƒæ‰€æœ‰æ¨¡å‹ï¼Œæ¯ä¸ª GPU (RTX3090) çš„æ‰¹é‡å¤§å°ä¸º 4ï¼Œå­¦ä¹ ç‡ä¸º 0.001ï¼Œå¹¶é€šè¿‡ä½™å¼¦é€€ç«æ¥è¡°å‡å­¦ä¹ ç‡ã€‚æ—©æœŸåœæ­¢ç”¨äºå¯»æ‰¾æœ€ä½³æ—¶æœŸã€‚æˆ‘ä»¬è¿˜ä¸ºæ‰€æœ‰å®éªŒæ·»åŠ äº†æ­£å¸¸çš„ç‚¹äº‘æ•°æ®å¢å¼ºï¼ŒåŒ…æ‹¬ç¼©æ”¾ã€æ—‹è½¬å’Œç¿»è½¬ã€‚æˆ‘ä»¬ä½¿ç”¨æƒé‡è¡°å‡ä¸º 1Ã—10âˆ’2 çš„ AdamWæ¥ä¼˜åŒ–æˆ‘ä»¬çš„æ¨¡å‹ã€‚å¯¹äºè·Ÿè¸ªä»»åŠ¡ï¼Œæˆ‘ä»¬å°†å‰ 3 å¸§å’Œå½“å‰å¸§ä¸€èµ·ä½œä¸ºè¾“å…¥.</p><h3 id="RCooper-A-Real-world-Large-scale-Dataset-for-Roadside-Cooperative-Perception-2024"><a href="#RCooper-A-Real-world-Large-scale-Dataset-for-Roadside-Cooperative-Perception-2024" class="headerlink" title="RCooper: A Real-world Large-scale Dataset for Roadside Cooperative Perception 2024"></a>RCooper: A Real-world Large-scale Dataset for Roadside Cooperative Perception 2024</h3><p>è¿‘å¹´æ¥ï¼Œè·¯ä¾§æ„ŸçŸ¥çš„ä»·å€¼é€æ¸å‡¸æ˜¾å¹¶å¾—åˆ°è®¤å¯ï¼Œå®ƒå¯ä»¥å»¶ä¼¸è‡ªåŠ¨é©¾é©¶å’Œäº¤é€šç®¡ç†çš„è¾¹ç•Œã€‚</p><p>ç„¶è€Œï¼Œç°æœ‰çš„è·¯ä¾§æ„ŸçŸ¥æ–¹æ³•ä»…é’ˆå¯¹å•ä¸€åŸºç¡€è®¾æ–½çš„ä¼ æ„Ÿå™¨ç³»ç»Ÿï¼Œç”±äºæ„ŸçŸ¥èŒƒå›´å’Œç›²åŒºçš„é™åˆ¶ï¼Œæ— æ³•å®ç°å¯¹äº¤é€šåŒºåŸŸçš„å…¨é¢ç†è§£ã€‚é¢å‘é«˜è´¨é‡çš„è·¯ä¾§æ„ŸçŸ¥ï¼Œæˆ‘ä»¬éœ€è¦è·¯ä¾§ååŒæ„ŸçŸ¥( Roadside Cooperative Perceptionï¼ŒRCooper )æ¥å®ç°é¢å‘å—é™äº¤é€šåŒºåŸŸçš„å®é™…åŒºåŸŸè¦†ç›–è·¯ä¾§æ„ŸçŸ¥ã€‚Rcooperæœ‰å…¶ç‰¹å®šé¢†åŸŸçš„æŒ‘æˆ˜ï¼Œä½†ç”±äºç¼ºä¹æ•°æ®é›†è€Œé˜»ç¢äº†è¿›ä¸€æ­¥çš„æ¢ç´¢ã€‚</p><p><img data-src="https://s2.loli.net/2024/05/24/43wQjzbeqUEdXTs.png" alt="image-20240524101039784"></p><p>å› æ­¤ï¼Œæˆ‘ä»¬å‘å¸ƒäº†ç¬¬ä¸€ä¸ªçœŸå®ä¸–ç•Œçš„å¤§è§„æ¨¡RCooperæ•°æ®é›†ï¼Œä»¥å¯åŠ¨å¯¹å®é™…è·¯è¾¹åä½œæ„ŸçŸ¥çš„ç ”ç©¶ï¼ŒåŒ…æ‹¬æ£€æµ‹å’Œè·Ÿè¸ªã€‚äººå·¥æ ‡æ³¨çš„æ•°æ®é›†åŒ…æ‹¬50kå¹…å›¾åƒå’Œ30kä¸ªç‚¹äº‘ï¼Œå…¶ä¸­åŒ…å«ä¸¤ä¸ªå…·æœ‰ä»£è¡¨æ€§çš„äº¤é€šåœºæ™¯(å³,äº¤å‰å£å’Œèµ°å»Š)ã€‚æ‰€æ„å»ºçš„åŸºå‡†è¯æ˜äº†è·¯ä¾§åˆä½œæ„ŸçŸ¥çš„æœ‰æ•ˆæ€§ï¼Œå¹¶å±•ç¤ºäº†è¿›ä¸€æ­¥ç ”ç©¶çš„æ–¹å‘ã€‚</p><h3 id="TUMTraf-V2X-2024"><a href="#TUMTraf-V2X-2024" class="headerlink" title="TUMTraf-V2X 2024"></a>TUMTraf-V2X 2024</h3><p>åä½œæ„ŸçŸ¥ä¸ºå¢å¼ºè‡ªåŠ¨é©¾é©¶è½¦è¾†çš„èƒ½åŠ›å’Œæ”¹å–„é“è·¯å®‰å…¨æä¾›äº†è®¸å¤šå¥½å¤„ã€‚é™¤äº†è½¦è½½ä¼ æ„Ÿå™¨å¤–ï¼Œä½¿ç”¨è·¯è¾¹ä¼ æ„Ÿå™¨å¢åŠ äº†å¯é æ€§ï¼Œå¹¶æ‰©å±•äº†ä¼ æ„Ÿå™¨çš„èŒƒå›´ã€‚</p><p>æ•°æ®é›†åŒ…å«2ï¼Œ000ä¸ªæ ‡è®°ç‚¹äº‘å’Œ5ï¼Œ000å¼ æ¥è‡ª5ä¸ªè·¯ä¾§å’Œ4ä¸ªæœºè½½ä¼ æ„Ÿå™¨çš„æ ‡è®°å›¾åƒã€‚å®ƒåŒ…æ‹¬30kä¸ªå¸¦æœ‰è½¨é“IDå’Œç²¾ç¡®çš„GPSå’ŒIMUæ•°æ®çš„3Dç›’å­ã€‚æ ‡æ³¨äº†å…«ä¸ªç±»åˆ«ï¼Œæ¶µç›–äº†å…·æœ‰æŒ‘æˆ˜æ€§çš„é©¾é©¶æ“ä½œçš„é®æŒ¡åœºæ™¯ï¼Œå¦‚äº¤é€šè¿è§„ã€æ¥è¿‘å¤±è¯¯äº‹ä»¶ã€è¶…è½¦å’Œæ‰å¤´ã€‚</p><h3 id="V2X-Real-2024"><a href="#V2X-Real-2024" class="headerlink" title="V2X-Real 2024"></a>V2X-Real 2024</h3><p>è¿‘å¹´æ¥ï¼Œéšç€è½¦è”ç½‘( Vehicle-to-Ethingï¼ŒV2X )æŠ€æœ¯çš„å‘å±•ï¼Œè‡ªåŠ¨é©¾é©¶è½¦è¾†èƒ½å¤Ÿå…±äº«æ„ŸçŸ¥ä¿¡æ¯ä»¥ç©¿é€é®æŒ¡ï¼Œæå¤§åœ°æå‡äº†æ„ŸçŸ¥èƒ½åŠ›ã€‚</p><p>åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬æå‡ºäº†ä¸€ä¸ªåŒæ—¶å…·æœ‰å¤šç§è½¦è¾†å’Œæ™ºèƒ½åŸºç¡€è®¾æ–½çš„æ··åˆæ•°æ®é›†ï¼Œä»¥ä¿ƒè¿›å…·æœ‰å¤šæ¨¡æ€æ„ŸçŸ¥æ•°æ®çš„V2Xåä½œæ„ŸçŸ¥å¼€å‘ã€‚æˆ‘ä»¬çš„V2X - Realä½¿ç”¨ä¸¤ä¸ªè¿æ¥çš„è‡ªåŠ¨åŒ–è½¦è¾†å’Œä¸¤ä¸ªæ™ºèƒ½åŸºç¡€è®¾æ–½è¿›è¡Œé‡‡é›†ï¼Œè¿™äº›åŸºç¡€è®¾æ–½éƒ½é…å¤‡äº†åŒ…æ‹¬æ¿€å…‰é›·è¾¾ä¼ æ„Ÿå™¨å’Œå¤šè§†è§’ç›¸æœºåœ¨å†…çš„å¤šæ¨¡æ€ä¼ æ„Ÿå™¨ã€‚</p><p>æ•´ä¸ªæ•°æ®é›†åŒ…å«33Kä¸ªLiDARå¸§å’Œ171Kä¸ªç›¸æœºæ•°æ®ï¼Œåœ¨éå¸¸å…·æœ‰æŒ‘æˆ˜æ€§çš„åŸå¸‚åœºæ™¯ä¸­ï¼Œæœ‰è¶…è¿‡1.2 Mçš„10ä¸ªç±»åˆ«çš„æ³¨é‡Šè¾¹ç•Œæ¡†ã€‚æ ¹æ®åä½œæ¨¡å¼å’Œè‡ªæˆ‘è§†è§’ï¼Œæˆ‘ä»¬æ¨å¯¼å‡ºè½¦è¾†ä¸­å¿ƒã€åŸºç¡€è®¾æ–½ä¸­å¿ƒã€è½¦è¾†åˆ°è½¦è¾†å’ŒåŸºç¡€è®¾æ–½åˆ°åŸºç¡€è®¾æ–½åä½œæ„ŸçŸ¥çš„å››ç±»æ•°æ®é›†ã€‚ ä¸»è¦æ˜¯åŒ…å«äº†I2Içš„åœºæ™¯.</p><blockquote><p>ä¸Šé¢ä¸‰ä¸ªæ•°æ®é›†éƒ½æ˜¯V2Xçš„çœŸå®ç¯å¢ƒæ•°æ®</p></blockquote><h2 id="CodeBase"><a href="#CodeBase" class="headerlink" title="CodeBase"></a>CodeBase</h2><p>æˆ‘å¸¸ç”¨çš„å°±æ˜¯OpenCOOD <a href="https://github.com/DerrickXuNu/OpenCOOD?tab=readme-ov-file">ICRA 2022] An opensource framework for cooperative detection. Official implementation for OPV2V. (github.com)</a>çš„ä»£ç åº“,ä½†ä¹Ÿæœ‰å…¶ä»–çœ‹èµ·æ¥è¿˜è¡Œçš„,åŒ…æ‹¬:</p><ul><li><a href="https://github.com/ucla-mobility/V2V4Real">CVPR2023 Highlight] The official codebase for paper â€œV2V4Real: A large-scale real-world dataset for Vehicle-to-Vehicle Cooperative Perceptionâ€ (github.com)</a></li><li><a href="https://github.com/yifanlu0227/HEAL">ICLR2024] HEAL: An Extensible Framework for Open Heterogeneous Collaborative Perception â¡ï¸ All You Need for Multi-Modality Collaborative Perception! (github.com)</a></li><li><a href="https://github.com/yifanlu0227/CoAlign/tree/main">ICRA2023] CoAlign: Robust Collaborative 3D Object Detection in Presence of Pose Errors (github.com)</a></li><li><a href="https://github.com/AIR-THU/DAIR-V2X">AIR-THU/DAIR-V2X (github.com)</a></li><li><a href="https://github.com/coperception/coperception">coperception/coperception: An SDK for multi-agent collaborative perception. (github.com)</a> è¿™ä¸ªä»“åº“ä»£ç å…¶å®ä¸å¤ªè¡Œ ğŸ˜…</li></ul><p>è¿™é‡Œå¯¹å…¶ä¸­ä¸€äº›ä»£ç åšç®€å•ä»‹ç».</p><h3 id="ä¸åŒæ•°æ®ç±»å‹èåˆ"><a href="#ä¸åŒæ•°æ®ç±»å‹èåˆ" class="headerlink" title="ä¸åŒæ•°æ®ç±»å‹èåˆ"></a>ä¸åŒæ•°æ®ç±»å‹èåˆ</h3><h4 id="æ—©æœŸ"><a href="#æ—©æœŸ" class="headerlink" title="æ—©æœŸ"></a>æ—©æœŸ</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">projected_lidar_stack = []</span><br><span class="line">       object_stack = []</span><br><span class="line">       object_id_stack = []</span><br><span class="line"></span><br><span class="line">       <span class="comment"># loop over all CAVs to process information</span></span><br><span class="line">       <span class="keyword">for</span> cav_id, selected_cav_base <span class="keyword">in</span> base_data_dict.items():</span><br><span class="line">           <span class="comment"># check if the cav is within the communication range with ego</span></span><br><span class="line">           distance = \</span><br><span class="line">               math.sqrt((selected_cav_base[<span class="string">&#x27;params&#x27;</span>][<span class="string">&#x27;lidar_pose&#x27;</span>][<span class="number">0</span>] -</span><br><span class="line">                          ego_lidar_pose[<span class="number">0</span>]) ** <span class="number">2</span> + (</span><br><span class="line">                                 selected_cav_base[<span class="string">&#x27;params&#x27;</span>][</span><br><span class="line">                                     <span class="string">&#x27;lidar_pose&#x27;</span>][<span class="number">1</span>] - ego_lidar_pose[</span><br><span class="line">                                     <span class="number">1</span>]) ** <span class="number">2</span>)</span><br><span class="line">           <span class="keyword">if</span> distance &gt; opencood.data_utils.datasets.COM_RANGE:</span><br><span class="line">               <span class="keyword">continue</span></span><br><span class="line">           selected_cav_processed = self.get_item_single_car(</span><br><span class="line">               selected_cav_base,</span><br><span class="line">               ego_lidar_pose)</span><br><span class="line">           <span class="comment"># all these lidar and object coordinates are projected to ego</span></span><br><span class="line">           <span class="comment"># already.</span></span><br><span class="line">           projected_lidar_stack.append(</span><br><span class="line">               selected_cav_processed[<span class="string">&#x27;projected_lidar&#x27;</span>])</span><br><span class="line">           object_stack.append(selected_cav_processed[<span class="string">&#x27;object_bbx_center&#x27;</span>])</span><br><span class="line">           object_id_stack += selected_cav_processed[<span class="string">&#x27;object_ids&#x27;</span>]</span><br></pre></td></tr></table></figure><p>ä¸Šé¢å¾—åˆ°äº†ä¸‰ä¸ªæ•°ç»„ projected_lidar_stack,object_stack ,object_id_stack.</p><p>åˆ†åˆ«æ˜¯é€šè¿‡<code>project_world_objects</code>å¾—åˆ°çš„bbxçš„ä¸­å¿ƒ,ç‰©ä½“idä»¥åŠlidaræ•°æ®(æŠ•å½±åˆ°egoåæ ‡ç³»ä¸Š),</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">object_bbx_center, object_bbx_mask, object_ids = \</span><br><span class="line">          self.post_processor.generate_object_center([selected_cav_base],</span><br><span class="line">                                                     ego_pose)</span><br><span class="line"></span><br><span class="line">      <span class="comment"># filter lidar</span></span><br><span class="line">      lidar_np = selected_cav_base[<span class="string">&#x27;lidar_np&#x27;</span>]</span><br><span class="line">      lidar_np = shuffle_points(lidar_np)</span><br><span class="line">      <span class="comment"># remove points that hit itself</span></span><br><span class="line">      lidar_np = mask_ego_points(lidar_np)</span><br><span class="line">      <span class="comment"># project the lidar to ego space</span></span><br><span class="line">      lidar_np[:, :<span class="number">3</span>] = \</span><br><span class="line">          box_utils.project_points_by_matrix_torch(lidar_np[:, :<span class="number">3</span>],</span><br><span class="line">                                                   transformation_matrix)</span><br><span class="line"></span><br><span class="line">      selected_cav_processed.update(</span><br><span class="line">          &#123;<span class="string">&#x27;object_bbx_center&#x27;</span>: object_bbx_center[object_bbx_mask == <span class="number">1</span>],</span><br><span class="line">           <span class="string">&#x27;object_ids&#x27;</span>: object_ids,</span><br><span class="line">           <span class="string">&#x27;projected_lidar&#x27;</span>: lidar_np&#125;)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">box_utils.project_world_objects(tmp_object_dict,</span><br><span class="line">                                    output_dict,</span><br><span class="line">                                    reference_lidar_pose,</span><br><span class="line">                                    filter_range,</span><br><span class="line">                                    self.params[<span class="string">&#x27;order&#x27;</span>])</span><br><span class="line"></span><br><span class="line">    object_np = np.zeros((self.params[<span class="string">&#x27;max_num&#x27;</span>], <span class="number">7</span>))</span><br><span class="line">    mask = np.zeros(self.params[<span class="string">&#x27;max_num&#x27;</span>])</span><br><span class="line">    object_ids = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i, (object_id, object_bbx) <span class="keyword">in</span> <span class="built_in">enumerate</span>(output_dict.items()):</span><br><span class="line">        object_np[i] = object_bbx[<span class="number">0</span>, :]</span><br><span class="line">        mask[i] = <span class="number">1</span></span><br><span class="line">        object_ids.append(object_id)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> object_np, mask, object_ids</span><br></pre></td></tr></table></figure><p>åé¢å¯¹ç‚¹äº‘æ•°æ®å»æ‰ä¸€äº›èŒƒå›´çš„å€¼,å¢å¼º,ç„¶åå°†ç‚¹äº‘æ•°æ®é€šè¿‡voxelæˆ–è€…bevå¾—åˆ°å¯¹åº”çš„ä½“ç´ å¾—åˆ°lidar_dict</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># pre-process the lidar to voxel/bev/downsampled lidar</span></span><br><span class="line">       lidar_dict = self.pre_processor.preprocess(projected_lidar_stack)</span><br></pre></td></tr></table></figure><p>æœ€åçš„è¿”å›æ•°æ®</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">processed_data_dict[<span class="string">&#x27;ego&#x27;</span>].update(</span><br><span class="line">         &#123;<span class="string">&#x27;object_bbx_center&#x27;</span>: object_bbx_center,</span><br><span class="line">          <span class="string">&#x27;object_bbx_mask&#x27;</span>: mask,</span><br><span class="line">          <span class="string">&#x27;object_ids&#x27;</span>: [object_id_stack[i] <span class="keyword">for</span> i <span class="keyword">in</span> unique_indices],</span><br><span class="line">          <span class="string">&#x27;anchor_box&#x27;</span>: anchor_box,</span><br><span class="line">          <span class="string">&#x27;processed_lidar&#x27;</span>: lidar_dict,</span><br><span class="line">          <span class="string">&#x27;label_dict&#x27;</span>: label_dict&#125;)</span><br><span class="line"></span><br><span class="line">     <span class="keyword">if</span> self.visualize:</span><br><span class="line">         processed_data_dict[<span class="string">&#x27;ego&#x27;</span>].update(&#123;<span class="string">&#x27;origin_lidar&#x27;</span>:projected_lidar_stack,</span><br><span class="line">                                           <span class="string">&#x27;split_lidar&#x27;</span>:ind_lidar&#125;)</span><br><span class="line">     <span class="keyword">return</span> processed_data_dict</span><br></pre></td></tr></table></figure><h2 id="ç›¸å…³è®ºæ–‡"><a href="#ç›¸å…³è®ºæ–‡" class="headerlink" title="ç›¸å…³è®ºæ–‡"></a>ç›¸å…³è®ºæ–‡</h2><ol><li>arXiv:2404.14022</li></ol><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;p&gt;ç›®å‰æ·±åº¦å­¦ä¹ çš„æ–¹æ³•éƒ½æ˜¯æ•°æ®é©±åŠ¨çš„,åœ¨ååŒæ„ŸçŸ¥æ–¹é¢,æ•°æ®é›†ç›®å‰ä¸ç®—ç‰¹åˆ«å¤š,ä¸»è¦å­˜åœ¨1)çœŸå®æ•°æ®è¾ƒå°‘2)ä¸åŒæ•°æ®é›†ä¹‹é—´é…ç½®å·®å¼‚è¾ƒå¤§,éœ€è¦è‡ªè¡Œä¿®æ”¹ç­‰.&lt;/p&gt;</summary>
    
    
    
    
    <category term="collaborative perception" scheme="https://www.sekyoro.top/tags/collaborative-perception/"/>
    
  </entry>
  
  <entry>
    <title>Domain Adaptation Method</title>
    <link href="https://www.sekyoro.top/2024/05/21/Domain-Adaptation-Method/"/>
    <id>https://www.sekyoro.top/2024/05/21/Domain-Adaptation-Method/</id>
    <published>2024-05-21T01:47:55.000Z</published>
    <updated>2024-07-05T07:36:24.979Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>è¿™ä¸ªæ–¹å‘çš„æŠ€æœ¯ç›®å‰æ²¡æœ‰é‚£ä¹ˆç«äº†,ä½†æ˜¯èƒ½åº”ç”¨çš„åœºæ™¯éå¸¸ä¹‹å¤š.<br><span id="more"></span></p><h1 id="ç»¼è¿°"><a href="#ç»¼è¿°" class="headerlink" title="ç»¼è¿°"></a>ç»¼è¿°</h1><h2 id="Deep-Unsupervised-Domain-Adaptation-A-Review-of-Recent-Advances-and-Perspectives"><a href="#Deep-Unsupervised-Domain-Adaptation-A-Review-of-Recent-Advances-and-Perspectives" class="headerlink" title="Deep Unsupervised Domain Adaptation: A Review of Recent Advances and Perspectives"></a>Deep Unsupervised Domain Adaptation: A Review of Recent Advances and Perspectives</h2><p>æ·±åº¦å­¦ä¹ å·²ç»æˆä¸ºè§£å†³ä¸åŒé¢†åŸŸç°å®é—®é¢˜çš„é¦–é€‰æ–¹æ³•ï¼Œéƒ¨åˆ†åŸå› æ˜¯å®ƒèƒ½å¤Ÿä»æ•°æ®ä¸­å­¦ä¹ ,å¹¶åœ¨å¹¿æ³›çš„åº”ç”¨ä¸­å–å¾—äº†ä»¤äººå°è±¡æ·±åˆ»çš„æ€§èƒ½ã€‚</p><p>ç„¶è€Œï¼Œå®ƒçš„æˆåŠŸé€šå¸¸ä¾èµ–äºä¸¤ä¸ªå‡è®¾ï¼š( i )<strong>ç²¾ç¡®çš„æ¨¡å‹æ‹Ÿåˆéœ€è¦å¤§é‡æœ‰æ ‡ç­¾çš„æ•°æ®é›†</strong>,( ii )<strong>è®­ç»ƒå’Œæµ‹è¯•æ•°æ®æ˜¯ç‹¬ç«‹åŒåˆ†å¸ƒçš„.å› æ­¤,å®ƒåœ¨çœ‹ä¸è§çš„ç›®æ ‡åŸŸä¸Šçš„æ€§èƒ½å¾—ä¸åˆ°ä¿è¯,ç‰¹åˆ«æ˜¯åœ¨é€‚åº”é˜¶æ®µé‡åˆ°åˆ†å¸ƒå¤–æ•°æ®æ—¶</strong>ã€‚</p><p>åœ¨ç›®æ ‡åŸŸæ•°æ®ä¸Šçš„æ€§èƒ½ä¸‹é™æ˜¯éƒ¨ç½²åœ¨æºåŸŸæ•°æ®ä¸ŠæˆåŠŸè®­ç»ƒçš„æ·±åº¦ç¥ç»ç½‘ç»œçš„ä¸€ä¸ªå…³é”®é—®é¢˜.</p><p>æ— ç›‘ç£åŸŸé€‚åº”( Unsupervised Domain Adaptationï¼ŒUDA )æ­£æ˜¯é’ˆå¯¹è¿™ä¸€é—®é¢˜æå‡ºçš„,é€šè¿‡åŒæ—¶åˆ©ç”¨å·²æ ‡è®°çš„æºåŸŸæ•°æ®å’Œæœªæ ‡è®°çš„ç›®æ ‡åŸŸæ•°æ®,åœ¨ç›®æ ‡åŸŸä¸­æ‰§è¡Œå„ç§ä»»åŠ¡</p><p><img data-src="https://s2.loli.net/2024/05/21/yksHCLQcPdOrERa.png" alt="image-20240521102852946"></p><blockquote><p>Although supervised deep learning is the most prevalent and successful approach for a variety of tasks, its success hinges on (i) vast troves of labeled training data and (ii) the assumption of independent and identically distributed (i.i.d.) training and testing datasets.</p></blockquote><p>Because reliable labeling of massive datasets for various application domains is often expensive and prohibitive, for a task without sufficient labeled datasets in a target domain, there is strong demand to apply trained models, by leveraging rich labeled data from a source domain</p><p><img data-src="https://s2.loli.net/2024/05/21/R2xdyXHQJp38nNj.png" alt="image-20240521110351381"></p><script type="math/tex; mode=display">\begin{aligned}&\mathcal{L}_t(h)\leq\mathcal{L}_s(h)+d[p_\mathcal{S},p_\mathcal{T}]+\\&\min[\mathbb{E}_{x\sim p_s}|p_s(y|x)-p_t(y|x)|,\mathbb{E}_{x\sim p_t}|p_s(y|x)-p_t(y|x)|]\end{aligned}</script><p><img data-src="https://s2.loli.net/2024/05/23/ZAvaHCuiyK78RpW.png" alt="image-20240523110706500"></p><p>å¸¸ç”¨çš„æ–¹æ³•åˆ†ç±»å¦‚å›¾.</p><h4 id="Statistic-Divergence-Alignment"><a href="#Statistic-Divergence-Alignment" class="headerlink" title="Statistic Divergence Alignment"></a>Statistic Divergence Alignment</h4><p>å­¦ä¹ é¢†åŸŸä¸å˜ç‰¹å¾è¡¨ç¤ºæ˜¯è®¸å¤šæ·±åº¦UDAæ–¹æ³•ä¸­åº”ç”¨æœ€å¹¿æ³›çš„æ€æƒ³,å…¶å…³é”®åœ¨äºæœ€å°åŒ–æ½œåœ¨ç‰¹å¾ç©ºé—´ä¸­çš„é¢†åŸŸå·®å¼‚.<strong>ä¸ºäº†å®ç°è¿™ä¸€ç›®æ ‡,é€‰æ‹©åˆé€‚çš„divergence measureæ˜¯è¿™äº›æ–¹æ³•çš„æ ¸å¿ƒ</strong>ã€‚</p><h2 id="Deep-visual-domain-adaptation-A-survey"><a href="#Deep-visual-domain-adaptation-A-survey" class="headerlink" title="Deep visual domain adaptation: A survey"></a>Deep visual domain adaptation: A survey</h2><p>æ·±åº¦åŸŸé€‚åº”å·²ç»æˆä¸ºä¸€ç§æ–°çš„å­¦ä¹ æŠ€æœ¯ï¼Œä»¥è§£å†³ç¼ºä¹å¤§é‡æ ‡è®°æ•°æ®çš„é—®é¢˜ã€‚ä¸ä¼ ç»Ÿçš„å­¦ä¹ å…±äº«ç‰¹å¾å­ç©ºé—´æˆ–é‡ç”¨å…·æœ‰æµ…å±‚è¡¨ç¤ºçš„é‡è¦æºå®ä¾‹çš„æ–¹æ³•ç›¸æ¯”ï¼Œæ·±åº¦åŸŸé€‚åº”æ–¹æ³•é€šè¿‡å°†åŸŸé€‚åº”åµŒå…¥åˆ°æ·±åº¦å­¦ä¹ çš„æµæ°´çº¿ä¸­ï¼Œåˆ©ç”¨æ·±åº¦ç½‘ç»œæ¥å­¦ä¹ æ›´å¤šçš„å¯è¿ç§»è¡¨ç¤ºã€‚å·²æœ‰é’ˆå¯¹æµ…åŸŸè‡ªé€‚åº”çš„å…¨é¢è°ƒæŸ¥ï¼Œä½†å¾ˆå°‘æœ‰äººåŠæ—¶è¯„è®ºåŸºäºæ·±åº¦å­¦ä¹ çš„æ–°å…´æ–¹æ³•ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å¯¹è®¡ç®—æœºè§†è§‰åº”ç”¨ä¸­çš„æ·±åº¦åŸŸè‡ªé€‚åº”æ–¹æ³•è¿›è¡Œäº†å…¨é¢è°ƒæŸ¥ï¼Œä¸»è¦æœ‰å››å¤§è´¡çŒ®ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬æ ¹æ®å®šä¹‰ä¸¤ä¸ªåŸŸå¦‚ä½•åç¦»çš„æ•°æ®å±æ€§ï¼Œæå‡ºäº†ä¸åŒæ·±åº¦åŸŸé€‚é…åœºæ™¯çš„åˆ†ç±»æ³•ã€‚å…¶æ¬¡ï¼Œæˆ‘ä»¬æ ¹æ®è®­ç»ƒæŸå¤±å°†æ·±åŸŸé€‚åº”æ–¹æ³•å½’çº³ä¸ºå‡ ä¸ªç±»åˆ«ï¼Œå¹¶ç®€è¦åˆ†æå’Œæ¯”è¾ƒäº†è¿™äº›ç±»åˆ«ä¸‹çš„æœ€å…ˆè¿›æ–¹æ³•ã€‚ç¬¬ä¸‰ï¼Œæˆ‘ä»¬æ¦‚è¿°äº†å›¾åƒåˆ†ç±»ä¹‹å¤–çš„è®¡ç®—æœºè§†è§‰åº”ç”¨ï¼Œå¦‚äººè„¸è¯†åˆ«ã€è¯­ä¹‰åˆ†å‰²å’Œç‰©ä½“æ£€æµ‹ã€‚ç¬¬å››ï¼Œé‡ç‚¹ä»‹ç»å½“å‰æ–¹æ³•çš„ä¸€äº›æ½œåœ¨ä¸è¶³å’Œæœªæ¥çš„å‡ ä¸ªå‘å±•æ–¹å‘ã€‚</p><p><img data-src="https://s2.loli.net/2024/06/18/rWKxDdeUG4nSJRO.png" alt="image-20240618230157030"></p><p>åŸŸ D ç”±ç‰¹å¾ç©ºé—´ X å’Œè¾¹é™…æ¦‚ç‡åˆ†å¸ƒ P(X) ç»„æˆï¼Œå…¶ä¸­ X = {x1, ., xn}âˆˆ Xã€‚ç»™å®šä¸€ä¸ªç‰¹å®šçš„åŸŸ D = {X , P(X )}ï¼Œä»»åŠ¡ T ç”±ä¸€ä¸ªç‰¹å¾ç©ºé—´ Y å’Œä¸€ä¸ªå®¢è§‚é¢„æµ‹å‡½æ•° f( - ) ç»„æˆï¼Œä»æ¦‚ç‡è®ºçš„è§’åº¦æ¥çœ‹ï¼Œf( - ) ä¹Ÿå¯ä»¥çœ‹ä½œæ˜¯æ¡ä»¶æ¦‚ç‡åˆ†å¸ƒ P(Y|X)ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬å¯ä»¥ä»æ ‡æ³¨æ•°æ® {xi, yi}ï¼ˆå…¶ä¸­ xiâˆˆX å’Œ yiâˆˆY ï¼‰ä¸­ä»¥æœ‰ç›‘ç£çš„æ–¹å¼å­¦ä¹  P(Y|X)ã€‚</p><p>å‡è®¾æœ‰ä¸¤ä¸ªåŸŸï¼šæœ‰è¶³å¤Ÿæ ‡æ³¨æ•°æ®çš„è®­ç»ƒæ•°æ®é›†æ˜¯æºåŸŸ Ds = {X s, P(X )s}, æœ‰<strong>å°‘é‡æ ‡æ³¨æ•°æ®æˆ–æ— æ ‡æ³¨æ•°æ®çš„æµ‹è¯•æ•°æ®é›†æ˜¯ç›®æ ‡åŸŸ Dt = {X t , P(X )t }</strong>ã€‚éƒ¨åˆ†æ ‡æ³¨çš„éƒ¨åˆ† Dtl å’Œæœªæ ‡æ³¨çš„éƒ¨åˆ† Dtu æ„æˆäº†æ•´ä¸ªç›®æ ‡åŸŸï¼Œå³ Dt = Dtl âˆª Dtuã€‚æ¯ä¸ªåŸŸéƒ½æœ‰å…¶ä»»åŠ¡ï¼šå‰è€…ä¸º T s = {Ys, P(Y s|Xs )}, åè€…ä¸º T t = {Yt , P(Y t |Xt )} ã€‚</p><p>åŒæ ·ï¼ŒP(Ys|Xs) å¯ä»¥ä»æºæ ‡ç­¾æ•°æ® {xs i , ys i } ä¸­å­¦ä¹ ï¼Œè€Œ P(Yt|Xt) å¯ä»¥ä»æ ‡ç­¾ç›®æ ‡æ•°æ® {xtl i , ytl i } å’Œéæ ‡ç­¾æ•°æ® {xtu i } ä¸­å­¦ä¹ ã€‚</p><p>å¯¹DAæ–¹æ³•è¿›è¡Œåˆ†ç±»</p><blockquote><p>åœ¨åŒè´¨æ•°æ®ä¸­ï¼ŒæºåŸŸå’Œç›®æ ‡åŸŸä¹‹é—´çš„ç‰¹å¾ç©ºé—´æ˜¯ç›¸åŒçš„ï¼ˆX s = X tï¼‰ï¼Œç»´åº¦ä¹Ÿç›¸åŒï¼ˆds = dtï¼‰ã€‚å› æ­¤ï¼Œæºæ•°æ®é›†å’Œç›®æ ‡æ•°æ®é›†çš„æ•°æ®åˆ†å¸ƒä¸€èˆ¬æ˜¯ä¸åŒçš„ï¼ˆP(X)s = P(X)tï¼‰ã€‚</p><p>åœ¨å¼‚æ„æ•°æ®ä¸­ï¼ŒæºåŸŸå’Œç›®æ ‡åŸŸä¹‹é—´çš„ç‰¹å¾ç©ºé—´æ˜¯ä¸ç­‰åŒçš„ï¼ˆX s = X tï¼‰ï¼Œç»´åº¦ä¸€èˆ¬ä¹Ÿå¯èƒ½ä¸åŒï¼ˆds = dtï¼‰ã€‚</p></blockquote><p>æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å°†åŒè´¨ DA è®¾ç½®è¿›ä¸€æ­¥åˆ†ä¸ºä¸‰ç§æƒ…å†µï¼š</p><ol><li><p>åœ¨æœ‰ç›‘ç£çš„ DA ä¸­ï¼Œå­˜åœ¨å°‘é‡æœ‰æ ‡ç­¾çš„ç›®æ ‡æ•°æ®ï¼ˆD^tl^ï¼‰ã€‚ç„¶è€Œï¼Œæ ‡ç­¾æ•°æ®é€šå¸¸ä¸è¶³ä»¥å®Œæˆä»»åŠ¡ã€‚</p></li><li><p>åœ¨åŠç›‘ç£ DA ä¸­ï¼Œè®­ç»ƒé˜¶æ®µæ—¢æœ‰æœ‰é™çš„ç›®æ ‡åŸŸæ ‡è®°æ•°æ®ï¼ˆD^tl^ï¼‰ï¼Œä¹Ÿæœ‰å†—ä½™çš„éæ ‡è®°æ•°æ®ï¼ˆD^tu^ï¼‰ï¼Œè¿™ä½¿å¾—ç½‘ç»œå¯ä»¥å­¦ä¹ ç›®æ ‡åŸŸçš„ç»“æ„ä¿¡æ¯ã€‚</p></li><li><p>åœ¨æ— ç›‘ç£ DA ä¸­ï¼Œè®­ç»ƒç½‘ç»œæ—¶æ— æ³•è§‚å¯Ÿåˆ°æœ‰æ ‡ç­¾ä½†è¶³å¤Ÿå¤šçš„æ— æ ‡ç­¾ç›®æ ‡åŸŸæ•°æ®ï¼ˆD^tu^ï¼‰</p></li></ol><p>ä¸åŒè´¨ç±»ä¼¼ï¼Œå¼‚è´¨ä¹Ÿå¯åˆ†ä¸ºæœ‰ç›‘ç£ã€åŠç›‘ç£å’Œæ— ç›‘ç£ã€‚</p><p>ä¸Šè¿°æ‰€æœ‰ DA è®¾ç½®éƒ½å‡å®šæºé¢†åŸŸå’Œç›®æ ‡é¢†åŸŸç›´æ¥ç›¸å…³ï¼Œå› æ­¤ï¼ŒçŸ¥è¯†è½¬ç§»åªéœ€ä¸€æ­¥å³å¯å®Œæˆã€‚æˆ‘ä»¬ç§°å…¶ä¸ºä¸€æ­¥å¼è®¾è®¡ã€‚</p><p><img data-src="https://s2.loli.net/2024/06/30/sP3IEinJu1cg2tm.png" alt="image-20240630194001836"></p><p>ç„¶è€Œï¼Œåœ¨ç°å®ä¸­ï¼Œè¿™ä¸€å‡è®¾å¶å°”ä¹Ÿä¼šè½ç©ºã€‚ä¸¤ä¸ªåŸŸä¹‹é—´å‡ ä¹æ²¡æœ‰é‡å ï¼Œå› æ­¤æ‰§è¡Œå•æ­¥ DA å°†ä¸ä¼šæœ‰æ•ˆã€‚å¹¸è¿çš„æ˜¯ï¼Œæœ‰ä¸€äº›ä¸­é—´åŸŸèƒ½å¤Ÿæ‹‰è¿‘æºåŸŸå’Œç›®æ ‡åŸŸä¹‹é—´çš„è·ç¦»ã€‚ä½¿ç”¨ä¸€ç³»åˆ—ä¸­é—´æ¡¥æ¢æ¥è¿æ¥ä¸¤ä¸ªçœ‹ä¼¼ä¸ç›¸å…³çš„åŸŸï¼Œç„¶åé€šè¿‡è¯¥æ¡¥æ¢æ‰§è¡Œä¸€æ­¥å¼ DA,è¿™å°±æ˜¯å¤šæ­¥å¼ï¼ˆæˆ–åå¼ï¼‰DA .ä¾‹å¦‚,äººè„¸å›¾åƒå’Œè½¦è¾†å›¾åƒç”±äºå½¢çŠ¶æˆ–å…¶ä»–æ–¹é¢çš„ä¸åŒè€Œäº’ä¸ç›¸ä¼¼,å› æ­¤å•æ­¥æ£€æµ‹ä¼šå¤±è´¥.ä½†æ˜¯,å¯ä»¥å¼•å…¥ä¸€äº›ä¸­é—´å›¾åƒï¼Œå¦‚ â€œè¶³çƒå¤´ç›”â€,ä½œä¸ºä¸­é—´åŸŸ,ä»è€Œé¡ºåˆ©å®ç°çŸ¥è¯†è½¬ç§».</p><p>ä»å¹¿ä¹‰ä¸Šè®²ï¼Œæ·±åº¦ DA æ˜¯ä¸€ç§åˆ©ç”¨æ·±åº¦ç½‘ç»œæé«˜ DA æ€§èƒ½çš„æ–¹æ³•ã€‚æ ¹æ®è¿™ä¸€å®šä¹‰ï¼Œå…·æœ‰æ·±åº¦ç‰¹å¾çš„æµ…å±‚æ–¹æ³•å¯è§†ä¸ºæ·±åº¦ DA æ–¹æ³•ã€‚æµ…å±‚æ–¹æ³•é‡‡ç”¨ DAï¼Œè€Œæ·±åº¦ç½‘ç»œåªèƒ½æå–çŸ¢é‡ç‰¹å¾ï¼Œæ— åŠ©äºç›´æ¥ä¼ é€’çŸ¥è¯†ã€‚ä¾‹å¦‚ï¼ŒLu ç­‰äººä» CNN ä¸­æå–å·ç§¯æ¿€æ´»ä½œä¸ºå¼ é‡è¡¨ç¤ºï¼Œç„¶åè¿›è¡Œå¼ é‡å¯¹é½ã€‚</p><p>ä»ç‹­ä¹‰ä¸Šè®²ï¼Œæ·±åº¦ DA åŸºäºä¸“ä¸º DA è®¾è®¡çš„æ·±åº¦å­¦ä¹ æ¶æ„ï¼Œå¯ä»¥é€šè¿‡åå‘ä¼ æ’­ä»æ·±åº¦ç½‘ç»œä¸­è·å¾—ç¬¬ä¸€æ‰‹æ•ˆæœã€‚å…¶ç›´è§‚æ€è·¯æ˜¯<strong>å°† DA åµŒå…¥åˆ°å­¦ä¹ è¡¨å¾çš„è¿‡ç¨‹ä¸­ï¼Œå­¦ä¹ ä¸€ç§æ—¢æœ‰è¯­ä¹‰æ„ä¹‰åˆæœ‰é¢†åŸŸä¸å˜æ€§çš„æ·±åº¦ç‰¹å¾è¡¨å¾ã€‚æœ‰äº† â€œå¥½ â€œçš„ç‰¹å¾è¡¨ç¤ºï¼Œç›®æ ‡ä»»åŠ¡çš„æ€§èƒ½å°±ä¼šæ˜¾è‘—æé«˜</strong>ã€‚</p><p>ä¸€æ­¥å¼æ•°æ®é‡‡é›†çš„æ·±åº¦æ–¹æ³•å¯å½’çº³ä¸ºä¸‰ç§æƒ…å†µ.</p><p>ç¬¬ä¸€ç§æƒ…å†µæ˜¯<strong>åŸºäºå·®å¼‚(Discrepancy-based)</strong>çš„æ·±åº¦æ•°æ®æŒ–æ˜æ–¹æ³•,è¯¥æ–¹æ³•<strong>å‡å®šç”¨æ ‡æ³¨æˆ–æœªæ ‡æ³¨çš„ç›®æ ‡æ•°æ®å¾®è°ƒæ·±åº¦ç½‘ç»œæ¨¡å‹å¯ä»¥å‡å°‘ä¸¤ä¸ªåŸŸä¹‹é—´çš„åç§»</strong>.ç±»åˆ¤æ®(class criterion)ã€ç»Ÿè®¡åˆ¤æ®(statistic criterion)ã€æ¶æ„åˆ¤æ®(architecture criterion)å’Œå‡ ä½•åˆ¤æ®(geometric criterion)æ˜¯è¿›è¡Œå¾®è°ƒçš„å››ç§ä¸»è¦æŠ€æœ¯ã€‚</p><p><strong>class criterion</strong>:ä½¿ç”¨ç±»æ ‡ç­¾ä¿¡æ¯ä½œä¸ºåœ¨ä¸åŒé¢†åŸŸé—´è½¬ç§»çŸ¥è¯†çš„æŒ‡å—.åœ¨æœ‰ç›‘ç£çš„æ•°æ®åˆ†æä¸­,å½“ç›®æ ‡é¢†åŸŸçš„æ ‡ç­¾æ ·æœ¬å¯ç”¨æ—¶,è½¯æ ‡ç­¾å’Œåº¦é‡å­¦ä¹ æ€»æ˜¯æœ‰æ•ˆçš„.å½“æ— æ³•è·å¾—æ­¤ç±»æ ·æœ¬æ—¶,å¯é‡‡ç”¨å…¶ä»–ä¸€äº›æŠ€æœ¯æ¥æ›¿ä»£ç±»æ ‡ç­¾æ•°æ®,å¦‚ä¼ªæ ‡ç­¾å’Œå±æ€§è¡¨ç¤ºæ³•.</p><p><strong>statistic criterion</strong>:åˆ©ç”¨æŸäº›æœºåˆ¶å¯¹æºåŸŸå’Œç›®æ ‡åŸŸä¹‹é—´çš„ç»Ÿè®¡åˆ†å¸ƒåç§»è¿›è¡Œé…å‡†ã€‚æœ€å¸¸ç”¨çš„æ¯”è¾ƒå’Œå‡å°‘åˆ†å¸ƒåç§»çš„æ–¹æ³•æœ‰æœ€å¤§å‡å€¼å·®å¼‚ï¼ˆMMDï¼‰ã€ç›¸å…³å¯¹é½ï¼ˆCORALï¼‰ã€KullbackLeiblerå‘æ•£å’Œ H å‘æ•£ç­‰ã€‚</p><p><strong>Architecture criterion</strong>:è¿™äº›æŠ€æœ¯æ—¨åœ¨é€šè¿‡è°ƒæ•´æ·±åº¦ç½‘ç»œçš„æ¶æ„ï¼Œæé«˜å­¦ä¹ æ›´å¤šå¯è¿ç§»ç‰¹å¾çš„èƒ½åŠ›ã€‚å·²è¢«è¯æ˜å…·æœ‰æˆæœ¬æ•ˆç›Šçš„æŠ€æœ¯åŒ…æ‹¬è‡ªé€‚åº”æ‰¹é‡å½’ä¸€åŒ–ï¼ˆBNï¼‰ã€å¼±ç›¸å…³æƒé‡ã€åŸŸå¼•å¯¼å‰”é™¤ç­‰ã€‚</p><p><strong>Geometric criterion</strong>:æ ¹æ®æºåŸŸå’Œç›®æ ‡åŸŸçš„å‡ ä½•ç‰¹æ€§å°†å…¶è¿æ¥èµ·æ¥ã€‚è¿™ä¸€æ ‡å‡†å‡å®šå‡ ä½•ç»“æ„çš„å…³ç³»å¯ä»¥å‡å°‘åŸŸçš„åç§».</p><p>ç¬¬äºŒç§æƒ…å†µå¯ç§°ä¸º<strong>åŸºäºå¯¹æŠ—(Adversarial-based)çš„æ·±åº¦ DA æ–¹æ³•</strong>ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ<strong>ä¼šä½¿ç”¨ä¸€ä¸ªé¢†åŸŸåˆ¤åˆ«å™¨æ¥å¯¹æ•°æ®ç‚¹æ˜¯æ¥è‡ªæºé¢†åŸŸè¿˜æ˜¯ç›®æ ‡é¢†åŸŸè¿›è¡Œåˆ†ç±»</strong>ï¼Œé€šè¿‡å¯¹æŠ—ç›®æ ‡æ¥é¼“åŠ±é¢†åŸŸæ··æ·†ï¼Œä»è€Œä½¿ç»éªŒæºæ˜ å°„åˆ†å¸ƒå’Œç›®æ ‡æ˜ å°„åˆ†å¸ƒä¹‹é—´çš„è·ç¦»æœ€å°åŒ–ã€‚</p><p>æ­¤å¤–ï¼Œæ ¹æ®æ˜¯å¦å­˜åœ¨ç”Ÿæˆæ¨¡å‹ï¼ŒåŸºäºå¯¹æŠ—çš„æ·±åº¦æ•°æ®æŒ–æ˜æ–¹æ³•å¯åˆ†ä¸ºä¸¤ç§æƒ…å†µã€‚</p><p><strong>ç”Ÿæˆæ¨¡å‹</strong>ï¼šå°†åˆ¤åˆ«æ¨¡å‹ä¸ä¸€èˆ¬åŸºäºç”Ÿæˆå¯¹æŠ—ç½‘ç»œï¼ˆGANï¼‰çš„ç”Ÿæˆç»„ä»¶ç›¸ç»“åˆã€‚å…¶ä¸­ä¸€ç§å…¸å‹æƒ…å†µæ˜¯ä½¿ç”¨æºå›¾åƒã€å™ªå£°çŸ¢é‡æˆ–ä¸¤è€…ç”Ÿæˆä¸ç›®æ ‡æ ·æœ¬ç›¸ä¼¼çš„æ¨¡æ‹Ÿæ ·æœ¬ï¼Œå¹¶ä¿ç•™æºåŸŸçš„æ³¨é‡Šä¿¡æ¯ã€‚</p><p><strong>éç”Ÿæˆæ¨¡å‹</strong>ï¼šç‰¹å¾æå–å™¨ä¸æ˜¯åˆ©ç”¨è¾“å…¥å›¾åƒåˆ†å¸ƒç”Ÿæˆæ¨¡å‹ï¼Œè€Œæ˜¯åˆ©ç”¨æºåŸŸä¸­çš„æ ‡ç­¾å­¦ä¹ åˆ¤åˆ«è¡¨å¾ï¼Œå¹¶é€šè¿‡åŸŸæ··æ·†æŸå¤±å°†ç›®æ ‡æ•°æ®æ˜ å°„åˆ°åŒä¸€ç©ºé—´ï¼Œä»è€Œå¾—åˆ°åŸŸä¸å˜è¡¨å¾.</p><p>ç¬¬ä¸‰ç§æƒ…å†µå¯ç§°ä¸º<strong>åŸºäºé‡æ„(Reconstruction-based)</strong>çš„ DA æ–¹æ³•ï¼Œå®ƒå‡å®šæºæ ·æœ¬æˆ–ç›®æ ‡æ ·æœ¬çš„æ•°æ®é‡æ„æœ‰åŠ©äºæé«˜ DA çš„æ€§èƒ½ã€‚é‡æ„å™¨æ—¢èƒ½ç¡®ä¿åŸŸå†…è¡¨å¾çš„ç‰¹å¼‚æ€§ï¼Œåˆèƒ½ç¡®ä¿åŸŸé—´è¡¨å¾çš„ä¸å¯åˆ†æ€§ã€‚</p><ul><li>ç¼–ç å™¨-è§£ç å™¨é‡æ„ï¼šé€šè¿‡ä½¿ç”¨å †å è‡ªåŠ¨ç¼–ç å™¨ï¼ˆSAEï¼‰ï¼Œç¼–ç å™¨-è§£ç å™¨é‡æ„æ–¹æ³•å°†ç”¨äºè¡¨å¾å­¦ä¹ çš„ç¼–ç å™¨ç½‘ç»œä¸ç”¨äºæ•°æ®é‡æ„çš„è§£ç å™¨ç½‘ç»œç»“åˆèµ·æ¥.</li><li>å¯¹æŠ—é‡æ„ï¼šé‡æ„è¯¯å·®æ˜¯é€šè¿‡ GAN è¯†åˆ«å™¨ï¼ˆå¦‚ dual GANã€cycle GANå’Œ disco GANï¼‰è·å¾—çš„å¾ªç¯æ˜ å°„æµ‹é‡çš„æ¯ä¸ªå›¾åƒåŸŸå†…é‡æ„å›¾åƒä¸åŸå§‹å›¾åƒä¹‹é—´çš„å·®å¼‚ã€‚</li></ul><p>åœ¨å¤šæ­¥éª¤ DA ä¸­ï¼Œ<strong>æˆ‘ä»¬é¦–å…ˆè¦ç¡®å®šä¸æºåŸŸå’Œç›®æ ‡åŸŸçš„å…³ç³»æ¯”ç›´æ¥è”ç³»æ›´å¯†åˆ‡çš„ä¸­é—´åŸŸã€‚å…¶æ¬¡ï¼ŒçŸ¥è¯†è½¬ç§»è¿‡ç¨‹å°†åœ¨æºåŸŸã€ä¸­é—´åŸŸå’Œç›®æ ‡åŸŸä¹‹é—´ä»¥è¾ƒå°‘ä¿¡æ¯æŸå¤±çš„æ–¹å¼é€šè¿‡ä¸€æ­¥ DA å®Œæˆ</strong>ã€‚å› æ­¤ï¼Œå¤šæ­¥éª¤ DA çš„å…³é”®åœ¨äºå¦‚ä½•é€‰æ‹©å’Œåˆ©ç”¨ä¸­é—´åŸŸï¼›æ­¤å¤–ï¼Œæ ¹æ®æ–‡çŒ®ï¼Œå®ƒå¯ä»¥åˆ†ä¸ºä¸‰ç±»ï¼šæ‰‹å·¥é€‰æ‹©æœºåˆ¶ã€åŸºäºç‰¹å¾çš„é€‰æ‹©æœºåˆ¶å’ŒåŸºäºè¡¨å¾çš„é€‰æ‹©æœºåˆ¶ã€‚</p><p><strong>Hand-crafted</strong>ï¼šç”¨æˆ·æ ¹æ®ç»éªŒç¡®å®šä¸­é—´åŸŸ</p><p><strong>Instance-based</strong>ï¼šä»è¾…åŠ©æ•°æ®é›†ä¸­é€‰æ‹©æŸäº›éƒ¨åˆ†çš„æ•°æ®æ¥ç»„æˆä¸­é—´åŸŸï¼Œä»¥è®­ç»ƒæ·±åº¦ç½‘ç»œ</p><p><strong>Representation-based</strong>ï¼šé€šè¿‡å†»ç»“å…ˆå‰è®­ç»ƒå¥½çš„ç½‘ç»œ,å¹¶å°†å…¶ä¸­é—´è¡¨å¾ä½œä¸ºæ–°ç½‘ç»œçš„è¾“å…¥,å¯ä»¥å®ç°è½¬ç§»</p><h4 id="Discrepancy-based-approaches"><a href="#Discrepancy-based-approaches" class="headerlink" title="Discrepancy-based approaches"></a>Discrepancy-based approaches</h4><p>Yosinski ç­‰äººè¯æ˜,ç”±äºè„†å¼±çš„å…±é€‚åº”æ€§å’Œè¡¨å¾ç‰¹å¼‚æ€§,æ·±åº¦ç½‘ç»œå­¦ä¹ åˆ°çš„å¯è¿ç§»ç‰¹å¾å…·æœ‰å±€é™æ€§,è€Œå¾®è°ƒå¯ä»¥æé«˜æ³›åŒ–æ€§èƒ½.å¾®è°ƒï¼ˆä¹Ÿå¯è§†ä¸ºåŸºäºå·®å¼‚çš„æ·±åº¦æ•°æ®æŒ–æ˜æ–¹æ³•ï¼‰æ˜¯<strong>ç”¨æºæ•°æ®è®­ç»ƒåŸºç¡€ç½‘ç»œ,ç„¶åç›´æ¥é‡ç”¨å‰ n å±‚æ¥æ„å»ºç›®æ ‡ç½‘ç»œ</strong>.<strong>ç›®æ ‡ç½‘ç»œçš„å…¶ä½™å±‚æ˜¯éšæœºåˆå§‹åŒ–çš„,å¹¶æ ¹æ®å·®å¼‚æŸå¤±è¿›è¡Œè®­ç»ƒ</strong>.åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­,å¯ä»¥æ ¹æ®ç›®æ ‡æ•°æ®é›†çš„å¤§å°åŠå…¶ä¸æºæ•°æ®é›†çš„ç›¸ä¼¼åº¦,å¯¹ç›®æ ‡ç½‘ç»œçš„å‰ n å±‚è¿›è¡Œå¾®è°ƒæˆ–å†»ç»“ã€‚</p><h5 id="class-criterion"><a href="#class-criterion" class="headerlink" title="class criterion"></a>class criterion</h5><p>ç±»æ ‡å‡†æ˜¯æ·±åº¦ DA ä¸­æœ€åŸºæœ¬çš„è®­ç»ƒæŸè€—ã€‚<strong>åœ¨ä½¿ç”¨æºæ•°æ®å¯¹ç½‘ç»œè¿›è¡Œé¢„è®­ç»ƒåï¼Œç›®æ ‡æ¨¡å‹çš„å…¶ä½™å„å±‚å°†ç±»æ ‡ç­¾ä¿¡æ¯ä½œä¸ºè®­ç»ƒç½‘ç»œçš„æŒ‡å—</strong>ã€‚å› æ­¤ï¼Œå‡å®šå¯ä»¥ä»ç›®æ ‡æ•°æ®é›†ä¸­è·å¾—å°‘é‡å¸¦æ ‡ç­¾çš„æ ·æœ¬ã€‚ç†æƒ³æƒ…å†µä¸‹ï¼Œç±»æ ‡ç­¾ä¿¡æ¯åœ¨æœ‰ç›‘ç£çš„æ•°æ®åˆ†æä¸­ç›´æ¥ç»™å‡ºã€‚å¤§å¤šæ•°å·¥ä½œé€šå¸¸ä½¿ç”¨åœ°é¢çœŸå®ç±»çš„è´Ÿå¯¹æ•°ä¼¼ç„¶ä¸ softmax ä½œä¸ºè®­ç»ƒæŸå¤±ï¼Œå³ L = - âˆ‘N i=0 yi log Ë† yiï¼ˆË† yi æ˜¯æ¨¡å‹çš„ softmax é¢„æµ‹ï¼Œä»£è¡¨ç±»æ¦‚ç‡ï¼‰</p><p><img data-src="https://s2.loli.net/2024/06/30/5U4korDjOX1diuP.png" alt="image-20240630221825042"></p><p>å— Tzeng ç­‰äººçš„å¯å‘ï¼Œ é€šè¿‡åŒæ—¶æœ€å°åŒ–é¢†åŸŸæ··æ·†æŸå¤±ï¼ˆå±äºåŸºäºå¯¹æŠ—çš„æ–¹æ³•ï¼‰å’Œè½¯æ ‡ç­¾æŸå¤±ï¼Œå¯¹ç½‘ç»œè¿›è¡Œäº†å¾®è°ƒã€‚ä½¿ç”¨è½¯æ ‡ç­¾è€Œä¸æ˜¯ç¡¬æ ‡ç­¾å¯ä»¥ä¿æŒè·¨åŸŸç±»ä¹‹é—´çš„å…³ç³»ã€‚Gebru ç­‰äººåœ¨çš„åŸºç¡€ä¸Šä¿®æ”¹äº†ç°æœ‰çš„é€‚åº”ç®—æ³•ï¼Œåœ¨ç»†ç²’åº¦çš„ç±»çº§åˆ« Lcsoft å’Œå±æ€§çº§åˆ« Lasoft ä¸Šä½¿ç”¨äº†è½¯æ ‡ç­¾æŸå¤±ã€‚</p><p>é™¤äº† softmax æŸå¤±å¤–ï¼Œè¿˜æœ‰å…¶ä»–æ–¹æ³•å¯ç”¨ä½œè®­ç»ƒæŸå¤±ï¼Œä»¥å¾®è°ƒæœ‰ç›‘ç£ DA ä¸­çš„ç›®æ ‡æ¨¡å‹ã€‚æ·±åº¦ç½‘ç»œä¸­çš„åµŒå…¥åº¦é‡å­¦ä¹ æ˜¯å¦ä¸€ç§æ–¹æ³•ï¼Œå®ƒå¯ä»¥ä½¿æ¥è‡ªä¸åŒé¢†åŸŸã€å…·æœ‰ç›¸åŒæ ‡ç­¾çš„æ ·æœ¬è·ç¦»æ›´è¿‘ï¼Œè€Œå…·æœ‰ä¸åŒæ ‡ç­¾çš„æ ·æœ¬è·ç¦»æ›´è¿œã€‚åŸºäºè¿™ä¸€æ€æƒ³æ„å»ºäº†<strong>ç›¸åº”çš„è¯­ä¹‰å¯¹é½æŸå¤±å’Œåˆ†ç¦»æŸå¤±</strong>ã€‚Hu ç­‰äººæå‡ºäº†æ·±åº¦è½¬ç§»åº¦é‡å­¦ä¹ ï¼Œå®ƒåº”ç”¨äº†è¾¹é™…è´¹é›ªåˆ†æå‡†åˆ™å’Œ MMD å‡†åˆ™.</p><p>ç„¶è€Œï¼Œå¦‚æœç›®æ ‡åŸŸä¸­æ²¡æœ‰ç›´æ¥çš„ç±»æ ‡ç­¾ä¿¡æ¯ï¼Œæˆ‘ä»¬è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿä¼—æ‰€å‘¨çŸ¥ï¼Œäººç±»å¯ä»¥ä»…å‡­é«˜å±‚æ¬¡çš„æè¿°æ¥è¯†åˆ«æœªè§è¿‡çš„ç±»ã€‚ä¾‹å¦‚ï¼Œå½“æˆ‘ä»¬å¾—åˆ° â€œé«˜å¤§çš„æ£•è‰²é•¿é¢ˆåŠ¨ç‰© â€œçš„æè¿°æ—¶ï¼Œæˆ‘ä»¬å°±èƒ½è¯†åˆ«å‡ºé•¿é¢ˆé¹¿ã€‚ä¸ºäº†æ¨¡ä»¿äººç±»çš„èƒ½åŠ›ï¼Œä¸ºæ¯ä¸ªç±»å¼•å…¥äº†é«˜çº§è¯­ä¹‰å±æ€§ã€‚å‡è®¾ a^c^ = (a^c^~1~, â€¦ , a^c^~m~ ) æ˜¯ c ç±»çš„å±æ€§è¡¨ç¤ºï¼Œå®ƒå…·æœ‰å›ºå®šé•¿åº¦çš„äºŒè¿›åˆ¶å€¼ï¼Œåœ¨æ‰€æœ‰ç±»ä¸­æœ‰ m ä¸ªå±æ€§.åˆ†ç±»å™¨ä¸ºæ¯ä¸ªå±æ€§ a^m^ æä¾› p(a^m^|x) çš„ä¼°è®¡å€¼</p><p><strong>Statistic criterion</strong></p><p>è™½ç„¶æœ‰äº›åŸºäºå·®å¼‚çš„æ–¹æ³•ä¼š<strong>å¯»æ‰¾ä¼ªæ ‡ç­¾ã€å±æ€§æ ‡ç­¾æˆ–å…¶ä»–æ ‡ç­¾ç›®æ ‡æ•°æ®çš„æ›¿ä»£å“</strong>ï¼Œä½†æ›´å¤šçš„å·¥ä½œä¾§é‡äºåœ¨<strong>æ— ç›‘ç£ DA ä¸­é€šè¿‡æœ€å°åŒ–åŸŸåˆ†å¸ƒå·®å¼‚æ¥å­¦ä¹ åŸŸä¸å˜è¡¨ç¤º</strong>ã€‚MMD æ˜¯é€šè¿‡æ ¸åŒæ ·æœ¬æµ‹è¯•æ¯”è¾ƒä¸¤ä¸ªæ•°æ®é›†åˆ†å¸ƒçš„æœ‰æ•ˆæŒ‡æ ‡ã€‚</p><script type="math/tex; mode=display">MMD^{2}(s,t)=\sup_{\|\phi\|_{\mathcal{H}}\leq1}\left\|E_{x^{s}\sim s}[\phi(x^{s})]-E_{x^{t}\sim s}[\phi(x^{t})]\right\|_{\mathcal{H}}^{2}</script><p>åœ¨æ­¤åŸºç¡€ä¸Šï¼ŒGhifary ç­‰äººæå‡ºäº†ä¸€ç§æ¨¡å‹ï¼Œåœ¨å•éšå±‚å‰é¦ˆç¥ç»ç½‘ç»œä¸­å¼•å…¥ MMD æŒ‡æ ‡ã€‚MMD æŒ‡æ ‡åœ¨æ¯ä¸ªåŸŸçš„è¡¨å¾ä¹‹é—´è¿›è¡Œè®¡ç®—ï¼Œä»¥å‡å°‘æ½œåœ¨ç©ºé—´ä¸­çš„åˆ†å¸ƒå¤±é…ã€‚</p><script type="math/tex; mode=display">MMD^2(D_s,D_t)=\left\|\frac{1}{M}\sum_{i=1}^M\phi(x_i^s)-\frac{1}{N}\sum_{j=1}^N\phi(x_j^t)\right\|_H^2</script><p>Long ç­‰äººæ²¡æœ‰ä½¿ç”¨å•å±‚å’Œçº¿æ€§ MMDï¼Œè€Œæ˜¯æå‡ºäº†æ·±åº¦é€‚åº”ç½‘ç»œ (DAN)ï¼Œé€šè¿‡æ·»åŠ å¤šä¸ªé€‚åº”å±‚å’Œæ¢ç´¢å¤šä¸ªå†…æ ¸æ¥åŒ¹é…è·¨åŸŸè¾¹é™…åˆ†å¸ƒçš„å˜åŒ–ï¼ŒåŒæ—¶å‡è®¾æ¡ä»¶åˆ†å¸ƒä¿æŒä¸å˜ï¼ˆå›¾ 6ï¼‰ã€‚ç„¶è€Œï¼Œåœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™ä¸€å‡è®¾ç›¸å½“å¼ºï¼›æ¢å¥è¯è¯´ï¼Œæºåˆ†ç±»å™¨ä¸èƒ½ç›´æ¥ç”¨äºç›®æ ‡åŸŸã€‚ä¸ºäº†ä½¿å…¶æ›´å…·é€šç”¨æ€§ï¼Œè”åˆé€‚åº”ç½‘ç»œï¼ˆJANï¼‰åŸºäºè”åˆæœ€å¤§å‡å€¼å·®å¼‚ï¼ˆJMMDï¼‰å‡†åˆ™ï¼Œåœ¨å¤šä¸ªç‰¹å®šé¢†åŸŸå±‚ä¸­è°ƒæ•´è¾“å…¥ç‰¹å¾å’Œè¾“å‡ºæ ‡ç­¾è”åˆåˆ†å¸ƒçš„åç§»ã€‚Zhang ç­‰äººæå‡ºäº† DTNï¼Œå…¶ä¸­è¾¹é™…åˆ†å¸ƒå’Œæ¡ä»¶åˆ†å¸ƒéƒ½æ ¹æ® MMD è¿›è¡ŒåŒ¹é…ã€‚</p><p>å¦‚æœ Ï† æ˜¯ç‰¹å¾æ ¸ï¼ˆå³é«˜æ–¯æ ¸æˆ–æ‹‰æ™®æ‹‰æ–¯æ ¸ï¼‰ï¼ŒMMD å°†æ¯”è¾ƒæ‰€æœ‰é˜¶æ¬¡çš„ç»Ÿè®¡é‡çŸ©ã€‚ä¸ MMD ä¸åŒï¼ŒCORALå­¦ä¹ çš„æ˜¯ä¸€ç§çº¿æ€§å˜æ¢ï¼Œå®ƒèƒ½ä½¿åŸŸä¹‹é—´çš„äºŒé˜¶ç»Ÿè®¡é‡ä¿æŒä¸€è‡´ã€‚Sun å’Œ Saenko åˆ©ç”¨éçº¿æ€§å˜æ¢å°† CORAL æ‰©å±•åˆ°æ·±åº¦ç¥ç»ç½‘ç»œï¼ˆæ·±åº¦ CORALï¼‰ã€‚</p><script type="math/tex; mode=display">\mathcal{L}_{\mathrm{CORAL}}=\frac{1}{4d^{2}}\|C_{S}-C_{T}\|_{F}^{2}</script><p>å…¶ä¸­ï¼Œâ€–-â€–F^2^ è¡¨ç¤ºçŸ©é˜µå¼—ç½—è´å°¼æ–¯å‡†åˆ™å¹³æ–¹ã€‚C~S~ å’Œ C~T~ åˆ†åˆ«è¡¨ç¤ºæºæ•°æ®å’Œç›®æ ‡æ•°æ®çš„åæ–¹å·®çŸ©é˜µã€‚</p><p><strong>Architecture criterion</strong></p><p>å…¶ä»–ä¸€äº›æ–¹æ³•åˆ™ä¼šä¼˜åŒ–ç½‘ç»œæ¶æ„ï¼Œä½¿åˆ†å¸ƒå·®å¼‚æœ€å°åŒ–ã€‚è¿™ç§é€‚åº”è¡Œä¸ºå¯ä»¥åœ¨å¤§å¤šæ•°æ·±åº¦ DA æ¨¡å‹ä¸­å®ç°ï¼Œå¦‚ç›‘ç£å’Œéç›‘ç£è®¾ç½®ã€‚Rozantsev ç­‰äººè®¤ä¸ºï¼Œå¯¹åº”å±‚çš„æƒé‡ä¸æ˜¯å…±äº«çš„ï¼Œè€Œæ˜¯é€šè¿‡æƒé‡æ­£åˆ™åŒ–å™¨ rw( - ) è¿›è¡Œå…³è”ï¼Œä»¥è€ƒè™‘ä¸¤ä¸ªåŸŸçš„å·®å¼‚ã€‚</p><p><img data-src="https://s2.loli.net/2024/06/30/V3uX2QpSghyj8Bz.png" alt="image-20240630223652513"></p><p><strong>Geometric criterion</strong></p><p>å‡ ä½•å‡†åˆ™é€šè¿‡æ•´åˆä»æºåŸŸåˆ°ç›®æ ‡åŸŸçš„è·¯å¾„ä¸Šçš„ä¸­é—´å­ç©ºé—´æ¥å‡è½»åŸŸåç§»ã€‚</p><h4 id="Adversarial-based-approaches"><a href="#Adversarial-based-approaches" class="headerlink" title="Adversarial-based approaches"></a>Adversarial-based approaches</h4><p>GANè¿™é‡Œå°±ä¸ç»†è¯´äº†.</p><h5 id="Non-generative-models"><a href="#Non-generative-models" class="headerlink" title="Non-generative models"></a>Non-generative models</h5><p>æ·±åº¦DAçš„å…³é”®åœ¨äºä»æºæ ·æœ¬å’Œç›®æ ‡æ ·æœ¬ä¸­å­¦ä¹ ä¸é¢†åŸŸæ— å…³çš„è¡¨å¾ã€‚æœ‰äº†è¿™äº›è¡¨å¾ï¼Œä¸¤ä¸ªé¢†åŸŸçš„åˆ†å¸ƒå°±ä¼šè¶³å¤Ÿç›¸ä¼¼ï¼Œè¿™æ ·åˆ†ç±»å™¨å°±ä¼šè¢«éª—è¿‡ï¼Œå³ä½¿å®ƒæ˜¯åœ¨æºæ ·æœ¬ä¸Šè®­ç»ƒå‡ºæ¥çš„ï¼Œä¹Ÿèƒ½ç›´æ¥ç”¨äºç›®æ ‡é¢†åŸŸã€‚å› æ­¤ï¼Œè¡¨å¾æ˜¯å¦å­˜åœ¨é¢†åŸŸæ··æ·†å¯¹äºçŸ¥è¯†è¿ç§»è‡³å…³é‡è¦ã€‚å— GAN çš„å¯å‘å¼•å…¥äº†ç”±åˆ¤åˆ«å™¨äº§ç”Ÿçš„é¢†åŸŸæ··æ·†æŸå¤±ï¼Œä»¥æé«˜æ— ç”Ÿæˆå™¨çš„æ·±åº¦ DA æ€§èƒ½ã€‚</p><p>åŸŸå¯¹æŠ—ç¥ç»ç½‘ç»œï¼ˆDANNï¼‰å°†æ¢¯åº¦åè½¬å±‚ï¼ˆGRLï¼‰é›†æˆåˆ°æ ‡å‡†æ¶æ„ä¸­ï¼Œä»¥ç¡®ä¿ä¸¤ä¸ªåŸŸçš„ç‰¹å¾åˆ†å¸ƒç›¸ä¼¼ï¼‰ã€‚è¯¥ç½‘ç»œç”±å…±äº«ç‰¹å¾æå–å±‚å’Œä¸¤ä¸ªåˆ†ç±»å™¨ç»„æˆã€‚</p><p>DANN é€šè¿‡ä½¿ç”¨ GRL ä½¿åŸŸæ··æ·†æŸå¤±ï¼ˆæ‰€æœ‰æ ·æœ¬ï¼‰å’Œæ ‡ç­¾é¢„æµ‹æŸå¤±ï¼ˆæºæ ·æœ¬ï¼‰æœ€å°åŒ–ï¼ŒåŒæ—¶ä½¿åŸŸæ··æ·†æŸå¤±æœ€å¤§åŒ–ã€‚</p><p>ä¸ä¸Šè¿°æ–¹æ³•ç›¸æ¯”ï¼Œå¯¹æŠ—æ€§åˆ¤åˆ«åŸŸé€‚åº”ï¼ˆADDAï¼‰ é€šè¿‡å–æ¶ˆæƒé‡æ¥è€ƒè™‘ç‹¬ç«‹çš„æºå’Œç›®æ ‡æ˜ å°„ï¼Œç›®æ ‡æ¨¡å‹çš„å‚æ•°ç”±é¢„è®­ç»ƒçš„æºæ¨¡å‹åˆå§‹åŒ–ã€‚è¿™ç§æ–¹æ³•æ›´åŠ çµæ´»ï¼Œå› ä¸ºå¯ä»¥å­¦ä¹ æ›´å¤šç‰¹å®šé¢†åŸŸçš„ç‰¹å¾æå–ã€‚</p><p><img data-src="https://s2.loli.net/2024/06/30/7wux3qMtXFE8AlS.png" alt="image-20240630224001535"></p><h4 id="Reconstruction-based-approaches"><a href="#Reconstruction-based-approaches" class="headerlink" title="Reconstruction-based approaches"></a>Reconstruction-based approaches</h4><p>åœ¨ DA ä¸­ï¼Œæºæ ·æœ¬æˆ–ç›®æ ‡æ ·æœ¬çš„æ•°æ®é‡æ„æ˜¯ä¸€é¡¹è¾…åŠ©ä»»åŠ¡ï¼Œå®ƒåŒæ—¶ä¾§é‡äºåœ¨ä¸¤ä¸ªåŸŸä¹‹é—´åˆ›å»ºå…±äº«è¡¨å¾ï¼Œå¹¶ä¿æŒæ¯ä¸ªåŸŸçš„å„è‡ªç‰¹ç‚¹ã€‚</p><p><img data-src="https://s2.loli.net/2024/06/30/6xZTH9OQfjRpunr.png" alt="image-20240630224158266"></p><p>è¿™ç¯‡æ–‡ç« åˆ†äº†ä¸€ä¸ªåŒæ„å’Œå¼‚æ„çš„DAæ–¹æ³•,ä¸ªäººæ„Ÿè§‰å…¶å®æ²¡æœ‰å¤ªå¤§çš„å¿…è¦,ä¸‹é¢ç›´æ¥ä»‹ç».</p><p><img data-src="https://s2.loli.net/2024/06/30/JREocqfp8jiwLeP.png" alt="image-20240630230147062"></p><p><strong>ä¸€äº›æ–¹æ³•æ¯”è¾ƒ</strong></p><p><img data-src="https://s2.loli.net/2024/06/30/XtzFxWNyM5AC4ql.png" alt="image-20240630230339375"></p><h2 id="ä¸€äº›å…·ä½“å·¥ä½œ"><a href="#ä¸€äº›å…·ä½“å·¥ä½œ" class="headerlink" title="ä¸€äº›å…·ä½“å·¥ä½œ"></a>ä¸€äº›å…·ä½“å·¥ä½œ</h2><h3 id="Unsupervised-Domain-Adaptation-by-Backpropagation"><a href="#Unsupervised-Domain-Adaptation-by-Backpropagation" class="headerlink" title="Unsupervised Domain Adaptation by Backpropagation"></a>Unsupervised Domain Adaptation by Backpropagation</h3><p><a href="https://arxiv.org/pdf/1409.7495ä¸[1505.07818">https://arxiv.org/pdf/1409.7495ä¸[1505.07818</a> (arxiv.org)](<a href="https://arxiv.org/pdf/1505.07818">https://arxiv.org/pdf/1505.07818</a>)</p><p>è¾ƒæ—©çš„åŸŸè‡ªé€‚åº”å·¥ä½œ,æ—¶é—´ä¸Šè·ŸGANç±»ä¼¼,æœ¬èº«ä¹Ÿè·ŸGANå¾ˆåƒ.</p><p><img data-src="https://s2.loli.net/2024/06/23/ym2ExsfAFX9cpP7.png" alt="image-20240623165143441"></p><h3 id="Simultaneous-Deep-Transfer-Across-Domains-and-Tasks"><a href="#Simultaneous-Deep-Transfer-Across-Domains-and-Tasks" class="headerlink" title="Simultaneous Deep Transfer Across Domains and Tasks"></a>Simultaneous Deep Transfer Across Domains and Tasks</h3><p><a href="https://arxiv.org/pdf/1510.02192">https://arxiv.org/pdf/1510.02192</a></p><p>åŒæ ·ä¹Ÿæ˜¯è¿œå¤æ—¶æœŸè®ºæ–‡</p><h3 id="Minimum-Class-Confusion-for-Versatile-Domain-Adaptation"><a href="#Minimum-Class-Confusion-for-Versatile-Domain-Adaptation" class="headerlink" title="Minimum Class Confusion for Versatile Domain Adaptation"></a>Minimum Class Confusion for Versatile Domain Adaptation</h3><p><img data-src="https://s2.loli.net/2024/06/27/w4semziX5HcTZo9.png" alt="image-20240627153353279"></p><h3 id="Maximum-Classifier-Discrepancy-for-Unsupervised-Domain-Adaptation"><a href="#Maximum-Classifier-Discrepancy-for-Unsupervised-Domain-Adaptation" class="headerlink" title="Maximum Classifier Discrepancy for Unsupervised Domain Adaptation"></a>Maximum Classifier Discrepancy for Unsupervised Domain Adaptation</h3><p><img data-src="https://s2.loli.net/2024/06/27/ikL3uemU5nxNT7f.png" alt="image-20240627155801158"></p><h3 id="Deep-Domain-Confusion-Maximizing-for-Domain-Invariance"><a href="#Deep-Domain-Confusion-Maximizing-for-Domain-Invariance" class="headerlink" title="Deep Domain Confusion: Maximizing for Domain Invariance"></a>Deep Domain Confusion: Maximizing for Domain Invariance</h3><p><img data-src="https://s2.loli.net/2024/06/30/Uh35uECtq9zAWVm.png" alt="image-20240630160801199"></p><h3 id="Taking-A-Closer-Look-at-Domain-Shift-Category-level-Adversaries-for-Semantics-Consistent-Domain-Adaptation"><a href="#Taking-A-Closer-Look-at-Domain-Shift-Category-level-Adversaries-for-Semantics-Consistent-Domain-Adaptation" class="headerlink" title="Taking A Closer Look at Domain Shift: Category-level Adversaries for Semantics Consistent Domain Adaptation"></a>Taking A Closer Look at Domain Shift: Category-level Adversaries for Semantics Consistent Domain Adaptation</h3><p><img data-src="https://s2.loli.net/2024/06/30/5pCyk8FE2alwqhL.png" alt="image-20240630231443263"></p><p>æå‡ºcatergory-levelçš„å¯¹é½.</p><p>daçš„å…³é”®åœ¨äºå‡å°‘é¢†åŸŸåç§»ï¼Œå³å¼ºåˆ¶ä¸¤ä¸ªé¢†åŸŸçš„æ•°æ®åˆ†å¸ƒç›¸ä¼¼ã€‚å¸¸è§çš„ç­–ç•¥ä¹‹ä¸€æ˜¯é€šè¿‡å¯¹æŠ—å­¦ä¹ æ¥å¯¹é½ç‰¹å¾ç©ºé—´ä¸­çš„è¾¹é™…åˆ†å¸ƒã€‚ç„¶è€Œï¼Œè¿™ç§å…¨å±€å¯¹é½ç­–ç•¥å¹¶ä¸è€ƒè™‘ç±»åˆ«çº§çš„è”åˆåˆ†å¸ƒ,è¿™ç§å…¨å±€ç§»åŠ¨çš„ä¸€ä¸ªå¯èƒ½åæœæ˜¯ï¼Œä¸€äº›åŸæœ¬åœ¨æºåŸŸå’Œç›®æ ‡åŸŸä¹‹é—´å¯¹é½è‰¯å¥½çš„ç±»åˆ«å¯èƒ½ä¼šè¢«é”™è¯¯åœ°æ˜ å°„ï¼Œä»è€Œå¯¼è‡´ç›®æ ‡åŸŸçš„åˆ†å‰²ç»“æœå˜å·®ã€‚</p><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¼•å…¥äº†ä¸€ä¸ªç±»åˆ«çº§å¯¹æŠ—ç½‘ç»œï¼Œç›®çš„æ˜¯åœ¨å…¨å±€å¯¹é½è¶‹åŠ¿ä¸­æ‰§è¡Œå±€éƒ¨è¯­ä¹‰ä¸€è‡´æ€§ã€‚æˆ‘ä»¬çš„æƒ³æ³•æ˜¯ä»”ç»†è§‚å¯Ÿç±»åˆ«çº§è”åˆåˆ†å¸ƒï¼Œå¹¶é€šè¿‡è‡ªé€‚åº”å¯¹æŠ—æŸå¤±æ¥å¯¹é½æ¯ä¸ªç±»åˆ«ã€‚å…·ä½“æ¥è¯´ï¼Œæˆ‘ä»¬é™ä½äº†ç±»åˆ«çº§å¯¹é½ç‰¹å¾çš„å¯¹æŠ—æŸå¤±æƒé‡ï¼ŒåŒæ—¶å¢åŠ äº†é‚£äº›å¯¹é½ä¸ä½³ç‰¹å¾çš„å¯¹æŠ—åŠ›ã€‚</p><script type="math/tex; mode=display">\mathcal{L}_{seg}(G)=\sum_{i=1}^{H\times W}\sum_{c=1}^{C}-y_{ic}\log p_{ic}</script><script type="math/tex; mode=display">\mathcal{L}_{weight}(G)=\frac{\vec{w_1}\cdot\vec{w_2}}{\|\vec{w_1}\|\|\vec{w_2}\|}</script><script type="math/tex; mode=display">\begin{aligned}&\mathcal{L}_{adv}(G,D)=-E[\log(D(G(X_{S})))]-\\&E[(\lambda_{local}\mathcal{M}(p^{(1)},p^{(2)})+\epsilon)\log(1-D(G(X_{T})))] ,\end{aligned}</script><script type="math/tex; mode=display">\begin{gathered}\mathcal{L}_{CLAN}(G,D)= \mathcal{L}_{seg}(G)+\lambda_{weight}\mathcal{L}_{weight}(G)+ \\\lambda_{adv}\mathcal{L}_{adv}(G,D) , \end{gathered}</script><script type="math/tex; mode=display">G^*,D^*=\arg\min_G\max_D\mathcal{L}_{CLAN}(G,D).</script><h3 id="Cross-domain-adaptive-clustering-for-semisupervised-domain-adaptation"><a href="#Cross-domain-adaptive-clustering-for-semisupervised-domain-adaptation" class="headerlink" title="Cross-domain adaptive clustering for semisupervised domain adaptation"></a>Cross-domain adaptive clustering for semisupervised domain adaptation</h3><p><img data-src="https://s2.loli.net/2024/07/02/xOTivnD4tj2PrUG.png" alt="image-20240702113906287"></p><h3 id="Moment-Matching-for-Multi-Source-Domain-Adaptation"><a href="#Moment-Matching-for-Multi-Source-Domain-Adaptation" class="headerlink" title="Moment Matching for Multi-Source Domain Adaptation"></a>Moment Matching for Multi-Source Domain Adaptation</h3><p><img data-src="https://s2.loli.net/2024/06/27/tDwx9ZesFkz57yo.png" alt="image-20240627164102546"></p><h3 id="A-DIRT-T-APPROACH-TO-UNSUPERVISED-DOMAIN-ADAPTATION"><a href="#A-DIRT-T-APPROACH-TO-UNSUPERVISED-DOMAIN-ADAPTATION" class="headerlink" title="A DIRT-T APPROACH TO UNSUPERVISED DOMAIN ADAPTATION"></a>A DIRT-T APPROACH TO UNSUPERVISED DOMAIN ADAPTATION</h3><p><img data-src="https://s2.loli.net/2024/06/27/lgRXwOIv43etCjW.png" alt="image-20240627175801303"></p><h3 id="Reusing-the-Task-specific-Classifier-as-a-Discriminator-Discriminator-free-Adversarial-Domain-Adaptation"><a href="#Reusing-the-Task-specific-Classifier-as-a-Discriminator-Discriminator-free-Adversarial-Domain-Adaptation" class="headerlink" title="Reusing the Task-specific Classifier as a Discriminator: Discriminator-free Adversarial Domain Adaptation"></a>Reusing the Task-specific Classifier as a Discriminator: Discriminator-free Adversarial Domain Adaptation</h3><h4 id="æ‘˜è¦"><a href="#æ‘˜è¦" class="headerlink" title="æ‘˜è¦"></a>æ‘˜è¦</h4><p>å¯¹æŠ—å­¦ä¹ åœ¨æ— ç›‘ç£é¢†åŸŸé€‚åº”ï¼ˆUDAï¼‰æ–¹é¢å–å¾—äº†å“è¶Šçš„æˆç»©ã€‚ç°æœ‰çš„å¯¹æŠ—æ€§ UDA æ–¹æ³•é€šå¸¸é‡‡<strong>ç”¨é¢å¤–çš„åˆ¤åˆ«å™¨ä¸ç‰¹å¾æå–å™¨è¿›è¡Œæœ€å°-æœ€å¤§åšå¼ˆ</strong>.</p><p>ç°æœ‰çš„å¯¹æŠ—æ€§ UDA æ–¹æ³•é€š<strong>å¸¸é‡‡ç”¨é¢å¤–çš„åˆ¤åˆ«å™¨ä¸ç‰¹å¾æå–å™¨è¿›è¡Œæœ€å°-æœ€å¤§åšå¼ˆ.ç„¶è€Œ,è¿™äº›æ–¹æ³•å¤§å¤šä¸èƒ½æœ‰æ•ˆåˆ©ç”¨é¢„æµ‹çš„åˆ¤åˆ«ä¿¡æ¯</strong>ï¼Œä»è€Œå¯¼è‡´ç”Ÿæˆå™¨çš„æ¨¡å¼å´©æºƒã€‚</p><p>åœ¨è¿™é¡¹å·¥ä½œä¸­,æˆ‘ä»¬ä»ä¸åŒçš„è§’åº¦æ¥è§£å†³è¿™ä¸ªé—®é¢˜,è®¾è®¡äº†ä¸€ç§ç®€å•è€Œæœ‰æ•ˆçš„å¯¹æŠ—èŒƒå¼ï¼Œå³<strong>æ— åˆ¤åˆ«å™¨å¯¹æŠ—å­¦ä¹ ç½‘ç»œ</strong>ï¼ˆDALNï¼‰,å…¶ä¸­<strong>ç±»åˆ«åˆ†ç±»å™¨è¢«é‡æ–°ç”¨ä½œåˆ¤åˆ«å™¨</strong>ï¼Œé€šè¿‡ç»Ÿä¸€çš„ç›®æ ‡å®ç°æ˜ç¡®çš„é¢†åŸŸå¯¹é½å’Œç±»åˆ«åŒºåˆ†,ä½¿ DALN èƒ½å¤Ÿåˆ©ç”¨é¢„æµ‹çš„åˆ¤åˆ«ä¿¡æ¯è¿›è¡Œå……åˆ†çš„ç‰¹å¾å¯¹é½ã€‚</p><p>åŸºæœ¬ä¸Šï¼Œæˆ‘ä»¬å¼•å…¥äº†ä¸€ç§Nuclear-norm Wasserstein discrepancyï¼ŒNWDï¼Œå®ƒå¯¹è¿›è¡Œåˆ¤åˆ«å…·æœ‰æ˜ç¡®çš„æŒ‡å¯¼æ„ä¹‰ã€‚è¿™ç§ NWD å¯ä»¥ä¸åˆ†ç±»å™¨ç›¸ç»“åˆï¼Œä½œä¸ºæ»¡è¶³ K-Lipschitz çº¦æŸçš„åˆ¤åˆ«å™¨ï¼Œè€Œæ— éœ€é¢å¤–çš„æƒé‡å‰ªåˆ‡æˆ–æ¢¯åº¦æƒ©ç½šç­–ç•¥ã€‚</p><h4 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h4><p>æ·±åº¦ç¥ç»ç½‘ç»œï¼ˆDNNï¼‰åœ¨è®¸å¤šè®¡ç®—æœºè§†è§‰ä»»åŠ¡ä¸­å–å¾—äº†é‡å¤§è¿›å±•ã€‚ç„¶è€Œï¼Œè¿™äº›æ–¹æ³•çš„æˆåŠŸåœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šå–å†³äºå¤§é‡çš„æ³¨é‡Šæ•°æ®ï¼Œè€Œè·å–è¿™äº›æ•°æ®æå…¶è€—æ—¶ä¸”æ˜‚è´µã€‚</p><p>æ­¤å¤–ï¼Œç”±äºè®­ç»ƒæ•°æ®ä¸çœŸå®ä¸–ç•Œæµ‹è¯•æ•°æ®ä¹‹é—´å­˜åœ¨å·®å¼‚ï¼Œå°½ç®¡è¿›è¡Œäº†å¤§é‡æ ‡æ³¨å·¥ä½œï¼Œä½†åœ¨æ ‡æ³¨æ•°æ®ä¸Šè®­ç»ƒçš„ DNN æ¨¡å‹åœ¨æµ‹è¯•é›†ä¸Šçš„æ€§èƒ½å¯èƒ½ä¼šæ€¥å‰§ä¸‹é™ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œäººä»¬æ·±å…¥æ¢è®¨äº†æ— ç›‘ç£é¢†åŸŸé€‚åº”ï¼ˆUDAï¼‰]ï¼Œå…¶ç›®çš„æ˜¯åœ¨é¢†åŸŸè½¬ç§»çš„æƒ…å†µä¸‹ï¼Œå°†çŸ¥è¯†ä»æœ‰æ ‡æ³¨çš„æºé¢†åŸŸè½¬ç§»åˆ°æ— æ ‡æ³¨çš„ç›®æ ‡é¢†åŸŸã€‚</p><p>å— Ben-David ç­‰äººç†è®ºåˆ†æçš„å¯å‘ï¼Œç°æœ‰çš„ UDA æ–¹æ³•é€šå¸¸éƒ½åœ¨<strong>æ¢ç´¢å­¦ä¹ é¢†åŸŸä¸å˜ç‰¹å¾è¡¨å¾çš„æ€è·¯</strong>ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œè¿™äº›æ–¹æ³•å¯åˆ†ä¸ºä¸¤ä¸ªåˆ†æ”¯ï¼Œå³çŸ©åŒ¹é…æ–¹æ³•å’Œå¯¹æŠ—å­¦ä¹ æ–¹æ³•ã€‚çŸ©åŒ¹é…æ–¹æ³•é€šè¿‡åŒ¹é…æºåŸŸå’Œç›®æ ‡åŸŸç‰¹å¾çš„æ˜ç¡®åˆ†å¸ƒå·®å¼‚ï¼Œæ˜ç¡®å‡å°‘åŸŸåç§»ã€‚</p><p>å¯¹æŠ—æ€§å­¦ä¹ æ–¹æ³•é€šè¿‡è¿›è¡Œå¯¹æŠ—æ€§æœ€å°-æœ€å¤§åŒäººåšå¼ˆï¼Œéšå«åœ°å‡è½»äº†é¢†åŸŸè½¬ç§»çš„å½±å“ï¼Œè¿™ä¿ƒä½¿ç”Ÿæˆå™¨æå–ä¸å¯åŒºåˆ†çš„ç‰¹å¾ï¼Œä»¥æ¬ºéª—é‰´åˆ«å™¨</p><p>æœ‰ä¸€ç§æ–¹æ³•åˆ©ç”¨ä¸¤ä¸ªç‰¹å®šä»»åŠ¡åˆ†ç±»å™¨ C å’Œ Câ€²çš„å·®å¼‚ï¼ˆå¯å°†å…¶è§†ä¸ºåˆ¤åˆ«å™¨ï¼‰æ¥éšå¼åœ°å®ç°å¯¹æŠ—å­¦ä¹ å¹¶æé«˜ç‰¹å¾çš„å¯è½¬ç§»æ€§ã€‚è¿™ç§èŒƒå¼ä½¿ UDA æ–¹æ³•<strong>èƒ½å¤Ÿå‡å°‘ç±»çº§åŸŸå·®å¼‚</strong>ã€‚ä½†æ˜¯ï¼Œéµå¾ªè¿™ç§èŒƒå¼çš„æ–¹æ³•å®¹æ˜“å—åˆ°æ¨¡ç³Šé¢„æµ‹çš„å½±å“ï¼Œä»è€Œé˜»ç¢é€‚åº”æ€§ä¼˜åŒ–ã€‚</p><p>å¦ä¸€ç§æ–¹æ³•ç›´æ¥æ„å»ºäº†ä¸€ä¸ªé¢å¤–çš„åŸŸåˆ¤åˆ«å™¨ Dï¼Œé€šè¿‡<strong>å……åˆ†æ··æ·†è·¨åŸŸç‰¹å¾è¡¨ç¤ºæ¥æé«˜ç‰¹å¾çš„å¯è½¬ç§»æ€§</strong>ã€‚ç„¶è€Œï¼Œéµå¾ªè¿™ä¸€èŒƒå¼çš„æ–¹æ³•<strong>é€šå¸¸ä¾§é‡äºé¢†åŸŸçº§ç‰¹å¾æ··æ·†</strong>ï¼Œè¿™å¯èƒ½<strong>ä¼šæŸå®³ç±»åˆ«çº§ä¿¡æ¯</strong>ï¼Œä»è€Œå¯¼è‡´æ¨¡å¼å´©æºƒé—®é¢˜</p><p><img data-src="https://s2.loli.net/2024/07/05/t2JurbfKWowqQEs.png" alt="image-20240705114005812"></p><h3 id="Domain-Adaptation-in-Object-Detection"><a href="#Domain-Adaptation-in-Object-Detection" class="headerlink" title="Domain Adaptation in Object Detection"></a>Domain Adaptation in Object Detection</h3><h4 id="Domain-Adaptive-Faster-R-CNN-for-Object-Detection-in-the-Wild"><a href="#Domain-Adaptive-Faster-R-CNN-for-Object-Detection-in-the-Wild" class="headerlink" title="Domain Adaptive Faster R-CNN for Object Detection in the Wild"></a>Domain Adaptive Faster R-CNN for Object Detection in the Wild</h4><p><img data-src="https://s2.loli.net/2024/06/30/dm3lApv8HMux15G.png" alt="image-20240630231624714"></p><p>è¾ƒæ—©çš„ç”¨äºç›®æ ‡æ£€æµ‹çš„domain adaptationæ–¹æ³•,ä½¿ç”¨GRLå’Œä¸åŒlevelçš„åˆ†ç±»å™¨.</p><h4 id="CDTRANS-CROSS-DOMAIN-TRANSFORMER-FOR-UNSUPERVISED-DOMAIN-ADAPTATION"><a href="#CDTRANS-CROSS-DOMAIN-TRANSFORMER-FOR-UNSUPERVISED-DOMAIN-ADAPTATION" class="headerlink" title="CDTRANS: CROSS-DOMAIN TRANSFORMER FOR UNSUPERVISED DOMAIN ADAPTATION"></a>CDTRANS: CROSS-DOMAIN TRANSFORMER FOR UNSUPERVISED DOMAIN ADAPTATION</h4><p>æ— ç›‘ç£é¢†åŸŸé€‚åº”ï¼ˆUDAï¼‰æ—¨åœ¨å°†ä»æ ‡æ³¨æºé¢†åŸŸå­¦ä¹ åˆ°çš„çŸ¥è¯†è½¬ç§»åˆ°ä¸åŒçš„æ— æ ‡æ³¨ç›®æ ‡é¢†åŸŸã€‚å¤§å¤šæ•°ç°æœ‰çš„æ— ç›‘ç£é¢†åŸŸé€‚åº”æ–¹æ³•éƒ½ä¾§é‡äºå­¦ä¹ é¢†åŸŸä¸å˜çš„ç‰¹å¾è¡¨å¾ï¼Œæ— è®ºæ˜¯ä»<strong>é¢†åŸŸå±‚é¢è¿˜æ˜¯ä»ç±»åˆ«å±‚é¢</strong>ï¼Œéƒ½ä½¿ç”¨åŸºäºå·ç§¯ç¥ç»ç½‘ç»œï¼ˆCNNï¼‰çš„æ¡†æ¶ã€‚<strong>åŸºäºç±»åˆ«å±‚çš„ UDA é¢ä¸´çš„ä¸€ä¸ªåŸºæœ¬é—®é¢˜æ˜¯ï¼Œç›®æ ‡åŸŸä¸­çš„æ ·æœ¬ä¼šäº§ç”Ÿä¼ªæ ‡ç­¾ï¼Œè€Œä¼ªæ ‡ç­¾é€šå¸¸å™ªå£°è¿‡å¤§ï¼Œæ— æ³•è¿›è¡Œå‡†ç¡®çš„åŸŸå¯¹é½ï¼Œè¿™ä¸å¯é¿å…åœ°ä¼šå½±å“ UDA çš„æ€§èƒ½</strong>ã€‚</p><p>éšç€ Transformer åœ¨å„ç§ä»»åŠ¡ä¸­çš„æˆåŠŸåº”ç”¨ï¼Œæˆ‘ä»¬å‘ç° Transformer ä¸­çš„äº¤å‰å…³æ³¨å¯¹å™ªå£°è¾“å…¥å¯¹å…·æœ‰é²æ£’æ€§ï¼Œå¯ä»¥æ›´å¥½åœ°è¿›è¡Œç‰¹å¾å¯¹é½ï¼Œå› æ­¤æœ¬æ–‡é‡‡ç”¨ Transformer æ¥å®Œæˆå…·æœ‰æŒ‘æˆ˜æ€§çš„ UDA ä»»åŠ¡ã€‚</p><p>å…·ä½“æ¥è¯´,ä¸ºäº†ç”Ÿæˆå‡†ç¡®çš„è¾“å…¥å¯¹,è®¾è®¡äº†<strong>ä¸€ç§åŒå‘ä¸­å¿ƒæ„ŸçŸ¥æ ‡ç­¾ç®—æ³•,ä¸ºç›®æ ‡æ ·æœ¬ç”Ÿæˆä¼ªæ ‡ç­¾</strong>ã€‚é™¤äº†ä¼ªæ ‡ç­¾,æˆ‘ä»¬è¿˜æå‡ºäº†ä¸€ä¸ª<strong>æƒé‡å…±äº«çš„ä¸‰é‡åˆ†æ”¯transformeræ¡†æ¶</strong>,åˆ†åˆ«ç”¨äºæº/ç›®æ ‡ç‰¹å¾å­¦ä¹ å’Œæº/ç›®æ ‡åŸŸå¯¹é½çš„è‡ªæˆ‘å…³æ³¨å’Œäº¤å‰å…³æ³¨.è¿™ç§è®¾è®¡æ˜ç¡®åœ°å¼ºåŒ–äº†è¯¥æ¡†æ¶,ä½¿å…¶èƒ½å¤ŸåŒæ—¶å­¦ä¹ å…·æœ‰åŒºåˆ†æ€§çš„ç‰¹å®šé¢†åŸŸè¡¨å¾å’Œé¢†åŸŸä¸å˜è¡¨å¾ã€‚æ‰€æå‡ºçš„æ–¹æ³•è¢«ç§°ä¸º CDTransï¼ˆè·¨åŸŸtransformerï¼‰å®ƒæ˜¯ç”¨çº¯transformerè§£å†³æ–¹æ¡ˆè§£å†³ UDA ä»»åŠ¡çš„é¦–æ¬¡å°è¯•ä¹‹ä¸€.</p><h4 id="ç›¸å…³å·¥ä½œ"><a href="#ç›¸å…³å·¥ä½œ" class="headerlink" title="ç›¸å…³å·¥ä½œ"></a>ç›¸å…³å·¥ä½œ</h4><p>UDAæ–¹æ³•ä¸»è¦æœ‰ä¸¤ä¸ªå±‚æ¬¡ï¼šé¢†åŸŸçº§å’Œç±»åˆ«çº§ã€‚åŸŸçº§ UDA é€šè¿‡å°†æºåŸŸå’Œç›®æ ‡åŸŸæ‹‰å…¥ä¸åŒå°ºåº¦çº§åˆ«çš„ç›¸åŒåˆ†å¸ƒä¸­ï¼Œæ¥ç¼“è§£æºåŸŸå’Œç›®æ ‡åŸŸä¹‹é—´çš„åˆ†å¸ƒåˆ†æ­§ã€‚å¸¸ç”¨çš„åˆ†æ­§åº¦é‡åŒ…æ‹¬æœ€å¤§å‡å€¼å·®å¼‚ï¼ˆMMDï¼‰å’Œç›¸å…³å¯¹é½ï¼ˆCORALï¼‰ã€‚</p><p>æœ€è¿‘ï¼Œä¸€äº›ç ”ç©¶ä¾§é‡äºé€šè¿‡ç‰¹å¾æå–å™¨å’Œä¸¤ä¸ªç‰¹å®šé¢†åŸŸåˆ†ç±»å™¨ä¹‹é—´çš„å¯¹æŠ—æ–¹å¼è¿›è¡Œç»†ç²’åº¦ç±»åˆ«çº§æ ‡ç­¾åˆ†å¸ƒå¯¹é½ã€‚ä¸é¢†åŸŸå°ºåº¦çš„ç²—ç²’åº¦å¯¹é½ä¸åŒï¼Œ<strong>è¿™ç§æ–¹æ³•é€šè¿‡å°†ç›®æ ‡æ ·æœ¬æ¨å‘æºæ ·æœ¬åœ¨æ¯ä¸ªç±»åˆ«ä¸­çš„åˆ†å¸ƒï¼Œæ¥å¯¹é½æºå’Œç›®æ ‡é¢†åŸŸæ•°æ®ä¹‹é—´çš„æ¯ä¸ªç±»åˆ«åˆ†å¸ƒã€‚æ˜¾ç„¶ï¼Œç»†ç²’åº¦é…å‡†èƒ½åœ¨åŒä¸€æ ‡ç­¾ç©ºé—´å†…å®ç°æ›´ç²¾ç¡®çš„åˆ†å¸ƒé…å‡†ã€‚</strong>å°½ç®¡å¯¹æŠ—æ–¹æ³•é€šè¿‡åœ¨ç±»åˆ«çº§åˆ«ä¸Šèåˆæºæ ·æœ¬å’Œç›®æ ‡æ ·æœ¬çš„ç»†ç²’åº¦é…å‡†æ“ä½œå®ç°äº†æ–°çš„æ”¹è¿›ï¼Œä½†å®ƒä»ç„¶æ— æ³•è§£å†³å™ªå£°æ ·æœ¬åœ¨é”™è¯¯ç±»åˆ«ä¸­çš„é—®é¢˜ã€‚æˆ‘ä»¬çš„æ–¹æ³•é‡‡ç”¨äº†<strong>ç±»åˆ«çº§ UDA</strong> çš„ Transformers æ¥è§£å†³å™ªå£°é—®é¢˜ã€‚</p><p>ä¼ªæ ‡ç­¾æ³•é¦–æ¬¡è¢«å¼•å…¥åŠç›‘ç£å­¦ä¹ ,å¹¶åœ¨é¢†åŸŸé€‚åº”ä»»åŠ¡ä¸­å¾—åˆ°æ™®åŠ.å®ƒ<strong>åˆ©ç”¨é¢„æµ‹æ¦‚ç‡å­¦ä¹ æ ‡è®°æœªæ ‡è®°æ•°æ®,å¹¶ä¸æ ‡è®°æ•°æ®ä¸€èµ·æ‰§è¡Œå¾®è°ƒ</strong>.åœ¨å°†ä¼ªæ ‡ç­¾ç”¨äºé¢†åŸŸé€‚åº”ä»»åŠ¡æ–¹é¢ï¼Œé‡‡ç”¨<strong>ä¼ªæ ‡ç­¾è¿›è¡Œæ¡ä»¶åˆ†å¸ƒå¯¹é½</strong>ï¼›<strong>å°†ä¼ªæ ‡ç­¾ä½œä¸ºé¢†åŸŸé€‚åº”çš„æ­£åˆ™åŒ–</strong>ï¼›Zou ç­‰é€šè¿‡äº¤æ›¿æ±‚è§£ä¼ªæ ‡ç­¾è®¾è®¡äº†ä¸€ç§è‡ªè®­ç»ƒæ¡†æ¶ï¼›Caron ç­‰æå‡ºäº†ä¸€ç§æ·±åº¦è‡ªç›‘ç£æ–¹æ³•ï¼Œé€šè¿‡ k-means èšç±»ç”Ÿæˆä¼ªæ ‡ç­¾æ¥é€æ­¥è®­ç»ƒæ¨¡å‹ï¼›Liang ç­‰å¼€å‘äº†ä¸€ç§è‡ªç›‘ç£ä¼ªæ ‡ç­¾æ–¹æ³•æ¥å‡è½»å™ªå£°ä¼ªæ ‡ç­¾çš„å½±å“ã€‚åœ¨Liang ç­‰äººçš„åŸºç¡€ä¸Šï¼Œæœ¬æ–‡æå‡ºäº†ä¸€ç§åŒå‘ä¸­å¿ƒæ„ŸçŸ¥æ ‡æ³¨ç®—æ³•ï¼Œä»¥è¿›ä¸€æ­¥è¿‡æ»¤å™ªå£°ä¼ªæ ‡ç­¾å¯¹</p><p><img data-src="C:\Users\proanimer\AppData\Roaming\Typora\typora-user-images\image-20240702114426708.png" alt="image-20240702114426708"></p><h4 id="Uncertainty-Aware-Unsupervised-Domain-Adaptation-in-Object-Detection"><a href="#Uncertainty-Aware-Unsupervised-Domain-Adaptation-in-Object-Detection" class="headerlink" title="Uncertainty-Aware Unsupervised Domain Adaptation in Object Detection"></a>Uncertainty-Aware Unsupervised Domain Adaptation in Object Detection</h4><p><img data-src="https://s2.loli.net/2024/07/05/DNVsxMT7WhRHvX5.png" alt="image-20240705113637158"></p><h4 id="ConfMix-Unsupervised-Domain-Adaptation-for-Object-Detection-via-Confidence-based-Mixing"><a href="#ConfMix-Unsupervised-Domain-Adaptation-for-Object-Detection-via-Confidence-based-Mixing" class="headerlink" title="ConfMix: Unsupervised Domain Adaptation for Object Detection via Confidence-based Mixing"></a>ConfMix: Unsupervised Domain Adaptation for Object Detection via Confidence-based Mixing</h4><p><img data-src="https://s2.loli.net/2024/07/05/wEb6aNTnig8HWIt.png" alt="image-20240705114702994"></p><p>ç”¨äºå¯¹è±¡æ£€æµ‹çš„æ— ç›‘ç£åŸŸè‡ªé€‚åº” ï¼ˆUDAï¼‰ æ—¨åœ¨è°ƒæ•´åœ¨æºåŸŸä¸Šè®­ç»ƒçš„æ¨¡å‹ï¼Œä»¥æ£€æµ‹æ¥è‡ªæ³¨é‡Šä¸å¯ç”¨çš„æ–°ç›®æ ‡åŸŸçš„å®ä¾‹ã€‚ä¸ä¼ ç»Ÿæ–¹æ³•ä¸åŒï¼Œæˆ‘ä»¬æå‡ºäº†ConfMixï¼Œè¿™æ˜¯ç¬¬ä¸€ç§<strong>å¼•å…¥åŸºäºåŒºåŸŸçº§æ£€æµ‹ç½®ä¿¡åº¦çš„æ ·æœ¬æ··åˆç­–ç•¥çš„æ–¹æ³•ï¼Œç”¨äºè‡ªé€‚åº”ç›®æ ‡æ£€æµ‹å™¨å­¦ä¹ </strong>ã€‚æˆ‘ä»¬å°†å¯¹åº”äºæœ€å¯é ä¼ªæ£€æµ‹çš„ç›®æ ‡æ ·æœ¬çš„å±€éƒ¨åŒºåŸŸä¸æºå›¾åƒæ··åˆï¼Œå¹¶åº”ç”¨é¢å¤–çš„ä¸€è‡´æ€§æŸå¤±é¡¹ä»¥é€æ¸é€‚åº”ç›®æ ‡æ•°æ®åˆ†å¸ƒã€‚ä¸ºäº†ç¨³å¥åœ°å®šä¹‰ä¸€ä¸ªåŒºåŸŸçš„ç½®ä¿¡åº¦åˆ†æ•°ï¼Œæˆ‘ä»¬åˆ©ç”¨äº†æ¯æ¬¡ä¼ªæ£€æµ‹çš„ç½®ä¿¡åº¦åˆ†æ•°ï¼Œè¯¥ç½®ä¿¡åº¦åŒæ—¶è€ƒè™‘äº†æ£€æµ‹å™¨ä¾èµ–çš„ç½®ä¿¡åº¦å’Œè¾¹ç•Œæ¡†çš„ä¸ç¡®å®šæ€§</p><h3 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h3><ol><li><a href="https://arxiv.org/pdf/2208.07422">2208.07422 (arxiv.org)</a></li><li><a href="https://www.youtube.com/watch?v=gvfLq4sPW4k&amp;ab_channel=Hung-yiLee">[TA è£œå……èª²] More about Domain Adaptation (1/2) (ç”±åŠ©æ•™è¶™å´‡çš“åŒå­¸è¬›æˆ) (youtube.com)</a></li></ol><p><strong>è®ºæ–‡ä¸ä»£ç åº“</strong></p><ul><li><p><a href="https://github.com/thuml/Transfer-Learning-Library">thuml/Transfer-Learning-Library: Transfer Learning Library for Domain Adaptation, Task Adaptation, and Domain Generalization (github.com)</a></p></li><li><p><a href="https://github.com/adapt-python/adapt">adapt-python/adapt: Awesome Domain Adaptation Python Toolbox (github.com)</a></p></li><li><p><a href="https://github.com/jindongwang/transferlearning">jindongwang/transferlearning: Transfer learning / domain adaptation / domain generalization / multi-task learning etc. Papers, codes, datasets, applications, tutorials.-è¿ç§»å­¦ä¹  (github.com)</a></p></li><li><p><a href="https://github.com/zhaoxin94/awesome-domain-adaptation">zhaoxin94/awesome-domain-adaptation: A collection of AWESOME things about domian adaptation (github.com)</a></p></li><li><p><a href="https://github.com/barebell/DA">barebell/DA: Unsupervised Domain Adaptation Papers and Code (github.com)</a></p></li><li><p><a href="https://github.com/agrija9/Deep-Unsupervised-Domain-Adaptation">agrija9/Deep-Unsupervised-Domain-Adaptation: Pytorch implementation of four neural network based domain adaptation techniques: DeepCORAL, DDC, CDAN and CDAN+E. Evaluated on benchmark dataset Office31. (github.com)</a></p></li><li><p><a href="https://github.com/jvanvugt/pytorch-domain-adaptation?tab=readme-ov-file">jvanvugt/pytorch-domain-adaptation: A collection of implementations of adversarial domain adaptation algorithms (github.com)</a></p></li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;p&gt;è¿™ä¸ªæ–¹å‘çš„æŠ€æœ¯ç›®å‰æ²¡æœ‰é‚£ä¹ˆç«äº†,ä½†æ˜¯èƒ½åº”ç”¨çš„åœºæ™¯éå¸¸ä¹‹å¤š.&lt;br&gt;</summary>
    
    
    
    
    <category term="domain adaptation" scheme="https://www.sekyoro.top/tags/domain-adaptation/"/>
    
  </entry>
  
  <entry>
    <title>ååŒæ„ŸçŸ¥å­¦ä¹ (äºŒ)</title>
    <link href="https://www.sekyoro.top/2024/05/17/%E5%8D%8F%E5%90%8C%E6%84%9F%E7%9F%A5%E7%AE%97%E6%B3%95-%E4%BA%8C/"/>
    <id>https://www.sekyoro.top/2024/05/17/%E5%8D%8F%E5%90%8C%E6%84%9F%E7%9F%A5%E7%AE%97%E6%B3%95-%E4%BA%8C/</id>
    <published>2024-05-17T14:42:49.000Z</published>
    <updated>2024-06-18T13:40:02.753Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>éšç€å¤§æ¨¡å‹æ—¶ä»£çš„åˆ°æ¥,åŸå…ˆé€šè¿‡ä¿®æ”¹æ¨¡å‹ç»“æ„æå‡æ€§èƒ½å†™è®ºæ–‡çš„æ–¹å¼å·²ç»æœ‰ç‚¹out of dateäº†,åŒæ—¶å†™æ–‡ç« çš„å€¾å‘å·²ç»ä»æ”¹æ¶æ„æˆSOTAæ…¢æ…¢è½¬å˜ä¸ºå›å½’ä»»åŠ¡èƒŒæ™¯ä»¥åŠè®²å¥½ä¸€ä¸ªå®Œæ•´æ•…äº‹å¹¶ç»™å‡ºè‡ªå·±çš„findingså’Œinsightäº†.ä¹Ÿå› æ­¤,åœ¨åä½œæ„ŸçŸ¥æ–¹é¢,è®ºæ–‡æ–¹å‘ä¹Ÿé€æ¸åœ¨è½¬å˜,è¿™é‡Œçœ‹çœ‹æœ€è¿‘çš„æ–‡ç« æ•´ç†ä¸€ä¸‹æ€è·¯.</p><span id="more"></span><h2 id="Domain-gap"><a href="#Domain-gap" class="headerlink" title="Domain gap"></a>Domain gap</h2><h3 id="Bridging-the-Domain-Gap-for-Multi-Agent-Perception-ICRA"><a href="#Bridging-the-Domain-Gap-for-Multi-Agent-Perception-ICRA" class="headerlink" title="Bridging the Domain Gap for Multi-Agent Perception ICRA"></a>Bridging the Domain Gap for Multi-Agent Perception ICRA</h3><h4 id="æ‘˜è¦"><a href="#æ‘˜è¦" class="headerlink" title="æ‘˜è¦"></a>æ‘˜è¦</h4><p>ç°æœ‰çš„å¤šæ™ºèƒ½ä½“æ„ŸçŸ¥ç®—æ³•é€šå¸¸é€‰æ‹©åœ¨æ™ºèƒ½ä½“ä¹‹é—´å…±äº«ä»åŸå§‹æ„ŸçŸ¥æ•°æ®ä¸­æå–çš„æ·±åº¦ç¥ç»ç‰¹å¾ï¼Œä»¥å®ç°ç²¾åº¦å’Œé€šä¿¡å¸¦å®½é™åˆ¶ä¹‹é—´çš„æƒè¡¡.ç„¶è€Œ,<strong>è¿™äº›æ–¹æ³•å‡è®¾æ‰€æœ‰æ™ºèƒ½ä½“å…·æœ‰ç›¸åŒçš„ç¥ç»ç½‘ç»œï¼Œè¿™åœ¨ç°å®ä¸–ç•Œä¸­å¯èƒ½æ˜¯ä¸å®ç”¨çš„</strong>ã€‚</p><p>å½“æ¨¡å‹ä¸åŒæ—¶,ä¼ é€’çš„ç‰¹å¾å¯èƒ½å­˜åœ¨è¾ƒå¤§çš„<strong>é¢†åŸŸå·®è·</strong>(domain gap)ï¼Œå¯¼è‡´å¤šæ™ºèƒ½ä½“æ„ŸçŸ¥æ€§èƒ½æ€¥å‰§ä¸‹é™.</p><p>åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬æå‡ºäº†ç¬¬ä¸€ä¸ªè½»é‡çº§æ¡†æ¶æ¥ä¸ºå¤šæ™ºèƒ½ä½“æ„ŸçŸ¥å¼¥åˆè¿™ç§é¢†åŸŸé¸¿æ²Ÿ,å®ƒå¯ä»¥ä½œä¸ºå¤§å¤šæ•°ç°æœ‰ç³»ç»Ÿçš„æ’ä»¶æ¨¡å—,åŒæ—¶ä¿æŒæœºå¯†æ€§.</p><p>æˆ‘ä»¬çš„æ¡†æ¶åŒ…æ‹¬ä¸€ä¸ªå¯å­¦ä¹ çš„ç‰¹å¾æˆå½¢æ¨¡æ¥å¯¹é½å¤šä¸ªç»´åº¦çš„ç‰¹å¾,ä»¥åŠä¸€ä¸ªç”¨äºé¢†åŸŸè‡ªé€‚åº”çš„ç¨€ç–è·¨åŸŸè½¬æ¢å™¨.åœ¨å…¬å¼€çš„å¤šæ™ºèƒ½ä½“æ„ŸçŸ¥æ•°æ®é›†V2XSetä¸Šçš„å¤§é‡å®éªŒè¡¨æ˜,å¯¹äºåŸºäºç‚¹äº‘çš„ä¸‰ç»´ç›®æ ‡æ£€æµ‹,æˆ‘ä»¬çš„æ–¹æ³•å¯ä»¥æœ‰æ•ˆåœ°å¼¥åˆä¸åŒé¢†åŸŸç‰¹å¾ä¹‹é—´çš„å·®è·,å¹¶æ˜¾è‘—ä¼˜äºå…¶ä»–åŸºçº¿æ–¹æ³•è‡³å°‘8%ã€‚</p><h4 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h4><p>æœ€è¿‘çš„ç ”ç©¶è¡¨æ˜ï¼Œé€šè¿‡åˆ©ç”¨è½¦è”ç½‘( Vehicle-to- Everythingï¼ŒV2X )é€šä¿¡æŠ€æœ¯å…±äº«è§†è§‰ä¿¡æ¯ï¼Œå¤šæ™ºèƒ½ä½“æ„ŸçŸ¥ç³»ç»Ÿå¯ä»¥é€šè¿‡é€è§†é®æŒ¡å’Œæ„ŸçŸ¥æ›´è¿œçš„èŒƒå›´æ¥æ˜¾è‘—æé«˜å•æ™ºèƒ½ä½“ç³»ç»Ÿçš„æ€§èƒ½.</p><p>ç°æœ‰æ–¹æ³•é€šå¸¸ä¸å…±äº«åŸå§‹æ„ŸçŸ¥æ•°æ®æˆ–æ£€æµ‹è¾“å‡º,è€Œæ˜¯å…±äº«ç”±ä¼ æ„Ÿå™¨æ•°æ®è®¡ç®—å¾—åˆ°çš„ä¸­é—´ç¥ç»ç‰¹å¾,å› ä¸ºå®ƒä»¬å¯ä»¥åœ¨ç²¾åº¦å’Œå¸¦å®½éœ€æ±‚ä¹‹é—´å®ç°æœ€ä½³æƒè¡¡.</p><p>æ­¤å¤–,ä¼ é€’çš„ä¸­é—´ç‰¹å¾å¯¹GPSå™ªå£°å’Œé€šä¿¡å»¶è¿Ÿçš„é²æ£’æ€§æ›´å¼º.</p><p>è¿™å¿½ç•¥äº†ä¸€ä¸ªå…³é”®çš„äº‹å®<strong>:ä¸ºæ‰€æœ‰æ™ºèƒ½ä½“éƒ¨ç½²ç›¸åŒçš„æ¨¡å‹æ˜¯ä¸ç°å®çš„,ç‰¹åˆ«æ˜¯å¯¹äºè¿æ¥çš„è‡ªåŠ¨é©¾é©¶</strong>.</p><p>ä¸åŒå…¬å¸çš„ç½‘è”è‡ªåŠ¨é©¾é©¶æ±½è½¦( CAV )å’ŒåŸºç¡€è®¾æ–½äº§å“çš„æ£€æµ‹æ¨¡å‹é€šå¸¸æ˜¯ä¸åŒçš„ã€‚å³ä½¿å¯¹äºåŒä¸€å…¬å¸,ç”±äºè½¦è½½è½¯ä»¶ç‰ˆæœ¬çš„ä¸åŒ,<strong>ä¹Ÿå¯èƒ½å­˜åœ¨ä¸åŒçš„æ£€æµ‹æ¨¡å‹.å½“å…±äº«ç‰¹å¾æ¥è‡ªä¸åŒçš„éª¨å¹²æ—¶,å­˜åœ¨ä¸€ä¸ªæ˜æ˜¾çš„åŸŸé—´éš™,è¿™å¾ˆå®¹æ˜“å‰Šå¼±åä½œçš„å¥½å¤„ã€‚</strong></p><p>åœ¨æœ¬æ–‡ä¸­,æˆ‘ä»¬æ·±å…¥ç ”ç©¶äº†å¤šæ™ºèƒ½ä½“æ„ŸçŸ¥ä¸­,ç‰¹åˆ«æ˜¯è‡ªåŠ¨é©¾é©¶ä¸­è¿™ä¸€å°šæœªè§£å†³çš„å®é™…é—®é¢˜.æˆ‘ä»¬é¦–å…ˆä»”ç»†<strong>ç ”ç©¶äº†ä¸åŒç‰¹å¾å›¾çš„é¢†åŸŸå·®è·</strong>,ç„¶ååœ¨åˆ†æçš„åŸºç¡€ä¸Šæå‡ºäº†æˆ‘ä»¬çš„æ¡†æ¶.</p><p><img data-src="https://s2.loli.net/2024/05/17/R4nUZOVyzfJCTcw.png" alt="image-20240517150815672"></p><h4 id="Related-works"><a href="#Related-works" class="headerlink" title="Related works"></a>Related works</h4><p>ç”±äº<strong>æ•°æ®æ ‡æ³¨çš„æ—¶é—´æ¶ˆè€—</strong>å’Œ<strong>ä¸åŒåŸŸä¹‹é—´çš„åŸŸå·®è·</strong>,åŸŸé€‚åº”è¢«ç”¨æ¥è§£å†³è¿™äº›é—®é¢˜,é€šè¿‡é€‚åº”åœ¨æœ‰æ ‡ç­¾çš„æºåŸŸä¸Šè®­ç»ƒçš„æ¨¡å‹æ¥è§£å†³æ— æ ‡ç­¾çš„ç›®æ ‡åŸŸ.</p><p>æœ€è¿‘çš„é¢†åŸŸè‡ªé€‚åº”å·¥ä½œä¸»è¦é’ˆå¯¹ä¸åŒçš„è®¡ç®—æœºè§†è§‰ä»»åŠ¡</p><p>åœ¨é¢†åŸŸè‡ªé€‚åº”ä¸­,ä¸ºäº†æœ€å°åŒ–ä¸åŒé¢†åŸŸä¹‹é—´çš„é¢†åŸŸåç§»,ç‰¹å¾åˆ†å¸ƒå¯ä»¥åœ¨å…±åŒçš„å±‚æ¬¡ä¸Šå¯¹é½ï¼šé¢†åŸŸå±‚æ¬¡å’Œç±»åˆ«å±‚æ¬¡ã€‚</p><p>é¢†åŸŸçº§å¯¹é½é€šå¸¸æ¶‰åŠæœ€å°åŒ–æºå’Œç›®æ ‡ç‰¹å¾åˆ†å¸ƒä¹‹é—´çš„æŸç§è·ç¦»åº¦é‡ï¼Œå¦‚æœ€å¤§å‡å€¼å·®å¼‚.</p><h4 id="Learnable-Feature-Resizer"><a href="#Learnable-Feature-Resizer" class="headerlink" title="Learnable Feature Resizer"></a>Learnable Feature Resizer</h4><p>åœ¨egoä»£ç†ä¸Šè®¡ç®—ç‰¹å¾å›¾ä½œä¸ºsource domain,æ¥å—å…¶ä»–ä»£ç†çš„ç‰¹å¾ä½œä¸ºtarget domain.</p><p>ç‰¹å¾ç¼©æ”¾å™¨Î¦çš„ç›®æ ‡æ˜¯ä»¥å¯å­¦ä¹ çš„æ–¹å¼å°†æºåŸŸç‰¹å¾çš„ç»´åº¦ä¸ç›®æ ‡åŸŸè¿›è¡Œå¯¹é½</p><script type="math/tex; mode=display">F_T^{'}=\Phi(F_T),\mathrm{~s.t.~}F_T^{'}\in\mathbb{R}^{N\times H_S\times W_S\times C_S}</script><p>æˆ‘ä»¬å°†Î¦ä¸å¤šæ™ºèƒ½ä½“æ£€æµ‹æ¨¡å‹è”åˆè®­ç»ƒï¼Œä½¿å…¶èƒ½å¤Ÿæ™ºèƒ½åœ°å­¦ä¹ è°ƒæ•´ç‰¹å¾å°ºå¯¸çš„æœ€ä¼˜æ–¹æ³•ï¼Œè¿™ä¸åŒçº¿æ€§æ’å€¼ç­‰ç®€å•çš„å°ºå¯¸è°ƒæ•´æ–¹æ³•æœ‰æ ¹æœ¬çš„ä¸åŒã€‚</p><p>å¯å­¦ä¹ ç‰¹å¾æˆå½¢æ¨¡çš„ä½“ç³»ç»“æ„è®¾è®¡æ‰€ç¤º,å®ƒåŒ…æ‹¬å››ä¸ªä¸»è¦ç»„ä»¶:é€šé“å¯¹é½å™¨ï¼ŒFAXæˆå½¢æ¨¡ï¼Œè·³è·ƒè¿æ¥å’Œres - blockã€‚</p><p><strong>Channel Aligner</strong>:ä½¿ç”¨ä¸€ä¸ªç®€å•çš„1 Ã— 1å·ç§¯å±‚å¯¹é½é€šé“ç»´åº¦,å…¶è¾“å…¥é€šé“æ•°ä¸º$C_{in}$ = 2$C_S$,è¾“å‡ºCSé€šé“ã€‚å½“$C^T &gt; C^{in}$æ—¶,éšæœºä¸¢å¼ƒ$C^{in} - C^{T}$é€šé“,åº”ç”¨1 Ã— 1å·ç§¯å±‚å¾—åˆ°æ–°çš„ç‰¹å¾.æˆ‘ä»¬åœ¨$F^T$ä¸Šé‡å¤è¿™ä¸ªè¿‡ç¨‹næ¬¡,å¾—åˆ°$nÃ—H^TÃ—W^TÃ—C^S$ç»´åº¦çš„ç‰¹å¾ï¼Œå¹¶æ²¿ç¬¬ä¸€ä¸ªç»´åº¦è¿›è¡Œå¹³å‡ã€‚</p><p>é€šè¿‡è¿™ç§æ–¹å¼,æˆ‘ä»¬æ”¹å–„äº†ç”±äºä¿¡é“è¡°è½é€ æˆçš„ä¿¡æ¯ä¸¢å¤±.å½“$C<em>T$ &lt; $C</em>{in}$æ—¶ï¼Œæˆ‘ä»¬ä»FTä¸­éšæœºé€‰æ‹©é€šé“è¿›è¡Œå¡«å……,ä»¥æ»¡è¶³1 Ã— 1å·ç§¯æ‰€éœ€çš„è¾“å…¥é€šé“æ•°ã€‚</p><p><strong>FAX Resizer</strong></p><p>ç”±äºLiDARç‰¹å¾é€šå¸¸ç”±äºç©ºä½“ç´ è€Œå…·æœ‰ç¨€ç–æ€§,åº”ç”¨å¤§æ ¸å·ç§¯è·å–å…¨å±€ä¿¡æ¯å¯èƒ½ä¼šå°†æ— æ„ä¹‰çš„ä¿¡æ¯æ‰©æ•£åˆ°é‡è¦åŒºåŸŸ.å› æ­¤,æˆ‘ä»¬åœ¨åŒçº¿æ€§ç¼©æ”¾ä¹‹å‰åº”ç”¨äº†èåˆçš„è½´å‘( FAX )æ³¨æ„åŠ›å—,ä»¥è·å¾—æ›´å¥½çš„ç‰¹å¾è¡¨ç¤º.</p><p><strong>è·³è·ƒè¿æ¥</strong>:åœ¨è·³è·ƒè¿æ¥ä¸­,ä½¿ç”¨äº†åŒçº¿æ€§ç‰¹å¾è°ƒæ•´æ–¹æ³•,ä»¥ä½¿å­¦ä¹ æ›´å®¹æ˜“ã€‚</p><p><strong>æ®‹å·®å—</strong>( Res-Block ):åœ¨é‡æ–°è°ƒæ•´ç‰¹å¾å›¾å¤§å°åæ‰§è¡Œæ ‡å‡†æ®‹å·®å—ræ¬¡,ä»¥è¿›ä¸€æ­¥ç»†åŒ–ç‰¹å¾å›¾.</p><h4 id="Sparse-Cross-Domain-Transformer"><a href="#Sparse-Cross-Domain-Transformer" class="headerlink" title="Sparse Cross-Domain Transformer"></a>Sparse Cross-Domain Transformer</h4><p>åœ¨æ£€ç´¢åˆ°ç¼©æ”¾åçš„ç‰¹å¾$F^â€²_{T}$å,éœ€è¦å°†å…¶æ¨¡å¼ä»domain classifierä¸­è½¬æ¢ä¸ºä¸å¯åŒºåˆ†çš„æ¨¡å¼,ä»¥è·å¾—é¢†åŸŸä¸å˜ç‰¹å¾.ä¸ºäº†è¾¾åˆ°è¿™ä¸ªç›®çš„,æˆ‘ä»¬éœ€è¦æœ‰æ•ˆåœ°ä»å±€éƒ¨å’Œå…¨å±€ä¸¤ä¸ªæ–¹é¢æ¥æ¨ç†$F^{â€²}_T$å’Œ$F_S$ä¹‹é—´çš„ç›¸å…³æ€§.å› æ­¤,æˆ‘ä»¬æå‡ºäº†ç¨€ç–è·¨åŸŸtransformer,åœ¨é¿å…æ˜‚è´µè®¡ç®—çš„åŒæ—¶,äº«å—äº†transformeræ¶æ„å¸¦æ¥çš„åŠ¨æ€å’Œå…¨å±€å…³æ³¨çš„å¥½å¤„.</p><script type="math/tex; mode=display">Q=W_{Q}(F_{T}^{'}),\quad K=W_{K}(F_{S}),\quad V=W_{V}(F_{S}),\\\hat{F_{T}^{'}}=Q+LN(FAX(Q,K,V)),\\F_{T}^{''}=\hat{F_{T}^{'}}+LN(FFN(\hat{F_{T}^{'}})),</script><p>å…¶ä¸­LNæ˜¯å±‚æ ‡å‡†åŒ–,Qæ˜¯æŸ¥è¯¢,Kæ˜¯é”®,Væ˜¯å€¼.ç„¶å,æˆ‘ä»¬å°†$F^{â€²â€²}_T$å’Œ$F_S$é…å¯¹åœ¨ä¸€èµ·ï¼Œå¹¶å°†å®ƒä»¬é€å…¥åŸŸåˆ†ç±»å™¨å’Œå¤šæ™ºèƒ½ä½“èåˆæ¨¡å—.</p><h4 id="Domain-Classifier"><a href="#Domain-Classifier" class="headerlink" title="Domain Classifier"></a>Domain Classifier</h4><p>è®¾Xä¸ºå¯èƒ½æ¥è‡ªæºåŸŸæˆ–ç›®æ ‡åŸŸçš„ç‰¹å¾å›¾,h:Xâ†’{ 0,1 }ä¸ºåŸŸåˆ†ç±»å™¨,è¯•å›¾é¢„æµ‹æºåŸŸæ ·æœ¬$X_S$ä¸º0,ç›®æ ‡åŸŸæ ·æœ¬$X_T$ä¸º1</p><script type="math/tex; mode=display">\max_G\min_{h\in H}\left(\mathbf{E}_S(h(X))+\mathbf{E}_T(h(X))\right.</script><h4 id="Multi-Agent-Fusion"><a href="#Multi-Agent-Fusion" class="headerlink" title="Multi-Agent Fusion"></a>Multi-Agent Fusion</h4><p>é€‰æ‹©äº†ä¸€ä¸ªæœ€å…ˆè¿›çš„æ¨¡å‹V2X - ViTä½œä¸ºæˆ‘ä»¬çš„å¤šæ™ºèƒ½ä½“èåˆç®—æ³•ã€‚V2X - ViTä¾æ¬¡é‡‡ç”¨å¼‚æ„å¤šæ™ºèƒ½ä½“è‡ªæ³¨æ„åŠ›å—å’Œå¤šå°ºåº¦çª—å£æ³¨æ„åŠ›å—,å¯¹ä¸åŒæ™ºèƒ½ä½“çš„ç‰¹å¾è¿›è¡Œæ™ºèƒ½èåˆã€‚</p><script type="math/tex; mode=display">\min_{G,M}(\mathbf{E}_D(V)),\quad V=M(F_S,F_T^{''})</script><h3 id="MACP-Efficient-Model-Adaptation-for-Cooperative-Perception-WACV"><a href="#MACP-Efficient-Model-Adaptation-for-Cooperative-Perception-WACV" class="headerlink" title="MACP: Efficient Model Adaptation for Cooperative Perception WACV"></a>MACP: Efficient Model Adaptation for Cooperative Perception WACV</h3><h4 id="abstract"><a href="#abstract" class="headerlink" title="abstract"></a>abstract</h4><p>è½¦å¯¹è½¦ï¼ˆV2Vï¼‰é€šä¿¡é€šè¿‡ä¿¡æ¯å…±äº«å®ç°äº† â€œçœ‹ç©¿é®æŒ¡ç‰©â€ï¼Œæå¤§åœ°å¢å¼ºäº†è”ç½‘å’Œè‡ªåŠ¨é©¾é©¶è½¦è¾†ï¼ˆCAVï¼‰çš„æ„ŸçŸ¥èƒ½åŠ›ï¼Œä»è€Œæ˜¾è‘—æé«˜äº†æ€§èƒ½ã€‚ç„¶è€Œï¼Œå½“ç°æœ‰çš„å•ä¸ªä»£ç†æ¨¡å‹æ˜¾ç¤ºå‡ºå“è¶Šçš„æ³›åŒ–èƒ½åŠ›æ—¶ï¼Œä»å¤´å¼€å§‹å¼€å‘å’Œè®­ç»ƒå¤æ‚çš„å¤šä»£ç†æ„ŸçŸ¥æ¨¡å‹å¯èƒ½æ—¢æ˜‚è´µåˆæ²¡æœ‰å¿…è¦ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬æå‡ºäº†ä¸€ä¸ªåä¸º MACP çš„æ–°æ¡†æ¶ï¼Œå®ƒ<strong>èƒ½ä½¿é¢„å…ˆè®­ç»ƒå¥½çš„å•ä¸ªä»£ç†æ¨¡å‹å…·å¤‡åˆä½œèƒ½åŠ›</strong>ã€‚ä¸ºäº†å®ç°è¿™ä¸€ç›®æ ‡ï¼Œæˆ‘ä»¬<strong>ç¡®å®šäº†ä»å•ä¸€ä»£ç†è½¬å‘åˆä½œè®¾ç½®æ‰€é¢ä¸´çš„å…³é”®æŒ‘æˆ˜ï¼Œå¹¶é€šè¿‡å†»ç»“å¤§éƒ¨åˆ†å‚æ•°å’Œæ·»åŠ ä¸€äº›è½»é‡çº§æ¨¡å—æ¥è°ƒæ•´æ¨¡å‹</strong>ã€‚æˆ‘ä»¬åœ¨å®éªŒä¸­è¯æ˜ï¼Œæ‰€æå‡ºçš„æ¡†æ¶å¯ä»¥æœ‰æ•ˆåœ°åˆ©ç”¨åˆä½œè§‚å¯Ÿï¼Œå¹¶åœ¨æ¨¡æ‹Ÿå’ŒçœŸå®ä¸–ç•Œåˆä½œæ„ŸçŸ¥åŸºå‡†ä¸­ä¼˜äºå…¶ä»–æœ€å…ˆè¿›çš„æ–¹æ³•ï¼ŒåŒæ—¶æ‰€éœ€çš„å¯è°ƒå‚æ•°å¤§å¤§å‡å°‘ï¼Œé€šä¿¡æˆæœ¬ä¹Ÿé™ä½äº†ã€‚</p><h4 id="æ–¹æ³•"><a href="#æ–¹æ³•" class="headerlink" title="æ–¹æ³•"></a>æ–¹æ³•</h4><p>æˆ‘ä»¬çš„ç›®æ ‡æ˜¯æ±‚è§£ä¸€ä¸ªæœ€ä½³æ¨¡å‹ $f^{âˆ—}$ï¼Œè¯¥æ¨¡å‹èƒ½å¤Ÿæ£€æµ‹å’Œåˆ’å®šå‘¨å›´ç‰©ä½“çš„è¾¹ç•Œæ¡†ï¼Œå¹¶åˆ†é…é€‚å½“çš„æ ‡ç­¾.</p><p>ä¸ºäº†ç®€åŒ–ç¬¦å·ï¼Œæˆ‘ä»¬ç”¨ä¸€ä¸ª dâ€²ç»´å‘é‡ $y_jâˆˆR^{dâ€²}$ æ¥è¡¨ç¤ºæ¯ä¸ªè¾¹ç•Œæ¡†åŠå…¶ç±»åˆ«æ ‡ç­¾ã€‚</p><p>åœ¨ä¸å¤±ä¸€èˆ¬æ€§çš„å‰æä¸‹ï¼Œç‰©ä½“æ£€æµ‹æ¨¡å‹ f æ˜¯ä¸€ä¸ªä»ç‚¹äº‘ç©ºé—´åˆ°è¾¹ç•Œæ¡†åŠå…¶æ ‡ç­¾çš„è”åˆç©ºé—´ f : X â†’ Y çš„æ˜ å°„ï¼Œç»è¿‡è®­ç»ƒçš„æ¨¡å‹ç†æƒ³åœ°æè¿°äº†ä»¥è§‚æµ‹ç‚¹äº‘é›† x ä¸ºæ¡ä»¶è§‚æµ‹è¾¹ç•Œæ¡†é›† y çš„æ¦‚ç‡ï¼Œå…¶å€¼ä¸º</p><script type="math/tex; mode=display">p(\mathbf{y}|\mathbf{x};f)=\frac{p(\mathbf{x},\mathbf{y})}{p(\mathbf{x})}</script><p>å¦‚æœæˆ‘ä»¬ç”¨ pS (x) è¡¨ç¤ºåœ¨å•ä¸ªä»£ç†æ„ŸçŸ¥ä¸­è§‚å¯Ÿåˆ°ç‚¹äº‘é›†çš„è¾¹é™…æ¦‚ç‡ï¼Œç”¨ pC(x) è¡¨ç¤ºåœ¨åˆä½œæ„ŸçŸ¥ä¸­è§‚å¯Ÿåˆ°ç²¾ç¡®ç‚¹äº‘é›†çš„æ¦‚ç‡ï¼Œç”±äº V2V é€šä¿¡å…±äº«äº†é¢å¤–çš„ç‚¹äº‘ï¼Œè¿™ä¸¤ä¸ªæ¦‚ç‡å¯èƒ½ä¸åŒï¼Œå³ pS (x) Ì¸= pC(x) ã€‚</p><p>é¢„è®­ç»ƒæ¨¡å‹ç»™å‡ºçš„ç‚¹äº‘å’Œè¾¹ç•Œæ¡†çš„è”åˆåˆ†å¸ƒåç¦»åˆä½œç¯å¢ƒä¸‹çš„åœ°é¢å®å†µè”åˆåˆ†å¸ƒ</p><script type="math/tex; mode=display">\hat{p}_{\mathcal{C}}(\mathbf{x},\mathbf{y};f)=\frac{p_{\mathcal{S}}(\mathbf{x},\mathbf{y})}{p_{\mathcal{S}}(\mathbf{x})}\cdot p_{\mathcal{C}}(\mathbf{x})\neq p_{\mathcal{C}}(\mathbf{x},\mathbf{y}) \\g^*=\underset{g\in\mathcal{G}}{\text{argmin}\mathcal{L}}\left(p_{\mathcal{C}}(\mathbf{x},\mathbf{y}),\hat{p}_{\mathcal{C}}(\mathbf{x},\mathbf{y};f\cdot g)\right) \\p(\mathbf{y}|\mathbf{x};f\cdot g)=g\left\lfloor\frac{p_{\mathcal{S}}(\mathbf{x},\mathbf{y})}{p_{\mathcal{S}}(\mathbf{x})}\right\rfloor</script><p><img data-src="https://s2.loli.net/2024/05/08/GZMfEleua21jYVv.png" alt="image-20240508151535055"></p><h4 id="Convolution-Adapter"><a href="#Convolution-Adapter" class="headerlink" title="Convolution Adapter"></a>Convolution Adapter</h4><p>ConAda æ¨¡å—æ˜¯ç‰¹å¾ç¼–ç å™¨çš„å…³é”®ç»„ä»¶ã€‚ç‰¹å¾ç¼–ç å™¨ç½‘ç»œæ˜¯å·ç§¯å—çš„çº§è”ï¼Œå…¶ä¸­å·ç§¯å±‚çš„è¾“å‡ºç»è¿‡ ConAda æ¨¡å—ï¼Œå¹¶é€šè¿‡æ®‹å·®è¿æ¥åŠ å›è‡ªèº«ã€‚æˆ‘ä»¬åªåœ¨è®­ç»ƒè¿‡ç¨‹ä¸­è®­ç»ƒ ConAda å‚æ•°ï¼Œå¹¶åœ¨å·ç§¯å±‚å’Œ ConAda æ¨¡å—ä¹‹åçš„å…¶ä»–å±‚ä¸­å†»ç»“é¢„è®­ç»ƒå‚æ•°ã€‚</p><p>åŒæ—¶ï¼ŒConAda è¿˜å……å½“è½¦è¾†ä¹‹é—´çš„é€šä¿¡é€šé“ã€‚åœ¨é€šä¿¡è¿‡ç¨‹ä¸­ï¼ŒConAda æ¨¡å—ä¸­çš„ä¸‹å·ç§¯å±‚å’Œæ¿€æ´»å±‚å¸®åŠ©å‹ç¼©å’ŒåŠ å¯†ç¼–ç ç‰¹å¾ï¼Œä»¥ä¾¿è¿›è¡Œå¹¿æ’­ï¼Œè€Œä¸Šå·ç§¯å±‚åˆ™ç”¨äºè§£å‹ç¼©æ¥æ”¶ä¿¡å·ï¼Œä»¥ä¾¿è¿›è¡Œç‰¹å¾èåˆã€‚</p><h4 id="SSF-Operator-for-Fused-Feature"><a href="#SSF-Operator-for-Fused-Feature" class="headerlink" title="SSF Operator for Fused Feature"></a>SSF Operator for Fused Feature</h4><p>æˆ‘ä»¬åœ¨è¿ç»­çš„ç¥ç»ç½‘ç»œå±‚ä¸­æ‰§è¡Œ SSF ç®—å­ï¼Œä»¥è€ƒè™‘åŸŸåç§».</p><p>å‡è®¾å·ç§¯å±‚çš„è¾“å‡ºç‰¹å¾å›¾ç”± $X^{output}_{i,j}$ âˆˆ $R^{Hâ€²Ã—W â€²Ã—Câ€²}$ ç»™å‡ºï¼Œæˆ‘ä»¬ä½¿ç”¨ç¼©æ”¾å› å­ $\gamma$âˆˆ $R^{Câ€²}$å’Œç§»åŠ¨å› å­ Î² âˆˆ $R^{Câ€²}$æ›´æ–°ç‰¹å¾å›¾</p><script type="math/tex; mode=display">X_{i,j}^{\mathrm{output}}=\gamma\odot X_{i,j}^{\mathrm{output}}+\beta</script><p>æœ€å,åŸºäº ConAda çš„é€šä¿¡ä¿¡é“å¯ä»¥çµæ´»å‹ç¼©ä¿¡å·ä¼ è¾“,ä»è€Œç¼“è§£é€šä¿¡ç“¶é¢ˆ.</p><p><img data-src="https://s2.loli.net/2024/05/08/AjeXstVr2Ih6E5g.png" alt="image-20240508165439383"></p><p>è¿™ç¯‡æ–‡ç« ä¸»è¦åŸºäºå¾®è°ƒçš„æ–¹æ³•å’Œæ€æƒ³,ä½¿ç”¨çš„æ˜¯Adapter,æ­¤å¤–è¿˜æœ‰LoRAç­‰.å…³äºå¤§æ¨¡å‹å‹ç¼©æŠ€æœ¯è¿˜æœ‰å‰ªæã€è’¸é¦ä»¥åŠé‡åŒ–ç­‰ç­‰,æ„Ÿè§‰éƒ½å¯ä»¥è¯•è¯•.</p><h3 id="DI-V2X-Learning-Domain-Invariant-Representation-for-Vehicle-Infrastructure-Collaborative-3D-Object-Detection-AAAI"><a href="#DI-V2X-Learning-Domain-Invariant-Representation-for-Vehicle-Infrastructure-Collaborative-3D-Object-Detection-AAAI" class="headerlink" title="DI-V2X: Learning Domain-Invariant Representation for Vehicle-Infrastructure Collaborative 3D Object Detection AAAI"></a>DI-V2X: Learning Domain-Invariant Representation for Vehicle-Infrastructure Collaborative 3D Object Detection AAAI</h3><p><strong>Task</strong> Collaborative 3D Object Detection</p><p><strong>method</strong> learn domain-invariant representation</p><p><strong>inner thoughts</strong>  distillation</p><h4 id="æ‘˜è¦-1"><a href="#æ‘˜è¦-1" class="headerlink" title="æ‘˜è¦"></a>æ‘˜è¦</h4><p>è½¦å¯¹ç‰©ï¼ˆV2Xï¼‰ååŒæ„ŸçŸ¥æœ€è¿‘è·å¾—äº†æå¤§å…³æ³¨ï¼Œå› ä¸ºå®ƒèƒ½å¤Ÿé€šè¿‡æ•´åˆæ¥è‡ªä¸åŒä»£ç†ï¼ˆå¦‚è½¦è¾†å’ŒåŸºç¡€è®¾æ–½ï¼‰çš„ä¿¡æ¯æ¥å¢å¼ºåœºæ™¯ç†è§£èƒ½åŠ›ã€‚<strong>ç„¶è€Œï¼Œç›®å‰çš„ç ”ç©¶é€šå¸¸å¯¹æ¥è‡ªæ¯ä¸ªä»£ç†çš„ä¿¡æ¯ä¸€è§†åŒä»ï¼Œå¿½ç•¥äº†æ¯ä¸ªä»£ç†ä½¿ç”¨ä¸åŒæ¿€å…‰é›·è¾¾ä¼ æ„Ÿå™¨æ‰€é€ æˆçš„å›ºæœ‰é¢†åŸŸå·®è·ï¼Œä»è€Œå¯¼è‡´æ€§èƒ½ä¸å°½å¦‚äººæ„</strong>ã€‚</p><blockquote><p>ä¹Ÿå°±æ˜¯ä¸åŒçš„LiDARä¼ æ„Ÿå™¨æœ¬èº«çš„ä¸åŒä¼šå¯¼è‡´ä¸€ç§domain gap,ä¼šä½¿æ€§èƒ½ä¸‹é™.è¿™ç§è¯´æ³•çœ‹èµ·æ¥make sense,ä½†åŠ ä¸Šä¸€äº›ç¤ºæ„å›¾è¡¥å……å¯èƒ½æ›´å¥½.è¿™ç¯‡æ–‡ç« å°±åŠ äº†ä¸€å¼ .</p></blockquote><p>æå‡ºäº† DI-V2X,æ—¨åœ¨é€šè¿‡ä¸€ä¸ª<strong>æ–°çš„è’¸é¦æ¡†æ¶æ¥å­¦ä¹ é¢†åŸŸä¸å˜è¡¨å¾</strong>,ä»¥å‡è½» V2X 3D ç‰©ä½“æ£€æµ‹ä¸­çš„é¢†åŸŸå·®å¼‚ã€‚</p><p>DI-V2X åŒ…æ‹¬ä¸‰ä¸ªåŸºæœ¬ç»„ä»¶ï¼šåŸŸæ··åˆå®ä¾‹å¢å¼ºï¼ˆDMAï¼‰æ¨¡å—ã€æ¸è¿›å¼åŸŸä¸å˜æ€§è’¸é¦ï¼ˆPDDï¼‰æ¨¡å—å’ŒåŸŸè‡ªé€‚åº”èåˆï¼ˆDAFï¼‰æ¨¡å—.</p><p>å…·ä½“æ¥è¯´,DMA åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ä¸ºæ•™å¸ˆæ¨¡å‹å’Œå­¦ç”Ÿæ¨¡å‹å»ºç«‹äº†ä¸€ä¸ªé¢†åŸŸæ··åˆä¸‰ç»´å®ä¾‹åº“ï¼Œä»è€Œå½¢æˆå¯¹é½çš„æ•°æ®è¡¨ç¤º.æ¥ä¸‹æ¥,PDD é¼“åŠ±æ¥è‡ªä¸åŒé¢†åŸŸçš„å­¦ç”Ÿæ¨¡å‹é€æ­¥å­¦ä¹ ä¸æ•™å¸ˆé¢†åŸŸæ— å…³çš„ç‰¹å¾è¡¨ç¤º,å¹¶åˆ©ç”¨ä»£ç†ä¹‹é—´çš„é‡å åŒºåŸŸä½œä¸ºæŒ‡å¯¼,ä¿ƒè¿›æç‚¼è¿‡ç¨‹.</p><p>æ­¤å¤–,DAF é€šè¿‡æ ¡å‡†æ„ŸçŸ¥é¢†åŸŸè‡ªé€‚åº”æ³¨æ„åŠ›,ç¼©å°äº†å­¦ç”Ÿä¹‹é—´çš„é¢†åŸŸå·®è·.åœ¨å…·æœ‰æŒ‘æˆ˜æ€§çš„ DAIR-V2X å’Œ V2XSet åŸºå‡†æ•°æ®é›†ä¸Šè¿›è¡Œçš„å¤§é‡å®éªŒè¡¨æ˜,DI-V2X æ€§èƒ½å“è¶Š,è¶…è¿‡äº†ä¹‹å‰æ‰€æœ‰çš„ V2X æ¨¡å‹.</p><h4 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h4><p>å®ƒå……åˆ†åˆ©ç”¨ä»ä¸åŒä»£ç†ï¼ˆå³è½¦è¾†å’Œè·¯è¾¹åŸºç¡€è®¾æ–½ï¼‰æ”¶é›†åˆ°çš„ä¼ æ„Ÿå™¨æ•°æ®ï¼Œç²¾ç¡®æ„ŸçŸ¥å¤æ‚çš„é©¾é©¶åœºæ™¯.ä¾‹å¦‚,åœ¨è½¦è¾†è§†çº¿å¯èƒ½å—é˜»çš„æƒ…å†µä¸‹,ç”±äºåŸºç¡€è®¾æ–½çš„è§†è§’ä¸åŒ,å®ƒä»¬æä¾›çš„ä¿¡æ¯å¯ä»¥ä½œä¸ºé‡è¦çš„å†—ä½™.</p><p>ä¸ä»¥å¾€çš„å•è½¦è‡ªåŠ¨é©¾é©¶ç³»ç»Ÿç›¸æ¯”,è¿™ç§åˆä½œä»æ ¹æœ¬ä¸Šæ‰©å¤§äº†æ„ŸçŸ¥èŒƒå›´,å‡å°‘äº†ç›²ç‚¹,æé«˜äº†æ•´ä½“æ„ŸçŸ¥èƒ½åŠ›.</p><p>ä¸ºäº†æœ‰æ•ˆèåˆæ¥è‡ªä¸åŒä»£ç†çš„ä¿¡æ¯,é¢†å…ˆçš„ V2X æ–¹æ³•å€¾å‘äºé‡‡ç”¨åŸºäºç‰¹å¾çš„ä¸­é—´åä½œ,å³ä¸­é—´èåˆï¼‰ã€‚è¿™ç§æ–¹æ³•åœ¨ç‰¹å¾å±‚ä¿ç•™äº†æ¯ä¸ªä»£ç†çš„åŸºæœ¬ä¿¡æ¯ï¼Œç„¶åå¯¹å…¶è¿›è¡Œå‹ç¼©ä»¥æé«˜æ•ˆç‡ã€‚å› æ­¤ï¼Œä¸­é—´èåˆç¡®ä¿äº†æ€§èƒ½ä¸å¸¦å®½çš„æƒè¡¡ï¼Œä¼˜äºæ—©æœŸèåˆæˆ–åæœŸèåˆæ–¹æ³•ï¼Œå‰è€…éœ€è¦åœ¨ä»£ç†ä¹‹é—´ä¼ è¾“åŸå§‹ç‚¹äº‘æ•°æ®ï¼Œè€Œåè€…åˆ™å®¹æ˜“å—åˆ°æ¯ä¸ªæ¨¡å‹äº§ç”Ÿçš„ä¸å®Œæ•´ç»“æœçš„å½±å“ã€‚</p><p>ç„¶è€Œï¼Œå½“å‰çš„ä¸­é—´èåˆæ¨¡å‹ä¸»è¦é›†ä¸­åœ¨å¢å¼ºæ¥è‡ªä¸åŒä»£ç†çš„ç‰¹å¾ä¹‹é—´çš„äº¤äº’ã€‚</p><p>å¦‚å›¾ 1(a)æ‰€ç¤ºï¼Œ<strong>è½¦è¾†å’ŒåŸºç¡€è®¾æ–½å¯èƒ½æ‹¥æœ‰ä¸åŒç±»å‹çš„æ¿€å…‰é›·è¾¾ä¼ æ„Ÿå™¨ï¼Œå› æ­¤ç›´æ¥èåˆä¸åŒæ¥æºçš„ç‚¹äº‘æ•°æ®æˆ–ä¸­é—´ç‰¹å¾éš¾å…ä¼šå½±å“æœ€ç»ˆæ€§èƒ½</strong>ã€‚å› æ­¤ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚ä½•ä»å¤šæºæ•°æ®ä¸­æ˜ç¡®å­¦ä¹ åŸŸä¸å˜è¡¨ç¤ºä»æœ‰å¾…æ¢ç´¢ã€‚</p><p><img data-src="https://s2.loli.net/2024/05/13/D38nvIVKNeUi6xB.png" alt="image-20240513150627484"></p><p>ä¸ºæ­¤ï¼ŒDI-V2X å¼•å…¥äº†ä¸€ç§æ–°çš„å¸ˆç”Ÿæç‚¼æ¨¡å‹.<strong>åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¼ºåˆ¶è¦æ±‚å­¦ç”Ÿæ¨¡å‹ï¼ˆå³è½¦è¾†å’ŒåŸºç¡€è®¾æ–½ï¼‰å­¦ä¹ ä¸æ—©æœŸèåˆçš„æ•™å¸ˆæ¨¡å‹ä¸€è‡´çš„é¢†åŸŸä¸å˜è¡¨ç¤ºæ³•</strong>,å³æŠŠæ¥è‡ªå¤šä¸ªè§†è§’çš„ç‚¹äº‘æ•´åˆä¸ºä¸€ä¸ªæ•´ä½“è§†å›¾æ¥è®­ç»ƒæ•™å¸ˆã€‚<strong>åœ¨æ¨ç†è¿‡ç¨‹ä¸­ï¼Œåªä¿ç•™å­¦ç”Ÿæ¨¡å‹</strong>ã€‚å…·ä½“æ¥è¯´ï¼ŒDI-V2X ç”±ä¸‰ä¸ªå¿…è¦ç»„ä»¶ç»„æˆï¼šé¢†åŸŸæ··åˆå®ä¾‹å¢å¼ºï¼ˆDMAï¼‰æ¨¡å—ã€æ¸è¿›å¼é¢†åŸŸä¸å˜æ€§æç‚¼ï¼ˆPDDï¼‰æ¨¡å—å’Œé¢†åŸŸè‡ªé€‚åº”èåˆï¼ˆDAFï¼‰æ¨¡å—</p><blockquote><p>å…¶å®åŸºç¡€æ€æƒ³å°±æ˜¯è’¸é¦,æä¸€ä¸ªç»“æ„ç›¸ä¼¼ä½†å‚æ•°é‡æ›´å°çš„æ¨¡å‹æ›¿ä»£åŸæœ¬è¾ƒå¤§çš„æ¨¡å‹. å…³é”®æ˜¯è®©å°æ¨¡å‹å­¦ä¼šå¤§æ¨¡å‹çš„â€çŸ¥è¯†â€</p></blockquote><p>DMA çš„ç›®çš„æ˜¯åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­å»ºç«‹ä¸€ä¸ªmixed ground-truth instance bankï¼Œä»¥å¯¹é½æ•™å¸ˆå’Œå­¦ç”Ÿçš„ç‚¹äº‘è¾“å…¥ï¼Œå…¶ä¸­çš„å®ä¾‹æ¥è‡ªè½¦ä¾§ã€è·¯ä¾§æˆ–èåˆä¾§ã€‚</p><p>ä¹‹åï¼ŒPDD çš„ç›®æ ‡æ˜¯åœ¨ä¸åŒé˜¶æ®µï¼Œå³åœ¨é¢†åŸŸé€‚åº”æ€§èåˆä¹‹å‰å’Œä¹‹åï¼Œé€æ­¥å°†ä¿¡æ¯ä»æ•™å¸ˆä¼ é€’ç»™å­¦ç”Ÿ.ä¾‹å¦‚,åœ¨èåˆä¹‹å‰,å¼•å¯¼å­¦ç”Ÿåœ¨<strong>éé‡å åŒºåŸŸåˆ†åˆ«å­¦ä¹ é¢†åŸŸä¸å˜çš„è¡¨å¾</strong>ã€‚è€Œåœ¨èåˆä¹‹åï¼Œæˆ‘ä»¬å°†é‡ç‚¹æ”¾åœ¨é‡å åŒºåŸŸå†…çš„æç‚¼ä¸Šï¼Œå› ä¸ºä¿¡æ¯å·²ç»å¾—åˆ°äº†å¾ˆå¥½çš„æ±‡æ€».</p><p>åœ¨ DAF æ¨¡å—ä¸­ï¼Œæ¥è‡ªä¸åŒé¢†åŸŸçš„ç‰¹å¾ä¼šæ ¹æ®å…¶ç©ºé—´é‡è¦æ€§è¿›è¡Œè‡ªé€‚åº”èåˆã€‚æ­¤å¤–ï¼ŒDAF è¿˜é€šè¿‡æ•´åˆæ ¡å‡†åç§»æ¥å¢å¼ºæ¨¡å‹å¯¹å§¿æ€è¯¯å·®çš„é€‚åº”èƒ½åŠ›ï¼Œä»è€Œç¡®ä¿ V2X æ£€æµ‹æ€§èƒ½çš„ç¨³å¥æ€§ã€‚</p><p><img data-src="https://s2.loli.net/2024/05/13/kZdD3lKJYPfWLue.png" alt="image-20240513214314409"></p><p>åœ¨DMAä¸­,å¯¹äºæ•™å¸ˆæ¨¡å‹,ä½¿ç”¨è½¦ç«¯æ•°æ®,è·¯ç«¯æ•°æ®ä»¥åŠæ—©æœŸèåˆåçš„æ•°æ®(å°±æ˜¯è½¬æ¢åˆ°ç»Ÿä¸€åæ ‡ç³»åçš„ç‚¹äº‘ç»“æœ)åˆ©ç”¨PointPillarsçš„decoderè¿›è¡Œå¢å¼º,ä½¿ç”¨å¢å¼ºåçš„$P_e$,å†ä½¿ç”¨VoxelNetå¤„ç†æˆBEVçš„äºŒç»´ç‰¹å¾å›¾$B_t$.</p><p>å­¦ç”Ÿæ¨¡å‹ç»“æ„è·Ÿæ•™å¸ˆæ¨¡å‹ç±»ä¼¼,å¤„ç†$P_v$å’Œ$P_i$æå–å¾—åˆ°å¯¹åº”ç‰¹å¾å›¾.ç„¶åä½¿ç”¨DAFè¿›è¡Œèåˆå¾—åˆ°$B_f$</p><p>åœ¨è®­ç»ƒçš„æ—¶å€™,åœ¨DAFèåˆä¹‹å‰å’Œä¹‹åä¼šæœ‰ä¸€ä¸ªPDDæ¨¡å‹å°†å­¦ç”Ÿæ¨¡å‹å¾—åˆ°çš„ç‰¹å¾å’Œè€å¸ˆæ¨¡å‹å¾—åˆ°çš„ç‰¹å¾åˆ©ç”¨overlapping areaè¿›è¡Œå¯¹é½.</p><p>DMAæœ¬æ˜¯ç±»ä¼¼ä¸€ä¸ªæ•°æ®å¢å¼ºæ¨¡å—,é¦–å…ˆå°† $P<em>i$ æŠ•å½±åˆ°è‡ªæˆ‘è½¦è¾†çš„åæ ‡ç³»ä¸Šï¼Œè¿™æ · $P^T_i$ =$T(iâ†’v)$$P^T_i$,å…¶ä¸­ $T(iâ†’v)$ âˆˆ $R^{4Ã—4} $æ˜¯åŸºç¡€è®¾æ–½åˆ°è½¦è¾†ç³»ç»Ÿçš„å˜æ¢çŸ©é˜µ.ç„¶å,æˆ‘ä»¬åˆ©ç”¨åœ°é¢å®å†µè¾¹ç•Œæ¡† $B</em>{gt}$ = {$b<em>k$} ä» $P_v$ å’Œ $P_i$ è·å–å®ä¾‹.æ¥è‡ªä¸åŒdomainã€å¯¹åº”äºåŒä¸€åœ°é¢å®å†µå¯¹è±¡çš„å®ä¾‹å°†è¢«åˆå¹¶ï¼Œå¾—åˆ°ä¸€ä¸ªæ—©æœŸèåˆå®ä¾‹ pk = Concat($p^v_k$, $p^i_k$) âˆˆ $R^{N</em>{k}Ã—4}$ï¼Œå…¶ä¸­ $p^v_k$âˆˆ Pv å’Œ $p^i_k$âˆˆ Pi æ˜¯æ¥è‡ªä¸¤ä¸ªé¢†åŸŸã€ä»¥ $b_k$ä¸ºç´¢å¼•çš„å®ä¾‹ç‚¹ã€‚ç”±äºä»£ç†ä¹‹é—´çš„ç›¸å¯¹ä½ç½®ä¼šéšç€è‡ªæˆ‘è½¦è¾†çš„è¿åŠ¨è€Œå‘ç”ŸåŠ¨æ€å˜åŒ–ï¼Œå› æ­¤æœ‰äº›å®ä¾‹å¯èƒ½ä»…æ¥è‡ªå•ä¸ªåŸŸï¼Œè€Œå¦ä¸€äº›å®ä¾‹åˆ™å¯èƒ½ç›´æ¥æ¥è‡ªæ—©æœŸèåˆçš„é‡å åŒºåŸŸã€‚ä¸ºäº†ç¡®å®šæ¯ä¸ªå®ä¾‹çš„åŸŸæ¥æºï¼Œæˆ‘ä»¬é€šè¿‡è®¡ç®—æ¥è‡ªæ¯ä¸ªåŸŸçš„ç‚¹æ¯”ä¾‹ï¼Œå°†è¿™äº›å®ä¾‹åˆ†ä¸ºä¸‰ç±»ï¼š</p><script type="math/tex; mode=display">\begin{aligned}&D_{i} =\{\mathbf{p}_k|N_k^v/(N_k^v+N_k^i)<\tau_l\}  \\&D_{f} =\{\mathbf{p}_k|\tau_l<N_k^v/(N_k^v+N_k^i)<\tau_h\}  \\&D_{v} =\{\mathbf{p}_k|N_k^v/(N_k^v+N_k^i)>\tau_h\} \end{aligned}</script><p>$N^{v}<em>{k}$ å’Œ $N^{i}</em>{k}$ åˆ†åˆ«ä»£è¡¨è½¦è¾†ä¾§å’ŒåŸºç¡€è®¾æ–½ä¾§çš„ç‚¹æ•°ï¼ŒÏ„lã€Ï„h è¡¨ç¤ºé˜ˆå€¼.ç„¶åï¼Œå¾—åˆ°ä¸€ä¸ªå®ä¾‹åº“$D<em>{mixed}$ = $D_i$ âˆª $D_f$ âˆª $D_v$ï¼Œå…¶ä¸­åŒ…å«æ¥è‡ªæ‰€æœ‰é¢†åŸŸï¼ˆå³åŒ…æ‹¬èåˆé¢†åŸŸï¼‰çš„æ··åˆå®ä¾‹ã€‚åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬æŒ‰ç…§ä¸€å®šçš„æ¦‚ç‡ä»$D</em>{mixed}$ä¸­éšæœºæŠ½å–å®ä¾‹ï¼Œå¹¶å°†è¿™äº›å®ä¾‹æ·»åŠ ç»™æ•™å¸ˆå’Œå­¦ç”Ÿ.</p><p>é€šè¿‡æ¶‰åŠä¸åŒé¢†åŸŸçš„å®ä¾‹<strong>å¢å¼ºäº†è®­ç»ƒæ•°æ®çš„å¤šæ ·æ€§</strong>.æ­¤å¤–,ä»æ¯ä¸ªå­¦ç”Ÿçš„è§’åº¦æ¥çœ‹,æ¥è‡ªå…¶ä»–é¢†åŸŸçš„ä¿¡æ¯ä¹Ÿä¼šé€šè¿‡å®ä¾‹çº§æ··åˆè¢«çº³å…¥å…¶ä¸­ï¼ˆZhang ç­‰äººï¼Œ2018 å¹´ï¼‰.è¿™ç§æ–¹æ³•ä»æ ¹æœ¬ä¸Šè°ƒæ•´äº†æ•™å¸ˆæ¨¡å‹å’Œå­¦ç”Ÿæ¨¡å‹ä¹‹é—´çš„æ•°æ®åˆ†å¸ƒ,ä»è€Œåœ¨éšåçš„çŸ¥è¯†æç‚¼è¿‡ç¨‹ä¸­äº§ç”Ÿäº†æ›´å…·æ™®é€‚æ€§çš„ç‰¹å¾ã€‚</p><p>ä¸ºäº†è·å¾—è·ŸåŸŸæ— å…³çš„ç‰¹å¾,é‡‡ç”¨äº†ä¸¤é˜¶æ®µè’¸é¦ç­–ç•¥ï¼Œå³åœ¨é¢†åŸŸè‡ªé€‚åº”èåˆï¼ˆDAFï¼‰æ¨¡å—ä¹‹å‰å’Œä¹‹åè¿›è¡Œè’¸é¦ã€‚ç¬¬ä¸€ä¸ªè’¸é¦é˜¶æ®µæ˜¯å°†å­¦ç”Ÿçš„åˆ†å¸ƒä¸æ•™å¸ˆæ¨¡å‹ç›¸ä¸€è‡´ï¼Œä½œä¸º DAF çš„è¾“å…¥ï¼Œè¿™å¯¹å‡†ç¡®çš„ä¿¡æ¯èåˆè‡³å…³é‡è¦ã€‚</p><p>ç„¶è€Œï¼Œæ ¹æ®ç»éªŒå‘ç°ï¼Œç›´æ¥å¯¹å­¦ç”Ÿå’Œæ•™å¸ˆä¹‹é—´çš„æ•´ä¸ªç‰¹å¾å›¾è¿›è¡Œè’¸é¦ä¼šäº§ç”Ÿæ¬¡ä¼˜æ€§èƒ½.ä¸ºæ­¤é€‰æ‹©åœ¨ç¬¬ä¸€é˜¶æ®µå¯¹éé‡å åŒºåŸŸè¿›è¡Œè’¸é¦.åœ¨ç¬¬äºŒé˜¶æ®µ,ç”±äºå­¦ç”Ÿç‰¹å¾å·²é€šè¿‡ DAF å¾—åˆ°å¾ˆå¥½çš„èåˆ,æˆ‘ä»¬å¯ä»¥é›†ä¸­ç²¾åŠ›å¯¹é‡å åŒºåŸŸè¿›è¡Œè’¸é¦.è¿™ç§ä¸¤é˜¶æ®µçš„æç‚¼è¿‡ç¨‹å¯ä½¿å­¦ç”Ÿæ¨¡å‹ä¸æ¥è‡ªä¸åŒåŒºåŸŸçš„æ•™å¸ˆæ¨¡å‹çš„ç‰¹å¾è¡¨ç¤ºç›¸åŒ¹é…,ä»è€Œç¼©å°å­¦ç”Ÿä¹‹é—´çš„å·®è·.</p><p>åœ¨èåˆä¹‹å‰çš„è’¸é¦,é¦–å…ˆéœ€è¦è®¡ç®—é‡å æ©ç ,ä»¥ç¡®å®šé‡å åŒºåŸŸ.</p><p>å°†åŸºç¡€è®¾æ–½ä¸€ä¾§çš„æ„ŸçŸ¥åŒºåŸŸè½¬æ¢åˆ°è½¦è¾†ä¸€ä¾§ï¼Œå¾—åˆ°ä¸€ä¸ªæ–°çš„çŸ©å½¢ $A<em>i$ = ($x_i,y_i,2R_x, 2R_y, Î¸_i$)ã€‚ç„¶åæˆ‘ä»¬å¯ä»¥è®¡ç®— $A_v$ å’Œ $A_i$ ä¹‹é—´çš„é‡å åŒºåŸŸï¼Œå³ $P</em>{overlap}$ = Intersection($A<em>v$ï¼Œ$A_i$)ã€‚ç„¶åå¯¹å¾—åˆ°çš„ $P</em>{overlap}$ï¼ˆå³å¤šè¾¹å½¢ï¼‰è¿›è¡Œä¸‹é‡‡æ ·,ä»¥åŒ¹é…ç‰¹å¾åœ°å›¾ $B_v$ âˆˆ $R^{HÃ—W Ã—C}$ çš„å¤§å°.</p><script type="math/tex; mode=display">\left.\mathbf{M}(i,j)=\left\{\begin{array}{cc}1&,&\mathrm{if~}(i,j)\in\mathbf{P}_{overlap}\\0&,&\mathrm{otherwise}\end{array}\right.\right.</script><p>M(i, j) âˆˆ 0, 1 è¡¨ç¤ºï¼ˆi, jï¼‰åæ ‡å¤„çš„äºŒè¿›åˆ¶å€¼ã€‚é€šè¿‡åªå¯¹éé‡å åŒºåŸŸ è¿›è¡Œæç‚¼,æˆ‘ä»¬å…è®¸æ¯ä¸ªå­¦ç”Ÿé›†ä¸­å­¦ä¹ ä¸å„è‡ªé¢†åŸŸä¸€è‡´çš„è¡¨å¾ã€‚è¿™å°±é¿å…äº†å¼ºåˆ¶è¦æ±‚ä¸å®Œæ•´çš„å­¦ç”Ÿç‰¹å¾å‘æ•™å¸ˆçš„å®Œæ•´ç‰¹å¾å­¦ä¹ çš„ä¸¥æ ¼çº¦æŸ</p><script type="math/tex; mode=display">\begin{aligned}\mathcal{L}_{da}& =\mathcal{L}_1(\mathbf{B}_t,\mathbf{B}_v\odot\tilde{\mathbf{M}}_v)+\mathcal{L}_1(\mathbf{B}_t,\mathbf{B}_i\odot\tilde{\mathbf{M}}_i)  \\&=\frac1{HW}\sum_m^H\sum_m^W|\mathbf{B}_t(m,n)-\mathbf{B}_v(m,n)|\times\tilde{\mathbf{M}}_v(m,n) \\&+\frac1{HW}\sum_m^H\sum_n^W|\mathbf{B}_t(m,n)-\mathbf{B}_i(m,n)|\times\tilde{\mathbf{M}}_i(m,n)\end{aligned}</script><p>åœ¨èåˆåçš„è’¸é¦,ä½¿ç”¨ DAF æ¨¡å—æœ‰æ•ˆåœ°åˆå¹¶äº†æ¥è‡ªä¸åŒé¢†åŸŸçš„å­¦ç”Ÿç‰¹å¾.å› æ­¤,æˆ‘ä»¬å¾—åˆ°äº†ä¸€ä¸ªèƒ½åŠ›å¾ˆå¼ºçš„èåˆè¡¨å¾,ç”¨ Bf è¡¨ç¤º,å®ƒå¯ä»¥ä¸æ•™å¸ˆçš„ç‰¹å¾è¡¨å¾ $B_t$ é…å¯¹.</p><p>ç›´è§‚åœ°è¯´,Bt æ˜¯é€šè¿‡æ··åˆç‚¹äº‘æ•°æ®çš„æ—©æœŸåä½œè·å¾—çš„,å…¶æœ¬è´¨ä¸Šæ¶‰åŠæœ€å°çš„ä¿¡æ¯æŸå¤±.é€šè¿‡å¼ºåˆ¶ä¸­é—´èåˆç‰¹å¾ $B_f$ é€æ­¥ä¸$B_t$ ä¿æŒä¸€è‡´,å¯ä»¥æœ‰æ•ˆåœ°ç¡®ä¿åœ¨æ•´ä¸ªå­¦ä¹ è¿‡ç¨‹ä¸­å§‹ç»ˆæ•´åˆé€šè¿‡æ—©æœŸèåˆé˜¶æ®µè·å¾—çš„åŸºæœ¬çŸ¥è¯†,ä»è€Œå½¢æˆä¸é¢†åŸŸæ— å…³çš„ç‰¹å¾è¡¨å¾.</p><p>æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥è¶…è¶Šç‰¹å¾çº§å¯¹é½ï¼Œæ‰©å±•åˆ°é¢„æµ‹çº§å¯¹é½.ç”±äºæˆ‘ä»¬çš„æœ€ç»ˆç›®æ ‡æ˜¯ä»ä¸¤ä¸ª $B_f$ è§£ç å‡ºæœ€ç»ˆçš„ä¸‰ç»´è¾¹ç•Œæ¡†ï¼Œç¡®ä¿é¢„æµ‹å±‚é¢çš„å¯¹é½å°†è¿›ä¸€æ­¥æé«˜ç»“æœçš„ä¸€è‡´æ€§å’Œå‡†ç¡®æ€§.</p><script type="math/tex; mode=display">\begin{aligned}\mathcal{L}_{f}& =\mathcal{L}_1(\mathbf{B}_t,\mathbf{B}_f\odot\mathbf{M}_v)  \\&=\frac1{HW}\sum_m^H\sum_m^W|\mathbf{B}_t(m,n)-\mathbf{B}_f(m,n)|\times\tilde{\mathbf{M}}_v(m,n)\end{aligned}</script><script type="math/tex; mode=display">\begin{aligned}\mathcal{L}_{p}& =\mathcal{L}_{class}+\mathcal{L}_{regression}  \\&=\frac1K\sum_k^K(|\mathbf{c}_k-\mathbf{c}_k^s|+|\mathbf{r}_k-\mathbf{r}_k^s|)\end{aligned}</script><script type="math/tex; mode=display">\mathcal{L}=\mathcal{L}_{detect}+\lambda_{kd}(\mathcal{L}_{da}+\mathcal{L}_f+\mathcal{L}_p)</script><p>DAF æ¨¡å—çš„ç›®æ ‡æ˜¯èšåˆè½¦è¾†å’ŒåŸºç¡€è®¾æ–½çš„ç‰¹å¾,åˆ›å»ºä¸€ä¸ªåŒ…å«å„é¢†åŸŸæœ‰ä»·å€¼ä¿¡æ¯çš„å¢å¼ºè¡¨ç¤º.ç„¶è€Œ,è¿™ä¸€èåˆè¿‡ç¨‹é¢ä¸´ç€ä¸¤å¤§æŒ‘æˆ˜:åŒæ–¹å§¿åŠ¿çš„æ½œåœ¨é”™ä½å’Œè®¾è®¡åˆé€‚çš„ç‰¹å¾äº¤äº’ç­–ç•¥.</p><p><img data-src="https://s2.loli.net/2024/05/14/s9KUC8vfEXOgTNb.png" alt="image-20240514152437112"></p><p>ç”±äº<strong>ä¼ æ„Ÿå™¨å™ªå£°</strong>ã€<strong>åŠ¨æ€è¿åŠ¨</strong>å’Œä¸åŒæ—¶é—´æˆ³çš„ä¸ä¸€è‡´æ€§ç­‰åŸå› ï¼Œç°å®ä¸–ç•Œä¸­è½¦è¾†å’ŒåŸºç¡€è®¾æ–½çš„ç›¸å¯¹å§¿æ€å¾ˆå®¹æ˜“å—åˆ°å½±å“ï¼Œè¿™å°†å½±å“ V2X æ„ŸçŸ¥çš„å‡†ç¡®æ€§.ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜,åˆ©ç”¨æ ¡å‡†åç§»æ¥åŠ¨æ€çº æ­£æ½œåœ¨çš„å§¿åŠ¿è¯¯å·®.</p><p>é¦–å…ˆç”¨å·ç§¯å±‚é¢„æµ‹æ ¡å‡†åç§»,ä½¿$B_i$ä¸$B_v$æ›´å¥½åœ°å¯¹é½,è®°ä¸º</p><script type="math/tex; mode=display">\Delta_{(i\to v)}=\text{Conv}(\text{Concat}(\mathbf{B}_v,\mathbf{B}_i))\in\mathbb{R}^{H\times W\times2}</script><script type="math/tex; mode=display">\mathbf{B}_i^{^{\prime}}(p_k)=\mathbf{B}_i(p_k+\mathbf{\Delta}_{(i\to v)}(p_k)),0\leq k<HW</script><script type="math/tex; mode=display">\mathbf{A}_d=\mathrm{Softmax}(\mathrm{Conv}(\mathbf{B}_{cat}))\in\mathbb{R}^{H\times W\times C\times2}\\\mathbf{A}_s=\mathrm{Conv}(\mathbf{B}_{cat})+\max(\mathbf{B}_{cat})\\\mathbf{B}_f=\mathrm{Conv}(\mathbf{A}_d\odot\mathbf{A}_s\cdot\mathbf{B}_{cat})\in\mathbb{R}^{H\times W\times C}</script><p>ç©ºé—´è‡ªé€‚åº”æ³¨æ„åŠ›å¯ä»¥é€šè¿‡èšåˆå¤šç²’åº¦ç‰¹å¾,æä¾›ç¨³å¥è€Œçµæ´»çš„æ³¨æ„åŠ›å›¾</p><p>æœ€åç»“æœå±•ç¤ºåŒ…æ‹¬åœ¨ä¸¤ä¸ªæ•°æ®é›†ä¸Šä¸No fusion,earlyå’Œlate fusionä»¥åŠä¸€äº›åˆ—ç»å…¸ä¸­æœŸèåˆæ¨¡å‹å¯¹æ¯”.</p><p>ç„¶åè¯æ˜domain generalizationå®éªŒè¯æ˜æ¨¡å‹å­¦åˆ°äº†åŸŸä¸å˜çš„ç‰¹å¾.æ­¤å¤–è¿˜æœ‰æ¶ˆèå®éªŒ,è¯æ˜æå‡ºçš„æ¯ä¸ªç»„ä»¶çš„ä½œç”¨.</p><p><img data-src="https://s2.loli.net/2024/05/14/v4PD6HNOp1ercGx.png" alt="image-20240514172721623"></p><p><img data-src="https://s2.loli.net/2024/05/14/MA5Ia4qDBscdp1L.png" alt="image-20240514172919650"></p><h3 id="Model-Agnostic-Multi-Agent-Perception-Framework-ICRA"><a href="#Model-Agnostic-Multi-Agent-Perception-Framework-ICRA" class="headerlink" title="Model-Agnostic Multi-Agent Perception Framework  ICRA"></a>Model-Agnostic Multi-Agent Perception Framework  ICRA</h3><h3 id="Abs"><a href="#Abs" class="headerlink" title="Abs"></a>Abs</h3><p>ç°æœ‰çš„å¤šæ™ºèƒ½ä½“æ„ŸçŸ¥ç³»ç»Ÿå‡è®¾æ¯ä¸ªæ™ºèƒ½ä½“ä½¿ç”¨ç›¸åŒçš„æ¨¡å‹ï¼Œå…·æœ‰ç›¸åŒçš„å‚æ•°å’Œç»“æ„ï¼Œè¿™åœ¨ç°å®ä¸–ç•Œä¸­å¾€å¾€æ˜¯ä¸åˆ‡å®é™…çš„.å½“æ„ŸçŸ¥<strong>æ¨¡å‹å­˜åœ¨æ˜æ˜¾å·®å¼‚æ—¶,å¤šæ™ºèƒ½ä½“ç³»ç»Ÿå¸¦æ¥çš„æ˜¾è‘—æ€§èƒ½æå‡ä¼šæ˜¾è‘—é™ä½</strong>.</p><p>åœ¨è¿™é¡¹å·¥ä½œä¸­,æˆ‘ä»¬æå‡ºäº†ä¸€ä¸ªmodel-agnosticçš„å¤šAgentæ¡†æ¶,<strong>ä»¥å‡å°‘æ¨¡å‹å·®å¼‚å¸¦æ¥çš„è´Ÿé¢å½±å“</strong>ï¼Œå¹¶ä¿æŒæœºå¯†æ€§(éšç§?).å…·ä½“æ¥è¯´,æˆ‘ä»¬é€šè¿‡é›†æˆä¸€ä¸ªæ–°é¢–çš„ä¸ç¡®å®šæ€§æ ¡å‡†å™¨æ¥è€ƒè™‘æ™ºèƒ½ä½“ä¹‹é—´çš„æ„ŸçŸ¥å¼‚è´¨æ€§,<strong>è¯¥æ ¡å‡†å™¨å¯ä»¥æ¶ˆé™¤æ™ºèƒ½ä½“é¢„æµ‹ç½®ä¿¡åº¦è¯„åˆ†ä¹‹é—´çš„åå·®</strong>.æ¯ä¸ªä»£ç†åœ¨ä¸€ä¸ªæ ‡å‡†çš„å…¬å…±æ•°æ®åº“ä¸Šç‹¬ç«‹åœ°æ‰§è¡Œè¿™ç§æ ¡å‡†,å› æ­¤çŸ¥è¯†äº§æƒå¯ä»¥å¾—åˆ°ä¿æŠ¤ã€‚</p><p>ä¸ºäº†è¿›ä¸€æ­¥ç»†åŒ–æ£€æµ‹ç²¾åº¦,æˆ‘ä»¬è¿˜æå‡ºäº†ä¸€ç§æ–°çš„ç®—æ³•,ç§°ä¸ºâ€ä¿ƒè¿›-æŠ‘åˆ¶èšåˆâ€ ( Promotion-Suppression Aggregationï¼ŒPSA ),è¯¥ç®—æ³•<strong>ä¸ä»…è€ƒè™‘äº†proposalsçš„ç½®ä¿¡åº¦è¯„åˆ†,è¿˜è€ƒè™‘äº†å…¶é‚»å±…çš„ç©ºé—´ä¸€è‡´æ€§</strong>.</p><p>æˆ‘ä»¬çš„å®éªŒå¼ºè°ƒäº†è·¨ä¸åŒä»£ç†è¿›è¡Œæ¨¡å‹æ ¡å‡†çš„å¿…è¦æ€§,ç»“æœè¡¨æ˜æˆ‘ä»¬æå‡ºçš„æ–¹æ³•åœ¨å¼€æ”¾çš„OPV2Væ•°æ®é›†ä¸Šçš„3Dç›®æ ‡æ£€æµ‹æ€§èƒ½ä¼˜äºæœ€å…ˆè¿›çš„åŸºçº¿æ–¹æ³•.</p><h3 id="Intro"><a href="#Intro" class="headerlink" title="Intro"></a>Intro</h3><p>æ·±åº¦å­¦ä¹ çš„æœ€æ–°è¿›å±•æé«˜äº†ç°ä»£æ„ŸçŸ¥ç³»ç»Ÿåœ¨è®¸å¤šä»»åŠ¡ä¸Šçš„æ€§èƒ½ï¼Œå¦‚ç›®æ ‡æ£€æµ‹ã€è¯­ä¹‰åˆ†å‰²å’Œè§†è§‰å¯¼èˆªã€‚å°½ç®¡å–å¾—äº†ä»¤äººç©ç›®çš„è¿›å±•ï¼Œä½†ç”±äºå•è§†è§’çš„é™åˆ¶ï¼Œå•æ™ºèƒ½ä½“æ„ŸçŸ¥ç³»ç»Ÿä»ç„¶å­˜åœ¨è®¸å¤šå±€é™æ€§ã€‚ä¾‹å¦‚ï¼Œè‡ªåŠ¨é©¾é©¶è½¦è¾†( Autonomous Vehiclesï¼ŒAVs )é€šå¸¸ä¼šé­å—é®æŒ¡ï¼Œç”±äºç¼ºä¹å¯¹é®æŒ¡åŒºåŸŸçš„æ„Ÿå®˜è§‚å¯Ÿï¼Œè¿™ç§æƒ…å†µå¾ˆéš¾å¤„ç†ã€‚ä¸ºäº†è§£å†³è¿™ä¸€é—®é¢˜ï¼Œ<strong>æœ€è¿‘çš„ç ”ç©¶æ¢ç´¢äº†æ— çº¿é€šä¿¡æŠ€æœ¯ï¼Œä½¿é™„è¿‘çš„æ™ºèƒ½ä½“èƒ½å¤Ÿå…±äº«æ„ŸçŸ¥ä¿¡æ¯å¹¶ååŒæ„ŸçŸ¥å‘¨å›´ç¯å¢ƒ</strong>ã€‚</p><p>å°½ç®¡ç°æœ‰æ–¹æ³•è·å¾—äº†æ˜¾è‘—çš„3Dç›®æ ‡æ£€æµ‹æ€§èƒ½æå‡ï¼Œä½†å®ƒä»¬å‡è®¾æ‰€æœ‰åä½œæ™ºèƒ½ä½“å…±äº«ç›¸åŒçš„æ¨¡å‹ï¼Œä¸”å…·æœ‰ç›¸åŒçš„å‚æ•°ï¼Œè¿™åœ¨å®é™…ä¸­å¾€å¾€ä¸æˆç«‹ï¼Œç‰¹åˆ«æ˜¯åœ¨è‡ªåŠ¨é©¾é©¶ä¸­ã€‚åœ¨AVä¹‹é—´åˆ†é…æ¨¡å‹å‚æ•°å¯èƒ½ä¼šå¼•èµ·éšç§å’Œä¿å¯†é—®é¢˜ï¼Œç‰¹åˆ«æ˜¯å¯¹äºæ¥è‡ªä¸åŒæ±½è½¦å…¬å¸çš„è½¦è¾†ã€‚å¯¹åŒæ­¥è‰¯å¥½çš„æ£€æµ‹å™¨çš„ä¾èµ–æ˜¯ä¸å¯é çš„ï¼Œå› ä¸ºAVå¯èƒ½å…·æœ‰ä¸åŒçš„æ›´æ–°é¢‘ç‡</p><p>å¦‚æœä¸å¦¥å–„å¤„ç†ä¸ä¸€è‡´æ€§æŒ‘æˆ˜ï¼Œå…±äº«çš„æ„ŸçŸ¥ä¿¡æ¯å¯èƒ½å­˜åœ¨è¾ƒå¤§çš„é¢†åŸŸé¸¿æ²Ÿï¼Œå¤šæ™ºèƒ½ä½“æ„ŸçŸ¥å¸¦æ¥çš„ä¼˜åŠ¿å°†è¿…é€Ÿå‡å¼±ã€‚</p><p>ç”±äºä¸åŒä¸»ä½“ä½¿ç”¨çš„æ¨¡å‹ä¸åŒï¼Œä¸åŒä¸»ä½“æä¾›çš„ç½®ä¿¡åº¦å¾—åˆ†å¯èƒ½å­˜åœ¨ç³»ç»Ÿæ€§åå·®ï¼Œå³ä¸åŒä¸»ä½“å…·æœ‰ä¸åŒçš„ç½®ä¿¡åº¦ä¼°è®¡åå·®ã€‚</p><p>ä¸€äº›ä»£ç†ç½®ä¿¡åº¦æ›´é«˜å¦ä¸€äº›è¾ƒä½,å¿½ç•¥è¿™ç§åè§å¹¶é€šè¿‡éæå¤§å€¼æŠ‘åˆ¶( NMS )ç›´æ¥èåˆæ¥è‡ªç›¸é‚»ä»£ç†çš„è¾¹ç•Œæ¡†å»ºè®®ï¼Œå¯èƒ½ä¼šç”±äºå­˜åœ¨è¿‡åº¦è‡ªä¿¡ä½†ä½è´¨é‡çš„å»ºè®®è€Œå¯¼è‡´è¾ƒå·®çš„æ£€æµ‹ç²¾åº¦ã€‚</p><p><img data-src="https://s2.loli.net/2024/05/29/CBp764zMDr8Ooil.png" alt="image-20240529212209574"></p><p>ä¸€äº›ä»£ç†çš„ä¿¡å¿ƒåˆ†æ•°ç³»ç»Ÿæ€§åœ°å¤§äºå…¶ä»–ä»£ç†äºº,ä¾‹å¦‚,è“è‰²åˆ†æ•°ç›¸å¯¹äºæ©™è‰²åˆ†æ•°,ç„¶è€Œ,ä»–ä»¬å¯èƒ½è¿‡åº¦è‡ªä¿¡å¹¶æä¾›è¯¯å¯¼æ€§å»ºè®®.æ ¹æ®ç½®ä¿¡åº¦å¾—åˆ†å¯¹å»ºè®®è¿›è¡Œèåˆ,è€Œä¸è¿›è¡Œé€‚å½“çš„æ ¡å‡†å¯èƒ½ä¼šåˆ é™¤æ­£ç¡®çš„å»ºè®®.ç½®ä¿¡åº¦å¾—åˆ†ç¨ä½(æ©™è‰²)ä½†ä¸é‚»è¿‘æ¡†å…·æœ‰è¾ƒé«˜ç©ºé—´ä¸€è‡´æ€§çš„æè®®å¯ä»¥ä¼˜äºç½®ä¿¡åº¦å¾—åˆ†è¾ƒé«˜çš„å•ä¸ªæè®®.</p><p>åœ¨æˆ‘ä»¬çš„æ¡†æ¶ä¸­,æˆ‘ä»¬é›†æˆäº†ä¸€ä¸ªçµæ´»è€Œç®€å•çš„ä¸ç¡®å®šæ€§æ ¡å‡†å™¨,ç§°ä¸ºåŒè¾¹ç•Œæ ¡å‡†( Doubly Bounded Scalingï¼ŒDBS ),ä»¥å‡è½»å¤±è°ƒã€‚</p><p>æ­¤å¤–,åœ¨bbox aggregationé˜¶æ®µï¼Œæˆ‘ä»¬è¿˜æå‡ºäº†ä¸€ä¸ªæ–°çš„æ¨¡å—- -ä¿ƒè¿›-æŠ‘åˆ¶èšåˆ( Promotion-Suppression Aggregationï¼ŒPSA ),ä»¥æ›¿ä»£ç»å…¸çš„NMS,å¹¶åˆ©ç”¨box proposalsåœ¨Agentä¹‹é—´çš„ç©ºé—´ç›¸å…³æ€§å’Œä¸€è‡´æ€§,è¿›ä¸€æ­¥ç»†åŒ–æœ€ç»ˆç»“æœ.</p><p>æˆ‘ä»¬åœ¨ä¸€ä¸ªå¼€æºçš„å¤§è§„æ¨¡å¤šæ™ºèƒ½ä½“æ„ŸçŸ¥æ•°æ®é›†OPV2V [ 12 ]ä¸Šè¯„ä¼°äº†æˆ‘ä»¬çš„æ–¹æ³•ã€‚å®éªŒè¡¨æ˜ï¼Œå½“æ¶‰åŠåˆ°æ™ºèƒ½ä½“ä¹‹é—´çš„æ¨¡å‹å·®å¼‚æ—¶ï¼Œæˆ‘ä»¬çš„æ¡†æ¶æ˜¾è‘—æé«˜äº†åŸºäºå¤šæ™ºèƒ½ä½“LiDARçš„ä¸‰ç»´ç›®æ ‡æ£€æµ‹æ€§èƒ½ï¼Œåœ¨å¹³å‡ç²¾åº¦( Average Precisionï¼ŒAP )æ–¹é¢æ¯”ç°æœ‰æ–¹æ³•è‡³å°‘æé«˜äº†6 %ã€‚</p><h4 id="Methodology"><a href="#Methodology" class="headerlink" title="Methodology"></a>Methodology</h4><p>åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬è€ƒè™‘äº†å¼‚æ„å¤šæ™ºèƒ½ä½“ç³»ç»Ÿä¸­çš„åä½œæ„ŸçŸ¥ï¼Œå…¶ä¸­æ™ºèƒ½ä½“é€šä¿¡ä»¥å…±äº«æ¥è‡ªä¸åŒæ„ŸçŸ¥æ¨¡å‹çš„æ„ŸçŸ¥ä¿¡æ¯ï¼Œè€Œä¸æ³„éœ²æ¨¡å‹ä¿¡æ¯ï¼Œå³æ¨¡å‹ä¸å¯çŸ¥åä½œã€‚</p><p>æˆ‘ä»¬ä¸“æ³¨äºè‡ªåŠ¨é©¾é©¶ä¸­çš„3D LiDARæ£€æµ‹ä»»åŠ¡ï¼Œä½†è¯¥æ–¹æ³•ä¹Ÿå¯ä»¥å®šåˆ¶å¹¶ç”¨äºå…¶ä»–ååŒæ„ŸçŸ¥åº”ç”¨ä¸­ã€‚æˆ‘ä»¬çš„ç›®æ ‡æ˜¯å¼€å‘ä¸€ä¸ªå¥å£®çš„æ¡†æ¶æ¥å¤„ç†ä»£ç†ä¹‹é—´çš„å¼‚è´¨æ€§ï¼ŒåŒæ—¶ä¿æŒæœºå¯†æ€§ã€‚</p><p>å› æ­¤ï¼Œæˆ‘ä»¬æå‡ºäº†ä¸€ä¸ªæ¨¡å‹ä¸å¯çŸ¥çš„é›†ä½“æ„ŸçŸ¥æ¡†æ¶ï¼Œå¯ä»¥åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µã€‚<strong>åœ¨ç¦»çº¿é˜¶æ®µï¼Œæˆ‘ä»¬è®­ç»ƒäº†ä¸€ä¸ªæ¨¡å‹ç‰¹å®šçš„æ ¡å‡†å™¨ã€‚åœ¨åœ¨çº¿é˜¶æ®µï¼Œå¯¹å®æ—¶çš„é“è·¯ä¼ æ„Ÿä¿¡æ¯è¿›è¡Œæ ¡å‡†å’Œæ±‡æ€»ã€‚</strong></p><p><img data-src="https://s2.loli.net/2024/05/29/mRenpvsdrHfqyih.png" alt="image-20240529215358768"></p><h3 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h3><p>åœ¨åˆä½œæ„ŸçŸ¥æƒ…å¢ƒä¸‹ï¼Œæ¥è‡ªä¸åŒçš„ä»£ç†äººå…·æœ‰å¼‚è´¨æ€§æ¨¡å¼ã€‚ç”±äºæœºå¯†æ€§çš„è€ƒè™‘ï¼Œä¸æ¨¡å‹å’Œå‚æ•°ç›¸å…³çš„ä¿¡æ¯ä¸åº”è¯¥è¢«é€éœ²ç»™å…¶ä»–ä»£ç†ã€‚</p><p>ç”±äºæœºå¯†æ€§çš„è€ƒè™‘ï¼Œä¸æ¨¡å‹å’Œå‚æ•°ç›¸å…³çš„ä¿¡æ¯ä¸åº”è¯¥è¢«é€éœ²ç»™å…¶ä»–ä»£ç†ã€‚åœ¨è¿™é¡¹å·¥ä½œä¸­ï¼Œæˆ‘ä»¬<strong>æå‡ºäº†ä¸€ä¸ªæ¨¡å‹æ— å…³çš„åä½œæ¡†æ¶,è§£å†³äº†çº¯æ™šæœŸèåˆç­–ç•¥çš„ä¸¤ä¸ªå…³é”®æŒ‘æˆ˜.</strong>é¦–å…ˆï¼Œæˆ‘ä»¬æå‡ºäº†ä¸€ä¸ªDoubly Bounded Scalingä¸ç¡®å®šæ€§æ ¡å‡†å™¨æ¥å¯¹é½ä¸åŒæ™ºèƒ½ä½“çš„ç½®ä¿¡åº¦å¾—åˆ†åˆ†å¸ƒã€‚å…¶æ¬¡ï¼Œæ–°çš„æå‡æŠ‘åˆ¶èšåˆç®—æ³•é€šè¿‡å……åˆ†åˆ©ç”¨å…±äº«ä¿¡æ¯(bounding box spatial congruence and confidence score propagation.)ï¼Œè¿›ä¸€æ­¥æé«˜äº†æ£€æµ‹ç²¾åº¦ã€‚</p><p>åœ¨å¤§è§„æ¨¡åä½œæ„ŸçŸ¥æ•°æ®é›†ä¸Šçš„å®éªŒè¡¨æ˜äº†è·¨å¼‚æ„ä»£ç†è¿›è¡Œæ¨¡å‹æ ¡å‡†çš„å¿…è¦æ€§ã€‚ç»“æœè¡¨æ˜ï¼Œå½“ä¸åŒçš„æ™ºèƒ½ä½“ä½¿ç”¨ä¸åŒçš„æ„ŸçŸ¥æ¨¡å‹æ—¶ï¼Œç»“åˆæ‰€æå‡ºçš„ä¸¤ç§æŠ€æœ¯å¯ä»¥æé«˜åä½œ3Dç›®æ ‡æ£€æµ‹çš„</p><h2 id="Sim2Real"><a href="#Sim2Real" class="headerlink" title="Sim2Real"></a>Sim2Real</h2><h3 id="S2R-ViT-for-Multi-Agent-Cooperative-Perception-Bridging-the-Gap-from-Simulation-to-Reality-ICRA"><a href="#S2R-ViT-for-Multi-Agent-Cooperative-Perception-Bridging-the-Gap-from-Simulation-to-Reality-ICRA" class="headerlink" title="S2R-ViT for Multi-Agent Cooperative Perception: Bridging the Gap from Simulation to Reality ICRA"></a>S2R-ViT for Multi-Agent Cooperative Perception: Bridging the Gap from Simulation to Reality ICRA</h3><h4 id="æ‘˜è¦-2"><a href="#æ‘˜è¦-2" class="headerlink" title="æ‘˜è¦"></a>æ‘˜è¦</h4><p>ç”±äºç¼ºä¹è¶³å¤Ÿçš„çœŸå®å¤šæ™ºèƒ½ä½“æ•°æ®ä¸”æ ‡æ³¨è€—æ—¶ï¼Œç°æœ‰çš„å¤šæ™ºèƒ½ä½“ååŒæ„ŸçŸ¥ç®—æ³•é€šå¸¸é€‰å–æ¨¡æ‹Ÿçš„ä¼ æ„Ÿå™¨æ•°æ®è¿›è¡Œè®­ç»ƒå’ŒéªŒè¯ã€‚<strong>ç„¶è€Œï¼Œå½“è¿™äº›ç»è¿‡ä»¿çœŸè®­ç»ƒçš„æ¨¡å‹è¢«éƒ¨ç½²åˆ°çœŸå®ä¸–ç•Œæ—¶ï¼Œç”±äºä»¿çœŸæ•°æ®å’ŒçœŸå®æ•°æ®ä¹‹é—´å­˜åœ¨æ˜¾è‘—çš„é¢†åŸŸå·®è·ï¼Œæ„ŸçŸ¥æ€§èƒ½ä¼šä¸‹é™</strong>ã€‚</p><p>åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬æå‡ºäº†ç¬¬ä¸€ä¸ªä½¿ç”¨æ–°å‹è§†è§‰è½¬æ¢å™¨çš„å¤šæ™ºèƒ½ä½“åä½œæ„ŸçŸ¥çš„ä»¿çœŸåˆ°ç°å®è¿ç§»å­¦ä¹ æ¡†æ¶ï¼Œå‘½åä¸ºS2R - ViTï¼Œå®ƒåŒæ—¶è€ƒè™‘äº†æ¨¡æ‹Ÿæ•°æ®å’ŒçœŸå®æ•°æ®ä¹‹é—´çš„éƒ¨ç½²å·®è·å’Œç‰¹å¾å·®è·ã€‚</p><p>æˆ‘ä»¬ç ”ç©¶äº†è¿™ä¸¤ç§ç±»å‹çš„åŸŸé—´éš™çš„å½±å“ï¼Œå¹¶æå‡ºäº†ä¸€ç§æ–°çš„ä¸ç¡®å®šæ„ŸçŸ¥è§†è§‰è½¬æ¢å™¨æ¥æœ‰æ•ˆåœ°ç¼“è§£éƒ¨ç½²é—´éš™ï¼Œå¹¶æå‡ºäº†ä¸€ç§åŸºäºä»£ç†çš„ç‰¹å¾è‡ªé€‚åº”æ¨¡å—ï¼Œé€šè¿‡ä»£ç†é—´å’Œä»£ç†é—´çš„é‰´åˆ«å™¨æ¥å‡å°ç‰¹å¾é—´éš™ã€‚</p><p>åœ¨å…¬å¼€çš„å¤šæ™ºèƒ½ä½“ååŒæ„ŸçŸ¥æ•°æ®é›†OPV2Vå’ŒV2V4Realä¸Šçš„å¤§é‡å®éªŒè¡¨æ˜ï¼Œæœ¬æ–‡æå‡ºçš„S2R - ViTæ–¹æ³•èƒ½å¤Ÿæœ‰æ•ˆåœ°å¼¥è¡¥ä»¿çœŸä¸ç°å®ä¹‹é—´çš„å·®è·ï¼Œåœ¨åŸºäºç‚¹äº‘çš„ä¸‰ç»´ç›®æ ‡æ£€æµ‹ä¸­æ˜¾è‘—ä¼˜äºå…¶ä»–æ–¹æ³•ã€‚</p><h4 id="å¼•è¨€-1"><a href="#å¼•è¨€-1" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h4><p>å¤šæ™ºèƒ½ä½“åä½œæ„ŸçŸ¥çš„æœ€æ–°è¿›å±•æ˜¾ç¤ºå‡ºå…‹æœå•æ™ºèƒ½ä½“æ„ŸçŸ¥å—æ„ŸçŸ¥èŒƒå›´å’Œé®æŒ¡æŒ‘æˆ˜çš„å±€é™æ€§çš„æ½œåŠ›.å¤šæ™ºèƒ½ä½“åä½œæ„ŸçŸ¥ç³»ç»Ÿé€šè¿‡åˆ©ç”¨æ™ºèƒ½ä½“ä¹‹é—´çš„é€šä¿¡æŠ€æœ¯å…±äº«ä¿¡æ¯ï¼Œç›¸æ¯”äºå•æ™ºèƒ½ä½“æ„ŸçŸ¥ï¼Œèƒ½å¤Ÿæ˜¾è‘—æå‡æ„ŸçŸ¥æ€§èƒ½</p><p>ç”±äºåœ¨çœŸå®ä¸–ç•Œä¸­æ”¶é›†å…·æœ‰é€šä¿¡çš„å¤šæ™ºèƒ½ä½“æ•°æ®çš„å›°éš¾ï¼Œ<strong>åœ¨å¤šæ ·åŒ–å’Œå¤æ‚çš„çœŸå®ä¸–ç•Œç¯å¢ƒä¸­æ”¶é›†è¶³å¤Ÿå¤šçš„çœŸå®æ•°æ®æ˜¯æ˜‚è´µä¸”ä¸å®¹æ˜“çš„ã€‚æ­¤å¤–ï¼Œå¤šæ™ºèƒ½ä½“ååŒæ„ŸçŸ¥ç³»ç»Ÿçš„åœ°é¢çœŸå€¼æ•°æ®æ ‡æ³¨å’Œç»Ÿä¸€åæ ‡æŠ•å½±å°¤ä¸ºè€—æ—¶ã€‚</strong>å› æ­¤ï¼Œç°æœ‰çš„è®¸å¤šå¤šæ™ºèƒ½ä½“ååŒæ„ŸçŸ¥ç ”ç©¶å·¥ä½œé€šå¸¸é€‰å–æ¨¡æ‹Ÿæ•°æ®è¿›è¡Œæ¨¡å‹è®­ç»ƒå’ŒéªŒè¯</p><p>ç„¶è€Œï¼Œ<strong>å½“æˆ‘ä»¬å°†ç”¨æ¨¡æ‹Ÿæ•°æ®è®­ç»ƒçš„æ¨¡å‹åº”ç”¨äºçœŸå®ä¸–ç•Œæ—¶ï¼Œæ„ŸçŸ¥æ€§èƒ½é€šå¸¸ä¼šä¸‹é™ã€‚è¿™ç§ç°è±¡æ˜¯ç”±äºæ¨¡æ‹Ÿæ•°æ®å’ŒçœŸå®æ•°æ®ä¹‹é—´å­˜åœ¨æ˜¾è‘—çš„åŸŸå·®è·</strong>ã€‚</p><p>åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬çš„ç ”ç©¶é‡ç‚¹æ˜¯<strong>åˆ©ç”¨æœ‰æ ‡è®°çš„æ¨¡æ‹Ÿæ•°æ®å’Œæ— æ ‡è®°çš„çœŸå®ä¸–ç•Œæ•°æ®ä½œä¸ºè¿ç§»å­¦ä¹ ï¼Œä»¥å‡å°‘å¤šæ™ºèƒ½ä½“åä½œæ„ŸçŸ¥çš„é¢†åŸŸå·®è·</strong>ã€‚</p><p><img data-src="https://s2.loli.net/2024/05/17/DbfYtlhCnFSpTE7.png" alt="image-20240517203347621"></p><p>æˆ‘ä»¬è§‚å¯Ÿåˆ°ï¼Œå¤šæ™ºèƒ½ä½“åä½œæ„ŸçŸ¥ä»æ¨¡æ‹Ÿåˆ°ç°å®çš„é¢†åŸŸå·®è·åŒ…æ‹¬ä»¥ä¸‹ä¸¤ä¸ªè§’åº¦</p><p><strong>éƒ¨ç½²å·®è·</strong>( Deployment Gap ):ä¸ç†æƒ³çš„ä»¿çœŸç¯å¢ƒä¸åŒ,<strong>åœ¨ç°å®ä¸–ç•Œçš„æ™ºèƒ½ä½“é€šä¿¡è¿‡ç¨‹ä¸­ï¼Œç”±äºä¸å¯é¿å…çš„GPSè¯¯å·®å’Œé€šä¿¡å»¶è¿Ÿ(æ—¶é—´å»¶è¿Ÿ),å¤šä¸ªæ™ºèƒ½ä½“å¯èƒ½å­˜åœ¨å®šä½(ä½ç½®å’Œèˆªå‘)é”™è¯¯</strong></p><p><strong>ç‰¹å¾å·®è·</strong>( Feature Gap ):<strong>ç°å®ä¸–ç•Œçš„ç‚¹äº‘ç‰¹å¾åˆ†å¸ƒå¯èƒ½ä¸ä»¿çœŸæ•°æ®æœ‰æ˜¾è‘—å·®å¼‚,ä¾‹å¦‚æ›´å¤æ‚çš„é©¾é©¶åœºæ™¯ã€ä¸åŒçš„æ¿€å…‰é›·è¾¾é€šé“æ•°ã€æ··åˆäº¤é€šæµã€å„ç§ç‚¹äº‘å˜åŒ–ç­‰ã€‚</strong></p><p>åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬æå‡ºäº†ç¬¬ä¸€ä¸ªä½¿ç”¨æ–°å‹è§†è§‰è½¬æ¢å™¨( ViT )çš„å¤šæ™ºèƒ½ä½“åä½œæ„ŸçŸ¥çš„ä»¿çœŸåˆ°ç°å®( S2R )è¿ç§»å­¦ä¹ æ¡†æ¶ï¼Œå‘½åä¸ºS2R - ViTï¼ŒåŒæ—¶è€ƒè™‘äº†éƒ¨ç½²é—´éš™å’Œç‰¹å¾é—´éš™ã€‚æˆ‘ä»¬é€‰æ‹©è½¦è¾†åˆ°è½¦è¾†( Vehicle-to-Vehicleï¼ŒV2V )ååŒæ„ŸçŸ¥ä»»åŠ¡ä½œä¸ºåŸºäºç‚¹äº‘çš„ä¸‰ç»´ç›®æ ‡æ£€æµ‹çš„ç®—æ³•å¼€å‘ã€‚å…·ä½“æ¥è¯´ï¼Œæˆ‘ä»¬çš„æ¡†æ¶å°†æ¥è‡ªæ¨¡æ‹Ÿçš„æœ‰æ ‡è®°ç‚¹äº‘æ•°æ®å’Œæ¥è‡ªçœŸå®ä¸–ç•Œçš„æ— æ ‡è®°æ•°æ®ä½œä¸ºè¾“å…¥ï¼Œä»è€Œå¤§é‡åœ°åˆ©ç”¨æ¨¡æ‹Ÿæ•°æ®ã€‚åœ¨æœºå™¨å­¦ä¹ ç ”ç©¶ä¸­ï¼Œè¿™ç§è®¾ç½®è¢«å¹¿æ³›ç§°ä¸ºä»æºåŸŸ(æ¨¡æ‹Ÿ)åˆ°ç›®æ ‡åŸŸ(ç°å®)çš„æ— ç›‘ç£åŸŸé€‚åº”ã€‚</p><p>S2R - ViTåŒ…æ‹¬ä¸¤ä¸ªå…³é”®éƒ¨åˆ†ï¼š( 1 ) <strong>S2R-UViTï¼šä¸€ç§æ–°å‹çš„S2Rä¸ç¡®å®šæ„ŸçŸ¥è§†è§‰è½¬æ¢å™¨ï¼Œå¯ä»¥æœ‰æ•ˆåœ°ç¼“è§£develomment gapå¸¦æ¥çš„ä¸ç¡®å®šæ€§</strong>ã€‚å…·ä½“æ¥è¯´ï¼ŒS2R - UViTåŒ…æ‹¬ä¸€ä¸ª<strong>å±€éƒ¨å’Œå…¨å±€çš„å¤šå¤´è‡ªæ³¨æ„åŠ›( LG-MSA )æ¨¡å—</strong>ï¼Œä»¥<strong>å¢å¼ºæ‰€æœ‰æ™ºèƒ½ä½“ç©ºé—´ä½ç½®ä¸Šçš„ç‰¹å¾äº¤äº’ï¼Œä»¥å®¹å¿ä¸ç¡®å®šæ€§çš„ç¼ºé™·</strong>ï¼›<strong>è¿˜åŒ…æ‹¬ä¸€ä¸ªä¸ç¡®å®šæ€§æ„ŸçŸ¥æ¨¡å—( UAM )ï¼Œé€šè¿‡è€ƒè™‘ä¸åŒä¸ç¡®å®šæ€§æ°´å¹³çš„å…±äº«å…¶ä»–æ™ºèƒ½ä½“ç‰¹å¾æ¥å¢å¼ºè‡ªæˆ‘æ™ºèƒ½ä½“çš„ç‰¹å¾</strong>.(2)S2R-AFAï¼šåŸºäº<strong>S2R Agentçš„ç‰¹å¾è‡ªé€‚åº”ä»¥ç¼©å°ç‰¹å¾å·®è·</strong>ã€‚<strong>S2RAFAåˆ©ç”¨æ™ºèƒ½ä½“é—´å’Œè‡ªæˆ‘ä»£ç†çš„åˆ¤åˆ«å™¨æå–é¢†åŸŸä¸å˜ç‰¹å¾</strong>,ä»¥å¼¥åˆfeature gapã€‚</p><blockquote><p>Uncertainty-aware vision Transformer,å¯æœ‰æ•ˆç¼“è§£development gapå¸¦æ¥çš„ä¸ç¡®å®šæ€§.</p><p>é€šè¿‡ä¸€ä¸ªS2R agent-based feature adaptationåˆ©ç”¨ä»£ç†é—´å’Œè‡ªæˆ‘ä»£ç†åˆ¤åˆ«å™¨æå–domain-invariant features. æ³¨æ„è¿™é‡Œdomain-invariant featureså·²ç»è¢«ä¹‹å‰çš„2024çš„DI-V2Xæ–‡ç« æåˆ°äº†,ä½†è¿™é‡Œæ›´åé‡è™šæ‹Ÿåˆ°æ˜¾ç¤º,è€ŒDI-V2Xåé‡ä»£ç†çš„ä¸åŒ.</p></blockquote><h4 id="ç›¸å…³å·¥ä½œ"><a href="#ç›¸å…³å·¥ä½œ" class="headerlink" title="ç›¸å…³å·¥ä½œ"></a>ç›¸å…³å·¥ä½œ</h4><p>Multi-Agent Perception.å¤šæ™ºèƒ½ä½“æ„ŸçŸ¥ç³»ç»Ÿé€šè¿‡æ™ºèƒ½ä½“ä¹‹é—´çš„é€šä¿¡æŠ€æœ¯,èƒ½å¤Ÿå…‹æœé®æŒ¡å’ŒçŸ­è·ç¦»æ„ŸçŸ¥çš„æŒ‘æˆ˜,å®ç°å¤§èŒƒå›´æ„ŸçŸ¥,å¼•èµ·äº†ä¼—å¤šç ”ç©¶è€…çš„å…³æ³¨.ä¸äº¤æ¢åŸå§‹ä¼ æ„Ÿæ•°æ®æˆ–æ£€æµ‹è¾“å‡ºç›¸æ¯”,å½“ä»£æ–¹æ³•é€šå¸¸å…±äº«ç”±ç¥ç»ç½‘ç»œæå–çš„ä¸­é—´ç‰¹å¾.è¯¥ç­–ç•¥åœ¨ç²¾åº¦å’Œå¸¦å®½éœ€æ±‚ä¹‹é—´æä¾›äº†ä¸€ä¸ªæœ€ä½³çš„å¹³è¡¡.</p><p>Challenges in Multi-Agent Perception:å¤šAgentæ„ŸçŸ¥ç³»ç»Ÿä¹Ÿå¼•å…¥äº†ä¸€äº›æ–°çš„æŒ‘æˆ˜ï¼Œå¦‚å®šä½è¯¯å·®ã€é€šä¿¡å»¶è¿Ÿã€å¯¹æŠ—æ”»å‡»ç­‰ã€‚è¿™äº›æŒ‘æˆ˜å¯èƒ½ä¼šå‡å°‘åˆä½œçš„å¥½å¤„.</p><p>Domain Adaptation for Perception:é¢†åŸŸè‡ªé€‚åº”æ˜¯æŒ‡å°†æºé¢†åŸŸè®­ç»ƒçš„æœºå™¨å­¦ä¹ æ¨¡å‹è‡ªé€‚åº”åˆ°ç›®æ ‡é¢†åŸŸã€‚è®¸å¤šé¢†åŸŸè‡ªé€‚åº”å·¥ä½œä¸»è¦é›†ä¸­åœ¨RGBç›¸æœºæ•°æ®ï¼Œè€Œåœ¨LiDARæ•°æ®ä¸­æå‡ºäº†æ›´å¤šçš„é¢†åŸŸè‡ªé€‚åº”å·¥ä½œæ¥è§£å†³è¿™ä¸€é—®é¢˜.</p><p><img data-src="https://s2.loli.net/2024/05/20/TyuX2Zsjb19mcvL.png" alt="image-20240520100453017"></p><p>ä¸äº¤æ¢åŸå§‹ä¼ æ„Ÿæ•°æ®æˆ–æ£€æµ‹è¾“å‡ºç›¸æ¯”,å½“ä»£æ–¹æ³•é€šå¸¸å…±äº«ç”±ç¥ç»ç½‘ç»œæå–çš„ä¸­é—´ç‰¹å¾.</p><p>è¿™ç§ç­–ç•¥åœ¨ç²¾åº¦å’Œå¸¦å®½éœ€æ±‚ä¹‹é—´æä¾›äº†ä¸€ä¸ªæœ€ä½³çš„å¹³è¡¡.</p><h4 id="æ–¹æ³•-1"><a href="#æ–¹æ³•-1" class="headerlink" title="æ–¹æ³•"></a>æ–¹æ³•</h4><p><img data-src="https://s2.loli.net/2024/05/28/KQvBeL8JiAk1tRE.png" alt="image-20240528161118892"></p><p>S2R-ViTã€‚ä»å…¶ä»–å‘¨å›´CAVèšåˆçš„ä¸­é—´ç‰¹å¾è¢«è¾“å…¥åˆ°æˆ‘ä»¬çš„ä¸»è¦ç»„ä»¶S2R - ViTä¸­ï¼Œè¯¥ç»„ä»¶ç”±S2R - UViTå’ŒS2R - AFAæ¨¡å—ç»„æˆã€‚åœ¨æ¥æ”¶åˆ°æœ€ç»ˆçš„èåˆç‰¹å¾åï¼Œæˆ‘ä»¬åˆ©ç”¨é¢„æµ‹å¤´è¿›è¡Œ3Dç‰©ä½“åˆ†ç±»å’Œå®šä½</p><p>ä»ä»¿çœŸåˆ°ç°å®çš„éƒ¨ç½²å·®è·ç»™è‡ªæˆ‘å’Œé‚»å±…æ™ºèƒ½ä½“å¸¦æ¥äº†ä¸åŒçš„ä¸ç¡®å®šæ€§ï¼Œä¾‹å¦‚GPSè¯¯å·®å¯¼è‡´çš„ç©ºé—´åå·®ï¼Œé€šä¿¡å»¶è¿Ÿå¯¼è‡´çš„åæ ‡æŠ•å½±ä¸­çš„ç©ºé—´é”™ä½</p><p>åœ¨æœ¬æ–‡ä¸­æå‡ºä»ä¸¤ä¸ªè§’åº¦æ¥å›ç­”è¿™ä¸ªé—®é¢˜ï¼šä¸ç¡®å®šæ€§å¯ä»¥é€šè¿‡å¢å¼º( 1 )æ‰€æœ‰æ™ºèƒ½ä½“ç©ºé—´ä½ç½®ä¸Šçš„ç‰¹å¾äº¤äº’æ¥æ›´å…¨é¢åœ°ç¼“è§£ï¼›( 2 )é€šè¿‡è€ƒè™‘ä¸åŒä¸ç¡®å®šæ€§æ°´å¹³çš„å…±äº«å…¶ä»–æ™ºèƒ½ä½“ç‰¹å¾æ¥ç¼“è§£è‡ªæˆ‘-æ™ºèƒ½ä½“ç‰¹å¾ã€‚</p><p>è¿™ä¸¤ä¸ªè§†è§’ä¿ƒä½¿æˆ‘ä»¬åˆ†åˆ«å¼€å‘äº†æ–°é¢–çš„å±€éƒ¨-å…¨å±€å¤šå¤´è‡ªæ³¨æ„åŠ›( LG-MSA )æ¨¡å—å’Œä¸ç¡®å®šæ€§æ„ŸçŸ¥æ¨¡å—( UAM )ã€‚</p><p>å±€éƒ¨å’Œå…¨å±€å¤šç£å¤´è‡ªæ³¨æ„åŠ›æœºåˆ¶( Local-and-Globalå¤šå¤´Self Attentionï¼ŒLGMSA )ï¼šä¸ºäº†æ›´å…¨é¢åœ°å¢å¼ºæ‰€æœ‰æ™ºèƒ½ä½“ç©ºé—´ä½ç½®ä¸Šçš„ç‰¹å¾äº¤äº’ï¼Œæˆ‘ä»¬æå‡ºäº†LG - MSAæ¥ä¿ƒè¿›æ‰€æœ‰æ™ºèƒ½ä½“ç©ºé—´ä½ç½®ä¸Šçš„å±€éƒ¨å’Œå…¨å±€ç‰¹å¾äº¤äº’ã€‚åœ¨æå‡ºçš„LGMSAä¸­ï¼ŒåŸºäºå±€éƒ¨ç‰¹å¾çš„æ³¨æ„åŠ›ç”¨äºå…³æ³¨ç©ºé—´ç‰¹å¾çš„å±€éƒ¨ç»†èŠ‚ï¼Œè€ŒåŸºäºå…¨å±€ç‰¹å¾çš„æ³¨æ„åŠ›ç”¨äºå…³æ³¨ç©ºé—´ç‰¹å¾çš„å¹¿æ³›èŒƒå›´ã€‚å°±æ˜¯ä¸€ä¸ªèåˆæ¨¡å—,ä½¿ç”¨ä¸åŒçª—å£å¤§å°çš„ç±»ä¼¼swin-transformeræ¨¡å‹.</p><p>ä»¥h = 8ä¸ºå¤´æ•°ï¼Œn = 2ä¸ºçª—å£ç±»å‹æ•°ï¼Œå°†æ ‡å‡†å¤šå¤´è‡ªæ³¨æ„åŠ›æ¨¡å—( MSA ) [ 24 ]çš„å¤šå¤´hå‡åŒ€åˆ’åˆ†ä¸º2ç»„ä¸åŒçª—å£å¤§å°ï¼Œå³å±€éƒ¨åˆ†æ”¯ä¸º4 Ã— 4ï¼Œå…¨å±€åˆ†æ”¯ä¸º8 Ã— 8ã€‚åœ¨å±€éƒ¨åˆ†æ”¯ä¸­ï¼Œå°†åˆ†å‰²åçš„ç‰¹å¾F^l^~e,o~âˆˆR^h/nÃ—HÃ—WÃ—kC/h^ä»¥4 Ã— 4çš„å°çª—å£å°ºå¯¸è¾“å…¥MSALï¼Œä»¥å¢å¼ºç©ºé—´ç‰¹å¾çš„å±€éƒ¨ç»†èŠ‚ã€‚åœ¨å…¨å±€åˆ†æ”¯ä¸­ï¼Œå¦ä¸€ä¸ªåˆ†è£‚ç‰¹å¾F^g^~e,o~âˆˆR^h/nÃ—HÃ—WÃ—kC/h^ä»¥8 Ã— 8çš„å¤§çª—å£å°ºå¯¸è¾“å…¥MSAGä»¥æ•è·å…¨å±€ç©ºé—´ç‰¹å¾ä¿¡æ¯</p><script type="math/tex; mode=display">F_{e,o}^p=\mathrm{SA}(\mathrm{Concat}(\mathrm{MSA}_L(F_{e,o}^l),\mathrm{MSA}_G(F_{e,o}^g)))</script><p><strong>Uncertainty-Aware Module (UAM).</strong></p><p>ä¸ç¡®å®šæ€§å›¾,è¯´ç™½äº†å¾—åˆ°ä¸€ä¸ªè·Ÿç‰¹å¾å›¾å¤§å°ä¸€æ ·çš„mapå¯¹é™¤äº†egoä»£ç†çš„ç‰¹å¾è¿›è¡Œé€‰æ‹©,è¿™ç§è®¾è®¡åœ¨å…¶ä»–å¾ˆå¤šæ–¹æ³•ä¸­éƒ½æ¶‰åŠ.</p><p>ä»¥ä¸­ä½æ•°ä¸ºé˜ˆå€¼ï¼Œå°†å…·æœ‰é«˜ä¸ç¡®å®šåº¦ç­‰çº§(å³,ä½ç½®ä¿¡åº¦)çš„é¢„æµ‹ä¸ç¡®å®šåº¦ç­‰çº§å›¾Mä¸­çš„ç‰¹å¾å€¼é‡ç½®ä¸º1.</p><p>UPNæ˜¯ç”±ç®€åŒ–è€Œæ¥çš„åŸºäºç¼–ç å™¨-è§£ç å™¨çš„ç¥ç»ç½‘ç»œ,å¯ä»¥åœ¨æˆ‘ä»¬æ•´ä¸ªæ¶æ„çš„ç«¯åˆ°ç«¯è®­ç»ƒè¿‡ç¨‹ä¸­å­¦ä¹ .</p><p>å—è¿›åŒ–æœºåˆ¶ä¸­è‡ªç„¶é€‰æ‹©çš„å¯å‘,ä»¥ä¸­ä½æ•°ä¸ºé˜ˆå€¼,å°†å…·æœ‰é«˜ä¸ç¡®å®šæ€§æ°´å¹³(å³,ä½ç½®ä¿¡åº¦)çš„é¢„æµ‹ä¸ç¡®å®šæ€§æ°´å¹³å›¾Mä¸­çš„ç‰¹å¾å€¼é‡ç½®ä¸º1.å®ƒäº§ç”Ÿäº†ä¸€ä¸ªæ–°çš„ä¸ç¡®å®šæ€§ç­‰çº§å›¾M~t~ .</p><p>åŸºäºå…±äº«çš„ä»–è€…-æ–½åŠ¨è€…ç‰¹å¾æ¥å¢å¼ºè‡ªæˆ‘-æ–½åŠ¨è€…ç‰¹å¾,ä¸åº”å¿½è§†å…¶ä¸åŒçš„ä¸ç¡®å®šæ€§æ°´å¹³.</p><script type="math/tex; mode=display">F_{e,o}^h=\mathrm{Concat}(\Delta[\mathrm{UPN}(F_o^p)]\otimes F_e^p,F_o^p)</script><p>Î” [ Â· ]è¡¨ç¤ºé˜ˆå€¼è¿‡ç¨‹,âŠ›è¡¨ç¤ºçŸ©é˜µç‚¹ç§¯ã€‚</p><script type="math/tex; mode=display">F_{e,o}^h=\mathrm{S2RAttn}(\mathrm{LN}(F_{e,o}))+F_{e,o},\\\hat{F_{e,o}^h}=\mathrm{MLP}(\mathrm{LN}(F_{e,o}^h))+F_{e,o}^h,</script><p><strong>S2R-AFA: simultaion-to-Reality Agent-based Feature Adaptation.</strong></p><p>ä¸ºäº†ç¼©å°ä»¿çœŸç‰¹å¾Fsä¸çœŸå®ç‰¹å¾Frä¹‹é—´çš„ç‰¹å¾å·®è·,åœ¨èåˆå‰å’Œèåˆååˆ†åˆ«è®¾è®¡äº†ä¸¤ä¸ªé¢†åŸŸåˆ¤åˆ«å™¨/åˆ†ç±»å™¨,ä½¿ç”¨BCEæŸå¤±ç”¨äºäºŒåˆ†ç±».</p><script type="math/tex; mode=display">\min_{G_m}\max_{D_i,D_e}\mathcal{L}_{AFA}=\mathbb{E}_{s,r}[D_i(F_s,F_r)]+\mathbb{E}_{s,r}[D_e(F_s^e,F_r^e)]</script><p>E~s,r~åˆ†åˆ«è¡¨ç¤ºä»¿çœŸå’Œç°å®ä¸­çš„é¢†åŸŸåˆ†ç±»è¯¯å·®ï¼ŒG~m~æ˜¯æˆ‘ä»¬çš„æ•´ä½“æ¨¡å‹(ä¸»å¹²ç½‘ã€S2R - UViTå’Œæ£€æµ‹å¤´)ï¼Œå¯ä»¥è®¤ä¸ºæ˜¯ç”Ÿæˆå¯¹æŠ—ç½‘ç»œçš„ç”Ÿæˆå™¨.</p><p>ç”±äºS2R - AFA,æˆ‘ä»¬çš„ç”Ÿæˆæ¨¡å‹G~m~å°†å…·æœ‰æå–æ¨¡æ‹Ÿå’Œç°å®çš„åŸŸä¸å˜ç‰¹å¾çš„èƒ½åŠ›. æŸå¤±åŒ…å«ç›®æ ‡æ£€æµ‹æŸå¤±å’ŒAgent-based Feature AdaptationæŸå¤±.</p><script type="math/tex; mode=display">\mathcal{L}_{total}=w_1\mathcal{L}_{det}+w_2\mathcal{L}_{AFA}</script><h3 id="DUSA-Decoupled-Unsupervised-Sim2Real-Adaptation-for-Vehicle-to-Everything-Collaborative-Perception-MM"><a href="#DUSA-Decoupled-Unsupervised-Sim2Real-Adaptation-for-Vehicle-to-Everything-Collaborative-Perception-MM" class="headerlink" title="DUSA: Decoupled Unsupervised Sim2Real Adaptation for Vehicle-to-Everything Collaborative Perception MM"></a>DUSA: Decoupled Unsupervised Sim2Real Adaptation for Vehicle-to-Everything Collaborative Perception MM</h3><h4 id="Abstract"><a href="#Abstract" class="headerlink" title="Abstract"></a>Abstract</h4><p>è½¦è”ç½‘( Vehicle-to-Ethingï¼ŒV2X )ååŒæ„ŸçŸ¥å¯¹äºè‡ªåŠ¨é©¾é©¶çš„æ¨è¿›è‡³å…³é‡è¦ã€‚ç„¶è€Œï¼Œå®ç°é«˜ç²¾åº¦çš„V2Xæ„ŸçŸ¥<strong>éœ€è¦å¤§é‡æœ‰æ ‡æ³¨çš„çœŸå®ä¸–ç•Œæ•°æ®ï¼Œè€Œè¿™äº›æ•°æ®å¾€å¾€æ˜¯æ˜‚è´µå’Œéš¾ä»¥è·å¾—çš„</strong>ã€‚</p><p>ç”±äº<strong>æ¨¡æ‹Ÿæ•°æ®å¯ä»¥ä»¥æä½çš„æˆæœ¬å¤§è§„æ¨¡ç”Ÿäº§ï¼Œå› æ­¤å—åˆ°äº†å¹¿æ³›çš„å…³æ³¨ã€‚ç„¶è€Œï¼Œæ¨¡æ‹Ÿæ•°æ®å’ŒçœŸå®ä¸–ç•Œæ•°æ®ä¹‹é—´æ˜¾è‘—çš„åŸŸå·®è·ï¼ŒåŒ…æ‹¬ä¼ æ„Ÿå™¨ç±»å‹ã€åå°„æ¨¡å¼å’Œé“è·¯ç¯å¢ƒçš„å·®å¼‚ï¼Œå¾€å¾€å¯¼è‡´åœ¨æ¨¡æ‹Ÿæ•°æ®ä¸Šè®­ç»ƒçš„æ¨¡å‹åœ¨çœŸå®ä¸–ç•Œæ•°æ®ä¸Šè¯„ä¼°æ—¶æ€§èƒ½è¾ƒå·®</strong>ã€‚</p><p>æ­¤å¤–ï¼Œç°å®ä¸–ç•Œä¸­çš„åä½œæ™ºèƒ½ä½“ä¹‹é—´ä»ç„¶å­˜åœ¨åŸŸé—´é¸¿æ²Ÿï¼Œä¾‹å¦‚<strong>ä¸åŒç±»å‹çš„ä¼ æ„Ÿå™¨å¯èƒ½å®‰è£…åœ¨å…·æœ‰ä¸åŒå¤–åœ¨ç‰¹å¾çš„è‡ªåŠ¨é©¾é©¶è½¦è¾†å’Œè·¯è¾¹åŸºç¡€è®¾æ–½ä¸Š</strong>ï¼Œè¿›ä¸€æ­¥å¢åŠ äº†sim2ç°å®æ³›åŒ–çš„éš¾åº¦ã€‚</p><p>ä¸ºäº†å……åˆ†åˆ©ç”¨æ¨¡æ‹Ÿæ•°æ®ï¼Œæå‡ºäº†ä¸€ç§æ–°çš„ç”¨äºV2Xåä½œæ£€æµ‹çš„æ— ç›‘ç£Sim2çœŸå®åŸŸè‡ªé€‚åº”æ–¹æ³•ï¼Œç§°ä¸ºè§£è€¦æ— ç›‘ç£Sim2realåŸŸè‡ªé€‚åº”( Decoupled Unsupervised Sim2Real Adaptationï¼ŒDUSA )ã€‚</p><p>æˆ‘ä»¬çš„æ–°æ–¹æ³•å°†V2Xåä½œsim2çœŸå®åŸŸè‡ªé€‚åº”é—®é¢˜è§£è€¦ä¸º<strong>sim2realåŸŸè‡ªé€‚åº”å’Œæ™ºèƒ½ä½“é—´è‡ªé€‚åº”</strong>ä¸¤ä¸ªå­é—®é¢˜ã€‚å¯¹äºsim2realè‡ªé€‚åº”ï¼Œæˆ‘ä»¬è®¾è®¡äº†ä¸€ä¸ªä½ç½®è‡ªé€‚åº”çš„Sim2Real Adapter ( LSA )æ¨¡å—ï¼Œä»ç‰¹å¾å›¾çš„å…³é”®ä½ç½®è‡ªé€‚åº”åœ°èšåˆç‰¹å¾ï¼Œå¹¶åœ¨èšåˆçš„å…¨å±€ç‰¹å¾ä¸Šé€šè¿‡sim / realåˆ¤åˆ«å™¨å¯¹æ¨¡æ‹Ÿæ•°æ®å’ŒçœŸå®æ•°æ®ä¹‹é—´çš„ç‰¹å¾è¿›è¡Œå¯¹é½ã€‚å¯¹äºæ™ºèƒ½ä½“é—´è‡ªé€‚åº”ï¼Œæˆ‘ä»¬è¿›ä¸€æ­¥è®¾è®¡äº†ä¸€ä¸ªç½®ä¿¡åº¦æ„ŸçŸ¥çš„æ™ºèƒ½ä½“é—´é€‚é…å™¨( Confidence-aware Inter-agent Adapterï¼ŒCIA )æ¨¡å—ï¼Œåœ¨æ™ºèƒ½ä½“é—´ç½®ä¿¡å›¾çš„æŒ‡å¯¼ä¸‹ï¼Œå¯¹æ¥è‡ªå¼‚æ„æ™ºèƒ½ä½“çš„ç»†ç²’åº¦ç‰¹å¾è¿›è¡Œå¯¹é½ã€‚</p><p>å®éªŒè¯æ˜äº†æœ¬æ–‡æå‡ºçš„DUSAæ–¹æ³•åœ¨ä»æ¨¡æ‹Ÿçš„V2XSetæ•°æ®é›†åˆ°çœŸå®çš„DAIR -V2X-Cæ•°æ®é›†çš„æ— ç›‘ç£sim2realè‡ªé€‚åº”ä¸Šçš„æœ‰æ•ˆæ€§ã€‚</p><h4 id="ç›¸å…³å·¥ä½œ-1"><a href="#ç›¸å…³å·¥ä½œ-1" class="headerlink" title="ç›¸å…³å·¥ä½œ"></a>ç›¸å…³å·¥ä½œ</h4><p><strong>Collaborative 3D Object Detection</strong></p><p>åˆ©ç”¨åä½œæ„ŸçŸ¥æ¥æ”¯æŒå•è½¦çš„è‡ªåŠ¨é©¾é©¶å·²ç»æˆä¸ºä¸€ä¸ªè¶Šæ¥è¶Šå—å…³æ³¨çš„ç ”ç©¶è¯¾é¢˜ã€‚æ–¹æ³•<a href="https://ieeexplore.ieee.org/document/9228884">Cooperative Perception for 3D Object Detection in Driving Scenarios Using Infrastructure Sensors </a>é¦–å…ˆä»‹ç»äº†è½¦è¾†å’ŒåŸºç¡€è®¾æ–½ä¹‹é—´çš„ååŒæ„ŸçŸ¥ç³»ç»Ÿä¸­çš„æ—©æœŸå’Œæ™šæœŸèåˆæ–¹æ¡ˆã€‚</p><p>WIBAMæ¨¡å‹æå‡ºäº†ä¸€ç§ä½¿ç”¨å¼±ç›‘ç£æ¥å¾®è°ƒäº¤é€šè§‚æµ‹ç›¸æœºæ¨¡å‹çš„æŠ€æœ¯</p><p>Cooperåˆ©ç”¨æ¥è‡ªå¤šä¸ªè½¦è¾†çš„åŸå§‹ç‚¹äº‘ï¼Œå¼€å‘äº†SPODç½‘ç»œã€‚F-Cooper åœ¨Cooperçš„åŸºç¡€ä¸Šå®ç°äº†ç‰¹å¾çº§èåˆï¼Œåœ¨ä¿è¯ç²¾åº¦çš„åŒæ—¶å‡å°‘äº†é€šä¿¡æ•°æ®é‡ã€‚</p><p>V2VNet å¼•å…¥äº†ä¸­é—´èåˆæ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä½¿ç”¨ä¸€ç§æ„ŸçŸ¥ç©ºé—´å…³ç³»çš„å›¾ç¥ç»ç½‘ç»œæ¥åˆå¹¶æ¥è‡ªå¤šä¸ªè½¦è¾†çš„æ•°æ®ã€‚DiscoNet ä½¿ç”¨çŸ¥è¯†è’¸é¦æ¥è®­ç»ƒä¸€ä¸ªæ¤é—´ç›˜é€ å½±æœ¯ï¼Œè¿™æœ‰åŠ©äºåœ¨å¤šæ™ºèƒ½ä½“æ„ŸçŸ¥ä¸­å®ç°æ€§èƒ½å’Œå¸¦å®½ä½¿ç”¨ä¹‹é—´çš„æœ€ä½³å¹³è¡¡ã€‚V2X-ViT æå‡ºäº†ä¸€ç§è§†è§‰transformeræ¡†æ¶æ¥å®ç°è½¦è¾†å’ŒåŸºç¡€è®¾æ–½ä¹‹é—´çš„ç‰¹å¾èåˆã€‚SyncNetè§£å†³äº†æ—¶åŸŸåŒæ­¥é—®é¢˜ã€‚where2comm æå‡ºä½¿ç”¨ç©ºé—´ç½®ä¿¡å›¾æ¥å‡å°‘æ‰€éœ€çš„é€šä¿¡å¸¦å®½é‡ã€‚è¿™æ˜¯é€šè¿‡é™åˆ¶ä¸å¿…è¦æ•°æ®çš„ä¼ è¾“æ¥å®ç°çš„ã€‚CoBEVT åˆ©ç”¨èåˆçš„è½´å‘æ³¨æ„åŠ›æ¥ååŒç”Ÿæˆå¤šä¸ªæ™ºèƒ½ä½“å’Œç›¸æœºä¹‹é—´çš„é¸Ÿç°å›¾( BEV )é¢„æµ‹ã€‚AdaFusion æå‡ºäº†3ç§è‡ªé€‚åº”æ¨¡å‹ç”¨äºé¸Ÿç°å›¾( BEV )ä¸­çš„ç‰¹å¾èåˆï¼Œä»¥æé«˜æ„ŸçŸ¥ç²¾åº¦ã€‚<strong>MPDAè¯†åˆ«äº†åœ¨ä¸åŒä»£ç†ä¹‹é—´å‡ºç°çš„åŸŸé—´éš™é—®é¢˜</strong>ï¼Œå¹¶é€šè¿‡ä½¿ç”¨å®Œæ•´çš„ç‰¹å¾å›¾æ¥æ ‡å‡†åŒ–æ¨¡å¼æ¥è§£å†³ã€‚</p><p><strong>Unsupervised Domain Adaptation</strong></p><p>æ— ç›‘ç£é¢†åŸŸè‡ªé€‚åº”( UDA )æ—¨åœ¨åˆ©ç”¨æœ‰æ ‡ç­¾çš„æºæ•°æ®å’Œæ— æ ‡ç­¾çš„ç›®æ ‡æ•°æ®ï¼Œç”Ÿæˆä¸€ä¸ªèƒ½å¤Ÿæœ‰æ•ˆæ³›åŒ–åˆ°ç›®æ ‡é¢†åŸŸçš„é²æ£’æ¨¡å‹ã€‚è®¸å¤šå·¥ä½œ<strong>åˆ©ç”¨å¯¹æŠ—å­¦ä¹ </strong>ï¼Œé€šè¿‡<strong>æœ€å°åŒ–ä¸¤ä¸ªåŸŸä¹‹é—´çš„H -æ•£åº¦</strong>æˆ–<strong>Jensen - Shannonæ•£åº¦</strong>æ¥å¯¹é½ä¸åŒåŸŸä¹‹é—´çš„ç‰¹å¾åˆ†å¸ƒã€‚å¦ä¸€ç±»æ–¹æ³•é’ˆå¯¹<strong>æœªæ ‡è®°çš„ç›®æ ‡åŸŸå¼€å‘å¤šç§ä¼ªæ ‡ç­¾ï¼Œå®ç°è‡ªè®­ç»ƒ</strong></p><p>åœ¨ä¸‰ç»´ç›®æ ‡æ£€æµ‹çš„é¢†åŸŸè‡ªé€‚åº”æ–¹é¢ï¼ŒPointDAN æ˜¯ç¬¬ä¸€ä¸ªä½¿ç”¨å¯¹æŠ—å­¦ä¹ æ¥åŒ¹é…å…·æœ‰éè‡ªåŠ¨é©¾é©¶åœºæ™¯çš„é¢†åŸŸä¹‹é—´ç‚¹äº‘åˆ†å¸ƒçš„æ–¹æ³•ã€‚</p><p>SNåˆ©ç”¨æ¥è‡ªç›®æ ‡åŸŸçš„å¯¹è±¡ç»Ÿè®¡ä¿¡æ¯å¯¹æºåŸŸä¸­çš„å¯¹è±¡å¤§å°è¿›è¡Œå½’ä¸€åŒ–å¤„ç†ï¼Œä»¥å‡å°‘å¤§å°å±‚æ¬¡ä¸Šçš„åŸŸé—´éš™ã€‚</p><p>SRDANæå‡ºäº†å°ºåº¦æ„ŸçŸ¥å’ŒèŒƒå›´æ„ŸçŸ¥çš„åŸŸå¯¹é½ç­–ç•¥ï¼Œåˆ©ç”¨ä¸‰ç»´æ•°æ®çš„å‡ ä½•ç‰¹å¾æ¥æŒ‡å¯¼ä¸¤ä¸ªåŸŸä¹‹é—´çš„åˆ†å¸ƒå¯¹é½ã€‚MLC-Net é‡‡ç”¨å¸ˆç”ŸèŒƒå¼ï¼Œåˆ©ç”¨å¤šå±‚ä¸€è‡´æ€§æ¥ä¿ƒè¿›è·¨åŸŸè¿ç§»ã€‚ST3D æå‡ºäº†ä¸€ç§åŸºäºéšæœºå¯¹è±¡ç¼©æ”¾ç­–ç•¥çš„ä¼ªæ ‡ç­¾ç”Ÿæˆå’Œè®­ç»ƒè¿‡ç¨‹çš„ç»¼åˆæµæ°´çº¿ã€‚æ­¤å¤–ï¼ŒST3D + +è¿›ä¸€æ­¥æå‡ºäº†3D UDAèƒŒæ™¯ä¸‹å»å™ªä¼ªæ ‡æ³¨çš„ä¼˜åŒ–ç­–ç•¥ã€‚</p><p>åœ¨è¿™é¡¹å·¥ä½œä¸­ï¼Œæˆ‘ä»¬è§£å†³äº†<strong>é¢å‘V2Xåä½œ3Dæ£€æµ‹çš„æ— ç›‘ç£sim2realåŸŸé€‚åº”é—®é¢˜</strong>ã€‚åœ¨è¿™ä¸ªé—®é¢˜ä¸­ï¼Œæˆ‘ä»¬æœ‰ä¸€ç»„å¸¦æœ‰æ ‡ç­¾çš„æ¨¡æ‹Ÿæ ·æœ¬ä½œä¸ºæºåŸŸï¼Œä¸€ç»„æœªæ ‡è®°çš„çœŸå®ä¸–ç•Œæ ·æœ¬ä½œä¸ºç›®æ ‡åŸŸã€‚æ¯ä¸ªæ ·æœ¬åŒ…å«å¤šä¸ªååŒæ™ºèƒ½ä½“ï¼Œæ¯ä¸ªæ™ºèƒ½ä½“åŒ…å«ä¸€ä¸ªLiDARç‚¹äº‘åŠå…¶åœ¨ä¸–ç•Œåæ ‡ä¸‹çš„ä½å§¿ã€‚åä½œä»£ç†å¯ä»¥åœ¨ä¼ æ„Ÿå™¨ç±»å‹å’Œä½ç½®ç­‰æ–¹é¢å…·æœ‰å¼‚æ„æ€§ã€‚<strong>æˆ‘ä»¬æœŸæœ›è¯¥æ¨¡å‹èƒ½å¤Ÿå……åˆ†åœ°åˆ©ç”¨å·²æ ‡æ³¨çš„æ¨¡æ‹Ÿæ ·æœ¬æ¥æé«˜å…¶åœ¨æœªæ ‡æ³¨çš„çœŸå®ä¸–ç•Œæ ·æœ¬ä¸Šçš„æ€§èƒ½</strong>ã€‚</p><p><img data-src="https://s2.loli.net/2024/06/18/xmAuqhW7XdG3iwN.png" alt="image-20240618210513642"></p><p>åœ¨è‡ªé€‚åº”ä¹‹å‰ï¼Œä¸€ä¸ªç»Ÿä¸€çš„ä½ç½®ç¼–ç è¢«è¿æ¥åˆ°æ¯ä¸ªä»£ç†çš„ç‰¹å¾ä¸Šã€‚æˆ‘ä»¬å°†å…·æœ‰ä½ç½®ç¼–ç çš„ç‰¹å¾è®°ä¸ºâ€ F ( Xi ; Î¸) â€œã€‚ç»Ÿä¸€ä½ç½®ç¼–ç æ˜¯ä¸€ä¸ª2Dåæ ‡ï¼Œè¡¨ç¤ºä¸è‡ªæˆ‘ä¸»ä½“çš„ç›¸å¯¹è·ç¦»ã€‚è¿™æ ·ï¼Œä¸è‡ªæˆ‘ä»£ç†è·ç¦»ç›¸è¿‘çš„ä½ç½®å°†è¢«åˆ†é…åˆ°ç›¸åŒçš„åæ ‡ã€‚</p><p>LSAæ¨¡å—å’ŒCIAæ¨¡å—åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­å¯¹é½æ¥è‡ªä¸åŒåŸŸå’Œä»£ç†çš„ç‰¹å¾ã€‚<strong>LSAæ¨¡å—å¼•å…¥äº†è‡ªæˆ‘Agentçš„ç‰¹å¾ï¼Œå¹¶åŒºåˆ†Agentæ˜¯æ¥è‡ªä»¿çœŸè¿˜æ˜¯çœŸå®ä¸–ç•Œ</strong>ã€‚<strong>CIAæ¨¡å—æ¥æ”¶æ¯ä¸ªçœŸå®ä¸–ç•ŒAgentçš„ç‰¹å¾å’Œç½®ä¿¡å›¾ï¼Œå¹¶åˆ¤åˆ«Agentçš„ç±»å‹</strong>ã€‚ä¸¤ä¸ªæ¨¡å—é¼“åŠ±ç‰¹å¾æå–å™¨é€šè¿‡å¯¹æŠ—è®­ç»ƒäº§ç”Ÿsim / real - invariantå’Œagent - invariantç‰¹å¾ï¼Œå…¶ä¸­ä¸¤ä¸ªæ¨¡å—å’Œç‰¹å¾æå–å™¨çš„è®­ç»ƒç›®æ ‡æ˜¯ç›¸åçš„ã€‚</p><p>ä¸ç®€å•åŒºåˆ†æ‰€æœ‰åä½œAgentæ˜¯æ¨¡æ‹Ÿçš„è¿˜æ˜¯çœŸå®çš„ç›¸æ¯”ï¼ŒDUSAå°†åŒºåˆ†é—®é¢˜è§£è€¦ä¸ºä¸¤ä¸ªæ›´å…·ä½“ã€æ›´å°‘çº ç¼ çš„å­ä»»åŠ¡ï¼Œå³sim / realåŒºåˆ†å’ŒAgentç±»å‹åŒºåˆ†ã€‚è§£è€¦åçš„ä»»åŠ¡å¯ä»¥è®©åˆ¤åˆ«å™¨å‘ç°æ›´è¯¦ç»†çš„åŸŸé—´éš™ï¼Œå¹¶é€šè¿‡å¯¹æŠ—è®­ç»ƒå¢åŠ ç‰¹å¾æå–å™¨çš„åŸŸä¸å˜æ€§ã€‚</p><h4 id="Location-adaptive-Sim2Real-Adapter"><a href="#Location-adaptive-Sim2Real-Adapter" class="headerlink" title="Location-adaptive Sim2Real Adapter"></a>Location-adaptive Sim2Real Adapter</h4><p>ä½ç½®è‡ªé€‚åº”çš„Sim2Real Adapter ( LSA )æ¨¡å—æ—¨åœ¨å¼¥åˆæ¨¡æ‹Ÿæ•°æ®å’ŒçœŸå®ä¸–ç•Œæ•°æ®ä¹‹é—´çš„åŸŸé¸¿æ²Ÿã€‚ä¸ºäº†å°†æ™ºèƒ½ä½“ä¹‹é—´çš„åŸŸé—´éš™ä»sim / realåŸŸé—´éš™ä¸­å®Œå…¨æ’é™¤ï¼ŒLSAæ¨¡å—åªå¯¹å…·æœ‰ç›¸å¯¹ç›¸ä¼¼ä¼ æ„Ÿå™¨çš„æ™ºèƒ½ä½“è¿›è¡Œç‰¹å¾åŒºåˆ†ã€‚ä»è¿™ä¸¤ä¸ªé¢†åŸŸä¸­é€‰æ‹©è‡ªæˆ‘ä¸»ä½“çš„ç‰¹å¾â€ F (ego Pego ) ; Î¸) â€œæ¥è¿›è¡ŒåŒºåˆ†ï¼Œå› ä¸ºä»–ä»¬é€šå¸¸åœ¨é¡¶éƒ¨å®‰è£…æœ‰æœºæ¢°å¼æ¿€å…‰é›·è¾¾ï¼Œæ— è®ºä»–ä»¬æ¥è‡ªæ¨¡æ‹Ÿè¿˜æ˜¯çœŸå®æ•°æ®.</p><p><img data-src="https://s2.loli.net/2024/06/18/G5PyrlN9R7qs8An.png" alt="image-20240618211624223"></p><p>å•ä¸ªä¸»ä½“çš„æ˜¾è‘—ä½ç½®åˆ†å¸ƒæœ‰å…¶å†…åœ¨è§„å¾‹ã€‚ä¾‹å¦‚ï¼Œé è¿‘æ™ºèƒ½ä½“çš„ç½‘æ ¼é€šå¸¸æ¯”è¿œç¦»æ™ºèƒ½ä½“çš„ç½‘æ ¼æ‹¥æœ‰æ›´å¤šçš„é¢†åŸŸçº¿ç´¢ï¼Œå› ä¸ºå®ƒä»¬é€šå¸¸åœ¨é™„è¿‘çš„è½¦è¾†ä¸Šæ‹¥æœ‰æ›´å¤šçš„LiDARç‚¹ã€‚æ­¤å¤–ï¼Œè½¦è¾†å‰æ–¹çš„ç½‘æ ¼é€šå¸¸æ¯”è½¦è¾†åæ–¹çš„ç½‘æ ¼æ›´åŠ æ˜¾è‘—ã€‚å› æ­¤ï¼Œæˆ‘ä»¬è®¾è®¡äº†ä¸€ä¸ªä½ç½®è‡ªé€‚åº”çš„ç‰¹å¾é€‰æ‹©å™¨æ¨¡å—ï¼Œæ ¹æ®åˆ†å¸ƒè‡ªé€‚åº”åœ°é€‰æ‹©é‡è¦çš„ç‰¹å¾ã€‚å…·ä½“æ¥è¯´ï¼Œæˆ‘ä»¬<strong>ä½¿ç”¨ä¸€ä¸ªå¯å­¦ä¹ çš„ç‰¹å¾é€‰æ‹©å›¾M~loc~æ¥æ•è·åˆ†å¸ƒçš„å†…éƒ¨æ¨¡å¼ï¼Œå¹¶ç›¸åº”åœ°ä»è‡ªæˆ‘ä»£ç†çš„ç‰¹å¾å›¾ä¸­é€‰æ‹©å…·æœ‰é‡è¦æ„ä¹‰çš„ç‰¹å¾</strong></p><script type="math/tex; mode=display">\tilde{F}^{weighted}(P_{ego};\theta)=\tilde{F}(P_{ego};\theta)\odot M_{loc}</script><p>ç„¶åä½¿ç”¨å…¨å±€å¹³å‡æ± åŒ–æ“ä½œæ¥è·å¾—ä¸€ä¸ªå…¨å±€ç‰¹å¾</p><script type="math/tex; mode=display">S(\tilde{F}(P_{ego};\theta))=\frac{1}{HW}\sum_{u,v}\tilde{F}^{weighted}(P_{ego};\theta)^{(u,v)}</script><p>æˆ‘ä»¬å¯¹èšåˆåçš„å…¨å±€ç‰¹å¾S ( â€œ F â€œ ( P~ego~ ; Î¸) )è¿›è¡Œsim / realåˆ¤åˆ«ã€‚sim / realé‰´åˆ«å™¨åŒ…å«è‹¥å¹²ä¸ªå…¨è¿æ¥å±‚,å…·æœ‰ReLUæ¿€æ´»å’ŒDropout.æˆ‘ä»¬å°†å…¶è®°ä¸ºD^sim^( Â· ; wsim)ï¼Œå…¶ä¸­w^sim^æ˜¯sim / realåˆ¤åˆ«å™¨çš„å‚æ•°.</p><script type="math/tex; mode=display">\max_{\theta}\min_{w^{sim}}\mathcal{L}_{sim}=\frac{1}{N}\sum_{i=1}^{N}\mathcal{L}_{BCE}(D^{sim}(S(\tilde{F}(P_{ego};\theta));w^{sim}),d_{i})</script><blockquote><p>ä¸ºäº†è”åˆä¼˜åŒ–æ–¹ç¨‹ä¸­çš„æœ€å¤§æœ€å°åŒ–ä¼˜åŒ–é—®é¢˜ï¼Œåœ¨LSAæ¨¡å—çš„è¾“å…¥ä¹‹å‰æ’å…¥ä¸€ä¸ªæ¢¯åº¦åè½¬å±‚( GRL ).</p><p>é€šè¿‡è¿™æ ·åšï¼Œå¯ä»¥åœ¨å•æ­¥å†…å®Œæˆä¼˜åŒ–</p></blockquote><h4 id="Confidence-aware-Inter-agent-Adapter"><a href="#Confidence-aware-Inter-agent-Adapter" class="headerlink" title="Confidence-aware Inter-agent Adapter"></a>Confidence-aware Inter-agent Adapter</h4><p><img data-src="https://s2.loli.net/2024/06/18/tl34MIGVQLrNZOJ.png" alt="image-20240618212733684"></p><p>ç½®ä¿¡åº¦æ„ŸçŸ¥çš„æ™ºèƒ½ä½“é€‚é…å™¨( CIA )æ¨¡å—æ—¨åœ¨æœ€å°åŒ–ç°å®ä¸–ç•Œä¸­<strong>å¼‚æ„æ™ºèƒ½ä½“ä¹‹é—´çš„é¢†åŸŸå·®è·</strong>ã€‚å®ƒä¸“æ³¨äºè¯†åˆ«çœŸå®ä¸–ç•Œæ™ºèƒ½ä½“çš„ç»†ç²’åº¦ç‰¹å¾å›¾â€ F ( Xt i ; Î¸) â€œï¼Œæ’é™¤äº†ä»¿çœŸå’ŒçœŸå®ä¸–ç•Œä¹‹é—´çš„é¢†åŸŸå·®è·ã€‚</p><p>æˆ‘ä»¬å¯¹æ¥è‡ªç›®æ ‡åŸŸ(çœŸå®ä¸–ç•Œ)çš„æ™ºèƒ½ä½“ç»†ç²’åº¦ç‰¹å¾å›¾â€ F ( Xt i ; Î¸) â€œè¿›è¡Œæ™ºèƒ½ä½“é—´åˆ¤åˆ«ã€‚æ™ºèƒ½ä½“é—´åˆ¤åˆ«å™¨åŒ…æ‹¬è‹¥å¹²ä¸ªå…·æœ‰ReLUæ¿€æ´»çš„1 Ã— 1å·ç§¯å±‚ã€‚æˆ‘ä»¬å°†å…¶è®°ä¸ºD^agent^ ( Â· ; w^agent^)ï¼Œå…¶ä¸­w agentæ˜¯agenté—´åˆ¤åˆ«å™¨çš„å‚æ•°.</p><p>åœ¨æ™ºèƒ½ä½“ç»†ç²’åº¦ç‰¹å¾å›¾ä¸­ï¼Œå­˜åœ¨ä¸€äº›å‡ ä¹æ²¡æœ‰ç½‘æ ¼çš„ç½‘æ ¼ï¼Œè¿™äº›ç½‘æ ¼ä¸­çš„ç‚¹éå¸¸å°‘ã€‚å› æ­¤ï¼Œè¿™äº›ç½‘æ ¼åŒ…å«å¾ˆå°‘çš„å…³äºä¼ æ„Ÿå™¨çš„çº¿ç´¢ï¼Œå¹¶ä¸”ä¸é€‚åˆè¿›è¡Œæ™ºèƒ½ä½“ä¹‹é—´çš„åŒºåˆ†ã€‚åœ¨è¿™äº›ç½‘æ ¼ä¸Šç›‘ç£æ™ºèƒ½ä½“ä¹‹é—´çš„é‰´åˆ«å™¨å¯èƒ½ä¼šåœ¨æ¢¯åº¦ä¸­åŒ…å«å™ªå£°ï¼Œå¹¶å¢åŠ ä¼˜åŒ–è¿‡ç¨‹çš„ä¸ç¨³å®šæ€§ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬<strong>æå‡ºåˆ©ç”¨æ™ºèƒ½ä½“é—´çš„ç½®ä¿¡å›¾æ¥reweightæ™ºèƒ½ä½“é—´çš„åŒºåˆ†åº¦æŸå¤±</strong>ã€‚</p><script type="math/tex; mode=display">M_{conf}^{(u,v)}=\min_jP^{conf}(F(X_i^t;\theta)_j;\beta)^{(u,v)}</script><p>ç„¶åä½¿ç”¨é‡ç§°map M~conf~é‡æ–°å¹³è¡¡æ¯ä¸ªç½‘æ ¼çš„æŸå¤±ã€‚</p><p>L~CE~ä¸ºäº¤å‰ç†µæŸå¤±ï¼Œjè¡¨ç¤ºagentä¸ªæ•°ã€‚åœ¨CIAæ¨¡å—çš„è¾“å…¥ä¹‹å‰è¿˜æ’å…¥äº†ä¸€ä¸ªæ¢¯åº¦åè½¬å±‚( GRL ) </p><script type="math/tex; mode=display">\begin{aligned}\max_{\theta}\min_{w^{agent}}\mathcal{L}_{agent}=& \frac1{N_t\cdot n_a}\sum_{i=1}^{N_t}\sum_{j=1}^{n_a}\sum_{u,v}M_{conf}^{(u,v)}.  \\&\mathcal{L}_{CE}(D^{agent}(\tilde{F}(X_{i}^{t};\theta)_{j};w^{agent})^{(u,v)},j)\end{aligned}</script><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;p&gt;éšç€å¤§æ¨¡å‹æ—¶ä»£çš„åˆ°æ¥,åŸå…ˆé€šè¿‡ä¿®æ”¹æ¨¡å‹ç»“æ„æå‡æ€§èƒ½å†™è®ºæ–‡çš„æ–¹å¼å·²ç»æœ‰ç‚¹out of dateäº†,åŒæ—¶å†™æ–‡ç« çš„å€¾å‘å·²ç»ä»æ”¹æ¶æ„æˆSOTAæ…¢æ…¢è½¬å˜ä¸ºå›å½’ä»»åŠ¡èƒŒæ™¯ä»¥åŠè®²å¥½ä¸€ä¸ªå®Œæ•´æ•…äº‹å¹¶ç»™å‡ºè‡ªå·±çš„findingså’Œinsightäº†.ä¹Ÿå› æ­¤,åœ¨åä½œæ„ŸçŸ¥æ–¹é¢,è®ºæ–‡æ–¹å‘ä¹Ÿé€æ¸åœ¨è½¬å˜,è¿™é‡Œçœ‹çœ‹æœ€è¿‘çš„æ–‡ç« æ•´ç†ä¸€ä¸‹æ€è·¯.&lt;/p&gt;</summary>
    
    
    
    
    <category term="collaborative perception" scheme="https://www.sekyoro.top/tags/collaborative-perception/"/>
    
  </entry>
  
  <entry>
    <title>computer graphics:è®¡ç®—æœºå›¾å½¢å­¦å­¦ä¹ </title>
    <link href="https://www.sekyoro.top/2024/05/07/computer-graphics-%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9B%BE%E5%BD%A2%E5%AD%A6%E5%AD%A6%E4%B9%A0/"/>
    <id>https://www.sekyoro.top/2024/05/07/computer-graphics-%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9B%BE%E5%BD%A2%E5%AD%A6%E5%AD%A6%E4%B9%A0/</id>
    <published>2024-05-07T10:46:32.000Z</published>
    <updated>2024-06-25T02:49:39.344Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>ç®€ç®€å•å•å­¦ä¸ªæ¦‚å¿µ.<br><span id="more"></span></p><p>æ—©æœŸçš„OpenGLä½¿ç”¨ç«‹å³æ¸²æŸ“æ¨¡å¼ï¼ˆImmediate modeï¼Œä¹Ÿå°±æ˜¯å›ºå®šæ¸²æŸ“ç®¡çº¿ï¼‰ï¼Œè¿™ä¸ªæ¨¡å¼ä¸‹ç»˜åˆ¶å›¾å½¢å¾ˆæ–¹ä¾¿ã€‚OpenGLçš„å¤§å¤šæ•°åŠŸèƒ½éƒ½è¢«åº“éšè—èµ·æ¥ï¼Œå¼€å‘è€…å¾ˆå°‘æœ‰æ§åˆ¶OpenGLå¦‚ä½•è¿›è¡Œè®¡ç®—çš„è‡ªç”±ã€‚è€Œå¼€å‘è€…è¿«åˆ‡å¸Œæœ›èƒ½æœ‰æ›´å¤šçš„çµæ´»æ€§ã€‚éšç€æ—¶é—´æ¨ç§»ï¼Œè§„èŒƒè¶Šæ¥è¶Šçµæ´»ï¼Œå¼€å‘è€…å¯¹ç»˜å›¾ç»†èŠ‚æœ‰äº†æ›´å¤šçš„æŒæ§ã€‚ç«‹å³æ¸²æŸ“æ¨¡å¼ç¡®å®å®¹æ˜“ä½¿ç”¨å’Œç†è§£ï¼Œä½†æ˜¯æ•ˆç‡å¤ªä½ã€‚<strong>å› æ­¤ä»OpenGL3.2å¼€å§‹ï¼Œè§„èŒƒæ–‡æ¡£å¼€å§‹åºŸå¼ƒç«‹å³æ¸²æŸ“æ¨¡å¼ï¼Œå¹¶é¼“åŠ±å¼€å‘è€…åœ¨OpenGLçš„æ ¸å¿ƒæ¨¡å¼(Core-profile)ä¸‹è¿›è¡Œå¼€å‘</strong>ï¼Œè¿™ä¸ªåˆ†æ”¯çš„è§„èŒƒå®Œå…¨ç§»é™¤äº†æ—§çš„ç‰¹æ€§ã€‚</p><p>å½“ä½¿ç”¨OpenGLçš„æ ¸å¿ƒæ¨¡å¼æ—¶ï¼ŒOpenGLè¿«ä½¿æˆ‘ä»¬ä½¿ç”¨ç°ä»£çš„å‡½æ•°ã€‚å½“æˆ‘ä»¬è¯•å›¾ä½¿ç”¨ä¸€ä¸ªå·²åºŸå¼ƒçš„å‡½æ•°æ—¶ï¼ŒOpenGLä¼šæŠ›å‡ºä¸€ä¸ªé”™è¯¯å¹¶ç»ˆæ­¢ç»˜å›¾ã€‚ç°ä»£å‡½æ•°çš„ä¼˜åŠ¿æ˜¯æ›´é«˜çš„çµæ´»æ€§å’Œæ•ˆç‡ï¼Œç„¶è€Œä¹Ÿæ›´éš¾äºå­¦ä¹ ã€‚ç«‹å³æ¸²æŸ“æ¨¡å¼ä»OpenGL<strong>å®é™…</strong>è¿ä½œä¸­æŠ½è±¡æ‰äº†å¾ˆå¤šç»†èŠ‚ï¼Œå› æ­¤å®ƒåœ¨æ˜“äºå­¦ä¹ çš„åŒæ—¶ï¼Œä¹Ÿå¾ˆéš¾è®©äººå»æŠŠæ¡OpenGLå…·ä½“æ˜¯å¦‚ä½•è¿ä½œçš„ã€‚ç°ä»£å‡½æ•°è¦æ±‚ä½¿ç”¨è€…çœŸæ­£ç†è§£OpenGLå’Œå›¾å½¢ç¼–ç¨‹ï¼Œå®ƒæœ‰ä¸€äº›éš¾åº¦ï¼Œç„¶è€Œæä¾›äº†æ›´å¤šçš„çµæ´»æ€§ï¼Œæ›´é«˜çš„æ•ˆç‡ï¼Œæ›´é‡è¦çš„æ˜¯å¯ä»¥æ›´æ·±å…¥çš„ç†è§£å›¾å½¢ç¼–ç¨‹</p><p>ä½¿ç”¨GLADå’ŒGLFWä½œä¸ºç‰ˆæœ¬å’Œçª—å£ç®¡ç†åº“.</p><ul><li><p>glfwWindowShouldCloseå‡½æ•°åœ¨æˆ‘ä»¬æ¯æ¬¡å¾ªç¯çš„å¼€å§‹å‰æ£€æŸ¥ä¸€æ¬¡GLFWæ˜¯å¦è¢«è¦æ±‚é€€å‡ºï¼Œå¦‚æœæ˜¯çš„è¯ï¼Œè¯¥å‡½æ•°è¿”å›<code>true</code>ï¼Œæ¸²æŸ“å¾ªç¯å°†åœæ­¢è¿è¡Œï¼Œä¹‹åæˆ‘ä»¬å°±å¯ä»¥å…³é—­åº”ç”¨ç¨‹åºã€‚</p></li><li><p>glfwPollEventså‡½æ•°æ£€æŸ¥æœ‰æ²¡æœ‰è§¦å‘ä»€ä¹ˆäº‹ä»¶ï¼ˆæ¯”å¦‚é”®ç›˜è¾“å…¥ã€é¼ æ ‡ç§»åŠ¨ç­‰ï¼‰ã€æ›´æ–°çª—å£çŠ¶æ€ï¼Œå¹¶è°ƒç”¨å¯¹åº”çš„å›è°ƒå‡½æ•°ï¼ˆå¯ä»¥é€šè¿‡å›è°ƒæ–¹æ³•æ‰‹åŠ¨è®¾ç½®ï¼‰ã€‚</p></li><li><p>glfwSwapBufferså‡½æ•°ä¼šäº¤æ¢é¢œè‰²ç¼“å†²ï¼ˆå®ƒæ˜¯ä¸€ä¸ªå‚¨å­˜ç€GLFWçª—å£æ¯ä¸€ä¸ªåƒç´ é¢œè‰²å€¼çš„å¤§ç¼“å†²ï¼‰ï¼Œå®ƒåœ¨è¿™ä¸€è¿­ä»£ä¸­è¢«ç”¨æ¥ç»˜åˆ¶ï¼Œå¹¶ä¸”å°†ä¼šä½œä¸ºè¾“å‡ºæ˜¾ç¤ºåœ¨å±å¹•ä¸Šã€‚</p></li></ul><p>åœ¨OpenGLä¸­ï¼Œä»»ä½•äº‹ç‰©éƒ½åœ¨3Dç©ºé—´ä¸­ï¼Œè€Œå±å¹•å’Œçª—å£å´æ˜¯2Dåƒç´ æ•°ç»„ï¼Œè¿™å¯¼è‡´OpenGLçš„å¤§éƒ¨åˆ†å·¥ä½œéƒ½æ˜¯å…³äºæŠŠ3Dåæ ‡è½¬å˜ä¸ºé€‚åº”ä½ å±å¹•çš„2Dåƒç´ ã€‚3Dåæ ‡è½¬ä¸º2Dåæ ‡çš„å¤„ç†è¿‡ç¨‹æ˜¯ç”±OpenGLçš„å›¾å½¢æ¸²æŸ“ç®¡çº¿ï¼ˆGraphics Pipelineï¼Œå¤§å¤šè¯‘ä¸ºç®¡çº¿ï¼Œ<strong>å®é™…ä¸ŠæŒ‡çš„æ˜¯ä¸€å †åŸå§‹å›¾å½¢æ•°æ®é€”ç»ä¸€ä¸ªè¾“é€ç®¡é“ï¼ŒæœŸé—´ç»è¿‡å„ç§å˜åŒ–å¤„ç†æœ€ç»ˆå‡ºç°åœ¨å±å¹•çš„è¿‡ç¨‹ï¼‰ç®¡ç†çš„</strong>ã€‚å›¾å½¢æ¸²æŸ“ç®¡çº¿å¯ä»¥è¢«åˆ’åˆ†ä¸ºä¸¤ä¸ªä¸»è¦éƒ¨åˆ†ï¼š<strong>ç¬¬ä¸€éƒ¨åˆ†æŠŠä½ çš„3Dåæ ‡è½¬æ¢ä¸º2Dåæ ‡</strong>ï¼Œ<strong>ç¬¬äºŒéƒ¨åˆ†æ˜¯æŠŠ2Dåæ ‡è½¬å˜ä¸ºå®é™…çš„æœ‰é¢œè‰²çš„åƒç´ </strong>ã€‚</p><p><strong>å›¾å½¢æ¸²æŸ“ç®¡çº¿æ¥å—ä¸€ç»„3Dåæ ‡ï¼Œç„¶åæŠŠå®ƒä»¬è½¬å˜ä¸ºä½ å±å¹•ä¸Šçš„æœ‰è‰²2Dåƒç´ è¾“å‡º</strong>ã€‚å›¾å½¢æ¸²æŸ“ç®¡çº¿å¯ä»¥è¢«åˆ’åˆ†ä¸ºå‡ ä¸ªé˜¶æ®µï¼Œæ¯ä¸ªé˜¶æ®µå°†ä¼šæŠŠå‰ä¸€ä¸ªé˜¶æ®µçš„è¾“å‡ºä½œä¸ºè¾“å…¥ã€‚æ‰€æœ‰è¿™äº›é˜¶æ®µéƒ½æ˜¯é«˜åº¦ä¸“é—¨åŒ–çš„ï¼ˆå®ƒä»¬éƒ½æœ‰ä¸€ä¸ªç‰¹å®šçš„å‡½æ•°ï¼‰ï¼Œå¹¶ä¸”å¾ˆå®¹æ˜“å¹¶è¡Œæ‰§è¡Œã€‚æ­£æ˜¯ç”±äºå®ƒä»¬å…·æœ‰å¹¶è¡Œæ‰§è¡Œçš„ç‰¹æ€§ï¼Œå½“ä»Šå¤§å¤šæ•°æ˜¾å¡éƒ½æœ‰æˆåƒä¸Šä¸‡çš„å°å¤„ç†æ ¸å¿ƒï¼Œ<strong>å®ƒä»¬åœ¨GPUä¸Šä¸ºæ¯ä¸€ä¸ªï¼ˆæ¸²æŸ“ç®¡çº¿ï¼‰é˜¶æ®µè¿è¡Œå„è‡ªçš„å°ç¨‹åºï¼Œä»è€Œåœ¨å›¾å½¢æ¸²æŸ“ç®¡çº¿ä¸­å¿«é€Ÿå¤„ç†ä½ çš„æ•°æ®ã€‚è¿™äº›å°ç¨‹åºå«åšç€è‰²å™¨(Shader)</strong>ã€‚</p><p>æœ‰äº›ç€è‰²å™¨å¯ä»¥ç”±å¼€å‘è€…é…ç½®ï¼Œå› ä¸ºå…è®¸ç”¨è‡ªå·±å†™çš„ç€è‰²å™¨æ¥ä»£æ›¿é»˜è®¤çš„ï¼Œæ‰€ä»¥èƒ½å¤Ÿæ›´ç»†è‡´åœ°æ§åˆ¶å›¾å½¢æ¸²æŸ“ç®¡çº¿ä¸­çš„ç‰¹å®šéƒ¨åˆ†äº†ã€‚å› ä¸ºå®ƒä»¬è¿è¡Œåœ¨GPUä¸Šï¼Œæ‰€ä»¥èŠ‚çœäº†å®è´µçš„CPUæ—¶é—´ã€‚<strong>OpenGLç€è‰²å™¨æ˜¯ç”¨OpenGLç€è‰²å™¨è¯­è¨€(OpenGL Shading Language, GLSL)å†™æˆçš„</strong></p><p><img data-src="https://learnopengl-cn.github.io/img/01/04/pipeline.png" alt="img" style="zoom: 67%;" /></p><p><strong>å›¾å½¢æ¸²æŸ“ç®¡çº¿åŒ…å«å¾ˆå¤šéƒ¨åˆ†ï¼Œæ¯ä¸ªéƒ¨åˆ†éƒ½å°†åœ¨è½¬æ¢é¡¶ç‚¹æ•°æ®åˆ°æœ€ç»ˆåƒç´ è¿™ä¸€è¿‡ç¨‹ä¸­å¤„ç†å„è‡ªç‰¹å®šçš„é˜¶æ®µ</strong></p><p>å›¾å½¢æ¸²æŸ“ç®¡çº¿çš„ç¬¬ä¸€ä¸ªéƒ¨åˆ†æ˜¯<strong>é¡¶ç‚¹ç€è‰²å™¨</strong>(Vertex Shader)ï¼Œå®ƒæŠŠä¸€ä¸ªå•ç‹¬çš„é¡¶ç‚¹ä½œä¸ºè¾“å…¥ã€‚é¡¶ç‚¹ç€è‰²å™¨ä¸»è¦çš„ç›®çš„æ˜¯æŠŠ3Dåæ ‡è½¬ä¸ºå¦ä¸€ç§3Dåæ ‡ï¼ŒåŒæ—¶é¡¶ç‚¹ç€è‰²å™¨å…è®¸æˆ‘ä»¬å¯¹é¡¶ç‚¹å±æ€§è¿›è¡Œä¸€äº›åŸºæœ¬å¤„ç†</p><p>é¡¶ç‚¹ç€è‰²å™¨é˜¶æ®µçš„è¾“å‡ºå¯ä»¥é€‰æ‹©æ€§åœ°ä¼ é€’ç»™<strong>å‡ ä½•ç€è‰²å™¨</strong>(Geometry Shader)ã€‚å‡ ä½•ç€è‰²å™¨å°†ä¸€ç»„é¡¶ç‚¹ä½œä¸ºè¾“å…¥ï¼Œ<strong>è¿™äº›é¡¶ç‚¹å½¢æˆå›¾å…ƒï¼Œå¹¶ä¸”èƒ½å¤Ÿé€šè¿‡å‘å‡ºæ–°çš„é¡¶ç‚¹æ¥å½¢æˆæ–°çš„(æˆ–å…¶ä»–)å›¾å…ƒæ¥ç”Ÿæˆå…¶ä»–å½¢çŠ¶</strong>ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå®ƒä»ç»™å®šçš„å½¢çŠ¶ä¸­ç”Ÿæˆç¬¬äºŒä¸ªä¸‰è§’å½¢ã€‚</p><blockquote><p>ä¸ºäº†è®©OpenGLçŸ¥é“æˆ‘ä»¬çš„åæ ‡å’Œé¢œè‰²å€¼æ„æˆçš„åˆ°åº•æ˜¯ä»€ä¹ˆï¼ŒOpenGLéœ€è¦ä½ å»æŒ‡å®šè¿™äº›æ•°æ®æ‰€è¡¨ç¤ºçš„æ¸²æŸ“ç±»å‹ã€‚æˆ‘ä»¬æ˜¯å¸Œæœ›æŠŠè¿™äº›æ•°æ®æ¸²æŸ“æˆä¸€ç³»åˆ—çš„ç‚¹ï¼Ÿä¸€ç³»åˆ—çš„ä¸‰è§’å½¢ï¼Ÿè¿˜æ˜¯ä»…ä»…æ˜¯ä¸€ä¸ªé•¿é•¿çš„çº¿ï¼Ÿ<strong>åšå‡ºçš„è¿™äº›æç¤ºå«åšå›¾å…ƒ(Primitive)ï¼Œä»»ä½•ä¸€ä¸ªç»˜åˆ¶æŒ‡ä»¤çš„è°ƒç”¨éƒ½å°†æŠŠå›¾å…ƒä¼ é€’ç»™OpenGLã€‚è¿™æ˜¯å…¶ä¸­çš„å‡ ä¸ªï¼šGL_POINTSã€GL_TRIANGLESã€GL_LINE_STRIP</strong>ã€‚</p></blockquote><p><strong>å›¾å…ƒè£…é…</strong>(Primitive Assembly)é˜¶æ®µå°†é¡¶ç‚¹ç€è‰²å™¨ï¼ˆæˆ–å‡ ä½•ç€è‰²å™¨ï¼‰è¾“å‡ºçš„æ‰€æœ‰é¡¶ç‚¹ä½œä¸ºè¾“å…¥ï¼ˆå¦‚æœæ˜¯GL_POINTSï¼Œé‚£ä¹ˆå°±æ˜¯ä¸€ä¸ªé¡¶ç‚¹ï¼‰ï¼Œå¹¶å°†æ‰€æœ‰çš„ç‚¹è£…é…æˆæŒ‡å®šå›¾å…ƒçš„å½¢çŠ¶</p><p>å›¾å…ƒè£…é…é˜¶æ®µçš„è¾“å‡ºä¼šè¢«ä¼ å…¥å…‰æ …åŒ–é˜¶æ®µ(Rasterization Stage)ï¼Œè¿™é‡Œå®ƒä¼šæŠŠå›¾å…ƒæ˜ å°„ä¸ºæœ€ç»ˆå±å¹•ä¸Šç›¸åº”çš„åƒç´ ï¼Œç”Ÿæˆä¾›ç‰‡æ®µç€è‰²å™¨(Fragment Shader)ä½¿ç”¨çš„ç‰‡æ®µ(Fragment)ã€‚åœ¨ç‰‡æ®µç€è‰²å™¨è¿è¡Œä¹‹å‰ä¼šæ‰§è¡Œè£åˆ‡(Clipping)ã€‚è£åˆ‡ä¼šä¸¢å¼ƒè¶…å‡ºä½ çš„è§†å›¾ä»¥å¤–çš„æ‰€æœ‰åƒç´ ï¼Œç”¨æ¥æå‡æ‰§è¡Œæ•ˆç‡ã€‚</p><p>ç‰‡æ®µç€è‰²å™¨çš„ä¸»è¦ç›®çš„æ˜¯è®¡ç®—ä¸€ä¸ªåƒç´ çš„æœ€ç»ˆé¢œè‰²ï¼Œè¿™ä¹Ÿæ˜¯æ‰€æœ‰OpenGLé«˜çº§æ•ˆæœäº§ç”Ÿçš„åœ°æ–¹ã€‚é€šå¸¸ï¼Œç‰‡æ®µç€è‰²å™¨åŒ…å«3Dåœºæ™¯çš„æ•°æ®ï¼ˆæ¯”å¦‚å…‰ç…§ã€é˜´å½±ã€å…‰çš„é¢œè‰²ç­‰ç­‰ï¼‰ï¼Œè¿™äº›æ•°æ®å¯ä»¥è¢«ç”¨æ¥è®¡ç®—æœ€ç»ˆåƒç´ çš„é¢œè‰²</p><p>åœ¨æ‰€æœ‰å¯¹åº”é¢œè‰²å€¼ç¡®å®šä»¥åï¼Œæœ€ç»ˆçš„å¯¹è±¡å°†ä¼šè¢«ä¼ åˆ°æœ€åä¸€ä¸ªé˜¶æ®µï¼Œæˆ‘ä»¬å«åšAlphaæµ‹è¯•å’Œæ··åˆ(Blending)é˜¶æ®µã€‚è¿™ä¸ªé˜¶æ®µæ£€æµ‹ç‰‡æ®µçš„å¯¹åº”çš„æ·±åº¦ï¼ˆå’Œæ¨¡æ¿(Stencil)ï¼‰å€¼ï¼ˆåé¢ä¼šè®²ï¼‰ï¼Œç”¨å®ƒä»¬æ¥åˆ¤æ–­è¿™ä¸ªåƒç´ æ˜¯å…¶å®ƒç‰©ä½“çš„å‰é¢è¿˜æ˜¯åé¢ï¼Œå†³å®šæ˜¯å¦åº”è¯¥ä¸¢å¼ƒã€‚è¿™ä¸ªé˜¶æ®µä¹Ÿä¼šæ£€æŸ¥alphaå€¼ï¼ˆalphaå€¼å®šä¹‰äº†ä¸€ä¸ªç‰©ä½“çš„é€æ˜åº¦ï¼‰å¹¶å¯¹ç‰©ä½“è¿›è¡Œæ··åˆ(Blend)ã€‚æ‰€ä»¥ï¼Œå³ä½¿åœ¨ç‰‡æ®µç€è‰²å™¨ä¸­è®¡ç®—å‡ºæ¥äº†ä¸€ä¸ªåƒç´ è¾“å‡ºçš„é¢œè‰²ï¼Œåœ¨æ¸²æŸ“å¤šä¸ªä¸‰è§’å½¢çš„æ—¶å€™æœ€åçš„åƒç´ é¢œè‰²ä¹Ÿå¯èƒ½å®Œå…¨ä¸åŒ</p><p><strong>ç„¶è€Œï¼Œå¯¹äºå¤§å¤šæ•°åœºåˆï¼Œæˆ‘ä»¬åªéœ€è¦é…ç½®é¡¶ç‚¹å’Œç‰‡æ®µç€è‰²å™¨å°±è¡Œäº†ã€‚å‡ ä½•ç€è‰²å™¨æ˜¯å¯é€‰çš„ï¼Œé€šå¸¸ä½¿ç”¨å®ƒé»˜è®¤çš„ç€è‰²å™¨å°±è¡Œäº†ã€‚</strong></p><p>åœ¨ç°ä»£OpenGLä¸­ï¼Œæˆ‘ä»¬<strong>å¿…é¡»</strong>å®šä¹‰è‡³å°‘ä¸€ä¸ªé¡¶ç‚¹ç€è‰²å™¨å’Œä¸€ä¸ªç‰‡æ®µç€è‰²å™¨ï¼ˆå› ä¸ºGPUä¸­æ²¡æœ‰é»˜è®¤çš„é¡¶ç‚¹/ç‰‡æ®µç€è‰²å™¨ï¼‰ã€‚å‡ºäºè¿™ä¸ªåŸå› ï¼Œåˆšå¼€å§‹å­¦ä¹ ç°ä»£OpenGLçš„æ—¶å€™å¯èƒ½ä¼šéå¸¸å›°éš¾ï¼Œå› ä¸ºåœ¨ä½ èƒ½å¤Ÿæ¸²æŸ“è‡ªå·±çš„ç¬¬ä¸€ä¸ªä¸‰è§’å½¢ä¹‹å‰å·²ç»éœ€è¦äº†è§£ä¸€å¤§å †çŸ¥è¯†äº†ã€‚åœ¨æœ¬èŠ‚ç»“æŸä½ æœ€ç»ˆæ¸²æŸ“å‡ºä½ çš„ä¸‰è§’å½¢çš„æ—¶å€™ï¼Œä½ ä¹Ÿä¼šäº†è§£åˆ°éå¸¸å¤šçš„å›¾å½¢ç¼–ç¨‹çŸ¥è¯†ã€‚</p><p>OpenGLæ˜¯ä¸€ä¸ª3Då›¾å½¢åº“ï¼Œæ‰€ä»¥åœ¨OpenGLä¸­æˆ‘ä»¬æŒ‡å®šçš„æ‰€æœ‰åæ ‡éƒ½æ˜¯3Dåæ ‡ï¼ˆxã€yå’Œzï¼‰ã€‚OpenGLä¸æ˜¯ç®€å•åœ°æŠŠ<strong>æ‰€æœ‰çš„</strong>3Dåæ ‡å˜æ¢ä¸ºå±å¹•ä¸Šçš„2Dåƒç´ ï¼›<strong>OpenGLä»…å½“3Dåæ ‡åœ¨3ä¸ªè½´ï¼ˆxã€yå’Œzï¼‰ä¸Š-1.0åˆ°1.0çš„èŒƒå›´å†…æ—¶æ‰å¤„ç†å®ƒ</strong>ã€‚æ‰€æœ‰åœ¨è¿™ä¸ªèŒƒå›´å†…çš„åæ ‡å«åšæ ‡å‡†åŒ–è®¾å¤‡åæ ‡(Normalized Device Coordinates)ï¼Œæ­¤èŒƒå›´å†…çš„åæ ‡æœ€ç»ˆæ˜¾ç¤ºåœ¨å±å¹•ä¸Šï¼ˆåœ¨è¿™ä¸ªèŒƒå›´ä»¥å¤–çš„åæ ‡åˆ™ä¸ä¼šæ˜¾ç¤ºï¼‰ã€‚</p><p>é€šå¸¸æ·±åº¦å¯ä»¥ç†è§£ä¸ºzåæ ‡ï¼Œå®ƒä»£è¡¨ä¸€ä¸ªåƒç´ åœ¨ç©ºé—´ä¸­å’Œä½ çš„è·ç¦»ï¼Œå¦‚æœç¦»ä½ è¿œå°±å¯èƒ½è¢«åˆ«çš„åƒç´ é®æŒ¡ï¼Œä½ å°±çœ‹ä¸åˆ°å®ƒäº†ï¼Œå®ƒä¼šè¢«ä¸¢å¼ƒï¼Œä»¥èŠ‚çœèµ„æºã€‚</p><p>é€šè¿‡ä½¿ç”¨ç”±glViewportå‡½æ•°æä¾›çš„æ•°æ®ï¼Œè¿›è¡Œè§†å£å˜æ¢(Viewport Transform)ï¼Œæ ‡å‡†åŒ–è®¾å¤‡åæ ‡(Normalized Device Coordinates)ä¼šå˜æ¢ä¸ºå±å¹•ç©ºé—´åæ ‡(Screen-space Coordinates)ã€‚æ‰€å¾—çš„å±å¹•ç©ºé—´åæ ‡åˆä¼šè¢«å˜æ¢ä¸ºç‰‡æ®µè¾“å…¥åˆ°ç‰‡æ®µç€è‰²å™¨ä¸­ã€‚ å®šä¹‰è¿™æ ·çš„é¡¶ç‚¹æ•°æ®ä»¥åï¼Œæˆ‘ä»¬ä¼šæŠŠå®ƒä½œä¸ºè¾“å…¥å‘é€ç»™å›¾å½¢æ¸²æŸ“ç®¡çº¿çš„ç¬¬ä¸€ä¸ªå¤„ç†é˜¶æ®µï¼šé¡¶ç‚¹ç€è‰²å™¨ã€‚å®ƒä¼šåœ¨GPUä¸Šåˆ›å»ºå†…å­˜ç”¨äºå‚¨å­˜æˆ‘ä»¬çš„é¡¶ç‚¹æ•°æ®ï¼Œè¿˜è¦é…ç½®OpenGLå¦‚ä½•è§£é‡Šè¿™äº›å†…å­˜ï¼Œå¹¶ä¸”æŒ‡å®šå…¶å¦‚ä½•å‘é€ç»™æ˜¾å¡ã€‚é¡¶ç‚¹ç€è‰²å™¨æ¥ç€ä¼šå¤„ç†æˆ‘ä»¬åœ¨å†…å­˜ä¸­æŒ‡å®šæ•°é‡çš„é¡¶ç‚¹ã€‚</p><p>æˆ‘ä»¬é€šè¿‡é¡¶ç‚¹ç¼“å†²å¯¹è±¡(Vertex Buffer Objects, VBO)ç®¡ç†è¿™ä¸ªå†…å­˜ï¼Œå®ƒä¼šåœ¨GPUå†…å­˜ï¼ˆé€šå¸¸è¢«ç§°ä¸ºæ˜¾å­˜ï¼‰ä¸­å‚¨å­˜å¤§é‡é¡¶ç‚¹ã€‚ä½¿ç”¨è¿™äº›ç¼“å†²å¯¹è±¡çš„å¥½å¤„æ˜¯æˆ‘ä»¬å¯ä»¥ä¸€æ¬¡æ€§çš„å‘é€ä¸€å¤§æ‰¹æ•°æ®åˆ°æ˜¾å¡ä¸Šï¼Œè€Œä¸æ˜¯æ¯ä¸ªé¡¶ç‚¹å‘é€ä¸€æ¬¡ã€‚ä»CPUæŠŠæ•°æ®å‘é€åˆ°æ˜¾å¡ç›¸å¯¹è¾ƒæ…¢ï¼Œæ‰€ä»¥åªè¦å¯èƒ½æˆ‘ä»¬éƒ½è¦å°è¯•å°½é‡ä¸€æ¬¡æ€§å‘é€å°½å¯èƒ½å¤šçš„æ•°æ®ã€‚å½“æ•°æ®å‘é€è‡³æ˜¾å¡çš„å†…å­˜ä¸­åï¼Œé¡¶ç‚¹ç€è‰²å™¨å‡ ä¹èƒ½ç«‹å³è®¿é—®é¡¶ç‚¹ï¼Œè¿™æ˜¯ä¸ªéå¸¸å¿«çš„è¿‡ç¨‹ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> VBO;</span><br><span class="line"><span class="built_in">glGenBuffers</span>(<span class="number">1</span>, &amp;VBO);</span><br><span class="line"><span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, VBO); </span><br><span class="line"><span class="built_in">glBufferData</span>(GL_ARRAY_BUFFER, <span class="built_in"><span class="keyword">sizeof</span></span>(vertices), vertices, GL_STATIC_DRAW);</span><br></pre></td></tr></table></figure><p>ç°åœ¨æˆ‘ä»¬å·²ç»æŠŠé¡¶ç‚¹æ•°æ®å‚¨å­˜åœ¨æ˜¾å¡çš„å†…å­˜ä¸­ï¼Œç”¨VBOè¿™ä¸ªé¡¶ç‚¹ç¼“å†²å¯¹è±¡ç®¡ç†ã€‚ä¸‹é¢æˆ‘ä»¬ä¼šåˆ›å»ºä¸€ä¸ªé¡¶ç‚¹ç€è‰²å™¨å’Œç‰‡æ®µç€è‰²å™¨æ¥çœŸæ­£å¤„ç†è¿™äº›æ•°æ®ã€‚ã€‚</p><p>é¡¶ç‚¹ç€è‰²å™¨(Vertex Shader)æ˜¯å‡ ä¸ªå¯ç¼–ç¨‹ç€è‰²å™¨ä¸­çš„ä¸€ä¸ªã€‚å¦‚æœæˆ‘ä»¬æ‰“ç®—åšæ¸²æŸ“çš„è¯ï¼Œç°ä»£OpenGLéœ€è¦æˆ‘ä»¬è‡³å°‘è®¾ç½®ä¸€ä¸ª<strong>é¡¶ç‚¹å’Œä¸€ä¸ªç‰‡æ®µç€è‰²å™¨</strong>ã€‚</p><figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#version 330 core</span></span><br><span class="line"><span class="keyword">layout</span> (<span class="keyword">location</span> = <span class="number">0</span>) <span class="keyword">in</span> <span class="type">vec3</span> aPos;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> main()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">gl_Position</span> = <span class="type">vec4</span>(aPos.x, aPos.y, aPos.z, <span class="number">1.0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨<code>in</code>å…³é”®å­—ï¼Œåœ¨é¡¶ç‚¹ç€è‰²å™¨ä¸­å£°æ˜æ‰€æœ‰çš„è¾“å…¥é¡¶ç‚¹å±æ€§(Input Vertex Attribute)ã€‚ç°åœ¨æˆ‘ä»¬åªå…³å¿ƒä½ç½®(Position)æ•°æ®ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦ä¸€ä¸ªé¡¶ç‚¹å±æ€§ã€‚GLSLæœ‰ä¸€ä¸ªå‘é‡æ•°æ®ç±»å‹ï¼Œå®ƒåŒ…å«1åˆ°4ä¸ª<code>float</code>åˆ†é‡ï¼ŒåŒ…å«çš„æ•°é‡å¯ä»¥ä»å®ƒçš„åç¼€æ•°å­—çœ‹å‡ºæ¥</p><p>æ¯ä¸ªé¡¶ç‚¹éƒ½æœ‰ä¸€ä¸ª3Dåæ ‡ï¼Œæˆ‘ä»¬å°±åˆ›å»ºä¸€ä¸ª<code>vec3</code>è¾“å…¥å˜é‡aPosã€‚æˆ‘ä»¬åŒæ ·ä¹Ÿé€šè¿‡<code>layout (location = 0)</code>è®¾å®šäº†è¾“å…¥å˜é‡çš„ä½ç½®å€¼(Location)ä½ åé¢ä¼šçœ‹åˆ°ä¸ºä»€ä¹ˆæˆ‘ä»¬ä¼šéœ€è¦è¿™ä¸ªä½ç½®å€¼.</p><p>å†™å¥½glslå,é¦–å…ˆåˆ›å»ºä¸€ä¸ªç€è‰²å™¨å¯¹è±¡ï¼Œæ³¨æ„è¿˜æ˜¯ç”¨IDæ¥å¼•ç”¨çš„ã€‚æ‰€ä»¥æˆ‘ä»¬å‚¨å­˜è¿™ä¸ªé¡¶ç‚¹ç€è‰²å™¨ä¸º<code>unsigned int</code>ï¼Œç„¶åç”¨glCreateShaderåˆ›å»ºè¿™ä¸ªç€è‰²å™¨</p><h3 id="GAMES101"><a href="#GAMES101" class="headerlink" title="GAMES101"></a>GAMES101</h3><h4 id="è½¬æ¢"><a href="#è½¬æ¢" class="headerlink" title="è½¬æ¢"></a>è½¬æ¢</h4><p>ä½¿ç”¨homegeneous coordinates,å› ä¸º<strong>Translation cannot be represented in matrix form</strong></p><p><img data-src="https://s2.loli.net/2024/05/12/36b2pEjwCWGf7N8.png" alt="image-20240512215001385"></p><p><img data-src="https://s2.loli.net/2024/05/12/rA39m7M5WTFwQRD.png" alt="image-20240512223828687"></p><p><img data-src="https://s2.loli.net/2024/05/12/OxDF2GB7sUk8iRt.png" alt="image-20240512225758095"></p><p><img data-src="https://s2.loli.net/2024/05/12/yNZU6TEMkJw8vS5.png" alt="image-20240512231120803"></p><p><img data-src="https://s2.loli.net/2024/05/12/LjWzDSbx2McfVpa.png" alt="image-20240512231103788"></p><h4 id="assignment"><a href="#assignment" class="headerlink" title="assignment"></a>assignment</h4><h5 id="HW0"><a href="#HW0" class="headerlink" title="HW0"></a>HW0</h5><p>å­¦ä¹ Eigenåº“,äºŒç»´å’Œä¸‰ç»´çš„ç©ºé—´å˜æ¢,éƒ½å¯ä»¥æ‹†æˆæ—‹è½¬,æ”¾ç¼©å’Œå¹³ç§»,ä½†æ˜¯å¹³ç§»æ— æ³•ä½¿ç”¨ä¸åæ ‡ç»´æ•°ç›¸åŒçš„è½¬æ¢çŸ©é˜µ,å¯ä»¥é€šè¿‡homogeneous coordinates.</p><h5 id="HW1"><a href="#HW1" class="headerlink" title="HW1"></a>HW1</h5><p>è§‚æµ‹è½¬æ¢,è§†å›¾å’ŒæŠ•å½±è½¬æ¢. æŠ•å½±è½¬æ¢åˆå¯ä»¥åˆ†ä¸ºæ­£äº¤å’Œé€è§†æŠ•å½±.</p><p>view transformationå°±æ˜¯ç›¸æœºçš„æ‘†æ”¾,åŒ…æ‹¬ä½ç½®,æœå‘å’Œå‘ä¸Šçš„æ–¹å‘.</p><p><img data-src="https://s2.loli.net/2024/05/19/yApJSIKMls4CZzF.png" alt="image-20240519160531237"></p><p> åˆå«åšModelView Transformation.</p><p>ç›¸å½“äºå°†ç›¸æœºè¿ç€ç‰©ä½“ä¸€èµ·åšå˜æ¢,ä½¿å¾—ç›¸æœºæœç€-Z,ä½ç½®åœ¨åŸç‚¹,å‘ä¸Šæ–¹å‘åœ¨Y.</p><p><img data-src="https://s2.loli.net/2024/05/19/U5DBHQOvcAd2wqp.png" alt="image-20240519163320086"></p><p>ä¸€èˆ¬åšview transformationå°±æ˜¯å…ˆå¹³ç§»åæ—‹è½¬.</p><p><img data-src="https://s2.loli.net/2024/05/19/9EodBgHcTr5J874.png" alt="image-20240519164238487"></p><p>ç„¶ååšæŠ•å½±,ä¹Ÿå°±æ˜¯å°†3Då˜ä¸º2D,å…ˆåšé€è§†å†åšæ­£äº¤. åšé€è§†å› ä¸ºç¬¦åˆè§†è§‰ç³»ç»Ÿ,åšæ­£äº¤å°†ç‰©ä½“å½’ä¸€åŒ–å¹¶æ”¾åœ¨ä¸­å¿ƒ.</p><p><img data-src="https://s2.loli.net/2024/05/19/niHmVGBdhUIR2qv.png" alt="image-20240519164611669"></p><p>åšæ­£äº¤çŸ©é˜µå¦‚ä¸‹.</p><p><img data-src="https://s2.loli.net/2024/05/19/ucndILDTHwEMpmW.png" alt="image-20240519164927743"></p><p><img data-src="https://s2.loli.net/2024/05/19/t85cSLD7JZ6Vaep.png" alt="image-20240519164732598"></p><p>åšæŠ•å½±å¦‚ä¸‹,</p><p><img data-src="https://s2.loli.net/2024/05/19/Hl7XgyvkEi8Gen9.png" alt="image-20240519164510132"></p><p>é‡ç‚¹æ˜¯å…³äºé€è§†çŸ©é˜µçš„æ¨ç†,é¦–å…ˆå› ä¸ºç­‰æ¯”ä¾‹çš„åæ ‡ç¼©æ”¾,</p><p><img data-src="https://s2.loli.net/2024/05/19/Rv2IMdrlYDpk9Tq.png" alt="image-20240519181537968"></p><script type="math/tex; mode=display">\begin{pmatrix}x\\y\\z\\1\end{pmatrix}\Rightarrow\begin{pmatrix}nx/z\\ny/z\\\text{unknown}\\1\end{pmatrix}\overset{\text{mult by z}}{\operatorname*{==}}\begin{pmatrix}nx\\ny\\\text{still unknown}\\z\end{pmatrix}</script><p>è¿™æ ·å°±çŸ¥é“é€è§†æŠ•å½±çŸ©é˜µçš„ä¸‰è¡Œä¿¡æ¯</p><script type="math/tex; mode=display">M_{persp\to ortho}^{(4\times4)}\begin{pmatrix}x\\y\\z\\1\end{pmatrix}=\begin{pmatrix}nx\\ny\\\text{unknown}\\z\end{pmatrix} \\M_{persp\to ortho}=\begin{pmatrix}n&0&0&0\\0&n&0&0\\?&?&?&?\\0&0&1&0\end{pmatrix}</script><p>æ­¤å¤–,æœ‰ä¸¤ç‚¹:åœ¨near planeä¹Ÿå°±æ˜¯æŠ•å½±åˆ°çš„å¹³é¢ä¸Šçš„åæ ‡ç»è¿‡è¿™ä¸ªçŸ©é˜µè½¬æ¢åä¾ç„¶ä¸å˜,è€Œfar planeä¸Šçš„åæ ‡ç»è¿‡é€è§†æŠ•å½±åzåæ ‡ä¸å˜.</p><p>å¯¹äºnear plane(x,y,n,1),ç”±äºè½¬æ¢ååæ ‡ç›¸åŒå¾—åˆ°(nx,ny,n^2^,n).</p><script type="math/tex; mode=display">\begin{pmatrix}0&0&A&B\end{pmatrix}\begin{pmatrix}x\\y\\n\\1\end{pmatrix}=n^2</script><p>æ‰€ä»¥ç¬¬ä¸‰è¡Œçš„å€¼å¿…é¡»æ˜¯(0,0,A,B).å³æœ‰An+B=n^2^.</p><p>å‡è®¾far planeä¸Šçš„ä¸€ä¸ªç‚¹åæ ‡æ˜¯(x,y,f,1),ä¹Ÿæœ‰Af+B=f^2^.è§£å¾—</p><script type="math/tex; mode=display">\begin{aligned}An+B&=n^2\\Af+B&=f^2\end{aligned}\quad\begin{array}{c}A=n+f\\B=-nf\end{array}</script><p>æ‰€ä»¥é€è§†çŸ©é˜µå¦‚ä¸‹,å…¶ä¸­næ˜¯near planeä¸Šçš„ç‚¹çš„zåæ ‡,fæ˜¯éšä¾¿ä¸€ä¸ªç‚¹çš„zåæ ‡.</p><script type="math/tex; mode=display">M_{persp\to ortho}=\begin{pmatrix}n&0&0&0\\0&n&0&0\\0&0&n+f&-nf\\0&0&1&0\end{pmatrix}</script><p>æœ‰äº†é€è§†çŸ©é˜µå,æ­£äº¤çŸ©é˜µæ¯”è¾ƒç®€å•.åœ¨è¿›è¡ŒæŠ•å½±æ—¶å…ˆé€è§†åæ­£äº¤å°±å¾—åˆ°æŠ•å½±çŸ©é˜µäº†. å¦‚æœæœ‰äº†near planeçš„å››ä¸ªç‚¹åæ ‡å°±æ–¹ä¾¿è¿›è¡Œè§†å£å˜æ¢,æˆ–è€…é€šè¿‡fovYå’Œaspect ratio,å‰è€…æ˜¯ä¸€ä¸ªè§’åº¦,å¯ä»¥é€šè¿‡è¿™ä¸ªè§’åº¦çŸ¥é“è§†ç‚¹ä¸near planeå¹³é¢çš„è·ç¦»,aspect ratioæ˜¯å¹³é¢å®½åº¦/é«˜åº¦.</p><p><img data-src="https://s2.loli.net/2024/05/19/N5qEdQ7yZGDzgKn.png" alt="image-20240519231541738"></p><p><img data-src="https://s2.loli.net/2024/05/19/V6DlLH2M4jmpgXZ.png" alt="image-20240519224805373"></p><script type="math/tex; mode=display">\tan\frac{fovY}2=\frac t{|n|}\\aspect=\frac rt</script><p><img data-src="https://s2.loli.net/2024/05/19/PLHMImvQDRfVTUW.png" alt="image-20240519224814121"></p><p>åœ¨å›¾å½¢å­¦çš„MVP(model transformation,view transformation,project transformation)ä¹‹å,å¾—åˆ°äº†è§„èŒƒçš„2DæŠ•å½±.ç„¶åéœ€è¦å°†è§„èŒƒçš„cubeè½¬åˆ°screenä¸Š(è§†å£è½¬æ¢),screenå°±æ˜¯ä¸€ä¸ªpixelçš„æ•°ç»„,å¤§å°æ˜¯åˆ†è¾¨ç‡.rasterå°±æ˜¯screen.</p><p>å› ä¸ºåæ ‡å·²ç»å½’ä¸€åˆ°[-1,1],å†è½¬åˆ°[0,width]x[0,height],çº¿æ€§è½¬æ¢å³å¯.zåæ ‡ä¸ç”¨ç®¡</p><p><img data-src="https://s2.loli.net/2024/05/19/vuFnfNzxKCAotEl.png" alt="image-20240519225110452"></p><p><img data-src="https://s2.loli.net/2024/05/19/rasPKwzLBvY7SUk.png" alt="image-20240519225120720"></p><p><img data-src="https://s2.loli.net/2024/05/24/f5SoqHvmld8UpDV.png" alt="image-20240524111542315"></p><p>æå‡é¢˜</p><p>ç»•ä»»æ„è¿‡åŸç‚¹çš„è½´çš„æ—‹è½¬å˜æ¢çŸ©é˜µã€‚</p><p><img data-src="https://s2.loli.net/2024/05/24/LCIpUV8lKBtJRAD.png" alt="image-20240524171158093"></p><h5 id="HW2"><a href="#HW2" class="headerlink" title="HW2"></a>HW2</h5><p>ä¸Šé¢çš„å°±ç”»å‡ºäº†ä¸€ä¸ªçº¿æ¡†,ä½†æ˜¯ä¸ºäº†ç”»å‡ºå®Œæ•´ä¸‰è§’å½¢,çº¿æ¡†é‡Œçš„å€¼è¿˜éœ€è¦å…‰æ …åŒ–.é¦–å…ˆéœ€è¦åˆ¤å®šç‚¹æ˜¯å¦åœ¨çº¿æ¡†å†…,æ¶‰åŠåˆ°cross productså’Œä½¿ç”¨bounding box. å¦‚æœåœ¨å†…éƒ¨,è¿˜éœ€è¦åˆ¤æ–­å†…éƒ¨ç‚¹çš„æ·±åº¦.å¦‚æœå½“å‰ç‚¹æ›´é è¿‘ç›¸æœº,è®¾ç½®åƒç´ é¢œè‰²å¹¶æ›´æ–°depth buffer.</p><p><img data-src="https://s2.loli.net/2024/05/24/zsNxrbOg79kwHAy.png" alt="image-20240524213309445"></p><p><img data-src="https://s2.loli.net/2024/05/24/8nHkRoxrWDL7QTK.png" alt="image-20240524213330256"></p><p>é¦–å…ˆbounding boxæ¯”è¾ƒç®€å•,ç›´æ¥è·å¾—x,yçš„æœ€å°å€¼æœ€å¤§å€¼å³å¯ .</p><p>åˆ¤å®šç‚¹æ˜¯å¦åœ¨ä¸‰è§’å½¢å†…,åœ¨ä¸‰è§’å½¢å†…è¿˜éœ€è¦ä½¿ç”¨é‡å¿ƒæ’å€¼å¾—åˆ°z-buffering,è¿™é‡Œè¶Šå°è¡¨ç¤ºè¶Šè¿‘,å¦‚æœæ›´å°å°±è®¾ç½®é¢œè‰².</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> x = <span class="built_in">floor</span>(lb_x); x &lt; <span class="built_in">ceil</span>(rt_x); x++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> y = <span class="built_in">floor</span>(lb_y); y &lt; <span class="built_in">ceil</span>(rt_y); y++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">insideTriangle</span>(x+<span class="number">0.5</span>, y+<span class="number">0.5</span>, t.v)) &#123;</span><br><span class="line">                <span class="keyword">auto</span>[alpha, beta, gamma] = <span class="built_in">computeBarycentric2D</span>(x, y, t.v);</span><br><span class="line">                <span class="keyword">float</span> w_reciprocal = <span class="number">1.0</span>/(alpha / v[<span class="number">0</span>].<span class="built_in">w</span>() + beta / v[<span class="number">1</span>].<span class="built_in">w</span>() + gamma / v[<span class="number">2</span>].<span class="built_in">w</span>());</span><br><span class="line">                <span class="keyword">float</span> z_interpolated = alpha * v[<span class="number">0</span>].<span class="built_in">z</span>() / v[<span class="number">0</span>].<span class="built_in">w</span>() + beta * v[<span class="number">1</span>].<span class="built_in">z</span>() / v[<span class="number">1</span>].<span class="built_in">w</span>() + gamma * v[<span class="number">2</span>].<span class="built_in">z</span>() / v[<span class="number">2</span>].<span class="built_in">w</span>();</span><br><span class="line">                z_interpolated *= w_reciprocal;</span><br><span class="line">                <span class="keyword">int</span> index = <span class="built_in">get_index</span>(x, y);</span><br><span class="line">                <span class="keyword">if</span> (z_interpolated &lt; depth_buf[index]) &#123;</span><br><span class="line">                    depth_buf[index] = z_interpolated;</span><br><span class="line">                    <span class="built_in">set_pixel</span>(<span class="built_in">Vector3f</span>(x, y, <span class="number">1.0f</span>), t.<span class="built_in">getColor</span>());</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p><img data-src="https://s2.loli.net/2024/05/24/HT3ogl5RuJWtbLz.png" alt="image-20240524175457757"></p><p><img data-src="https://s2.loli.net/2024/05/24/xp6UaqQC7lscWmV.png" alt="image-20240524202223373" style="zoom:50%;" /></p><p>ä¸ºäº†è§£å†³é”¯é½¿é—®é¢˜(antialiasing),å¯ä»¥å…ˆè¿›è¡Œå·ç§¯,ä¹Ÿå¯ä»¥è¿›è¡Œsupersamping,è¿™é‡Œä½¿ç”¨super-samping,å¯¹æ¯ä¸ªåƒç´ è¿›è¡Œ2x2é‡‡æ ·.</p><p>æ–¹æ³•æ˜¯</p><ol><li>Take NxN samples in each pixel.</li><li>Average the NxN samples â€œinsideâ€ each pixel</li></ol><p>å…·ä½“åšçš„æ—¶å€™é’ˆå¯¹æ¯ä¸ªpixel,éœ€è¦ä¿å­˜ä¸¤ä¸ª sample listé‡Œé¢å­˜ç€å‘¨å›´å‡ ä¸ªå…ƒç´ çš„é¢œè‰²ä¸depth. ç„¶åç®—colorçš„å‡å€¼.</p><p>super-samplingæ—¶,ä¼šå¯¹ä¸€ä¸ªåƒç´ ç»“åˆå¤šä¸ªå¼ºåº¦(é¢œè‰²),ä¹Ÿå°±æ˜¯å‡å€¼.é‡‡æ ·çš„å€¼å¤ªå¤§å›¾åƒä¼šå˜ç³Š.</p><p><img data-src="https://s2.loli.net/2024/05/24/IXzWOyn49Y5JpVE.png" alt="image-20240524212850965"></p><h5 id="HW3"><a href="#HW3" class="headerlink" title="HW3"></a>HW3</h5><p>ä¹‹å‰æ¶‰åŠåˆ°äº†MVP,è§†å£è½¬æ¢ä»¥åŠRasterã€=-Z-buffer. ç°åœ¨åˆ°äº†shading</p><p>Shading:The process of applying a material to an object.The darkening or coloring of an illustration or  diagram with parallel lines or a block of color</p><p>è¿™é‡ŒShadingä»‹ç»äº†Blinn-Phongåå°„æ¨¡å‹,åŒ…æ‹¬æ¼«åå°„,é«˜å…‰åå°„å’Œç¯å¢ƒå…‰.</p><p><img data-src="https://s2.loli.net/2024/05/25/3ZsDz6MlRxehIfP.png" alt="image-20240525212040023"></p><p><img data-src="https://s2.loli.net/2024/05/24/elFT8BIydC3XLEw.png" alt="image-20240524220535971"></p><p><strong>æ¼«åå°„</strong></p><p><img data-src="https://s2.loli.net/2024/05/24/PIprAbJe1HD9SvE.png" alt="image-20240524215603681">ä¸çœ‹çš„æ–¹å‘æ— å…³,ä¸è·ç¦»å’Œå…¥å°„è§’åº¦æœ‰å…³. kdå¯¹æ¼«åå°„å½±å“å¦‚ä¸‹.</p><p><img data-src="https://s2.loli.net/2024/05/24/3fKa4mPENFXgz9o.png" alt="image-20240524221426912"></p><p><strong>é«˜å…‰åå°„</strong></p><p><img data-src="https://s2.loli.net/2024/05/24/LpxJqyRU2u7rd19.png" alt="image-20240524220408626"></p><p>ä¸çœ‹çš„è§’åº¦æœ‰å…³,è§’åº¦è·Ÿå…¥å°„è§’ç›¸ç­‰æ—¶æœ€å¤§.</p><p><img data-src="https://s2.loli.net/2024/05/24/oFExtZaYjLsqD7I.png" alt="image-20240524220506998"></p><p>åŠç¨‹å‘é‡å°±æ˜¯ä»¥lå’Œvå‘é‡ä¸ºè¾¹çš„ä¸­çº¿,è€Œpå«åšcosine power plots,è¶Šå¤§ç›¸åŒè§’åº¦ä¸‹è¶Šå°.</p><p>kså’Œpå¯¹é«˜å…‰åå°„å½±å“å¦‚ä¸‹</p><p><img data-src="https://s2.loli.net/2024/05/24/i47jFfRGB3t9Lx8.png" alt="image-20240524221457998"></p><p><strong>ç¯å¢ƒå…‰</strong></p><p><img data-src="https://s2.loli.net/2024/05/24/XnR9HyYvdjcSpox.png" alt="image-20240524221924122"></p><p>ä¸ä¾èµ–äºä»»ä½•ä¸œè¥¿,ç›¸å½“äºåŠ ç‚¹ç¯å¢ƒå™ªéŸ³</p><p>æ‰€ä»¥æœ€ååœ¨Blinn-Phongåå°„æ¨¡å‹ä¸­,ç€è‰²å¦‚ä¸‹</p><p><img data-src="https://s2.loli.net/2024/05/24/QhGcYsCd1ny8e3D.png" alt="image-20240524222152219"></p><p>æ­¤å¤–shadingè¿˜è·Ÿç€è‰²é¢‘ç‡æœ‰å…³,åˆ†ä¸ºä¸‰ç§ç±»å‹,åŒ…æ‹¬flat shading,gouraud shading,Phong shading</p><p><strong>flat shading</strong></p><ul><li>Triangle face is  flat â€” one normal  vector  </li><li>Not good for  smooth surfaces</li></ul><p>å¯¹äºæ¯ä¸ªä¸‰è§’å½¢åšshading,æ¯ä¸ªä¸‰è§’å½¢å°±ä¸€ä¸ªnormal vector</p><p><strong>gouraud shading</strong></p><ul><li>Interpolate colors  from vertices across  triangle </li><li>Each vertex has a  normal vector</li></ul><p>å¯¹äºæ¯ä¸ªvertexåš,æ¯ä¸ªvertexæå‡ºæ¥ä¸€ä¸ªnormal vector.</p><p><strong>Phong shading</strong></p><ul><li>Interpolate normal  vectors across each  triangle </li><li>Compute full shading  model at each pixel </li></ul><p>å¯¹äºæ¯ä¸ªpixelåš.</p><p><img data-src="https://s2.loli.net/2024/05/24/PpGrA8hL17vcmBF.png" alt="image-20240524230245562"></p><p><strong>é‡å¿ƒæ’å€¼</strong></p><p><img data-src="https://s2.loli.net/2024/05/24/SMDGjIbdVWiUFYa.png" alt="image-20240524230332105"></p><p><img data-src="https://s2.loli.net/2024/05/25/YLGaUhMpVnyrTSE.png" alt="image-20240525114414968"></p><p><img data-src="https://s2.loli.net/2024/05/25/39j5Q6aWqIZr87X.png" alt="image-20240525200857191"></p><p>é‡å¿ƒåæ ‡ç³»æ˜¯æŒ‡å¹³é¢ä¸Šä»»æ„ä¸€ç‚¹å¯ä»¥ç”¨ä¸‰è§’å½¢çš„ä¸‰ä¸ªé¡¶ç‚¹çš„åæ ‡çš„çº¿æ€§ç»„åˆè¡¨ç¤º,å…¶ä¸­ä¸‰ä¸ªç³»æ•°çš„å’Œä¸º1ã€‚</p><p><strong>Texture mapping</strong></p><p>apply textures = sampling</p><p><img data-src="https://s2.loli.net/2024/05/25/ZwzPhiv72LuEHJp.png" alt="image-20240525134129545"></p><p>åº”ç”¨textureçš„æ–¹æ³•,å¯¹äºæ¯ä¸ªscreençš„ç‚¹,å¾—åˆ°å¯¹åº”çš„texture coords(u,v)ç„¶åsampleå‡ºä¸€ä¸ªé¢œè‰²,è®¾ç½®è¿™ä¸ªé¢œè‰²ä¸ºç‚¹çš„é¢œè‰²,å¸¸ä½œä¸ºæ¼«åå°„çš„ç³»æ•°kd</p><p><img data-src="https://s2.loli.net/2024/05/25/D5L4jirsAwNCfI7.png" alt="image-20240525114612818"></p><p>æ¯ä¸ªvertex rasterizeä¹‹ååæ ‡ä¸è´´å›¾ä¸ŠæŸä¸ªåæ ‡å¯¹åº”</p><p><img data-src="https://s2.loli.net/2024/05/25/R8Uj61yvnXmoIbc.png" alt="image-20240525112721794"></p><p><img data-src="https://s2.loli.net/2024/05/25/ysCe1ApBbnlkqZR.png" alt="image-20240525112703661"></p><p><strong>Texture magnification</strong></p><blockquote><p>å½“çº¹ç†å›¾åƒçš„åˆ†è¾¨ç‡ä½äºæ˜¾ç¤ºå±ä¸Šéœ€è¦çš„åˆ†è¾¨ç‡æ—¶ï¼Œå°±ä¼šå‡ºç°çº¹ç†æ”¾å¤§çš„æƒ…å†µã€‚ä¾‹å¦‚ï¼Œå½“ä½ å°†ä¸€ä¸ªå°çº¹ç†è´´å›¾æ‹‰ä¼¸åˆ°ä¸€ä¸ªè¾ƒå¤§çš„è¡¨é¢ä¸Šæ—¶ï¼Œå°±ä¼šé‡åˆ°çº¹ç†æ”¾å¤§ã€‚è¿™ä¸ªè¿‡ç¨‹éœ€è¦å†³å®šå¦‚ä½•åœ¨çº¹ç†ä¸­æ’å€¼ä»¥ç”Ÿæˆæ›´å¤šçš„åƒç´ </p></blockquote><p>å¦‚æœtextureåˆ†è¾¨ç‡å¤ªå°çš„è§£å†³æ–¹æ³•.</p><p>æ”¾å¤§çº¹ç†æ—¶å¸¸ç”¨çš„æ’å€¼æ–¹æ³•æœ‰ï¼š</p><ol><li><strong>æœ€è¿‘é‚»æ’å€¼ï¼ˆNearest Neighbor Interpolationï¼‰</strong>ï¼šè¿™ç§æ–¹æ³•ç®€å•é«˜æ•ˆï¼Œä½†é€šå¸¸ä¼šäº§ç”Ÿé”¯é½¿çŠ¶çš„è¾¹ç¼˜ï¼Œå› ä¸ºå®ƒåªæ˜¯é€‰æ‹©æœ€æ¥è¿‘çš„çº¹ç†åƒç´ ã€‚</li><li><strong>åŒçº¿æ€§æ’å€¼ï¼ˆBilinear Interpolationï¼‰</strong>ï¼šè¿™ç§æ–¹æ³•é€šè¿‡å¯¹å‘¨å›´çš„å››ä¸ªçº¹ç†åƒç´ è¿›è¡ŒåŠ æƒå¹³å‡ï¼Œå¯ä»¥ç”Ÿæˆè¾ƒä¸ºå¹³æ»‘çš„ç»“æœã€‚</li><li><strong>ä¸‰çº¿æ€§æ’å€¼ï¼ˆTrilinear Interpolationï¼‰</strong>ï¼šåœ¨åŒçº¿æ€§æ’å€¼çš„åŸºç¡€ä¸Šï¼ŒåŠ å…¥äº†å¯¹ä¸åŒMIPè´´å›¾å±‚æ¬¡çš„çº¿æ€§æ’å€¼ï¼Œä»¥è¿›ä¸€æ­¥æé«˜è´¨é‡ã€‚</li></ol><p><img data-src="https://s2.loli.net/2024/05/25/OWIxDR7yqBC5uen.png" alt="image-20240525115208103"></p><p><img data-src="https://s2.loli.net/2024/05/25/YhmLPEoxGZjJ7wn.png" alt="image-20240525124210774"></p><p><img data-src="https://s2.loli.net/2024/05/25/Tm2kfgzHxyO1b5S.png" alt="image-20240525131324085"></p><p>å¦‚æœtextureå¤ªå¤§,éœ€è¦å°†å¤šä¸ªtexelå–å‡å€¼åˆ†ç»™ä¸€ä¸ªpixel.</p><p><img data-src="https://s2.loli.net/2024/05/25/XkthROUmr3TzDaq.png" alt="image-20240525141722341"></p><p><strong>Texture minification</strong></p><blockquote><p>çº¹ç†ç¼©å°å‘ç”Ÿåœ¨çº¹ç†å›¾åƒçš„åˆ†è¾¨ç‡é«˜äºæ˜¾ç¤ºå±ä¸Šéœ€è¦çš„åˆ†è¾¨ç‡æ—¶ã€‚ä¾‹å¦‚ï¼Œå½“ä½ å°†ä¸€ä¸ªå¤§çº¹ç†è´´å›¾ç¼©å°åˆ°ä¸€ä¸ªè¾ƒå°çš„è¡¨é¢ä¸Šæ—¶ï¼Œå°±ä¼šé‡åˆ°çº¹ç†ç¼©å°ã€‚è¿™ä¸ªè¿‡ç¨‹éœ€è¦å†³å®šå¦‚ä½•å¯¹çº¹ç†è¿›è¡Œé‡‡æ ·ï¼Œä»¥é¿å…æ··å æ•ˆåº”ï¼ˆaliasingï¼‰</p></blockquote><p>ç¼©å°çº¹ç†æ—¶å¸¸ç”¨çš„æ–¹æ³•æœ‰ï¼š</p><ol><li><strong>MIPè´´å›¾ï¼ˆMipmappingï¼‰</strong>ï¼šè¿™æ˜¯æœ€å¸¸ç”¨çš„æ–¹æ³•ï¼Œå®ƒé¢„å…ˆç”Ÿæˆä¸€ç³»åˆ—ç¼©å°åˆ†è¾¨ç‡çš„çº¹ç†å›¾åƒï¼ˆMIPå±‚ï¼‰ï¼Œåœ¨æ¸²æŸ“æ—¶æ ¹æ®éœ€è¦é€‰æ‹©åˆé€‚çš„å±‚è¿›è¡Œé‡‡æ ·ï¼Œä»¥å‡å°‘æ··å æ•ˆåº”ã€‚MIPè´´å›¾é€šå¸¸ä¸ä¸‰çº¿æ€§æ’å€¼ç»“åˆä½¿ç”¨ã€‚</li><li><strong>å„å‘å¼‚æ€§è¿‡æ»¤ï¼ˆAnisotropic Filteringï¼‰</strong>ï¼šåœ¨MIPè´´å›¾çš„åŸºç¡€ä¸Šï¼Œè¿™ç§æ–¹æ³•è¿›ä¸€æ­¥æé«˜äº†çº¹ç†åœ¨ä¸åŒè§’åº¦ä¸‹çš„æ¸…æ™°åº¦ï¼Œç‰¹åˆ«æ˜¯åœ¨è§†è§’è¾ƒå¤§æ—¶æ•ˆæœæ˜æ˜¾ã€‚</li></ol><p><strong>Mipmap</strong></p><p>mipmapæ˜¯ä¸€ç§å¤šçº§çº¹ç†æ˜ å°„æŠ€æœ¯.å®ƒé€šè¿‡é¢„å…ˆç”Ÿæˆå¹¶å­˜å‚¨ä¸€ç³»åˆ—é€æ¸é™ä½åˆ†è¾¨ç‡çš„çº¹ç†å›¾åƒæ¥å®ç°.æ¯ä¸ªé™ä½åˆ†è¾¨ç‡çš„çº¹ç†å›¾åƒç§°ä¸ºä¸€ä¸ªMIPå±‚</p><p><img data-src="https://s2.loli.net/2024/05/25/vVYOIxGN6bmPuow.png" alt="image-20240525145752235"></p><p><img data-src="https://s2.loli.net/2024/05/25/UIFbenyzPNkY782.png" alt="image-20240525152604833"></p><p>å°†å¾—åˆ°çš„Då››èˆäº”å…¥</p><p>åœ¨mipmapä¸Šå†è¿›è¡Œæ’å€¼,</p><p><img data-src="https://s2.loli.net/2024/05/25/M6kJeFrKCiPWYd9.png" alt="image-20240525152427773"></p><p>ä½œä¸šè¦æ±‚å®ç°normal_fragment_shader,åˆ©ç”¨äº†(æ³•å‘é‡+1)/2ä½œä¸ºé¢œè‰².è¿˜æœ‰Blinn-Phongåå°„æ¨¡å‹,ä»¥åŠçº¹ç†.</p><p><strong>normal_fragment_shader</strong>æ¯”è¾ƒç®€å•,ç›´æ¥ç©¿æ³•å‘é‡å³å¯.</p><p><strong>Blinn-Phongåå°„æ¨¡å‹</strong>æŒ‰ç…§å…¬å¼å†™å³å¯.</p><p>çº¹ç†æ¨¡å‹ä¸»è¦éœ€è¦ä½¿ç”¨å¯¹åº”uvä½ç½®çš„é¢œè‰²,å°†åŸæœ¬ä½¿ç”¨çš„é¢œè‰²æ›¿æ¢ç”¨æ¥ç®—diffuse light.</p><p>å®ç°çº¹ç†æ—¶å¯ä»¥è€ƒè™‘texture magnificationçš„åŒçº¿æ€§æ’å€¼,ä»¥åŠminificationçš„mipmap.</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Eigen::Vector3f <span class="title">getColorBilinear</span><span class="params">(<span class="keyword">float</span> u, <span class="keyword">float</span> v)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">auto</span> u_img = u * width;</span><br><span class="line">  <span class="keyword">auto</span> v_img = (<span class="number">1</span> - v) * height;</span><br><span class="line">  <span class="keyword">float</span> v11 = <span class="built_in">ceil</span>(v_img);</span><br><span class="line">  <span class="keyword">float</span> v01 = <span class="built_in">floor</span>(v_img);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">float</span> u01 = <span class="built_in">floor</span>(u_img);</span><br><span class="line">  <span class="keyword">float</span> u11 = <span class="built_in">ceil</span>(u_img);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">auto</span> rightBottomColor = image_data.at&lt;cv::Vec3b&gt;(v01, u11);</span><br><span class="line">  <span class="keyword">auto</span> leftBottomColor = image_data.at&lt;cv::Vec3b&gt;(v01, u01);</span><br><span class="line">  <span class="keyword">auto</span> rightTopColor = image_data.at&lt;cv::Vec3b&gt;(v11, u11);</span><br><span class="line">  <span class="keyword">auto</span> leftTopColor = image_data.at&lt;cv::Vec3b&gt;(v11, u01);</span><br><span class="line">  <span class="keyword">float</span> s = (u_img - u01) / (u11 - u01);</span><br><span class="line">  <span class="keyword">float</span> t = (v_img - v01) / (v11 - v01);</span><br><span class="line">  <span class="keyword">auto</span> topColor = leftTopColor + s * (rightTopColor - leftTopColor);</span><br><span class="line">  <span class="keyword">auto</span> bottomColor =</span><br><span class="line">      leftBottomColor + s * (rightBottomColor - leftBottomColor);</span><br><span class="line">  <span class="keyword">auto</span> final_color = bottomColor + t * (topColor - bottomColor);</span><br><span class="line">  <span class="keyword">return</span> Eigen::<span class="built_in">Vector3f</span>(final_color[<span class="number">0</span>], final_color[<span class="number">1</span>], final_color[<span class="number">2</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿›é˜¶æ–¹æ³•åŒ…æ‹¬Bump mapping,æœ‰äº†å‡¹å‡¸æ•ˆæœ,è¿˜æœ‰displacement mapping.</p><p><img data-src="https://s2.loli.net/2024/05/26/hAqye8oJLWr2RI3.png" alt="image-20240526161155111"></p><p>Bump mappingç®—æ³•</p><h5 id="HW4"><a href="#HW4" class="headerlink" title="HW4"></a><img data-src="https://s2.loli.net/2024/05/26/GEkQeCXYNxbMqJ7.png" alt="image-20240526164218979">HW4</h5><p>Geometry è¡¨ç¤ºå‡ ä½•å½¢çŠ¶çš„å‡ ç§æ–¹æ³•,åŒ…æ‹¬æ˜¾ç¤ºå’Œéšå¼.</p><p><img data-src="https://s2.loli.net/2024/05/26/sYHdUhBcTq5tw17.png" alt="image-20240526193619807"></p><p>éšå¼æè¿°ä¼˜ç‚¹:</p><ul><li>æè¿°ç®€æ´ï¼ˆå¦‚å‡½æ•°ï¼‰ </li><li>ä¾¿äºæŸäº›æŸ¥è¯¢ï¼ˆç‰©ä½“å†…éƒ¨ã€ä¸è¡¨é¢çš„è·ç¦»ï¼‰ </li><li>é€‚ç”¨äºå°„çº¿ä¸æ›²é¢çš„äº¤å‰ï¼ˆç¨åè¯¦è¿°ï¼‰ </li><li>å¯¹äºç®€å•å½¢çŠ¶ï¼Œå¯ç²¾ç¡®æè¿°/æ— é‡‡æ ·è¯¯å·® </li><li>æ˜“äºå¤„ç†æ‹“æ‰‘ç»“æ„çš„å˜åŒ–ï¼ˆå¦‚æµä½“</li></ul><p>ç¼ºç‚¹</p><ul><li>éš¾ä»¥æ¨¡æ‹Ÿå¤æ‚å½¢çŠ¶</li></ul><p>æ˜¾ç¤ºæ¨¡å‹åŒ…æ‹¬ç‚¹äº‘,å¤šè¾¹å½¢ç½‘æ ¼(polygon mesh),</p><p>ç‚¹äº‘</p><ul><li>æœ€ç®€å•çš„è¡¨ç¤ºæ–¹æ³•ï¼šç‚¹åˆ—è¡¨ï¼ˆx,y,zï¼‰ </li><li>å¯è½»æ¾è¡¨ç¤ºä»»ä½•å‡ ä½•å›¾å½¢ </li><li>é€‚ç”¨äºå¤§å‹æ•°æ®é›†ï¼ˆ&gt;&gt;1 ç‚¹/åƒç´ ï¼‰ </li><li>é€šå¸¸è½¬æ¢ä¸ºå¤šè¾¹å½¢ç½‘æ ¼ </li><li>éš¾ä»¥ç»˜åˆ¶é‡‡æ ·ä¸è¶³çš„åŒºåŸŸ</li></ul><p>å¤šè¾¹å½¢ç½‘æ ¼</p><ul><li>å­˜å‚¨é¡¶ç‚¹å’Œå¤šè¾¹å½¢ï¼ˆé€šå¸¸ä¸ºä¸‰è§’å½¢æˆ–å››è¾¹å½¢ï¼‰ </li><li>æ›´æ˜“äºå¤„ç†/æ¨¡æ‹Ÿã€è‡ªé€‚åº”é‡‡æ · </li><li>æ•°æ®ç»“æ„æ›´å¤æ‚ </li><li>å¯èƒ½æ˜¯å›¾å½¢ä¸­æœ€å¸¸è§çš„è¡¨ç¤ºæ³•</li></ul><p><strong>æ›²çº¿</strong></p><p>BÃ©zier Curves</p><p><img data-src="https://s2.loli.net/2024/05/26/rhK4ZOqMtGzNu2X.png" alt="image-20240526213851885" style="zoom:67%;" /></p><p>è¿˜æœ‰cubicè´å¡å°”æ›²çº¿,å…¶å®å°±æ˜¯orderæ›´é«˜.</p><p>è¿™äº›æ›²çº¿éƒ½å¯ä»¥å½’ç»“ä¸ºå¤šé¡¹å¼.de Casteljauç®—æ³•</p><p><img data-src="https://s2.loli.net/2024/05/26/O8xQhoubFZafzD9.png" alt="image-20240526220606516" style="zoom:50%;" /></p><p><img data-src="https://s2.loli.net/2024/05/26/t6yMUePEfpdZ25w.png" alt="image-20240526221101195"></p><p><img data-src="https://s2.loli.net/2024/05/28/FdiBq6fVnyUm7wg.png" alt="image-20240528205956947"></p><p>è´å¡å°”æ›²çº¿ç‰¹ç‚¹</p><p>å†…æ’ç«¯ç‚¹<br>ä¸ç«¯ç‚¹ç›¸åˆ‡<br>ä»¿å°„å˜æ¢ç‰¹æ€§ </p><ul><li>é€šè¿‡å˜æ¢æ§åˆ¶ç‚¹æ¥å˜æ¢æ›²çº¿<br>convex hull property </li><li>æ›²çº¿ä½äºæ§åˆ¶ç‚¹çš„å‡¸è¾¹å†…</li></ul><p>åˆ©ç”¨Piecewise BÃ©zier Curves,å°†è¿ç»­çš„ä½é˜¶è´å¡å°”æ›²çº¿è¿åœ¨ä¸€èµ·.</p><p>æ›²çº¿é™¤äº†è´å¡å°”æ›²çº¿,è¿˜æœ‰splineså’ŒB-splines.</p><p><strong>BÃ©zier Surfaces</strong></p><p><img data-src="https://s2.loli.net/2024/05/26/bISzRwqsTp3BhAj.png" alt="image-20240526225234591" style="zoom:50%;" /></p><p><img data-src="https://s2.loli.net/2024/05/26/93tqJlgfBMupFIC.png" alt="image-20240526230516215"></p><p><strong>Mesh</strong></p><p>å¯¹meshçš„æ“ä½œåŒ…æ‹¬subdivision,simplificationä»¥åŠregularization.</p><p>subdivisionå°±æ˜¯å°†ä¸‰è§’å½¢splitç„¶åæ ¹æ®ä¸€äº›æƒé‡é‡æ–°åˆ†é…ä¸‰è§’å½¢ä½ç½®.</p><p>æ­¤å¤–è¿˜æœ‰catmull-clark subdivison.</p><p>simplification</p><p><img data-src="https://s2.loli.net/2024/05/26/HvDeG2loYQ6E4Kf.png" alt="image-20240526231621354"></p><p>shadow mapping</p><p>ä¸åœ¨é˜´å½±ä¸­çš„ç‚¹å¿…é¡»åŒæ—¶è¢«ç¯å…‰å’Œæ‘„åƒæœºçœ‹åˆ°</p><p>ä½œä¸šå°±æ˜¯ç”»è´å¡å°”æ›²çº¿å¹¶åèµ°æ ·.é€šè¿‡[0,1]çš„tå€¼ç¡®å®šæ›²çº¿ç‚¹ã€‚naiveçš„æ–¹æ³•å°±æ˜¯ä½¿ç”¨å¤šé¡¹å¼ç›´æ¥ç®—,æ›´å¥½çš„æ–¹æ³•æ˜¯,æ ¹æ®å››ä¸ªç‚¹åå¤çš„æ’å€¼å¾—åˆ°æ›²çº¿ç‚¹. åèµ°æ ·å°±æ˜¯antialiasing,å°†æ›²çº¿ç‚¹çš„é™„è¿‘ç‚¹çš„å€¼èµ‹å€¼,å¯ä»¥æ ¹æ®è·ç¦».</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">cv::Point2f <span class="title">recursive_bezier</span><span class="params">(<span class="keyword">const</span> std::vector&lt;cv::Point2f&gt; &amp;control_points,</span></span></span><br><span class="line"><span class="params"><span class="function">                             <span class="keyword">float</span> t)</span> </span>&#123;</span><br><span class="line">  <span class="comment">// <span class="doctag">TODO:</span> Implement de Casteljau&#x27;s algorithm</span></span><br><span class="line">  <span class="comment">// é¦–å…ˆï¼Œå°†ç›¸é‚»çš„ç‚¹è¿æ¥èµ·æ¥ä»¥å½¢æˆçº¿æ®µ</span></span><br><span class="line">  <span class="keyword">if</span> (control_points.<span class="built_in">size</span>() == <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> control_points[<span class="number">0</span>];</span><br><span class="line">  &#125;</span><br><span class="line">  std::vector&lt;cv::Point2f&gt; points;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; control_points.<span class="built_in">size</span>() - <span class="number">1</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">auto</span> point = t * control_points[i] + (<span class="number">1</span> - t) * control_points[i + <span class="number">1</span>];</span><br><span class="line">    points.<span class="built_in">push_back</span>(point);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">recursive_bezier</span>(points, t);</span><br><span class="line">  <span class="comment">//  ç”¨ t : (1 âˆ’ t) çš„æ¯”ä¾‹ç»†åˆ†æ¯ä¸ªçº¿æ®µï¼Œå¹¶æ‰¾åˆ°è¯¥åˆ†å‰²ç‚¹</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// å¾—åˆ°çš„åˆ†å‰²ç‚¹ä½œä¸ºæ–°çš„æ§åˆ¶ç‚¹åºåˆ—ï¼Œæ–°åºåˆ—çš„é•¿åº¦ä¼šå‡å°‘ä¸€ã€‚</span></span><br><span class="line">  <span class="comment">// å¦‚æœåºåˆ—åªåŒ…å«ä¸€ä¸ªç‚¹ï¼Œåˆ™è¿”å›è¯¥ç‚¹å¹¶ç»ˆæ­¢ã€‚å¦åˆ™ï¼Œä½¿ç”¨æ–°çš„æ§åˆ¶ç‚¹åºåˆ—å¹¶</span></span><br><span class="line">  <span class="comment">// è½¬åˆ°æ­¥éª¤ 1ã€‚</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">bezier</span><span class="params">(<span class="keyword">const</span> std::vector&lt;cv::Point2f&gt; &amp;control_points, cv::Mat &amp;window)</span> </span>&#123;</span><br><span class="line">  <span class="comment">// <span class="doctag">TODO:</span> Iterate through all t = 0 to t = 1 with small steps, and call de</span></span><br><span class="line">  <span class="comment">// Casteljau&#x27;s recursive Bezier algorithm.</span></span><br><span class="line">  <span class="keyword">float</span> max_dist = <span class="number">1.5f</span> * <span class="built_in">sqrt</span>(<span class="number">2</span>);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">float</span> t = <span class="number">0</span>; t &lt;= <span class="number">1.0f</span>; t += <span class="number">0.001</span>) &#123;</span><br><span class="line">    <span class="keyword">auto</span> point = <span class="built_in">recursive_bezier</span>(control_points, t);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="built_in">round</span>(point.x) - <span class="number">1</span>; i &lt; <span class="built_in">round</span>(point.x) + <span class="number">2</span>; i++) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="built_in">round</span>(point.y) - <span class="number">1</span>; j &lt; <span class="built_in">round</span>(point.y) + <span class="number">2</span>; j++) &#123;</span><br><span class="line">        <span class="keyword">auto</span> samplePoint = cv::<span class="built_in">Point2f</span>(i, j);</span><br><span class="line">        <span class="keyword">float</span> d = cv::<span class="built_in">norm</span>(samplePoint - point);</span><br><span class="line">        <span class="keyword">float</span> color = <span class="number">255.0f</span> * (<span class="number">1</span> - d / max_dist);</span><br><span class="line">        window.at&lt;cv::Vec3b&gt;(samplePoint.y, samplePoint.x)[<span class="number">2</span>] =</span><br><span class="line">            std::<span class="built_in">max</span>(window.at&lt;cv::Vec3b&gt;(samplePoint.y, samplePoint.x)[<span class="number">2</span>],</span><br><span class="line">                     (uchar)color);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// window.at&lt;cv::Vec3b&gt;(point.y, point.x)[1] = 255;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="HW5"><a href="#HW5" class="headerlink" title="HW5"></a>HW5</h5><p>èµ°è¿‡äº†Rasterizationå’ŒGeometry,ç»ˆäºåˆ°äº†ä¹Ÿä»¤äººæ¿€åŠ¨çš„Ray tracing.</p><p>åœ¨è®¡ç®—æœºå›¾å½¢å­¦æ¸²æŸ“ä¸­,æˆ‘ä»¬é€šå¸¸ä¼šæ¨¡æ‹ŸLight Raysçš„ä¼ æ’­è¿‡ç¨‹,ä»¥è®¡ç®—å…‰ç…§æ•ˆæœã€‚ä¸»è¦æ–¹æ³•åŒ…æ‹¬:</p><ol><li>å…‰çº¿è¿½è¸ª(Ray Tracing): ä»è§‚å¯Ÿè€…è§†è§’å‘å°„å…‰çº¿,æ¨¡æ‹Ÿå…¶åœ¨åœºæ™¯ä¸­çš„ä¼ æ’­è¿‡ç¨‹ã€‚</li><li>å…‰æ …åŒ–(Rasterization): ç›´æ¥è®¡ç®—æ¯ä¸ªåƒç´ çš„é¢œè‰²,ä¸è¿½è¸ªå…‰çº¿çš„å…·ä½“ä¼ æ’­è¿‡ç¨‹ã€‚</li><li>è¾å°„åº¦å‡½æ•°(Radiance Function): åˆ©ç”¨æ•°å­¦æ¨¡å‹æè¿°Light Raysåœ¨ç©ºé—´ä¸­çš„ä¼ æ’­ç‰¹æ€§ã€‚</li></ol><p>å…‰æ …åŒ–çš„ç¼ºç‚¹:ä¸èƒ½å¤„ç†å…¨å±€çš„æ•ˆæœ,å…‰åå°„ä¼šè¶…è¿‡ä¸€æ¬¡.</p><p>Ray tracing is accurate, but is very slow</p><p>Ray-Tracingçš„ç®—æ³•</p><p><strong>Light Rays</strong></p><p>Light Raysçš„ä¸»è¦ç‰¹ç‚¹å¦‚ä¸‹:</p><ol><li>ä¼ æ’­æ–¹å‘: Light Raysæ²¿ç›´çº¿ä¼ æ’­,éµå¾ªå…‰çº¿ä¼ æ’­çš„ç›´çº¿æ€§è´¨ã€‚</li><li>å¼ºåº¦è¡°å‡: Light Raysçš„å¼ºåº¦éšç€ä¼ æ’­è·ç¦»çš„å¢åŠ è€Œè¡°å‡,éµå¾ªé€†å¹³æ–¹å®šå¾‹ã€‚</li><li>åå°„å’ŒæŠ˜å°„: å½“Light Raysé‡åˆ°ç‰©ä½“è¡¨é¢æ—¶,å¯èƒ½ä¼šå‘ç”Ÿåå°„æˆ–æŠ˜å°„,éµå¾ªå…‰å­¦å®šå¾‹ã€‚</li></ol><p><img data-src="https://s2.loli.net/2024/05/28/DRq8BcZVJI9OeaM.png" alt="image-20240528211704213"></p><p><strong>Ray Casting</strong></p><p><img data-src="https://s2.loli.net/2024/05/28/SjqaQ59pxYfIH2E.png" alt="image-20240528212212368"></p><p><img data-src="https://s2.loli.net/2024/05/28/IZsbODHYcXngwt6.png" alt="image-20240528212339608"></p><p>Shadow Raysæ˜¯å…‰çº¿è¿½è¸ªç®—æ³•ä¸­ä¸€ä¸ªéå¸¸é‡è¦çš„æŠ€æœ¯,å®ƒç”¨äºè®¡ç®—ç‰©ä½“åœ¨ä¸‰ç»´åœºæ™¯ä¸­æŠ•å°„å‡ºçš„é˜´å½±.</p><p><img data-src="https://s2.loli.net/2024/05/28/EI7yp4GToHrVsXb.png" alt="image-20240528213753449"></p><p>åœ¨å…‰çº¿è¿½è¸ªæ¸²æŸ“è¿‡ç¨‹ä¸­,<strong>å½“ä¸€æ¡å…‰çº¿ä¸åœºæ™¯ä¸­çš„ç‰©ä½“å‘ç”Ÿç›¸äº¤æ—¶,é€šå¸¸éœ€è¦åˆ¤æ–­è¯¥ç‚¹æ˜¯å¦ä½äºé˜´å½±ä¸­ã€‚ä¸ºæ­¤,æˆ‘ä»¬ä¼šå‘å°„ä¸€æ¡ä»äº¤ç‚¹å‡ºå‘æŒ‡å‘å…‰æºçš„shadow ray.</strong></p><p>å¦‚æœè¿™æ¡shadow rayåœ¨åˆ°è¾¾å…‰æºä¹‹å‰ä¸ä»»ä½•å…¶ä»–ç‰©ä½“ç›¸äº¤,é‚£ä¹ˆè¯¥äº¤ç‚¹å°±ä½äºé˜´å½±ä¸­.</p><p><strong>Ray-Surface Intersection</strong></p><p>Ray is defined by its origin and a direction vector</p><p><img data-src="https://s2.loli.net/2024/05/28/bZOxpmvrok3MQeV.png" alt="image-20240528213710912" style="zoom:67%;" /></p><p><img data-src="https://s2.loli.net/2024/05/28/jltgudeDTN9mQzs.png" alt="image-20240528213858434"></p><p><img data-src="https://s2.loli.net/2024/05/28/mR8edIxybTEYkBU.png" alt="image-20240528214148744"></p><p>ä¸éšå¼è¡¨ç¤ºçš„surfaceç›¸äº¤çš„rayè®¡ç®—.</p><p><img data-src="https://s2.loli.net/2024/05/28/qL38YXn9dE1WiUK.png" alt="image-20240528214431784"></p><p>ä¸ä¸‰è§’å½¢meshäº¤å‰</p><p><img data-src="https://s2.loli.net/2024/05/28/o51pJvBfFK9zDeZ.png" alt="image-20240528214803254"></p><p>ç®€å•çš„æƒ³æ³•æ˜¯è®©rayä¸æ¯ä¸€ä¸ªtriangleäº¤å‰,ray-planeäº¤å‰,çœ‹ç‚¹æ˜¯å¦åœ¨ä¸‰è§’å½¢å†…éƒ¨.</p><p>å¹³é¢ç”±æ³•å‘é‡å’Œé¢ä¸Šçš„ä¸€ä¸ªç‚¹å®šä¹‰.</p><p><img data-src="https://s2.loli.net/2024/05/28/EAhgOXmBbc2l5yW.png" alt="image-20240528215109831"></p><p><img data-src="https://s2.loli.net/2024/05/28/e1MHiZQhqJW4jow.png" alt="image-20240528215650898"></p><p><strong>MÃ¶ller Trumbore Algorithm</strong></p><p><img data-src="https://s2.loli.net/2024/05/28/yGVeQkYPOg3j6zs.png" alt="image-20240528220838253"></p><p><strong>Bounding Volumes</strong></p><p>ä½¿ç”¨è¿™ä¸œè¥¿æ¥çœ‹æœ‰æ²¡æœ‰ç›¸äº¤.</p><p><strong>box is the intersection of 3 pairs of slabs</strong></p><p><img data-src="https://s2.loli.net/2024/05/28/Rgu7eK4kMxSHI2L.png" alt="image-20240528222129198"></p><p>è¿™æ ·åšçš„å¥½å¤„</p><p>ç®€å•çš„å…‰çº¿-åœºæ™¯äº¤ç‚¹æ±‚è§£</p><ul><li>ç©·å°½åœ°æµ‹è¯•æ¯ä¸ªä¸‰è§’å½¢ä¸å…‰çº¿çš„äº¤ç‚¹</li><li>æ‰¾åˆ°æœ€è¿‘çš„äº¤ç‚¹(å³æœ€å°çš„tå€¼)</li></ul><p>é—®é¢˜:</p><ul><li>æœ´ç´ ç®—æ³• = #åƒç´  â¨‰ # ä¸‰è§’å½¢ (â¨‰ #åå°„æ¬¡æ•°)</li><li>éå¸¸æ…¢!</li></ul><p>å¿«é€Ÿé¿å…äº¤ç‚¹çš„æ–¹æ³•:<strong>ç”¨ç®€å•çš„ä½“ç§¯åŒ…å›´å¤æ‚ç‰©ä½“</strong></p><ul><li>ç‰©ä½“å®Œå…¨åŒ…å«åœ¨è¯¥ä½“ç§¯ä¸­</li><li>å¦‚æœå…‰çº¿æ²¡æœ‰å‡»ä¸­è¯¥ä½“ç§¯,å°±ä¸ä¼šå‡»ä¸­è¯¥ç‰©ä½“</li><li>æ‰€ä»¥å…ˆæµ‹è¯•åŒ…å›´ä½“ç§¯,å¦‚æœå‡»ä¸­äº†,å†æµ‹è¯•ç‰©ä½“æœ¬èº«</li></ul><p><img data-src="https://s2.loli.net/2024/05/28/L235usfSm9aliGZ.png" alt="image-20240528230330356"></p><p>Renderçš„æ–¹æ³•,å…¶å®å°±æ˜¯åæ ‡ç³»çš„ä¸€ä¸ªå˜æ¢ä»¥åŠcastRayç®—åå°„ä»¥åŠé˜´å½±ç­‰.</p><p>è®¡ç®—Renderçš„è¿‡ç¨‹:</p><ol><li>é¦–å…ˆéœ€è¦ä½¿ç”¨å¸§çš„å°ºå¯¸æ¥å¯¹åƒç´ ä½ç½®è¿›è¡Œå½’ä¸€åŒ–ã€‚</li><li>å½’ä¸€åŒ–åçš„åƒç´ åæ ‡è¢«ç§°ä¸ºNDCç©ºé—´(Normalized Device Coordinates)ã€‚</li><li>åœ¨å°†åƒç´ åæ ‡è½¬æ¢åˆ°NDCç©ºé—´æ—¶,æˆ‘ä»¬éœ€è¦åœ¨åŸå§‹åæ ‡ä¸ŠåŠ ä¸Š0.5çš„åç§»é‡ã€‚è¿™æ˜¯ä¸ºäº†ç¡®ä¿æœ€ç»ˆçš„ç›¸æœºå…‰çº¿ç©¿è¿‡åƒç´ çš„ä¸­å¿ƒã€‚</li><li>NDCç©ºé—´ä¸­çš„åƒç´ åæ ‡èŒƒå›´æ˜¯[0, 1]ã€‚è¿™ä¸å…‰æ …åŒ–é¢†åŸŸä¸­NDCç©ºé—´çš„èŒƒå›´[-1, 1]ä¸åŒã€‚</li><li>ç”±äºæˆåƒå¹³é¢æ˜¯ä»¥ä¸–ç•Œåæ ‡ç³»çš„åŸç‚¹ä¸ºä¸­å¿ƒçš„,å› æ­¤æˆ‘ä»¬éœ€è¦è¿›ä¸€æ­¥å°†[0, 1]èŒƒå›´çš„NDCåæ ‡æ˜ å°„åˆ°[-1, 1]çš„èŒƒå›´å†…ã€‚è¿™æ ·åšå¯ä»¥ç¡®ä¿å·¦ä¾§åƒç´ æœ‰è´Ÿçš„xåæ ‡,å³ä¾§åƒç´ æœ‰æ­£çš„xåæ ‡,ä¸Šé¢çš„åƒç´ æœ‰æ­£çš„yåæ ‡,ä¸‹é¢çš„åƒç´ æœ‰è´Ÿçš„yåæ ‡ã€‚</li><li>å½“å›¾åƒçš„é•¿å®½æ¯”ä¸æ˜¯1:1æ—¶,æˆ‘ä»¬éœ€è¦è€ƒè™‘å›¾åƒçš„å®½é«˜æ¯”ã€‚</li><li>å¯¹äºä¸€ä¸ª7x5åƒç´ çš„å›¾åƒ,å®½é«˜æ¯”æ˜¯1.4ã€‚</li><li>åœ¨å±å¹•ç©ºé—´(NDCç©ºé—´)ä¸­,åƒç´ åæ ‡èŒƒå›´ä»ç„¶æ˜¯[-1, 1]ã€‚ä½†ç”±äºæ¨ªå‘æœ‰æ›´å¤šåƒç´ ,æ‰€ä»¥åƒç´ ä¼šè¢«æ‹‰ä¼¸å˜å½¢ã€‚</li><li>ä¸ºäº†è®©åƒç´ ä¿æŒæ­£æ–¹å½¢,æˆ‘ä»¬éœ€è¦å°†xåæ ‡ä¹˜ä»¥å›¾åƒçš„å®½é«˜æ¯”1.4ã€‚è¿™æ ·å¯ä»¥å°†xåæ ‡èŒƒå›´æ‹‰ä¼¸åˆ°[-1.4, 1.4]ã€‚</li><li>è¿™ä¸ªæ“ä½œä¸ä¼šå½±å“yåæ ‡,å®ƒä»ç„¶åœ¨[-1, 1]èŒƒå›´å†…ã€‚</li></ol><p>rayTriangleIntersectåˆ¤æ–­æ˜¯å¦ç›¸äº¤ä»¥åŠæ˜¯å¦åœ¨ä¸‰è§’å½¢å†…éƒ¨,å…¬å¼å¦‚ä¸‹:</p><p><img data-src="https://s2.loli.net/2024/05/31/elBK7zRus5wXCE4.png" alt="image-20240531232626151"></p><h5 id="HW6"><a href="#HW6" class="headerlink" title="HW6"></a>HW6</h5><p>ä¸»è¦æ˜¯ä¸ºäº†åŠ é€Ÿray-tracingçš„rayTriangle intersection. è¿›è¡Œåˆ†å‰².</p><p>åŒ…æ‹¬uniform gridå’Œspatial partitions,å‰è€…å°±æ˜¯å‡åŒ€åˆ†å—,åè€…åŒ…æ‹¬Oct-Tree,KD-Tree,BSP-Treeå¤šç§,è¿˜æœ‰Bounding Volume Hierarchyçš„æ–¹æ³•.</p><p><img data-src="https://s2.loli.net/2024/06/01/PYjBZp936Kq2QVl.png" alt="image-20240601202540887"></p><p><img data-src="https://s2.loli.net/2024/06/01/8D2tV9AEnzIh3mH.png" alt="image-20240601174238696"></p><p><img data-src="https://s2.loli.net/2024/06/01/WCjEBS4LIXgKYhk.png" alt="image-20240601174248719"></p><p><img data-src="https://s2.loli.net/2024/06/01/nDaNxQ2GTb3iUfW.png" alt="image-20240601174312126"></p><p><img data-src="https://s2.loli.net/2024/06/01/ZCQs6uEma59rGJx.png" alt="image-20240601174320918"></p><p><img data-src="https://s2.loli.net/2024/06/01/cBWnDoLRqmEM1rs.png" alt="image-20240601174336245"></p><p>ç¡®å®šrayæ˜¯å¦ä¸AABBç›¸äº¤</p><p><img data-src="https://s2.loli.net/2024/06/01/F6riHxW9OvYPB52.png" alt="image-20240601224405331" style="zoom:50%;" /></p><p>å†ç¡®å®šrayæ˜¯å¦ä¸ä¸‰è§’å½¢ç›¸äº¤,ä¸ä¸Šä¸€æ¬¡ä½œä¸šç±»ä¼¼.åœ¨åˆ¤æ–­,åˆ¤æ–­æ˜¯å¦ä¸boxç›¸äº¤,ä¸ç›¸äº¤åˆ™æ²¡æœ‰äº¤ç‚¹,å¦‚æœç›¸äº¤,çœ‹æ˜¯å¦æ˜¯å¶å­èŠ‚ç‚¹,å¦‚æœæ˜¯å¶å­èŠ‚ç‚¹,çœ‹æ˜¯å¦ä¸å…¶ä¸­çš„objectç›¸äº¤,å¦‚æœä¸æ˜¯åœ¨åˆ†åˆ«åˆ¤æ–­.</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Intersection <span class="title">BVHAccel::getIntersection</span><span class="params">(BVHBuildNode* node,</span></span></span><br><span class="line"><span class="params"><span class="function">                                       <span class="keyword">const</span> Ray&amp; ray)</span> <span class="keyword">const</span> </span>&#123;</span><br><span class="line">  <span class="comment">// TODO Traverse the BVH to find intersection</span></span><br><span class="line">  Intersection isect;</span><br><span class="line">  <span class="keyword">if</span> (!node || !node-&gt;bounds.<span class="built_in">IntersectP</span>(ray, ray.direction_inv, &#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>&#125;)) &#123;</span><br><span class="line">    <span class="keyword">return</span> isect;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (node-&gt;left == <span class="literal">nullptr</span> &amp;&amp; node-&gt;right == <span class="literal">nullptr</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> node-&gt;object-&gt;<span class="built_in">getIntersection</span>(ray);</span><br><span class="line">  &#125;</span><br><span class="line">  Intersection left = <span class="built_in">getIntersection</span>(node-&gt;left, ray);</span><br><span class="line">  Intersection right = <span class="built_in">getIntersection</span>(node-&gt;right, ray);</span><br><span class="line">  <span class="keyword">if</span> (left.distance &lt; right.distance) &#123;</span><br><span class="line">    <span class="keyword">return</span> left;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> right;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> isect;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>BVHçš„æ„é€ å¦‚ä¸‹</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">BVHAccel::<span class="built_in">BVHAccel</span>(std::vector&lt;Object*&gt; p, <span class="keyword">int</span> maxPrimsInNode,</span><br><span class="line">                   SplitMethod splitMethod)</span><br><span class="line">    : <span class="built_in">maxPrimsInNode</span>(std::<span class="built_in">min</span>(<span class="number">255</span>, maxPrimsInNode)),</span><br><span class="line">      <span class="built_in">splitMethod</span>(splitMethod),</span><br><span class="line">      <span class="built_in">primitives</span>(std::<span class="built_in">move</span>(p)) &#123;</span><br><span class="line">  <span class="keyword">time_t</span> start, stop;</span><br><span class="line">  <span class="built_in">time</span>(&amp;start);</span><br><span class="line">  <span class="keyword">if</span> (primitives.<span class="built_in">empty</span>()) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">  root = <span class="built_in">recursiveBuild</span>(primitives);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">time</span>(&amp;stop);</span><br><span class="line">  <span class="keyword">double</span> diff = <span class="built_in">difftime</span>(stop, start);</span><br><span class="line">  <span class="keyword">int</span> hrs = (<span class="keyword">int</span>)diff / <span class="number">3600</span>;</span><br><span class="line">  <span class="keyword">int</span> mins = ((<span class="keyword">int</span>)diff / <span class="number">60</span>) - (hrs * <span class="number">60</span>);</span><br><span class="line">  <span class="keyword">int</span> secs = (<span class="keyword">int</span>)diff - (hrs * <span class="number">3600</span>) - (mins * <span class="number">60</span>);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">printf</span>(</span><br><span class="line">      <span class="string">&quot;\rBVH Generation complete: \nTime Taken: %i hrs, %i mins, %i secs\n\n&quot;</span>,</span><br><span class="line">      hrs, mins, secs);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">BVHBuildNode* <span class="title">BVHAccel::recursiveBuild</span><span class="params">(std::vector&lt;Object*&gt; objects)</span> </span>&#123;</span><br><span class="line">  BVHBuildNode* node = <span class="keyword">new</span> <span class="built_in">BVHBuildNode</span>();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Compute bounds of all primitives in BVH node</span></span><br><span class="line">  Bounds3 bounds;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; objects.<span class="built_in">size</span>(); ++i)</span><br><span class="line">    bounds = <span class="built_in">Union</span>(bounds, objects[i]-&gt;<span class="built_in">getBounds</span>());</span><br><span class="line">  <span class="keyword">if</span> (objects.<span class="built_in">size</span>() == <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="comment">// Create leaf _BVHBuildNode_</span></span><br><span class="line">    node-&gt;bounds = objects[<span class="number">0</span>]-&gt;<span class="built_in">getBounds</span>();</span><br><span class="line">    node-&gt;object = objects[<span class="number">0</span>];</span><br><span class="line">    node-&gt;left = <span class="literal">nullptr</span>;</span><br><span class="line">    node-&gt;right = <span class="literal">nullptr</span>;</span><br><span class="line">    <span class="keyword">return</span> node;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (objects.<span class="built_in">size</span>() == <span class="number">2</span>) &#123;</span><br><span class="line">    node-&gt;left = <span class="built_in">recursiveBuild</span>(std::vector&#123;objects[<span class="number">0</span>]&#125;);</span><br><span class="line">    node-&gt;right = <span class="built_in">recursiveBuild</span>(std::vector&#123;objects[<span class="number">1</span>]&#125;);</span><br><span class="line"></span><br><span class="line">    node-&gt;bounds = <span class="built_in">Union</span>(node-&gt;left-&gt;bounds, node-&gt;right-&gt;bounds);</span><br><span class="line">    <span class="keyword">return</span> node;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    Bounds3 centroidBounds;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; objects.<span class="built_in">size</span>(); ++i)</span><br><span class="line">      centroidBounds =</span><br><span class="line">          <span class="built_in">Union</span>(centroidBounds, objects[i]-&gt;<span class="built_in">getBounds</span>().<span class="built_in">Centroid</span>());</span><br><span class="line">    <span class="keyword">int</span> dim = centroidBounds.<span class="built_in">maxExtent</span>();</span><br><span class="line">    <span class="built_in"><span class="keyword">switch</span></span> (dim) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">        std::<span class="built_in">sort</span>(objects.<span class="built_in">begin</span>(), objects.<span class="built_in">end</span>(), [](<span class="keyword">auto</span> f1, <span class="keyword">auto</span> f2) &#123;</span><br><span class="line">          <span class="keyword">return</span> f1-&gt;<span class="built_in">getBounds</span>().<span class="built_in">Centroid</span>().x &lt; f2-&gt;<span class="built_in">getBounds</span>().<span class="built_in">Centroid</span>().x;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">        std::<span class="built_in">sort</span>(objects.<span class="built_in">begin</span>(), objects.<span class="built_in">end</span>(), [](<span class="keyword">auto</span> f1, <span class="keyword">auto</span> f2) &#123;</span><br><span class="line">          <span class="keyword">return</span> f1-&gt;<span class="built_in">getBounds</span>().<span class="built_in">Centroid</span>().y &lt; f2-&gt;<span class="built_in">getBounds</span>().<span class="built_in">Centroid</span>().y;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">        std::<span class="built_in">sort</span>(objects.<span class="built_in">begin</span>(), objects.<span class="built_in">end</span>(), [](<span class="keyword">auto</span> f1, <span class="keyword">auto</span> f2) &#123;</span><br><span class="line">          <span class="keyword">return</span> f1-&gt;<span class="built_in">getBounds</span>().<span class="built_in">Centroid</span>().z &lt; f2-&gt;<span class="built_in">getBounds</span>().<span class="built_in">Centroid</span>().z;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> beginning = objects.<span class="built_in">begin</span>();</span><br><span class="line">    <span class="keyword">auto</span> middling = objects.<span class="built_in">begin</span>() + (objects.<span class="built_in">size</span>() / <span class="number">2</span>);</span><br><span class="line">    <span class="keyword">auto</span> ending = objects.<span class="built_in">end</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> leftshapes = std::vector&lt;Object*&gt;(beginning, middling);</span><br><span class="line">    <span class="keyword">auto</span> rightshapes = std::vector&lt;Object*&gt;(middling, ending);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">assert</span>(objects.<span class="built_in">size</span>() == (leftshapes.<span class="built_in">size</span>() + rightshapes.<span class="built_in">size</span>()));</span><br><span class="line"></span><br><span class="line">    node-&gt;left = <span class="built_in">recursiveBuild</span>(leftshapes);</span><br><span class="line">    node-&gt;right = <span class="built_in">recursiveBuild</span>(rightshapes);</span><br><span class="line"></span><br><span class="line">    node-&gt;bounds = <span class="built_in">Union</span>(node-&gt;left-&gt;bounds, node-&gt;right-&gt;bounds);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> node;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä¸Šé¢æ˜¯BVH,å†çœ‹SAH.</p><p><img data-src="https://s2.loli.net/2024/06/01/kQfWdLwKM8JEAO6.png" alt="image-20240601230318319"></p><p><img data-src="https://s2.loli.net/2024/06/01/SdR4eM9Lzmqx83u.png" alt="image-20240601225049873"></p><p><img data-src="https://s2.loli.net/2024/06/01/dEh2QYDNBZq4Gmw.png" alt="image-20240601230545159"></p><p><img data-src="https://s2.loli.net/2024/06/01/Lt8SdEIrph3s7wC.png" alt="image-20240601230754416"></p><h5 id="HW7"><a href="#HW7" class="headerlink" title="HW7"></a>HW7</h5><p><strong>radiometry</strong></p><p>Radiant flux, intensity, irradiance, radiance</p><p><strong>è¾å°„èƒ½</strong>(Radiant energy)æ˜¯ç”µç£ è¾å°„èƒ½ã€‚å®ƒä»¥ç„¦è€³ä¸ºå•ä½</p><p>Q [J = Joule]</p><p> <strong>è¾å°„é€šé‡</strong>ï¼ˆåŠŸç‡ï¼‰æ˜¯å•ä½æ—¶é—´å†…å‘å°„ã€åå°„ã€ä¼ è¾“æˆ–æ¥æ”¶çš„èƒ½é‡ã€<br>å•ä½æ—¶é—´å†…åå°„ã€ä¼ è¾“æˆ–æ¥æ”¶çš„èƒ½é‡</p><script type="math/tex; mode=display">\Phi\equiv\frac{\mathrm{d}Q}{\mathrm{d}t}\text{ [W=Watt] [lm=lumen]}</script><p><img data-src="https://s2.loli.net/2024/06/02/UHw3QStEyLeJvcg.png" alt="image-20240602161533270"></p><p>æœ‰ä¸‰ä¸ªè¡¡é‡æŒ‡æ ‡,åŒ…æ‹¬intensiry,irradianceå’Œradiance.</p><p><img data-src="https://s2.loli.net/2024/06/02/b2unaV1cI5EjAGO.png" alt="image-20240602161706417"></p><p>å®å¿ƒè§’ï¼šçƒé¢ä¸Šè¢«æ‘„é¢ç§¯ä¸åŠå¾„å¹³æ–¹çš„æ¯”å€¼ï¼šçƒé¢é¢ç§¯ä¸åŠå¾„å¹³æ–¹ä¹‹æ¯” ,çƒæœ‰4Î  steradians</p><p><img data-src="https://s2.loli.net/2024/06/02/m6cLVeHiUGlbMfZ.png" alt="image-20240602163911047" style="zoom:67%;" /></p><p><img data-src="https://s2.loli.net/2024/06/02/xD2i9V1WznUTF4q.png" alt="image-20240602164606816"></p><p><img data-src="https://s2.loli.net/2024/06/02/OMtKHV5yo8TWziU.png" alt="image-20240602164655440"></p><p><img data-src="https://s2.loli.net/2024/06/02/NJcHQwevWK9ZO1z.png" alt="image-20240602165849277"></p><p>è¾ç…§åº¦(irradiance)æ˜¯å…¥å°„åˆ°è¡¨é¢ç‚¹çš„å•ä½é¢ç§¯åŠŸç‡</p><p><img data-src="https://s2.loli.net/2024/06/02/2lu7SGBX5qcUTbr.png" alt="image-20240602170041748"></p><p>è¡¨é¢çš„è¾ç…§åº¦ä¸å…‰ç…§æ–¹å‘å’Œè¡¨é¢æ³•çº¿ä¹‹é—´å¤¹è§’çš„ä½™å¼¦æˆæ­£æ¯”ã€‚</p><p><img data-src="https://s2.loli.net/2024/06/02/hjSAJr1gxt7Bmep.png" alt="image-20240602170804889"></p><p><img data-src="https://s2.loli.net/2024/06/02/DofShqERXKj6wPJ.png" alt="image-20240602171113537" style="zoom:67%;" /></p><p> è¾å°„åº¦(Radiance)æ˜¯æè¿°å…‰åœ¨ç¯å¢ƒä¸­åˆ†å¸ƒçš„åŸºæœ¬åœºé‡ </p><ul><li>è¾ç…§åº¦æ˜¯ä¸å…‰çº¿ç›¸å…³çš„é‡ </li><li>æ¸²æŸ“å°±æ˜¯è®¡ç®—è¾å°„åº¦</li></ul><p><img data-src="https://s2.loli.net/2024/06/02/nSJchK5OdA4fpNt.png" alt="image-20240602172100181"></p><p><img data-src="https://s2.loli.net/2024/06/02/xv3qSwf4XlWAGQs.png" alt="image-20240602172146849"></p><p>Incident radiance:å…¥å°„è¾å°„åº¦æ˜¯åˆ°è¾¾è¡¨é¢çš„å•ä½å›ºè§’è¾ç…§åº¦</p><p>Exiting Radiance:ç¦»å¼€è¡¨é¢è¾å°„åº¦æ˜¯ç¦»å¼€è¡¨é¢çš„å•ä½æŠ•å½±é¢ç§¯å¼ºåº¦ã€‚</p><p><strong>Bidirectional Reflectance  Distribution Function</strong></p><p>åŒå‘åå°„åˆ†å¸ƒå‡½æ•°ï¼ˆBRDFï¼‰è¡¨ç¤ºä»æ¯ä¸ªå…¥å°„æ–¹å‘åå°„åˆ°æ¯ä¸ªå‡ºå°„æ–¹å‘çš„å…‰é‡</p><p><img data-src="https://s2.loli.net/2024/06/02/gsSYMKUADz4Xp3b.png" alt="image-20240602173440574"></p><p><img data-src="https://s2.loli.net/2024/06/02/L1fjxdF4gEzKbpM.png" alt="image-20240602174423412"></p><p><img data-src="https://s2.loli.net/2024/06/02/snL4oXfVMKzmqxR.png" alt="image-20240602205209811"></p><p><img data-src="https://s2.loli.net/2024/06/02/BRbCeu6IHMSpiFL.png" alt="image-20240602174856955"></p><p><img data-src="https://pic3.zhimg.com/v2-c9128ac3f985a48f1c42ea7f12803f8e_b.jpg" alt="img"></p><p><img data-src="https://s2.loli.net/2024/06/02/FEoybKz31a5Mpc6.png" alt="image-20240602211917267"></p><p>å°†L~i~è½¬ä¸ºç»è¿‡åå°„åçš„å…‰L~r~å†ç»è¿‡ç®€åŒ–.</p><ul><li>æ­¤æ—¶æˆ‘ä»¬ä»¤ç›¸æœºæ¥å—åˆ°çš„ç›´æ¥å…‰ç…§ä¸ºï¼še(u)</li><li>æœ€ç»ˆæ¥æ”¶åˆ°çš„å…‰ä¸º:l(u)</li><li>å…¶ä»–è¡¨é¢å¼¹è¿‡æ¥çš„å…‰ä¸º:l(v)</li><li>BRDFé‚£äº›å¼å­ä¸ºï¼šKï¼ˆuï¼Œvï¼‰</li></ul><p><img data-src="https://pic3.zhimg.com/v2-1df15bb2a394315d869b916c594e1fb2_b.jpg" alt="img"></p><p><img data-src="https://s2.loli.net/2024/06/02/IAHsizpe86rmSCo.png" alt="image-20240602212016496"></p><p><strong>Monte Carlo Integration</strong></p><p><img data-src="https://s2.loli.net/2024/06/02/xKZpAtQFj8yimU4.png" alt="image-20240602214239624"></p><p><strong>Path Tracing</strong></p><p>å…‰çº¿è¿½è¸ª </p><ul><li>å§‹ç»ˆæ‰§è¡Œé•œé¢åå°„/æŠ˜å°„ </li><li>åœ¨æ¼«åå°„è¡¨é¢åœæ­¢åå¼¹ </li></ul><p>ä½¿ç”¨Monte Carlo Integrationè§£å†³åå°„å…¬å¼.</p><p><img data-src="https://s2.loli.net/2024/06/02/EhnZtXl7cMkPb2a.png" alt="image-20240602215544122"></p><p><img data-src="https://s2.loli.net/2024/06/02/NufB9EKD4wZOPU6.png" alt="image-20240602220952675"></p><p><img data-src="https://s2.loli.net/2024/06/02/Fowx9kp7sRbHdMY.png" alt="image-20240602222734803" style="zoom:67%;" /></p><p>å­˜åœ¨çš„ä¸¤ä¸ªé—®é¢˜: </p><p><strong>Explosion of #rays as #bounces go up</strong></p><p>ç”±äºåå°„,åœ¨åå°„æ—¶éœ€è¦é€šè¿‡è’™ç‰¹å¡æ´›æ–¹æ³•è®¡ç®—å¤šä¸ªå€¼,è¿™æ ·å¤šæ¬¡åå°„è®¡ç®—é‡å¢åŠ .</p><p>æ‰€ä»¥åªå–ä¸€ä¸ªæ–¹å‘ä½œä¸ºå…¥å°„,ä½†åœ¨æ¯ä¸ªpixelä¸Šé‡‡æ ·å¤šä¸ªå€¼å–å¹³å‡.</p><p><img data-src="https://s2.loli.net/2024/06/02/li1ahLZm26DvMru.png" alt="image-20240602230032888"></p><p><strong>The recursive algorithm will never stop</strong></p><p>å…‰ä¼šæ— æ•°æ¬¡åå¼¹. è§£å†³æ–¹æ³•:ä¿„ç½—æ–¯è½®ç›˜èµŒ Russian Roulette (RR)</p><p><img data-src="https://s2.loli.net/2024/06/02/NugfonpHmWKzX1V.png" alt="image-20240602230335879"></p><p><img data-src="https://s2.loli.net/2024/06/02/CwaPL4fyJtV8uc7.png" alt="image-20240602230436474" style="zoom:50%;" /></p><p>æ­¤å¤–N=1çš„é‡‡æ ·è¿˜å­˜åœ¨é—®é¢˜:å³ä½é‡‡æ ·ç‡çš„é—®é¢˜ï¼Œç”±äºæˆ‘ä»¬å°†å¹³å‡æ”¾åˆ°äº†åƒç´ å—å¤„ç”¨æ¥æ”¶åˆ°çš„å…‰çº¿æ¥æ›¿ä»£å¹³å‡ç€è‰²ç‚¹çš„å…‰çº¿ï¼Œä½†å¦‚æœå¯¹äºä¸€ä¸ªåœºæ™¯å°±æ²¡æœ‰æˆ–å­˜åœ¨å¾ˆå°‘çš„é—´æ¥å…‰ç…§ï¼Œä¸»è¦æ˜¯ç›´æ¥å…‰ç…§çš„æ—¶å€™ï¼Œé‚£è¿™ä¸ªå¹³å‡ä¹Ÿæ— æ³•æ¶ˆé™¤è¯¯å·®å™ªå£°ã€‚</p><blockquote><p>å¦‚æœå…‰æºé¢ç§¯å¾ˆå°ï¼Œåˆ™å‡åŒ€é‡‡æ ·å°±éœ€è¦å¾ˆå¤§çš„Næ‰èƒ½ä¿è¯é‡‡æ ·åˆ°å…‰æºæ–¹å‘ã€‚ä¹Ÿå°±æ˜¯è¿™é‡Œé—®é¢˜æ¥è‡ªä¸¤ä¸ªç¬¬ä¸€ä¸ªæ˜¯å‡åŒ€æŠ½æ ·æ–¹æ³•æµªè´¹äº†å¾ˆå¤šå…‰æºä¸å­˜åœ¨çš„è§’åº¦</p></blockquote><p>å¯¹å…‰é‡‡æ ·</p><p><img data-src="https://s2.loli.net/2024/06/02/t2TL8lFwkCp4XfK.png" alt="image-20240602232512769"></p><p><img data-src="https://s2.loli.net/2024/06/02/4vfesAZGRpgjChi.png" alt="z"></p><p><img data-src="https://s2.loli.net/2024/06/02/y8Wdgb4t2TJY9qZ.png" alt="image-20240602232751423"></p><p><img data-src="https://iewug.github.io/book/img/15renderingEquation.png" alt="img"></p><p>æ¸²æŸ“å…¬å¼é€šè¿‡BRDFå¾—åˆ°</p><p>æ¼”è¿›è¿‡ç¨‹:æ¸²æŸ“å…¬å¼-&gt;ä½¿ç”¨è’™ç‰¹å¡æ´›æ–¹å¼ç§¯åˆ†è§£-&gt;å¼•å…¥å…¨å±€å…‰ç…§,ç¢°åˆ°ç‰©ä½“ä¼šåå°„-&gt;ç”±äºåå°„å¤ªå¤š,ç›´æ¥æ¯æ¬¡åªä¼šåå°„ä¸€æ ¹å…‰çº¿-&gt;ç”±äºåªåå°„ä¸€æ ¹å…‰çº¿,é‡‡æ ·ä¸å¤Ÿ,åœ¨ä¸€ä¸ªpixelä¸Šé‡‡æ ·æ›´å¤šæ¬¡-&gt;æ­¤å¤–è¿™ä¸ªç®—æ³•ä¼šæ— ç©·çš„è¿›è¡Œä¸‹å»(å› ä¸ºæœ€ååªåœ¨æ‰“åˆ°ç¯å…‰ååœæ­¢),æ¯æ¬¡åå°„é€šè¿‡ä¿„ç½—æ–¯è½¬ç›˜å‡å°‘èƒ½é‡-&gt;æ­¤å¤–è¿˜æ˜¯ä¸å¤Ÿæœ‰æ•ˆ,è€ƒè™‘sample the light,sample lightæœ¬èº«æ˜¯dA,éœ€è¦ä»dwè½¬åˆ°dA-&gt;ç°åœ¨é€‰æ‹©ä¸€ä¸ªåŒºåŸŸä½œä¸ºlight sourceç›´æ¥ç…§å°„,å¦å¤–åŒºåŸŸéƒ½æ˜¯é—´æ¥çš„</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ€»ä½“æµç¨‹å¦‚ä¸‹ï¼š</span></span><br><span class="line"><span class="comment">// ä»åƒç´ æ‰“å‡ºå°„çº¿ï¼Œæ£€æŸ¥å°„çº¿æ˜¯å¦å‘½ä¸­ï¼Œå‘½ä¸­åˆ™ç»§ç»­ä¸‹ä¸€æ­¥ï¼Œåä¹‹ç»“æŸ</span></span><br><span class="line"><span class="comment">// å¯¹å…‰æºè¡¨é¢è¿›è¡Œé‡‡æ ·ï¼Œå¾—åˆ°ä¸€ä¸ªé‡‡æ ·çš„äº¤ç‚¹ Intersection å’Œå…‰æºçš„ pdf</span></span><br><span class="line"><span class="comment">// æ£€æŸ¥å…‰æºé‡‡æ ·ç‚¹å’Œåƒç´ å°„çº¿äº¤ç‚¹ï¼Œä¸¤ç‚¹ä¹‹é—´æ˜¯å¦æœ‰å…¶ä»–ç‰©ä½“é®æŒ¡ï¼Œæ²¡æœ‰é®æŒ¡åˆ™å¯è®¡ç®—ç›´æ¥å…‰</span></span><br><span class="line"><span class="comment">// è®¡ç®—ä¿„ç½—æ–¯è½®ç›˜èµŒæ¦‚ç‡ï¼Œå¦‚æœæˆåŠŸè¿›è¡Œä¸‹ä¸€æ­¥</span></span><br><span class="line"><span class="comment">// æŒ‰ç…§åƒç´ å°„çº¿äº¤ç‚¹æè´¨çš„æ€§è´¨ï¼Œç»™å®šåƒç´ å°„çº¿å…¥å°„æ–¹å‘ä¸äº¤ç‚¹æ³•å‘é‡ï¼Œç”¨æŸç§åˆ†å¸ƒé‡‡æ ·ä¸€ä¸ªå‡ºå°„æ–¹å‘ï¼Œè¿™é‡Œæ˜¯æ¼«åå°„</span></span><br><span class="line"><span class="comment">// æœ‰äº†å‡ºå°„æ–¹å‘å’Œäº¤ç‚¹ï¼Œå¾—åˆ°æ–°çš„å°„çº¿ï¼Œè®¡ç®—æ˜¯å¦æœ‰å‘½ä¸­</span></span><br><span class="line"><span class="comment">// å¦‚æœå‘½ä¸­äº†éå…‰æºï¼Œè®¡ç®—æ–°å°„çº¿å‘½ä¸­äº¤ç‚¹ç»™åŸæ¥åƒç´ å°„çº¿äº¤ç‚¹å¸¦æ¥çš„é—´æ¥å…‰</span></span><br><span class="line"><span class="comment">// æœ€åå°†ç›´æ¥å…‰å’Œé—´æ¥å…‰ç»“åˆï¼Œå¾—åˆ°æœ€åˆå‘½ä¸­çš„ä½ç½®çš„é¢œè‰²</span></span><br><span class="line"><span class="comment">// Implementation of Path Tracing</span></span><br><span class="line"><span class="function">Vector3f <span class="title">Scene::castRay</span><span class="params">(<span class="keyword">const</span> Ray &amp;ray, <span class="keyword">int</span> depth)</span> <span class="keyword">const</span> </span>&#123;</span><br><span class="line">  <span class="comment">// TO DO Implement Path Tracing Algorithm here</span></span><br><span class="line">  Vector3f l_indir&#123;<span class="number">0.f</span>&#125;;</span><br><span class="line">  Vector3f l_dir&#123;<span class="number">0.f</span>&#125;;</span><br><span class="line">  Intersection ray_inter = <span class="built_in">intersect</span>(ray);</span><br><span class="line">  <span class="keyword">if</span> (!ray_inter.happened) &#123;</span><br><span class="line">    <span class="comment">// æ²¡æœ‰ä¸ä»»ä½•ç‰©ä½“ç›¸ç¢°</span></span><br><span class="line">    <span class="keyword">return</span> l_dir + l_indir;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">float</span> pdf_light;</span><br><span class="line">  Intersection light_inter;</span><br><span class="line">  <span class="built_in">sampleLight</span>(light_inter, pdf_light);</span><br><span class="line"></span><br><span class="line">  Vector3f N = ray_inter.normal;</span><br><span class="line">  Vector3f x = light_inter.coords;</span><br><span class="line">  Vector3f wo = ray.direction;</span><br><span class="line">  Vector3f p = ray_inter.coords;</span><br><span class="line">  Vector3f ws = (x - p).<span class="built_in">normalized</span>();</span><br><span class="line">  <span class="comment">// shoot a ray from p to x</span></span><br><span class="line">  Ray ray_light_to_p = <span class="built_in">Ray</span>(p + EPSILON * N, ws);</span><br><span class="line">  <span class="keyword">auto</span> rpx_inter = <span class="built_in">intersect</span>(ray_light_to_p);</span><br><span class="line">  Vector3f NN = rpx_inter.normal;</span><br><span class="line">  Material *m = ray_inter.m;</span><br><span class="line">  <span class="comment">// if the ray is not blocked in the middle</span></span><br><span class="line">  <span class="keyword">if</span> (rpx_inter.happened &amp;&amp; rpx_inter.m-&gt;<span class="built_in">hasEmission</span>()) &#123;</span><br><span class="line">    l_dir = rpx_inter.m-&gt;<span class="built_in">getEmission</span>() * m-&gt;<span class="built_in">eval</span>(wo, ws, N) *</span><br><span class="line">            <span class="built_in">dotProduct</span>(ws, N) * <span class="built_in">dotProduct</span>(-ws, NN) / (rpx_inter.distance) /</span><br><span class="line">            pdf_light;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">get_random_float</span>() &lt; RussianRoulette) &#123;</span><br><span class="line">    Vector3f wi = (m-&gt;<span class="built_in">sample</span>(wo, N)).<span class="built_in">normalized</span>();</span><br><span class="line">    <span class="function">Ray <span class="title">rpwi</span><span class="params">(p, wi)</span></span>;</span><br><span class="line">    <span class="keyword">auto</span> rpwi_inter = <span class="built_in">intersect</span>(rpwi);</span><br><span class="line">    <span class="keyword">if</span> (rpwi_inter.happened &amp;&amp; !rpwi_inter.m-&gt;<span class="built_in">hasEmission</span>()) &#123;</span><br><span class="line">      l_indir = <span class="built_in">castRay</span>(rpwi, depth + <span class="number">1</span>) * m-&gt;<span class="built_in">eval</span>(wo, wi, N) *</span><br><span class="line">                <span class="built_in">dotProduct</span>(wi, N) / m-&gt;<span class="built_in">pdf</span>(wo, wi, N) / RussianRoulette;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> m-&gt;<span class="built_in">getEmission</span>() + l_dir + l_indir; <span class="comment">//ç‰©ä½“è¡¨é¢çš„emissionå’Œç›´æ¥ä»å…‰å‘å°„çš„å’Œåå°„çš„</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>from <a href="https://iewug.github.io/book/GAMES101.html#19-cameras-lenses-and-light-fields">GAMES101ç¬”è®° (iewug.github.io)</a></p><p><img data-src="https://iewug.github.io/book/img/18.png" alt="img"></p><h5 id="ç›¸æœºä¸é€é•œ"><a href="#ç›¸æœºä¸é€é•œ" class="headerlink" title="ç›¸æœºä¸é€é•œ"></a>ç›¸æœºä¸é€é•œ</h5><p><img data-src="https://s2.loli.net/2024/06/24/6UpBiyaDNRWGFws.png" alt="Controlled by lens aperture and focal length "></p><p>Shutter Exposes Sensor For Precise Duration</p><p>Sensor Accumulates Irradiance During Exposure</p><p><img data-src="https://s2.loli.net/2024/06/24/bSJjU1PMziDhyg2.png" alt="image-20240624205234472"></p><p><img data-src="https://s2.loli.net/2024/06/24/CBP6qkOpLA21a5z.png" alt="image-20240624205208978"></p><p><img data-src="https://s2.loli.net/2024/06/24/ieFozQaEGCmhxd9.png" alt="image-20240624205321605" style="zoom:67%;" /></p><p><img data-src="https://iewug.github.io/book/img/19coc.png" alt="img"></p><p><img data-src="https://iewug.github.io/book/img/19dof.png" alt="img"></p><p>ä¸€äº›æ¦‚å¿µ:focal length,FOV,exposure,ISO(æ„Ÿå…‰åº¦),F-step(ç„¦è·é™¤ä»¥å£å¾„çš„ç›´å¾„),CoCå¤§å°(å½“ç‰©ä½“è¿œç¦»Focal Planeï¼ŒåŸæœ¬çš„ä¸€ä¸ªç‚¹è½åœ¨sensor planeä¸Šå°±ä¼šå˜æˆä¸€ä¸ªåœ†),æ™¯æ·±,æŒ‡çš„æ˜¯åœ¨ç›¸æœºæ‹æ‘„è¿‡ç¨‹ä¸­,æˆåƒæ¸…æ™°çš„èŒƒå›´æˆ–æ·±åº¦ã€‚</p><h5 id="å…‰åœºã€é¢œè‰²ä¸æ„ŸçŸ¥"><a href="#å…‰åœºã€é¢œè‰²ä¸æ„ŸçŸ¥" class="headerlink" title="å…‰åœºã€é¢œè‰²ä¸æ„ŸçŸ¥"></a>å…‰åœºã€é¢œè‰²ä¸æ„ŸçŸ¥</h5><p><strong>å…‰åœº</strong>ï¼ˆ<strong>light field</strong>æˆ–ç§°ä¸º<strong>lumigraph</strong>ï¼‰ï¼Œå³æ˜¯ç©ºé—´ä¸­ä»»æ„ç‚¹å‘å‡ºçš„ä»»æ„æ–¹å‘çš„å…‰çš„é›†åˆ</p><p><img data-src="https://s2.loli.net/2024/06/24/yrHGxeBONiDd2Pz.png" alt=""></p><p><img data-src="https://s2.loli.net/2024/06/24/Hx2PZirjtD4Lw5d.png" alt=""></p><h5 id="HW8"><a href="#HW8" class="headerlink" title="HW8"></a>HW8</h5><p><strong>Mass Spring System</strong> è´¨é‡-å¼¹ç°§ç³»ç»Ÿ</p><p><img data-src="https://s2.loli.net/2024/06/24/nf1QyZV5pgU9BHi.png" alt="image-20240624220439532"></p><p><img data-src="https://s2.loli.net/2024/06/24/4pGTPO6Ws1wUvdf.png" alt="image-20240624220852340"></p><p><img data-src="https://s2.loli.net/2024/06/24/ErmvTYSaBPXUnMu.png" alt="image-20240624221049069"></p><p><strong>ç²’å­ç³»ç»Ÿ</strong></p><p>å°†åŠ¨æ€ç³»ç»Ÿå»ºæ¨¡ä¸ºå¤§é‡ç²’å­çš„é›†åˆ<br>å¤§é‡ç²’å­çš„é›†åˆ,æ¯ä¸ªç²’å­çš„è¿åŠ¨ç”±ä¸€ç»„<br>ç‰©ç†ï¼ˆæˆ–éç‰©ç†ï¼‰åŠ›<br>å›¾å½¢å’Œæ¸¸æˆä¸­çš„æµè¡ŒæŠ€æœ¯ </p><ul><li>æ˜“äºç†è§£å’Œå®æ–½ </li><li>å¯æ‰©å±•ï¼šç²’å­æ•°é‡è¶Šå°‘é€Ÿåº¦è¶Šå¿«ï¼Œç²’å­æ•°é‡è¶Šå¤š<br>ä»¥æé«˜å¤æ‚æ€§<br>æŒ‘æˆ˜ </li><li>å¯èƒ½éœ€è¦å¾ˆå¤šç²’å­ï¼ˆå¦‚æµä½“ï¼‰ </li><li>å¯èƒ½éœ€è¦åŠ é€Ÿç»“æ„ï¼ˆå¦‚<br>æ‰¾åˆ°æœ€è¿‘çš„ç²’å­è¿›è¡Œäº¤äº’ï¼‰ </li></ul><p>å¸å¼•åŠ›å’Œæ–¥åŠ› </p><ul><li>é‡åŠ›ã€ç”µç£åŠ›ã€â€¦ </li><li>å¼¹ç°§ã€æ¨è¿›åŠ› â€¦<br>é˜»å°¼åŠ› </li><li>æ‘©æ“¦åŠ›ã€ç©ºæ°”é˜»åŠ›ã€ç²˜æ»åŠ› â€¦<br>ç¢°æ’ </li><li>å¢™å£ã€å®¹å™¨ã€å›ºå®šç‰©ä½“ã€ â€¦ </li><li><p>åŠ¨æ€ç‰©ä½“ã€è§’è‰²èº«ä½“éƒ¨ä½</p></li><li><p><strong>æ­£å‘è¿åŠ¨å­¦</strong>ï¼ˆforward kinematicsï¼‰ï¼šå·²çŸ¥åˆå§‹çš„å…³é”®ç‚¹ä½ç½®å’Œç›¸å¯¹æ—‹è½¬ï¼Œè®¡ç®—æœ€ç»ˆçš„å…³é”®ç‚¹ä½ç½®ã€‚å”¯ä¸€è§£</p></li><li><strong>åå‘è¿åŠ¨å­¦</strong>ï¼ˆinverse kinematicsï¼‰ï¼šæ ¹æ®åˆå§‹çš„å…³é”®ç‚¹ä½ç½®å’Œæœ€ç»ˆå…³é”®ç‚¹ä½ç½®ï¼Œè®¡ç®—ç›¸å¯¹æ—‹è½¬çš„æ•°å­¦è¿‡ç¨‹ã€‚æ— è§£æˆ–æ— ç©·å¤šè§£ï¼ˆill-posed problemï¼‰ã€‚</li></ul><p><strong>Rigging(ç»‘å®š)</strong></p><p>è£…é…æ˜¯å¯¹è§’è‰²è¿›è¡Œæ›´é«˜çº§åˆ«çš„æ§åˆ¶ï¼Œå¯ä»¥æ›´å¿«ã€æ›´ç›´è§‚åœ°ä¿®æ”¹è§’è‰²çš„å§¿åŠ¿ã€å˜å½¢å’Œè¡¨æƒ…ç­‰ã€‚<br>æ›´å¿«ã€æ›´ç›´è§‚åœ°ä¿®æ”¹å§¿åŠ¿ã€å˜å½¢å’Œè¡¨æƒ…ç­‰ã€‚</p><ul><li>å°±åƒæœ¨å¶ä¸Šçš„çº¿ </li><li>æ•æ‰æ‰€æœ‰æœ‰æ„ä¹‰çš„è§’è‰²çš„å˜åŒ– </li><li>å› è§’è‰²è€Œå¼‚</li><li>è§’è‰²åˆ¶ä½œæˆæœ¬é«˜ </li><li>æ‰‹å·¥åˆ¶ä½œ </li><li>éœ€è¦è‰ºæœ¯å’ŒæŠ€æœ¯åŸ¹è®­</li></ul><p>ä»£æ›¿éª¨æ¶ï¼Œç›´æ¥åœ¨æ›²é¢ä¹‹é—´æ’å€¼<br>ä¾‹å¦‚ï¼Œå»ºç«‹é¢éƒ¨è¡¨æƒ…é›†åˆæ¨¡å‹<br>è¡¨æƒ…æ¨¡å‹ï¼š<br>æœ€ç®€å•çš„æ–¹æ¡ˆï¼šå¯¹é¡¶ç‚¹ä½ç½®è¿›è¡Œçº¿æ€§ç»„åˆ<br>ä½¿ç”¨æ ·æ¡æ›²çº¿æ§åˆ¶éšæ—¶é—´å˜åŒ–çš„æƒé‡é€‰æ‹©</p><p><strong>Motion Capture(åŠ¨æ•)</strong></p><p>åˆ›å»ºåŠ¨ç”»åºåˆ—çš„æ•°æ®é©±åŠ¨æ–¹æ³• </p><ul><li>è®°å½•çœŸå®ä¸–ç•Œä¸­çš„è¡¨æ¼”ï¼ˆä¾‹å¦‚ï¼Œäººåœ¨æ‰§è¡Œä¸€é¡¹æ´»åŠ¨ï¼‰ </li><li>ä»æ”¶é›†åˆ°çš„æ•°æ®ä¸­æå–å§¿åŠ¿ä¸æ—¶é—´çš„å‡½æ•°å…³ç³»</li></ul><p><strong>Single Particle Simulation</strong></p><p><img data-src="https://s2.loli.net/2024/06/24/25FQh4KbNSsTrey.png" alt="image-20240624222909275">é¦–å…ˆï¼Œå‡è®¾ç²’å­çš„è¿åŠ¨ç”±é€Ÿåº¦çŸ¢é‡åœºå†³å®šï¼Œé€Ÿåº¦çŸ¢é‡åœºæ˜¯ä½ç½®å’Œæ—¶é—´çš„å‡½æ•°ï¼šv(x, t)è®¡ç®—ç²’å­éšæ—¶é—´å˜åŒ–çš„ä½ç½® éœ€è¦æ±‚è§£ä¸€ä¸ªä¸€é˜¶å¸¸å¾®åˆ†æ–¹ç¨‹ï¼š â€œä¸€é˜¶ â€œæŒ‡çš„æ˜¯å¯¼æ•°ã€‚â€æ™®é€š â€œæ„å‘³ç€æ²¡æœ‰ â€œåâ€ å¯¼æ•°,å³xåªæ˜¯tçš„å‡½æ•°.</p><p>åœ¨ç»™å®šç²’å­åˆå§‹ä½ç½® x0 çš„æ¡ä»¶ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ­£å‘æ•°å€¼ç§¯åˆ†æ¥æ±‚è§£ ODE</p><p>æ¬§æ‹‰æ³•ï¼ˆåˆç§°å‰å‘æ¬§æ‹‰æ³•ã€æ˜¾å¼æ¬§æ‹‰æ³•ï¼‰ </p><ul><li>ç®€å•è¿­ä»£æ³• </li><li>å¸¸ç”¨ </li><li>éå¸¸ä¸å‡†ç¡® </li><li>ç»å¸¸ä¸ç¨³å®š</li></ul><p><img data-src="https://s2.loli.net/2024/06/24/prX2HEvQnexuTPm.png" alt="image-20240624223202577" style="zoom:67%;" /></p><p><strong>æ¶ˆé™¤ä¸ç¨³å®šå› ç´ </strong></p><p>ä¸­ç‚¹æ³•/ä¿®æ­£æ¬§æ‹‰æ³• </p><ul><li>èµ·ç‚¹å’Œç»ˆç‚¹çš„å¹³å‡é€Ÿåº¦<br>è‡ªé€‚åº”æ­¥é•¿ </li><li>é€’å½’æ¯”è¾ƒä¸€æ­¥å’Œä¸¤ä¸ªåŠæ­¥ï¼Œç›´åˆ°<br>è¯¯å·®å¯æ¥å—<br>éšå¼æ–¹æ³• </li><li>ä½¿ç”¨ä¸‹ä¸€æ—¶é—´æ­¥çš„é€Ÿåº¦ï¼ˆå›°éš¾ï¼‰<br>åŸºäºä½ç½®/Verlet ç§¯åˆ† </li><li>åœ¨æ—¶é—´æ­¥åçº¦æŸç²’å­çš„ä½ç½®å’Œé€Ÿåº¦æ­¥</li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line">Rope::<span class="built_in">Rope</span>(Vector2D start, Vector2D end, <span class="keyword">int</span> num_nodes, <span class="keyword">float</span> node_mass,</span><br><span class="line">           <span class="keyword">float</span> k, vector&lt;<span class="keyword">int</span>&gt; pinned_nodes) &#123;</span><br><span class="line">  <span class="comment">// TODO (Part 1): Create a rope starting at `start`, ending at `end`, and</span></span><br><span class="line">  <span class="comment">// containing `num_nodes` nodes.</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; num_nodes; i++) &#123;</span><br><span class="line">    Vector2D pos =</span><br><span class="line">        start + (end - start) * ((<span class="keyword">double</span>)i / ((<span class="keyword">double</span>)num_nodes - <span class="number">1.0</span>));</span><br><span class="line">    masses.<span class="built_in">push_back</span>(<span class="keyword">new</span> <span class="built_in">Mass</span>(pos, node_mass, <span class="literal">false</span>));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; num_nodes - <span class="number">1</span>; i++) &#123;</span><br><span class="line">    springs.<span class="built_in">push_back</span>(<span class="keyword">new</span> <span class="built_in">Spring</span>(masses[i], masses[i + <span class="number">1</span>], k));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">auto</span> &amp;i : pinned_nodes) &#123;</span><br><span class="line">    masses[i]-&gt;pinned = <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//        for (auto &amp;i : pinned_nodes) &#123;</span></span><br><span class="line">  <span class="comment">//            masses[i]-&gt;pinned = true;</span></span><br><span class="line">  <span class="comment">//        &#125;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Rope::simulateEuler</span><span class="params">(<span class="keyword">float</span> <span class="keyword">delta_t</span>, Vector2D gravity)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">auto</span> &amp;s : springs) &#123;</span><br><span class="line">    <span class="comment">// ï¼ˆsolving constraints)</span></span><br><span class="line">    <span class="keyword">auto</span> mod_ab = (s-&gt;m1-&gt;position - s-&gt;m2-&gt;position).<span class="built_in">norm</span>();</span><br><span class="line">    s-&gt;m1-&gt;forces += -s-&gt;k * (s-&gt;m1-&gt;position - s-&gt;m2-&gt;position) / mod_ab *</span><br><span class="line">                     (mod_ab - s-&gt;rest_length);</span><br><span class="line">    s-&gt;m2-&gt;forces += -s-&gt;k * (s-&gt;m2-&gt;position - s-&gt;m1-&gt;position) / mod_ab *</span><br><span class="line">                     (mod_ab - s-&gt;rest_length);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">auto</span> &amp;m : masses) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!m-&gt;pinned) &#123;</span><br><span class="line">      <span class="keyword">auto</span> a = m-&gt;forces / m-&gt;mass + gravity;</span><br><span class="line">      m-&gt;position += m-&gt;velocity * <span class="keyword">delta_t</span>;  <span class="comment">//  explicit</span></span><br><span class="line">      m-&gt;velocity += a * <span class="keyword">delta_t</span>;</span><br><span class="line">      m-&gt;position += m-&gt;velocity * <span class="keyword">delta_t</span>;  <span class="comment">//  implicit</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Reset all forces on each mass</span></span><br><span class="line">    m-&gt;forces = <span class="built_in">Vector2D</span>(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Rope::simulateVerlet</span><span class="params">(<span class="keyword">float</span> <span class="keyword">delta_t</span>, Vector2D gravity)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">auto</span> &amp;s : springs) &#123;</span><br><span class="line">    <span class="comment">// TODO (Part 3): Simulate one timestep of the rope using explicit Verlet</span></span><br><span class="line">    <span class="comment">// ï¼ˆsolving constraints)</span></span><br><span class="line">    <span class="keyword">auto</span> mod_ab = (s-&gt;m1-&gt;position - s-&gt;m2-&gt;position).<span class="built_in">norm</span>();</span><br><span class="line">    s-&gt;m1-&gt;forces += -s-&gt;k * (s-&gt;m1-&gt;position - s-&gt;m2-&gt;position) / mod_ab *</span><br><span class="line">                     (mod_ab - s-&gt;rest_length);</span><br><span class="line">    s-&gt;m2-&gt;forces += -s-&gt;k * (s-&gt;m2-&gt;position - s-&gt;m1-&gt;position) / mod_ab *</span><br><span class="line">                     (mod_ab - s-&gt;rest_length);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">auto</span> &amp;m : masses) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!m-&gt;pinned) &#123;</span><br><span class="line">      Vector2D temp_position = m-&gt;position;</span><br><span class="line">      <span class="comment">// TODO (Part 3.1): Set the new position of the rope mass</span></span><br><span class="line">      <span class="keyword">auto</span> a = m-&gt;forces / m-&gt;mass + gravity;</span><br><span class="line">      <span class="comment">// TODO (Part 4): Add global Verlet damping</span></span><br><span class="line">      m-&gt;position = temp_position + (temp_position - m-&gt;last_position) +</span><br><span class="line">                    a * <span class="keyword">delta_t</span> * <span class="keyword">delta_t</span>;</span><br><span class="line">      m-&gt;last_position = temp_position;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Reset all forces on each mass</span></span><br><span class="line">    m-&gt;forces = <span class="built_in">Vector2D</span>(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Rope::simulateVerlet</span><span class="params">(<span class="keyword">float</span> <span class="keyword">delta_t</span>, Vector2D gravity)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">auto</span> &amp;s : springs) &#123;</span><br><span class="line">    <span class="comment">// TODO (Part 3): Simulate one timestep of the rope using explicit Verlet</span></span><br><span class="line">    <span class="comment">// ï¼ˆsolving constraints)</span></span><br><span class="line">    <span class="keyword">auto</span> mod_ab = (s-&gt;m1-&gt;position - s-&gt;m2-&gt;position).<span class="built_in">norm</span>();</span><br><span class="line">    s-&gt;m1-&gt;forces += -s-&gt;k * (s-&gt;m1-&gt;position - s-&gt;m2-&gt;position) / mod_ab *</span><br><span class="line">                     (mod_ab - s-&gt;rest_length);</span><br><span class="line">    s-&gt;m2-&gt;forces += -s-&gt;k * (s-&gt;m2-&gt;position - s-&gt;m1-&gt;position) / mod_ab *</span><br><span class="line">                     (mod_ab - s-&gt;rest_length);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">float</span> damping_factor = <span class="number">0.00005</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">auto</span> &amp;m : masses) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!m-&gt;pinned) &#123;</span><br><span class="line">      Vector2D temp_position = m-&gt;position;</span><br><span class="line">      <span class="comment">// TODO (Part 3.1): Set the new position of the rope mass</span></span><br><span class="line">      <span class="keyword">auto</span> a = m-&gt;forces / m-&gt;mass + gravity;</span><br><span class="line">      <span class="comment">// TODO (Part 4): Add global Verlet damping</span></span><br><span class="line">      m-&gt;position = temp_position +</span><br><span class="line">                    (<span class="number">1</span> - damping_factor) * (temp_position - m-&gt;last_position) +</span><br><span class="line">                    a * <span class="keyword">delta_t</span> * <span class="keyword">delta_t</span>;</span><br><span class="line">      m-&gt;last_position = temp_position;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Reset all forces on each mass</span></span><br><span class="line">    m-&gt;forces = <span class="built_in">Vector2D</span>(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åè¯è§£é‡Š"><a href="#åè¯è§£é‡Š" class="headerlink" title="åè¯è§£é‡Š"></a>åè¯è§£é‡Š</h3><h4 id="ç¼“å†²å¯¹è±¡"><a href="#ç¼“å†²å¯¹è±¡" class="headerlink" title="ç¼“å†²å¯¹è±¡"></a>ç¼“å†²å¯¹è±¡</h4><p>æ¯”å¦‚é¡¶ç‚¹ç¼“å†²å¯¹è±¡,é¡¶ç‚¹æ•°ç»„å¯¹è±¡.</p><p>å®šä¹‰é¡¶ç‚¹æ•°æ®ä»¥åï¼Œæˆ‘ä»¬ä¼šæŠŠå®ƒä½œä¸ºè¾“å…¥å‘é€ç»™å›¾å½¢æ¸²æŸ“ç®¡çº¿çš„ç¬¬ä¸€ä¸ªå¤„ç†é˜¶æ®µï¼š<strong>é¡¶ç‚¹ç€è‰²å™¨</strong>ã€‚å®ƒ<strong>ä¼šåœ¨GPUä¸Šåˆ›å»ºå†…å­˜ç”¨äºå‚¨å­˜æˆ‘ä»¬çš„é¡¶ç‚¹æ•°æ®ï¼Œè¿˜è¦é…ç½®OpenGLå¦‚ä½•è§£é‡Šè¿™äº›å†…å­˜ï¼Œå¹¶ä¸”æŒ‡å®šå…¶å¦‚ä½•å‘é€ç»™æ˜¾å¡</strong>ã€‚é¡¶ç‚¹ç€è‰²å™¨æ¥ç€ä¼šå¤„ç†æˆ‘ä»¬åœ¨å†…å­˜ä¸­æŒ‡å®šæ•°é‡çš„é¡¶ç‚¹ã€‚</p><p>é€šè¿‡é¡¶ç‚¹ç¼“å†²å¯¹è±¡(Vertex Buffer Objects, VBO)ç®¡ç†è¿™ä¸ªå†…å­˜ï¼Œå®ƒä¼šåœ¨GPUå†…å­˜ï¼ˆé€šå¸¸è¢«ç§°ä¸ºæ˜¾å­˜ï¼‰ä¸­å‚¨å­˜å¤§é‡é¡¶ç‚¹ã€‚ä½¿ç”¨è¿™äº›ç¼“å†²å¯¹è±¡çš„å¥½å¤„æ˜¯æˆ‘ä»¬å¯ä»¥ä¸€æ¬¡æ€§çš„å‘é€ä¸€å¤§æ‰¹æ•°æ®åˆ°æ˜¾å¡ä¸Šï¼Œè€Œä¸æ˜¯æ¯ä¸ªé¡¶ç‚¹å‘é€ä¸€æ¬¡ã€‚ä»CPUæŠŠæ•°æ®å‘é€åˆ°æ˜¾å¡ç›¸å¯¹è¾ƒæ…¢ï¼Œæ‰€ä»¥åªè¦å¯èƒ½æˆ‘ä»¬éƒ½è¦å°è¯•å°½é‡ä¸€æ¬¡æ€§å‘é€å°½å¯èƒ½å¤šçš„æ•°æ®ã€‚å½“æ•°æ®å‘é€è‡³æ˜¾å¡çš„å†…å­˜ä¸­åï¼Œé¡¶ç‚¹ç€è‰²å™¨å‡ ä¹èƒ½ç«‹å³è®¿é—®é¡¶ç‚¹ï¼Œè¿™æ˜¯ä¸ªéå¸¸å¿«çš„è¿‡ç¨‹ã€‚</p><h4 id="ç¼“å†²å¯¹è±¡ç±»å‹"><a href="#ç¼“å†²å¯¹è±¡ç±»å‹" class="headerlink" title="ç¼“å†²å¯¹è±¡ç±»å‹"></a>ç¼“å†²å¯¹è±¡ç±»å‹</h4><p>æ¯”å¦‚é¡¶ç‚¹ç¼“å†²å¯¹è±¡ç±»å‹,åˆ›å»ºå¥½çš„ç¼“å†²å¯ä»¥ç»‘å®šåˆ°æŸç§å¯¹è±¡ç±»å‹ä¸Š.</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> VBO;</span><br><span class="line"><span class="built_in">glGenBuffers</span>(<span class="number">1</span>, &amp;VBO);</span><br><span class="line"><span class="built_in">glBindBuffer</span>(GL_ARRAY_BUFFER, VBO); </span><br></pre></td></tr></table></figure><p>ä»è¿™ä¸€åˆ»èµ·ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„ä»»ä½•ï¼ˆåœ¨GL_ARRAY_BUFFERç›®æ ‡ä¸Šçš„ï¼‰ç¼“å†²è°ƒç”¨éƒ½ä¼šç”¨æ¥é…ç½®å½“å‰ç»‘å®šçš„ç¼“å†²(VBO)ã€‚ç„¶åæˆ‘ä»¬å¯ä»¥è°ƒç”¨glBufferDataå‡½æ•°ï¼Œå®ƒä¼šæŠŠä¹‹å‰å®šä¹‰çš„é¡¶ç‚¹æ•°æ®å¤åˆ¶åˆ°ç¼“å†²çš„æ˜¾å­˜ä¸­</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">glBufferData</span>(GL_ARRAY_BUFFER, <span class="built_in"><span class="keyword">sizeof</span></span>(vertices), vertices, GL_STATIC_DRAW);</span><br></pre></td></tr></table></figure><h4 id="shaderä¸GLSL"><a href="#shaderä¸GLSL" class="headerlink" title="shaderä¸GLSL"></a>shaderä¸GLSL</h4><p><strong>å›¾å½¢æ¸²æŸ“ç®¡çº¿æ¥å—ä¸€ç»„3Dåæ ‡ï¼Œç„¶åæŠŠå®ƒä»¬è½¬å˜ä¸ºä½ å±å¹•ä¸Šçš„æœ‰è‰²2Dåƒç´ è¾“å‡º</strong>ã€‚å›¾å½¢æ¸²æŸ“ç®¡çº¿å¯ä»¥è¢«åˆ’åˆ†ä¸ºå‡ ä¸ªé˜¶æ®µï¼Œæ¯ä¸ªé˜¶æ®µå°†ä¼šæŠŠå‰ä¸€ä¸ªé˜¶æ®µçš„è¾“å‡ºä½œä¸ºè¾“å…¥ã€‚æ‰€æœ‰è¿™äº›é˜¶æ®µéƒ½æ˜¯é«˜åº¦ä¸“é—¨åŒ–çš„ï¼ˆå®ƒä»¬éƒ½æœ‰ä¸€ä¸ªç‰¹å®šçš„å‡½æ•°ï¼‰ï¼Œå¹¶ä¸”å¾ˆå®¹æ˜“å¹¶è¡Œæ‰§è¡Œã€‚æ­£æ˜¯ç”±äºå®ƒä»¬å…·æœ‰å¹¶è¡Œæ‰§è¡Œçš„ç‰¹æ€§ï¼Œå½“ä»Šå¤§å¤šæ•°æ˜¾å¡éƒ½æœ‰æˆåƒä¸Šä¸‡çš„å°å¤„ç†æ ¸å¿ƒï¼Œ<strong>å®ƒä»¬åœ¨GPUä¸Šä¸ºæ¯ä¸€ä¸ªï¼ˆæ¸²æŸ“ç®¡çº¿ï¼‰é˜¶æ®µè¿è¡Œå„è‡ªçš„å°ç¨‹åºï¼Œä»è€Œåœ¨å›¾å½¢æ¸²æŸ“ç®¡çº¿ä¸­å¿«é€Ÿå¤„ç†ä½ çš„æ•°æ®ã€‚è¿™äº›å°ç¨‹åºå«åšç€è‰²å™¨(Shader)</strong>ã€‚</p><p>åŒ…æ‹¬é¡¶ç‚¹ç€è‰²å™¨ç­‰ç­‰</p><h4 id="VAO"><a href="#VAO" class="headerlink" title="VAO"></a>VAO</h4><p>é¡¶ç‚¹æ•°ç»„å¯¹è±¡(åˆç§° VAO)å¯ä»¥åƒé¡¶ç‚¹ç¼“å†²åŒºå¯¹è±¡ä¸€æ ·ç»‘å®š,æ­¤åçš„é¡¶ç‚¹å±æ€§è°ƒç”¨éƒ½å°†å­˜å‚¨åœ¨ VAO ä¸­.</p><h3 id="ä¹¦ç±å’Œç½‘ç«™æ¨è"><a href="#ä¹¦ç±å’Œç½‘ç«™æ¨è" class="headerlink" title="ä¹¦ç±å’Œç½‘ç«™æ¨è"></a>ä¹¦ç±å’Œç½‘ç«™æ¨è</h3><p><strong>è§£é¢˜å‚è€ƒ</strong></p><p><a href="https://www.cnblogs.com/lawliet12/p/17719365.html">Games101ç°ä»£è®¡ç®—æœºå›¾å½¢å­¦å…¥é—¨ - ä½œä¸š1~8 é›†åˆå«æé«˜é¡¹æ€»ç»“ - lawliet9 - åšå®¢å›­ (cnblogs.com)</a></p><p><strong>ä¹¦ç±</strong></p><ol><li>Fundamentals of Computer Graphics<a href="https://github.com/FCG-Translators/FundamentalsOfComputerGraphics-CN">FCG-Translators/FundamentalsOfComputerGraphics-CN: è®¡ç®—æœºå›¾å½¢å­¦åŸºç¡€ï¼ˆä¸­æ–‡è¯‘æœ¬ï¼‰ (github.com)</a></li><li><a href="https://book.douban.com/subject/35221845/">OpenGLè¶…çº§å®å…¸ï¼ˆç¬¬7ç‰ˆï¼‰ (è±†ç“£) (douban.com)</a></li></ol><p><strong>ç½‘ç«™</strong></p><ol><li><a href="https://learnopengl.com/">Learn OpenGL, extensive tutorial resource for learning Modern OpenGL</a></li><li><a href="https://www.scratchapixel.com/">Scratchapixel 4.0, Learn Computer Graphics Programming</a></li><li><a href="https://ogldev.org/">OpenGL Step by Step - OpenGL Development (ogldev.org)</a></li><li><a href="https://cs184.eecs.berkeley.edu/">https://cs184.eecs.berkeley.edu/</a></li><li><a href="http://15462.courses.cs.cmu.edu/fall2022/">15-462/662 Fall 2022 (cmu.edu)</a></li></ol><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;p&gt;ç®€ç®€å•å•å­¦ä¸ªæ¦‚å¿µ.&lt;br&gt;</summary>
    
    
    
    
  </entry>
  
  <entry>
    <title>æµè§ˆå™¨ç®€å•JSé€†å‘Tricks</title>
    <link href="https://www.sekyoro.top/2024/05/03/%E6%B5%8F%E8%A7%88%E5%99%A8%E7%AE%80%E5%8D%95JS%E9%80%86%E5%90%91Tricks/"/>
    <id>https://www.sekyoro.top/2024/05/03/%E6%B5%8F%E8%A7%88%E5%99%A8%E7%AE%80%E5%8D%95JS%E9%80%86%E5%90%91Tricks/</id>
    <published>2024-05-03T12:10:56.000Z</published>
    <updated>2024-05-06T15:08:52.879Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>å› ä¸ºå¹³å¸¸ä¼šæ¥è§¦ä¸€äº›Webé€†å‘ä¸€äº›APIå•¥çš„,å­¦ä¹ ä¸€äº›åŸºæœ¬çš„æµè§ˆå™¨Debugèƒ½åŠ›ä»¥åŠä¸€äº›å®æˆ˜.è¿™äº›çŸ¥è¯†å¯èƒ½æ¯”è¾ƒæ•£ç¢ä¸å¤Ÿç³»ç»Ÿ.<br><span id="more"></span></p><p>ç›®å‰æµè§ˆå™¨JSé€†å‘åœ¨å›½å†…çš„æ•™ç¨‹éƒ½å¤ªæ•£äº†,è€Œä¸”å¾ˆå¤šäººæ•™çš„å¹¶ä¸å¥½.æˆ‘è¿™é‡Œåˆ†ä¸€äº›åŸºç¡€å·¥å…·ä½¿ç”¨,å¸¸é‡åˆ°çš„é€†å‘é—®é¢˜å’Œå®æˆ˜, ä¸å®šæœŸæ›´æ–°.æ³¨æ„,è¿™é‡Œçš„é€†å‘å¹¶ä¸æ˜¯é€†å‘å¯æ‰§è¡Œç¨‹åº.</p><h2 id="æµè§ˆå™¨å¼€å‘å·¥å…·åŸºæœ¬ä½¿ç”¨"><a href="#æµè§ˆå™¨å¼€å‘å·¥å…·åŸºæœ¬ä½¿ç”¨" class="headerlink" title="æµè§ˆå™¨å¼€å‘å·¥å…·åŸºæœ¬ä½¿ç”¨"></a>æµè§ˆå™¨å¼€å‘å·¥å…·åŸºæœ¬ä½¿ç”¨</h2><p>F12å¼€å‘è€…å·¥å…·æ˜¯Webé€†å‘æœ€å¸¸ç”¨çš„,ç”¨è°·æ­Œæˆ–è€…Edgeæµè§ˆå™¨çš„å¼€å‘è€…å·¥å…·éƒ½æ¯”è¾ƒå¼ºå¤§,åŠŸèƒ½å¾ˆå¤š.</p><p>ä¸»è¦å…³æ³¨XHRæ–­ç‚¹,æ‰‹åŠ¨æ–­ç‚¹debug,DOMäº‹ä»¶,æŸ¥çœ‹å †æ ˆå‡½æ•°,ä»¥åŠä½¿ç”¨è‡ªå·±ä»£ç è¿›è¡Œè¦†ç›–æ“ä½œ.</p><p><a href="https://mp.weixin.qq.com/s?__biz=MzIwNDI1NjUxMg%3D%3D&amp;chksm=8d314fc8ba46c6de5e29f6001a7a9a3fd7705a16ec37bd77cf0f975d323fe91ce36017f8ee65&amp;idx=2&amp;mid=2651261863&amp;scene=21&amp;sn=1b8045af007d91be759d11c13d3844f0#wechat_redirect">Chromeè°ƒè¯•å·¥å…·å¸¸ç”¨åŠŸèƒ½æ•´ç† (qq.com)</a></p><p>ä¸€äº›å¸¸ç”¨æŠ€å·§<a href="https://www.52pojie.cn/thread-1160287-1-1.html">jsé€†å‘æŠ€å·§åˆ†äº« - ã€è„±å£³ç ´è§£åŒºã€ - å¾çˆ±ç ´è§£ - LCG - LSG |å®‰å“ç ´è§£|ç—…æ¯’åˆ†æ|www.52pojie.cn</a></p><p><a href="https://zhuanlan.zhihu.com/p/108207751#:~:text=jsé€†å‘æŠ€å·§åˆ†äº« 1 1. æœç´¢ 2 2. debug 3,å†™jsä»£ç  7 7. æ‰“å°windowså¯¹è±¡çš„å€¼ 8 8. å‹¾å­ æ›´å¤šé¡¹ç›®">jsé€†å‘æŠ€å·§åˆ†äº« - çŸ¥ä¹ (zhihu.com)</a></p><h2 id="é€šå¸¸é‡åˆ°çš„é—®é¢˜"><a href="#é€šå¸¸é‡åˆ°çš„é—®é¢˜" class="headerlink" title="é€šå¸¸é‡åˆ°çš„é—®é¢˜"></a>é€šå¸¸é‡åˆ°çš„é—®é¢˜</h2><h3 id="æ— é™Debugger"><a href="#æ— é™Debugger" class="headerlink" title="æ— é™Debugger"></a>æ— é™Debugger</h3><p><a href="https://cloud.tencent.com/developer/article/1986399">åŸåˆ›ä¸¨JavaScript é€†å‘è¿‡ç¨‹ä¸­æ— é™ Debug çš„ç»•è¿‡æ–¹æ¡ˆ-è…¾è®¯äº‘å¼€å‘è€…ç¤¾åŒº-è…¾è®¯äº‘ (tencent.com)</a></p><p><a href="https://blog.csdn.net/freeking101/article/details/116652656">JS é€†å‘ â€”- è¿‡æ— é™debuggeã€hookã€jsæ··æ·†è¿˜åŸã€æ§åˆ¶æµæ··æ·†_hookæ— çº¿debug-CSDNåšå®¢</a></p><p>æ‰“å¼€å¼€å‘è€…å·¥å…·å°±å¡ä½.</p><h3 id="ASTè§£æ··æ·†"><a href="#ASTè§£æ··æ·†" class="headerlink" title="ASTè§£æ··æ·†"></a>ASTè§£æ··æ·†</h3><p><a href="https://www.bilibili.com/video/BV1Jz4y1M799?p=2&amp;vd_source=177ef88aa6608bc3652c72d71b0aa098">ASTåŸºç¡€çŸ¥è¯†_å“”å“©å“”å“©_bilibili</a></p><h3 id="è§£å¯†"><a href="#è§£å¯†" class="headerlink" title="è§£å¯†"></a>è§£å¯†</h3><p>åªè¦çŸ¥é“åŠ å¯†æ–¹å¼å°±ä¸éš¾äº†,åŠ å¯†æ–¹å¼ä¸€èˆ¬</p><ul><li>çº¿æ€§æ•£åˆ—ç®—æ³•ï¼ˆç­¾åç®—æ³•)MD5</li><li>å¯¹ç§°æ€§åŠ å¯†ç®—æ³•AES DES</li><li>éå¯¹ç§°æ€§åŠ å¯†ç®—æ³• RSA</li></ul><p><a href="https://blog.csdn.net/qq_44159028/article/details/121732881">jsé€†å‘ä¹‹åŠ å¯†ç®—æ³•ä»‹ç»_jsåŠ å¯†é€†å‘-CSDNåšå®¢</a></p><p><a href="https://blog.csdn.net/Ig_thehao/article/details/119104016">å¯¹äºjsé€†å‘è¿‡ç¨‹ä¸­å¯¹åŠ å¯†æ–¹å¼è¯†åˆ«çš„å°æŠ€å·§_æ€ä¹ˆçœ‹å¯†æ–‡æ˜¯å¦aes-CSDNåšå®¢</a></p><p><a href="http://littleshark.space/2023/07/08/JSé€†å‘ç¬”è®°/JSé€†å‘å­¦ä¹ ---åŠ å¯†ç®—æ³•æ¢³ç†/#æ‘˜è¦ç®—æ³•">JSé€†å‘â€”-åŠ å¯†ç®—æ³• | LittleSharkâ€™s Space</a></p><h3 id="Webpackæ‰“åŒ…åçš„ç½‘ç«™"><a href="#Webpackæ‰“åŒ…åçš„ç½‘ç«™" class="headerlink" title="Webpackæ‰“åŒ…åçš„ç½‘ç«™"></a>Webpackæ‰“åŒ…åçš„ç½‘ç«™</h3><p>ç›®å‰æ‰“åŒ…æœ‰Vite,webpackç­‰ç­‰,ä¸åŒçš„æ‰“åŒ…æ¡†æ¶å¾—åˆ°çš„ç½‘ç«™ä»£ç è¿˜ä¸ä¸€æ ·.</p><p><a href="http://littleshark.space/2023/07/09/JSé€†å‘ç¬”è®°/JSé€†å‘å­¦ä¹ ---webpackæŠ€æœ¯/">JSé€†å‘â€”-webpackæŠ€æœ¯ | LittleSharkâ€™s Space</a></p><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ol><li><a href="https://scrapecrow.com/reverse-engineering-intro.html">Scrapecrow - Introduction To Reverse Engineering The Web</a></li></ol><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;p&gt;å› ä¸ºå¹³å¸¸ä¼šæ¥è§¦ä¸€äº›Webé€†å‘ä¸€äº›APIå•¥çš„,å­¦ä¹ ä¸€äº›åŸºæœ¬çš„æµè§ˆå™¨Debugèƒ½åŠ›ä»¥åŠä¸€äº›å®æˆ˜.è¿™äº›çŸ¥è¯†å¯èƒ½æ¯”è¾ƒæ•£ç¢ä¸å¤Ÿç³»ç»Ÿ.&lt;br&gt;</summary>
    
    
    
    
  </entry>
  
  <entry>
    <title>ä»è®ºæ–‡ä¸­çœ‹AIç»˜ç”»(ä¸€)</title>
    <link href="https://www.sekyoro.top/2024/05/02/%E4%BB%8E%E8%AE%BA%E6%96%87%E4%B8%AD%E7%9C%8BAI%E7%BB%98%E7%94%BB(%E4%B8%80)/"/>
    <id>https://www.sekyoro.top/2024/05/02/%E4%BB%8E%E8%AE%BA%E6%96%87%E4%B8%AD%E7%9C%8BAI%E7%BB%98%E7%94%BB(%E4%B8%80)/</id>
    <published>2024-05-02T12:25:08.000Z</published>
    <updated>2024-06-18T09:42:30.886Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>ä¸»è¦çœ‹æ˜¯çœ‹Diffusion Models,CLIP,ControlNet,IP-Adapterè¿™ç§ç»å…¸è®ºæ–‡,å°è¯•æ€»ç»“è®ºæ–‡å†™ä½œçš„ä¸€äº›æ–¹å¼ä»¥åŠå›¾åƒç”Ÿæˆæ¨¡å‹çš„ä¸€äº›å†…åœ¨æ€æƒ³. å¯¹äºå…¶ä¸­çš„æ•°å­¦åŸç†å’Œä»£ç ä¸è¿‡æ·±ç©¶.<br><span id="more"></span></p><h3 id="DDPM"><a href="#DDPM" class="headerlink" title="DDPM"></a>DDPM</h3><p>ä½¿ç”¨æ‰©æ•£æ¨¡å‹å¾—åˆ°é«˜è´¨é‡å›¾åƒ,è¯æ˜äº†è¿™ç§æ–¹æ³•åœ¨è®­ç»ƒæ—¶ä¸å¤šç§å™ªå£°ç­‰çº§ä¸‹çš„å»å™ªåˆ†æ•°ç­‰åŒ,åœ¨é‡‡æ ·æ—¶ä¸é€€ç«æœ—æ–‡åŠ¨åŠ›å­¦ç­‰ä»·.</p><p><img data-src="https://proanimer-img.oss-cn-shanghai.aliyuncs.com/alimg/image-20240503150540112.png" alt="image-20240503150540112"></p><p>æœ‰forward precesså’Œreversed process,</p><p><img data-src="https://proanimer-img.oss-cn-shanghai.aliyuncs.com/alimg/image-20240503152315412.png" alt="image-20240503152315412"></p><p>å¯¹äºæ­£å‘è¿‡ç¨‹,å°±æ˜¯å¯¹å›¾åƒçš„ä¸€ä¸ªåŠ å™ªè¿‡ç¨‹, é€†å‘è¿‡ç¨‹éœ€è¦é€šè¿‡ç¥ç»ç½‘ç»œæ‹Ÿåˆ,è®ºæ–‡ä¸­æ²¡æœ‰è€ƒè™‘æ–¹å·®.</p><p><img data-src="https://proanimer-img.oss-cn-shanghai.aliyuncs.com/alimg/image-20240503164248521.png" alt="image-20240503164248521"></p><p><img data-src="https://proanimer-img.oss-cn-shanghai.aliyuncs.com/alimg/image-20240503164900128.png" alt="image-20240503164900128"></p><p>ä½¿ç”¨äº†é‡å‚æ•°åŒ–,ç±»ä¼¼VAEä¸­çš„æ€æƒ³.åœ¨åŠ å™ªå£°æ—¶,é€šè¿‡ä½¿ç”¨é«˜æ–¯å™ªå£°å’Œå‡å€¼ã€æ–¹å·®.</p><p><img data-src="https://proanimer-img.oss-cn-shanghai.aliyuncs.com/alimg/image-20240503174343480.png" alt="image-20240503174343480" style="zoom:67%;" /></p><p>è¿™æ ·åªè¦çŸ¥é“x_0ä»¥åŠè¶…å‚æ•°Î±å’ŒÎ²å°±èƒ½å¾—åˆ°åé¢åŠ å™ªçš„æ•°æ®.è®¡ç®—æ¦‚ç‡å¯†åº¦å‡½æ•°</p><p><img data-src="https://proanimer-img.oss-cn-shanghai.aliyuncs.com/alimg/image-20240503180338927.png" alt="image-20240503180338927" style="zoom: 80%;" /></p><p>å¯¹äºä¼˜åŒ–ç›®æ ‡,éœ€è¦è®©på’Œqçš„åˆ†å¸ƒå°½é‡æ¥è¿‘,ç›¸å½“äºè®©å‡å€¼å’Œæ–¹å·®ç±»ä¼¼.</p><script type="math/tex; mode=display">\sum_{t=2}^TE_{q(x_t|x_0)}[D_{KL}(q(x_{t-1}|x_t,x_0)||p_\theta(x_{t-1}|x_t)]</script><p>è€Œæ–¹å·®æ˜¯å®šå€¼,å¯¹äºå‡å€¼</p><script type="math/tex; mode=display">\begin{aligned}\mu_{q}& =\frac{\sqrt{\bar{\alpha}_{t-1}}\beta_{t}x_{0}+\sqrt{\alpha_{t}}(1-\bar{\alpha}_{t-1})x_{t}}{1-\bar{\alpha}_{t}}  \\&=\frac{\sqrt{\bar{\alpha}_{t-1}}\beta_{t}\frac{x_{t}-\sqrt{1-\bar{\alpha}_{t}}\epsilon}{\sqrt{\bar{\alpha}_{t}}}+\sqrt{\alpha_{t}}(1-\bar{\alpha}_{t-1})x_{t}}{1-\bar{\alpha}_{t}} \\&=\frac{1}{\sqrt{\alpha_{t}}}(x_{t}-\frac{1-\alpha_{t}}{\sqrt{1-\bar{\alpha}_{t}}}\epsilon)\end{aligned}</script><p>æ¨¡å‹ä½¿ç”¨äº†Unetå’Œattention,æ®‹å·®è¿æ¥é¢„æµ‹å™ªå£°.å¾—åˆ°å™ªå£°åå¯ä»¥å¾—åˆ°$p<em>\theta(x</em>{t-1}|x_t)$</p><script type="math/tex; mode=display">x_{t-1}=\frac{1}{\sqrt{\alpha_{t}}}(x_{t}-\frac{1-\alpha_{t}}{\sqrt{1-\bar{\alpha}_{t}}}\epsilon_{\theta})+\sigma_{q}z</script><p>è®ºæ–‡<a href="http://arxiv.org/abs/2006.11239">http://arxiv.org/abs/2006.11239</a> <a href="https://zhuanlan.zhihu.com/p/650394311">æ·±å…¥æµ…å‡ºæ‰©æ•£æ¨¡å‹(Diffusion Model)ç³»åˆ—ï¼šåŸºçŸ³DDPMï¼ˆäººäººéƒ½èƒ½çœ‹æ‡‚çš„æ•°å­¦åŸç†ç¯‡ï¼‰ - çŸ¥ä¹ (zhihu.com)</a></p><h3 id="Improved-DDPM"><a href="#Improved-DDPM" class="headerlink" title="Improved DDPM"></a>Improved DDPM</h3><p>å¯¹DDPMåšäº†æ”¹è¿›.</p><ul><li>å­¦ä¹ æ–¹å·®ä¼šè®©ç”Ÿæˆæ•ˆæœæ›´å¥½ï¼ˆDDPM ä¸­åªå­¦ä¹ äº†å‡å€¼ï¼Œæ–¹å·®æ˜¯ä¸€ä¸ªå¸¸æ•°ï¼‰</li><li>æå‡ºäº†ä½™å¼¦åŠ å™ªæ–¹æ³•ï¼Œæ¯”çº¿æ€§åŠ å™ªæ•ˆæœæ›´å¥½</li></ul><p><img data-src="https://proanimer-img.oss-cn-shanghai.aliyuncs.com/alimg/image-20240503192352123.png" alt="image-20240503192352123"></p><h3 id="DDIM-2020"><a href="#DDIM-2020" class="headerlink" title="DDIM 2020"></a>DDIM 2020</h3><p>ä¸ºäº†åŠ å¿«é‡‡æ ·é€Ÿåº¦ï¼Œæå‡ºäº†å»å™ªæ‰©æ•£éšå«æ¨¡å‹ï¼ˆDDIMsï¼‰ï¼Œè¿™æ˜¯ä¸€ç±»æ›´æœ‰æ•ˆçš„è¿­ä»£éšå«æ¦‚ç‡æ¨¡å‹ï¼Œå…¶è®­ç»ƒè¿‡ç¨‹ä¸ DDPMs ç›¸åŒã€‚åœ¨ DDPMs ä¸­ï¼Œç”Ÿæˆè¿‡ç¨‹è¢«å®šä¹‰ä¸ºç‰¹å®šé©¬å°”å¯å¤«æ‰©æ•£è¿‡ç¨‹çš„åå‘ã€‚</p><p>æˆ‘ä»¬é€šè¿‡ä¸€ç±»èƒ½å®ç°ç›¸åŒè®­ç»ƒç›®æ ‡çš„éé©¬å°”å¯å¤«æ‰©æ•£è¿‡ç¨‹æ¥æ¨å¹¿ DDPMã€‚è¿™äº›éé©¬å°”å¯å¤«è¿‡ç¨‹å¯ä»¥å¯¹åº”äºç¡®å®šæ€§çš„ç”Ÿæˆè¿‡ç¨‹ï¼Œä»è€Œäº§ç”Ÿèƒ½æ›´å¿«åœ°ç”Ÿæˆé«˜è´¨é‡æ ·æœ¬çš„éšå¼æ¨¡å‹ã€‚</p><p><img data-src="https://proanimer-img.oss-cn-shanghai.aliyuncs.com/alimg/image-20240503193245982.png" alt="image-20240503193245982"></p><p><a href="https://zeqiang-lai.github.io/blog/posts/ai/ddim/">å…³äº DDIM é‡‡æ ·ç®—æ³•çš„æ¨å¯¼ | Zeâ€™s Blog (zeqiang-lai.github.io)</a></p><p>ä¸Šé¢ä¸‰ä¸ªæ•°å­¦å…¬å¼æ¶‰åŠæ¯”è¾ƒå¤š,æ¯”è¾ƒåå­¦æœ¯,æˆ‘çš„ç›®çš„æ˜¯æƒ³ä»‹ç»ä¸€ä¸ªè„‰ç»œå’ŒæŠ½è±¡çš„æ¦‚å¿µå’Œä½œç”¨,ä½¿å¾—ä½¿ç”¨ä¸€äº›å¼€æºAIç»˜ç”»è¿™ç±»åº”ç”¨æ—¶æ›´åŠ å¾—å¿ƒåº”æ‰‹,ä¸‹é¢æ›´å¤šæ¶‰åŠåˆ°ä¸€äº›AIç»˜ç”»åŠŸèƒ½å±‚é¢ä¸Šçš„ä¸œè¥¿.</p><p><img data-src="https://maciejdomagala.github.io/assets/images/Screenshot_2022-05-31_at_13.31.46.png" alt="img"></p><h3 id="Latent-Diffusion-Models-2022"><a href="#Latent-Diffusion-Models-2022" class="headerlink" title="Latent Diffusion Models 2022"></a>Latent Diffusion Models 2022</h3><blockquote><p>Stable Diffusionäº§å“çš„èƒŒåæ¨¡å‹</p></blockquote><p>å°†å›¾åƒå½¢æˆè¿‡ç¨‹åˆ†è§£ä¸ºä¸€ç³»åˆ—å»å™ªè‡ªç¼–ç å™¨çš„é¡ºåºåº”ç”¨ï¼Œæ‰©æ•£æ¨¡å‹ï¼ˆDMsï¼‰åœ¨å›¾åƒæ•°æ®åŠæ›´å¹¿æ³›èŒƒå›´å†…å®ç°äº†æœ€å…ˆè¿›çš„åˆæˆç»“æœã€‚æ­¤å¤–ï¼Œå®ƒä»¬çš„è¡¨è¾¾å…è®¸ä¸€ç§å¼•å¯¼æœºåˆ¶æ¥æ§åˆ¶å›¾åƒç”Ÿæˆè¿‡ç¨‹è€Œæ— éœ€é‡æ–°è®­ç»ƒã€‚ç„¶è€Œï¼Œç”±äºè¿™äº›æ¨¡å‹é€šå¸¸ç›´æ¥åœ¨åƒç´ ç©ºé—´ä¸­æ“ä½œï¼Œä¼˜åŒ–å¼ºå¤§çš„DMsé€šå¸¸éœ€è¦æ¶ˆè€—æ•°ç™¾ä¸ªGPUå¤©,è®ºæ–‡æå‡ºçš„æ–¹æ³•å°†å®ƒä»¬åœ¨latent spaceä¸­è¿›è¡Œå¹¶ä½¿ç”¨é¢„è®­ç»ƒçš„autoencoder.å¹¶ä½¿ç”¨äº†cross-attentionç»“æ„,ç°åœ¨çœ‹æ¥ä¹Ÿæ˜¯éå¸¸ç»å…¸äº†.</p><p><img data-src="https://proanimer-img.oss-cn-shanghai.aliyuncs.com/alimg/image-20240503210656442.png" alt="image-20240503210656442"></p><script type="math/tex; mode=display">\mathrm{Attention}(Q,K,V)=\mathrm{softmax}\left(\frac{QK^{T}}{\sqrt{d}}\right)\cdot V\\Q=W_Q^{(i)}\cdot\varphi_i(z_t),K=W_K^{(i)}\cdot\tau_\theta(y),V=W_V^{(i)}\cdot\tau_\theta(y)</script><script type="math/tex; mode=display">L_{DM}=\mathbb{E}_{x,\epsilon\sim\mathcal{N}(0,1),t}\Big[\|\epsilon-\epsilon_\theta(x_t,t)\|_2^2\Big] \\L_{LDM}:=\mathbb{E}_{\mathcal{E}(x),y,\epsilon\sim\mathcal{N}(0,1),t}\Big[\|\epsilon-\epsilon_\theta(z_t,t,\tau_\theta(y))\|_2^2\Big]</script><h3 id="CLIP-2021"><a href="#CLIP-2021" class="headerlink" title="CLIP 2021"></a>CLIP 2021</h3><blockquote><p>OpenAIç”¨äºDALLEçš„æ–‡å­—ä¸å›¾åƒåŒ¹é…  åˆ©ç”¨ä¸åŒçš„encoderså°†æ–‡å­—å’Œå›¾åƒè”ç³»äº†èµ·æ¥</p></blockquote><p>è®¡ç®—æœºè§†è§‰ç³»ç»Ÿç»è¿‡è®­ç»ƒå¯ä»¥é¢„æµ‹ä¸€ç»„å›ºå®šçš„é¢„å®šå¯¹è±¡ç±»åˆ«ã€‚è¿™ç§å—é™çš„ç›‘ç£å½¢å¼é™åˆ¶äº†å…¶é€šç”¨æ€§å’Œå¯ç”¨æ€§ï¼Œå› ä¸ºè¦æŒ‡å®šä»»ä½•å…¶ä»–è§†è§‰æ¦‚å¿µï¼Œéƒ½éœ€è¦é¢å¤–çš„æ ‡è®°æ•°æ®ã€‚</p><p><img data-src="https://proanimer-img.oss-cn-shanghai.aliyuncs.com/alimg/image-20240503203723416.png" alt="image-20240503203723416"  /></p><p>ä¸»è¦æ˜¯è§£å†³åˆ©ç”¨æ–‡æœ¬ä¿¡æ¯ç›‘ç£å›¾åƒ,å¹¶å®ç°zero-shot transfer.</p><p><img data-src="https://proanimer-img.oss-cn-shanghai.aliyuncs.com/alimg/image-20240503204548844.png" alt="image-20240503204548844" style="zoom:67%;" /></p><h3 id="ControlNet-2023"><a href="#ControlNet-2023" class="headerlink" title="ControlNet 2023"></a>ControlNet 2023</h3><blockquote><p>å¼€åˆ›æ€§çš„æœ‰ä»·å€¼çš„å·¥ä½œ,ä½¿ç”¨pose,edge maps,segmentation mapä½œä¸ºç›‘ç£ä¿¡æ¯æ§åˆ¶å›¾åƒå¸ƒå±€.  æŠ€æœ¯ä¸Šåˆ©ç”¨å¾®è°ƒæŠ€æœ¯å¹¶åˆ©ç”¨é¢å¤–çš„poseç­‰ä¿¡æ¯å¼•å¯¼å›¾åƒç”Ÿæˆ.</p></blockquote><p>Adding Conditional Control to Text-to-Image Diffusion Models</p><p>éšç€æ–‡å­—åˆ°å›¾åƒæ‰©æ•£æ¨¡å‹çš„å‡ºç°ï¼Œæˆ‘ä»¬ç°åœ¨åªéœ€è¾“å…¥æ–‡å­—æç¤ºï¼Œå°±èƒ½åˆ›ä½œå‡ºè§†è§‰æ•ˆæœæä½³çš„å›¾åƒã€‚</p><p>ç„¶è€Œï¼Œæ–‡æœ¬åˆ°å›¾åƒæ¨¡å‹å¯¹å›¾åƒç©ºé—´æ„æˆçš„æ§åˆ¶èƒ½åŠ›æœ‰é™ï¼›ä»…é æ–‡æœ¬æç¤ºå¾ˆéš¾ç²¾ç¡®è¡¨è¾¾å¤æ‚çš„å¸ƒå±€ã€å§¿åŠ¿ã€å½¢çŠ¶å’Œå½¢æ€ã€‚è¦ç”Ÿæˆä¸æˆ‘ä»¬çš„å¿ƒç†æƒ³è±¡ç²¾ç¡®åŒ¹é…çš„å›¾åƒï¼Œå¾€å¾€éœ€è¦åå¤ç¼–è¾‘æç¤ºã€æ£€æŸ¥ç”Ÿæˆçš„å›¾åƒï¼Œç„¶åé‡æ–°ç¼–è¾‘æç¤ºã€‚</p><p>ControlNetåˆ©ç”¨äº†å¾®è°ƒæŠ€æœ¯,å†»ç»“åŸå§‹å—,ç„¶åä½¿ç”¨åŸæœ¬çš„æƒé‡å¤„ç†é¢å¤–ä¿¡æ¯c,cé€šè¿‡<strong>é›¶å·ç§¯</strong>å†åŠ å›å»å¾—åˆ°$y^{c}$</p><p><img data-src="https://proanimer-img.oss-cn-shanghai.aliyuncs.com/alimg/image-20240503224707489.png" alt="image-20240503224707489"></p><p>ä¸ºäº†ç»™è¿™æ ·ä¸€ä¸ªé¢„è®­ç»ƒçš„ç¥ç»å—æ·»åŠ ä¸€ä¸ªcontrolnetç½‘ç»œï¼Œé”å®š(å†»ç»“)åŸå§‹å—çš„å‚æ•°Î˜ï¼ŒåŒæ—¶å°†è¯¥å—å…‹éš†åˆ°ä¸€ä¸ªå‚æ•°ä¸ºÎ˜cçš„å¯è®­ç»ƒæ‹·è´</p><p><img data-src="https://proanimer-img.oss-cn-shanghai.aliyuncs.com/alimg/image-20240503225434997.png" alt="image-20240503225434997"></p><p>å¯è®­ç»ƒå‰¯æœ¬ä»¥å¤–éƒ¨æ¡ä»¶å‘é‡cä½œä¸ºè¾“å…¥ã€‚å½“è¿™ç§ç»“æ„åº”ç”¨äºè¯¸å¦‚ç¨³å®šæ‰©æ•£( Stable Diffusion )è¿™æ ·çš„å¤§å‹æ¨¡å‹æ—¶ï¼Œé”å®šçš„å‚æ•°ä¿ç•™äº†ç”¨æ•°åäº¿å¼ å›¾åƒè®­ç»ƒçš„ç”Ÿäº§å°±ç»ªæ¨¡å‹ï¼Œè€Œå¯è®­ç»ƒçš„å‰¯æœ¬åˆ™é‡ç”¨äº†è¿™ç§å¤§è§„æ¨¡é¢„è®­ç»ƒçš„æ¨¡å‹ï¼Œä»¥å»ºç«‹å¤„ç†å„ç§è¾“å…¥æ¡ä»¶çš„æ·±åº¦ã€é²æ£’å’Œå¼ºå¤§çš„éª¨å¹²ã€‚</p><script type="math/tex; mode=display">y_{\mathfrak{c}}=\mathcal{F}(x;\Theta)+\mathcal{Z}(\mathcal{F}(x+\mathcal{Z}(c;\Theta_{\mathfrak{z}1});\Theta_{\mathfrak{c}});\Theta_{\mathfrak{z}2})</script><p>è®­ç»ƒç›®æ ‡</p><script type="math/tex; mode=display">\mathcal{L}=\mathbb{E}_{\boldsymbol{z}_0,\boldsymbol{t},\boldsymbol{c}_t,\boldsymbol{c}_\mathrm{f},\epsilon\sim\mathcal{N}(0,1)}\left[\|\epsilon-\epsilon_\theta(\boldsymbol{z}_t,t,\boldsymbol{c}_t,\boldsymbol{c}_\mathrm{f}))\|_2^2\right]</script><p>åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ç”¨ç©ºå­—ç¬¦ä¸²éšæœºæ›¿æ¢50 %çš„æ–‡æœ¬æç¤ºctã€‚è¿™ç§æ–¹æ³•å¢åŠ äº†controlnetç½‘ç»œåœ¨è¾“å…¥æ¡ä»¶å›¾åƒ(ä¾‹å¦‚,è¾¹ç¼˜,å§¿æ€,æ·±åº¦ç­‰ã€‚)ä¸­ç›´æ¥è¯†åˆ«è¯­ä¹‰çš„èƒ½åŠ›ï¼Œä½œä¸ºæç¤ºçš„æ›¿ä»£ã€‚åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œç”±äºé›¶å·ç§¯ä¸ä¼šç»™ç½‘ç»œæ·»åŠ å™ªå£°ï¼Œæ‰€ä»¥æ¨¡å‹åº”è¯¥å§‹ç»ˆèƒ½å¤Ÿé¢„æµ‹é«˜è´¨é‡çš„å›¾åƒã€‚æˆ‘ä»¬è§‚å¯Ÿåˆ°ï¼Œæ¨¡å‹å¹¶æ²¡æœ‰é€æ­¥å­¦ä¹ æ§åˆ¶æ¡ä»¶ï¼Œè€Œæ˜¯çªç„¶æˆåŠŸåœ°è·Ÿéšè¾“å…¥æ¡ä»¶å›¾åƒï¼›é€šå¸¸åœ¨å°äº10Kçš„ä¼˜åŒ–æ­¥æ•°ã€‚</p><p>åœ¨inferenceéƒ¨åˆ†ä»‹ç»äº†CFGä»¥åŠç»„åˆå¤šä¸ªcontrolnet.</p><script type="math/tex; mode=display">\epsilon_{\mathrm{prd}}=\epsilon_{\mathrm{uc}}+\beta_{\mathrm{cfg}}(\epsilon_{\mathrm{c}}-\epsilon_{\mathrm{uc}})</script><h3 id="ANIMATEDIFF"><a href="#ANIMATEDIFF" class="headerlink" title="ANIMATEDIFF"></a>ANIMATEDIFF</h3><h4 id="æ‘˜è¦"><a href="#æ‘˜è¦" class="headerlink" title="æ‘˜è¦"></a>æ‘˜è¦</h4><p>ANIMATEDIFF: ANIMATE YOUR PERSONALIZED TEXT-TO-IMAGE DIFFUSION MODELS WITHOUT SPECIFIC TUNING</p><p>éšç€æ–‡æœ¬åˆ°å›¾åƒ( T2I )æ‰©æ•£æ¨¡å‹(ä¾‹å¦‚,ç¨³å®šæ‰©æ•£)å’Œç›¸åº”çš„ä¸ªæ€§åŒ–æŠ€æœ¯(å¦‚DreamBoothå’ŒLoRA )çš„å‘å±•ï¼Œæ¯ä¸ªäººéƒ½å¯ä»¥ä»¥å¯è´Ÿæ‹…çš„æˆæœ¬å°†è‡ªå·±çš„æƒ³è±¡åŠ›è¡¨ç°ä¸ºé«˜è´¨é‡çš„å›¾åƒã€‚ç„¶è€Œï¼Œåœ¨ç°æœ‰çš„é«˜è´¨é‡ä¸ªæ€§åŒ–T2Iä¸­æ·»åŠ è¿åŠ¨åŠ¨æ€å¹¶ä½¿å…¶èƒ½å¤Ÿç”ŸæˆåŠ¨ç”»ä»ç„¶æ˜¯ä¸€ä¸ªå¼€æ”¾çš„æŒ‘æˆ˜ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬æå‡ºäº†ä¸€ä¸ªå®ç”¨çš„æ¡†æ¶AnimateDiffï¼Œç”¨äºå¯¹ä¸ªæ€§åŒ–T2Iæ¨¡å‹è¿›è¡ŒåŠ¨ç”»ç”Ÿæˆï¼Œè€Œä¸éœ€è¦å¯¹æ¨¡å‹è¿›è¡Œç‰¹å®šçš„è°ƒæ•´ã€‚</p><p>åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬æå‡ºäº†ä¸€ä¸ªå®ç”¨çš„æ¡†æ¶AnimateDiffï¼Œç”¨äºå¯¹ä¸ªæ€§åŒ–T2Iæ¨¡å‹è¿›è¡ŒåŠ¨ç”»ç”Ÿæˆï¼Œè€Œä¸éœ€è¦å¯¹æ¨¡å‹è¿›è¡Œç‰¹å®šçš„è°ƒæ•´ã€‚</p><p>æˆ‘ä»¬çš„æ¡†æ¶çš„æ ¸å¿ƒæ˜¯ä¸€ä¸ªå³æ’å³ç”¨çš„è¿åŠ¨æ¨¡å—ï¼Œå®ƒå¯ä»¥è¢«è®­ç»ƒä¸€æ¬¡ï¼Œå¹¶æ— ç¼åœ°é›†æˆåˆ°ä»»ä½•æºè‡ªåŒä¸€åŸºç¡€T2Içš„ä¸ªæ€§åŒ–T2Iä¸­ã€‚é€šè¿‡æˆ‘ä»¬æå‡ºçš„è®­ç»ƒç­–ç•¥ï¼Œè¿åŠ¨æ¨¡å—æœ‰æ•ˆåœ°ä»çœŸå®ä¸–ç•Œçš„è§†é¢‘ä¸­å­¦ä¹ å¯è¿ç§»çš„è¿åŠ¨å…ˆéªŒã€‚</p><p>æˆ‘ä»¬è¿›ä¸€æ­¥æå‡ºäº†Motion LoRAï¼Œä¸€ç§é’ˆå¯¹Animate Diffçš„è½»é‡çº§å¾®è°ƒæŠ€æœ¯ï¼Œä½¿é¢„è®­ç»ƒçš„è¿åŠ¨æ¨¡å—èƒ½å¤Ÿä»¥è¾ƒä½çš„è®­ç»ƒå’Œæ•°æ®æ”¶é›†æˆæœ¬é€‚åº”æ–°çš„è¿åŠ¨æ¨¡å¼ï¼Œå¦‚ä¸åŒçš„é•œå¤´ç±»å‹ã€‚</p><p><img data-src="https://s2.loli.net/2024/06/17/Es5t6c4mouOVx9C.png" alt="image-20240617113711008"></p><h4 id="æ–¹æ³•"><a href="#æ–¹æ³•" class="headerlink" title="æ–¹æ³•"></a>æ–¹æ³•</h4><p>æ–¹æ³•æ ¸å¿ƒæ˜¯<strong>ä»è§†é¢‘æ•°æ®ä¸­å­¦ä¹ å¯ä»¥è¿ç§»çš„motionå…ˆéªŒçŸ¥è¯†</strong>,ç„¶å<strong>ç›´æ¥ç”¨åˆ°T2Iæ¨¡å‹</strong>ä¸­ä¸éœ€è¦ç‰¹åˆ«åœ°è°ƒæ•´.</p><p>åœ¨æ¨ç†æ—¶ï¼Œmotion module(è“è‰²)å’Œå¯é€‰çš„MotionLoRA (ç»¿è‰²)å¯ä»¥ç›´æ¥æ’å…¥åˆ°ä¸ªæ€§åŒ–çš„T2Iä¸­æ„æˆåŠ¨ç”»ç”Ÿæˆå™¨ï¼Œç„¶åé€šè¿‡è¿­ä»£å»å™ªè¿‡ç¨‹ç”ŸæˆåŠ¨ç”»</p><p><img data-src="https://s2.loli.net/2024/06/18/9tVrZlvaNJ57eYS.png" alt="image-20240618161328406"></p><p>åŒ…æ‹¬ä¸‰ä¸ªç»„ä»¶,å³domain adaptersã€motion moduleå’ŒMotion LoRAã€‚domain adapteråªåœ¨è®­ç»ƒæ—¶ä½¿ç”¨,ä»¥ç¼“è§£åŸºç¡€T2Ié¢„è®­ç»ƒæ•°æ®ä¸è§†é¢‘è®­ç»ƒæ•°æ®ä¹‹é—´çš„è§†è§‰åˆ†é…å·®è·æ‰€å¸¦æ¥çš„è´Ÿé¢å½±å“.motion moduleå­¦ä¹ è§†é¢‘çš„å…ˆéªŒçŸ¥è¯†ï¼›Motionloraæ˜¯ä¸ºäº†ä½¿é¢„å…ˆè®­ç»ƒå¥½çš„è¿åŠ¨æ¨¡å—é€‚åº”æ–°çš„è¿åŠ¨æ¨¡å¼,åœ¨ä¸€èˆ¬åŠ¨ç”»çš„æƒ…å†µä¸‹æ˜¯å¯é€‰çš„.</p><h5 id="å‡è½»è®­ç»ƒæ•°æ®å¸¦æ¥çš„å½±å“"><a href="#å‡è½»è®­ç»ƒæ•°æ®å¸¦æ¥çš„å½±å“" class="headerlink" title="å‡è½»è®­ç»ƒæ•°æ®å¸¦æ¥çš„å½±å“"></a>å‡è½»è®­ç»ƒæ•°æ®å¸¦æ¥çš„å½±å“</h5><p>ç”±äºé‡‡é›†å›°éš¾ï¼Œå…¬å¼€çš„è§†é¢‘è®­ç»ƒæ•°æ®é›†çš„è§†è§‰è´¨é‡è¿œä½äºå›¾åƒæ•°æ®é›†ã€‚ä¾‹å¦‚ï¼Œè§†é¢‘æ•°æ®é›†WebVid (è´æ©ç­‰, 2021)çš„å†…å®¹å¤šä¸ºçœŸå®ä¸–ç•Œçš„å½•éŸ³ï¼Œè€Œå›¾åƒæ•°æ®é›†LAIONAesthetic (èˆ’æ›¼ç­‰, 2022)åŒ…å«äº†æ›´é«˜è´¨é‡çš„å†…å®¹ï¼ŒåŒ…æ‹¬è‰ºæœ¯ç»˜ç”»å’Œä¸“ä¸šæ‘„å½±ã€‚</p><p>æ­¤å¤–ï¼Œå½“å•ç‹¬ä½œä¸ºå›¾åƒå¤„ç†æ—¶ï¼Œæ¯ä¸ªè§†é¢‘å¸§å¯èƒ½åŒ…å«è¿åŠ¨æ¨¡ç³Šã€å‹ç¼©ä¼ªå½±å’Œæ°´å°ã€‚å› æ­¤ï¼Œç”¨äºè®­ç»ƒåŸºç¡€T2Içš„é«˜è´¨é‡å›¾åƒæ•°æ®é›†å’Œç”¨äºå­¦ä¹ è¿åŠ¨å…ˆéªŒçš„ç›®æ ‡è§†é¢‘æ•°æ®é›†ä¹‹é—´å­˜åœ¨ä¸å¯å¿½ç•¥çš„è´¨é‡åŸŸå·®è·ã€‚æˆ‘ä»¬è®¤ä¸º,<strong>å½“ç›´æ¥åœ¨åŸå§‹è§†é¢‘æ•°æ®ä¸Šè®­ç»ƒæ—¶,è¿™æ ·çš„å·®è·ä¼šé™åˆ¶åŠ¨ç”»ç”Ÿæˆæµæ°´çº¿çš„è´¨é‡</strong>ã€‚</p><p>ä¸ºäº†é¿å…å°†è¿™ç§è´¨é‡å·®å¼‚ä½œä¸ºæˆ‘ä»¬è¿åŠ¨æ¨¡å—çš„ä¸€éƒ¨åˆ†æ¥å­¦ä¹ ï¼Œå¹¶ä¿ç•™åŸºæœ¬T2Içš„çŸ¥è¯†ï¼Œæˆ‘ä»¬æå‡ºå°†åŸŸä¿¡æ¯æ‹Ÿåˆåˆ°ä¸€ä¸ªå•ç‹¬çš„ç½‘ç»œä¸­,ç§°ä¸ºåŸŸé€‚é…å™¨ã€‚æˆ‘ä»¬<strong>åœ¨æ¨ç†æ—¶ä¸¢å¼ƒäº†åŸŸé€‚é…å™¨ï¼Œå¹¶è¡¨æ˜è¿™ç§åšæ³•æœ‰åŠ©äºå‡å°‘ä¸Šè¿°åŸŸé—´éš™å¸¦æ¥çš„è´Ÿé¢å½±å“</strong>ã€‚æˆ‘ä»¬ç”¨LoRA ( Hu et al . , 2021)å®ç°äº†åŸŸé€‚é…å™¨å±‚ï¼Œå¹¶å°†å…¶æ’å…¥åˆ°åŸºç¡€T2Iä¸­çš„è‡ª/äº¤å‰æ³¨æ„åŠ›å±‚ä¸­</p><blockquote><p>å…ˆæ‹¿ä¸€ä¸ªadapterè®­ç»ƒæ—¶è°ƒæ•´åŸæœ¬ç½‘ç»œçš„å‚æ•°?<del> åŸæœ¬ç½‘ç»œå‚æ•°å¹¶æ²¡æœ‰è¢«freeze,</del>è¿™ä¹Ÿç®—ä¸ä¸Šå¾®è°ƒ, ç›¸å½“äºæŠŠè§†é¢‘åˆ†æˆä¸€å †ç…§ç‰‡(ä¸èƒ½è¿‡äºé‡å¤)ç„¶åé‡æ–°è®­ç»ƒ?</p></blockquote><script type="math/tex; mode=display">Q=\mathcal{W}^Qz+\text{AdapterLayer}(z)=\mathcal{W}^Qz+\alpha\cdot AB^Tz</script><p>å¼ä¸­ï¼šÎ± = 1ä¸ºæ ‡é‡ï¼Œå¯åœ¨inferenceæ—¶(è®¾ç½®ä¸º0 ,ä»¥å®Œå…¨æ¶ˆé™¤åŸŸé€‚é…å™¨çš„å½±å“)è°ƒæ•´ä¸ºå…¶ä»–å€¼ã€‚ç„¶åï¼Œæˆ‘ä»¬åœ¨Eqä¸­<strong>ä»å…·æœ‰ç›¸åŒç›®æ ‡çš„è§†é¢‘æ•°æ®é›†ä¸­éšæœºé‡‡æ ·çš„é™æ€å¸§</strong>ä¸Šåªä¼˜åŒ–åŸŸé€‚é…å™¨çš„å‚æ•°</p><h5 id="å­¦ä¹ è¿åŠ¨å…ˆéªŒ"><a href="#å­¦ä¹ è¿åŠ¨å…ˆéªŒ" class="headerlink" title="å­¦ä¹ è¿åŠ¨å…ˆéªŒ"></a>å­¦ä¹ è¿åŠ¨å…ˆéªŒ</h5><p>ä¸ºäº†åœ¨é¢„è®­ç»ƒçš„T2Iä¸Šå»ºæ¨¡æ²¿æ—¶é—´ç»´åº¦çš„è¿åŠ¨åŠ¨æ€ï¼Œå¿…é¡»1 )<strong>å°†äºŒç»´æ‰©æ•£æ¨¡å‹è†¨èƒ€ä»¥å¤„ç†ä¸‰ç»´è§†é¢‘æ•°æ®</strong>ï¼Œ2 )<strong>è®¾è®¡å­æ¨¡å—ä»¥å®ç°æ²¿æ—¶é—´è½´çš„æœ‰æ•ˆä¿¡æ¯äº¤æ¢</strong>ã€‚</p><p>åŸºT2Iæ¨¡å‹ä¸­çš„é¢„è®­ç»ƒå›¾åƒå±‚æ•è·äº†é«˜è´¨é‡çš„å†…å®¹å…ˆéªŒã€‚ä¸ºäº†åˆ©ç”¨è¿™äº›çŸ¥è¯†ï¼Œç½‘ç»œè†¨èƒ€çš„ä¸€ä¸ªè¾ƒå¥½çš„æ–¹æ³•æ˜¯<strong>è®©è¿™äº›å›¾åƒå±‚ç‹¬ç«‹åœ°å¤„ç†è§†é¢‘å¸§</strong>ã€‚ä¸ºäº†è¾¾åˆ°è¿™ä¸ªç›®çš„ï¼Œæˆ‘ä»¬é‡‡ç”¨äº†ç±»ä¼¼äºæœ€è¿‘å·¥ä½œçš„åšæ³•ï¼Œå¹¶ä¿®æ”¹æ¨¡å‹ï¼Œä½¿å…¶ä»¥5Dè§†é¢‘å¼ é‡xâˆˆR^bÃ—cÃ—fÃ—hÃ—w^ä½œä¸ºè¾“å…¥ï¼Œå…¶ä¸­bå’Œfåˆ†åˆ«ä»£è¡¨æ‰¹å¤„ç†è½´å’Œå¸§æ—¶è½´ã€‚</p><p>å½“å†…éƒ¨ç‰¹å¾å›¾ç»è¿‡å›¾åƒå±‚æ—¶ï¼Œ<strong>é€šè¿‡å°†æ—¶é—´è½´fé‡å¡‘ä¸ºbè½´è€Œå¿½ç•¥,å…è®¸ç½‘ç»œç‹¬ç«‹å¤„ç†æ¯ä¸€å¸§</strong>ã€‚ç„¶åï¼Œæˆ‘ä»¬åœ¨å›¾åƒå±‚ä¹‹åå°†ç‰¹å¾å›¾é‡å¡‘ä¸º5Då¼ é‡.</p><p>å¦ä¸€æ–¹é¢<strong>,æ–°æ’å…¥çš„è¿åŠ¨æ¨¡å—é€šè¿‡å°†hã€wæ•´å½¢ä¸ºb,ç„¶ååœ¨æ¨¡å—ä¹‹åå†æ•´å½¢å›æ¥,ä»è€Œå¿½ç•¥äº†ç©ºé—´è½´.</strong></p><blockquote><p>ä¹Ÿå°±æ˜¯åˆ©ç”¨è¿åŠ¨æ¨¡å—å¤„ç†æ•°æ®,è€Œæ•°æ®æœ¬èº«å…¶å®å°±æ˜¯reshapeæˆäº†(bxhxw,f,c). ä½¿ç”¨transfomerå¤„ç†è¿™æ ·çš„åºåˆ—.</p></blockquote><p>æœ€è¿‘å…³äºè§†é¢‘ç”Ÿæˆçš„å·¥ä½œå·²ç»æ¢ç´¢äº†è®¸å¤šæ—¶é—´å»ºæ¨¡çš„è®¾è®¡ã€‚åœ¨Animate Diffä¸­ï¼Œæˆ‘ä»¬é‡‡ç”¨äº†Transformeræ¶æ„ä½œä¸ºçš„è¿åŠ¨æ¨¡å—è®¾è®¡ï¼Œå¹¶å¯¹å…¶è¿›è¡Œäº†å¾®å°çš„ä¿®æ”¹ï¼Œä½¿å…¶èƒ½å¤Ÿæ²¿æ—¶é—´è½´è¿è¡Œï¼Œä¸‹é¢æˆ‘ä»¬å°†å…¶ç§°ä¸ºâ€temporal transofrmerâ€ã€‚</p><p>é€šè¿‡å®éªŒå‘ç°è¿™ç§è®¾è®¡å¯¹äºè¿åŠ¨å…ˆéªŒçš„å»ºæ¨¡æ˜¯è¶³å¤Ÿçš„ã€‚temporal transofrmerå™¨ç”±è‹¥å¹²ä¸ªæ²¿æ—¶é—´è½´çš„è‡ªæ³¨æ„åŠ›å—ç»„æˆï¼Œé‡‡ç”¨æ­£å¼¦ä½ç½®ç¼–ç ï¼Œ<strong>å¯¹åŠ¨ç”»ä¸­æ¯ä¸€å¸§çš„ä½ç½®è¿›è¡Œç¼–ç </strong>ã€‚è¿åŠ¨æ¨¡å—çš„è¾“å…¥æ˜¯å°†ç©ºé—´ç»´åº¦åˆå¹¶åˆ°æ‰¹å¤„ç†è½´ä¸­çš„é‡æ–°å¡‘é€ çš„ç‰¹å¾å›¾ã€‚å½“æˆ‘ä»¬å°†reshapeåçš„ç‰¹å¾å›¾æ²¿æ—¶é—´è½´è¿›è¡Œåˆ’åˆ†æ—¶ï¼Œå¯ä»¥å°†å…¶çœ‹ä½œé•¿åº¦ä¸ºfçš„å‘é‡åºåˆ—ï¼Œå³{ z1ï¼Œ..ï¼Œzf }ï¼›Z~i~âˆˆR^(bÃ—hÃ—w)Ã—c^ } .ç„¶åå°†è¿™äº›å‘é‡è¿›è¡ŒæŠ•å½±ï¼Œå¹¶é€šè¿‡å‡ ä¸ªè‡ªæ³¨æ„åŠ›å—.</p><script type="math/tex; mode=display">z_{out}=\mathrm{Attention}(Q,K,V)=\mathrm{Softmax}(QK^{T}/\sqrt{c})\cdot V</script><p>æ³¨æ„åŠ›æœºåˆ¶ä½¿å¾—å½“å‰å¸§çš„ç”Ÿæˆèƒ½å¤Ÿèåˆå…¶ä»–å¸§çš„ä¿¡æ¯ã€‚å› æ­¤ï¼Œä¸æˆ‘ä»¬çš„è¿åŠ¨æ¨¡å—ä¸€èµ·è†¨èƒ€çš„T2Iæ¨¡å‹ä¸æ˜¯å•ç‹¬ç”Ÿæˆæ¯ä¸€å¸§ï¼Œè€Œæ˜¯å­¦ä¹ æ•æ‰è§†è§‰å†…å®¹éšæ—¶é—´çš„å˜åŒ–ï¼Œè¿™äº›å˜åŒ–æ„æˆäº†åŠ¨ç”»ç‰‡æ®µä¸­çš„è¿åŠ¨åŠ¨æ€ã€‚</p><h5 id="ä½¿ç”¨motionloraé€‚åº”åˆ°æ–°çš„è¿åŠ¨æ¨¡å¼"><a href="#ä½¿ç”¨motionloraé€‚åº”åˆ°æ–°çš„è¿åŠ¨æ¨¡å¼" class="headerlink" title="ä½¿ç”¨motionloraé€‚åº”åˆ°æ–°çš„è¿åŠ¨æ¨¡å¼"></a>ä½¿ç”¨motionloraé€‚åº”åˆ°æ–°çš„è¿åŠ¨æ¨¡å¼</h5><p>åœ¨é¢„è®­ç»ƒçš„è¿åŠ¨æ¨¡å—æ•è·ä¸€èˆ¬è¿åŠ¨å…ˆéªŒçš„åŒæ—¶ï¼Œå½“æˆ‘ä»¬éœ€è¦ç”¨å°‘é‡çš„å‚è€ƒè§†é¢‘å’Œè®­ç»ƒè¿­ä»£æ¥æœ‰æ•ˆåœ°é€‚åº”æ–°çš„è¿åŠ¨æ¨¡å¼(å¦‚ç›¸æœºç¼©æ”¾ã€å¹³ç§»å’Œæ»šåŠ¨ç­‰)æ—¶ï¼Œå°±äº§ç”Ÿäº†ä¸€ä¸ªé—®é¢˜ã€‚<strong>è¿™ç§æ•ˆç‡å¯¹äºé‚£äº›æ— æ³•è´Ÿæ‹…æ˜‚è´µçš„é¢„è®­ç»ƒæˆæœ¬ä½†æƒ³è¦é’ˆå¯¹ç‰¹å®šæ•ˆæœå¯¹è¿åŠ¨æ¨¡å—è¿›è¡Œå¾®è°ƒçš„ç”¨æˆ·æ¥è¯´æ˜¯å¿…ä¸å¯å°‘çš„</strong>ã€‚</p><p>Animate Diffçš„æœ€åä¸€ä¸ªé˜¶æ®µï¼Œä¹Ÿè¢«ç§°ä¸ºMotion LoRA ï¼Œæ˜¯ä¸€ç§é«˜æ•ˆçš„è¿åŠ¨ä¸ªæ€§åŒ–å¾®è°ƒæ–¹æ³•ã€‚è€ƒè™‘åˆ°è¿åŠ¨æ¨¡å—çš„æ¶æ„å’Œæœ‰é™çš„å‚è€ƒè§†é¢‘æ•°é‡ï¼Œæ‰€è¿°çš„è†¨èƒ€æ¨¡å‹ä¸­ï¼Œåœ¨è¿åŠ¨æ¨¡å—çš„è‡ªæ³¨æ„åŠ›å±‚ä¸­æ·»åŠ äº†LoRAå±‚ç„¶ååœ¨ä¸Šé¢è®­ç»ƒè¿™äº›LoRAå±‚</p><blockquote><p>åœ¨è®­ç»ƒé¢†åŸŸé€‚é…å™¨ã€è¿åŠ¨æ¨¡å—å’ŒMotionLoRAæ—¶ï¼Œå¯è®­ç»ƒéƒ¨åˆ†ä»¥å¤–çš„å‚æ•°ä¿æŒå†»ç»“ã€‚</p><p>åœ¨æ¨ç†æ—¶ï¼Œé¦–å…ˆæŒ‰ç…§è®¨è®ºçš„æ–¹å¼å¯¹ä¸ªæ€§åŒ–T2Iæ¨¡å‹è¿›è¡Œè†¨èƒ€ï¼Œç„¶åæ³¨å…¥ç”¨äºç”Ÿæˆé€šç”¨åŠ¨ç”»çš„Motionæ¨¡å—ï¼Œä»¥åŠç”¨äºç”Ÿæˆå…·æœ‰ä¸ªæ€§åŒ–è¿åŠ¨çš„åŠ¨ç”»çš„å¯é€‰MotionLoRAã€‚</p><p>å¯¹äºåŸŸé€‚é…å™¨ï¼Œåœ¨æ¨ç†è¿‡ç¨‹ä¸­ä¸èƒ½ç®€å•åœ°ä¸¢å¼ƒå®ƒï¼Œåœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿˜å¯ä»¥å°†å…¶æ³¨å…¥åˆ°ä¸ªæ€§åŒ–T2Iæ¨¡å‹ä¸­ï¼Œé€šè¿‡æ”¹å˜Eqä¸­çš„æ¯”ä¾‹å› å­Î±æ¥è°ƒæ•´å®ƒçš„è´¡çŒ®ã€‚</p></blockquote><h3 id="T2I-Adapter-2023"><a href="#T2I-Adapter-2023" class="headerlink" title="T2I-Adapter 2023"></a>T2I-Adapter 2023</h3><p>T2I-Adapter: Learning Adapters to Dig out More Controllable Ability for Text-to-Image Diffusion Models</p><p>å¤§è§„æ¨¡æ–‡æœ¬åˆ°å›¾åƒ( T2I )æ¨¡å‹ä»¤äººéš¾ä»¥ç½®ä¿¡çš„ç”Ÿæˆèƒ½åŠ›å·²ç»æ˜¾ç¤ºå‡ºå¼ºå¤§çš„å­¦ä¹ å¤æ‚ç»“æ„å’Œæœ‰æ„ä¹‰è¯­ä¹‰çš„èƒ½åŠ›.</p><p>Motivation:ç„¶è€Œ,<strong>ä»…ä»…ä¾é æ–‡æœ¬æç¤ºå¹¶ä¸èƒ½å……åˆ†åœ°åˆ©ç”¨æ¨¡å‹å­¦ä¹ åˆ°çš„çŸ¥è¯†</strong>,å°¤å…¶æ˜¯éœ€è¦çµæ´»å‡†ç¡®åœ°æ§åˆ¶(ä¾‹å¦‚,é¢œè‰²å’Œç»“æ„)æ—¶.</p><p>å…·ä½“æ¥è¯´ï¼Œæå‡º<strong>å­¦ä¹ ç®€å•è½»é‡çº§çš„T2I - Adaptersæ¥å°†T2Iæ¨¡å‹ä¸­çš„å†…éƒ¨çŸ¥è¯†ä¸å¤–éƒ¨æ§åˆ¶ä¿¡å·å¯¹é½,åŒæ—¶å†»ç»“åŸå§‹çš„å¤§å‹T2Iæ¨¡å‹</strong></p><p>åœ¨æœ¬æ–‡ä¸­æ¢è®¨æ˜¯å¦æœ‰å¯èƒ½é€šè¿‡<strong>æŸç§æ–¹å¼â€æŒ–æ˜å‡ºâ€ T2Iæ¨¡å‹éšå«å­¦ä¹ åˆ°çš„èƒ½åŠ›</strong>ï¼Œç‰¹åˆ«æ˜¯é«˜å±‚ç»“æ„å’Œè¯­ä¹‰èƒ½åŠ›ï¼Œç„¶å<strong>æ˜ç¡®åœ°ä½¿ç”¨å®ƒä»¬æ¥æ›´ç²¾ç¡®åœ°æ§åˆ¶ç”Ÿæˆ</strong>ã€‚ä½œè€…è®¤ä¸ºä¸€ä¸ªå°å‹çš„é€‚é…å™¨æ¨¡å‹å¯ä»¥è¾¾åˆ°è¿™ä¸ªç›®çš„ï¼Œå› ä¸ºå®ƒä¸æ˜¯å­¦ä¹ æ–°çš„ç”Ÿæˆèƒ½åŠ›ï¼Œè€Œæ˜¯å­¦ä¹ T2Iæ¨¡å‹ä¸­ä»æ§åˆ¶ä¿¡æ¯åˆ°å†…éƒ¨çŸ¥è¯†çš„æ˜ å°„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™é‡Œçš„ä¸»è¦é—®é¢˜æ˜¯â€å¯¹é½â€é—®é¢˜ï¼Œå³å†…éƒ¨çŸ¥è¯†å’Œå¤–éƒ¨æ§åˆ¶ä¿¡å·åº”è¯¥å¯¹é½ã€‚</p><p><img data-src="https://proanimer-img.oss-cn-shanghai.aliyuncs.com/alimg/image-20240504225616342.png" alt="image-20240504225616342"></p><script type="math/tex; mode=display">\left.\left\{\begin{array}{l}\mathbf{Q}=\mathbf{W}_Q\phi(\mathbf{Z}_t);\mathbf{K}=\mathbf{W}_K\tau(\mathbf{y});\mathbf{V}=\mathbf{W}_V\tau(\mathbf{y})\\Attention(\mathbf{Q},\mathbf{K},\mathbf{V})=softmax(\frac{\mathbf{Q}\mathbf{K}^T}{\sqrt d})\cdot\mathbf{V}\end{array}\right.\right.</script><script type="math/tex; mode=display">\mathcal{L}=\mathbb{E}_{\mathbf{Z}_t,\mathbf{C},\epsilon,t}(||\epsilon-\epsilon_\theta(\mathbf{Z}_t,\mathbf{C})||_2^2)</script><p>Cè¡¨ç¤ºæ¡ä»¶ä¿¡æ¯ï¼ŒÎ¸è¡¨ç¤ºUNetå»å™ªå™¨çš„å‡½æ•°ã€‚</p><p>åœ¨æ¨ç†è¿‡ç¨‹ä¸­ï¼Œè¾“å…¥çš„éšæ˜ å°„$Z^{T}$ç”±éšæœºé«˜æ–¯åˆ†å¸ƒç”Ÿæˆã€‚ç»™å®š$Z^{T}$ï¼Œ$\epsilon_{\theta}$åœ¨æ¯ä¸€æ­¥té¢„æµ‹ä¸€ä¸ªå™ªå£°ä¼°è®¡ï¼Œæ¡ä»¶ä¸ºCã€‚å™ªå£°ç‰¹å¾å›¾é€šè¿‡å‡å»å®ƒå˜å¾—è¶Šæ¥è¶Šæ¸…æ™°.</p><p><img data-src="https://proanimer-img.oss-cn-shanghai.aliyuncs.com/alimg/image-20240504224247416.png" alt="image-20240504224247416"></p><p>åœ¨æ¯ä¸ªå°ºåº¦ä¸‹ï¼Œåˆ©ç”¨ä¸€ä¸ªå·ç§¯å±‚å’Œä¸¤ä¸ªæ®‹å·®å—( RB )æ¥æå–æ¡ä»¶ç‰¹å¾Fck.æœ€ç»ˆå½¢æˆå¤šå°ºåº¦æ¡ä»¶ç‰¹å¾Fc = { F$^{1}<em>{c}$ï¼ŒF$^{2}</em>{c}$ï¼ŒF$^{3}<em>{c}$ï¼ŒF$^{4}</em>{c}$ }ã€‚æ³¨æ„åˆ°Fcçš„ç»´åº¦ä¸UNetå»å™ªå™¨ç¼–ç å™¨ä¸­çš„ä¸­é—´ç‰¹å¾$F<em>{enc}$= { F$^{1}</em>{enc}$ï¼ŒF$^{2}<em>{enc}$ï¼ŒF$^{3}</em>{enc}$ï¼ŒF$^{4}<em>{enc}$ }ç›¸åŒ,ç„¶ååœ¨æ¯ä¸ªå°ºåº¦ä¸‹ï¼ŒF$</em>{c}$ä¸$F_{enc}$ç›¸åŠ ã€‚</p><script type="math/tex; mode=display">\begin{aligned}&\mathbf{F}_{c}=\mathcal{F}_{AD}(\mathbf{C})\\&\hat{\mathbf{F}}_{enc}^{i}=\mathbf{F}_{enc}^{i}+\mathbf{F}_{c}^{i},i\in\{1,2,3,4\}\end{aligned}</script><p>Cä¸ºæ¡ä»¶è¾“å…¥ã€‚F$_{AD}$æ˜¯T2Içš„é€‚é…å™¨</p><p>é™¤äº†ä½¿ç”¨å•ä¸ªé€‚é…å™¨ä½œä¸ºæ¡ä»¶å¤–ï¼Œæå‡ºçš„T2Ié€‚é…å™¨è¿˜æ”¯æŒå¤šç§æ¡ä»¶ã€‚æ³¨æ„è¿™ä¸ªç­–ç•¥ä¸éœ€è¦é¢å¤–çš„è®­ç»ƒã€‚</p><script type="math/tex; mode=display">\mathbf{F}_c=\sum_{k=1}^K\omega_k\mathcal{F}_{AD}^k(\mathbf{C}_k)</script><h3 id="IP-Adapter-2023"><a href="#IP-Adapter-2023" class="headerlink" title="IP-Adapter 2023"></a>IP-Adapter 2023</h3><p>IP-Adapter:Text Compatible Image Prompt Adapter for Text-to-Image Diffusion Models</p><p>èƒŒæ™¯ç›®çš„ä¸ç»“è®º:è¿‘å¹´æ¥ï¼Œå¤§å‹æ–‡æœ¬åˆ°å›¾åƒæ‰©æ•£æ¨¡å‹å› å…¶å‡ºè‰²çš„ç”Ÿæˆèƒ½åŠ›åˆ›é€ å‡ºé«˜ä¿çœŸåº¦çš„å›¾åƒè€Œè¡¨ç°å‡ºå¼ºå¤§çš„èƒ½åŠ›ã€‚ç„¶è€Œï¼Œä»…ä½¿ç”¨æ–‡æœ¬æç¤ºç”Ÿæˆæƒ³è¦çš„å›¾åƒæ˜¯éå¸¸å›°éš¾çš„ï¼Œå› ä¸ºå®ƒå¾€å¾€æ¶‰åŠå¤æ‚çš„æç¤ºå·¥ç¨‹ã€‚æ–‡å­—æç¤ºçš„ä¸€ç§æ›¿ä»£æ–¹å¼æ˜¯å›¾åƒæç¤ºï¼Œä¿—è¯è¯´ï¼šâ€ä¸€å¼ å›¾åƒå€¼ä¸€åƒä¸ªå­—â€ã€‚è™½ç„¶ç°æœ‰çš„ä»é¢„è®­ç»ƒæ¨¡å‹ç›´æ¥å¾®è°ƒçš„æ–¹æ³•æ˜¯æœ‰æ•ˆçš„ï¼Œä½†å®ƒä»¬éœ€è¦è¾ƒå¤§çš„è®¡ç®—èµ„æºï¼Œå¹¶ä¸”ä¸å…¶ä»–åŸºç¡€æ¨¡å‹ã€æ–‡æœ¬æç¤ºå’Œç»“æ„æ§åˆ¶ä¸å…¼å®¹</p><p>åœ¨æœ¬æ–‡ä¸­æå‡ºäº†IP - Adapterï¼Œä¸€ç§æœ‰æ•ˆçš„ã€è½»é‡çº§çš„é€‚é…å™¨ï¼Œ<strong>ä»¥å®ç°é¢„è®­ç»ƒçš„æ–‡æœ¬åˆ°å›¾åƒæ‰©æ•£æ¨¡å‹çš„å›¾åƒæç¤ºèƒ½åŠ›</strong>ã€‚æˆ‘ä»¬çš„IP - Adapterçš„<strong>å…³é”®è®¾è®¡æ˜¯è§£è€¦çš„äº¤å‰æ³¨æ„åŠ›æœºåˆ¶ï¼Œå°†æ–‡æœ¬ç‰¹å¾å’Œå›¾åƒç‰¹å¾çš„äº¤å‰æ³¨æ„åŠ›å±‚åˆ†ç¦»</strong>ã€‚</p><p>å¾—ç›Šäºè§£è€¦çš„äº¤å‰æ³¨æ„åŠ›ç­–ç•¥ï¼Œå›¾åƒæç¤ºä¹Ÿå¯ä»¥å¾ˆå¥½åœ°ä¸æ–‡æœ¬æç¤ºååŒå·¥ä½œï¼Œå®ç°å¤šæ¨¡æ€å›¾åƒç”Ÿæˆã€‚</p><blockquote><p>ä¹Ÿæ˜¯ä½¿ç”¨å›¾åƒä½œä¸ºæç¤ºä¿¡æ¯çš„å·¥ä½œ</p></blockquote><p><img data-src="https://proanimer-img.oss-cn-shanghai.aliyuncs.com/alimg/image-20240504191157767.png" alt="image-20240504191157767"></p><p>ä»¥å¾€çš„å·¥ä½œé€šè¿‡æ›¿æ¢text-encoderä¸ºimage-encoder,æœ¬ä½œå¼ºè°ƒåœ¨ä¸ä¿®æ”¹åŸå§‹æ¨¡å‹çš„æƒ…å†µä¸‹å®ç°å›¾åƒæç¤ºåŠŸèƒ½.</p><p><img data-src="https://proanimer-img.oss-cn-shanghai.aliyuncs.com/alimg/image-20240504204508024.png" alt="image-20240504204508024"></p><p>æ–‡ç« è®¤ä¸º,ä¸Šè¿°æ–¹æ³•çš„ä¸»è¦é—®é¢˜åœ¨äºæ–‡æœ¬åˆ°å›¾åƒæ‰©æ•£æ¨¡å‹çš„äº¤å‰æ³¨æ„åŠ›æ¨¡å—.å¯¹é¢„è®­ç»ƒæ‰©æ•£æ¨¡å‹ä¸­çš„äº¤å‰æ³¨æ„åŠ›å±‚çš„keyå’ŒvalueæŠ•å½±æƒé‡è¿›è¡Œè®­ç»ƒ,ä½¿å…¶é€‚åº”æ–‡æœ¬ç‰¹å¾.</p><p>å› æ­¤,å°†å›¾åƒç‰¹å¾å’Œæ–‡æœ¬ç‰¹å¾èåˆåˆ°äº¤å‰æ³¨æ„åŠ›å±‚åªå®Œæˆäº†å›¾åƒç‰¹å¾åˆ°æ–‡æœ¬ç‰¹å¾çš„å¯¹é½,ä½†è¿™å¯èƒ½ä¼šé—æ¼ä¸€äº›å›¾åƒç‰¹æœ‰çš„ä¿¡æ¯,æœ€ç»ˆå¯¼è‡´ä»…ä¸å‚è€ƒå›¾åƒè¿›è¡Œç²—ç²’åº¦å¯æ§ç”Ÿæˆ(ä¾‹å¦‚,å›¾åƒé£æ ¼)ã€‚</p><script type="math/tex; mode=display">L_{\mathrm{simple}}=\mathbb{E}_{\boldsymbol{x}_0,\boldsymbol{\epsilon}\sim\mathcal{N}(\mathbf{0},\mathbf{I}),\boldsymbol{c},t}\|\epsilon-\epsilon_\theta(\boldsymbol{x}_t,\boldsymbol{c},t)\|^2</script><p>åœ¨CFGä¸‹</p><script type="math/tex; mode=display">\hat{\epsilon}_\theta(x_t,c,t)=w\epsilon_\theta(x_t,c,t)+(1-w)\epsilon_\theta(x_t,t)</script><p>ç›®å‰çš„é€‚é…å™¨å¾ˆéš¾åŒ¹é…å¾®è°ƒçš„å›¾åƒæç¤ºæ¨¡å‹æˆ–ä»é›¶å¼€å§‹è®­ç»ƒçš„æ¨¡å‹çš„æ€§èƒ½ã€‚ä¸»è¦åŸå› æ˜¯<strong>å›¾åƒç‰¹å¾ä¸èƒ½æœ‰æ•ˆåœ°åµŒå…¥åˆ°é¢„è®­ç»ƒæ¨¡å‹</strong>ä¸­ã€‚å¤§å¤šæ•°æ–¹æ³•åªæ˜¯ç®€å•åœ°å°†ä¸²è”çš„ç‰¹å¾è¾“å…¥åˆ°å†»ç»“çš„äº¤å‰æ³¨æ„åŠ›å±‚ä¸­ï¼Œé˜»æ­¢äº†æ‰©æ•£æ¨¡å‹ä»å›¾åƒæç¤ºä¸­æ•è·ç»†ç²’åº¦çš„ç‰¹å¾ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæå‡ºäº†ä¸€ç§<strong>è§£è€¦çš„äº¤å‰æ³¨æ„åŠ›ç­–ç•¥ï¼Œé€šè¿‡æ–°å¢åŠ çš„äº¤å‰æ³¨æ„åŠ›å±‚æ¥åµŒå…¥å›¾åƒç‰¹å¾</strong>ã€‚</p><p>æ’å…¥å›¾åƒç‰¹å¾çš„ä¸€ç§ç›´æ¥æ–¹æ³•æ˜¯å°†å›¾åƒç‰¹å¾å’Œæ–‡æœ¬ç‰¹å¾è¿›è¡Œæ‹¼æ¥ï¼Œç„¶åå°†å…¶è¾“å…¥åˆ°äº¤å‰æ³¨æ„åŠ›å±‚ä¸­.ç„¶è€Œ,æˆ‘ä»¬å‘ç°è¿™ç§æ–¹æ³•çš„æœ‰æ•ˆæ€§ä¸è¶³.ç›¸åæå‡ºäº†ä¸€ç§è§£è€¦çš„äº¤å‰æ³¨æ„åŠ›æœºåˆ¶,å…¶ä¸­æ–‡æœ¬ç‰¹å¾å’Œå›¾åƒç‰¹å¾çš„äº¤å‰æ³¨æ„åŠ›å±‚æ˜¯åˆ†å¼€çš„ã€‚</p><script type="math/tex; mode=display">\mathbf{Z}''=\text{Attention}(\mathbf{Q},\mathbf{K}',\mathbf{V}')=\text{Softmax}(\frac{\mathbf{Q}(\mathbf{K}')^\top}{\sqrt{d}})\mathbf{V}'</script><script type="math/tex; mode=display">\mathbf{Z}^{new}=\mathrm{Softmax}(\frac{\mathbf{Q}\mathbf{K}^{\top}}{\sqrt{d}})\mathbf{V}+\mathrm{Softmax}(\frac{\mathbf{Q}(\mathbf{K}^{\prime})^{\top}}{\sqrt{d}})\mathbf{V}^{\prime}\\\mathrm{where~}\mathbf{Q}=\mathbf{Z}\mathbf{W}_q,\mathbf{K}=c_t\mathbf{W}_k,\mathbf{V}=c_t\mathbf{W}_v,\mathbf{K}^{\prime}=c_i\mathbf{W}_k^{\prime},\mathbf{V}^{\prime}=c_i\mathbf{W}_v^{\prime}</script><p>ç”±äºå†»ç»“äº†åŸå§‹çš„UNetæ¨¡å‹ï¼Œåœ¨ä¸Šè¿°è§£è€¦çš„äº¤å‰æ³¨æ„åŠ›ä¸­ï¼Œåªæœ‰Wâ€²kå’ŒWâ€²væ˜¯å¯è®­ç»ƒçš„.</p><script type="math/tex; mode=display">L_{\mathrm{simple}}=\mathbb{E}_{\boldsymbol{x}_0,\boldsymbol{\epsilon},\boldsymbol{c}_t,\boldsymbol{c}_i,t}\|\epsilon-\epsilon_\theta(x_t,c_t,c_i,t)\|^2 \\\hat{\epsilon}_\theta(x_t,c_t,c_i,t)=w\epsilon_\theta(x_t,c_t,c_i,t)+(1-w)\epsilon_\theta(x_t,t)</script><p>æˆ‘ä»¬è¿˜åœ¨è®­ç»ƒé˜¶æ®µéšæœºä¸¢å¼ƒå›¾åƒæ¡ä»¶,ä»¥ä¾¿åœ¨æ¨ç†é˜¶æ®µå®ç°æ— åˆ†ç±»å™¨æŒ‡å¯¼.</p><p>ç”±äºæ–‡æœ¬äº¤å‰æ³¨æ„åŠ›å’Œå›¾åƒäº¤å‰æ³¨æ„åŠ›æ˜¯åˆ†ç¦»çš„ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åœ¨æ¨æ–­é˜¶æ®µè°ƒæ•´å›¾åƒæ¡ä»¶çš„æƒé‡</p><script type="math/tex; mode=display">\mathbf{Z}^{new}=\text{Attention}(\mathbf{Q},\mathbf{K},\mathbf{V})+\lambda\cdot\text{Attention}(\mathbf{Q},\mathbf{K}',\mathbf{V}')</script><p>ä¸ºäº†è®­ç»ƒIP - Adapterï¼Œä»ä¸¤ä¸ªå¼€æºæ•°æ®é›†LAION - 2Bå’ŒCOYO - 700Mä¸­æ„å»ºäº†ä¸€ä¸ªåŒ…å«çº¦1000ä¸‡ä¸ªæ–‡æœ¬-å›¾åƒå¯¹çš„å¤šæ¨¡æ€æ•°æ®é›†</p><h3 id="InstantID-2024"><a href="#InstantID-2024" class="headerlink" title="InstantID 2024"></a>InstantID 2024</h3><p><img data-src="https://proanimer-img.oss-cn-shanghai.aliyuncs.com/alimg/image-20240504230014174.png" alt="image-20240504230014174"></p><p>åˆ©ç”¨Textual Inversionã€DreamBoothã€LoRAç­‰æ–¹æ³•è¿›è¡Œä¸ªæ€§åŒ–å›¾åƒåˆæˆå·²ç»å–å¾—äº†æ˜¾è‘—çš„è¿›å±•ã€‚ç„¶è€Œï¼Œå®ƒä»¬çš„å®é™…åº”ç”¨å—åˆ°<strong>é«˜å­˜å‚¨éœ€æ±‚ã€é•¿æ—¶é—´å¾®è°ƒè¿‡ç¨‹ä»¥åŠéœ€è¦å¤šä¸ªå‚è€ƒå›¾åƒçš„é™åˆ¶</strong>ã€‚ç›¸åï¼Œç°æœ‰çš„åŸºäºIDåµŒå…¥çš„æ–¹æ³•ï¼Œè™½ç„¶åªéœ€è¦å•ä¸€çš„å‰å‘æ¨æ–­ï¼Œä½†é¢ä¸´æŒ‘æˆ˜ï¼šå®ƒä»¬è¦ä¹ˆéœ€è¦åœ¨ä¼—å¤šæ¨¡å‹å‚æ•°ä¹‹é—´è¿›è¡Œå¹¿æ³›çš„å¾®è°ƒï¼Œç¼ºä¹ä¸ç¤¾åŒºé¢„è®­ç»ƒæ¨¡å‹çš„å…¼å®¹æ€§ï¼Œè¦ä¹ˆä¸èƒ½ä¿æŒé«˜çš„äººè„¸ä¿çœŸåº¦</p><p>æˆ‘InstantIDï¼Œè¿™æ˜¯ä¸€ä¸ªçš„åŸºäºæ‰©æ•£æ¨¡å‹çš„è§£å†³æ–¹æ¡ˆ,å³æ’å³ç”¨æ¨¡å—åªä½¿ç”¨ä¸€å¼ äººè„¸å›¾åƒå°±èƒ½å¾ˆå¥½åœ°å¤„ç†å„ç§é£æ ¼çš„å›¾åƒä¸ªæ€§åŒ–ï¼ŒåŒæ—¶ä¿è¯äº†é«˜ä¿çœŸåº¦ã€‚</p><p>ä¸ºäº†å®ç°è¿™ä¸€ç‚¹,è®¾è®¡äº†ä¸€ä¸ªæ–°é¢–çš„IdentityNetï¼Œé€šè¿‡å¼ºè¯­ä¹‰å’Œå¼±ç©ºé—´æ¡ä»¶ï¼Œå°†é¢éƒ¨å’Œåœ°æ ‡å›¾åƒä¸æ–‡æœ¬æç¤ºç›¸ç»“åˆ,ä»¥å¼•å¯¼å›¾åƒç”Ÿæˆ.</p><p><strong>ç”Ÿæˆç²¾ç¡®ä¿ç•™äººç±»ä¸»ä½“é”™ç»¼å¤æ‚çš„èº«ä»½ç»†èŠ‚çš„å®šåˆ¶å›¾åƒ</strong>ã€‚</p><p>å®ƒåŒ…å«ä¸‰ä¸ªå…³é”®éƒ¨åˆ†ï¼š( 1 )èƒ½å¤Ÿæ•è·é²æ£’è¯­ä¹‰äººè„¸ä¿¡æ¯çš„IDåµŒå…¥ï¼›( 2 )ä¸€ä¸ªè½»é‡çº§çš„è‡ªé€‚åº”æ¨¡å—ï¼Œå…·æœ‰è§£è€¦çš„äº¤å‰æ³¨æ„åŠ›ï¼Œä¾¿äºä½¿ç”¨å›¾åƒä½œä¸ºè§†è§‰æç¤ºï¼›( 3 )æå‡ºäº†ä¸€ç§åŸºäºé¢å¤–ç©ºé—´æ§åˆ¶çš„ç¼–ç å‚è€ƒäººè„¸å›¾åƒç»†èŠ‚ç‰¹å¾çš„IdentityNetã€‚</p><p>é¦–å…ˆé‡‡ç”¨<strong>äººè„¸ç¼–ç å™¨ä»£æ›¿CLIPæå–è¯­ä¹‰äººè„¸ç‰¹å¾</strong>,å¹¶ä½¿ç”¨å¯è®­ç»ƒçš„æŠ•å½±å±‚å°†å…¶æŠ•å½±åˆ°æ–‡æœ¬ç‰¹å¾ç©ºé—´.</p><p>ç„¶åï¼Œå¼•å…¥è§£è€¦äº¤å‰æ³¨æ„åŠ›çš„è½»é‡çº§è‡ªé€‚åº”æ¨¡å—ï¼Œä»¥æ”¯æŒå›¾åƒä½œä¸ºæç¤ºã€‚</p><p>åœ¨IdentityNetä¸­,ç”Ÿæˆè¿‡ç¨‹å®Œå…¨ç”±äººè„¸åµŒå…¥å¼•å¯¼,æ— éœ€ä»»ä½•æ–‡æœ¬ä¿¡æ¯.åªæ›´æ–°æ–°å¢åŠ çš„æ¨¡å—,è€Œé¢„è®­ç»ƒçš„æ–‡æœ¬åˆ°å›¾åƒæ¨¡å‹ä¿æŒå†»ç»“,ä»¥ç¡®ä¿çµæ´»æ€§.</p><p>åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œ<strong>åªå¯¹Image Adapterå’ŒIdentity Netçš„å‚æ•°è¿›è¡Œä¼˜åŒ–</strong>ï¼Œè€Œå¯¹é¢„è®­ç»ƒçš„æ‰©æ•£æ¨¡å‹çš„å‚æ•°ä¿æŒå†»ç»“ã€‚æˆ‘ä»¬åœ¨å…·æœ‰äººç±»ä¸»é¢˜çš„å›¾åƒ-æ–‡æœ¬å¯¹ä¸Šè®­ç»ƒæ•´ä¸ªInstantIDæµæ°´çº¿ï¼Œé‡‡ç”¨äº†ç±»ä¼¼äºåŸå§‹ç¨³å®šæ‰©æ•£å·¥ä½œä¸­ä½¿ç”¨çš„è®­ç»ƒç›®æ ‡</p><script type="math/tex; mode=display">\mathcal{L}=\mathbb{E}_{z_t,t,C,C_i,\epsilon\sim\mathcal{N}(0,1)}[\|\epsilon-\epsilon_\theta(z_t,t,C,C_i)\|_2^2]</script><p>$C_{i}$â€‹ä¸ºIdentityNetä¸Šçš„ä»»åŠ¡ç‰¹å®šå›¾åƒæ¡ä»¶ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œåœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¸ä¼šéšæ„ä¸¢å¼ƒæ–‡æœ¬æˆ–å›¾ç‰‡æ¡ä»¶ï¼Œå› ä¸ºæˆ‘ä»¬å·²ç»å»æ‰äº†IdentityNetä¸­çš„æ–‡æœ¬æç¤ºæ¡ä»¶ã€‚</p><h3 id="PhotoMaker-Customizing-Realistic-Human-Photos-via-Stacked-ID-Embedding"><a href="#PhotoMaker-Customizing-Realistic-Human-Photos-via-Stacked-ID-Embedding" class="headerlink" title="PhotoMaker:Customizing Realistic Human Photos via Stacked ID Embedding"></a>PhotoMaker:Customizing Realistic Human Photos via Stacked ID Embedding</h3><p>Background and Task:</p><p>Motivation:</p><p>Method:</p><p>Results and findings:</p><p>æ–‡æœ¬ç”Ÿæˆé«˜æ¸…å›¾åƒçš„æœ€æ–°è¿›å±•åœ¨åˆæˆåŸºäºç»™å®šæ–‡æœ¬æç¤ºçš„çœŸå®æ„Ÿäººç±»ç…§ç‰‡æ–¹é¢å–å¾—äº†æ˜¾è‘—çš„è¿›å±•.</p><p>ç„¶è€Œ,ç°æœ‰çš„ä¸ªæ€§åŒ–ç”Ÿæˆæ–¹æ³•æ— æ³•åŒæ—¶æ»¡è¶³é«˜æ•ˆç‡ã€é«˜èº«ä»½ä¿çœŸåº¦å’Œçµæ´»çš„æ–‡æœ¬å¯æ§æ€§ç­‰è¦æ±‚.åœ¨è¿™é¡¹å·¥ä½œä¸­,æˆ‘ä»¬å¼•å…¥äº†ä¸€ç§é«˜æ•ˆçš„ä¸ªæ€§åŒ–æ–‡æœ¬åˆ°å›¾åƒç”Ÿæˆæ–¹æ³•PhotoMaker,å®ƒä¸»è¦å°†ä»»æ„æ•°é‡çš„è¾“å…¥IDå›¾åƒç¼–ç æˆå †æ ˆIDåµŒå…¥,ä»¥ä¿ç•™IDä¿¡æ¯.</p><p>åœ¨è¿™é¡¹å·¥ä½œä¸­,æˆ‘ä»¬å¼•å…¥äº†ä¸€ç§é«˜æ•ˆçš„ä¸ªæ€§åŒ–æ–‡æœ¬åˆ°å›¾åƒç”Ÿæˆæ–¹æ³•PhotoMaker,å®ƒä¸»è¦å°†ä»»æ„æ•°é‡çš„è¾“å…¥IDå›¾åƒç¼–ç æˆå †æ ˆIDåµŒå…¥,ä»¥ä¿ç•™IDä¿¡æ¯.</p><p><img data-src="https://s2.loli.net/2024/05/16/djRDKObakQW3wm4.png" alt="image-20240516204600628"></p><p>å¯¹äºæ‰€æå‡ºçš„PhotoMaker,é¦–å…ˆåˆ†åˆ«ä»æ–‡æœ¬ç¼–ç å™¨å’Œå›¾åƒç¼–ç å™¨ä¸­è·å¾—æ–‡æœ¬åµŒå…¥å’Œå›¾åƒåµŒå…¥.ç„¶å,é€šè¿‡åˆå¹¶ç›¸åº”çš„ç±»åµŒå…¥(ä¾‹å¦‚,ç”·äººå’Œå¥³äºº)å’Œæ¯ä¸ªå›¾åƒåµŒå…¥æ¥æå–èåˆåµŒå…¥.æ¥ä¸‹æ¥,æˆ‘ä»¬å°†æ‰€æœ‰çš„èåˆåµŒå…¥æ²¿ç€é•¿åº¦ç»´åº¦è¿›è¡Œæ‹¼æ¥,å½¢æˆå †å çš„IDåµŒå…¥.æœ€åå°†å †å çš„IDåµŒå…¥åé¦ˆç»™æ‰€æœ‰çš„äº¤å‰æ³¨æ„åŠ›å±‚,ç”¨äºè‡ªé€‚åº”åœ°åˆå¹¶æ‰©æ•£æ¨¡å‹ä¸­çš„IDå†…å®¹.</p><p>åœ¨ç»™å®šå°‘é‡å¾…å®šåˆ¶IDå›¾åƒçš„æƒ…å†µä¸‹,PhotoMakerçš„ç›®æ ‡æ˜¯ç”Ÿæˆä¸€ä¸ªæ–°çš„å…·æœ‰ç…§ç‰‡çœŸå®æ„Ÿçš„äººä½“å›¾åƒ,è¯¥å›¾åƒä¿ç•™äº†è¾“å…¥IDçš„ç‰¹å¾,å¹¶åœ¨æ–‡æœ¬æç¤ºçš„æ§åˆ¶ä¸‹æ”¹å˜ç”ŸæˆIDçš„å†…å®¹æˆ–å±æ€§.</p><p>ä»¬ä½¿ç”¨CLIP å›¾åƒç¼–ç å™¨$E<em>{img}$æ¥æå–å›¾åƒåµŒå…¥,ä»¥ä½¿å…¶ä¸æ‰©æ•£æ¨¡å‹ä¸­çš„åŸå§‹æ–‡æœ¬è¡¨ç¤ºç©ºé—´å¯¹é½ã€‚åœ¨å°†æ¯å¹…è¾“å…¥å›¾åƒè¾“å…¥åˆ°å›¾åƒç¼–ç å™¨ä¹‹å‰ï¼Œæˆ‘ä»¬ç”¨éšæœºå™ªå£°å¡«å……ç‰¹å®šIDçš„ä¸»ä½“éƒ¨åˆ†ä»¥å¤–çš„å›¾åƒåŒºåŸŸï¼Œä»¥æ¶ˆé™¤å…¶ä»–IDå’ŒèƒŒæ™¯çš„å½±å“ã€‚å¯¹äºç»™å®šçš„æ–‡æœ¬æç¤ºTï¼Œæˆ‘ä»¬ä½¿ç”¨é¢„è®­ç»ƒçš„CLIPæ–‡æœ¬ç¼–ç å™¨$E</em>{text}$æå–æ–‡æœ¬åµŒå…¥$tâˆˆR^{L Ã— D}$ï¼Œå…¶ä¸­Lè¡¨ç¤ºåµŒå…¥çš„é•¿åº¦ã€‚</p><p>åœ¨è¾“å…¥ä¸­æ ‡æ³¨å¯¹åº”çš„ç±»è¯(ä¾‹å¦‚,ç”·äººå’Œå¥³äºº)ã€‚ç„¶åæˆ‘ä»¬åœ¨æ–‡æœ¬åµŒå…¥ä¸­æå–ç±»è¯å¯¹åº”ä½ç½®çš„ç‰¹å¾å‘é‡ã€‚è¯¥ç‰¹å¾å‘é‡å°†ä¸æ¯ä¸ªå›¾åƒåµŒå…¥$e_i$è¿›è¡Œèåˆ.</p><p>èåˆåµŒå…¥å¯ä»¥è¡¨ç¤ºä¸º{ ( $\hat{e}^{i}âˆˆR^{D}$ | i = 1 . . . . N }ã€‚é€šè¿‡ç»“åˆç±»åˆ«è¯çš„ç‰¹å¾å‘é‡ï¼Œè¯¥åµŒå…¥å¯ä»¥æ›´å…¨é¢åœ°è¡¨ç¤ºå½“å‰è¾“å…¥çš„IDå›¾åƒã€‚</p><p>åœ¨è·å¾—èåˆåµŒå…¥ä¹‹åï¼Œæˆ‘ä»¬å°†å®ƒä»¬æ²¿ç€é•¿åº¦ç»´åº¦è¿›è¡Œæ‹¼æ¥ï¼Œå½¢æˆå †å çš„idåµŒå…¥</p><script type="math/tex; mode=display">s^*=\text{Concat}([\hat{e}^1,\ldots,\hat{e}^N])\quad s^*\in\mathbb{R}^{N\times D}</script><script type="math/tex; mode=display">\left.\left\{\begin{array}{l}\mathbf{Q}=\mathbf{W}_Q\cdot\phi(z_t);\mathbf{K}=\mathbf{W}_K\cdot t^*;\mathbf{V}=\mathbf{W}_V\cdot t^*\\\text{Attention}(\mathbf{Q},\mathbf{K},\mathbf{V})=\text{softmax}(\frac{\mathbf{Q}\mathbf{K}^T}{\sqrt d})\cdot\mathbf{V},\end{array}\right.\right.</script><p>æˆ‘ä»¬åˆ©ç”¨æ‰©æ•£æ¨¡å‹ä¸­å›ºæœ‰çš„äº¤å‰æ³¨æ„åŠ›æœºåˆ¶ï¼Œè‡ªé€‚åº”åœ°åˆå¹¶å †å IDåµŒå…¥ä¸­åŒ…å«çš„IDä¿¡æ¯ã€‚é¦–å…ˆå°†åŸå§‹æ–‡æœ¬åµŒå…¥tä¸­ç±»è¯å¯¹åº”ä½ç½®çš„ç‰¹å¾å‘é‡æ›¿æ¢ä¸ºå †å çš„idåµŒå…¥$s^{ <em>}$å¾—åˆ°æ›´æ–°çš„æ–‡æœ¬åµŒå…¥$t^{ </em>}âˆˆR^{( L + N-1 ) Ã— D}$</p><blockquote><p>ä¸Šé¢äº”ç¯‡å·¥ä½œéƒ½æ˜¯ç±»ä¼¼çš„,åˆ©ç”¨é¢å¤–æ§åˆ¶ä¿¡æ¯å’Œæ”¹è¿›ä¸€äº›æ¨¡å‹è¿›è¡Œå¾®è°ƒä½¿å¾—æ•è·è¾“å…¥çš„å›¾åƒ.ä¸‹é¢å‡ ç¯‡å·¥ä½œæ˜¯OPenAIä¸Googleçš„æ–‡ç”Ÿå›¾æ¨¡å‹,å·²ç»ä½œä¸ºäº§å“çº§æ¨¡å‹.</p></blockquote><h3 id="GLIDE-2021"><a href="#GLIDE-2021" class="headerlink" title="GLIDE 2021"></a>GLIDE 2021</h3><p>GLIDEèƒ½å¤Ÿæ ¹æ®è‡ªç„¶è¯­è¨€æè¿°ç”Ÿæˆå›¾åƒï¼Œè¿™æ„å‘³ç€ç”¨æˆ·å¯ä»¥ç”¨æ–‡æœ¬æç¤ºæ¥ç”Ÿæˆç›¸åº”çš„è§†è§‰å†…å®¹ã€‚</p><p>è®ºæ–‡æ¯”è¾ƒäº†ä¸¤ç§å¼•å¯¼æ‰©æ•£æ¨¡å‹çš„æŠ€æœ¯â€”â€”CLIPå¼•å¯¼å’Œæ— åˆ†ç±»å™¨å¼•å¯¼ï¼ˆclassifier-free guidanceï¼‰ã€‚ç ”ç©¶å‘ç°ï¼Œæ— åˆ†ç±»å™¨å¼•å¯¼åœ¨ç…§ç‰‡çœŸå®æ„Ÿå’Œæ ‡é¢˜ç›¸ä¼¼æ€§æ–¹é¢æ›´å—äººç±»è¯„ä¼°è€…çš„é’çã€‚GLIDEä¸ä»…èƒ½å¤Ÿè¿›è¡Œé›¶æ ·æœ¬ï¼ˆzero-shotï¼‰å›¾åƒç”Ÿæˆï¼Œè¿˜èƒ½é€šè¿‡å›¾åƒä¿®å¤ï¼ˆinpaintingï¼‰è¿›è¡Œç»†ç²’åº¦çš„å›¾åƒç¼–è¾‘ï¼Œä½¿å¾—ç”¨æˆ·å¯ä»¥è¿­ä»£æ”¹è¿›æ¨¡å‹æ ·æœ¬ä»¥åŒ¹é…æ›´å¤æ‚çš„æ–‡æœ¬æç¤ºã€‚</p><p>Ho &amp; Salimans æå‡ºäº†æ— åˆ†ç±»å™¨å¼•å¯¼ï¼Œä¸€ç§ç”¨äºå¼•å¯¼æ‰©æ•£æ¨¡å‹çš„æŠ€æœ¯ï¼Œå®ƒä¸éœ€è¦å•ç‹¬çš„åˆ†ç±»å™¨æ¨¡å‹æ¥è¿›è¡Œè®­ç»ƒã€‚å¯¹äºæ— åˆ†ç±»å™¨æŒ‡å¯¼ï¼Œåœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œç±»æ¡ä»¶æ‰©æ•£æ¨¡å‹Î¸ ( xt | y )ä¸­çš„æ ‡ç­¾yè¢«ä¸€ä¸ªå›ºå®šæ¦‚ç‡çš„é›¶æ ‡ç­¾âˆ‘æ‰€ä»£æ›¿ã€‚ä¸ºäº†ç”¨é€šç”¨æ–‡æœ¬æç¤ºå®ç°æ— åˆ†ç±»å™¨çš„æŒ‡å¯¼ï¼Œæˆ‘ä»¬æœ‰æ—¶åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ç”¨ç©ºåºåˆ—(å…¶ä¸­,æˆ‘ä»¬ä¹Ÿç§°ä¹‹ä¸º:)æ›¿æ¢æ–‡æœ¬ã€‚</p><script type="math/tex; mode=display">\hat{\epsilon}_\theta(x_t|c)=\epsilon_\theta(x_t|\emptyset)+s\cdot(\epsilon_\theta(x_t|c)-\epsilon_\theta(x_t|\emptyset))</script><h3 id="DALLE2-2022"><a href="#DALLE2-2022" class="headerlink" title="DALLE2 2022"></a>DALLE2 2022</h3><p><img data-src="https://proanimer-img.oss-cn-shanghai.aliyuncs.com/alimg/image-20240504230111721.png" alt="image-20240504230111721"></p><p>åƒCLIPè¿™æ ·çš„å¯¹æ¯”æ¨¡å‹å·²ç»è¢«è¯æ˜å¯ä»¥å­¦ä¹ åˆ°åŒæ—¶æ•è·è¯­ä¹‰å’Œé£æ ¼çš„å›¾åƒçš„é²æ£’è¡¨ç¤ºã€‚</p><p>ä¸ºäº†åˆ©ç”¨è¿™äº›è¡¨ç¤ºè¿›è¡Œå›¾åƒç”Ÿæˆ,æ–‡ä¸­æå‡ºäº†ä¸€ä¸ªä¸¤é˜¶æ®µæ¨¡å‹ï¼šä¸€ä¸ªå…ˆéªŒç”Ÿæˆç»™å®šæ–‡æœ¬æè¿°çš„CLIPå›¾åƒåµŒå…¥ï¼Œä¸€ä¸ªè§£ç å™¨ç”Ÿæˆä»¥å›¾åƒåµŒå…¥ä¸ºæ¡ä»¶çš„å›¾åƒã€‚</p><p>æˆ‘ä»¬è¯æ˜äº†æ˜¾å¼åœ°ç”Ÿæˆå›¾åƒè¡¨ç¤ºä»¥æœ€å°çš„æŸå¤±åœ¨ç…§ç‰‡çœŸå®æ€§å’Œå­—å¹•ç›¸ä¼¼æ€§ä¸­æé«˜äº†å›¾åƒçš„å¤šæ ·æ€§ã€‚æˆ‘ä»¬çš„è§£ç å™¨åœ¨å›¾åƒè¡¨ç¤ºçš„æ¡ä»¶ä¸‹ä¹Ÿå¯ä»¥äº§ç”Ÿå›¾åƒçš„å˜åŒ–ï¼Œä»¥ä¿ç•™å…¶è¯­ä¹‰å’Œé£æ ¼ï¼ŒåŒæ—¶æ”¹å˜å›¾åƒè¡¨ç¤ºä¸­ä¸å­˜åœ¨çš„éåŸºæœ¬ç»†èŠ‚ã€‚æ­¤å¤–ï¼ŒCLIPçš„è”åˆåµŒå…¥ç©ºé—´å¯ä»¥åœ¨a zä¸­å®ç°è¯­è¨€å¼•å¯¼çš„å›¾åƒæ“ä½œ</p><h3 id="Imagen-2022"><a href="#Imagen-2022" class="headerlink" title="Imagen 2022"></a>Imagen 2022</h3><p>æˆ‘ä»¬æå‡ºäº†Imagenï¼Œæˆ‘ä»¬çš„å…³é”®å‘ç°æ˜¯ï¼Œé€šç”¨çš„å¤§è¯­è¨€æ¨¡å‹(å¦‚ï¼šT5 )ï¼Œåœ¨çº¯æ–‡æœ¬è¯­æ–™ä¸Šè¿›è¡Œé¢„è®­ç»ƒï¼Œåœ¨ç¼–ç å›¾åƒåˆæˆçš„æ–‡æœ¬æ—¶å–å¾—äº†æƒŠäººçš„æ•ˆæœï¼šå¢åŠ Imagenä¸­è¯­è¨€æ¨¡å‹çš„å¤§å°æ¯”å¢åŠ å›¾åƒæ‰©æ•£æ¨¡å‹çš„å¤§å°æ›´èƒ½æé«˜æ ·æœ¬ä¿çœŸåº¦å’Œå›¾åƒæ–‡æœ¬å¯¹é½åº¦ã€‚Imagenåœ¨COCOæ•°æ®é›†ä¸Šå–å¾—äº†7.27çš„æœ€æ–°FIDå¾—åˆ†ï¼Œè€Œæ²¡æœ‰å¯¹COCOè¿›è¡Œè¿‡è®­ç»ƒï¼Œäººç±»è¯„åˆ†å‘˜å‘ç°Imagenæ ·æœ¬å¤„äºæ ‡å‡†çŠ¶æ€</p><p><img data-src="https://proanimer-img.oss-cn-shanghai.aliyuncs.com/alimg/image-20240504235247964.png" alt="image-20240504235247964" style="zoom:67%;" /></p><p>Imagenä½¿ç”¨å†»ç»“çš„æ–‡æœ¬ç¼–ç å™¨å°†è¾“å…¥æ–‡æœ¬ç¼–ç æˆæ–‡æœ¬åµŒå…¥ã€‚æ¡ä»¶æ‰©æ•£æ¨¡å‹å°†æ–‡æœ¬åµŒå…¥æ˜ å°„æˆä¸€ä¸ª64Ã—64çš„å›¾åƒã€‚Imagenè¿›ä¸€æ­¥åˆ©ç”¨æ–‡æœ¬æ¡ä»¶çš„è¶…åˆ†è¾¨ç‡æ‰©æ•£æ¨¡å‹å¯¹å›¾åƒè¿›è¡Œä¸Šé‡‡æ ·ï¼Œå…ˆæ˜¯64Ã—64â†’256Ã—256ï¼Œç„¶åæ˜¯256Ã—256â†’1024Ã—1024ã€‚</p><p><strong>åŸºæ¨¡å‹</strong>é‡‡ç”¨IPPDMU - Netæ¶æ„ï¼Œç”¨äºæˆ‘ä»¬çš„64 Ã— 64æ–‡æœ¬åˆ°å›¾åƒæ‰©æ•£æ¨¡å‹ã€‚è¯¥ç½‘ç»œé€šè¿‡æ± åŒ–åµŒå…¥å‘é‡å¯¹æ–‡æœ¬åµŒå…¥è¿›è¡Œæ¡ä»¶åŒ–ï¼Œå¹¶åŠ å…¥ç±»åµŒå…¥æ¡ä»¶åŒ–æ–¹æ³•çš„æ‰©æ•£æ—¶é—´æ­¥åµŒå…¥ã€‚æˆ‘ä»¬è¿›ä¸€æ­¥é€šè¿‡åœ¨å¤šä¸ªåˆ†è¾¨ç‡çš„æ–‡æœ¬åµŒå…¥ä¸Šæ·»åŠ äº¤å‰æ³¨æ„åŠ›æ¥é™å®šæ•´ä¸ªæ–‡æœ¬åµŒå…¥åºåˆ—ã€‚</p><p><strong>è¶…åˆ†è¾¨ç‡æ¨¡å‹</strong>ï¼šå¯¹äº64 Ã— 64â†’256 Ã— 256çš„è¶…åˆ†è¾¨ç‡ï¼Œé‡‡ç”¨æ”¹ç¼–è‡ªPPDMUçš„U - Netæ¨¡å‹ã€‚ä¸ºäº†æé«˜å†…å­˜æ•ˆç‡ã€æ¨ç†æ—¶é—´å’Œæ”¶æ•›é€Ÿåº¦(æˆ‘ä»¬çš„å˜ä½“æ¯”æ–‡çŒ®[ 40,58 ]ä¸­ä½¿ç”¨çš„U - Netå¿«2 - 3å€æ­¥æ•°/ç§’)ï¼Œæˆ‘ä»¬å¯¹è¯¥U - Netæ¨¡å‹è¿›è¡Œäº†å¤šæ¬¡ä¿®æ”¹ã€‚æˆ‘ä»¬ç§°è¿™ç§å˜ä½“ä¸ºEfficient U-Net </p><p>æ€»ç»“ä¸€ä¸‹,å…³äºDDPMçš„è®ºæ–‡æœ¬èº«çš„æ•°å­¦ç†è®ºè¿˜æ˜¯æŒºå¼ºçš„,è€Œç›¸å…³çš„CLIP,Adapterä½œä¸ºæŸç§è¾…åŠ©æ”¹è¿›æ—¢æ˜¯ä¸€ç§åˆ›æ–°å‹çš„å·¥ä½œä¹Ÿå¾ˆæœ‰ä»·å€¼,ç†è®ºæ€§ç ”ç©¶èµ·æ¥ä¹Ÿæ²¡æœ‰é‚£ä¹ˆå›°éš¾,è¿™ç§å·¥ä½œåšèµ·æ¥è¿˜æ˜¯å¾ˆèˆ’æœçš„.</p><h3 id="An-Image-is-Worth-One-Word-Personalizing-Text-to-Image-Generation-using-Textual-Inversion"><a href="#An-Image-is-Worth-One-Word-Personalizing-Text-to-Image-Generation-using-Textual-Inversion" class="headerlink" title="An Image is Worth One Word: Personalizing Text-to-Image Generation using Textual Inversion"></a>An Image is Worth One Word: Personalizing Text-to-Image Generation using Textual Inversion</h3><p>Task:Text-to-image models </p><p>Motivation: Yet, it is unclear how such freedom can be exercised to generate images of specific unique concepts, modify their appearance, or compose them in new roles and novel scenes</p><p>Method:Using only 3-5 images of a user-provided concept, like an object or a style, we learn to represent it through new â€œwordsâ€ in the embedding space of a frozen text-to-image model. These â€œwordsâ€ can be composed into natural language sentences, guiding personalized creation in an intuitive way.</p><p>Results and findings:Notably, we find evidence that a single word embedding is sufficient for capturing unique and varied concepts. We compare our approach to a wide range of baselines, and demonstrate that it can more faithfully portray the concepts across a range of applications and tasks.</p><p>ä½œä¸ºç”¨æˆ·,æˆ‘ä»¬æ€æ ·æ‰èƒ½è¦æ±‚æ–‡æœ¬åˆ°å›¾åƒçš„æ¨¡å‹æ¥è®¾è®¡ä¸€ä¸ªåŒ…å«çè´µç«¥å¹´ç©å…·çš„æ–°å¥‡åœºæ™¯.</p><p>åœ¨å¤§è§„æ¨¡æ¨¡å‹ä¸­å¼•å…¥æ–°çš„æ¦‚å¿µå¾€å¾€æ˜¯å›°éš¾çš„.ä¸ºæ¯ä¸ªæ–°æ¦‚å¿µé‡æ–°è®­ç»ƒä¸€ä¸ªå…·æœ‰æ‰©å±•æ•°æ®é›†çš„æ¨¡å‹æ˜¯éå¸¸æ˜‚è´µçš„,<strong>åœ¨å°‘æ•°ä¾‹å­ä¸Šè¿›è¡Œå¾®è°ƒé€šå¸¸ä¼šå¯¼è‡´ç¾éš¾æ€§çš„é—å¿˜</strong>.å½“é¢å¯¹æ–°æ¦‚å¿µæ—¶,æ›´å¤šçš„æµ‹é‡æ–¹æ³•å†»ç»“æ¨¡å‹å¹¶è®­ç»ƒè½¬æ¢æ¨¡å—ä»¥é€‚åº”å…¶è¾“å‡º.ç„¶è€Œ,è¿™äº›æ–¹æ³•ä»ç„¶å®¹æ˜“é—å¿˜å…ˆéªŒçŸ¥è¯†,æˆ–è€…åœ¨ä¸æ–°å­¦ä¹ çš„æ¦‚å¿µåŒæ—¶è®¿é—®æ—¶é¢ä¸´å›°éš¾.</p><p>æå‡ºé€šè¿‡åœ¨é¢„è®­ç»ƒçš„T2Iæ¨¡å‹çš„textual embeddingä¸­å¯»æ‰¾æ–°è¯æ¥å…‹æœè¿™äº›æŒ‘æˆ˜.</p><p>æˆ‘ä»¬è€ƒè™‘æ–‡æœ¬ç¼–ç è¿‡ç¨‹çš„ç¬¬ä¸€é˜¶æ®µ.åœ¨è¿™é‡Œ,ä¸€ä¸ªè¾“å…¥å­—ç¬¦ä¸²é¦–å…ˆè¢«è½¬æ¢ä¸ºä¸€ç»„ä»¤ç‰Œ.ç„¶åå°†æ¯ä¸ªä»¤ç‰Œæ›¿æ¢ä¸ºè‡ªå·±çš„åµŒå…¥å‘é‡,è¿™äº›å‘é‡é€šè¿‡ä¸‹æ¸¸æ¨¡å‹è¿›è¡Œåé¦ˆ.æˆ‘ä»¬çš„ç›®æ ‡æ˜¯å¯»æ‰¾æ–°çš„åµŒå…¥å‘é‡æ¥è¡¨ç¤ºæ–°çš„ã€ç‰¹å®šçš„æ¦‚å¿µ.</p><p>æˆ‘ä»¬ç”¨ä¸€ä¸ªæ–°çš„pseudo-wordè¡¨ç¤ºä¸€ä¸ªæ–°çš„åµŒå…¥å‘é‡ï¼Œè®°ä¸ºS <em>ã€‚ç„¶åï¼Œè¿™ä¸ªä¼ªå•è¯è¢«å½“ä½œå…¶ä»–å•è¯ä¸€æ ·å¯¹å¾…ï¼Œå¹¶ä¸”å¯ä»¥ç”¨æ¥ä¸ºç”Ÿæˆæ¨¡å‹ç»„æˆæ–°çš„æ–‡æœ¬æŸ¥è¯¢ã€‚å› æ­¤ï¼Œäººä»¬å¯ä»¥è¦æ±‚â€ä¸€å¹…S </em>åœ¨æµ·æ»©ä¸Šçš„ç…§ç‰‡â€ï¼Œâ€ä¸€å¹…S <em>æŒ‚åœ¨å¢™ä¸Šçš„æ²¹ç”»â€ï¼Œç”šè‡³å¯ä»¥ç»„æˆä¸¤ä¸ªæ¦‚å¿µï¼Œå¦‚â€ä¸€å¹…S1 </em>åœ¨S2 *é£æ ¼çš„ç»˜ç”»â€ã€‚é‡è¦çš„æ˜¯ï¼Œè¿™ä¸€è¿‡ç¨‹æ²¡æœ‰è§¦åŠç”Ÿæˆæ¨¡å‹ã€‚</p><p>è¿™æ ·ï¼Œæˆ‘ä»¬ä¿ç•™äº†åœ¨æ–°ä»»åŠ¡ä¸Šå¾®è°ƒè§†è§‰å’Œè¯­è¨€æ¨¡å‹æ—¶é€šå¸¸ä¼šä¸¢å¤±çš„ä¸°å¯Œçš„æ–‡æœ¬ç†è§£å’Œæ³›åŒ–èƒ½åŠ›ã€‚</p><p>æˆ‘ä»¬ç»™å‡ºäº†ä¸€ä¸ªå›ºå®šçš„,ç»è¿‡é¢„è®­ç»ƒçš„æ–‡æœ¬åˆ°å›¾åƒæ¨¡å‹å’Œä¸€ä¸ªå°çš„å›¾åƒé›†æ¥æè¿°è¿™ä¸ªæ¦‚å¿µ.æˆ‘ä»¬çš„ç›®æ ‡æ˜¯æ‰¾åˆ°ä¸€ä¸ªå•è¯åµŒå…¥,ä½¿å¾—å½¢å¼ä¸ºâ€™ A photo of S * â€˜çš„å¥å­å°†å¯¼è‡´ä»æˆ‘ä»¬çš„å°é›†åˆä¸­é‡å»ºå›¾åƒã€‚è¿™ç§åµŒå…¥æ˜¯é€šè¿‡ä¸€ä¸ªä¼˜åŒ–è¿‡ç¨‹å‘ç°çš„,ç§°ä¹‹ä¸ºâ€æ–‡æœ¬åè½¬â€ ( Textual Inversion )</p><p><img data-src="https://s2.loli.net/2024/05/16/NJi3nmBfztA9xwe.png" alt="image-20240516154802746"></p><p>ä¸ºäº†æ‰¾åˆ°è¿™äº›æ–°çš„åµŒå…¥ä½¿ç”¨äº†ä¸€ç»„å›¾åƒ(ä¸€èˆ¬ä¸º3 - 5ä¸ª)ï¼Œå®ƒæè¿°äº†æˆ‘ä»¬çš„ç›®æ ‡æ¦‚å¿µ,æ¯”å¦‚ä¸åŒçš„èƒŒæ™¯æˆ–å§¿åŠ¿.</p><p>è®¾$c Î¸ ( y )$æ˜¯å°†ä¸€ä¸ªæ¡ä»¶è¾“å…¥yæ˜ å°„ä¸ºä¸€ä¸ªæ¡ä»¶å‘é‡çš„æ¨¡å‹</p><script type="math/tex; mode=display">L_{LDM}:=\mathbb{E}_{z\sim\mathcal{E}(x),y,\epsilon\sim\mathcal{N}(0,1),t}\Big[\|\epsilon-\epsilon_\theta(z_t,t,c_\theta(y))\|_2^2\Big]</script><p>é€šè¿‡ç›´æ¥ä¼˜åŒ–,æœ€å°åŒ–ä»å°é›†åˆä¸­é‡‡æ ·çš„å›¾åƒä¸Šå¼(çš„LDMæŸå¤±æ‰¾åˆ°v *ã€‚</p><p>ä¸ºäº†é™åˆ¶ç”Ÿæˆï¼Œæˆ‘ä»¬ä»CLIP ImageNetæ¨¡æ¿ä¸­éšæœºæŠ½å–ä¸­æ€§ä¸Šä¸‹æ–‡æ–‡æœ¬,</p><p>å…¶ä¸­åŒ…å«â€™ A photo of S <em> â€˜,â€™ A rendition of S </em> â€˜ç­‰å½¢å¼çš„æç¤ºã€‚åœ¨è¡¥å……ææ–™ä¸­æä¾›äº†æ¨¡æ¿çš„å®Œæ•´åˆ—è¡¨</p><script type="math/tex; mode=display">v_{*}=\arg\min_{v}\mathbb{E}_{z\sim\mathcal{E}(x),y,\epsilon\sim\mathcal{N}(0,1),t}\Big[\|\epsilon-\epsilon_{\theta}(z_{t},t,c_{\theta}(y))\|_{2}^{2}\Big]</script><p>é€šè¿‡å¤ç”¨ä¸åŸLDMæ¨¡å‹ç›¸åŒçš„è®­ç»ƒæ–¹æ¡ˆæ¥å®ç°ï¼ŒåŒæ—¶ä¿æŒ$c_Î¸$å’ŒÎ¸éƒ½å›ºå®šä¸å˜ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¿™æ˜¯ä¸€ä¸ªé‡å»ºä»»åŠ¡ã€‚å› æ­¤ï¼Œæˆ‘ä»¬æœŸæœ›å®ƒèƒ½å¤Ÿæ¿€åŠ±å­¦ä¹ åˆ°çš„åµŒå…¥æ¥æ•è·æ¦‚å¿µæ‰€ç‰¹æœ‰çš„ç²¾ç»†è§†è§‰ç»†èŠ‚.</p><blockquote><p>è¯´ç™½äº†åˆ©ç”¨æ–°çš„è®­ç»ƒé›†æ•°æ®å¯¹é‡æ–°è®­ç»ƒä¸€ä¸ªembeddingå±‚å°†æƒ³è¦çš„concepté€šè¿‡ä¸€ä¸ªtrigger word æ–‡æœ¬S^*^åµŒå…¥ç”Ÿæˆçš„å›¾åƒä¸­.</p></blockquote><h3 id="DreamBooth-Fine-Tuning-Text-to-Image-Diffusion-Models-for-Subject-Driven-Generation"><a href="#DreamBooth-Fine-Tuning-Text-to-Image-Diffusion-Models-for-Subject-Driven-Generation" class="headerlink" title="DreamBooth: Fine Tuning Text-to-Image Diffusion Models for Subject-Driven Generation"></a>DreamBooth: Fine Tuning Text-to-Image Diffusion Models for Subject-Driven Generation</h3><p>Background and task:å¤§å‹æ–‡æœ¬åˆ°å›¾åƒæ¨¡å‹åœ¨äººå·¥æ™ºèƒ½çš„æ¼”è¿›ä¸­å®ç°äº†ä»¤äººç©ç›®çš„é£è·ƒ,èƒ½å¤Ÿä»ç»™å®šçš„æ–‡æœ¬æç¤ºä¸­é«˜è´¨é‡å’Œå¤šæ ·åŒ–åœ°åˆæˆå›¾åƒ</p><p>Motivation:ç„¶è€Œ,è¿™äº›æ¨¡å‹ç¼ºä¹åœ¨ç»™å®šçš„å‚è€ƒé›†ä¸­æ¨¡ä»¿subjectsçš„å¤–è§‚å¹¶åœ¨ä¸åŒçš„ä¸Šä¸‹æ–‡ä¸­åˆæˆä»–ä»¬çš„æ–°ç‰ˆæœ¬çš„èƒ½åŠ›ã€‚</p><p>Method:åœ¨æœ¬æ–‡ä¸­,æå‡ºäº†ä¸€ç§æ–°çš„æ–¹æ³•æ¥å®ç°æ–‡æœ¬åˆ°å›¾åƒæ‰©æ•£æ¨¡å‹çš„â€ä¸ªæ€§åŒ–â€.ç»™å®šä¸€ä¸ªä¸»é¢˜çš„å°‘é‡å›¾åƒä½œä¸ºè¾“å…¥,æˆ‘ä»¬å¾®è°ƒä¸€ä¸ªé¢„è®­ç»ƒçš„æ–‡æœ¬åˆ°å›¾åƒæ¨¡å‹,ä½¿å…¶å­¦ä¼šå°†ä¸€ä¸ªå”¯ä¸€çš„æ ‡è¯†ç¬¦ä¸è¯¥ç‰¹å®šä¸»é¢˜ç»‘å®šã€‚é€šè¿‡åˆ©ç”¨åµŒå…¥åœ¨æ¨¡å‹ä¸­çš„è¯­ä¹‰å…ˆéªŒå’Œæ–°çš„è‡ªé€‚åº”ç±»ç‰¹å®šå…ˆéªŒä¿æŒæŸå¤±ï¼Œæˆ‘ä»¬çš„æŠ€æœ¯èƒ½å¤Ÿåœ¨å‚è€ƒå›¾åƒä¸­æ²¡æœ‰å‡ºç°çš„ä¸åŒåœºæ™¯ã€å§¿åŠ¿ã€è§†å›¾å’Œå…‰ç…§æ¡ä»¶ä¸‹åˆæˆä¸»é¢˜</p><p>Results and findings:æˆ‘ä»¬å°†æˆ‘ä»¬çš„æŠ€æœ¯åº”ç”¨åˆ°å‡ ä¸ªä»¥å‰æ— æ³•è§£å†³çš„ä»»åŠ¡ä¸­ï¼ŒåŒ…æ‹¬ä¸»é¢˜è¯­å¢ƒåŒ–ã€æ–‡æœ¬å¼•å¯¼çš„è§†å›¾åˆæˆå’Œè‰ºæœ¯æ¸²æŸ“ï¼ŒåŒæ—¶ä¿ç•™äº†ä¸»é¢˜çš„å…³é”®ç‰¹å¾ã€‚æˆ‘ä»¬ä¹Ÿä¸ºè¯¾é¢˜é©±åŠ¨å¼ä»£è¿™ä¸€æ–°ä»»åŠ¡æä¾›äº†æ–°çš„æ•°æ®é›†å’Œè¯„ä¼°æ–¹æ¡ˆ.</p><p>æœ€è¿‘å¼€å‘çš„å¤§å‹æ–‡æœ¬åˆ°å›¾åƒæ¨¡å‹æ˜¾ç¤ºå‡ºå‰æ‰€æœªæœ‰çš„èƒ½åŠ›ï¼Œé€šè¿‡å®ç°åŸºäºè‡ªç„¶è¯­è¨€[ç¼–å†™çš„æ–‡æœ¬æç¤ºçš„é«˜è´¨é‡å’Œå¤šæ ·åŒ–çš„å›¾åƒåˆæˆã€‚è¿™ç±»æ¨¡å‹çš„ä¸»è¦ä¼˜ç‚¹ä¹‹ä¸€æ˜¯ä»å¤§é‡çš„å›¾åƒ-å­—å¹•å¯¹é›†åˆä¸­å­¦ä¹ åˆ°çš„å¼ºè¯­ä¹‰å…ˆéªŒã€‚ä¾‹å¦‚ï¼Œè¿™ç§å…ˆéªŒå­¦ä¹ å°†â€ç‹—â€è¿™ä¸ªè¯ä¸å›¾åƒä¸­å¯ä»¥å‡ºç°åœ¨ä¸åŒå§¿åŠ¿å’Œä¸Šä¸‹æ–‡ä¸­çš„å„ç§ç‹—çš„å®ä¾‹ç»‘å®šåœ¨ä¸€èµ·ã€‚è™½ç„¶è¿™äº›æ¨¡å‹çš„ç»¼åˆèƒ½åŠ›æ˜¯å‰æ‰€æœªæœ‰çš„ï¼Œä½†å®ƒä»¬<strong>ç¼ºä¹åœ¨ç»™å®šçš„å‚è€ƒé›†åˆä¸­æ¨¡ä»¿å—è¯•è€…çš„å¤–è§‚ï¼Œå¹¶åœ¨ä¸åŒçš„ä¸Šä¸‹æ–‡ä¸­åˆæˆç›¸åŒå—è¯•è€…çš„æ–°ç‰ˆæœ¬çš„èƒ½åŠ›ã€‚</strong>ä¸»è¦åŸå› æ˜¯å®ƒä»¬çš„<strong>è¾“å‡ºåŸŸè¡¨è¾¾èƒ½åŠ›æœ‰é™ï¼›å³ä½¿æ˜¯å¯¹ä¸€ä¸ªå¯¹è±¡æœ€è¯¦ç»†çš„æ–‡å­—æè¿°ï¼Œä¹Ÿå¯èƒ½äº§ç”Ÿä¸åŒå¤–è§‚çš„å®ä¾‹</strong>.ä¸€æ—¦æ–°çš„å­—å…¸åµŒå…¥åˆ°æ¨¡å‹ä¸­ï¼Œå®ƒå°±å¯ä»¥ä½¿ç”¨è¿™äº›å•è¯æ¥åˆæˆæ–°çš„ä¸»é¢˜çœŸå®æ„Ÿå›¾åƒï¼Œåœ¨ä¸åŒçš„åœºæ™¯ä¸­è¿›è¡Œè¯­å¢ƒåŒ–ï¼ŒåŒæ—¶ä¿ç•™å®ƒä»¬çš„å…³é”®è¯†åˆ«ç‰¹å¾.</p><p>æ›´æ­£å¼åœ°è¯´,ç»™å®šä¸€ä¸ªä¸»ä½“çš„å‡ å¹…å›¾åƒ,æˆ‘ä»¬çš„ç›®æ ‡æ˜¯å°†ä¸»ä½“æ¤å…¥æ¨¡å‹çš„è¾“å‡ºåŸŸ,ä½¿å…¶èƒ½å¤Ÿç”¨<strong>å”¯ä¸€çš„æ ‡è¯†ç¬¦</strong>è¿›è¡Œåˆæˆ.ä¸ºæ­¤æå‡ºä¸€ç§æŠ€æœ¯,ç”¨å°‘æœ‰çš„identifierè¡¨ç¤ºç»™å®šçš„ä¸»é¢˜,å¹¶å¾®è°ƒä¸€ä¸ªé¢„è®­ç»ƒçš„ã€åŸºäºæ‰©æ•£çš„æ–‡æœ¬åˆ°å›¾åƒæ¡†æ¶.</p><p>æˆ‘ä»¬ç”¨è¾“å…¥çš„å›¾åƒå’Œæ–‡æœ¬æç¤ºå¾®è°ƒæ–‡æœ¬åˆ°å›¾åƒçš„æ¨¡å‹,å…¶ä¸­åŒ…å«ä¸€ä¸ªæƒŸä¸€çš„æ ‡è¯†ç¬¦,åé¢è·Ÿç€ä¸»ä½“çš„ç±»å.</p><p>æˆ‘ä»¬çš„æ–¹æ³•æ˜¯åœ¨è¯æ±‡ä¸­æ‰¾åˆ°ç¨€æœ‰çš„æ ‡è®°,ç„¶åå°†è¿™äº›æ ‡è®°è½¬æ¢åˆ°æ–‡æœ¬ç©ºé—´,ä»¥æœ€å°åŒ–æ ‡è¯†ç¬¦å…·æœ‰å¼ºå…ˆéªŒçš„æ¦‚ç‡.</p><p><img data-src="https://s2.loli.net/2024/05/16/XByeJxlZGNnv7ER.png" alt="image-20240516162142224"></p><script type="math/tex; mode=display">\mathbb{E}_{\mathbf{x},\mathbf{c},\boldsymbol{\epsilon},\boldsymbol{\epsilon}^{\prime},t}[w_t\|\hat{\mathbf{x}}_\theta(\alpha_t\mathbf{x}+\sigma_t\boldsymbol{\epsilon},\mathbf{c})-\mathbf{x}\|_2^2+\\\lambda w_{t^{\prime}}\|\hat{\mathbf{x}}_\theta(\alpha_{t^{\prime}}\mathbf{x}_{\mathbf{pr}}+\sigma_{t^{\prime}}\boldsymbol{\epsilon}^{\prime},\mathbf{c}_{\mathbf{pr}})-\mathbf{x}_{\mathbf{pr}}\|_2^2]</script><p>ä¸¤ä¸ªå…³é”®é—®é¢˜:åœ¨å°æ•°æ®é›†ä¸Šå¾®è°ƒå¯èƒ½å‡ºç°language driftæˆ–è€…ç¾éš¾æ€§é—å¿˜.æ­¤å¤–è¿˜æœ‰å¯èƒ½å‡ºç°çš„å¤šæ ·æ€§é™ä½.</p><p>å…·ä½“æ¥è¯´ï¼Œåœ¨å¸¦æœ‰éšæœºåˆå§‹å™ªå£°$z<em>{t1}~N(0,I)$å’Œæ¡ä»¶å‘é‡$c</em>{pr}:=Î“ (f(â€˜a[ç±»åè¯]â€™))$çš„å†·å†»é¢„è®­ç»ƒæ‰©æ•£æ¨¡å‹ä¸Šä½¿ç”¨ç¥–å…ˆé‡‡æ ·å™¨ç”Ÿæˆæ•°æ®$x<em>{pr} = [\hat{x}(z</em>{t1},c_{pr})]$.</p><p>å‰åŠéƒ¨åˆ†è®©æ¨¡å‹å­¦ä¹ ç‰¹å®šç‰©å“çš„è¡¨ç¤º,ååŠé€šè¿‡ç”Ÿæˆå›¾ç‰‡çš„ç›‘ç£é˜²æ­¢æ¨¡å‹å¿˜è®°å…ˆéªŒçŸ¥è¯†.</p><h3 id="Hypernetworks"><a href="#Hypernetworks" class="headerlink" title="Hypernetworks"></a>Hypernetworks</h3><p>è¿™é¡¹å·¥ä½œæ¢è®¨äº†è¶…ç½‘ç»œï¼šä¸€ç§ä½¿ç”¨ä¸€ä¸ªç½‘ç»œ(ä¹Ÿç§°ä¸ºè¶…ç½‘ç»œ)ä¸ºå¦ä¸€ä¸ªç½‘ç»œç”Ÿæˆæƒé‡çš„æ–¹æ³•ã€‚è¶…ç½‘ç»œæä¾›äº†ä¸€ç§ç±»ä¼¼äºè‡ªç„¶ç•Œä¸­å‘ç°çš„æŠ½è±¡ï¼šåŸºå› å‹-è¶…ç½‘ç»œ-å’Œè¡¨å‹-ä¸»ç½‘ç»œä¹‹é—´çš„å…³ç³»ã€‚</p><h3 id="LoRA"><a href="#LoRA" class="headerlink" title="LoRA"></a>LoRA</h3><p>æœ¬èº«æ˜¯ä¸€ç§å¾®è°ƒæŠ€æœ¯,æˆ‘åœ¨å¤§æ¨¡å‹ä¸€èŠ‚ä¸­æ¶‰åŠåˆ°äº†,è¿™é‡Œä¸èµ˜è¿°.</p><h3 id="Samplers-in-Stable-Diffusion"><a href="#Samplers-in-Stable-Diffusion" class="headerlink" title="Samplers in Stable Diffusion"></a>Samplers in Stable Diffusion</h3><p>åœ¨ä½¿ç”¨Stable Diffusionåº”ç”¨æ—¶æƒ³åˆ°çš„,é‡‡æ ·å™¨æ˜¯ä»€ä¹ˆ,èƒ½èµ·åˆ°å¤šå¤§çš„ä½œç”¨.</p><p>è¦ç”Ÿæˆå›¾åƒï¼Œæ¨¡å‹é¦–å…ˆè¦åœ¨æ½œç©ºé—´ç”Ÿæˆä¸€ä¸ªå®Œå…¨éšæœºçš„å›¾åƒ.ç„¶å,å™ªå£°é¢„æµ‹å™¨ä¼°ç®—å›¾åƒçš„å™ªå£°ã€‚ä»å›¾åƒä¸­å‡å»é¢„æµ‹çš„å™ªå£°.è¿™ä¸ªè¿‡ç¨‹è¦é‡å¤åå‡ æ¬¡.</p><p>è¿™ä¸ªå»å™ªè¿‡ç¨‹è¢«ç§°ä¸ºé‡‡æ ·,å› ä¸ºç¨³å®šæ‰©æ•£æŠ€æœ¯æ¯ä¸€æ­¥éƒ½ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„æ ·æœ¬å›¾åƒ.é‡‡æ ·ä¸­ä½¿ç”¨çš„æ–¹æ³•ç§°ä¸ºé‡‡æ ·å™¨æˆ–é‡‡æ ·æ–¹æ³•.</p><p>å™ªå£°å›¾åƒæ˜¯æ¯æ­¥å‡å»æ¨¡å‹é¢„æµ‹å‡ºçš„å™ªå£°ï¼Œä¸€ç‚¹ä¸€ç‚¹å˜æˆå¹²å‡€å›¾åƒçš„ã€‚noise schedule å°±æ˜¯ç”¨æ¥æ§åˆ¶åœ¨æ¯ä¸ªé‡‡æ ·æ­¥ä¸­å™ªå£°çš„å¼ºåº¦çš„ã€‚å™ªå£°åœ¨ç¬¬ä¸€æ­¥æœ€å¤§ï¼Œæ…¢æ…¢é™ä½ï¼Œç›´åˆ°æœ€åä¸€æ­¥é™ä¸º0ã€‚</p><p>åœ¨æ¯ä¸€æ­¥ä¸­ï¼Œé‡‡æ ·å™¨çš„å·¥ä½œå°±æ˜¯æ ¹æ® noise schedule ä¸­å¯¹åº”çš„è¯¥æ­¥çš„å™ªå£°å¼ºåº¦ï¼Œå‡å»å¯¹åº”çš„å™ªå£°ï¼Œæ¥äº§ç”Ÿè¯¥æ­¥çš„å»å™ªå›¾åƒã€‚å¦‚æœæˆ‘ä»¬å¢å¤§é‡‡æ ·æ­¥æ•°ä¼šæœ‰ä»€ä¹ˆå½±å“å‘¢ï¼Ÿæ¯ä¸€æ­¥å™ªå£°ä¸‹é™çš„ä¼šæ›´å°‘ï¼Œè¿™æœ‰åŠ©äºå‡å°‘é‡‡æ ·è¿‡ç¨‹ä¸­çš„æˆªæ–­è¯¯å·®ã€‚</p><p>é‡‡æ ·å™¨å¯ä»¥åˆ†ä¸ºç»å…¸åŸºäºå¾®åˆ†å…¬å¼,ç¥–å…ˆé‡‡æ ·å™¨,Karras,</p><ul><li><strong>Euler</strong> â€“ The simplest possible solver.</li><li><strong>Heun</strong> â€“ A more accurate but slower version of Euler.</li><li><strong>LMS</strong> (Linear multi-step method) â€“ Same speed as Euler but (supposedly) more accurate.</li></ul><p>ç¥–å…ˆé‡‡æ ·å™¨åœ¨æ¯ä¸ªé‡‡æ ·æ­¥éª¤ä¸­éƒ½ä¼šç»™å›¾åƒæ·»åŠ å™ªå£°.å®ƒä»¬æ˜¯éšæœºå–æ ·å™¨,å› ä¸ºå–æ ·ç»“æœå…·æœ‰ä¸€å®šçš„éšæœºæ€§</p><ul><li>Euler a</li><li>DPM2 a</li><li>DPM++ 2S a</li><li>DPM++ 2S a Karras</li></ul><p>DPMï¼ˆæ‰©æ•£æ¦‚ç‡æ¨¡å‹æ±‚è§£å™¨ï¼‰å’Œ DPM++ æ˜¯ 2022 å¹´å‘å¸ƒçš„ä¸“ä¸ºæ‰©æ•£æ¨¡å‹è®¾è®¡çš„æ–°å‹é‡‡æ ·å™¨.å®ƒä»¬ä»£è¡¨äº†ç»“æ„ç›¸ä¼¼çš„æ±‚è§£å™¨ç³»åˆ—ã€‚</p><p>DPM å’Œ DPM2 ç›¸ä¼¼,åªæ˜¯ DPM2 æ˜¯äºŒé˜¶çš„(æ›´ç²¾ç¡®ä½†æ›´æ…¢).DPM++ æ˜¯ DPM çš„æ”¹è¿›ç‰ˆã€‚</p><p>UniPC(Unified Predictor-Corrector)æ˜¯ 2023å¹´çš„ä¸€ç§æ–°å‹é‡‡æ ·å™¨ã€‚å®ƒå—åˆ°ä¼ ç»Ÿsamplerä¸­é¢„æµ‹å™¨-æ ¡æ­£å™¨æ–¹æ³•çš„å¯å‘,å¯åœ¨ 5-10 æ­¥å†…å®ç°é«˜è´¨é‡å›¾åƒç”Ÿæˆã€‚</p><p>ä¸€äº›ä»£ç å®ç°å¯ä»¥åœ¨<a href="https://github.com/crowsonkb/k-diffusion">crowsonkb/k-diffusion: Karras et al. (2022) diffusion models for PyTorch (github.com)</a>æ‰¾åˆ°.</p><p>å¯ä»¥åˆ©ç”¨ä¸€äº›è¯­ä¹‰åˆ†å‰²å’Œpromptåˆ†å‰²å®ä¾‹æ›´æ–¹ä¾¿åœ°åšinpainting.</p><h3 id="SegmentAnything-Model"><a href="#SegmentAnything-Model" class="headerlink" title="SegmentAnything Model"></a>SegmentAnything Model</h3><p><a href="https://www.comet.com/site/blog/sam-stable-diffusion-for-text-to-image-inpainting/">SAM + Stable Diffusion for Text-to-Image Inpainting - Comet</a></p><p><img data-src="https://s2.loli.net/2024/05/16/vipLYs8BIod6S5y.png" alt="image-20240516145103520"></p><p><img data-src="https://s2.loli.net/2024/05/16/p64VkA97Lsy2mdK.png" alt="image-20240516145131501"></p><p><img data-src="https://s2.loli.net/2024/05/16/cWSidGqjVaNDI3R.png" alt="image-20240516145825637"></p><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ol><li><a href="https://github.com/mli/paper-reading?tab=readme-ov-file">mli/paper-reading: æ·±åº¦å­¦ä¹ ç»å…¸ã€æ–°è®ºæ–‡é€æ®µç²¾è¯» (github.com)</a></li><li><a href="https://maciejdomagala.github.io/generative_models/2022/06/06/The-recent-rise-of-diffusion-based-models.html">The recent rise of diffusion-based models | Maciej DomagaÅ‚a (maciejdomagala.github.io)</a></li><li><a href="https://stable-diffusion-art.com/">Stable Diffusion Art - Tutorials, prompts and resources (stable-diffusion-art.com)</a></li><li><a href="https://jalammar.github.io/illustrated-stable-diffusion/">The Illustrated Stable Diffusion â€“ Jay Alammar â€“ Visualizing machine learning one concept at a time. (jalammar.github.io)</a></li><li><a href="https://arxiv.org/pdf/2206.00927">arxiv.org/pdf/2206.00927</a></li></ol><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
    
    
    <summary type="html">&lt;p&gt;ä¸»è¦çœ‹æ˜¯çœ‹Diffusion Models,CLIP,ControlNet,IP-Adapterè¿™ç§ç»å…¸è®ºæ–‡,å°è¯•æ€»ç»“è®ºæ–‡å†™ä½œçš„ä¸€äº›æ–¹å¼ä»¥åŠå›¾åƒç”Ÿæˆæ¨¡å‹çš„ä¸€äº›å†…åœ¨æ€æƒ³. å¯¹äºå…¶ä¸­çš„æ•°å­¦åŸç†å’Œä»£ç ä¸è¿‡æ·±ç©¶.&lt;br&gt;</summary>
    
    
    
    
    <category term="deep learning" scheme="https://www.sekyoro.top/tags/deep-learning/"/>
    
    <category term="generative ai" scheme="https://www.sekyoro.top/tags/generative-ai/"/>
    
  </entry>
  
</feed>
