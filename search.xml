<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>实战写浏览器插件</title>
      <link href="2023/03/23/%E5%AE%9E%E6%88%98%E5%86%99%E6%B5%8F%E8%A7%88%E5%99%A8%E6%8F%92%E4%BB%B6/"/>
      <url>2023/03/23/%E5%AE%9E%E6%88%98%E5%86%99%E6%B5%8F%E8%A7%88%E5%99%A8%E6%8F%92%E4%BB%B6/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>写一些浏览器脚本或者插件方便平时的自动化操作.<br>油猴脚本编写不难,但考虑到浏览器插件可能涉及功能多同时并不是所有人会去安装一个类似油猴的插件,所以这里选择开发插件</p><span id="more"></span><p>现在Edge浏览器和Chrome浏览器都差不太多,需要修改一些API即可进行移植,这里选择Chrome浏览器,因为谷歌官方教程写得更详细一些.</p><p>如果要从谷歌浏览器插件迁移到Edge,也只需要修改一些不支持的API即可</p><p>Microsoft Edge 不支持以下扩展 API：</p><ul><li><code>chrome.gcm</code>.</li><li><code>chrome.identity.getAccounts</code>.</li><li><code>chrome.identity.getAuthToken</code> - 作为替代项，可以使用 <code>launchWebAuthFlow</code> 提取 OAuth2 令牌来对用户进行身份验证。</li><li><code>chrome.instanceID</code>.</li></ul><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ol><li><a href="https://learn.microsoft.com/zh-cn/microsoft-edge/extensions-chromium/getting-started/part1-simple-extension?tabs=v3">创建扩展教程，第 1 部分 - Microsoft Edge Development | Microsoft Learn</a></li></ol><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
            <tag> 油猴脚本 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vscode+latex本地搭建tex写论文</title>
      <link href="2023/03/22/vscode-latex%E6%9C%AC%E5%9C%B0%E6%90%AD%E5%BB%BAtex%E5%86%99%E8%AE%BA%E6%96%87/"/>
      <url>2023/03/22/vscode-latex%E6%9C%AC%E5%9C%B0%E6%90%AD%E5%BB%BAtex%E5%86%99%E8%AE%BA%E6%96%87/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>如果是为了方便简洁,实际使用<a href="https://www.overleaf.com/">Overleaf</a>完全够了,之前也写过使用Obsidian写文章的教程. 这次主要介绍使用在本地vscode加上插件写论文.<br><span id="more"></span></p><h2 id="需要工具"><a href="#需要工具" class="headerlink" title="需要工具"></a>需要工具</h2><ol><li><strong>vscode</strong> 官网即可</li><li><strong>texlive</strong> 通过镜像站即可,比如<a href="https://mirrors.tuna.tsinghua.edu.cn/CTAN/systems/texlive/Images/">Index of /CTAN/systems/texlive/Images/ | 清华大学开源软件镜像站 | Tsinghua Open Source Mirror</a></li></ol><p><img data-src="http://cdn.sekyoro.top/imgs/22/0320230322162307.png" alt="image-20230322162300639" style="zoom:67%;" /></p><p>选中箭头指向的其中一个即可,然后一步一步来即可.可以参考相关教程<a href="https://zhuanlan.zhihu.com/p/493412905">TeX Live 2022 安装指南【安装 LaTeX】</a>. 安装TexLive目的就是为了有个解析引擎,类似与c++程序下载g++一样</p><ol><li><a href="https://www.sumatrapdfreader.org/free-pdf-reader">Sumatra PDF (sumatrapdfreader.org)</a>  用于查看pdf,当然用其他的也可以.这是一个开源免费的pdf阅读器,用于查看tex编译后得到的pdf,并且设置反向搜索(即双击pdf的某个位置可以跳转到tex代码相应的位置)</li></ol><h3 id="配置步骤"><a href="#配置步骤" class="headerlink" title="配置步骤"></a>配置步骤</h3><p><strong>下载texlive之后</strong>,进行测试是否安装成功. 在命令行输入</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tex</span><br></pre></td></tr></table></figure><p>显示</p><p><img data-src="http://cdn.sekyoro.top/imgs/22/0320230322163046.png" alt="image-20230322163046678"></p><p>表示安装成功.</p><p><strong>在vscode中</strong>下载插件Latex Workshop,用于有效地编译预览tex文件.</p><p><img data-src="http://cdn.sekyoro.top/imgs/22/0320230322162850.png" alt="image-20230322162849810" style="zoom:50%;" /></p><p>当然你也可以同时下载其他用于自动补全tex的插件.然后进行配置.</p><p>如果你还不了解tex相关的一类东西,可以在文章末尾<strong>参考资料</strong>中查看Tex家族.</p><h4 id="简单实用"><a href="#简单实用" class="headerlink" title="简单实用"></a>简单实用</h4><p><img data-src="http://cdn.sekyoro.top/imgs/22/0320230322163519.png" alt="image-20230322163519674"></p><p>下载了插件后,你会注意到左部有这个插件标识,点击即可. 发现上面有相关命令.有编译,查看pdf,导向等等. 我们常用的就是构建,值得注意的是我们构建就是利用工具设置工具链进行一套编译流程.</p><p>现在你就可以写tex然后点击 <code>pdflatex-&gt;bibtex-&gt;pdflatex*2</code>即可得到pdf</p><p><img data-src="http://cdn.sekyoro.top/imgs/22/0320230322163846.png" alt="image-20230322163846157"></p><p>但是你会发现使用中文会报错,所以接下来我们会进行相关配置.</p><blockquote><ul><li>TeX：1978年由Donald Erwin Knuth（高德纳）开发。是后来大部分TeX相关的基础。其生成dvi文件，然后经由其他程序转换为pdf文件。</li><li>pdfTeX：Tex语言的又一个实现，将TeX代码直接编译成PDF文件。</li><li>XeTeX：TeX 语言的新的实现，支持 Unicode 编码和直接访问操作系统字体。</li><li>LuaTeX：TeX 语言的一个完整的有扩展的实现。LuaTeX支持Unicode、系统字体和内嵌语言扩展，能直接输出PDF格式文件，也可以仍然输出 DVI 格式。</li></ul></blockquote><p>我们需要增加xelatex工具.首先在设置中搜索<code>tools</code></p><p><img data-src="http://cdn.sekyoro.top/imgs/22/0320230322164243.png" alt="image-20230322164243143" style="zoom:50%;" /></p><p>点击setting.json配置，增加xelatex,代码如下.即数组中的第一项.</p><p><img data-src="http://cdn.sekyoro.top/imgs/22/0320230322164343.png" alt="image-20230322164343493" style="zoom:67%;" /></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">  &#123;</span><br><span class="line">    <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;xelatex&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;command&quot;</span>: <span class="string">&quot;xelatex&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;args&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;-synctex=1&quot;</span>,</span><br><span class="line">        <span class="string">&quot;-interaction=nonstopmode&quot;</span>,</span><br><span class="line">        <span class="string">&quot;-file-line-error&quot;</span>,</span><br><span class="line">        <span class="string">&quot;%DOCFILE%&quot;</span></span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>以上相当于增加了一个tool.</p><p>现在需要增加一个recipe,相当于一套流程,这个流程需要用到xelatex.</p><p>设置中搜索recipe</p><p><img data-src="http://cdn.sekyoro.top/imgs/22/0320230322164525.png" alt="image-20230322164525817"></p><p>点击setting.json,增加红框的代码</p><p><img data-src="http://cdn.sekyoro.top/imgs/22/0320230322164546.png" alt="image-20230322164546431" style="zoom:50%;" /></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;xelatex&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;tools&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;xelatex&quot;</span></span><br><span class="line">    ],</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;xelatex ➞ bibtex ➞ xelatex × 2&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;tools&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;xelatex&quot;</span>,</span><br><span class="line">        <span class="string">&quot;bibtex&quot;</span>,</span><br><span class="line">        <span class="string">&quot;xelatex&quot;</span>,</span><br><span class="line">        <span class="string">&quot;xelatex&quot;</span></span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>现在你可以看见增加的recipe了,如红箭头所示. 现在支持tex中有中文了.</p><p>注意需要使用ctex包</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">\usepackage</span>&#123;ctex&#125;</span><br></pre></td></tr></table></figure><p><img data-src="http://cdn.sekyoro.top/imgs/22/0320230322164634.png" alt="image-20230322164634064"></p><h3 id="实现正反向搜索"><a href="#实现正反向搜索" class="headerlink" title="实现正反向搜索"></a>实现正反向搜索</h3><p>这里使用sumatra作为external的pdf阅读器并实现双向搜索.</p><p>设置中搜索viewer.</p><p><img data-src="http://cdn.sekyoro.top/imgs/22/0320230322165018.png" alt="image-20230322165018028" style="zoom: 67%;" /></p><p><img data-src="http://cdn.sekyoro.top/imgs/22/0320230322165037.png" alt="image-20230322165036922" style="zoom:67%;" /></p><p>设置external同时设置sumatra安装路径.</p><h4 id="正向搜索"><a href="#正向搜索" class="headerlink" title="正向搜索"></a>正向搜索</h4><p>在设置中搜索 viewer,看到下图参数设置.</p><p><img data-src="http://cdn.sekyoro.top/imgs/22/0320230322165147.png" alt="image-20230322165147100" style="zoom:67%;" /></p><p>注意,这里可以先尝试随便添加项,然后在setting.json中查找这个配置.</p><p>将这个参数修改如下,注意其中的逆向搜索路径(这里是<code>&quot;D:/Microsoft VS Code/Code.exe\&quot; \&quot;D:/Microsoft VS Code/resources/app/out/cli.js\&quot; -r -g \&quot;%f:%l\&quot;</code>)表示vscode相关下载位置,注意使用自己安装vscode的相关位置.</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;latex-workshop.view.pdf.external.viewer.args&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;-forward-search&quot;</span>,</span><br><span class="line">    <span class="string">&quot;%TEX%&quot;</span>,</span><br><span class="line">    <span class="string">&quot;%LINE%&quot;</span>,</span><br><span class="line">    <span class="string">&quot;-reuse-instance&quot;</span>,</span><br><span class="line">    <span class="string">&quot;-inverse-search&quot;</span>,</span><br><span class="line">    <span class="string">&quot;\&quot;D:/Microsoft VS Code/Code.exe\&quot; \&quot;D:/Microsoft VS Code/resources/app/out/cli.js\&quot; -r -g \&quot;%f:%l\&quot;&quot;</span>,</span><br><span class="line">    <span class="string">&quot;%PDF%&quot;</span>,</span><br><span class="line">  ],</span><br></pre></td></tr></table></figure><p>然后就配置成功了(事实上并没有完全成功,具体可以看下面的<a href="#attention">注意</a>).</p><p>正向搜索方法:平时选择其中之一即可</p><ol><li><p><img data-src="http://cdn.sekyoro.top/imgs/22/03image-20230322165523694.png" alt="image-20230322165523694"></p></li><li><p>按下<code>Ctrl+Alt+J</code>，直接跳转至PDF对应的地方。</p></li><li><p>点击<strong>View LaTeX PDF -&gt; View in external viewer</strong>。</p></li></ol><h4 id="逆向搜索"><a href="#逆向搜索" class="headerlink" title="逆向搜索"></a>逆向搜索</h4><p>设置中搜索Synctex,配置参数和命令. 跟上面的其实类似. </p><p><img data-src="http://cdn.sekyoro.top/imgs/22/0320230322165700.png" alt="image-20230322165659967" style="zoom:80%;" /></p><p><code>latex-workshop.view.pdf.external.synctex.args</code>参数配置如下</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;-forward-search&quot;</span>,</span><br><span class="line">   <span class="string">&quot;%TEX%&quot;</span>,</span><br><span class="line">   <span class="string">&quot;%LINE%&quot;</span>,</span><br><span class="line">   <span class="string">&quot;-reuse-instance&quot;</span>,</span><br><span class="line">   <span class="string">&quot;-inverse-search&quot;</span>,</span><br><span class="line">   <span class="string">&quot;\&quot;D:/Microsoft VS Code/Code.exe\&quot; \&quot;D:/Microsoft VS Code/resources/app/out/cli.js\&quot; -r -g \&quot;%f:%l\&quot;&quot;</span>,</span><br><span class="line">   <span class="string">&quot;%PDF%&quot;</span>,</span><br></pre></td></tr></table></figure><p>上面的路径也是根据你下载vscode的路径配置.</p><h3 id="注意"><a href="#注意" class="headerlink" title="注意"></a><a id="attention">注意</a></h3><p>事实上要实现在sumatra中反向搜索,你还需要进行其他配置. 打开sumatra,点击左上角选择<strong>高级选项</strong>.</p><p><img data-src="http://cdn.sekyoro.top/imgs/22/0320230322170018.png" alt="image-20230322170018604" style="zoom:67%;" /></p><p>搜索<code>InverseSearchCmdLine</code> 可以发现这里的值应该已经被设置了.后面发现,按照上述设置在vscode中打开sumatra后会将这里的参数设置会vscode中配置的,但是现在需要更改一下.</p><p>在vscode配置中,逆向搜索增加<code>--ms-enable-electron-run-as-node</code>参数.</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;latex-workshop.view.pdf.external.viewer.args&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;-forward-search&quot;</span>,</span><br><span class="line">    <span class="string">&quot;%TEX%&quot;</span>,</span><br><span class="line">    <span class="string">&quot;%LINE%&quot;</span>,</span><br><span class="line">    <span class="string">&quot;-reuse-instance&quot;</span>,</span><br><span class="line">    <span class="string">&quot;-inverse-search&quot;</span>,</span><br><span class="line">    <span class="string">&quot;\&quot;D:/Microsoft VS Code/Code.exe\&quot; \&quot;D:/Microsoft VS Code/resources/app/out/cli.js\&quot; --ms-enable-electron-run-as-node -r -g \&quot;%f:%l\&quot;&quot;</span>,</span><br><span class="line">    <span class="string">&quot;%PDF%&quot;</span>,</span><br><span class="line">  ],</span><br><span class="line">  <span class="string">&quot;latex-workshop.view.pdf.external.synctex.command&quot;</span>: <span class="string">&quot;D:\\SumatraPDF\\SumatraPDF.exe&quot;</span>,</span><br><span class="line">  <span class="string">&quot;latex-workshop.view.pdf.external.synctex.args&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;-forward-search&quot;</span>,</span><br><span class="line">    <span class="string">&quot;%TEX%&quot;</span>,</span><br><span class="line">    <span class="string">&quot;%LINE%&quot;</span>,</span><br><span class="line">    <span class="string">&quot;-reuse-instance&quot;</span>,</span><br><span class="line">    <span class="string">&quot;-inverse-search&quot;</span>,</span><br><span class="line">    <span class="string">&quot;\&quot;D:/Microsoft VS Code/Code.exe\&quot; \&quot;D:/Microsoft VS Code/resources/app/out/cli.js\&quot; --ms-enable-electron-run-as-node -r -g \&quot;%f:%l\&quot;&quot;</span>,</span><br><span class="line">    <span class="string">&quot;%PDF%&quot;</span>,</span><br><span class="line">  ],</span><br></pre></td></tr></table></figure><p>这样双击sumatra中的pdf即可跳转到vscode中的tex相应位置了.</p><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><ol><li><a href="https://zhuanlan.zhihu.com/p/273343930">在vscode中使用latex高效书写论文教程 - 知乎 (zhihu.com)</a></li><li><a href="https://zhuanlan.zhihu.com/p/144729565">学术论文写作利器—— VS Code + LaTeX - 知乎 (zhihu.com)</a></li><li><a href="https://zhuanlan.zhihu.com/p/71432461">VS Code下配置LaTeX编译环境 - 知乎 (zhihu.com)</a></li><li><a href="https://zhuanlan.zhihu.com/p/434142338">VScode+Latex+SumatraPDF反向搜索失败解决办法（Version 1.63） - 知乎 (zhihu.com)</a></li><li><a href="https://zhuanlan.zhihu.com/p/248669482">TeX 家族（TeX, XeTeX, LuaTeX,XeLaTeX …看完这篇就懂了） - 知乎 (zhihu.com)</a></li></ol><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> latex </category>
          
      </categories>
      
      
        <tags>
            
            <tag> latex </tag>
            
            <tag> vscode </tag>
            
            <tag> sumatra </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>STL学习</title>
      <link href="2023/03/05/STL%E5%AD%A6%E4%B9%A0/"/>
      <url>2023/03/05/STL%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>刷算法时有必要使用一些stl.<br><span id="more"></span></p><h2 id="容器"><a href="#容器" class="headerlink" title="容器"></a>容器</h2><h3 id="序列式容器"><a href="#序列式容器" class="headerlink" title="序列式容器"></a>序列式容器</h3><h4 id="array"><a href="#array" class="headerlink" title="array"></a>array</h4><p>初始化 通过如下创建 array 容器的方式，可以将所有的元素初始化为 0 或者和默认元素类型等效的值：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">std::array&lt;<span class="keyword">double</span>, 10&gt; values &#123;&#125;;</span><br></pre></td></tr></table></figure><p>array 容器是 <a href="http://c.biancheng.net/cplus/">C++</a> 11 标准中新增的序列容器，简单地理解，它就是在 C++ 普通数组的基础上，添加了一些成员函数和全局函数。在使用上，它比普通数组更安全，且效率并没有因此变差。</p><div class="table-container"><table><thead><tr><th>成员函数</th><th>功能</th></tr></thead><tbody><tr><td>begin()</td><td>返回指向容器中第一个元素的随机访问迭代器。</td></tr><tr><td>end()</td><td>返回指向容器最后一个元素之后一个位置的随机访问迭代器，通常和 begin() 结合使用。</td></tr><tr><td>rbegin()</td><td>返回指向最后一个元素的随机访问迭代器。</td></tr><tr><td>rend()</td><td>返回指向第一个元素之前一个位置的随机访问迭代器。</td></tr><tr><td>cbegin()</td><td>和 begin() 功能相同，只不过在其基础上增加了 const 属性，不能用于修改元素。</td></tr><tr><td>cend()</td><td>和 end() 功能相同，只不过在其基础上，增加了 const 属性，不能用于修改元素。</td></tr><tr><td>crbegin()</td><td>和 rbegin() 功能相同，只不过在其基础上，增加了 const 属性，不能用于修改元素。</td></tr><tr><td>crend()</td><td>和 rend() 功能相同，只不过在其基础上，增加了 const 属性，不能用于修改元素。</td></tr><tr><td>size()</td><td>返回容器中当前元素的数量，其值始终等于初始化 array 类的第二个模板参数 N。</td></tr><tr><td>max_size()</td><td>返回容器可容纳元素的最大数量，其值始终等于初始化 array 类的第二个模板参数 N。</td></tr><tr><td>empty()</td><td>判断容器是否为空，和通过 size()==0 的判断条件功能相同，但其效率可能更快。</td></tr><tr><td>at(n)</td><td>返回容器中 n 位置处元素的引用，该函数自动检查 n 是否在有效的范围内，如果不是则抛出 out_of_range 异常。</td></tr><tr><td>front()</td><td>返回容器中第一个元素的直接引用，该函数不适用于空的 array 容器。</td></tr><tr><td>back()</td><td>返回容器中最后一个元素的直接应用，该函数同样不适用于空的 array 容器。</td></tr><tr><td>data()</td><td>返回一个指向容器首个元素的<a href="http://c.biancheng.net/c/80/">指针</a>。利用该指针，可实现复制容器中所有元素等类似功能。</td></tr><tr><td>fill(val)</td><td>将 val 这个值赋值给容器中的每个元素。</td></tr><tr><td>array1.swap(array2)</td><td>交换 array1 和 array2 容器中的所有元素，但前提是它们具有相同的长度和类型。</td></tr></tbody></table></div><p>对于array相比一般的c数组,可以直接利用front,back获取前后引用,size函数获取个数,以及一般的容器迭代器等</p><p>同时还有at函数更加安全的获取array中的元素,但由于不能更改长度,实践中用的并不多</p><h4 id="vector"><a href="#vector" class="headerlink" title="vector"></a>vector</h4><div class="table-container"><table><thead><tr><th>begin()</th><th>返回指向容器中第一个元素的迭代器。</th></tr></thead><tbody><tr><td>end()</td><td>返回指向容器最后一个元素所在位置后一个位置的迭代器，通常和 begin() 结合使用。</td></tr><tr><td>rbegin()</td><td>返回指向最后一个元素的迭代器。</td></tr><tr><td>rend()</td><td>返回指向第一个元素所在位置前一个位置的迭代器。</td></tr><tr><td>cbegin()</td><td>和 begin() 功能相同，只不过在其基础上，增加了 const 属性，不能用于修改元素。</td></tr><tr><td>cend()</td><td>和 end() 功能相同，只不过在其基础上，增加了 const 属性，不能用于修改元素。</td></tr><tr><td>crbegin()</td><td>和 rbegin() 功能相同，只不过在其基础上，增加了 const 属性，不能用于修改元素。</td></tr><tr><td>crend()</td><td>和 rend() 功能相同，只不过在其基础上，增加了 const 属性，不能用于修改元素。</td></tr><tr><td>size()</td><td>返回实际元素个数。</td></tr><tr><td>max_size()</td><td>返回元素个数的最大值。这通常是一个很大的值，一般是 232-1，所以我们很少会用到这个函数。</td></tr><tr><td>resize()</td><td>改变实际元素的个数。</td></tr><tr><td>capacity()</td><td>返回当前容量。</td></tr><tr><td>empty()</td><td>判断容器中是否有元素，若无元素，则返回 true；反之，返回 false。</td></tr><tr><td>reserve()</td><td>增加容器的容量。</td></tr><tr><td>shrink _to_fit()</td><td>将内存减少到等于当前元素实际所使用的大小。</td></tr><tr><td>operator[ ]</td><td>重载了 [ ] 运算符，可以向访问数组中元素那样，通过下标即可访问甚至修改 vector 容器中的元素。</td></tr><tr><td>at()</td><td>使用经过边界检查的索引访问元素。</td></tr><tr><td>front()</td><td>返回第一个元素的引用。</td></tr><tr><td>back()</td><td>返回最后一个元素的引用。</td></tr><tr><td>data()</td><td>返回指向容器中第一个元素的指针。</td></tr><tr><td>assign()</td><td>用新元素替换原有内容。</td></tr><tr><td>push_back()</td><td>在序列的尾部添加一个元素。</td></tr><tr><td>pop_back()</td><td>移出序列尾部的元素。</td></tr><tr><td>insert()</td><td>在指定的位置插入一个或多个元素。</td></tr><tr><td>erase()</td><td>移出一个元素或一段元素。</td></tr><tr><td>clear()</td><td>移出所有的元素，容器大小变为 0。</td></tr><tr><td>swap()</td><td>交换两个容器的所有元素。</td></tr><tr><td>emplace()</td><td>在指定的位置直接生成一个元素。</td></tr><tr><td>emplace_back()</td><td>在序列尾部生成一个元素。</td></tr></tbody></table></div><p>可以更改大小,在内存上是连续分布的.所以可以随机访问,跟一般的数组和array类似.  可以使用reserve函数调整大小,</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">values.<span class="built_in">reserve</span>(<span class="number">20</span>);</span><br></pre></td></tr></table></figure><p>这样就设置了容器的内存分配，即至少可以容纳 20 个元素。注意，如果 vector 的容量在执行此语句之前，已经大于或等于 20 个元素，那么这条语句什么也不做；另外，调用 reserve() 不会影响已存储的元素，也不会生成任何元素，即 values 容器内此时仍然没有任何元素.</p><p>同时使用emplace,emplace_back,erase等来增加或删除元素.</p><blockquote><p>emplace_back() 和 push_back() 的区别，就在于底层实现的机制不同。push_back() 向容器尾部添加元素时，首先会创建这个元素，然后再将这个元素拷贝或者移动到容器中（如果是拷贝的话，事后会自行销毁先前创建的这个元素）；而 emplace_back() 在实现时，则是直接在容器尾部创建这个元素，省去了拷贝或移动元素的过程。</p></blockquote><p>插入元素</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span> </span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span> </span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;array&gt;</span> </span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::vector&lt;<span class="keyword">int</span>&gt; demo&#123;<span class="number">1</span>,<span class="number">2</span>&#125;;</span><br><span class="line">    <span class="comment">//第一种格式用法</span></span><br><span class="line">    demo.<span class="built_in">insert</span>(demo.<span class="built_in">begin</span>() + <span class="number">1</span>, <span class="number">3</span>);<span class="comment">//&#123;1,3,2&#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//第二种格式用法</span></span><br><span class="line">    demo.<span class="built_in">insert</span>(demo.<span class="built_in">end</span>(), <span class="number">2</span>, <span class="number">5</span>);<span class="comment">//&#123;1,3,2,5,5&#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//第三种格式用法</span></span><br><span class="line">    std::array&lt;<span class="keyword">int</span>,3&gt;test&#123; <span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span> &#125;;</span><br><span class="line">    demo.<span class="built_in">insert</span>(demo.<span class="built_in">end</span>(), test.<span class="built_in">begin</span>(), test.<span class="built_in">end</span>());<span class="comment">//&#123;1,3,2,5,5,7,8,9&#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//第四种格式用法</span></span><br><span class="line">    demo.<span class="built_in">insert</span>(demo.<span class="built_in">end</span>(), &#123; <span class="number">10</span>,<span class="number">11</span> &#125;);<span class="comment">//&#123;1,3,2,5,5,7,8,9,10,11&#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; demo.<span class="built_in">size</span>(); i++) &#123;</span><br><span class="line">        cout &lt;&lt; demo[i] &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>删除元素</p><div class="table-container"><table><thead><tr><th>函数</th><th>功能</th></tr></thead><tbody><tr><td>pop_back()</td><td>删除 vector 容器中最后一个元素，该容器的大小（size）会减 1，但容量（capacity）不会发生改变。</td></tr><tr><td>erase(pos)</td><td>删除 vector 容器中 pos 迭代器指定位置处的元素，并返回指向被删除元素下一个位置元素的迭代器。该容器的大小（size）会减 1，但容量（capacity）不会发生改变。</td></tr><tr><td>swap(beg)、pop_back()</td><td>先调用 swap() 函数交换要删除的目标元素和容器最后一个元素的位置，然后使用 pop_back() 删除该目标元素。</td></tr><tr><td>erase(beg,end)</td><td>删除 vector 容器中位于迭代器 [beg,end)指定区域内的所有元素，并返回指向被删除区域下一个位置元素的迭代器。该容器的大小（size）会减小，但容量（capacity）不会发生改变。</td></tr><tr><td>remove()</td><td>删除容器中所有和指定元素值相等的元素，并返回指向最后一个元素下一个位置的迭代器。值得一提的是，调用该函数不会改变容器的大小和容量。</td></tr><tr><td>clear()</td><td>删除 vector 容器中所有的元素，使其变成空的 vector 容器。该函数会改变 vector 的大小（变为 0），但不是改变其容量。</td></tr></tbody></table></div><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::vector&lt;<span class="keyword">int</span>&gt; demo&#123; <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span> &#125;;</span><br><span class="line">    <span class="comment">//删除 2、3</span></span><br><span class="line">    <span class="keyword">auto</span> iter = demo.<span class="built_in">erase</span>(demo.<span class="built_in">begin</span>()+<span class="number">1</span>, demo.<span class="built_in">end</span>() - <span class="number">2</span>);</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;size is :&quot;</span> &lt;&lt; demo.<span class="built_in">size</span>() &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;capacity is :&quot;</span> &lt;&lt; demo.<span class="built_in">capacity</span>() &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; demo.<span class="built_in">size</span>(); i++) &#123;</span><br><span class="line">        cout &lt;&lt; demo[i] &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>常用emplace,emplace_back,pop_back,erase对vector进行增删数据,使用at访问数据</p><h4 id="deque"><a href="#deque" class="headerlink" title="deque"></a>deque</h4><p>deque 容器和 vecotr 容器有很多相似之处，比如：</p><ul><li>deque 容器也擅长在序列尾部添加或删除元素（时间复杂度为<code>O(1)</code>），而不擅长在序列中间添加或删除元素。</li><li>deque 容器也可以根据需要修改自身的容量和大小</li></ul><p>和 vector 不同的是，deque 还擅长在序列头部添加或删除元素，所耗费的时间复杂度也为常数阶<code>O(1)</code>。并且更重要的一点是，deque 容器中存储元素并不能保证所有元素都存储到连续的内存空间中。</p><blockquote><p>当需要向序列两端频繁的添加或删除元素时，应首选 deque 容器。</p></blockquote><p>和 vector 相比，额外增加了实现在容器头部添加和删除元素的成员函数比如emplace_front,pop_font，同时删除了 capacity()、reserve() 和 data() 成员函数。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;deque&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//初始化一个空deque容量</span></span><br><span class="line">    deque&lt;<span class="keyword">int</span>&gt;d;</span><br><span class="line">    <span class="comment">//向d容器中的尾部依次添加 1，2,3</span></span><br><span class="line">    d.<span class="built_in">push_back</span>(<span class="number">1</span>); <span class="comment">//&#123;1&#125;</span></span><br><span class="line">    d.<span class="built_in">push_back</span>(<span class="number">2</span>); <span class="comment">//&#123;1,2&#125;</span></span><br><span class="line">    d.<span class="built_in">push_back</span>(<span class="number">3</span>); <span class="comment">//&#123;1,2,3&#125;</span></span><br><span class="line">    <span class="comment">//向d容器的头部添加 0 </span></span><br><span class="line">    d.<span class="built_in">push_front</span>(<span class="number">0</span>); <span class="comment">//&#123;0,1,2,3&#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//调用 size() 成员函数输出该容器存储的字符个数。</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;元素个数为：%d\n&quot;</span>, d.<span class="built_in">size</span>());</span><br><span class="line">   </span><br><span class="line">    <span class="comment">//使用迭代器遍历容器</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> i = d.<span class="built_in">begin</span>(); i &lt; d.<span class="built_in">end</span>(); i++) &#123;</span><br><span class="line">        cout &lt;&lt; *i &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="list"><a href="#list" class="headerlink" title="list"></a>list</h4><p><a href="http://c.biancheng.net/stl/">STL</a> list 容器，又称双向链表容器，即该容器的底层是以双向链表的形式实现的。这意味着，list 容器中的元素可以分散存储在内存空间里，而不是必须存储在一整块连续的内存空间中。</p><p>list 容器具有一些其它容器（array、vector 和 deque）所不具备的优势，即它可以在序列已知的任何位置快速插入或删除元素（时间复杂度为<code>O(1)</code>）。并且在 list 容器中移动元素，也比其它容器的效率高。</p><p>和之前的序列容器相比，list 容器迭代器最大的不同在于，其配备的迭代器类型为双向迭代器，而不再是随机访问迭代器。</p><div class="table-container"><table><thead><tr><th>成员函数</th><th>功能</th></tr></thead><tbody><tr><td>begin()</td><td>返回指向容器中第一个元素的双向迭代器。</td></tr><tr><td>end()</td><td>返回指向容器中最后一个元素所在位置的下一个位置的双向迭代器。</td></tr><tr><td>rbegin()</td><td>返回指向最后一个元素的反向双向迭代器。</td></tr><tr><td>rend()</td><td>返回指向第一个元素所在位置前一个位置的反向双向迭代器。</td></tr><tr><td>cbegin()</td><td>和 begin() 功能相同，只不过在其基础上，增加了 const 属性，不能用于修改元素。</td></tr><tr><td>cend()</td><td>和 end() 功能相同，只不过在其基础上，增加了 const 属性，不能用于修改元素。</td></tr><tr><td>crbegin()</td><td>和 rbegin() 功能相同，只不过在其基础上，增加了 const 属性，不能用于修改元素。</td></tr><tr><td>crend()</td><td>和 rend() 功能相同，只不过在其基础上，增加了 const 属性，不能用于修改元素。</td></tr><tr><td>empty()</td><td>判断容器中是否有元素，若无元素，则返回 true；反之，返回 false。</td></tr><tr><td>size()</td><td>返回当前容器实际包含的元素个数。</td></tr><tr><td>max_size()</td><td>返回容器所能包含元素个数的最大值。这通常是一个很大的值，一般是 232-1，所以我们很少会用到这个函数。</td></tr><tr><td>front()</td><td>返回第一个元素的引用。</td></tr><tr><td>back()</td><td>返回最后一个元素的引用。</td></tr><tr><td>assign()</td><td>用新元素替换容器中原有内容。</td></tr><tr><td>emplace_front()</td><td>在容器头部生成一个元素。该函数和 push_front() 的功能相同，但效率更高。</td></tr><tr><td>push_front()</td><td>在容器头部插入一个元素。</td></tr><tr><td>pop_front()</td><td>删除容器头部的一个元素。</td></tr><tr><td>emplace_back()</td><td>在容器尾部直接生成一个元素。该函数和 push_back() 的功能相同，但效率更高。</td></tr><tr><td>push_back()</td><td>在容器尾部插入一个元素。</td></tr><tr><td>pop_back()</td><td>删除容器尾部的一个元素。</td></tr><tr><td>emplace()</td><td>在容器中的指定位置插入元素。该函数和 insert() 功能相同，但效率更高。</td></tr><tr><td>insert()</td><td>在容器中的指定位置插入元素。</td></tr><tr><td>erase()</td><td>删除容器中一个或某区域内的元素。</td></tr><tr><td>swap()</td><td>交换两个容器中的元素，必须保证这两个容器中存储的元素类型是相同的。</td></tr><tr><td>resize()</td><td>调整容器的大小。</td></tr><tr><td>clear()</td><td>删除容器存储的所有元素。</td></tr><tr><td>splice()</td><td>将一个 list 容器中的元素插入到另一个容器的指定位置。</td></tr><tr><td>remove(val)</td><td>删除容器中所有等于 val 的元素。</td></tr><tr><td>remove_if()</td><td>删除容器中满足条件的元素。</td></tr><tr><td>unique()</td><td>删除容器中相邻的重复元素，只保留一个。</td></tr><tr><td>merge()</td><td>合并两个事先已排好序的 list 容器，并且合并之后的 list 容器依然是有序的。</td></tr><tr><td>sort()</td><td>通过更改容器中元素的位置，将它们进行排序。</td></tr><tr><td>reverse()</td><td>反转容器中元素的顺序。</td></tr></tbody></table></div><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;list&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//创建空的 list 容器</span></span><br><span class="line">    std::list&lt;<span class="keyword">double</span>&gt; values;</span><br><span class="line">    <span class="comment">//向容器中添加元素</span></span><br><span class="line">    values.<span class="built_in">push_back</span>(<span class="number">3.1</span>);</span><br><span class="line">    values.<span class="built_in">push_back</span>(<span class="number">2.2</span>);</span><br><span class="line">    values.<span class="built_in">push_back</span>(<span class="number">2.9</span>);</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;values size：&quot;</span> &lt;&lt; values.<span class="built_in">size</span>() &lt;&lt; endl;</span><br><span class="line">    <span class="comment">//对容器中的元素进行排序</span></span><br><span class="line">    values.<span class="built_in">sort</span>();</span><br><span class="line">    <span class="comment">//使用迭代器输出list容器中的元素</span></span><br><span class="line">    <span class="keyword">for</span> (std::list&lt;<span class="keyword">double</span>&gt;::iterator it = values.<span class="built_in">begin</span>(); it != values.<span class="built_in">end</span>(); ++it) &#123;</span><br><span class="line">        std::cout &lt;&lt; *it &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;list&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;array&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::list&lt;<span class="keyword">int</span>&gt; values&#123; <span class="number">1</span>,<span class="number">2</span> &#125;;</span><br><span class="line">    <span class="comment">//第一种格式用法</span></span><br><span class="line">    values.<span class="built_in">insert</span>(values.<span class="built_in">begin</span>() , <span class="number">3</span>);<span class="comment">//&#123;3,1,2&#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//第二种格式用法</span></span><br><span class="line">    values.<span class="built_in">insert</span>(values.<span class="built_in">end</span>(), <span class="number">2</span>, <span class="number">5</span>);<span class="comment">//&#123;3,1,2,5,5&#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//第三种格式用法</span></span><br><span class="line">    std::array&lt;<span class="keyword">int</span>, 3&gt;test&#123; <span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span> &#125;;</span><br><span class="line">    values.<span class="built_in">insert</span>(values.<span class="built_in">end</span>(), test.<span class="built_in">begin</span>(), test.<span class="built_in">end</span>());<span class="comment">//&#123;3,1,2,5,5,7,8,9&#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//第四种格式用法</span></span><br><span class="line">    values.<span class="built_in">insert</span>(values.<span class="built_in">end</span>(), &#123; <span class="number">10</span>,<span class="number">11</span> &#125;);<span class="comment">//&#123;3,1,2,5,5,7,8,9,10,11&#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> p = values.<span class="built_in">begin</span>(); p != values.<span class="built_in">end</span>(); ++p)</span><br><span class="line">    &#123;</span><br><span class="line">        cout &lt;&lt; *p &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="关联式容器"><a href="#关联式容器" class="headerlink" title="关联式容器"></a>关联式容器</h3><p>关联式容器在存储元素值的同时，会为各元素额外再配备一个值（又称为“键”，其本质也是一个 C++ 基础数据类型或自定义类型的元素），它的功能是在使用关联式容器的过程中，如果已知目标元素的键的值，则直接通过该键就可以找到目标元素，而无需再通过遍历整个容器的方式。</p><blockquote><p>弃用序列式容器，转而选用关联式容器存储元素，往往就是看中了关联式容器可以快速查找、读取或者删除所存储的元素，同时该类型容器插入元素的效率也比序列式容器高。</p></blockquote><p>也就是说，使用关联式容器存储的元素，都是一个一个的“键值对”（ <key,value> ），这是和序列式容器最大的不同。除此之外，序列式容器中存储的元素默认都是未经过排序的，而使用关联式容器存储的元素，默认会根据各元素的键值的大小做升序排序</p><div class="table-container"><table><thead><tr><th>关联式容器名称</th><th>特点</th></tr></thead><tbody><tr><td>map</td><td>定义在 <map> 头文件中，使用该容器存储的数据，其各个元素的键必须是唯一的（即不能重复），该容器会根据各元素键的大小，默认进行升序排序（调用 std::less<T>）。</td></tr><tr><td>set</td><td>定义在 <set> 头文件中，使用该容器存储的数据，各个元素键和值完全相同，且各个元素的值不能重复（保证了各元素键的唯一性）。该容器会自动根据各个元素的键（其实也就是元素值）的大小进行升序排序（调用 std::less<T>）。</td></tr><tr><td>multimap</td><td>定义在 <map> 头文件中，和 map 容器唯一的不同在于，multimap 容器中存储元素的键可以重复。</td></tr><tr><td>multiset</td><td>定义在 <set> 头文件中，和 set 容器唯一的不同在于，multiset 容器中存储元素的值可以重复（一旦值重复，则意味着键也是重复的）。</td></tr></tbody></table></div><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;map&gt;</span> <span class="comment">//使用 map 容器，必须引入该头文件</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//创建一个空的 map 关联式容器，该容器中存储的键值对，其中键为 string 字符串，值也为 string 字符串类型</span></span><br><span class="line">    map&lt;string, string&gt; mymap;</span><br><span class="line">    <span class="comment">//向 mymap 容器中添加数据</span></span><br><span class="line">    mymap[<span class="string">&quot;http://c.biancheng.net/c/&quot;</span>] = <span class="string">&quot;C语言教程&quot;</span>;</span><br><span class="line">    mymap[<span class="string">&quot;http://c.biancheng.net/python/&quot;</span>] = <span class="string">&quot;Python教程&quot;</span>;</span><br><span class="line">    mymap[<span class="string">&quot;http://c.biancheng.net/java/&quot;</span>] = <span class="string">&quot;Java教程&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//使用 map 容器的迭代器，遍历 mymap 容器，并输出其中存储的各个键值对</span></span><br><span class="line">    <span class="keyword">for</span> (map&lt;string, string&gt;::iterator it = mymap.<span class="built_in">begin</span>(); it != mymap.<span class="built_in">end</span>(); ++it) &#123;</span><br><span class="line">        <span class="comment">//输出各个元素中的键和值</span></span><br><span class="line">        cout &lt;&lt; it-&gt;first &lt;&lt; <span class="string">&quot; =&gt; &quot;</span> &lt;&lt; it-&gt;second &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>考虑到“键值对”并不是普通类型数据，<a href="http://c.biancheng.net/cplus/">C++</a> <a href="http://c.biancheng.net/stl/">STL</a> 标准库提供了 pair 类模板，其专门用来将 2 个普通元素 first 和 second（可以是 C++ 基本数据类型、结构体、类自定的类型）创建成一个新元素<code>&lt;first, second&gt;</code>。通过其构成的元素格式不难看出，使用 pair 类模板来创建“键值对”形式的元素</p><p>pair 类模板定义在<code>&lt;utility&gt;</code>头文件中，所以在使用该类模板之前，需引入此头文件。另外值得一提的是，在 C++ 11 标准之前，pair 类模板中提供了以下 3 种构造函数：</p><h1 id="1-默认构造函数，即创建空的-pair-对象pair"><a href="#1-默认构造函数，即创建空的-pair-对象pair" class="headerlink" title="1) 默认构造函数，即创建空的 pair 对象pair();"></a>1) 默认构造函数，即创建空的 pair 对象pair();</h1><h1 id="2-直接使用-2-个元素初始化成-pair-对象pair-const-first-type-amp-a-const-second-type-amp-b"><a href="#2-直接使用-2-个元素初始化成-pair-对象pair-const-first-type-amp-a-const-second-type-amp-b" class="headerlink" title="2) 直接使用 2 个元素初始化成 pair 对象pair (const first_type&amp; a, const second_type&amp; b);"></a>2) 直接使用 2 个元素初始化成 pair 对象pair (const first_type&amp; a, const second_type&amp; b);</h1><h1 id="3-拷贝（复制）构造函数，即借助另一个-pair-对象，创建新的-pair-对象template-pair-const-pair-amp-pr"><a href="#3-拷贝（复制）构造函数，即借助另一个-pair-对象，创建新的-pair-对象template-pair-const-pair-amp-pr" class="headerlink" title="3) 拷贝（复制）构造函数，即借助另一个 pair 对象，创建新的 pair 对象template pair (const pair&amp; pr);"></a>3) 拷贝（复制）构造函数，即借助另一个 pair 对象，创建新的 pair 对象template<class U, class V> pair (const pair<U,V>&amp; pr);</h1><p>在 C++ 11 标准中，在引入<a href="http://c.biancheng.net/view/439.html">右值引用</a>的基础上，pair 类模板中又增添了如下 2 个构造函数：</p><h1 id="4-移动构造函数template-pair-pair-amp-amp-pr-5-使用右值引用参数，创建-pair-对象template-pair-U-amp-amp-a-V-amp-amp-b"><a href="#4-移动构造函数template-pair-pair-amp-amp-pr-5-使用右值引用参数，创建-pair-对象template-pair-U-amp-amp-a-V-amp-amp-b" class="headerlink" title="4) 移动构造函数template pair (pair&amp;&amp; pr);#5) 使用右值引用参数，创建 pair 对象template pair (U&amp;&amp; a, V&amp;&amp; b);"></a>4) 移动构造函数template<class U, class V> pair (pair<U,V>&amp;&amp; pr);#5) 使用右值引用参数，创建 pair 对象template<class U, class V> pair (U&amp;&amp; a, V&amp;&amp; b);</h1><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;utility&gt;</span>      <span class="comment">// pair</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span>       <span class="comment">// string</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 调用构造函数 1，也就是默认构造函数</span></span><br><span class="line">    pair &lt;string, <span class="keyword">double</span>&gt; pair1;</span><br><span class="line">    <span class="comment">// 调用第 2 种构造函数</span></span><br><span class="line">    pair &lt;string, string&gt; <span class="built_in">pair2</span>(<span class="string">&quot;STL教程&quot;</span>,<span class="string">&quot;http://c.biancheng.net/stl/&quot;</span>);  </span><br><span class="line">    <span class="comment">// 调用拷贝构造函数</span></span><br><span class="line">    pair &lt;string, string&gt; <span class="built_in">pair3</span>(pair2);</span><br><span class="line">    <span class="comment">//调用移动构造函数</span></span><br><span class="line">    pair &lt;string, string&gt; <span class="built_in">pair4</span>(<span class="built_in">make_pair</span>(<span class="string">&quot;C++教程&quot;</span>, <span class="string">&quot;http://c.biancheng.net/cplus/&quot;</span>));</span><br><span class="line">    <span class="comment">// 调用第 5 种构造函数</span></span><br><span class="line">    pair &lt;string, string&gt; <span class="built_in">pair5</span>(<span class="built_in">string</span>(<span class="string">&quot;Python教程&quot;</span>), <span class="built_in">string</span>(<span class="string">&quot;http://c.biancheng.net/python/&quot;</span>));  </span><br><span class="line">   </span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;pair1: &quot;</span> &lt;&lt; pair1.first &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; pair1.second &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;pair2: &quot;</span>&lt;&lt; pair2.first &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; pair2.second &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;pair3: &quot;</span> &lt;&lt; pair3.first &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; pair3.second &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;pair4: &quot;</span> &lt;&lt; pair4.first &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; pair4.second &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;pair5: &quot;</span> &lt;&lt; pair5.first &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; pair5.second &lt;&lt; endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="map"><a href="#map" class="headerlink" title="map"></a>map</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">map&lt;string,<span class="keyword">int</span>&gt;myMap;</span><br><span class="line">   map&lt;string,<span class="keyword">int</span>&gt;mymap&#123;&#123;<span class="string">&quot;C语言&quot;</span>,<span class="number">10</span>&#125;,&#123;<span class="string">&quot;C++教程&quot;</span>,<span class="number">20</span>&#125;&#125;;</span><br><span class="line">   map&lt;string,string&gt;m&#123;<span class="built_in">make_pair</span>(<span class="string">&quot;hi&quot;</span>,<span class="string">&quot;hello&quot;</span>)&#125;;</span><br><span class="line">   map&lt;string,string&gt;copiedmap&#123;m&#125;;</span><br><span class="line"></span><br><span class="line">   map&lt;string,<span class="keyword">int</span>,greater&lt;string&gt; &gt;hismap;</span><br></pre></td></tr></table></figure><p>常用的成员函数是find,count</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;map&gt;</span>      <span class="comment">// map</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span>       <span class="comment">// string</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//创建空 map 容器，默认根据个键值对中键的值，对键值对做降序排序</span></span><br><span class="line">    std::map&lt;std::string, std::string, std::greater&lt;std::string&gt;&gt;myMap;</span><br><span class="line">    <span class="comment">//调用 emplace() 方法，直接向 myMap 容器中指定位置构造新键值对</span></span><br><span class="line">    myMap.<span class="built_in">emplace</span>(<span class="string">&quot;C语言教程&quot;</span>,<span class="string">&quot;http://c.biancheng.net/c/&quot;</span>);</span><br><span class="line">    myMap.<span class="built_in">emplace</span>(<span class="string">&quot;Python教程&quot;</span>, <span class="string">&quot;http://c.biancheng.net/python/&quot;</span>);</span><br><span class="line">    myMap.<span class="built_in">emplace</span>(<span class="string">&quot;STL教程&quot;</span>, <span class="string">&quot;http://c.biancheng.net/stl/&quot;</span>);</span><br><span class="line">    <span class="comment">//输出当前 myMap 容器存储键值对的个数</span></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;myMap size==&quot;</span> &lt;&lt; myMap.<span class="built_in">size</span>() &lt;&lt; endl;</span><br><span class="line">    <span class="comment">//判断当前 myMap 容器是否为空</span></span><br><span class="line">    <span class="keyword">if</span> (!myMap.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">        <span class="comment">//借助 myMap 容器迭代器，将该容器的键值对逐个输出</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> i = myMap.<span class="built_in">begin</span>(); i != myMap.<span class="built_in">end</span>(); ++i) &#123;</span><br><span class="line">            cout &lt;&lt; i-&gt;first &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; i-&gt;second &lt;&lt; endl;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="set"><a href="#set" class="headerlink" title="set"></a>set</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">set&lt;string&gt; myset&#123;<span class="string">&quot;shit&quot;</span>&#125;;</span><br><span class="line">    set&lt;string&gt; set2&#123;</span><br><span class="line">        <span class="string">&quot;hi&quot;</span>,</span><br><span class="line">        <span class="string">&quot;hello&quot;</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="function">set&lt;string&gt; <span class="title">s1</span><span class="params">(set2)</span></span>;</span><br><span class="line">    s.<span class="built_in">emplace</span>(<span class="string">&quot;hi&quot;</span>);</span><br></pre></td></tr></table></figure><p>删除元素 erase</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;set&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//创建并初始化 set 容器</span></span><br><span class="line">    std::set&lt;<span class="keyword">int</span>&gt;myset&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>&#125;;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;myset size = &quot;</span> &lt;&lt; myset.<span class="built_in">size</span>() &lt;&lt; endl;</span><br><span class="line">   </span><br><span class="line">    <span class="comment">//1) 调用第一种格式的 erase() 方法</span></span><br><span class="line">    <span class="keyword">int</span> num = myset.<span class="built_in">erase</span>(<span class="number">2</span>); <span class="comment">//删除元素 2，myset=&#123;1,3,4,5&#125;</span></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;1、myset size = &quot;</span> &lt;&lt; myset.<span class="built_in">size</span>() &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;num = &quot;</span> &lt;&lt; num &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2) 调用第二种格式的 erase() 方法</span></span><br><span class="line">    set&lt;<span class="keyword">int</span>&gt;::iterator iter = myset.<span class="built_in">erase</span>(myset.<span class="built_in">begin</span>()); <span class="comment">//删除元素 1，myset=&#123;3,4,5&#125;</span></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;2、myset size = &quot;</span> &lt;&lt; myset.<span class="built_in">size</span>() &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;iter-&gt;&quot;</span> &lt;&lt; *iter &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//3) 调用第三种格式的 erase() 方法</span></span><br><span class="line">    set&lt;<span class="keyword">int</span>&gt;::iterator iter2 = myset.<span class="built_in">erase</span>(myset.<span class="built_in">begin</span>(), --myset.<span class="built_in">end</span>());<span class="comment">//删除元素 3,4，myset=&#123;5&#125;</span></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;3、myset size = &quot;</span> &lt;&lt; myset.<span class="built_in">size</span>() &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;iter2-&gt;&quot;</span> &lt;&lt; *iter2 &lt;&lt; endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;set&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//创建空set容器</span></span><br><span class="line">    std::set&lt;std::string&gt; myset;</span><br><span class="line">    <span class="comment">//空set容器不存储任何元素</span></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;1、myset size = &quot;</span> &lt;&lt; myset.<span class="built_in">size</span>() &lt;&lt; endl;</span><br><span class="line">    <span class="comment">//向myset容器中插入新元素</span></span><br><span class="line">    myset.<span class="built_in">insert</span>(<span class="string">&quot;http://c.biancheng.net/java/&quot;</span>);</span><br><span class="line">    myset.<span class="built_in">insert</span>(<span class="string">&quot;http://c.biancheng.net/stl/&quot;</span>);</span><br><span class="line">    myset.<span class="built_in">insert</span>(<span class="string">&quot;http://c.biancheng.net/python/&quot;</span>);</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;2、myset size = &quot;</span> &lt;&lt; myset.<span class="built_in">size</span>() &lt;&lt; endl;</span><br><span class="line">    <span class="comment">//利用双向迭代器，遍历myset</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> iter = myset.<span class="built_in">begin</span>(); iter != myset.<span class="built_in">end</span>(); ++iter) &#123;</span><br><span class="line">        cout &lt;&lt; *iter &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><div class="table-container"><table><thead><tr><th style="text-align:left">函数</th><th>介绍</th></tr></thead><tbody><tr><td style="text-align:left">upper_bound(val)</td><td>返回一个指向当前 set 容器中第一个大于 val 的元素的迭代器。如果 set 容器用 const 限定，则该方法返回的是 const 类型的双向迭代器。</td></tr><tr><td style="text-align:left">equal_range(val)</td><td>该方法返回一个 pair 对象（包含 2 个双向迭代器），其中 pair.first 和 lower_bound() 方法的返回值等价，pair.second 和 upper_bound() 方法的返回值等价。也就是说，该方法将返回一个范围，该范围中包含的值为 val 的元素（set 容器中各个元素是唯一的，因此该范围最多包含一个元素）。</td></tr><tr><td style="text-align:left">lower_bound(val)</td><td>返回一个指向当前 set 容器中第一个大于或等于 val 的元素的双向迭代器。如果 set 容器用 const 限定，则该方法返回的是 const 类型的双向迭代器。</td></tr></tbody></table></div><p>注意count,find等新的成员函数</p><p>此外关联式容器还有multimap和multiset,这里不介绍了.</p><h4 id="无序关联式容器"><a href="#无序关联式容器" class="headerlink" title="无序关联式容器"></a>无序关联式容器</h4><p>和关联式容器一样，无序容器也使用键值对（pair 类型）的方式存储数据。不过，它们有本质上的不同：</p><ul><li>关联式容器的底层实现采用的树存储结构，更确切的说是红黑树结构；</li><li>无序容器的底层实现采用的是哈希表的存储结构。</li></ul><div class="table-container"><table><thead><tr><th>无序容器</th><th>功能</th></tr></thead><tbody><tr><td>unordered_map</td><td>存储键值对 <key, value> 类型的元素，其中各个键值对键的值不允许重复，且该容器中存储的键值对是无序的。</td></tr><tr><td>unordered_multimap</td><td>和 unordered_map 唯一的区别在于，该容器允许存储多个键相同的键值对。</td></tr><tr><td>unordered_set</td><td>不再以键值对的形式存储数据，而是直接存储数据元素本身（当然也可以理解为，该容器存储的全部都是键 key 和值 value 相等的键值对，正因为它们相等，因此只存储 value 即可）。另外，该容器存储的元素不能重复，且容器内部存储的元素也是无序的。</td></tr><tr><td>unordered_multiset</td></tr></tbody></table></div><p>总的来说，实际场景中如果涉及大量遍历容器的操作，建议首选关联式容器；反之，如果更多的操作是通过键获取对应的值，则应首选无序容器。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unordered_map&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//创建并初始化一个 unordered_map 容器，其存储的 &lt;string,string&gt; 类型的键值对</span></span><br><span class="line">    std::unordered_map&lt;std::string, std::string&gt; my_uMap&#123;</span><br><span class="line">        &#123;<span class="string">&quot;C语言教程&quot;</span>,<span class="string">&quot;http://c.biancheng.net/c/&quot;</span>&#125;,</span><br><span class="line">        &#123;<span class="string">&quot;Python教程&quot;</span>,<span class="string">&quot;http://c.biancheng.net/python/&quot;</span>&#125;,</span><br><span class="line">        &#123;<span class="string">&quot;Java教程&quot;</span>,<span class="string">&quot;http://c.biancheng.net/java/&quot;</span>&#125; &#125;;</span><br><span class="line">    <span class="comment">//查找指定键对应的值，效率比关联式容器高</span></span><br><span class="line">    string str = my_uMap.<span class="built_in">at</span>(<span class="string">&quot;C语言教程&quot;</span>);</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;str = &quot;</span> &lt;&lt; str &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//使用迭代器遍历哈希容器，效率不如关联式容器</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> iter = my_uMap.<span class="built_in">begin</span>(); iter != my_uMap.<span class="built_in">end</span>(); ++iter)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//pair 类型键值对分为 2 部分</span></span><br><span class="line">        cout &lt;&lt; iter-&gt;first &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; iter-&gt;second &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="迭代器"><a href="#迭代器" class="headerlink" title="迭代器"></a>迭代器</h2><p>迭代器是cpp STL库的概念,要访问顺序容器和关联容器中的元素，需要通过“迭代器（iterator）”进行。迭代器是一个变量，相当于容器</p><p>和操纵容器的算法之间的中介。迭代器可以指向容器中的某个元素，通过迭代器就可以读写它指向的元素。从这一点上看，迭代器和<a href="http://c.biancheng.net/c/80/">指针</a>类似.</p><p>通过迭代器可以读取它指向的元素，<code>*迭代器名</code>就表示迭代器指向的元素。通过非常量迭代器还能修改其指向的元素。</p><p>迭代器都可以进行<code>++</code>操作。反向迭代器和正向迭代器的区别在于：</p><ul><li>对正向迭代器进行<code>++</code>操作时，迭代器会指向容器中的后一个元素；</li><li>而对反向迭代器进行<code>++</code>操作时，迭代器会指向容器中的前一个元素</li></ul><h3 id="迭代器的分类"><a href="#迭代器的分类" class="headerlink" title="迭代器的分类"></a>迭代器的分类</h3><p>常用的迭代器按功能强弱分为输入、输出、正向、双向、随机访问五种，这里只介绍常用的三种。</p><p>1) 正向迭代器。假设 p 是一个正向迭代器，则 p 支持以下操作：++p，p++，*p。此外，两个正向迭代器可以互相赋值，还可以用<code>==</code>和<code>!=</code>运算符进行比较。</p><p>2) 双向迭代器。双向迭代器具有正向迭代器的全部功能。除此之外，若 p 是一个双向迭代器，则<code>--p</code>和<code>p--</code>都是有定义的。<code>--p</code>使得 p 朝和<code>++p</code>相反的方向移动。</p><p>3) 随机访问迭代器。随机访问迭代器具有双向迭代器的全部功能。若 p 是一个随机访问迭代器，i 是一个整型变量或常量，则 p 还支持以下操作：</p><ul><li>p+=i：使得 p 往后移动 i 个元素。</li><li>p-=i：使得 p 往前移动 i 个元素。</li><li>p+i：返回 p 后面第 i 个元素的迭代器。</li><li>p-i：返回 p 前面第 i 个元素的迭代器。</li><li>p[i]：返回 p 后面第 i 个元素的引用</li></ul><div class="table-container"><table><thead><tr><th>容器</th><th>迭代器功能</th></tr></thead><tbody><tr><td>vector</td><td>随机访问</td></tr><tr><td>deque</td><td>随机访问</td></tr><tr><td>list</td><td>双向</td></tr><tr><td>set / multiset</td><td>双向</td></tr><tr><td>map / multimap</td><td>双向</td></tr><tr><td>stack</td><td>不支持迭代器</td></tr><tr><td>queue</td><td>不支持迭代器</td></tr><tr><td>priority_queue</td><td>不支持迭代器</td></tr></tbody></table></div><h2 id="迭代器的辅助函数"><a href="#迭代器的辅助函数" class="headerlink" title="迭代器的辅助函数"></a>迭代器的辅助函数</h2><p>STL 中有用于操作迭代器的三个函数模板，它们是：</p><ul><li>advance(p, n)：使迭代器 p 向前或向后移动 n 个元素。</li><li>dis<a href="http://c.biancheng.net/ref/tan.html">tan</a>ce(p, q)：计算两个迭代器之间的距离，即迭代器 p 经过多少次 + + 操作后和迭代器 q 相等。如果调用时 p 已经指向 q 的后面，则这个函数会陷入死循环。</li><li>iter_swap(p, q)：用于交换两个迭代器 p、q 指向的值。</li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;list&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span> <span class="comment">//要使用操作迭代器的函数模板，需要包含此文件</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> a[<span class="number">5</span>] = &#123; <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span> &#125;;</span><br><span class="line">    list &lt;<span class="keyword">int</span>&gt; <span class="built_in">lst</span>(a, a+<span class="number">5</span>);</span><br><span class="line">    list &lt;<span class="keyword">int</span>&gt;::iterator p = lst.<span class="built_in">begin</span>();</span><br><span class="line">    <span class="built_in">advance</span>(p, <span class="number">2</span>);  <span class="comment">//p向后移动两个元素，指向3</span></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;1)&quot;</span> &lt;&lt; *p &lt;&lt; endl;  <span class="comment">//输出 1)3</span></span><br><span class="line">    <span class="built_in">advance</span>(p, <span class="number">-1</span>);  <span class="comment">//p向前移动一个元素，指向2</span></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;2)&quot;</span> &lt;&lt; *p &lt;&lt; endl;  <span class="comment">//输出 2)2</span></span><br><span class="line">    list&lt;<span class="keyword">int</span>&gt;::iterator q = lst.<span class="built_in">end</span>();</span><br><span class="line">    q--;  <span class="comment">//q 指向 5</span></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;3)&quot;</span> &lt;&lt; <span class="built_in">distance</span>(p, q) &lt;&lt; endl;  <span class="comment">//输出 3)3</span></span><br><span class="line">    <span class="built_in">iter_swap</span>(p, q); <span class="comment">//交换 2 和 5</span></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;4)&quot;</span>;</span><br><span class="line">    <span class="keyword">for</span> (p = lst.<span class="built_in">begin</span>(); p != lst.<span class="built_in">end</span>(); ++p)</span><br><span class="line">        cout &lt;&lt; *p &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      
        <tags>
            
            <tag> cpp </tag>
            
            <tag> stl </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>浏览器CORS和CSP介绍</title>
      <link href="2023/03/04/%E6%B5%8F%E8%A7%88%E5%99%A8CORS%E5%92%8CCSP%E4%BB%8B%E7%BB%8D/"/>
      <url>2023/03/04/%E6%B5%8F%E8%A7%88%E5%99%A8CORS%E5%92%8CCSP%E4%BB%8B%E7%BB%8D/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>了解浏览器的一些安全策略同时了解跨域问题.<br><span id="more"></span></p><h2 id="CORS"><a href="#CORS" class="headerlink" title="CORS"></a>CORS</h2><p>全称是跨源资源共享(Cross-Origin Resource Sharing).是一个系统，它由一系列传输的 <a href="https://developer.mozilla.org/zh-CN/docs/Glossary/HTTP_header">HTTP 标头</a>组成，这些 HTTP 标头决定浏览器是否阻止前端 JavaScript 代码获取跨源请求的响应.</p><p>这又涉及到了浏览器的同源策略.</p><h3 id="前置知识"><a href="#前置知识" class="headerlink" title="前置知识"></a>前置知识</h3><p><strong>同源策略</strong>是一个重要的安全策略，它用于限制一个<a href="https://developer.mozilla.org/zh-CN/docs/Glossary/Origin">源</a>的文档或者它加载的脚本如何能与另一个源的资源进行交互。</p><blockquote><p>它能帮助阻隔恶意文档，减少可能被攻击的媒介。例如，它可以防止互联网上的恶意网站在浏览器中运行 JS 脚本，从第三方网络邮件服务（用户已登录）或公司内网（因没有公共 IP 地址而受到保护，不会被攻击者直接访问）读取数据，并将这些数据转发给攻击者。</p></blockquote><h4 id="源的定义"><a href="#源的定义" class="headerlink" title="源的定义"></a>源的定义</h4><p>如果两个 URL 的<a href="https://developer.mozilla.org/zh-CN/docs/Glossary/Protocol">协议</a>、<a href="https://developer.mozilla.org/en-US/docs/Glossary/Port">端口 (en-US)</a>（如果有指定的话）和<a href="https://developer.mozilla.org/zh-CN/docs/Glossary/Host">主机</a>都相同的话，则这两个 URL 是<em>同源</em>的。这个方案也被称为“协议/主机/端口元组”，或者直接是“元组”。（“元组”是指一组项目构成的整体，具有双重/三重/四重/五重等通用形式。）</p><p>协议比如http,https.  主机是域名或者ip地址.</p><div class="table-container"><table><thead><tr><th style="text-align:left">URL</th><th style="text-align:left">结果</th><th style="text-align:left">原因</th></tr></thead><tbody><tr><td style="text-align:left"><code>http://store.company.com/dir2/other.html</code></td><td style="text-align:left">同源</td><td style="text-align:left">只有路径不同</td></tr><tr><td style="text-align:left"><code>http://store.company.com/dir/inner/another.html</code></td><td style="text-align:left">同源</td><td style="text-align:left">只有路径不同</td></tr><tr><td style="text-align:left"><code>https://store.company.com/secure.html</code></td><td style="text-align:left">失败</td><td style="text-align:left">协议不同</td></tr><tr><td style="text-align:left"><code>http://store.company.com:81/dir/etc.html</code></td><td style="text-align:left">失败</td><td style="text-align:left">端口不同（<code>http://</code> 默认端口是 80）</td></tr><tr><td style="text-align:left"><code>http://news.company.com/dir/other.html</code></td><td style="text-align:left">失败</td><td style="text-align:left">主机不同</td></tr></tbody></table></div><p>除了一般的HTTP还有<strong>文件源</strong>.</p><p>现代浏览器通常将使用 <code>file:///</code> 模式加载的文件的来源视为<em>不透明的来源</em>。这意味着，假如一个文件包括来自同一文件夹的其它文件，它们不会被认为来自同一来源，并可能引发 <a href="https://developer.mozilla.org/zh-CN/docs/Glossary/CORS">CORS</a> 错误</p><p><strong>源的继承</strong></p><p>在页面中通过 <code>about:blank</code> 或 <code>javascript:</code> URL 执行的脚本会继承打开该 URL 的文档的源，因为这些类型的 URL 没有包含源服务器的相关信息。</p><p>例如，<code>about:blank</code> 通常作为父脚本写入内容的新的空白弹出窗口的 URL（例如，通过 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Window/open"><code>Window.open()</code></a>）。如果此弹出窗口也包含 JavaScript，则该脚本将从创建它的脚本那里继承对应的源。</p><h4 id="跨源网络访问"><a href="#跨源网络访问" class="headerlink" title="跨源网络访问"></a>跨源网络访问</h4><p>同源策略会影响不同源之间的交互.</p><blockquote><p>例如在使用 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest"><code>XMLHttpRequest</code></a> 或 <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/img"><code>img</code></a> 标签时则会受到同源策略的约束。这些交互通常分为三类：</p><ul><li>跨源<strong>写操作</strong>（Cross-origin writes）一般是被允许的。例如链接、重定向以及表单提交。特定少数的 HTTP 请求需要添加<a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/CORS#预检请求">预检请求</a>。</li><li>跨源<strong>资源嵌入</strong>（Cross-origin embedding）一般是被允许的.</li><li>跨源<strong>读操作</strong>（Cross-origin reads）一般是不被允许的，但常可以通过内嵌资源来巧妙的进行读取访问。例如，你可以读取嵌入图片的高度和宽度，调用内嵌脚本的方法，或<a href="https://bugzil.la/629094">得知内嵌资源的可用性</a>。</li></ul></blockquote><p>以下是<strong>可能嵌入跨源的资源</strong>的一些示例：</p><ul><li>使用 <code>&lt;script src=&quot;…&quot;&gt;&lt;/script&gt;</code> 标签嵌入的 JavaScript 脚本。语法错误信息只能被同源脚本中捕捉到。</li><li>使用 <code>&lt;link rel=&quot;stylesheet&quot; href=&quot;…&quot;&gt;</code> 标签嵌入的 CSS。由于 CSS 的松散的语法规则，CSS 的跨源需要一个设置正确的 <code>Content-Type</code> 标头。如果样式表是跨源的，且 MIME 类型不正确，资源不以有效的 CSS 结构开始，浏览器会阻止它的加载。</li><li>通过 <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/img"><code>img</code></a> 展示的图片。</li><li>通过<code>video</code>和<code>audio</code>播放的多媒体资源。</li><li>通过 <code>object</code>和<code>embed</code> 嵌入的插件。</li><li>通过 <a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/@font-face"><code>@font-face</code></a> 引入的字体。一些浏览器允许跨源字体（cross-origin fonts），另一些需要同源字体（same-origin fonts）。</li><li>通过iframe载入的资源。站点可以使用 <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/X-Frame-Options"><code>X-Frame-Options</code></a> 标头来阻止这种形式的跨源交互。</li></ul><p>这份<a href="https://fetch.spec.whatwg.org/#http-cors-protocol">跨源共享标准</a>允许在下列场景中使用跨站点 HTTP 请求：</p><ul><li>前文提到的由 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest"><code>XMLHttpRequest</code></a> 或 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Fetch_API">Fetch API</a> 发起的跨源 HTTP 请求。</li><li>Web 字体（CSS 中通过 <code>@font-face</code> 使用跨源字体资源），<a href="https://www.w3.org/TR/css-fonts-3/#font-fetching-requirements">因此，网站就可以发布 TrueType 字体资源，并只允许已授权网站进行跨站调用</a>。</li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/WebGL_API/Tutorial/Using_textures_in_WebGL">WebGL 贴图</a>。</li><li>使用 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/drawImage"><code>drawImage()</code></a> 将图片或视频画面绘制到 canvas。</li><li><a href="https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Shapes/Shapes_From_Images">来自图像的 CSS 图形 (en-US)</a>。</li></ul><p>可以使用 <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/CORS">CORS</a> 来允许跨源访问。CORS 是 <a href="https://developer.mozilla.org/zh-CN/docs/Glossary/HTTP">HTTP</a> 的一部分，它允许服务端来指定哪些主机可以从这个服务端加载资源。</p><h3 id="正题"><a href="#正题" class="headerlink" title="正题"></a>正题</h3><p>cors是一种基于HTTP头的机制,解决浏览器同源策略,允许服务器标示除了它自己以外的其它<a href="https://developer.mozilla.org/zh-CN/docs/Glossary/Origin">源</a>（域、协议或端口），使得浏览器允许这些源访问加载自己的资源.</p><p><strong>CORS 标头</strong></p><ul><li><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Access-Control-Allow-Origin"><code>Access-Control-Allow-Origin</code></a></p><p>指示响应的资源是否可以被给定的来源共享。</p></li><li><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Access-Control-Allow-Credentials"><code>Access-Control-Allow-Credentials</code></a></p><p>指示当请求的凭证标记为 true 时，是否可以公开对该请求响应。</p></li><li><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Access-Control-Allow-Headers"><code>Access-Control-Allow-Headers</code></a></p><p>用在对预检请求的响应中，指示实际的请求中可以使用哪些 HTTP 标头。</p></li><li><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Access-Control-Allow-Methods"><code>Access-Control-Allow-Methods</code></a></p><p>指定对预检请求的响应中，哪些 HTTP 方法允许访问请求的资源。</p></li><li><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Access-Control-Expose-Headers"><code>Access-Control-Expose-Headers</code></a></p><p>通过列出标头的名称，指示哪些标头可以作为响应的一部分公开。</p></li><li><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Access-Control-Max-Age"><code>Access-Control-Max-Age</code></a></p><p>指示预检请求的结果能被缓存多久。</p></li><li><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Access-Control-Request-Headers"><code>Access-Control-Request-Headers</code></a></p><p>用于发起一个预检请求，告知服务器正式请求会使用哪些 HTTP 标头。</p></li><li><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Access-Control-Request-Method"><code>Access-Control-Request-Method</code></a></p><p>用于发起一个预检请求，告知服务器正式请求会使用哪一种 <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Methods">HTTP 请求方法</a>。</p></li><li><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Origin"><code>Origin</code></a></p><p>指示获取资源的请求是从什么源发起的。</p></li></ul><p>跨源资源共享还通过一种机制来检查服务器是否会允许要发送的真实请求,通过浏览器发起一个到服务器托管的跨源资源的“预检”请求。在预检中，浏览器发送的头中标示有 HTTP 方法和真实请求中会用到的头.</p><h4 id="实际访问控制场景"><a href="#实际访问控制场景" class="headerlink" title="实际访问控制场景"></a>实际访问控制场景</h4><ol><li><p>简单请求不会触发CORS预检请求.</p><p>若满足所有下述条件,</p><ul><li>使用下列方法之一：<ul><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Methods/GET"><code>GET</code></a></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Methods/HEAD"><code>HEAD</code></a></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Methods/POST"><code>POST</code></a></li></ul></li></ul></li></ol><p>​    允许人为设置下面的字段</p><ul><li><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Accept"><code>Accept</code></a></p></li><li><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Accept-Language"><code>Accept-Language</code></a></p></li><li><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Content-Language"><code>Content-Language</code></a></p></li><li><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Content-Type"><code>Content-Type</code></a>（需要注意额外的限制）</p></li><li><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Range"><code>Range</code></a>（只允许<a href="https://fetch.spec.whatwg.org/#simple-range-header-value">简单的范围标头值</a> 如 <code>bytes=256-</code> 或 <code>bytes=127-255</code>）</p></li><li><p><code>Content-Type</code></p></li></ul><p>  标头所指定的</p><p>  媒体类型</p><p>  的值仅限于下列三者之一：</p><ul><li><code>text/plain</code></li><li><code>multipart/form-data</code></li><li><code>application/x-www-form-urlencoded</code></li></ul><p>具体请查阅MDN<a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/CORS#什么情况下需要_cors？">跨源资源共享（CORS） - HTTP | MDN (mozilla.org)</a></p><p>使用 <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Origin"><code>Origin</code></a> 和 <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Access-Control-Allow-Origin"><code>Access-Control-Allow-Origin</code></a> 就能完成最简单的访问控制。如果 <code>https://bar.other</code> 的资源持有者想限制他的资源<em>只能</em>通过 <code>https://foo.example</code> 来访问</p><ol><li>预检请求</li></ol><p>使用 <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Origin"><code>Origin</code></a> 和 <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Access-Control-Allow-Origin"><code>Access-Control-Allow-Origin</code></a> 就能完成最简单的访问控制。如果 <code>https://bar.other</code> 的资源持有者想限制他的资源<em>只能</em>通过 <code>https://foo.example</code> 来访问</p><ol><li><p>附带身份凭证的请求</p><p>一般而言，对于跨源 <code>XMLHttpRequest</code> 或 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Fetch_API">Fetch</a> 请求，浏览器<strong>不会</strong>发送身份凭证信息。如果要发送凭证信息，需要设置 <code>XMLHttpRequest</code> 对象的某个特殊标志位，或在构造 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Request"><code>Request</code></a> 对象时设置</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> invocation = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line"> invocation.withCredentials = <span class="literal">true</span>;</span><br></pre></td></tr></table></figure><p>如果服务器端的响应中未携带 <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Access-Control-Allow-Credentials"><code>Access-Control-Allow-Credentials</code></a><code>: true</code>，浏览器将<strong>不会</strong>把响应内容返回给请求的发送者</p></li></ol><h2 id="内容安全策略-CSP"><a href="#内容安全策略-CSP" class="headerlink" title="内容安全策略(CSP)"></a>内容安全策略(CSP)</h2><p><strong>内容安全策略</strong>（<a href="https://developer.mozilla.org/zh-CN/docs/Glossary/CSP">CSP</a>）是一个额外的安全层，用于检测并削弱某些特定类型的攻击，包括<strong>跨站脚本</strong>（<a href="https://developer.mozilla.org/zh-CN/docs/Glossary/Cross-site_scripting">XSS</a>）和<strong>数据注入攻击</strong>等。无论是数据盗取、网站内容污染还是恶意软件分发，这些攻击都是主要的手段。  </p><p>为使 CSP 可用，你需要配置你的网络服务器返回 <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Content-Security-Policy"><code>Content-Security-Policy</code></a> HTTP 标头（有时你会看到 <code>X-Content-Security-Policy</code> 标头，但那是旧版本，并且你无须再如此指定它）。</p><p>除此之外，<a href="https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/meta">``</a> 元素也可以被用来配置该策略，例如</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta</span></span></span><br><span class="line"><span class="tag">  <span class="attr">http-equiv</span>=<span class="string">&quot;Content-Security-Policy&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">content</span>=<span class="string">&quot;default-src &#x27;self&#x27;; img-src https://*; child-src &#x27;none&#x27;;&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure><h3 id="示例-1"><a href="#示例-1" class="headerlink" title="示例 1"></a><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/CSP#示例_1">示例 1</a></h3><p>一个网站管理者想要所有内容均来自站点的同一个源（不包括其子域名）。</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Content-<span class="keyword">Security</span>-<span class="keyword">Policy</span>: <span class="keyword">default</span>-src <span class="string">&#x27;self&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="示例-2"><a href="#示例-2" class="headerlink" title="示例 2"></a><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/CSP#示例_2">示例 2</a></h3><p>一个网站管理者允许内容来自信任的域名及其子域名（域名不必须与 CSP 设置所在的域名相同）。</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Content-<span class="keyword">Security</span>-<span class="keyword">Policy</span>: <span class="keyword">default</span>-src <span class="string">&#x27;self&#x27;</span> *.<span class="keyword">trusted</span>.com</span><br></pre></td></tr></table></figure><h3 id="示例-3"><a href="#示例-3" class="headerlink" title="示例 3"></a><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/CSP#示例_3">示例 3</a></h3><p>一个网站管理者允许网页应用的用户在他们自己的内容中包含来自任何源的图片，但是限制音频或视频需从信任的资源提供者，所有脚本必须从特定主机服务器获取可信的代码。</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Content</span>-Security-Policy: default-src <span class="string">&#x27;self&#x27;</span>; <span class="selector-tag">img</span>-<span class="attribute">src</span> *; media-<span class="attribute">src</span> media1<span class="selector-class">.com</span> media2<span class="selector-class">.com</span>; script-<span class="attribute">src</span> userscripts<span class="selector-class">.example</span><span class="selector-class">.com</span></span><br></pre></td></tr></table></figure><p>在这里，各种内容默认仅允许从文档所在的源获取，但存在如下例外：</p><ul><li>图片可以从任何地方加载 (注意“*”通配符)。</li><li>多媒体文件仅允许从 media1.com 和 media2.com 加载（不允许从这些站点的子域名）。</li><li>可运行脚本仅允许来自于 userscripts.example.com。</li></ul><h3 id="示例-4"><a href="#示例-4" class="headerlink" title="示例 4"></a><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/CSP#示例_4">示例 4</a></h3><p>一个线上银行网站的管理者想要确保网站的所有内容都要通过 SSL 方式获取，以避免攻击者窃听用户发出的请求。</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Content-Security-Policy</span>: default-src <span class="attribute">https</span>:<span class="comment">//onlinebanking.jumbobank.com</span></span><br></pre></td></tr></table></figure><p>该服务器仅允许通过 HTTPS 方式并仅从 onlinebanking.jumbobank.com 域名来访问文档。</p><h3 id="示例-5"><a href="#示例-5" class="headerlink" title="示例 5"></a><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/CSP#示例_5">示例 5</a></h3><p>一个在线邮箱的管理者想要允许在邮件里包含 HTML，同样图片允许从任何地方加载，但不允许 JavaScript 或者其它潜在的危险内容（从任意位置加载）。</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Content</span>-Security-Policy: default-src <span class="string">&#x27;self&#x27;</span> *.mailsite.com; <span class="selector-tag">img</span>-<span class="attribute">src</span> *</span><br></pre></td></tr></table></figure><p>注意这个示例并未指定 <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy/script-src"><code>script-src</code> (en-US)</a>；在此 CSP 示例中，站点通过 <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Content-Security-Policy/default-src"><code>default-src</code></a> 指令的对其进行配置，这也同样意味着脚本文件仅允许从原始服务器获取。</p><h3 id="相关资料"><a href="#相关资料" class="headerlink" title="相关资料"></a>相关资料</h3><ol><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/CORS">跨源资源共享（CORS） - HTTP | MDN (mozilla.org)</a></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/CSP#对策略进行测试">内容安全策略（CSP） - HTTP | MDN (mozilla.org)</a></li></ol><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      
        <tags>
            
            <tag> cors </tag>
            
            <tag> csp </tag>
            
            <tag> 浏览器 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>学习purecss构建自己的css框架</title>
      <link href="2023/02/18/%E5%AD%A6%E4%B9%A0purecss%E6%9E%84%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84css%E6%A1%86%E6%9E%B6/"/>
      <url>2023/02/18/%E5%AD%A6%E4%B9%A0purecss%E6%9E%84%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84css%E6%A1%86%E6%9E%B6/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>更加简易的Bootstrap框架,定制度更高.比Tailwind轻量.<br><span id="more"></span></p><p>中文官方文档<a href="https://purecss.cn/start.html">开始使用 - Pure | Pure中文站 | Purecss学习网</a></p><p>官网有最新版<a href="https://purecss.io/start/">Get Started - Pure (purecss.io)</a></p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      
        <tags>
            
            <tag> css </tag>
            
            <tag> pure.css </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DLHLP学习</title>
      <link href="2023/02/17/DLHLP%E5%AD%A6%E4%B9%A0/"/>
      <url>2023/02/17/DLHLP%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>李宏毅的语言处理. Deep Learning for Human Language Processing.<br><span id="more"></span></p><p>课程链接<a href="https://www.youtube.com/watch?v=nER51ZyJaCQ&amp;list=PLJV_el3uVTsO07RpBYFsXg-bN5Lu0nhdG&amp;ab_channel=Hung-yiLee">DLHLP 2020] Deep Learning for Human Language Processing (Course Overview) - YouTube</a></p><p><img data-src="http://cdn.sekyoro.top/imgs/17/0220230217105241.png" alt="image-20230217105215776" style="zoom:67%;" /></p><h3 id="语音识别"><a href="#语音识别" class="headerlink" title="语音识别"></a>语音识别</h3><p>传统语音处理</p><p><img data-src="http://cdn.sekyoro.top/imgs/17/0220230217105753.png" alt="image-20230217105753162"></p><p>ASR(automatic speech recognition)</p><h3 id="语音合成"><a href="#语音合成" class="headerlink" title="语音合成"></a>语音合成</h3><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      
        <tags>
            
            <tag> Deep Learning </tag>
            
            <tag> Speech </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>docker学习</title>
      <link href="2023/02/13/docker%E5%AD%A6%E4%B9%A0/"/>
      <url>2023/02/13/docker%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>Docker可以方便部署以及利用镜像快速学习一些项目,解决环境冲突等.重点关注Dockerfile和docker-compose文件的编写.<br><span id="more"></span></p><h2 id="核心概念"><a href="#核心概念" class="headerlink" title="核心概念"></a>核心概念</h2><p>Docker 是一个开源的应用容器引擎，基于 <a href="https://www.runoob.com/go/go-tutorial.html">Go 语言</a> 并遵从 Apache2.0 协议开源。</p><p>Docker 可以让开发者打包他们的应用以及依赖包到一个轻量级、可移植的容器中，然后发布到任何流行的 Linux 机器上，也可以实现虚拟化。</p><p>容器是完全使用沙箱机制，相互之间不会有任何接口（类似 iPhone 的 app）,更重要的是容器性能开销极低。</p><blockquote><p>Docker 是一个用于开发，交付和运行应用程序的开放平台。Docker 使您能够将应用程序与基础架构分开，从而可以快速交付软件。借助 Docker，您可以与管理应用程序相同的方式来管理基础架构。通过利用 Docker 的方法来快速交付，测试和部署代码，您可以大大减少编写代码和在生产环境中运行代码之间的延迟。</p></blockquote><ul><li>Web 应用的自动化打包和发布。</li><li>自动化测试和持续集成、发布。</li><li>在服务型环境中部署和调整数据库或其他的后台应用。</li><li>从头编译或者扩展现有的 OpenShift 或 Cloud Foundry 平台来搭建自己的 PaaS 环境。</li></ul><h3 id="镜像-image"><a href="#镜像-image" class="headerlink" title="镜像(image)"></a>镜像(image)</h3><p>镜像类似于一个打包好的软件或可执行程序,可以通过运行这个镜像得到容器(类似于一个进程).</p><p>镜像可以<strong>自己打包</strong>或从<strong>Docker Hub</strong><a href="https://hub.docker.com/">Docker Hub Container Image Library | App Containerization</a>获取,如果本地没有打包的默认从后者拉取.</p><p>自己打包需要Dockerfile定制这个”可执行程序”,有了Dockerfile后可以使用<code>docker build .</code>构建镜像.</p><p><code>.</code>符号表示在这个目录下的Dockerfile文件.</p><p>一个镜像可以在多个容器运行,可以将镜像分享给别人.</p><p>使用<code>docker run</code>运行镜像,如果本地没有会自动<code>docker pull</code>拉取.</p><p>使用<code>docker push</code>可以将自己的镜像推送到Docker Hub.</p><p>这里我们创建一个小项目.</p><p><img data-src="http://cdn.sekyoro.top/imgs/13/0220230213175949.png" alt="image-20230213175925727" style="zoom:50%;" /></p><p>创建一个服务监听端口.</p><p><img data-src="http://cdn.sekyoro.top/imgs/13/0220230213175946.png" alt="image-20230213175946483"></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"><span class="keyword">const</span> port = <span class="number">3000</span>;</span><br><span class="line">app.get(<span class="string">&#x27;/&#x27;</span>,<span class="function">(<span class="params">req,res</span>)=&gt;</span></span><br><span class="line">        &#123;</span><br><span class="line">res.send(<span class="string">&#x27;&lt;p&gt;你好&lt;/p&gt;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        &#125;);</span><br><span class="line">app.listen(port,<span class="function">()=&gt;</span><span class="built_in">console</span>.log(<span class="string">&quot;端口是3000&quot;</span>))</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>写好后就可以直接创建Dockerfile建立镜像了.</p><p>首先Dockerfile文件创建在项目根目录中.</p><p>需要先拉取镜像,可以在<a href="https://hub.docker.com/">Docker Hub Container Image Library | App Containerization</a>中查找.</p><p>首先我们用到了node,所以需要拉取相应的node镜像(一般node镜像肯定带了OS等底层的镜像)</p><p><img data-src="http://cdn.sekyoro.top/imgs/13/0220230213180313.png" alt="image-20230213180312673" style="zoom: 50%;" /></p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> node:<span class="number">19</span>-alpine3.<span class="number">16</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="bash"> /myworkdir</span></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> package.json .</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> npm i</span></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> . .</span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">3000</span></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> [<span class="string">&quot;node&quot;</span>,<span class="string">&quot;app.js&quot;</span>]</span></span><br></pre></td></tr></table></figure><p>docker会一行一行扫描代码.</p><p>FROM表示拉取node:19-alpine3.16,node:19-alpine3.16是镜像名,19-alpine3.16表示版本,node 19版本,alpine是一个操作系统常用于Docker构建.  </p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -t myimage:v1  .</span><br></pre></td></tr></table></figure><p>如果不使用tag,则没有名字</p><p><img data-src="http://cdn.sekyoro.top/imgs/13/02image-20230213190037683.png" alt="image-20230213190037683"></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker tag &lt;IMAGE ID&gt; &lt;REPO:TAG&gt;</span><br></pre></td></tr></table></figure><p><img data-src="http://cdn.sekyoro.top/imgs/13/0220230213190203.png" alt="image-20230213190203625"></p><p>没有tag默认latest</p><p>使用<code>docker push</code>推送镜像</p><p><img data-src="http://cdn.sekyoro.top/imgs/13/0220230213190322.png" alt="image-20230213190322542" style="zoom:50%;" /></p><p>使用<code>docker rmi</code>删除本地镜像</p><p><img data-src="http://cdn.sekyoro.top/imgs/13/0220230213190427.png" alt="image-20230213190427515"></p><p>使用<code>docker pull</code>拉取Docker Hub中的镜像.</p><p><img data-src="http://cdn.sekyoro.top/imgs/13/0220230213190537.png" alt="image-20230213190537437"></p><h3 id="容器-container"><a href="#容器-container" class="headerlink" title="容器(container)"></a>容器(container)</h3><p>使用<code>docker run &lt;镜像名&gt;</code>运行镜像从而得到</p><p><code>-d</code>参数后台运行</p><p><img data-src="http://cdn.sekyoro.top/imgs/13/0220230213191520.png" alt="image-20230213191519991" style="zoom:67%;" /></p><p>使用<code>docker images</code>查询镜像信息.</p><p>使用<code>docker ps</code>查询容器信息.</p><p>这里并不能直接通过3000端口访问网页,因为并没有实际暴露.</p><p>Dockerfile文件中EXPOSE命令只是标识提醒作用.</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 3000:3000 --name mydocker proanimer/nodejs:<span class="built_in">test</span></span><br></pre></td></tr></table></figure><p><code>-p</code>参数表示端口映射 本地3000映射后者容器的3000.</p><p><code>--name</code>参数表示给容器命名,否则有默认命名.</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 3000:3000 --name mydockerpro proanimer/nodejs:<span class="built_in">test</span>           </span><br></pre></td></tr></table></figure><p>使用<code>docker stop &lt;容器id&gt;</code>停止运行.</p><p>使用<code>docker rm &lt;容器id&gt;</code>删除窗口.</p><p><img data-src="http://cdn.sekyoro.top/imgs/13/0220230213192549.png" alt="image-20230213192549208"></p><p>修改文件后容器并不会跟着改变,因为修改的文件时本地镜像中的文件,容器是之前的镜像运行后的结果.我们需要与运行的容器直接交互.</p><p>使用<code>docker exec -it &lt;镜像名或id&gt; /bin/sh</code> </p><p><code>/bin/sh</code>是容器中os的shell.</p><p><img data-src="http://cdn.sekyoro.top/imgs/13/0220230213201031.png" alt="image-20230213195526472"></p><p><img data-src="http://cdn.sekyoro.top/imgs/13/0220230213201022.png" alt="image-20230213200936929"></p><p>注意 如果在Windows上需要加上winpty,同时设定shell路径时是<code>//bin/sh</code>即需要多加上一个<code>/</code></p><p>注意进入容器后很多工具比如vim可能都没有,所以需要用到路径映射.</p><p>设置volume,-v 把本地指定文件夹和容器指定文件夹绑定</p><p>这里使用</p><p><img data-src="http://cdn.sekyoro.top/imgs/13/0220230213210813.png" alt="image-20230213210813343">注意如果是git bash for windows.使用下面命令,</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d  -v F://docker_exp1://myworkdir -p 3000:3000 --name mypro proanimer/nodejs:<span class="built_in">test</span></span><br></pre></td></tr></table></figure><p><img data-src="http://cdn.sekyoro.top/imgs/13/0220230213220937.png" alt="image-20230213220937554"></p><p>发现挂载路径有/hostmnt,这是git bash比较特别的,表示宿主机.</p><p>如果是在windows的powershell.</p><p><img data-src="http://cdn.sekyoro.top/imgs/13/0220230213220123.png" alt="image-20230213220122719"></p><p>检查挂载路径,<img data-src="http://cdn.sekyoro.top/imgs/13/0220230213221258.png" alt="image-20230213221258083" style="zoom:80%;" /></p><p>两者这里不同,但本质上是一样的.</p><p>注意,这里路径映射时是依照宿主机的,即如果宿主机/dir上有A,B文件,容器路径中/dir中有C文件,将这两个路径映射,则实际用时是A,B文件.</p><p>同时使用<code>-v 目录</code>对这个容器中的目录不进行同步.本地只读后增加:ro</p><p><img data-src="http://cdn.sekyoro.top/imgs/13/0220230213225237.png" alt="image-20230213225237389" style="zoom:67%;" /></p><p><strong>ro模式</strong></p><p>（1）文件：容器内不能修改，会提示read-only</p><p>（2）文件夹：容器内不能修改、新增、删除文件夹中的文件，会提示read-only</p><p><code>docker rm -fv</code>同时把volume删除.</p><h3 id="Dockerfile"><a href="#Dockerfile" class="headerlink" title="Dockerfile"></a>Dockerfile</h3><p>通过写Dockerfile定制镜像文件,使用<code>docker build</code>创建镜像.</p><h4 id="FROM"><a href="#FROM" class="headerlink" title="FROM"></a>FROM</h4><p><strong>FROM</strong>：定制的镜像都是基于FROM的镜像</p><h4 id="RUN"><a href="#RUN" class="headerlink" title="RUN"></a>RUN</h4><p><strong>RUN</strong>：用于执行后面跟着的命令行命令。有以下两种格式：</p><p>shell 格式：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">RUN &lt;命令行命令&gt;</span><br><span class="line"><span class="comment"># &lt;命令行命令&gt; 等同于，在终端操作的 shell 命令。</span></span><br></pre></td></tr></table></figure><p>exec 格式：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">RUN [<span class="string">&quot;可执行文件&quot;</span>, <span class="string">&quot;参数1&quot;</span>, <span class="string">&quot;参数2&quot;</span>]</span><br><span class="line"><span class="comment"># 例如：</span></span><br><span class="line"><span class="comment"># RUN [&quot;./test.php&quot;, &quot;dev&quot;, &quot;offline&quot;] 等价于 RUN ./test.php dev offline</span></span><br></pre></td></tr></table></figure><p><strong>注意</strong>：Dockerfile 的指令每执行一次都会在 docker 上新建一层。所以过多无意义的层，会造成镜像膨胀过大。例如：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">FROM centos</span><br><span class="line">RUN **yum** -y **install** **wget**</span><br><span class="line">RUN **wget** -O redis.tar.gz <span class="string">&quot;http://download.redis.io/releases/redis-5.0.3.tar.gz&quot;</span></span><br><span class="line">RUN **tar** -xvf redis.tar.gz</span><br></pre></td></tr></table></figure><p>以上执行会创建 3 层镜像。可简化为以下格式：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">FROM centos</span><br><span class="line">RUN yum -y install wget \</span><br><span class="line">  &amp;&amp; wget -O redis.tar.gz <span class="string">&quot;http://download.redis.io/releases/redis-5.0.3.tar.gz&quot;</span> \</span><br><span class="line">  &amp;&amp; tar -xvf redis.tar.gz</span><br></pre></td></tr></table></figure><p>如上，以 <strong>&amp;&amp;</strong> 符号连接命令，这样执行后，只会创建 1 层镜像。</p><h4 id="CMD"><a href="#CMD" class="headerlink" title="CMD"></a>CMD</h4><p>类似于 RUN 指令，用于运行程序，但二者运行的时间点不同:</p><ul><li><strong>CMD 在docker run</strong> 时运行。</li><li><strong>RUN 是在 docker build</strong>即构建时运行.</li></ul><p><strong>作用</strong>：为启动的容器指定默认要运行的程序，程序运行结束，容器也就结束。CMD 指令指定的程序可被 docker run 命令行参数中指定要运行的程序所覆盖。</p><p><strong>注意</strong>：如果 Dockerfile 中如果存在多个 CMD 指令，仅最后一个生效。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CMD &lt;shell 命令&gt; </span><br><span class="line">CMD [<span class="string">&quot;&lt;可执行文件或命令&gt;&quot;</span>,<span class="string">&quot;&lt;param1&gt;&quot;</span>,<span class="string">&quot;&lt;param2&gt;&quot;</span>,...] </span><br><span class="line">CMD [<span class="string">&quot;&lt;param1&gt;&quot;</span>,<span class="string">&quot;&lt;param2&gt;&quot;</span>,...]  <span class="comment"># 该写法是为 ENTRYPOINT 指令指定的程序提供默认参数</span></span><br></pre></td></tr></table></figure><h4 id="ENTRYPOINT"><a href="#ENTRYPOINT" class="headerlink" title="ENTRYPOINT"></a>ENTRYPOINT</h4><p>类似于 CMD 指令，但其不会被 docker run 的命令行参数指定的指令所覆盖，而且这些命令行参数会被当作参数送给 ENTRYPOINT 指令指定的程序。</p><p>但是, 如果运行 docker run 时使用了 —entrypoint 选项，将覆盖 ENTRYPOINT 指令指定的程序。</p><p><strong>优点</strong>：在执行 docker run 的时候可以指定 ENTRYPOINT 运行所需的参数。</p><p><strong>注意</strong>：如果 Dockerfile 中如果存在多个 ENTRYPOINT 指令，仅最后一个生效。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ENTRYPOINT [<span class="string">&quot;&lt;executeable&gt;&quot;</span>,<span class="string">&quot;&lt;param1&gt;&quot;</span>,<span class="string">&quot;&lt;param2&gt;&quot;</span>,...]</span><br></pre></td></tr></table></figure><h4 id="WORKDIR"><a href="#WORKDIR" class="headerlink" title="WORKDIR"></a>WORKDIR</h4><p>指定工作目录。用 WORKDIR 指定的工作目录，会在构建镜像的每一层中都存在。以后各层的当前目录就被改为指定的目录，如该目录不存在，WORKDIR 会帮你建立目录。</p><p>docker build 构建镜像过程中的，每一个 RUN 命令都是新建的一层。只有通过 WORKDIR 创建的目录才会一直存在。</p><p>格式：</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">WORKDIR</span><span class="bash"> &lt;工作目录路径&gt;</span></span><br></pre></td></tr></table></figure><h4 id="VOLUME"><a href="#VOLUME" class="headerlink" title="VOLUME"></a>VOLUME</h4><p>定义匿名数据卷。在启动容器时忘记挂载数据卷，会自动挂载到匿名卷。</p><p>作用：</p><ul><li>避免重要的数据，因容器重启而丢失，这是非常致命的。</li><li>避免容器不断变大。</li></ul><p>格式：</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">VOLUME</span><span class="bash"> [<span class="string">&quot;&lt;路径1&gt;&quot;</span>, <span class="string">&quot;&lt;路径2&gt;&quot;</span>...]</span></span><br><span class="line"><span class="keyword">VOLUME</span><span class="bash"> &lt;路径&gt;</span></span><br></pre></td></tr></table></figure><p>在启动容器 docker run 的时候，我们可以通过 -v 参数修改挂载点。</p><h4 id="EXPOSE"><a href="#EXPOSE" class="headerlink" title="EXPOSE"></a>EXPOSE</h4><p>仅仅只是声明端口. <strong>注意</strong>并没有实际作用</p><p>作用：</p><ul><li>帮助镜像使用者理解这个镜像服务的守护端口，以方便配置映射。</li><li>在运行时使用随机端口映射时，也就是 docker run -P 时，会自动随机映射 EXPOSE 的端口。</li></ul><p>格式：</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">EXPOSE</span> &lt;端口<span class="number">1</span>&gt; [&lt;端口<span class="number">2</span>&gt;...]</span><br></pre></td></tr></table></figure><h4 id="ENV"><a href="#ENV" class="headerlink" title="ENV"></a>ENV</h4><p>设置环境变量，定义了环境变量，那么在后续的指令中，就可以使用这个环境变量。</p><p>格式：</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ENV</span> &lt;key&gt; &lt;value&gt;</span><br><span class="line"><span class="keyword">ENV</span> &lt;key1&gt;=&lt;value1&gt; &lt;key2&gt;=&lt;value2&gt;...</span><br></pre></td></tr></table></figure><p>以下示例设置 NODE_VERSION = 7.2.0 ， 在后续的指令中可以通过 $NODE_VERSION 引用：</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ENV</span> NODE_VERSION <span class="number">7.2</span>.<span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> curl -SLO <span class="string">&quot;https://nodejs.org/dist/v<span class="variable">$NODE_VERSION</span>/node-v<span class="variable">$NODE_VERSION</span>-linux-x64.tar.xz&quot;</span> \</span></span><br><span class="line"><span class="bash">  &amp;&amp; curl -SLO <span class="string">&quot;https://nodejs.org/dist/v<span class="variable">$NODE_VERSION</span>/SHASUMS256.txt.asc&quot;</span></span></span><br></pre></td></tr></table></figure><h4 id="ARG"><a href="#ARG" class="headerlink" title="ARG"></a>ARG</h4><p>构建参数，与 ENV 作用一致。不过作用域不一样。ARG 设置的环境变量仅对 Dockerfile 内有效，也就是说只有 docker build 的过程中有效，构建好的镜像内不存在此环境变量。</p><p>构建命令 docker build 中可以用 —build-arg &lt;参数名&gt;=&lt;值&gt; 来覆盖。</p><p>格式：</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ARG</span> &lt;参数名&gt;[=&lt;默认值&gt;]</span><br></pre></td></tr></table></figure><h4 id="ONBUILD"><a href="#ONBUILD" class="headerlink" title="ONBUILD"></a>ONBUILD</h4><p>用于延迟构建命令的执行。简单的说，就是 Dockerfile 里用 ONBUILD 指定的命令，在<strong>本次构建镜像的过程中不会执行</strong>（假设镜像为 test-build）。当有新的 Dockerfile <strong>使用了之前构建的镜像 FROM test-build ，这时执行新镜像的 Dockerfile 构建时候，会执行</strong> test-build 的 Dockerfile 里的 ONBUILD 指定的命令。</p><p>格式：</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ONBUILD</span> &lt;其它指令&gt;</span><br></pre></td></tr></table></figure><h4 id="LABEL"><a href="#LABEL" class="headerlink" title="LABEL"></a>LABEL</h4><p>LABEL 指令用来给镜像添加一些元数据（metadata），以键值对的形式，语法格式如下：</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">LABEL</span><span class="bash"> &lt;key&gt;=&lt;value&gt; &lt;key&gt;=&lt;value&gt; &lt;key&gt; =&lt;value&gt; ...</span></span><br></pre></td></tr></table></figure><p>比如我们可以添加镜像的作者：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LABEL org.opencontainers.image.authors=<span class="string">&quot;runoob&quot;</span></span><br></pre></td></tr></table></figure><h3 id="docker-compose"><a href="#docker-compose" class="headerlink" title="docker-compose"></a>docker-compose</h3><p>启动多个容器处理应用.</p><p>yaml文件格式.</p><p><strong>基本语法</strong></p><ul><li><strong>大小写敏感</strong></li><li><strong>使用缩进表示层级关系</strong></li><li>缩进不允许使用tab，<strong>只允许空格</strong></li><li>缩进的空格数不重要，<strong>只要相同层级的元素左对齐即可</strong></li><li>‘#’表示注释</li></ul><p>创建docker-compose.yml文件</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># yaml 配置实例</span></span><br><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">web:</span></span><br><span class="line">    <span class="attr">build:</span> <span class="string">.</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">   <span class="bullet">-</span> <span class="string">&quot;5000:5000&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">   <span class="bullet">-</span> <span class="string">.:/code</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">logvolume01:/var/log</span></span><br><span class="line">    <span class="attr">links:</span></span><br><span class="line">   <span class="bullet">-</span> <span class="string">redis</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">redis</span></span><br><span class="line"><span class="attr">volumes:</span></span><br><span class="line">  <span class="attr">logvolume01:</span> &#123;&#125;</span><br></pre></td></tr></table></figure><p>services下都是镜像,build表示通过Dockerfile构建.</p><p>ports和volumes用于映射端口和数据卷.</p><p>使用命令<code>docker-compose up -d --build</code>-d表示后台,—build表示如果镜像修改就会重建.</p><h4 id="version"><a href="#version" class="headerlink" title="version"></a>version</h4><p>指定本 yml 依从的 compose 哪个版本制定的。</p><h4 id="build"><a href="#build" class="headerlink" title="build"></a>build</h4><p>指定为构建镜像上下文路径：</p><h4 id="volumes"><a href="#volumes" class="headerlink" title="volumes"></a>volumes</h4><p>将主机的数据卷或着文件挂载到容器里。</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3.7&quot;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">db:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">postgres:latest</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;/localhost/postgres.sock:/var/run/postgres/postgres.sock&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;/localhost/data:/var/lib/postgresql/data&quot;</span></span><br></pre></td></tr></table></figure><h4 id="expose"><a href="#expose" class="headerlink" title="expose"></a>expose</h4><p>暴露端口，但不映射到宿主机，只允许能被连接的服务访问。仅可以指定内部端口为参数，如下所示：</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">expose:</span></span><br><span class="line">    - <span class="string">&quot;3000&quot;</span></span><br><span class="line">    - <span class="string">&quot;8000&quot;</span></span><br></pre></td></tr></table></figure><h4 id="links"><a href="#links" class="headerlink" title="links"></a>links</h4><p>链接到其它服务中的容器。使用服务名称（同时作为别名），或者服务名称:服务别名（如 SERVICE:ALIAS），例如</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">links:</span><br><span class="line"><span class="bullet">    -</span> db</span><br><span class="line"><span class="bullet">    -</span> db:database</span><br><span class="line"><span class="bullet">    -</span> redis</span><br></pre></td></tr></table></figure><p>使用<code>docker-compose down -v</code>删除镜像同时删除volume</p><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ol><li><a href="https://www.cnblogs.com/minseo/p/11548177.html">Docker入门之docker-compose - minseo - 博客园 (cnblogs.com)</a></li></ol><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      
        <tags>
            
            <tag> tutorial </tag>
            
            <tag> docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>TotalCommander使用和学习</title>
      <link href="2023/02/07/TotalCommander%E4%BD%BF%E7%94%A8%E5%92%8C%E5%AD%A6%E4%B9%A0/"/>
      <url>2023/02/07/TotalCommander%E4%BD%BF%E7%94%A8%E5%92%8C%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>使用TotalCommander提升平时工作学习效率.<br><span id="more"></span></p><h2 id="动机"><a href="#动机" class="headerlink" title="动机"></a>动机</h2><p>由于之前使用Premiere Pro时发现必须使用管理员身份打开,否则会出现莫名奇妙的问题包含但不限于<code>显示表面初始化失败</code>以及后面打开时无法使用一些<code>动态运动图形素材</code>.</p><p>当使用管理员身份打开后,就难以从文件管理器中拖入文件到素材库中. 因为权限问题无法拖入.</p><iframe src="//player.bilibili.com/player.html?aid=393029005&bvid=BV12d4y1V7Ns&cid=972854406&page=1" scrolling="yes" border="2" frameborder="yes" framespacing="5" allowfullscreen="true"> </iframe><p>简单的方法可以打开注册表设置LUA为0,但这个方法并不推荐.或者用管理员身份打开Everything软件,从Everything中拖入素材.</p><p>但是Everything这个软件还是适合直接用来找文件,后面查询了一些资料发现了Total Commander这个工具以管理员身份打开用来拖文件到素材库.发现这个工具还挺不错的.</p><h3 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h3><blockquote><p>Total Commander，简称TC，原名Windows Commander，功能强大的全能文件管理器。Total Commander 是<a href="https://baike.baidu.com/item/共享软件/680839">共享软件</a>，<a href="https://baike.baidu.com/item/官网/7805125">官网</a>下载版本为一个月<a href="https://baike.baidu.com/item/试用版/1656171">试用版</a></p></blockquote><p><img data-src="http://cdn.sekyoro.top/imgs/07/0220230207172756.png" alt="image-20230207172746360" style="zoom:67%;" /></p><p>所以这里就需要动用自己找资源的能力了,我在本文最后附有我找到的破解版下载网址,可以跳过其中的打开注册表文件夹操作,原价现在貌似需要200多.</p><p>可以看到这里就是一个没有怎么配置的TC界面.</p><p>这里直接使用别人的图片</p><p><img data-src="https://pic3.zhimg.com/80/v2-75f6664b0bd8160569a8254fb03c0572_720w.webp" alt="img" style="zoom:80%;" /></p><p>以管理员身份打开,测试成功.可以拖入素材</p><p><img data-src="http://cdn.sekyoro.top/imgs/07/0220230207175417.png" alt="image-20230207175417295"></p><p>到这里其实我的目的就达到了,不过这个工具其实思想跟Linux系统常用的桌面管理器类似(我之前的文章也介绍过),所以稍微学习一下也不错.</p><h3 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h3><p>这个软件有两侧文件夹栏目</p><p><strong>标签栏常用快捷键</strong>:<br>Ctrl+T 创建标签页<br>Ctrl+W 关闭标签页<br>Ctrl+Shift+W 关闭所有非锁定标签页<br>Ctrl+Tab键 切换下一个标签<br>Ctrl+Shift+Tab键 切换上一个标签页</p><p>Ctrl+D 唤出书签栏菜单</p><p>ctrl+q 快速预览效果</p><p>ctrl+\ 跳转到跟目录</p><p> Ctrl + →或←，将光标下的文件夹或压缩包在另一个窗口打开</p><p>Alt +↓显示 历史文件夹，Alt + ←到 前一个访问过的目录，Alt + →到 后一个访问过的目录。</p><h3 id="更多"><a href="#更多" class="headerlink" title="更多"></a>更多</h3><p><img data-src="http://cdn.sekyoro.top/imgs/07/0220230207172756.png" style="zoom:50%;" /></p><p>其实更多的就需要自己配快捷键了.另外还有插件等,这里就不更多探索了.</p><p>这里由于我需要输入文件路径到目录下拖素材,所以增加了快捷键.</p><p><img data-src="http://cdn.sekyoro.top/imgs/07/0220230207175417.png" style="zoom:80%;" /></p><h2 id="相关资料"><a href="#相关资料" class="headerlink" title="相关资料"></a>相关资料</h2><ol><li><a href="https://zhuanlan.zhihu.com/p/163301413">Total Commander用法介绍 - 知乎 (zhihu.com)</a></li><li><a href="https://www.jb51.net/softs/824660.html">Total Commander破解补丁下载</a></li></ol><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      
        <tags>
            
            <tag> TotalCommander </tag>
            
            <tag> 工具使用 </tag>
            
            <tag> 效率提升 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>闲置服务器BT下载影视</title>
      <link href="2023/01/23/%E9%97%B2%E7%BD%AE%E6%9C%8D%E5%8A%A1%E5%99%A8BT%E4%B8%8B%E8%BD%BD%E5%BD%B1%E8%A7%86/"/>
      <url>2023/01/23/%E9%97%B2%E7%BD%AE%E6%9C%8D%E5%8A%A1%E5%99%A8BT%E4%B8%8B%E8%BD%BD%E5%BD%B1%E8%A7%86/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>利用闲置服务器通过BT SSR下载动漫,并通过filebrowser浏览下载.<br><span id="more"></span></p><h2 id="FileBrowser"><a href="#FileBrowser" class="headerlink" title="FileBrowser"></a>FileBrowser</h2><blockquote><p>filebrowser 是一个使用go语言编写的软件，功能是可以通过浏览器对服务器上的文件进行管理。可以是修改文件，或者是添加删除文件，甚至可以分享文件，是一个很棒的文件管理器，你甚至可以当成一个网盘来使用。</p></blockquote><p>在网站上下载压缩包后并解压.</p><p><a href="https://github.com/filebrowser/filebrowser">filebrowser/filebrowser: 📂 Web File Browser (github.com)</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">tar -xzvf linux-amd64-filebrowser.tar.gz</span><br><span class="line">CHANGELOG.md</span><br><span class="line">LICENSE</span><br><span class="line">README.md</span><br><span class="line">filebrowser</span><br></pre></td></tr></table></figure><p>直接运行程序,默认端口在8080</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"> ./filebrowser</span><br><span class="line">15:22:42 No config file used</span><br><span class="line">15:22:42 Listening on 127.0.0.1:8080</span><br></pre></td></tr></table></figure><p>一般都需要更改这个默认端口,可以先找到其db配置文件.</p><h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><p>你可以直接通过命令参数filebrowser 后接参数设置,这里我推荐设置db文件.</p><p><img data-src="http://cdn.sekyoro.top/imgs/23/0120230123235939.png" alt="image-20230123221036526" style="zoom:80%;" /></p><p>默认配置文件在上面三个目录下你可以依次找看有没有.db文件,如果没有可以通过</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">filebrowser config init</span><br></pre></td></tr></table></figure><p>新建文件,然后通过</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">filebrowser config cat</span><br></pre></td></tr></table></figure><p>查看设置</p><p><img data-src="http://cdn.sekyoro.top/imgs/23/0120230123235942.png" alt="image-20230123221243713" style="zoom:67%;" /></p><p>我们可以通过filebrowser config set -p 9200设置运行端口为9200.</p><h3 id="设置安全组"><a href="#设置安全组" class="headerlink" title="设置安全组"></a>设置安全组</h3><p>开启后注意在服务器商那,比如腾讯云,阿里云拿<strong>设置安全组</strong>开通这个端口,允许外网访问,<strong>同时</strong>还要在服务器这开启端口</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --zone=public --add-port=9201/tcp --permanent</span><br></pre></td></tr></table></figure><p>同时最好重启一下防火墙服务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --reload</span><br></pre></td></tr></table></figure><h3 id="后台运行"><a href="#后台运行" class="headerlink" title="后台运行"></a>后台运行</h3><p>进入目录/lib/systemd/system,可以新建filebrowser.service或者下载一个类似的文件.</p><p><img data-src="http://cdn.sekyoro.top/imgs/23/0120230123235958.png" alt="image-20230123222348866"></p><p>写入以上内容,主要设置-d 配置刚才的db文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl start filebrowser.service</span><br></pre></td></tr></table></figure><p>开启服务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl <span class="built_in">enable</span> filebrowser.service</span><br></pre></td></tr></table></figure><p>设置开机自启动</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl status filebrowser.service</span><br></pre></td></tr></table></figure><p>查看运行状态</p><p><img data-src="http://cdn.sekyoro.top/imgs/23/0120230123235947.png" alt="image-20230123223854973"></p><p>然后打开你的网站,即公网ip+port,打开后类似如下图</p><p><img data-src="http://cdn.sekyoro.top/imgs/24/0120230124000007.png" alt="image-20230123222855110" style="zoom:80%;" /></p><p>可以在设置页面设置一些选项.</p><p><img data-src="http://cdn.sekyoro.top/imgs/24/0120230124000010.png" alt="image-20230123222951056" style="zoom:67%;" />这样设置后就能访问某个文件夹下的内容了.</p><h2 id="qbtorrent"><a href="#qbtorrent" class="headerlink" title="qbtorrent"></a>qbtorrent</h2><p>qbtorrent下载之前讲过,现在就是需要查看webui,以及放开相应端口,设置后台运行.</p><p>操作跟刚才类似.</p><p>在Centos下下载qb</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y qbittorrent-nox</span><br></pre></td></tr></table></figure><p>其他平台类似,当然也可以自己下载包编译安装.</p><p>下载安装后直接运行,默认端口8080</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">qbittorrent-nox</span><br></pre></td></tr></table></figure><h3 id="开启后台运行服务"><a href="#开启后台运行服务" class="headerlink" title="开启后台运行服务"></a>开启后台运行服务</h3><blockquote><p>/usr/lib/systemd/system/目录下，您将找到一个qbittorrent-nox@.service文件。通过运行以下命令，使qbittorrent-nox在启动时自动启动。替换username为您的实际用户名。</p></blockquote><p>可以用whoami命令查看当前用户.</p><p>注意这里的username是您的用户名</p><p>然后开启服务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl start qbittorrent-nox@username.service</span><br></pre></td></tr></table></figure><p>开机启动</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl <span class="built_in">enable</span> qbittorrent-nox@username.service</span><br></pre></td></tr></table></figure><p>在那个目录下可以查看并配置这个服务</p><p><img data-src="http://cdn.sekyoro.top/imgs/24/0120230124000014.png" alt="image-20230123224137176"></p><p>然后更改端口</p><p><img data-src="http://cdn.sekyoro.top/imgs/24/01image-20230123224224945.png" alt="image-20230123224224945"></p><p>后面设置安全组什么的跟上面类似.</p><p>打开这个端口即可. 默认username:admin  password:adminadmin</p><p><img data-src="http://cdn.sekyoro.top/imgs/24/0120230124000018.png" alt="image-20230123224318627"></p><p>用户界面</p><p><img data-src="http://cdn.sekyoro.top/imgs/24/0120230124000026.png" alt="image-20230123224417888" style="zoom:50%;" /></p><h3 id="更改web-ui密码"><a href="#更改web-ui密码" class="headerlink" title="更改web ui密码"></a>更改web ui密码</h3><p><img data-src="http://cdn.sekyoro.top/imgs/24/0120230124000030.png" alt="image-20230123224715884"></p><p>在tools-&gt;options-&gt;web ui中更改语言,验证信息.</p><p><img data-src="http://cdn.sekyoro.top/imgs/24/0120230124000033.png" alt="image-20230123224801908" style="zoom:67%;" /></p><h3 id="设置下载路径"><a href="#设置下载路径" class="headerlink" title="设置下载路径"></a>设置下载路径</h3><p><img data-src="http://cdn.sekyoro.top/imgs/24/0120230124000037.png" alt="image-20230123225109400" style="zoom:67%;" /></p><p>将下载的文件放在filebrowser暴露的文件中,然后最好设置完成后删除torrent节省空间.</p><h3 id="设置RSS"><a href="#设置RSS" class="headerlink" title="设置RSS"></a>设置RSS</h3><p>注意,截至现在时间qbittorrent版本是4.2.5,其Web UI界面没有RSS订阅功能.</p><p><img data-src="http://cdn.sekyoro.top/imgs/24/01image-20230123234248037.png" alt="image-20230123234248037"></p><p>这里我们设置第三方UI增加RSS订阅功能,这样就不用手动加磁力链接了.</p><p>有两种方法,其中一种需要开启HTTPS,懒得去申请了.</p><p>第二种需要下载文件到服务器,下载Release文件并解压.</p><p><a href="https://github.com/CzBiX/qb-web">CzBiX/qb-web: A qBittorrent Web UI, write in TypeScript+Vue. (github.com)</a></p><p>将解压后的文件放在服务器某个位置.</p><p>在设置界面 web UI下文件路径放那个文件的路径,比如 /config/dist. dist就是解压后的文件夹.</p><p><img data-src="http://cdn.sekyoro.top/imgs/24/0120230124000045.png" alt="image-20230123234702168"></p><p>然后打开网页即可.</p><p><img data-src="http://cdn.sekyoro.top/imgs/24/0120230124000048.png" alt="image-20230123234752928" style="zoom:67%;" /></p><p>左侧点击RSS增加RSS功能即可.</p><p><img data-src="http://cdn.sekyoro.top/imgs/24/0120230124000051.png" alt="image-20230123234823176" style="zoom:67%;" /></p><p>可以结合之前我的文章查看一些RSS订阅源.比如利用蜜柑计划等等…</p><h3 id="部分优化"><a href="#部分优化" class="headerlink" title="部分优化"></a>部分优化</h3><h4 id="增加tracker"><a href="#增加tracker" class="headerlink" title="增加tracker"></a>增加tracker</h4><p>需要切换到原来的UI</p><p><img data-src="http://cdn.sekyoro.top/imgs/24/0120230124000102.png" alt="image-20230123235226961" style="zoom: 67%;" /></p><h3 id="资料"><a href="#资料" class="headerlink" title="资料"></a>资料</h3><ol><li><a href="https://www.filebrowser.cn/">filebrowser 是一款非常优秀的文件管理工具，并且是跨平台。安装也非常简单，安装后就可以使用，同样使用也非常的简单。在linux环境中使用的比较多</a></li><li><a href="https://github.com/filebrowser/filebrowser">filebrowser/filebrowser: 📂 Web File Browser (github.com)</a></li><li><a href="https://www.cnblogs.com/webenh/p/13334303.html">File Browser 安装及使用 - WebEnh - 博客园 (cnblogs.com)</a></li><li><a href="https://www.cnblogs.com/a5idc/p/13784155.html">如何在CentOS 8 / RHEL 8服务器上安装qBittorrent - A5互联 - 博客园 (cnblogs.com)</a></li><li><a href="https://www.misterma.com/archives/902/">Linux 服务器安装 qBittorrent - Mr. Ma’s Blog (misterma.com)</a></li><li><a href="https://eatash.com/index.php/2021/09/02/qbittorrent这两个-第三方-webui-还不错-geekman/">qbittorrent这两个 第三方 webui 还不错-Geekman | 吃灰网 (eatash.com)</a></li><li><a href="https://www.jianshu.com/p/54a6bf9e5ebe">Docker版qBittorrent或qBittorrent WebUI使用RSS功能 - 简书 (jianshu.com)</a></li><li><a href="https://github.com/CzBiX/qb-web">CzBiX/qb-web: A qBittorrent Web UI, write in TypeScript+Vue. (github.com)</a></li></ol><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      
        <tags>
            
            <tag> torrent </tag>
            
            <tag> Centos </tag>
            
            <tag> filebrowser </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>dart学习</title>
      <link href="2023/01/14/dart%E5%AD%A6%E4%B9%A0/"/>
      <url>2023/01/14/dart%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>基本就是看看文档,对比学习.注意重点.<br><span id="more"></span></p><blockquote><p>所有变量引用的都是 <strong>对象</strong>，每个对象都是一个 <strong>类</strong> 的实例。数字、函数以及 <code>null</code> 都是对象。除去 <code>null</code> 以外（如果你开启了 <a href="https://dart.cn/null-safety">空安全</a>）, 所有的类都继承于 <a href="https://api.dart.cn/stable/dart-core/Object-class.html"><code>Object</code></a> 类。</p></blockquote><h3 id="类"><a href="#类" class="headerlink" title="类"></a>类</h3><p>Dart 是支持<strong>基于 mixin 继承机制</strong>的面向对象语言，所有对象都是一个类的实例，而除了 <code>Null</code> 以外的所有的类都继承自 <a href="https://api.dart.cn/stable/dart-core/Object-class.html"><code>Object</code></a> 类。 <strong>基于 mixin 的继承</strong> 意味着尽管每个类（<a href="https://dart.cn/null-safety/understanding-null-safety#top-and-bottom">top class</a> <code>Object?</code> 除外）都只有一个超类，一个类的代码可以在其它多个类继承中重复使用。 <a href="https://dart.cn/guides/language/language-tour#extension-methods">扩展方法</a> 是一种在不更改类或创建子类的情况下向类添加功能的方式</p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      
        <tags>
            
            <tag> dart </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>python构建微信公众号文章发表控制台应用</title>
      <link href="2023/01/04/python%E6%9E%84%E5%BB%BA%E5%BE%AE%E4%BF%A1%E5%85%AC%E4%BC%97%E5%8F%B7%E6%96%87%E7%AB%A0%E5%8F%91%E8%A1%A8%E6%8E%A7%E5%88%B6%E5%8F%B0%E5%BA%94%E7%94%A8/"/>
      <url>2023/01/04/python%E6%9E%84%E5%BB%BA%E5%BE%AE%E4%BF%A1%E5%85%AC%E4%BC%97%E5%8F%B7%E6%96%87%E7%AB%A0%E5%8F%91%E8%A1%A8%E6%8E%A7%E5%88%B6%E5%8F%B0%E5%BA%94%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>使用Python构建控制台应用,简单一点.主目的是抓取某个网站图片然后上传到素材.<br><span id="more"></span></p><h2 id="流程"><a href="#流程" class="headerlink" title="流程"></a>流程</h2><h3 id="获取access-token"><a href="#获取access-token" class="headerlink" title="获取access token"></a>获取access token</h3><p>首先需要知道自己的开发者AppID和开发者密码AppSecret.</p><p>然后获取access token</p><blockquote><p>https请求方式: GET <a href="https://api.weixin.qq.com/cgi-bin/token?grant_type=client_credential&amp;appid=APPID&amp;secret=APPSECRET">https://api.weixin.qq.com/cgi-bin/token?grant_type=client_credential&amp;appid=APPID&amp;secret=APPSECRET</a></p></blockquote><div class="table-container"><table><thead><tr><th style="text-align:left">参数</th><th style="text-align:left">是否必须</th><th style="text-align:left">说明</th></tr></thead><tbody><tr><td style="text-align:left">grant_type</td><td style="text-align:left">是</td><td style="text-align:left">获取access_token填写client_credential</td></tr><tr><td style="text-align:left">appid</td><td style="text-align:left">是</td><td style="text-align:left">第三方用户唯一凭证</td></tr><tr><td style="text-align:left">secret</td><td style="text-align:left">是</td><td style="text-align:left">第三方用户唯一凭证密钥，即appsecret</td></tr></tbody></table></div><p><strong>返回说明</strong></p><p>正常情况下，微信会返回下述 JSON 数据包给公众号：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">&quot;access_token&quot;</span>:<span class="string">&quot;ACCESS_TOKEN&quot;</span>,<span class="attr">&quot;expires_in&quot;</span>:<span class="number">7200</span>&#125;</span><br></pre></td></tr></table></figure><p>错误时微信会返回错误码等信息，JSON数据包示例如下（该示例为 AppID 无效错误）:</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">&quot;errcode&quot;</span>:<span class="number">40013</span>,<span class="attr">&quot;errmsg&quot;</span>:<span class="string">&quot;invalid appid&quot;</span>&#125;</span><br></pre></td></tr></table></figure><h2 id="素材管理"><a href="#素材管理" class="headerlink" title="素材管理"></a>素材管理</h2><h3 id="新增永久素材"><a href="#新增永久素材" class="headerlink" title="新增永久素材"></a>新增永久素材</h3><p>对于常用的素材，开发者可通过本接口上传到微信服务器，永久使用。新增的永久素材也可以在公众平台官网素材管理模块中查询管理。</p><p>通过 POST 表单来调用接口，表单 id 为media，包含需要上传的素材内容，有filename、filelength、content-type等信息。</p><p><strong>请注意：图片素材将进入公众平台官网素材管理模块中的默认分组。</strong>也就是说现在还不支持上传素材时创建分组.不过问题不大,到时候写文章时手动</p><blockquote><p>http请求方式: POST，需使用https <a href="https://api.weixin.qq.com/cgi-bin/material/add_material?access_token=ACCESS_TOKEN&amp;type=TYPE">https://api.weixin.qq.com/cgi-bin/material/add_material?access_token=ACCESS_TOKEN&amp;type=TYPE</a> </p></blockquote><div class="table-container"><table><thead><tr><th style="text-align:left">参数</th><th style="text-align:left">是否必须</th><th style="text-align:left">说明</th></tr></thead><tbody><tr><td style="text-align:left">access_token</td><td style="text-align:left">是</td><td style="text-align:left">调用接口凭证</td></tr><tr><td style="text-align:left">type</td><td style="text-align:left">是</td><td style="text-align:left">媒体文件类型，分别有图片（image）、语音（voice）、视频（video）和缩略图（thumb）</td></tr><tr><td style="text-align:left">media</td><td style="text-align:left">是</td><td style="text-align:left">form-data中媒体文件标识，有filename、filelength、content-type等信息</td></tr></tbody></table></div><p>新增永久视频素材需特别注意</p><p>在上传视频素材时需要 POST 另一个表单，id为description，包含素材的描述信息，内容格式为JSON，格式如下：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;title&quot;</span>:VIDEO_TITLE,</span><br><span class="line">    <span class="attr">&quot;introduction&quot;</span>:INTRODUCTION</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><div class="table-container"><table><thead><tr><th style="text-align:left">参数</th><th style="text-align:left">是否必须</th><th style="text-align:left">说明</th></tr></thead><tbody><tr><td style="text-align:left">title</td><td style="text-align:left">是</td><td style="text-align:left">视频素材的标题</td></tr><tr><td style="text-align:left">introduction</td><td style="text-align:left">是</td><td style="text-align:left">视频素材的描述</td></tr></tbody></table></div><p>返回说明</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;media_id&quot;</span>:MEDIA_ID,</span><br><span class="line">  <span class="attr">&quot;url&quot;</span>:URL</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="获取素材总数"><a href="#获取素材总数" class="headerlink" title="获取素材总数"></a>获取素材总数</h3><p>永久素材的总数，也会计算公众平台官网素材管理中的素材 2.图片和图文消息素材（包括单图文和多图文）的总数上限为100000，其他素材的总数上限为1000 3.调用该接口需 https 协议</p><p>接口调用请求说明</p><blockquote><p>http请求方式: GET <a href="https://api.weixin.qq.com/cgi-bin/material/get_materialcount?access_token=ACCESS_TOKEN">https://api.weixin.qq.com/cgi-bin/material/get_materialcount?access_token=ACCESS_TOKEN</a></p></blockquote><h2 id="使用库"><a href="#使用库" class="headerlink" title="使用库"></a>使用库</h2><p>requests发送http请求,lxml解析html,tqdm显示进度条.</p><p>主要功能 爬取某个网站的所有图片,将某个文件夹下的图片全部上传.</p><p>一天随便写了写,比较菜还请见谅.</p><h3 id="用户类"><a href="#用户类" class="headerlink" title="用户类"></a>用户类</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.access_token = <span class="literal">None</span></span><br><span class="line">        self.__appId = <span class="built_in">input</span>(<span class="string">&#x27;请输入您的appid:&#x27;</span>)</span><br><span class="line">        self.__appSecret = <span class="built_in">input</span>(<span class="string">&#x27;请输入您的appsecret:&#x27;</span>)</span><br><span class="line">        self.logintime = <span class="number">3</span></span><br><span class="line">        self.login()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">login</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">while</span> self.logintime:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                res = requests.get(</span><br><span class="line">                    <span class="string">f&quot;https://api.weixin.qq.com/cgi-bin/token?grant_type=client_credential&amp;appid=<span class="subst">&#123;self.__appId&#125;</span>&amp;secret=<span class="subst">&#123;self.__appSecret&#125;</span>&quot;</span>, )</span><br><span class="line">                <span class="keyword">if</span> res.status_code == <span class="number">200</span>:</span><br><span class="line">                    self.access_token = res.json()[<span class="string">&#x27;access_token&#x27;</span>]</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&#x27;输入错误!请尝试再次输入,还剩&#x27;</span> + self.logintime + <span class="string">&#x27;次机会&#x27;</span>)</span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;错误&#x27;</span>, res.json(), e)</span><br><span class="line">            self.logintime = self.logintime - <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">quit</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;退出&#x27;</span>)</span><br><span class="line">        sys.exit(<span class="number">0</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>这里就是注册 没什么好说的 可以增加一个错误机会.</p><h3 id="获取图片类"><a href="#获取图片类" class="headerlink" title="获取图片类"></a>获取图片类</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os.path</span><br><span class="line"><span class="keyword">import</span> tqdm</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Article</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.__url = <span class="literal">None</span></span><br><span class="line">        self.title = <span class="literal">None</span></span><br><span class="line">        self.__header = &#123;</span><br><span class="line">            <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) &#x27;</span></span><br><span class="line">                          <span class="string">&#x27;Chrome/108.0.0.0 Safari/537.36 Edg/108.0.1462.54&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">        self.filepathList = <span class="built_in">set</span>()</span><br><span class="line">        self.getUpdated()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getUpdated</span>(<span class="params">self</span>):</span></span><br><span class="line">        url = <span class="string">&#x27;https://www.pixivision.net/zh/c/illustration&#x27;</span></span><br><span class="line">        res = requests.get(url,headers=self.__header)</span><br><span class="line">        selector = etree.HTML(res.text)</span><br><span class="line">        lastUpdatedNumber = selector.xpath(<span class="string">&quot;//li[@class=&#x27;article-card-container&#x27;][1]/article/div[@class=&#x27;arc__thumbnail-container&#x27;]/a[1]/@href&quot;</span>)[<span class="number">0</span>]</span><br><span class="line">        lastUpdatedNumber = lastUpdatedNumber.split(<span class="string">&#x27;/&#x27;</span>)[-<span class="number">1</span>]</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;最新的图文号为&#x27;</span>,lastUpdatedNumber)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getarticle</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.__url = <span class="built_in">input</span>(<span class="string">&#x27;输入网站链接(仅限pixvision:https://www.pixivision.net/zh/a/number):&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> self.__url.isnumeric():</span><br><span class="line">            self.__url = <span class="string">&#x27;https://www.pixivision.net/zh/a/&#x27;</span> + self.__url</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            res = requests.get(self.__url, headers=self.__header)</span><br><span class="line">        <span class="keyword">except</span> requests.exceptions.ProxyError <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;网络出现问题&#x27;</span>, e)</span><br><span class="line">            sys.exit(-<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;出错&#x27;</span>, e)</span><br><span class="line">            sys.exit(-<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        selector = etree.HTML(res.text)</span><br><span class="line">        imgLinks = selector.xpath(</span><br><span class="line">            <span class="string">&quot;////div[@class=&#x27;_feature-article-body&#x27;]/div[@class=&#x27;article-item _feature-article-body__pixiv_illust&#x27;]//div[@class=&#x27;am__work__main&#x27;]//img/@src&quot;</span>)  <span class="comment"># 返回为一列表</span></span><br><span class="line">        self.title = selector.xpath(<span class="string">&quot;//h1[@class=&#x27;am__title&#x27;]/text()&quot;</span>)</span><br><span class="line">        self.download(imgLinks)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">download</span>(<span class="params">self, imgLinks</span>):</span></span><br><span class="line">        filepath = <span class="built_in">input</span>(<span class="string">&#x27;输入下载的目录路径(默认F:\公众号\图片):&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(filepath):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;目录输入错误&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        absfilepath = filepath + <span class="string">f&#x27;\\<span class="subst">&#123;self.title&#125;</span>&#x27;</span></span><br><span class="line">        <span class="keyword">if</span> os.path.exists(absfilepath):</span><br><span class="line">            <span class="comment"># 清空文件夹中的文件</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;清空文件夹中的文件&#x27;</span>)</span><br><span class="line">            del_list = os.listdir(absfilepath)</span><br><span class="line">            <span class="keyword">for</span> f <span class="keyword">in</span> del_list:</span><br><span class="line">                file_path = os.path.join(absfilepath, f)</span><br><span class="line">                <span class="keyword">if</span> os.path.isfile(file_path):</span><br><span class="line">                    os.remove(file_path)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;生成文件夹&#x27;</span>)</span><br><span class="line">            os.mkdir(absfilepath)</span><br><span class="line">        self.filepathList.add(absfilepath)</span><br><span class="line">        self.__header[<span class="string">&#x27;Referer&#x27;</span>] = <span class="string">&#x27;https://www.pixiv.net/&#x27;</span></span><br><span class="line">        pbar = tqdm.tqdm(imgLinks)</span><br><span class="line">        total = <span class="built_in">len</span>(imgLinks)</span><br><span class="line">        <span class="keyword">for</span> index, link <span class="keyword">in</span> <span class="built_in">enumerate</span>(pbar):</span><br><span class="line">            filename = link.split(<span class="string">&#x27;/&#x27;</span>)[-<span class="number">1</span>]</span><br><span class="line">            pbar.set_description(<span class="string">&quot;正在下载%s,&quot;</span> % filename)</span><br><span class="line">            pbar.set_postfix(&#123;<span class="string">&#x27;current&#x27;</span>: index + <span class="number">1</span>, <span class="string">&#x27;total&#x27;</span>: total&#125;)</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                res = requests.get(link, headers=self.__header)</span><br><span class="line">                <span class="keyword">with</span> <span class="built_in">open</span>(absfilepath + <span class="string">f&#x27;\\<span class="subst">&#123;filename&#125;</span>&#x27;</span>, <span class="string">&#x27;wb+&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                    f.write(res.content)</span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;需要设置代理&#x27;</span>, e)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>这里主要利用xpath解析获取到的网页.</p><h3 id="上传素材类"><a href="#上传素材类" class="headerlink" title="上传素材类"></a>上传素材类</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tqdm</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">upload</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, ACCESS_TOKEN, FILEPATHLIST</span>):</span></span><br><span class="line">        self.url = <span class="string">f&#x27;https://api.weixin.qq.com/cgi-bin/material/add_material?access_token=<span class="subst">&#123;ACCESS_TOKEN&#125;</span>&amp;type&#x27;</span> \</span><br><span class="line">                   <span class="string">f&#x27;=image&#x27;</span></span><br><span class="line">        self.filepath = FILEPATHLIST</span><br><span class="line">        self.uploadPics()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">uploadPics</span>(<span class="params">self</span>):</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(self.filepath, <span class="built_in">str</span>):</span><br><span class="line">            self.uploadPic(self.filepath)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">for</span> f <span class="keyword">in</span> self.filepath:</span><br><span class="line">                self.uploadPic(f)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">uploadPic</span>(<span class="params">self, filepath</span>):</span></span><br><span class="line">        <span class="keyword">if</span> os.path.isdir(filepath):</span><br><span class="line">            filelist = os.listdir(filepath)</span><br><span class="line">            total = <span class="built_in">len</span>(filelist)</span><br><span class="line">            pbar = tqdm.tqdm(filelist)</span><br><span class="line">            <span class="keyword">for</span> index, f <span class="keyword">in</span> <span class="built_in">enumerate</span>(pbar):</span><br><span class="line">                file_path = os.path.join(filepath, f)</span><br><span class="line">                <span class="keyword">if</span> os.path.isfile(file_path):</span><br><span class="line">                    <span class="keyword">with</span> <span class="built_in">open</span>(file_path, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">                        files = &#123;</span><br><span class="line">                            <span class="string">&#x27;media&#x27;</span>: file</span><br><span class="line">                        &#125;</span><br><span class="line">                        res = requests.post(self.url, files=files)</span><br><span class="line">                        pbar.set_description(<span class="string">&#x27;正在上传&#x27;</span> + res.json()[<span class="string">&#x27;url&#x27;</span>])</span><br><span class="line">                        pbar.set_postfix(&#123;<span class="string">&#x27;current&#x27;</span>: index + <span class="number">1</span>, <span class="string">&#x27;total&#x27;</span>: total&#125;)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;文件夹错误&#x27;</span>, filepath)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>注意</strong>:requests上传FormData 需要利用files</p><h3 id="主文件"><a href="#主文件" class="headerlink" title="主文件"></a>主文件</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> user <span class="keyword">import</span> User</span><br><span class="line"><span class="keyword">from</span> getpic <span class="keyword">import</span> Article</span><br><span class="line"><span class="keyword">from</span> uploadpic <span class="keyword">import</span> upload</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    uploadDownloadpic = <span class="string">&#x27;0&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">input</span>(<span class="string">&#x27;直接上传图片?0表示直接上传,1表示下载\n&#x27;</span>) == <span class="string">&#x27;1&#x27;</span>:</span><br><span class="line">        article = Article()</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            article.getarticle()</span><br><span class="line">            doContinue = <span class="built_in">input</span>(<span class="string">&#x27;是否继续下载图片？1表示继续,0表示退出\n&#x27;</span>)</span><br><span class="line">            <span class="keyword">if</span> doContinue != <span class="string">&#x27;1&#x27;</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        uploadDownloadpic = <span class="built_in">input</span>(<span class="string">&#x27;是否上传刚才的图片?1表示是,0表示自己选择\n&#x27;</span>)</span><br><span class="line">    u = User()</span><br><span class="line">    <span class="keyword">if</span> uploadDownloadpic == <span class="string">&#x27;1&#x27;</span>:</span><br><span class="line">        upload(u.access_token, article.filepathList)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        filepath = <span class="built_in">input</span>(<span class="string">&#x27;输入需要上传的文件目录(单个):\n&#x27;</span>)</span><br><span class="line">        upload(u.access_token, filepath)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>只是连续写了一会就累了,最近有点忙,利用这个工具上传素材到微信公众号方便水文章.最后可以利用pyinstaller打包</p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      
        <tags>
            
            <tag> python </tag>
            
            <tag> xpath </tag>
            
            <tag> request </tag>
            
            <tag> wechat </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>构建微信快捷发布文章工具</title>
      <link href="2023/01/04/%E6%9E%84%E5%BB%BA%E5%BE%AE%E4%BF%A1%E5%BF%AB%E6%8D%B7%E5%8F%91%E5%B8%83%E6%96%87%E7%AB%A0%E5%B7%A5%E5%85%B7/"/>
      <url>2023/01/04/%E6%9E%84%E5%BB%BA%E5%BE%AE%E4%BF%A1%E5%BF%AB%E6%8D%B7%E5%8F%91%E5%B8%83%E6%96%87%E7%AB%A0%E5%B7%A5%E5%85%B7/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>最近在使用微信公众号写文章但是每天打开网页太麻烦,而且上传图片文章也麻烦.于是打算自己写个桌面程序.主要使用vue和electron,使用vite构建工具. 长期更新<br><span id="more"></span></p><h2 id="工具的选择"><a href="#工具的选择" class="headerlink" title="工具的选择"></a>工具的选择</h2><p><a href="https://www.bilibili.com/video/BV1FP4115739?p=36&amp;vd_source=177ef88aa6608bc3652c72d71b0aa098">036-Vue3+Electron19项目-1_哔哩哔哩_bilibili</a></p><p>这个视频用了vite构建,比较新.之前我还在用webpack以及vue2. Vite与vue3比较搭.</p><h3 id="vite"><a href="#vite" class="headerlink" title="vite"></a>vite</h3><p><a href="https://cn.vitejs.dev/guide/#scaffolding-your-first-vite-project">开始 | Vite 官方中文文档 (vitejs.dev)</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm create vite@latest</span><br></pre></td></tr></table></figure><p>值得注意的是Vite 需要 <a href="https://nodejs.org/en/">Node.js</a> 版本 14.18+，16+。然而，有些模板需要依赖更高的 Node 版本才能正常运行，当你的包管理器发出警告时，请注意升级你的 Node 版本.当然我这里windows环境下主要利用nvm切换版本到新的.</p><p><img data-src="http://cdn.sekyoro.top/imgs/04/0120230104172727.png" alt="image-20230104172713111"></p><blockquote><p>注意:你可能使用低版本node创建一开始没报错,但后面会出问题.同时使用nvm注意版本问题,我这里使用了旧版本nvm报错unexpected token ‘.’.需要升级nvm<a href="https://blog.csdn.net/weixin_45696837/article/details/127830020">nvm：npm ERR! Unexpected token ‘.‘_爱天蝎的双鱼的博客-CSDN博客</a></p></blockquote><p>主要利用Vite构建</p><h3 id="electron"><a href="#electron" class="headerlink" title="electron"></a>electron</h3><p><a href="https://www.electronjs.org/zh/docs/latest/">简介 | Electron (electronjs.org)</a></p><p>Electron是一个使用 JavaScript、HTML 和 CSS 构建桌面应用程序的框架。 嵌入 <a href="https://www.chromium.org/">Chromium</a> 和 <a href="https://nodejs.org/">Node.js</a> 到 二进制的 Electron 允许您保持一个 JavaScript 代码代码库并创建 在Windows上运行的跨平台应用 macOS和Linux——不需要本地开发 经验</p><p>同时注意须要electron-builder打包</p><h3 id="vue3"><a href="#vue3" class="headerlink" title="vue3"></a>vue3</h3><p><a href="https://cn.vuejs.org/">Vue.js - 渐进式 JavaScript 框架 | Vue.js (vuejs.org)</a></p><p>Vue (发音为 /vjuː/，类似 <strong>view</strong>) 是一款用于构建用户界面的 JavaScript 框架。它基于标准 HTML、CSS 和 JavaScript 构建，并提供了一套声明式的、组件化的编程模型，帮助你高效地开发用户界面。无论是简单还是复杂的界面，Vue 都可以胜任。</p><p>vite构建时即可选择使用vue.现在已经默认3.x</p><h3 id="Element-plus"><a href="#Element-plus" class="headerlink" title="Element plus"></a>Element plus</h3><p><a href="https://element-plus.org/zh-CN/guide/design.html"><a href="https://element-plus.org/zh-CN/">一个 Vue 3 UI 框架 | Element Plus (element-plus.org)</a></a></p><p>基于 Vue 3，面向设计师和开发者的组件库</p><h3 id="其他UI-Bootstrap5"><a href="#其他UI-Bootstrap5" class="headerlink" title="其他UI Bootstrap5"></a>其他UI Bootstrap5</h3><p>也可以使用Bootstrap</p><p>npm导入后需要引入</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;bootstrap/dist/css/bootstrap.min.css&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;bootstrap/dist/js/bootstrap.min.js&#x27;</span></span><br></pre></td></tr></table></figure><p><a href="https://v5.bootcss.com/">Bootstrap v5 中文文档 · Bootstrap 是全球最受欢迎的 HTML、CSS 和 JS 前端工具库。 | Bootstrap 中文网 (bootcss.com)</a></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i bootstrap@5.3.0-alpha1</span><br></pre></td></tr></table></figure><h3 id="打包工具"><a href="#打包工具" class="headerlink" title="打包工具"></a>打包工具</h3><p><a href="https://jrsoftware.org/isinfo.php">Inno Setup (jrsoftware.org)</a></p><p>用于把生成的exe打包发布,这样就不是光溜溜的一个exe了.</p><p><a href="https://zhuanlan.zhihu.com/p/168690637">Inno Setup使用总结 - 知乎 (zhihu.com)</a></p><h3 id="热重载"><a href="#热重载" class="headerlink" title="热重载"></a>热重载</h3><p><a href="https://github.com/Kuari/Blog/issues/53">Vite+Electron快速构建一个VUE3桌面应用(二)——动态模块热重载 · Issue #53 · Kuari/Blog (github.com)</a></p><p>为了使vite和electron正常运行，需要先运行vite，使得其开发服务器的url可以正常访问，然后再开启electron去加载url。</p><p>此处需要安装两个库：</p><ul><li><p><strong>concurrently</strong>：阻塞运行多个命令，<code>-k</code>参数用来清除其它已经存在或者挂掉的进程</p></li><li><p><strong>wait-on</strong>：等待资源，此处用来等待url可访问</p></li><li><p>接着更新文件<code>package.json</code>，<code>scripts</code>新增两条命令：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">  <span class="attr">&quot;electron&quot;</span>: <span class="string">&quot;wait-on tcp:5173 &amp;&amp; electron .&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;start&quot;</span>: <span class="string">&quot;concurrently -k \&quot;yarn dev\&quot; \&quot;yarn electron\&quot;&quot;</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></li></ul><p>start命令就是为了运行vue项目然后等其打开后运行electron.在开发时electron需要加载这个url.</p><p>在目录下创建main.js   加载5173端口 这个端口就是vite打开的</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; app, BrowserWindow &#125; = <span class="built_in">require</span>(<span class="string">&#x27;electron&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> createWindow = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> win = <span class="keyword">new</span> BrowserWindow(&#123;</span><br><span class="line">    <span class="attr">width</span>: <span class="number">800</span>,</span><br><span class="line">    <span class="attr">height</span>: <span class="number">600</span></span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// win.loadFile(&#x27;index.html&#x27;)</span></span><br><span class="line">  win.loadURL(<span class="string">&#x27;http://localhost:5173&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">app.whenReady().then(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  createWindow()</span><br><span class="line"></span><br><span class="line">  app.on(<span class="string">&#x27;activate&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (BrowserWindow.getAllWindows().length === <span class="number">0</span>) createWindow()</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.on(<span class="string">&#x27;window-all-closed&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (process.platform !== <span class="string">&#x27;darwin&#x27;</span>) app.quit()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>最后运行npm run start</p><p><img data-src="http://cdn.sekyoro.top/imgs/04/0120230104222629.png" alt="image-20230104222628604" style="zoom:67%;" /></p><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ol><li><a href="https://blog.csdn.net/lw001x/article/details/127589755?spm=1001.2101.3001.6650.6&amp;utm_medium=distribute.pc_relevant.none-task-blog-2~default~ESLANDING~default-6-127589755-blog-128000357.pc_relevant_landingrelevant&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-2~default~ESLANDING~default-6-127589755-blog-128000357.pc_relevant_landingrelevant&amp;utm_relevant_index=7">Vite+Vue+Electron环境搭建_⑥②的博客-CSDN博客_electron vite vue</a></li></ol><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      
        <tags>
            
            <tag> vue </tag>
            
            <tag> wechat </tag>
            
            <tag> vite </tag>
            
            <tag> electron </tag>
            
            <tag> Bootstrap5 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>美化github首页</title>
      <link href="2023/01/01/%E7%BE%8E%E5%8C%96github%E9%A6%96%E9%A1%B5/"/>
      <url>2023/01/01/%E7%BE%8E%E5%8C%96github%E9%A6%96%E9%A1%B5/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>新年到了,新年新气象.美化一下github首页.<br><span id="more"></span></p><p>在几年前Github推出了美化profile的功能,到现在我来体验一下.</p><p>最后成果,比较简单方便.</p><p><img data-src="http://cdn.sekyoro.top/imgs/01/0120230101163704.png" alt="image-20230101163704294" style="zoom:50%;" /></p><p><img data-src="http://cdn.sekyoro.top/imgs/01/0120230101163735.png" alt="image-20230101163735498" style="zoom:50%;" /></p><p><img data-src="http://cdn.sekyoro.top/imgs/01/0120230101163806.png" alt="image-20230101163806235" style="zoom:50%;" /></p><h2 id="流程"><a href="#流程" class="headerlink" title="流程"></a>流程</h2><p>主要流程比较简单,创建一个仓库,仓库的命名需要与自己Github用户名一致.</p><p>这里因为我创建过了所以提示重命名.然后这个仓库需要一个readme.md文件,就是用这个markdown文件来美化主页.重要的是其中显示个人数据的接口.</p><p>这里推荐两个模板生成器,可以看参考资料的前两个.</p><h3 id="github-stats"><a href="#github-stats" class="headerlink" title="github stats"></a>github stats</h3><p>接下来是github stats<a href="https://github.com/anuraghazra/github-readme-stats/blob/master/docs/readme_cn.md">github-readme-stats/readme_cn.md at master · anuraghazra/github-readme-stats</a></p><p><img data-src="https://camo.githubusercontent.com/8fd2570f103d1aae8a4d8970535274ae19c2ee62587d8868d618be37001263d0/68747470733a2f2f7265732e636c6f7564696e6172792e636f6d2f616e7572616768617a72612f696d6167652f75706c6f61642f76313539353137343533362f6772732d7468656d65735f6c34796e6a612e706e67" alt="GitHub Readme Stat Themes" style="zoom: 33%;" /></p><blockquote><p>你可以通过使用 URL 参数的方式，为你的 <code>Stats Card</code> 或 <code>Repo Card</code> 自定义样式。</p><p>常用选项：</p><ul><li><code>title_color</code> - 卡片标题颜色 <em>（十六进制色码）</em></li><li><code>text_color</code> - 内容文本颜色 <em>（十六进制色码）</em></li><li><code>icon_color</code> - 图标颜色（如果可用）<em>（十六进制色码）</em></li><li><code>bg_color</code> - 卡片背景颜色 <em>（十六进制色码）</em> <strong>或者</strong> 以 <em>angle,start,end</em> 的形式渐变</li><li><code>hide_border</code> - 隐藏卡的边框 <em>(布尔值)</em></li><li><code>theme</code> - 主题名称，从<a href="https://github.com/anuraghazra/github-readme-stats/blob/master/themes/README.md">所有可用主题</a>中选择</li><li><code>cache_seconds</code> - 手动设置缓存头 <em>（最小值: 1800，最大值: 86400）</em></li><li><code>locale</code> - 在卡片中设置语言 <em>(例如 cn, de, es, 等等)</em></li></ul></blockquote><p>同时也有个人常用语言统计</p><p>将此代码复制粘贴到您的 <code>README.md</code> 文件中，并修改链接。</p><p>端点: <code>api/top-langs?username=anuraghazra</code></p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">![Top Langs</span>](<span class="link">https://github-readme-stats.vercel.app/api/top-langs/?username=anuraghazra</span>)](<span class="link">https://github.com/anuraghazra/github-readme-stats</span>)</span><br></pre></td></tr></table></figure><h3 id="github-stats-1"><a href="#github-stats-1" class="headerlink" title="github stats"></a>github stats</h3><p>然后是个人信息统计,可以利用<a href="https://metrics.lecoq.io/">Metrics (lecoq.io)</a>,只需要输入Github用户名生成个人metrics.</p><p><img data-src="https://camo.githubusercontent.com/b9deb4987189bc5222f2b2fad0c0b461a171abfcaa31ac38006df8db466e4d2f/68747470733a2f2f6d6574726963732e6c65636f712e696f2f64726f776e696e672d696e2d636f6465733f74656d706c6174653d636c617373696326626173653d6865616465722532432532306163746976697479253243253230636f6d6d756e6974792532432532307265706f7369746f726965732532432532306d6574616461746126626173652e696e64657074683d66616c736526626173652e6869726561626c653d66616c736526626173652e736b69703d66616c736526636f6e6669672e74696d657a6f6e653d417369612532465368616e67686169" alt="img" style="zoom:50%;" /></p><h3 id="github-activity-graph"><a href="#github-activity-graph" class="headerlink" title="github activity graph"></a>github activity graph</h3><p>github活动图 也就是显示提交记录的.<a href="https://github.com/Ashutosh00710/github-readme-activity-graph/">Ashutosh00710/github-readme-activity-graph: A dynamically generated activity graph to show your GitHub activities of last 31 days.</a></p><p><img data-src="https://github.com/Ashutosh00710/github-readme-activity-graph/raw/main/asset/default.svg" alt="graph" style="zoom: 33%;" /></p><p>类似的将下面markdown中username改为自己github用户名.    </p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">![Ashutosh&#x27;s github activity graph</span>](<span class="link">https://github-readme-activity-graph.cyclic.app/graph?username=Ashutosh00710&amp;theme=dracula</span>)](<span class="link">https://github.com/ashutosh00710/github-readme-activity-graph</span>)</span><br></pre></td></tr></table></figure><h3 id="github-streak"><a href="#github-streak" class="headerlink" title="github streak"></a>github streak</h3><p>显示个人github成就</p><p><a href="https://github.com/DenverCoder1/github-readme-streak-stats">DenverCoder1/github-readme-streak-stats: 🔥 Stay motivated and show off your contribution streak! 🌟 Display your total contributions, current streak, and longest streak on your GitHub profile README</a></p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">![GitHub Streak</span>](<span class="link">https://streak-stats.demolab.com/?user=DenverCoder1</span>)](<span class="link">https://git.io/streak-stats</span>)</span><br></pre></td></tr></table></figure><h3 id="Shields（GitHub-徽章）"><a href="#Shields（GitHub-徽章）" class="headerlink" title="Shields（GitHub 徽章）"></a>Shields（GitHub 徽章）</h3><p><img data-src="http://cdn.sekyoro.top/imgs/01/0120230101165219.png" alt="image-20230101165219583" style="zoom:50%;" /></p><p>主要使用<a href="https://shields.io/这个网站生成图标比较简单,可以在外面包裹一个超链接用于跳转">https://shields.io/这个网站生成图标比较简单,可以在外面包裹一个超链接用于跳转</a>.</p><h3 id="Visitor-Badge（GitHub-访客徽章）"><a href="#Visitor-Badge（GitHub-访客徽章）" class="headerlink" title="Visitor Badge（GitHub 访客徽章）"></a>Visitor Badge（GitHub 访客徽章）</h3><p><img data-src="http://cdn.sekyoro.top/imgs/01/01image-20230101165431536.png" alt="image-20230101165431536" style="zoom: 67%;" /></p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">![<span class="string">visitors</span>](<span class="link">https://visitor-badge.glitch.me/badge?page_id=page.id&amp;left_color=green&amp;right_color=red</span>)</span><br></pre></td></tr></table></figure><p>将page_id替换为用户名即可.</p><p>最后可以看一下我的Github主页<a href="https://github.com/drowning-in-codes">drowning-in-codes (martyr) (github.com)</a>参观,模板生成的也比较简便.</p><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ol><li><a href="https://profilinator.rishav.dev/">Github Profilinator - GitHub Profile README Generator (rishav.dev)</a> 快捷的模板生成器</li><li><a href="https://rahuldkjain.github.io/gh-profile-readme-generator/">GitHub Profile Readme Generator | GitHub Profile Readme Generator (rahuldkjain.github.io)</a> 另一个快捷的模板生成器</li><li><a href="https://zhuanlan.zhihu.com/p/454597068">Github 首页美化教程（一）：打造个性化的GitHub首页</a> 其他教程</li><li><a href="https://sumygg.com/2021/04/25/beautify-your-github-profile-readme/">美化你的Github个人信息页 | SumyBlog (sumygg.com)</a></li><li><a href="https://shields.io/">Shields.io: Quality metadata badges for open source projects</a> 图标</li><li><a href="https://github.com/abhisheknaiidu/awesome-github-profile-readme">abhisheknaiidu/awesome-github-profile-readme: 😎 A curated list of awesome GitHub Profile READMEs 📝</a> 优美的github profile案例</li></ol><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      
        <tags>
            
            <tag> github </tag>
            
            <tag> github profile </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Flutter学习</title>
      <link href="2022/12/28/Flutter%E5%AD%A6%E4%B9%A0/"/>
      <url>2022/12/28/Flutter%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>Flutter学习,主要用于移动端,展示的应用,跨平台.长期更新<br><span id="more"></span></p><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>Flutter主要是跨平台移动端UI框架,我使用它主要也是不错的UI设计以及跨平台的特性.至于原生开发其实也是不错的,各有所长吧.</p><p>开发工具是Android Studio或者vscode.至少就我现在的开发体验来说两者差别不大,前者功能更多.</p><p><strong>Android Studio的一些重要快捷键</strong>     </p><p><img data-src="http://cdn.sekyoro.top/imgs/28/1220221228215414.png" alt="image-20221228215320830" style="zoom:67%;" /></p><p><img data-src="http://cdn.sekyoro.top/imgs/28/1220221228215449.png" alt="image-20221228215449009"></p><p><img data-src="http://cdn.sekyoro.top/imgs/28/1220221228215521.png" alt="image-20221228215521331" style="zoom:67%;" /></p><h3 id="代码辅助和快速修复"><a href="#代码辅助和快速修复" class="headerlink" title="代码辅助和快速修复"></a>代码辅助和快速修复</h3><p>代码辅助功能是特定代码标识符相关的代码修改。当光标放在 Flutter widget 上时，黄色灯泡图标会指示可用的修改，可以通过点击灯泡进行修改，或使用键盘快捷键（在 Linux 和 Windows 上使用 <code>Alt</code>+<code>Enter</code>，在 macOS 上使用 <code>Option</code>+<code>Return</code>）</p><h4 id="Widget-嵌套辅助"><a href="#Widget-嵌套辅助" class="headerlink" title="Widget 嵌套辅助"></a>Widget 嵌套辅助</h4><p>当你有一个 widget 需要嵌套在其他 widget 时，可以使用该功能。例如，需要将 widget 嵌套在 <code>Row</code> 或 <code>Column</code> 中。</p><h4 id="Widget-列表嵌套辅助"><a href="#Widget-列表嵌套辅助" class="headerlink" title="Widget 列表嵌套辅助"></a>Widget 列表嵌套辅助</h4><p>和上面的辅助类似，但它嵌套的是一个 widget 的列表，而不是单个的 widget。</p><h4 id="child-和-children-转换辅助"><a href="#child-和-children-转换辅助" class="headerlink" title="child 和 children 转换辅助"></a>child 和 children 转换辅助</h4><p>将 child 转换成 children，并且把参数值写进一个 list。</p><p>Flutter 插件包含了以下模板：</p><ul><li>前缀 <code>stless</code>：创建一个 <code>StatelessWidget</code> 的子类。</li><li>前缀 <code>stful</code>：创建一个 <code>StatefulWidget</code> 的子类，并关联 State 子类。</li><li>前缀 <code>stanim</code>：创建一个 <code>StatefulWidget</code> 的子类，并关联 State 子类，包含一个 <code>AnimationController</code> 的初始化字段</li></ul><h3 id="流程"><a href="#流程" class="headerlink" title="流程"></a>流程</h3><p>不同系统不同配置可能有不同情况. 我这边首先需要在管理员模式下使用adb devices或者类似命令使得能访问adb.然后选择该模拟器,使用flutter run开启应用.</p><p><img data-src="http://cdn.sekyoro.top/imgs/28/1220221228222209.png" alt="image-20221228222209219" style="zoom:50%;" /></p><h3 id="vscode重要快捷键"><a href="#vscode重要快捷键" class="headerlink" title="vscode重要快捷键"></a>vscode重要快捷键</h3><p><img data-src="http://cdn.sekyoro.top/imgs/28/1220221228223036.png" alt="image-20221228223036046"></p><p>另外Ctrl+shift+\可以跳转到括号另一边.</p><h3 id="Images"><a href="#Images" class="headerlink" title="Images"></a>Images</h3><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">body: Center(</span><br><span class="line">          <span class="comment">// ignore: prefer_const_constructors</span></span><br><span class="line">          child: Image(</span><br><span class="line">        image: <span class="keyword">const</span> AssetImage(<span class="string">&#x27;assets/4.jpg&#x27;</span>),</span><br><span class="line">              <span class="comment">//NetworkImage(&#x27;&#x27;)</span></span><br><span class="line">        <span class="comment">// fit: BoxFit.cover,</span></span><br><span class="line">      )),</span><br></pre></td></tr></table></figure><h3 id="发布app"><a href="#发布app" class="headerlink" title="发布app"></a>发布app</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">keytool -genkey -v -keystore  my-release-key.keystore -<span class="built_in">alias</span> my-key-alias -keyalg RSA -keysize 2048 -validity 10000</span><br></pre></td></tr></table></figure><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      
        <tags>
            
            <tag> Flutter </tag>
            
            <tag> Tutorial </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>css中的flex和grid布局</title>
      <link href="2022/12/27/css%E4%B8%AD%E7%9A%84flex%E5%92%8Cgrid%E5%B8%83%E5%B1%80/"/>
      <url>2022/12/27/css%E4%B8%AD%E7%9A%84flex%E5%92%8Cgrid%E5%B8%83%E5%B1%80/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>css中的布局flex和grid现在已经比较常用了.这里简单介绍一下<br><span id="more"></span></p><h2 id="Grid布局"><a href="#Grid布局" class="headerlink" title="Grid布局"></a>Grid布局</h2><p>grid布局,即网格布局.</p><p>采用网格布局的区域，称为”容器”（container）。容器内部采用网格定位的子元素，称为”项目”（item）。容器里面的水平区域称为”行”（row），垂直区域称为”列”（column）。</p><p><img data-src="https://www.wangbase.com/blogimg/asset/201903/1_bg2019032502.png" alt="img" style="zoom:50%;" /></p><p><strong>单元格</strong>:行和列的交叉区域，称为”单元格”（cell）。</p><p>正常情况下，<code>n</code>行和<code>m</code>列会产生<code>n x m</code>个单元格。比如，3行3列会产生9个单元格。</p><p><strong>网格线</strong>:划分网格的线，称为”网格线”（grid line）。水平网格线划分出行，垂直网格线划分出列。</p><p>正常情况下，<code>n</code>行有<code>n + 1</code>根水平网格线，<code>m</code>列有<code>m + 1</code>根垂直网格线，比如三行就有四根水平网格线。</p><p>Grid 布局的属性分成两类。一类定义在容器上面，称为容器属性；另一类定义在项目上面，称为项目属性。这部分先介绍容器属性。</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.container</span> &#123;</span><br><span class="line">   <span class="attribute">display</span>: grid;</span><br><span class="line">   <span class="comment">/* grid-template-columns: 100px 100px 100px; */</span></span><br><span class="line">   <span class="comment">/* grid-template-columns: repeat(3,33.33%); */</span></span><br><span class="line">   <span class="comment">/* grid-template-columns: repeat(2,100px 20px 80px); */</span></span><br><span class="line">   <span class="comment">/* grid-template-columns: repeat(auto-fill,100px); */</span></span><br><span class="line">   grid-template-<span class="attribute">columns</span>: <span class="number">1</span>fr <span class="number">1</span>fr;</span><br><span class="line">   grid-template-rows: <span class="number">100px</span> <span class="number">100px</span> <span class="number">100px</span>;</span><br><span class="line">   row-gap: <span class="number">20px</span>;</span><br><span class="line">   <span class="comment">/* column-gap: 20px; */</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">/* grid-template-areas: ; */</span></span><br><span class="line">   <span class="comment">/* grid-auto-flow: row; */</span></span><br><span class="line"></span><br><span class="line">   justify-items: center;</span><br><span class="line">   <span class="attribute">align-items</span>: center;</span><br><span class="line"></span><br><span class="line">   <span class="attribute">justify-content</span>: space-around;</span><br><span class="line">   <span class="attribute">align-content</span>: end;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><h3 id="grid-template-columns-属性，-grid-template-rows-属性"><a href="#grid-template-columns-属性，-grid-template-rows-属性" class="headerlink" title="grid-template-columns 属性， grid-template-rows 属性"></a>grid-template-columns 属性， grid-template-rows 属性</h3><p>容器指定了网格布局以后，接着就要划分行和列。<code>grid-template-columns</code>属性定义每一列的列宽，<code>grid-template-rows</code>属性定义每一行的行高。</p> <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.container</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: grid;</span><br><span class="line">  grid-template-<span class="attribute">columns</span>: <span class="number">100px</span> <span class="number">100px</span> <span class="number">100px</span>;</span><br><span class="line">  grid-</span><br></pre></td></tr></table></figure><p>为了方便表示比例关系，网格布局提供了<code>fr</code>关键字（fraction 的缩写，意为”片段”）。如果两列的宽度分别为<code>1fr</code>和<code>2fr</code>，就表示后者是前者的两倍。</p> <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.container</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: grid;</span><br><span class="line">  grid-template-<span class="attribute">columns</span>: <span class="number">1</span>fr <span class="number">1</span>fr;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="grid-row-gap-属性，-grid-column-gap-属性，-grid-gap-属性"><a href="#grid-row-gap-属性，-grid-column-gap-属性，-grid-gap-属性" class="headerlink" title="grid-row-gap 属性， grid-column-gap 属性， grid-gap 属性"></a>grid-row-gap 属性， grid-column-gap 属性， grid-gap 属性</h3><p><code>grid-row-gap</code>属性设置行与行的间隔（行间距），<code>grid-column-gap</code>属性设置列与列的间隔（列间距）。</p> <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.container</span> &#123;</span><br><span class="line">  grid-row-gap: <span class="number">20px</span>;</span><br><span class="line">  grid-<span class="attribute">column-gap</span>: <span class="number">20px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="justify-items-属性，-align-items-属性，-place-items-属性"><a href="#justify-items-属性，-align-items-属性，-place-items-属性" class="headerlink" title="justify-items 属性， align-items 属性， place-items 属性"></a>justify-items 属性， align-items 属性， place-items 属性</h3><p><code>justify-items</code>属性设置单元格内容的水平位置（左中右），<code>align-items</code>属性设置单元格内容的垂直位置（上中下）。</p> <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.container</span> &#123;</span><br><span class="line">  justify-items: start | end | center | stretch;</span><br><span class="line">  <span class="attribute">align-items</span>: start | end | center | stretch;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="justify-content-属性，-align-content-属性，-place-content-属性"><a href="#justify-content-属性，-align-content-属性，-place-content-属性" class="headerlink" title="justify-content 属性， align-content 属性， place-content 属性"></a>justify-content 属性， align-content 属性， place-content 属性</h3><p><code>justify-content</code>属性是整个内容区域在容器里面的水平位置（左中右），<code>align-content</code>属性是整个内容区域的垂直位置（上中下）。</p> <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.container</span> &#123;</span><br><span class="line">  <span class="attribute">justify-content</span>: start | end | center | stretch | space-around | space-between | space-evenly;</span><br><span class="line">  <span class="attribute">align-content</span>: start | end | center | stretch | space-around | space-between | space-evenly;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这两个属性的写法完全相同，都可以取下面这些值。（下面的图都以<code>justify-content</code>属性为例，<code>align-content</code>属性的图完全一样，只是将水平方向改成垂直方向。）</p><h3 id="grid-column-start-属性，-grid-column-end-属性，-grid-row-start-属性，-grid-row-end-属性"><a href="#grid-column-start-属性，-grid-column-end-属性，-grid-row-start-属性，-grid-row-end-属性" class="headerlink" title="grid-column-start 属性， grid-column-end 属性， grid-row-start 属性， grid-row-end 属性"></a>grid-column-start 属性， grid-column-end 属性， grid-row-start 属性， grid-row-end 属性</h3><p>项目的位置是可以指定的，具体方法就是指定项目的四个边框，分别定位在哪根网格线。</p><blockquote><ul><li><code>grid-column-start</code>属性：左边框所在的垂直网格线</li><li><code>grid-column-end</code>属性：右边框所在的垂直网格线</li><li><code>grid-row-start</code>属性：上边框所在的水平网格线</li><li><code>grid-row-end</code>属性：下边框所在的水平网格线</li></ul></blockquote><p><code>grid-area</code>属性指定项目放在哪一个区域。</p> <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.item-1</span> &#123;</span><br><span class="line">  grid-area: e;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="justify-self-属性，-align-self-属性，-place-self-属性"><a href="#justify-self-属性，-align-self-属性，-place-self-属性" class="headerlink" title="justify-self 属性， align-self 属性， place-self 属性"></a>justify-self 属性， align-self 属性， place-self 属性</h3><p><code>justify-self</code>属性设置单元格内容的水平位置（左中右），跟<code>justify-items</code>属性的用法完全一致，但只作用于单个项目。</p><p><code>align-self</code>属性设置单元格内容的垂直位置（上中下），跟<code>align-items</code>属性的用法完全一致，也是只作用于单个项目。</p> <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.item</span> &#123;</span><br><span class="line">  justify-self: start | end | center | stretch;</span><br><span class="line">  <span class="attribute">align-self</span>: start | end | center | stretch;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="flex布局"><a href="#flex布局" class="headerlink" title="flex布局"></a>flex布局</h2><p>采用 Flex 布局的元素，称为 Flex 容器（flex container），简称”容器”。它的所有子元素自动成为容器成员，称为 Flex 项目（flex item），简称”项目”。</p><p>容器默认存在两根轴：水平的主轴（main axis）和垂直的交叉轴（cross axis）。主轴的开始位置（与边框的交叉点）叫做<code>main start</code>，结束位置叫做<code>main end</code>；交叉轴的开始位置叫做<code>cross start</code>，结束位置叫做<code>cross end</code>。</p><p>项目默认沿主轴排列。单个项目占据的主轴空间叫做<code>main size</code>，占据的交叉轴空间叫做<code>cross size</code>。</p><p>以下6个属性设置在容器上。</p><h3 id="容器属性"><a href="#容器属性" class="headerlink" title="容器属性"></a>容器属性</h3><blockquote><ul><li>flex-direction</li><li>flex-wrap</li><li>flex-flow</li><li>justify-content</li><li>align-items</li><li>align-content</li></ul></blockquote><h3 id="项目属性"><a href="#项目属性" class="headerlink" title="项目属性"></a>项目属性</h3><p>以下6个属性设置在项目上。</p><blockquote><ul><li><code>order</code></li><li><code>flex-grow</code></li><li><code>flex-shrink</code></li><li><code>flex-basis</code></li><li><code>flex</code></li><li><code>align-self</code></li></ul></blockquote><p><code>order</code>属性定义项目的排列顺序。数值越小，排列越靠前，默认为0</p><p><code>flex-grow</code>属性定义项目的放大比例，默认为<code>0</code>，即如果存在剩余空间，也不放大。</p><p><code>flex-shrink</code>属性定义了项目的缩小比例，默认为1，即如果空间不足，该项目将缩小。</p><p><code>flex-basis</code>属性定义了在分配多余空间之前，项目占据的主轴空间（main size）。浏览器根据这个属性，计算主轴是否有多余空间。它的默认值为<code>auto</code>，即项目的本来大小</p><p><code>flex</code>属性是<code>flex-grow</code>, <code>flex-shrink</code> 和 <code>flex-basis</code>的简写，默认值为<code>0 1 auto</code>。后两个属性可选。</p> <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.item</span> &#123;</span><br><span class="line">  <span class="attribute">flex</span>: none | [ &lt;<span class="string">&#x27;flex-grow&#x27;</span>&gt; &lt;<span class="string">&#x27;flex-shrink&#x27;</span>&gt;? || &lt;<span class="string">&#x27;flex-basis&#x27;</span>&gt; ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>该属性有两个快捷值：<code>auto</code> (<code>1 1 auto</code>) 和 none (<code>0 0 auto</code>)。</p><p>建议优先使用这个属性，而不是单独写三个分离的属性，因为浏览器会推算相关值。</p><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ol><li><a href="https://learncssgrid.com/">Learn CSS Grid - A Guide to Learning CSS Grid | Jonathan Suh</a></li><li><a href="http://ruanyifeng.com/blog/2019/03/grid-layout-tutorial.html">CSS Grid 网格布局教程 - 阮一峰的网络日志 (ruanyifeng.com)</a></li><li><a href="http://ruanyifeng.com/blog/2015/07/flex-grammar.html">Flex 布局教程：语法篇 - 阮一峰的网络日志 (ruanyifeng.com)</a></li></ol><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      
        <tags>
            
            <tag> css </tag>
            
            <tag> flex </tag>
            
            <tag> grid </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>pr剪辑学习</title>
      <link href="2022/12/26/pr%E5%89%AA%E8%BE%91%E5%AD%A6%E4%B9%A0/"/>
      <url>2022/12/26/pr%E5%89%AA%E8%BE%91%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>短视频和一般的视频剪辑挺火的,如果是简单的短视频用剪映或者必剪就行了.但是为了体现专业(zhuang bi)性,我这里学学pr.可能要花几周时间.<br><span id="more"></span></p><h2 id="界面布局"><a href="#界面布局" class="headerlink" title="界面布局"></a>界面布局</h2><h3 id="概念介绍"><a href="#概念介绍" class="headerlink" title="概念介绍"></a>概念介绍</h3><p>工作区:下面每一个都是一个工作区,每个工作区有很多面板组,每个面板组中又有很多面板.</p><p>可以自己修改工作区的内容又可以自己创建自己的工作区.</p><p><img data-src="http://cdn.sekyoro.top/imgs/26/12image-20221226111354984.png" alt="image-20221226111354984" style="zoom:80%;" /></p><h2 id="新建序列"><a href="#新建序列" class="headerlink" title="新建序列"></a>新建序列</h2><p>项目面板右下角新建项 序列</p><p>进行序列设置</p><p><img data-src="http://cdn.sekyoro.top/imgs/10/0120230110175918.png" alt="image-20230110175721067" style="zoom:50%;" /></p><p>选择序列设置 模式自定义</p><p><img data-src="http://cdn.sekyoro.top/imgs/10/0120230110180110.png" alt="image-20230110180110474" style="zoom:50%;" /></p><h3 id="调整时间轴"><a href="#调整时间轴" class="headerlink" title="调整时间轴"></a>调整时间轴</h3><p>alt+鼠标滚轮  鼠标滚轮  \键  </p><p>时间轴轨道 轨道上的图像折叠</p><p><img data-src="http://cdn.sekyoro.top/imgs/10/0120230110181120.png" alt="image-20230110181119820"></p><p><img data-src="http://cdn.sekyoro.top/imgs/11/01image-20230111110359012.png" alt="image-20230111110359012"></p><ol><li>嵌套图标对齐工具  </li><li>视频与音频的链接   </li><li>添加标记(m)  在时间轨道上   在视频或音频上</li></ol><p><img data-src="http://cdn.sekyoro.top/imgs/11/01image-20230111110857150.png" alt="image-20230111110857150"></p><p>左侧 视频或音频拖进来时有视频还是yinpin</p><p>右侧 决定视频优先级</p><p>选择工具 V   提到工具 C</p><h3 id="效果空间"><a href="#效果空间" class="headerlink" title="效果空间"></a>效果空间</h3><p>运动  不透明度 时间映射 </p><p>批量添加过渡效果 设置过渡效果为常用过渡效果  ctrl+d</p><p>复制素材 alt拖动</p><p><img data-src="http://cdn.sekyoro.top/imgs/11/01image-20230111113253991.png" alt="image-20230111113253991"></p><h3 id="电子相册制作"><a href="#电子相册制作" class="headerlink" title="电子相册制作"></a>电子相册制作</h3><p>复制素材拖到上一个轨道,缩放70%</p><h4 id="添加径向阴影"><a href="#添加径向阴影" class="headerlink" title="添加径向阴影"></a>添加径向阴影</h4><p><img data-src="http://cdn.sekyoro.top/imgs/11/0120230111114026.png" alt="image-20230111114026246"></p><h4 id="添加投影"><a href="#添加投影" class="headerlink" title="添加投影"></a>添加投影</h4><p><img data-src="http://cdn.sekyoro.top/imgs/11/0120230111114046.png" alt="image-20230111114046133"></p><h4 id="添加模糊"><a href="#添加模糊" class="headerlink" title="添加模糊"></a>添加模糊</h4><p>在下一个轨道图片上加模糊</p><p><img data-src="http://cdn.sekyoro.top/imgs/11/0120230111113934.png" alt="image-20230111113933985"></p><h4 id="批量复制"><a href="#批量复制" class="headerlink" title="批量复制"></a>批量复制</h4><p>复制某个素材,选中其他素材粘贴属性</p><p>或者使用快捷键ctrl+alt+v 粘贴属性快捷键</p><p>将上轨道改为立方体旋转</p><h4 id="光影"><a href="#光影" class="headerlink" title="光影"></a>光影</h4><p>加上光影素材,混合模式改为滤色</p><h4 id="导出"><a href="#导出" class="headerlink" title="导出"></a>导出</h4><p>H.264即可</p><h3 id="电影混剪"><a href="#电影混剪" class="headerlink" title="电影混剪"></a>电影混剪</h3><h4 id="加上字幕遮罩"><a href="#加上字幕遮罩" class="headerlink" title="加上字幕遮罩"></a>加上字幕遮罩</h4><p>新建项 字幕遮罩  效果加上裁剪</p><p>上下都加上</p><h4 id="配上字幕"><a href="#配上字幕" class="headerlink" title="配上字幕"></a>配上字幕</h4><p>可以利用Arctime pro</p><h4 id="去除字幕"><a href="#去除字幕" class="headerlink" title="去除字幕"></a>去除字幕</h4><p>高斯模糊 蒙版</p><p>中间值 蒙版</p><h4 id="定格动画"><a href="#定格动画" class="headerlink" title="定格动画"></a>定格动画</h4><p>五帧或十帧</p><h2 id="剪辑工具"><a href="#剪辑工具" class="headerlink" title="剪辑工具"></a>剪辑工具</h2><p>镜头剪辑、排列以及各种调节方法</p><p><img data-src="http://cdn.sekyoro.top/imgs/26/12image-20221226210816710.png" alt="image-20221226210816710"></p><h3 id="抠图"><a href="#抠图" class="headerlink" title="抠图"></a>抠图</h3><p>超级键,但是有时候超级键扣不干净.可以利用颜色键和裁剪</p><p>最后加上超级键,加上基值,抑制和柔化.</p><p><img data-src="http://cdn.sekyoro.top/imgs/16/0120230116185035.png" alt="image-20230116185017552"  /></p><h4 id="人物调色"><a href="#人物调色" class="headerlink" title="人物调色"></a>人物调色</h4><p>让人物脸上光更均匀</p><p>新建调整图层,在Lumetric颜色</p><h4 id="转场过度"><a href="#转场过度" class="headerlink" title="转场过度"></a>转场过度</h4><p>filmImpact zoom blur</p><h3 id="直接花字法"><a href="#直接花字法" class="headerlink" title="直接花字法"></a>直接花字法</h3><h3 id="图片花字法"><a href="#图片花字法" class="headerlink" title="图片花字法"></a>图片花字法</h3><h3 id="表情贴图方法"><a href="#表情贴图方法" class="headerlink" title="表情贴图方法"></a>表情贴图方法</h3><p>追踪法</p><h3 id="特效素材法"><a href="#特效素材法" class="headerlink" title="特效素材法"></a>特效素材法</h3><p>添加帧定格</p><h3 id="快捷键"><a href="#快捷键" class="headerlink" title="快捷键"></a>快捷键</h3><ol><li>q w剪辑  ctrl+k剪辑 shift+delete波纹剪辑</li><li>i o出入标记</li></ol><h4 id="转场合集"><a href="#转场合集" class="headerlink" title="转场合集"></a>转场合集</h4><h5 id="回忆快闪"><a href="#回忆快闪" class="headerlink" title="回忆快闪"></a>回忆快闪</h5><ol><li>变换 关键帧缩放 从大到小  缓入缓出</li><li>快门角度调大 </li><li>不透明度关键帧 </li></ol><h5 id="闪烁抽帧"><a href="#闪烁抽帧" class="headerlink" title="闪烁抽帧"></a>闪烁抽帧</h5><ol><li>将多段相同素材嵌套</li><li>慢动作效果</li><li><img data-src="http://cdn.sekyoro.top/imgs/31/0120230131000810.png" alt="image-20230130232754138"></li><li>alt运动视频设置,在起始和结尾处设置输出控制速度例如50%,中间可以设置10%</li><li>闪烁效果</li></ol><p>卡点弹边</p><ol><li>alt向上复制一份</li><li>查找边缘效果 色彩效果 混合模式颜色减淡</li><li>变换效果 缩放变大  关键帧</li></ol><h3 id="PR效果合集"><a href="#PR效果合集" class="headerlink" title="PR效果合集"></a>PR效果合集</h3><h4 id="眨眼效果"><a href="#眨眼效果" class="headerlink" title="眨眼效果"></a>眨眼效果</h4><ol><li><p>添加黑场视频 网格,球面化效果</p></li><li><p>调整边框加关键帧</p><p><img data-src="http://cdn.sekyoro.top/imgs/31/0120230131211816.png" alt="image-20230131211812320" style="zoom:67%;" /></p></li><li><p>快速模糊效果 关键帧</p></li><li><p>不透明度 关键帧</p></li></ol><h4 id="弹性缩放"><a href="#弹性缩放" class="headerlink" title="弹性缩放"></a>弹性缩放</h4><ol><li>新建图层 变换效果加新建图层</li><li>变换 缩放50</li><li>镜像 反射中心</li></ol><h4 id="拍照效果"><a href="#拍照效果" class="headerlink" title="拍照效果"></a>拍照效果</h4><ol><li>帧定格</li><li>alt增加一层 变换效果 油漆桶 描边 颜色 不透明度</li><li>高斯模糊v1</li></ol><h3 id="剪辑技巧"><a href="#剪辑技巧" class="headerlink" title="剪辑技巧"></a>剪辑技巧</h3><ol><li>隐藏标题栏 ctrl+\</li><li>ctrl+alt交换素材</li><li>快速添加素材 <code>,</code>键  快速复制alt</li><li>ctrl+alt+v 快速复制属性</li><li>回避人声  基本声音-对话 选择音乐素材 音乐-回避 调整闪避量和淡化 生成关键帧   </li></ol><h4 id="Tips"><a href="#Tips" class="headerlink" title="Tips"></a>Tips</h4><ol><li>径向阴影或油漆桶制作描边效果</li><li>任务定格出场秒百年:轨道遮罩键 笔刷 转场 油漆桶,遮罩为转场水墨素材,合成方式为亮度遮罩,位置移动 缓入缓出 添加水墨 文字 白场</li></ol><p><img data-src="http://cdn.sekyoro.top/imgs/01/0220230201125226.png" alt="image-20230201125223057"></p><h2 id="AE学习"><a href="#AE学习" class="headerlink" title="AE学习"></a>AE学习</h2><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      
        <tags>
            
            <tag> premiere pro </tag>
            
            <tag> 剪辑 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>uniapp申请获取地理位置</title>
      <link href="2022/12/11/uniapp%E7%94%B3%E8%AF%B7%E8%8E%B7%E5%8F%96%E5%9C%B0%E7%90%86%E4%BD%8D%E7%BD%AE/"/>
      <url>2022/12/11/uniapp%E7%94%B3%E8%AF%B7%E8%8E%B7%E5%8F%96%E5%9C%B0%E7%90%86%E4%BD%8D%E7%BD%AE/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>老板要求做一个微信小程序,后面又希望能转为app. 所以选择了uniapp开发. 我的体验和感想就是以后不用uniapp了. 资源不多,学习了可能用处也不大.适合外包的干.这里写一下使用uniapp开发微信小程序获取地理位置<br><span id="more"></span></p><p>基本逻辑是使用uniapp的api首先获得地理经纬度位置等信息(在这之前可以先让用户授权,然后根据获得的地理位置信息利用腾讯的服务得到具体的位置名字.</p><p>这里我主要利用uniapp开发微信小程序.</p><h2 id="基本流程"><a href="#基本流程" class="headerlink" title="基本流程"></a>基本流程</h2><p><img data-src="http://cdn.sekyoro.top/imgs/image-20221220185902594.png" alt="流程" style="zoom:50%;" /></p><p>getsetting主要用于获取用户当前设置</p><p><img data-src="http://cdn.sekyoro.top/imgs/20/1220221220210453.png" alt="setting获取" style="zoom:67%;" /></p><p>这里重要的就是scope.xx查看用户的授权</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">uni.getSetting(&#123;<span class="attr">success</span>: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (res.authSetting &amp;&amp; res.authSetting.hasOwnProperty(<span class="string">&quot;scope.userFuzzyLocation&quot;</span>)) &#123;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;获取到auth&#x27;</span>,res)</span><br><span class="line"><span class="keyword">if</span> (res.authSetting[<span class="string">&quot;scope.userFuzzyLocation&quot;</span>]) &#123;</span><br><span class="line"><span class="built_in">this</span>.getCityInfo();</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">uni.showModal(&#123;</span><br><span class="line"><span class="attr">title</span>: <span class="string">&quot;提示&quot;</span>,</span><br><span class="line"><span class="attr">content</span>: <span class="string">&quot;请重新授权获取你的地理位置，否则部分功能将无法使用.\r\n提示:点击小程序右上角的三个点在设置中修改授权&quot;</span>,</span><br><span class="line"><span class="attr">success</span>: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (res.confirm) &#123;</span><br><span class="line">uni.openSetting(&#123;</span><br><span class="line"><span class="attr">success</span>: <span class="function">() =&gt;</span> <span class="built_in">this</span>.getCityInfo()</span><br><span class="line">&#125;);</span><br><span class="line">&#125; <span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">this</span>.getCovidData();</span><br><span class="line">&#125;</span><br><span class="line">&#125;,</span><br><span class="line">&#125;);</span><br><span class="line">&#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;正确&#x27;</span>)</span><br><span class="line"><span class="built_in">console</span>.log(res)</span><br><span class="line"><span class="built_in">this</span>.getCityInfo();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>这里的scope.userFuzzyLocation就是需要用户授权的,res.authsetting如果包含这个且为true就进行下一步操作.如果没有这个选项,即res.authSetting.hasOwnProperty(“scope.userFuzzyLocation”)返回false,这样就需要去授权.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">getCityInfo</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;调用getCityInfo&#x27;</span>)</span><br><span class="line">uni.authorize(&#123;</span><br><span class="line"><span class="attr">scope</span>: <span class="string">&quot;scope.userFuzzyLocation&quot;</span>,</span><br><span class="line"><span class="attr">success</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;授权&#x27;</span>)</span><br><span class="line"><span class="comment">//做授权之后的操作</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">fail</span>: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">fail</span>: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="built_in">console</span>.log(res);</span><br><span class="line"><span class="built_in">this</span>.loadError();</span><br><span class="line">&#125;</span><br><span class="line">&#125;)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>uni.authorize 提前向用户发起授权请求。调用后会立刻弹窗询问用户是否同意授权小程序使用某项功能或获取用户的某些数据，但不会实际调用对应接口.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">uni.authorize(&#123;</span><br><span class="line">    <span class="attr">scope</span>: <span class="string">&#x27;scope.userLocation&#x27;</span>,</span><br><span class="line">    <span class="function"><span class="title">success</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        uni.getLocation()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>如果用户之前已经同意授权，则不会出现弹窗，直接返回成功。如果用户之前拒绝了授权，此接口会直接进入失败回调.</p><p>当调用这个接口之后就能有对应的scope.xx的值了,要么为true要么为false. authorize会跳出一个弹窗,请求获取权限,如果接受了那就没多大事了.</p><p>如果没有接受,就可以调取</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">uni.openSetting(&#123;</span><br><span class="line"><span class="attr">success</span>: <span class="function">() =&gt;</span> <span class="built_in">this</span>.getCityInfo()</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>调起客户端小程序设置界面，返回用户设置的操作结果.</p><p><img data-src="http://cdn.sekyoro.top/imgs/20/1220221220220021.png" alt="设置界面" style="zoom:50%;" /></p><p>uni.openSetting会打开一个这样的界面让用户设置.用户在这里允许授权即可.</p><h2 id="具体设置"><a href="#具体设置" class="headerlink" title="具体设置"></a>具体设置</h2><p>在uniapp中,需要设置一些需要用户授权的权限.</p><p>  <img data-src="http://cdn.sekyoro.top/imgs/20/1220221220220601.png" alt="image-20221220220601255"></p><p>在uniapp中打开manifest.json中的源码视图,找到permission如上图.</p><p>添加需要的scope和requirePrivateInfos.</p><p>同时getsetting中需要看scope.xx是否存在以及是否为true.</p><p><img data-src="http://cdn.sekyoro.top/imgs/20/12image-20221220220755694.png" alt="image-20221220220755694"></p><p><img data-src="http://cdn.sekyoro.top/imgs/20/1220221220221058.png" alt="image-20221220221057784"></p><p>uni.authorize中也需要获取需要用户授权的scope</p><h2 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h2><p>在微信小程序中,使用一些平台提供的接口需要权限.</p><p><img data-src="http://cdn.sekyoro.top/imgs/20/1220221220221401.png" alt="image-20221220221400954" style="zoom:50%;" /></p><p>比如获取当前的地理位置、速度需要小程序的类目相符合,而获取当前的模糊地理位置也需要申请权限.不过这个接口相对来说比较好申请,但是这个接口有点bug,我一开始申请之后当天模拟器上有点问题,不过后面就好了.申请了之后可以利用腾讯提供的sdk将经纬度转为具体的位置名.</p><p>代码基本如下</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">uni.getFuzzyLocation(&#123;</span><br><span class="line"><span class="attr">type</span>: <span class="string">&quot;gcj02&quot;</span>, <span class="comment">//  wgs84: 返回GPS坐标，gcj02: 返回国测局坐标</span></span><br><span class="line"><span class="attr">success</span>: <span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;获取位置&#x27;</span>, res)</span><br><span class="line"><span class="keyword">const</span> &#123;</span><br><span class="line">latitude,</span><br><span class="line">longitude</span><br><span class="line">&#125; = res;</span><br><span class="line"><span class="keyword">const</span> location = &#123;</span><br><span class="line">latitude,</span><br><span class="line">longitude</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">this</span>.qqmapsdk.reverseGeocoder(&#123;</span><br><span class="line">location,</span><br><span class="line"><span class="attr">success</span>: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="keyword">let</span> loginAddress = res.result.ad_info.name</span><br><span class="line"><span class="built_in">console</span>.log(loginAddress)</span><br><span class="line"><span class="built_in">this</span>.flag = <span class="literal">true</span>;</span><br><span class="line"><span class="comment">// 获取信息</span></span><br><span class="line"><span class="built_in">this</span>.country = loginAddress.split(<span class="string">&#x27;,&#x27;</span>)[<span class="number">0</span>];</span><br><span class="line"><span class="built_in">this</span>.province = loginAddress.split(<span class="string">&#x27;,&#x27;</span>)[<span class="number">1</span>];</span><br><span class="line"><span class="built_in">this</span>.city = loginAddress.split(<span class="string">&#x27;,&#x27;</span>)[<span class="number">2</span>];</span><br><span class="line"><span class="built_in">this</span>.district = loginAddress.split(<span class="string">&#x27;,&#x27;</span>)[<span class="number">3</span>];</span><br><span class="line"><span class="built_in">this</span>.formvalue.location = <span class="built_in">this</span>.province + <span class="string">&#x27;&gt;&#x27;</span> +</span><br><span class="line"><span class="built_in">this</span>.city + <span class="string">&#x27;&gt;&#x27;</span> + <span class="built_in">this</span>.district;</span><br><span class="line"></span><br><span class="line"><span class="built_in">this</span>.donext();</span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">fail</span>: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(res)</span><br><span class="line">&#125;,</span><br><span class="line">&#125;);</span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">fail</span>: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="built_in">console</span>.log(res)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ol><li><a href="https://lbs.qq.com/miniProgram/jsSdk/jsSdkGuide/jsSdkOverview">微信小程序JavaScript SDK | 腾讯位置服务 (qq.com)</a></li><li><a href="https://blog.csdn.net/a18792627168/article/details/108962311#:~:text=uni-app,小程序项目无法直接获取到地理位置，只能通过获取到的经纬度，调用第三方地图Api获取。">uni-app微信小程序获取用户地理位置信息_DOM曼珠沙华的博客-CSDN博客_uni.getsetting</a></li></ol><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      
        <tags>
            
            <tag> uniapp </tag>
            
            <tag> 微信小程序 </tag>
            
            <tag> 获取地理位置 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>磁力链接与RSS订阅</title>
      <link href="2022/11/22/%E7%A3%81%E5%8A%9B%E9%93%BE%E6%8E%A5%E4%B8%8ERSS%E8%AE%A2%E9%98%85/"/>
      <url>2022/11/22/%E7%A3%81%E5%8A%9B%E9%93%BE%E6%8E%A5%E4%B8%8ERSS%E8%AE%A2%E9%98%85/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>最近接触到了BT下载和RSS订阅,稍微学习学习,了解下概念.内容主要来自维基百科<br><span id="more"></span></p><h2 id="BT介绍"><a href="#BT介绍" class="headerlink" title="BT介绍"></a>BT介绍</h2><p>BT全称BitTorrent,是用在<a href="https://zh.wikipedia.org/wiki/对等网络">对等网络</a>中<a href="https://zh.wikipedia.org/wiki/文件分享">文件分享</a>的<a href="https://zh.wikipedia.org/wiki/网络协议">网络协议</a><a href="https://zh.wikipedia.org/wiki/计算机程序">程序</a>。和<a href="https://zh.wikipedia.org/wiki/点对点协议">点对点</a>（point-to-point）的协议<a href="https://zh.wikipedia.org/wiki/计算机程序">程序</a>不同，它是用户群对用户群（peer-to-peer），而且用户越多，下载同一文件的人越多，下载该文件的速度越快。且下载后，继续维持上传的状态，就可以“分享”，成为其用户端节点下载的<a href="https://zh.wikipedia.org/wiki/种子文件">种子文件</a>（.torrent），同时上传及下载.</p><p>普通的<a href="https://zh.wikipedia.org/wiki/HTTP">HTTP</a>／<a href="https://zh.wikipedia.org/wiki/FTP">FTP</a>下载使用<a href="https://zh.wikipedia.org/wiki/TCP/IP协议">TCP/IP协议</a>，BitTorrent协议是架构于TCP/IP协议之上的一个<a href="https://zh.wikipedia.org/wiki/对等网络">P2P</a>文件传输<a href="https://zh.wikipedia.org/wiki/通訊協定">通信协议</a>，处于TCP/IP结构的<a href="https://zh.wikipedia.org/wiki/应用层">应用层</a>。BitTorrent协议本身也包含了很多具体的内容协议和扩展协议，并在不断扩展中</p><p>在BT下载的流程中,文件发布者会根据要发布的文件生成提供一个.torrent文件,这就是种子文件.发布这个文件就是做种(发布者提供下载任务的全部内容的行为；下载者下载完成后继续提供给他人下载的行为).</p><p>这个种子文件本质上是<a href="https://zh.wikipedia.org/wiki/文本文件">文本文件</a>，包含Tracker信息和文件信息两部分。<strong>Tracker信息主要是BT下载中需要用到的Tracker服务器的地址和针对Tracker服务器的设置</strong>，<strong>文件信息是根据对目标文件的计算生成的，计算结果根据BitTorrent协议内的<a href="https://zh.wikipedia.org/wiki/Bencode">Bencode</a>规则进行编码</strong>。它的主要原理是需要把提供下载的文件虚拟分成大小相等的块，块大小必须为2k的整数次方（由于是虚拟分块，硬盘上并不产生各个块文件），并把每个块的索引信息和<a href="https://zh.wikipedia.org/wiki/Hash">Hash</a>验证码写入种子文件中；所以，种子文件就是被下载文件的“索引”。</p><p>下载者要下载文件内容，需要先得到相应的种子文件，然后使用BT客户端软件进行下载。</p><p>因为种子文件中有tracker地址,这个tracker就是个服务器地址(下载者的信息也会记录.收集下载者信息的服务器，并将此信息提供给其他下载者，使下载者们相互连接起来，传输数据。).下图是在Motrix中的种子的tracker信息<img data-src="http://cdn.sekyoro.top/imgs/image-20221122140032781.png" alt="image-20221122140032781" style="zoom:50%;" /></p><p>下载时，BT客户端首先解析种子文件得到Tracker地址，然后连接Tracker服务器。Tracker服务器回应下载者的请求，提供下载者其他下载者（包括发布者）的IP。下载者再连接其他下载者，根据种子文件，两者分别告知对方自己已经有的块，然后交换对方所没有的数据。此时不需要其他服务器参与，分散了单个线路上的数据流量，因此减轻了服务器负担。</p><p>下载者每得到一个块，需要算出下载块的Hash验证码与种子文件中的对比，如果一样则说明块正确，不一样则需要重新下载这个块。这种规定是为了解决下载内容准确性的问题。</p><h2 id="磁力链接"><a href="#磁力链接" class="headerlink" title="磁力链接"></a>磁力链接</h2><p><strong>磁力链接</strong>（Magnet URI scheme），是<a href="https://zh.wikipedia.org/wiki/对等网络">对等网络</a>中进行信息检索和下载文档的<a href="https://zh.wikipedia.org/wiki/电脑程序">电脑程序</a>。和基于“位置”连接的<a href="https://zh.wikipedia.org/wiki/统一资源定位符">统一资源定位符</a>不同，磁力链接是基于<a href="https://zh.wikipedia.org/wiki/元数据">元数据</a>（metadata）文件内容，属于<a href="https://zh.wikipedia.org/wiki/统一资源名称">统一资源名称</a>。也就是说，磁力链接不基于文档的<a href="https://zh.wikipedia.org/wiki/IP地址">IP地址</a>或定位符，而是在<a href="https://zh.wikipedia.org/wiki/分布式数据库">分布式数据库</a>中，通过<a href="https://zh.wikipedia.org/wiki/散列函数">散列函数</a>值来识别、<a href="https://zh.wikipedia.org/wiki/搜索">搜索</a>来下载文档。因为不依赖一个处于启动状态的主机来下载文档，所以特别适用没有中心服务器的<a href="https://zh.wikipedia.org/wiki/对等网络">对等网络</a>。它符合<a href="https://zh.wikipedia.org/wiki/开源标准">开源标准</a>。</p><p>磁力链接由一组参数组成，参数间的顺序没有讲究，其格式与在HTTP链接末尾的查询字符串相同。最常见的参数是”xt”，是”exact topic”的缩写，通常是一个特定文件的内容散列函数值形成的<a href="https://zh.wikipedia.org/wiki/统一资源名称">URN</a></p><p><img data-src="http://cdn.sekyoro.top/imgs/image-20221122140625013.png" alt="image-20221122140625013"></p><h2 id="RSS订阅"><a href="#RSS订阅" class="headerlink" title="RSS订阅"></a>RSS订阅</h2><p><strong>RSS</strong>（英文全称：<a href="https://zh.wikipedia.org/wiki/Resource_Description_Framework">RDF</a> Site Summary 或 Really Simple Syndication<a href="https://zh.wikipedia.org/wiki/RSS#cite_note-powers-2003-1-2">[2]</a>），中文译作<strong>简易信息聚合</strong><a href="https://zh.wikipedia.org/wiki/RSS#cite_note-3">[3]</a>，也称<strong>聚合内容</strong><a href="https://zh.wikipedia.org/wiki/RSS#cite_note-张锐2015-4">[4]</a>，是一种<a href="https://zh.wikipedia.org/wiki/消息來源">消息来源</a>格式规范，用以聚合多个网站更新的内容并自动通知网站订阅者。使用 RSS 后，网站订阅者便无需再手动查看网站是否有新的内容，同时 RSS 可将多个网站更新的内容进行整合，以摘要的形式呈现，有助于订阅者快速获取重要信息，并选择性地点阅查看。</p><p>RSS 摘要可以借由 RSS 阅读器、feed reader 或 aggregator 等网页或以桌面为架构的软件来阅读。标准的 <a href="https://zh.wikipedia.org/wiki/XML">XML</a> 档式可允许信息在一次发布后通过不同的程序阅览。用户借由将网摘输入 RSS 阅读器，或是用鼠标点取浏览器上指向订阅程序的 RSS 小图标 <a href="https://zh.wikipedia.org/wiki/URI">URI</a>（非通常所称的 <a href="https://zh.wikipedia.org/wiki/URL">URL</a>）来订阅网摘。RSS 阅读器会定期检阅网站是否有更新，然后下载至监看用户界面。</p><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a href="https://zh.wikipedia.org/wiki/RSS">RSS - 维基百科，自由的百科全书 (wikipedia.org)</a></p><p><a href="https://zh.wikipedia.org/wiki/BitTorrent_(协议">BitTorrent (协议) - 维基百科，自由的百科全书 (wikipedia.org)</a>)</p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      
        <tags>
            
            <tag> RSS </tag>
            
            <tag> torrent </tag>
            
            <tag> BT </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用overleaf优雅地写文章</title>
      <link href="2022/11/11/%E4%BD%BF%E7%94%A8overleaf%E4%BC%98%E9%9B%85%E5%9C%B0%E5%86%99%E6%96%87%E7%AB%A0/"/>
      <url>2022/11/11/%E4%BD%BF%E7%94%A8overleaf%E4%BC%98%E9%9B%85%E5%9C%B0%E5%86%99%E6%96%87%E7%AB%A0/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>之前一般都用markdown写完转word或者pdf.为了更方便地插入公式和使用模板,使用tex格式来写文章,特别是科研可能是个更好的选择.<br><span id="more"></span></p><blockquote><p><strong>TeX/LaTeX</strong> 既可以表示所指的宏语言/格式，也可以表示实现该宏语言的整套软件，也可以表示软件中的一两个可执行程序命令</p></blockquote><p>本地如果要使用可能需要装多个软件,比如texLive,texStudio等.主要是无法很好的跨平台,当换平台时一般需要通过网盘传送.如果使用overleaf从各个角度来看都方便多了,还方便与人分享交流review.与markdown差别是通过导入包使得功能更丰富,更加偏向科研.</p><h2 id="Latex基本语法"><a href="#Latex基本语法" class="headerlink" title="Latex基本语法"></a>Latex基本语法</h2><p>这东西包含内容很多,通览一下即可.个人感觉是需要先了解一篇文章的结构.</p><h3 id="序言-Preamble-和正文-Document"><a href="#序言-Preamble-和正文-Document" class="headerlink" title="序言(Preamble)和正文(Document)"></a>序言(Preamble)和正文(Document)</h3><p>首先基本文档结构氛围序言和正文.</p><h4 id="序言"><a href="#序言" class="headerlink" title="序言"></a>序言</h4><p>主要用来申明你写的文档类型、文档语言、文档使用的包(类似于Python中的<code>import</code>)等。一个常见的序言如下：</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">\documentclass</span>[12pt, letterpaper]&#123;article&#125;</span><br><span class="line"><span class="keyword">\usepackage</span>[utf8]&#123;inputenc&#125;</span><br></pre></td></tr></table></figure><p>简单来说就是声明要写的是article,report还是book并设置属性.同时导包并设置属性.</p><p><img data-src="http://cdn.sekyoro.top/imgs/image-20221111162352108.png" alt="image-20221111162352108" style="zoom:67%;" /></p><p>babel设置语言,inputenc设置编码,geometry设置布局.</p><p>amsmath数学公式包,graphicx导入图片,hyperref设置超链接.</p><h4 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h4><p>对于正文内容使用<code>\begin&#123;ducument&#125;</code>和<code>\end&#123;document&#125;</code>标签进行控制，在标签内就可以进行写作了，写在标签外的内容是不会展示出来的。和Markdown一样，换行需要按两次<code>Enter</code>。<code>\begin&#123;abstract&#125;</code>和<code>\end&#123;abstract&#125;</code>可以在正文中添加摘要</p><p>添加属性,即设置文档的标题 作者 时间 致谢</p><ul><li><code>\title&#123;your title&#125;</code>:添加文档标题</li><li><code>\author&#123;your name&#125;</code>:添加作者</li><li><code>\thanks&#123;funded by ...&#125;</code>:添加致谢信息，必须在<code>author</code>的花括号里面才有用</li><li><code>\date&#123;your date&#125;</code>:添加日期，<code>\today</code>表示设置成编译文档那一天的日期</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">\documentclass&#123;article&#125;</span><br><span class="line">\title&#123;This is a title&#125;</span><br><span class="line">\author&#123;</span><br><span class="line">Zhao Xuhui\thanks&#123;thanks 1&#125;,</span><br><span class="line">Xuhui Zhao\thanks&#123;thanks 2&#125;&#125;</span><br><span class="line">\date&#123;\today&#125;</span><br><span class="line"></span><br><span class="line">\begin&#123;document&#125;</span><br><span class="line">\maketitle</span><br><span class="line">This is test text.</span><br><span class="line">\end&#123;document&#125;</span><br></pre></td></tr></table></figure><p>注释使用%</p><h2 id="引用"><a href="#引用" class="headerlink" title="引用"></a>引用</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">\label&#123;pic&#125;</span><br><span class="line">this is a pic\ref&#123;pic&#125;</span><br></pre></td></tr></table></figure><p>通常用在图片,表格的引用中.</p><h2 id="字体"><a href="#字体" class="headerlink" title="字体"></a>字体</h2><ul><li>加粗:<code>\textbf&#123;...&#125;</code></li><li>斜体:<code>\textit&#123;...&#125;</code></li><li>下划线:<code>\underline&#123;...&#125;</code></li><li>强调:<code>\emph&#123;...&#125;</code>，与上下文字体相反，上下文常规它就是斜体，上下文斜体它就是常规</li><li>居中:<code>\centerline&#123;...&#125;</code>，居中显示文本</li></ul><h2 id="图片"><a href="#图片" class="headerlink" title="图片"></a>图片</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">\documentclass&#123;article&#125;</span><br><span class="line">\usepackage&#123;graphicx&#125;</span><br><span class="line"></span><br><span class="line">\begin&#123;document&#125;</span><br><span class="line">This is a test of image insertion.</span><br><span class="line"></span><br><span class="line">\begin&#123;figure&#125;[h]   % 必须要有[h]否则插入的图片都在文字前面</span><br><span class="line">    \centering  % 图像居中</span><br><span class="line">    \includegraphics[width=4cm]&#123;test/cover31.jpg&#125;   %[]里可以指定影像大小</span><br><span class="line">    \caption&#123;Electronic&#125;    % 图名</span><br><span class="line">    \label&#123;fig_electronic&#125;  % 用于内部引用的图名</span><br><span class="line">\end&#123;figure&#125;</span><br><span class="line"></span><br><span class="line">It is a great figure.</span><br><span class="line">\end&#123;document&#125;</span><br></pre></td></tr></table></figure><p>插入图片的基本流程 \begin{figure} 居中 设置路径与大小 设置名字 在名字种设置label方便引用</p><h2 id="列表"><a href="#列表" class="headerlink" title="列表"></a>列表</h2><p>无序列表使用<code>itemize</code>，有序列表使用<code>enumerate</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">\documentclass&#123;article&#125;</span><br><span class="line"></span><br><span class="line">\begin&#123;document&#125;</span><br><span class="line">This is a test of list.</span><br><span class="line"></span><br><span class="line">\begin&#123;itemize&#125;</span><br><span class="line">  \item The individual entries are indicated with a black dot, a so-called bullet.</span><br><span class="line">  \item The text in the entries may be of any length.</span><br><span class="line">\end&#123;itemize&#125;</span><br><span class="line"></span><br><span class="line">\begin&#123;enumerate&#125;</span><br><span class="line">  \item This is the first entry in our list</span><br><span class="line">  \item The list numbers increase with each entry we add</span><br><span class="line">\end&#123;enumerate&#125;</span><br><span class="line"></span><br><span class="line">\end&#123;document&#125;</span><br></pre></td></tr></table></figure><h2 id="表格"><a href="#表格" class="headerlink" title="表格"></a>表格</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">\begin&#123;table&#125;</span><br><span class="line">\centering</span><br><span class="line">\begin&#123;tabular&#125;&#123;l|r&#125;</span><br><span class="line">Item &amp; Quantity \\\hline</span><br><span class="line">Widgets &amp; 42 \\</span><br><span class="line">Gadgets &amp; 13</span><br><span class="line">\end&#123;tabular&#125;</span><br><span class="line">\caption&#123;\label&#123;tab:widgets&#125;An example table.&#125;</span><br><span class="line">\end&#123;table&#125;</span><br></pre></td></tr></table></figure><p><code>\begin&#123;tabular&#125;&#123;l|c|r&#125;</code>这里面的<code>&#123;l|c|r&#125;</code>，包含了三个字母，代表了表格总共有三列，第一列靠左偏移，第二列居中，第三列靠右偏移。竖线代表列之间用线分隔开来，如果想要左右两边都用线包围起来，应该改成<code>&#123;|l|c|r|&#125;</code>。接下来就是正式的表格绘制部分。</p><h2 id="章节"><a href="#章节" class="headerlink" title="章节"></a>章节</h2><p>用<code>\section&#123;&#125;</code>来表示章节，从当前<code>section</code>开始直到下一个<code>section</code>出现，这期间的内容都属于当前<code>section</code>，花括号内是章节标题。章节号是LaTeX自动生成的</p><p><img data-src="https://zhaoxuhui.top/assets/images/blog/content/2019-09-04-06.png" alt="img" style="zoom:67%;" /></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">\section&#123;Introduction&#125;</span><br><span class="line"></span><br><span class="line">Your introduction goes here! Simply start writing your document and use the Recompile button to view the updated PDF preview. Examples of commonly used commands and features are listed below, to help you get started.</span><br></pre></td></tr></table></figure><h2 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h2><p>添加目录的命令是<code>\tableofcontents</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">\documentclass&#123;article&#125;</span><br><span class="line"></span><br><span class="line">\title&#123;Test title&#125;</span><br><span class="line">\author&#123;Zhao Xuhui&#125;</span><br><span class="line">\date&#123;\today&#125;</span><br><span class="line"></span><br><span class="line">\begin&#123;document&#125;</span><br><span class="line"></span><br><span class="line">\maketitle</span><br><span class="line"> </span><br><span class="line">\tableofcontents</span><br><span class="line"> </span><br><span class="line">\section&#123;Introduction&#125;</span><br><span class="line"> </span><br><span class="line">This is the first section.</span><br><span class="line"> </span><br><span class="line">Lorem  ipsum  dolor  sit  amet,  consectetuer  adipiscing  </span><br><span class="line">elit.   Etiam  lobortisfacilisis sem.  Nullam nec mi et </span><br><span class="line">neque pharetra sollicitudin.  Praesent imperdietmi nec ante. </span><br><span class="line">Donec ullamcorper, felis non sodales...</span><br><span class="line"> </span><br><span class="line">\addcontentsline&#123;toc&#125;&#123;section&#125;&#123;Unnumbered Section&#125;</span><br><span class="line">\section*&#123;Unnumbered Section&#125;</span><br><span class="line"> </span><br><span class="line">Lorem ipsum dolor sit amet, consectetuer adipiscing elit.  </span><br><span class="line">Etiam lobortis facilisissem.  Nullam nec mi et neque pharetra </span><br><span class="line">sollicitudin.  Praesent imperdiet mi necante...</span><br><span class="line"> </span><br><span class="line">\section&#123;Second Section&#125;</span><br><span class="line"> </span><br><span class="line">Lorem ipsum dolor sit amet, consectetuer adipiscing elit.  </span><br><span class="line">Etiam lobortis facilisissem.  Nullam nec mi et neque pharetra </span><br><span class="line">sollicitudin.  Praesent imperdiet mi necante...</span><br><span class="line"></span><br><span class="line">\end&#123;document&#125;</span><br></pre></td></tr></table></figure><h2 id="数学公式"><a href="#数学公式" class="headerlink" title="数学公式"></a>数学公式</h2><p>LaTeX公式分为行内(inline)与展示(display)两种类型。前者是文本中的一部分，后者是单独占一行。</p><p>行内公式有三种方式：反斜线小括号、<script type="math/tex">`和`</script>、<code>\begin&#123;math&#125;</code>和<code>\end&#123;math&#125;</code>。</p><p>展示型公式有四种方式：反斜线中括号、<code>\begin&#123;equation&#125;</code>和<code>\end&#123;equation&#125;</code>、<code>\begin&#123;displaymath&#125;</code>和<code>\end&#123;displaymath&#125;</code>、双美元标志</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">\LaTeX&#123;&#125; is great at typesetting mathematics. Let $X_1, X_2, \ldots, X_n$ be a sequence of independent and identically distributed random variables with $\text&#123;E&#125;[X_i] = \mu$ and $\text&#123;Var&#125;[X_i] = \sigma^2 &lt; \infty$, and let</span><br><span class="line">\[S_n = \frac&#123;X_1 + X_2 + \cdots + X_n&#125;&#123;n&#125;</span><br><span class="line">      = \frac&#123;1&#125;&#123;n&#125;\sum_&#123;i&#125;^&#123;n&#125; X_i\]</span><br><span class="line">denote their mean. Then as $n$ approaches infinity, the random variables $\sqrt&#123;n&#125;(S_n - \mu)$ converge in distribution to a normal $\mathcal&#123;N&#125;(0, \sigma^2)$.</span><br></pre></td></tr></table></figure><h2 id="引用-1"><a href="#引用-1" class="headerlink" title="引用"></a>引用</h2><p>上传bib文件,比如叫sample.bib,进行引用\cite{},然后在最后添加引用</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">\bibliographystyle&#123;plain&#125;</span><br><span class="line">\bibliography&#123;sample&#125;</span><br></pre></td></tr></table></figure><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a href="https://www.overleaf.com/learn/latex/Learn_LaTeX_in_30_minutes">Learn LaTeX in 30 minutes - Overleaf, Online LaTeX Editor</a> overleaf上的Latex入门</p><p><a href="http://zhaoxuhui.top/blog/2019/09/04/latex-overleaf-note.html">LaTeX基本语法</a></p><p><a href="https://www.jianshu.com/p/5fe5e4d33a41">Latex基本语法(入门)</a></p><p><a href="https://blog.csdn.net/ayaishere_/article/details/123332393">【排版】用Overleaf速成LaTeX代码（从入门到开门）<em>ayaishere</em>的博客-CSDN博客_overleaf 空格</a></p><p><a href="https://blog.csdn.net/m0_52037292/article/details/109768317"> 快速上手系列——用Overleaf写中文文档_DeShawnPhang的博客-CSDN博客_overleaf怎么写中文</a></p><p><a href="https://blog.csdn.net/Canhui_WANG/article/details/87364800">关于Latex的Figure图像编号关联所在章节编号之问题的解决方案<em>林微的博客-CSDN博客</em>\begin{figure}</a></p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      
        <tags>
            
            <tag> latex </tag>
            
            <tag> tex </tag>
            
            <tag> overleaf </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>leetcode刷题记录</title>
      <link href="2022/11/11/leetcode%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/"/>
      <url>2022/11/11/leetcode%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>唉,很久没做做题了.这里记录一下每天刷题练习.<br><span id="more"></span></p><p>主要刷一些简单中等题,难了我也不会.</p><p>剑指Offer 启动</p><p><img data-src="http://cdn.sekyoro.top/imgs/26/1220221226173618.png" alt="image-20221226173618143" style="zoom: 80%;" /></p><p>09.用两个栈实现队列</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> 用两个栈实现队列;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayDeque;</span><br><span class="line"><span class="keyword">import</span> java.util.Deque;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CQueue2</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  Deque&lt;Integer&gt; inStack;</span><br><span class="line">  Deque&lt;Integer&gt; outStack;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">CQueue2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    inStack = <span class="keyword">new</span> ArrayDeque&lt;&gt;();</span><br><span class="line">    outStack = <span class="keyword">new</span> ArrayDeque&lt;&gt;();</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">appendTail</span><span class="params">(<span class="keyword">int</span> value)</span> </span>&#123;</span><br><span class="line">    inStack.push(value);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">deleteHead</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(outStack.isEmpty())</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span>(inStack.isEmpty())</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">while</span>(!inStack.isEmpty())</span><br><span class="line">        &#123;</span><br><span class="line">          outStack.push(inStack.pop());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> outStack.pop();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> outStack.pop();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="设计一个有getMin功能的栈"><a href="#设计一个有getMin功能的栈" class="headerlink" title="设计一个有getMin功能的栈"></a>设计一个有getMin功能的栈</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">实现一个特殊的栈，在实现栈的基本功能的基础上，再实现返回栈中最小元素的操作。</span><br></pre></td></tr></table></figure><p>【要求】</p><p>1.pop、push、getMin 操作的时间复杂度都是 <em>O</em>(1)。 2.设计的栈类型可以使用现成的栈结构</p><h4 id="设计方案"><a href="#设计方案" class="headerlink" title="设计方案"></a>设计方案</h4><p>使用辅助栈,多一个存最小值的栈stackmin. 即有stackdata和stackmin</p><p><strong>第一种</strong></p><p>压入规则</p><p>压入数据时,stackdata直接压入;stackmin如果为空,直接压入,如果不为空,进行比较:将要压入的值和栈顶的值进行比较,如果栈顶值更小则不处理,否则压入.</p><p>弹出规则</p><p>stackdata弹出数据,将弹出的数据与stackmin顶数据比较,如果弹出数据等于stackmin栈顶数据,则同时弹出stackmin数据,否则不处理.</p><p>最小值即位stackmin中栈顶值</p><p><strong>第二种</strong></p><p>压入规则</p><p>压入数据时,stackdata直接压入;stackmin如果为空也直接压入,否则将栈顶数据与待压入数据比较,如果栈顶数据更小,则stackmin再压入一次栈顶数据,否则stackmin压入待压入数据.</p><p>弹出规则</p><p>两个栈都弹出</p><p>最小值也是stackmin的栈顶</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MinStack</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    stack&lt;<span class="keyword">int</span>&gt;s,min_s;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">MinStack</span>() &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">push</span><span class="params">(<span class="keyword">int</span> val)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(s.<span class="built_in">empty</span>())</span><br><span class="line">        &#123;</span><br><span class="line">            s.<span class="built_in">emplace</span>(val);</span><br><span class="line">            min_s.<span class="built_in">emplace</span>(val);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">int</span> topvalue = min_s.<span class="built_in">top</span>();</span><br><span class="line">            <span class="keyword">if</span>(topvalue&gt;val)</span><br><span class="line">            &#123;</span><br><span class="line">                min_s.<span class="built_in">emplace</span>(val);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                min_s.<span class="built_in">emplace</span>(topvalue);</span><br><span class="line">            &#125;</span><br><span class="line">            s.<span class="built_in">emplace</span>(val);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">pop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        s.<span class="built_in">pop</span>();</span><br><span class="line">        min_s.<span class="built_in">pop</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">top</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> s.<span class="built_in">top</span>();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">min</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> min_s.<span class="built_in">top</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="从尾到头打印链表"><a href="#从尾到头打印链表" class="headerlink" title="从尾到头打印链表"></a>从尾到头打印链表</h3><p>输入一个链表的头节点，从尾到头反过来返回每个节点的值（用数组返回）</p><h4 id="设计方案-1"><a href="#设计方案-1" class="headerlink" title="设计方案"></a>设计方案</h4><p>利用栈结构或者使用递归</p><p>这里使用递归</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">vector&lt;<span class="keyword">int</span>&gt; <span class="title">reversePrint</span><span class="params">(ListNode* head)</span> </span>&#123;</span><br><span class="line">      </span><br><span class="line">        <span class="keyword">if</span>(!head)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> &#123;&#125;;</span><br><span class="line">        &#125;</span><br><span class="line">        vector&lt;<span class="keyword">int</span>&gt; v =<span class="built_in">reversePrint</span>(head-&gt;next);</span><br><span class="line">        v.<span class="built_in">push_back</span>(head-&gt;val);</span><br><span class="line">        <span class="keyword">return</span> v;</span><br><span class="line">        &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>使用辅助栈结构</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">vector&lt;<span class="keyword">int</span>&gt; <span class="title">reversePrint</span><span class="params">(ListNode* head)</span> </span>&#123;</span><br><span class="line">        stack&lt;<span class="keyword">int</span>&gt; s;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(ptr it=head;it!=<span class="literal">nullptr</span>;it=it-&gt;next)</span><br><span class="line">        &#123;</span><br><span class="line">            s.<span class="built_in">push</span>(it-&gt;val);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        vector&lt;<span class="keyword">int</span>&gt; v;</span><br><span class="line">        <span class="keyword">while</span>(!s.<span class="built_in">empty</span>())</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">int</span> val = s.<span class="built_in">top</span>();</span><br><span class="line">            s.<span class="built_in">pop</span>();</span><br><span class="line">            v.<span class="built_in">push_back</span>(val);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> v;</span><br><span class="line"></span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id=""><a href="#" class="headerlink" title=" "></a> </h3><h3 id="反转链表"><a href="#反转链表" class="headerlink" title="反转链表"></a>反转链表</h3><p>定义一个函数，输入一个链表的头节点，反转该链表并输出反转后链表的头节点。</p><p><strong>示例:</strong></p><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">输入: <span class="number">1</span>-&gt;<span class="number">2</span>-&gt;<span class="number">3</span>-&gt;<span class="number">4</span>-&gt;<span class="number">5</span>-&gt;NULL</span><br><span class="line">输出: <span class="number">5</span>-&gt;<span class="number">4</span>-&gt;<span class="number">3</span>-&gt;<span class="number">2</span>-&gt;<span class="number">1</span>-&gt;NULL</span><br></pre></td></tr></table></figure><h4 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for singly-linked list.</span></span><br><span class="line"><span class="comment"> * struct ListNode &#123;</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     ListNode *next;</span></span><br><span class="line"><span class="comment">  ListNode(int x):val(x),next(NULL)&#123;&#125;</span></span><br><span class="line"><span class="comment"> *     ListNode(int x) : val(x), next(NULL) &#123;&#125;</span></span><br><span class="line"><span class="comment"> * &#125;;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">typedef</span> ListNode* LN;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">ListNode* <span class="title">reverseList</span><span class="params">(ListNode* head)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!head)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        LN nd = head-&gt;next;</span><br><span class="line">        LN pre = head;</span><br><span class="line">        pre-&gt;next = <span class="literal">nullptr</span>;</span><br><span class="line">        <span class="keyword">for</span>(LN it = nd;it!=<span class="literal">nullptr</span>;)</span><br><span class="line">        &#123;</span><br><span class="line">            nd = it-&gt;next;</span><br><span class="line">            it-&gt;next = pre;</span><br><span class="line">            pre = it;</span><br><span class="line">            it = nd;</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> pre;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>使用递归方法</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">ListNode* <span class="title">reverseList</span><span class="params">(ListNode* head)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!head || !head-&gt;next) &#123;</span><br><span class="line">            <span class="keyword">return</span> head;</span><br><span class="line">        &#125;</span><br><span class="line">        ListNode* newHead = <span class="built_in">reverseList</span>(head-&gt;next);</span><br><span class="line">        head-&gt;next-&gt;next = head;</span><br><span class="line">        head-&gt;next = <span class="literal">nullptr</span>;</span><br><span class="line">        <span class="keyword">return</span> newHead;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="复杂链表的复制"><a href="#复杂链表的复制" class="headerlink" title="复杂链表的复制"></a>复杂链表的复制</h3><p>请实现 <code>copyRandomList</code> 函数，复制一个复杂链表。在复杂链表中，每个节点除了有一个 <code>next</code> 指针指向下一个节点，还有一个 <code>random</code> 指针指向链表中的任意节点或者 <code>null</code>。</p><h4 id="解题思路"><a href="#解题思路" class="headerlink" title="解题思路"></a>解题思路</h4><ol><li>回溯和哈希表(或者单独使用哈希表)</li></ol><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    unordered_map&lt;Node *, Node *&gt; cachedNode;</span><br><span class="line">    <span class="function">Node *<span class="title">copyRandomList</span><span class="params">(Node *head)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!head)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!cachedNode.<span class="built_in">count</span>(head))</span><br><span class="line">        &#123;</span><br><span class="line">            cachedNode[head] = <span class="keyword">new</span> <span class="built_in">Node</span>(head-&gt;val);</span><br><span class="line">            cachedNode[head]-&gt;next = <span class="built_in">copyRandomList</span>(head-&gt;next);</span><br><span class="line">            cachedNode[head]-&gt;random = <span class="built_in">copyRandomList</span>(head-&gt;random);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> cachedNode[head];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ol><li><p>迭代+节点拆分</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">Node* <span class="title">copyRandomList</span><span class="params">(Node* head)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (head == <span class="literal">nullptr</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (Node* node = head; node != <span class="literal">nullptr</span>; node = node-&gt;next-&gt;next) &#123;</span><br><span class="line">            Node* nodeNew = <span class="keyword">new</span> <span class="built_in">Node</span>(node-&gt;val);</span><br><span class="line">            nodeNew-&gt;next = node-&gt;next;</span><br><span class="line">            node-&gt;next = nodeNew;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (Node* node = head; node != <span class="literal">nullptr</span>; node = node-&gt;next-&gt;next) &#123;</span><br><span class="line">            Node* nodeNew = node-&gt;next;</span><br><span class="line">            nodeNew-&gt;random = (node-&gt;random != <span class="literal">nullptr</span>) ? node-&gt;random-&gt;next : <span class="literal">nullptr</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        Node* headNew = head-&gt;next;</span><br><span class="line">        <span class="keyword">for</span> (Node* node = head; node != <span class="literal">nullptr</span>; node = node-&gt;next) &#123;</span><br><span class="line">            Node* nodeNew = node-&gt;next;</span><br><span class="line">            node-&gt;next = node-&gt;next-&gt;next;</span><br><span class="line">            nodeNew-&gt;next = (nodeNew-&gt;next != <span class="literal">nullptr</span>) ? nodeNew-&gt;next-&gt;next : <span class="literal">nullptr</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> headNew;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ol><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      
        <tags>
            
            <tag> leetcode </tag>
            
            <tag> algorithm </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vue网上商城项目</title>
      <link href="2022/10/25/vue%E7%BD%91%E4%B8%8A%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/"/>
      <url>2022/10/25/vue%E7%BD%91%E4%B8%8A%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>学了就要写<br><span id="more"></span></p><p>使用vue cli,自己选一些feature.vuex和vue-router必要的.还要安装axios,vue-axios(axios使用的时候不能像vue的插件（如：Vue-Router、VueX等）通过Vue.use()安装插件，需要在原型上进行绑定：Vue.prototype.$axios = axios).</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install axios vue-axios -S</span><br></pre></td></tr></table></figure><p>在main.js文件中</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">&#x27;./App.vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">&#x27;./router&#x27;</span></span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">&#x27;./store&#x27;</span></span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span></span><br><span class="line"><span class="keyword">import</span> VueAxios <span class="keyword">from</span> <span class="string">&#x27;vue-axios&#x27;</span></span><br><span class="line">createApp(App).use(store).use(router).use(VueAxios,axios).mount(<span class="string">&#x27;#app&#x27;</span>)</span><br></pre></td></tr></table></figure><p>views目录下存放页面级组件,一般的小组件存放在components的文件夹下,这些组件会被复用.</p><p>请求后端数据就需要配置一个反向代理,在vue.config.js中配置</p><h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><p><a href="https://blog.csdn.net/qq_43654065/article/details/121288529">axios和vue-axios_在线小白www的博客-CSDN博客_axios vue-axios</a></p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>vue-element-template实战</title>
      <link href="2022/10/08/vue-element-template%E5%AE%9E%E6%88%98/"/>
      <url>2022/10/08/vue-element-template%E5%AE%9E%E6%88%98/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>一大坨东西<br><span id="more"></span></p><p>先复习一下vue</p><p>虚拟DOM 节省资源</p><h3 id="声明式渲染"><a href="#声明式渲染" class="headerlink" title="声明式渲染"></a>声明式渲染</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 鼠标悬浮看 title 属性 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--v-bind v-on--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">:title</span>=<span class="string">&quot;msg&quot;</span> <span class="attr">:click</span>=<span class="string">&quot;handleClick&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;handleClick&quot;</span>&gt;</span>&#123;&#123; msg &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">  <span class="attr">name</span>: <span class="string">&quot;App&quot;</span>,</span></span><br><span class="line"><span class="javascript">  <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="attr">msg</span>: <span class="string">&quot;hello 蓝桥&quot;</span>,</span></span><br><span class="line"><span class="javascript">    &#125;;</span></span><br><span class="line"><span class="javascript">  &#125;,</span></span><br><span class="line"><span class="javascript">  <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">handleClick</span>(<span class="params">event</span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      alert(event.target.title);</span></span><br><span class="line"><span class="javascript">    &#125;,</span></span><br><span class="line"><span class="javascript">  &#125;,</span></span><br><span class="line"><span class="javascript">&#125;;</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="条件与循环"><a href="#条件与循环" class="headerlink" title="条件与循环"></a>条件与循环</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;!-- &lt;img alt=&quot;Vue logo&quot; src=&quot;./assets/logo.png&quot;&gt; --&gt;</span><br><span class="line">  &lt;!-- &lt;HelloWorld msg=&quot;Welcome to Your Vue.js App&quot;/&gt; --&gt;</span><br><span class="line">  &lt;div v-if=&quot;seen&quot; v-bind:title=&quot;msg&quot; @click=&quot;handleClick&quot;&gt;&#123;&#123;msg&#125;&#125;&lt;/div&gt;</span><br><span class="line"> &lt;template v-for=&quot;todo in todos&quot; :key=&quot;todo&quot;&gt;</span><br><span class="line">      &lt;div&gt;&#123;&#123; todo &#125;&#125;&lt;/div&gt;</span><br><span class="line">    &lt;/template&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">// import HelloWorld from &#x27;./components/HelloWorld.vue&#x27;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  name: &#x27;App&#x27;,</span><br><span class="line">  components: &#123;</span><br><span class="line">    // HelloWorld</span><br><span class="line">  &#125;,</span><br><span class="line">  data()&#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      msg:&quot;Hello 蓝桥&quot;,</span><br><span class="line">      seen:true,</span><br><span class="line">      todos:[&quot;Vue&quot;, &quot;React&quot;, &quot;Angular&quot;]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods:&#123;</span><br><span class="line">    handleClick() &#123;</span><br><span class="line">      // alert(event.target.title);</span><br><span class="line">      this.seen = false</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style&gt;</span><br><span class="line">#app &#123;</span><br><span class="line">  font-family: Avenir, Helvetica, Arial, sans-serif;</span><br><span class="line">  -webkit-font-smoothing: antialiased;</span><br><span class="line">  -moz-osx-font-smoothing: grayscale;</span><br><span class="line">  text-align: center;</span><br><span class="line">  color: #2c3e50;</span><br><span class="line">  margin-top: 60px;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><h3 id="组件化应用构建"><a href="#组件化应用构建" class="headerlink" title="组件化应用构建"></a>组件化应用构建</h3><p>组件系统是 Vue 的另一个重要概念，因为它是一种抽象，允许我们使用小型、独立和通常可复用的组件构建大型应用.</p><p>简单来说,一个Vue文件就是一个组件,里面有template script style.</p><p>建立一个Vue文件,比如叫main-component.Vue</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;!-- 鼠标悬浮看 title 属性 --&gt;</span><br><span class="line">  &lt;div v-if=&quot;seen&quot; :title=&quot;msg&quot; v-on:click=&quot;handleClick&quot;&gt;</span><br><span class="line">    &#123;&#123; msg &#125;&#125;</span><br><span class="line">    &lt;!-- 循环渲染列表数据 --&gt;</span><br><span class="line">    &lt;template v-for=&quot;todo in todos&quot; :key=&quot;todo&quot;&gt;</span><br><span class="line">      &lt;div&gt;&#123;&#123; todo &#125;&#125;&lt;/div&gt;</span><br><span class="line">    &lt;/template&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &quot;MainConcepts&quot;, // 组件名称</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      msg: &quot;hello 蓝桥&quot;,</span><br><span class="line">      seen: true, // 控制是否显示</span><br><span class="line">      todos: [&quot;Vue&quot;, &quot;React&quot;, &quot;Angular&quot;],</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    handleClick() &#123;</span><br><span class="line">      // alert(event.target.title);</span><br><span class="line">      this.seen = false;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;style&gt;&lt;/style&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;!-- 渲染 MainConcepts 组件--&gt;</span><br><span class="line">  &lt;main-concepts /&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import MainConcepts from &quot;./main-concepts&quot;; // 引入 MainConcepts 组件</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &quot;App&quot;,</span><br><span class="line">  components: &#123;</span><br><span class="line">    MainConcepts,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;style&gt;&lt;/style&gt;</span><br></pre></td></tr></table></figure><p>在 Vue 中，组件分为：“普通组件”、“函数式组件”、“类组件”。</p><p>Props代表了根组件的属性值</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;!-- 声明式渲染 msg 数据 --&gt;</span><br><span class="line">  &lt;div&gt;&#123;&#123; msg &#125;&#125;&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &quot;App&quot;,</span><br><span class="line">  props: [&quot;msg&quot;], // 给 App 组件定义一个 msg 属性</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">&quot;./App&quot;</span>;</span><br><span class="line"><span class="comment">// 传递根组件，并传递根组件属性</span></span><br><span class="line">createApp(App, &#123; <span class="attr">msg</span>: <span class="string">&quot;我是根组件属性中的 msg&quot;</span> &#125;).mount(<span class="string">&quot;#app&quot;</span>);</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> app = Vue.createApp(...)</span><br><span class="line"><span class="comment">// 注册一个全局组件 SearchInput</span></span><br><span class="line">app.component(<span class="string">&#x27;SearchInput&#x27;</span>, SearchInputComponent)</span><br><span class="line"><span class="comment">// 注册一个全局指令 focus</span></span><br><span class="line">app.directive(<span class="string">&#x27;focus&#x27;</span>, FocusDirective)</span><br><span class="line"><span class="comment">// 插件的使用</span></span><br><span class="line">app.use(LocalePlugin)</span><br></pre></td></tr></table></figure><h3 id="模板语法"><a href="#模板语法" class="headerlink" title="模板语法"></a>模板语法</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">span</span>&gt;</span>hello: &#123;&#123; msg &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">span</span>&gt;</span>hello: &#123;&#123; msg &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">  <span class="attr">name</span>: <span class="string">&quot;App&quot;</span>,</span></span><br><span class="line"><span class="javascript">  <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="attr">msg</span>: <span class="string">&quot;蓝桥&quot;</span>,</span></span><br><span class="line"><span class="javascript">    &#125;;</span></span><br><span class="line"><span class="javascript">  &#125;,</span></span><br><span class="line"><span class="javascript">&#125;;</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="指令"><a href="#指令" class="headerlink" title="指令"></a>指令</h3><p>用 <code>v-bind</code> 指令给元素绑定了一个属性</p><p>用过<code>v-if</code> 条件指令去控制某个元素的显示，用过 <code>v-on</code> 指令绑定过 <code>click</code> 事件，用过 <code>v-for</code> 指令去循环渲染</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 鼠标悬浮看 title 属性 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span></span></span><br><span class="line"><span class="tag">    <span class="attr">v-if</span>=<span class="string">&quot;seen&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:title</span>=<span class="string">&quot;msg&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">v-on:click</span>=<span class="string">&quot;handleClick&quot;</span></span></span><br><span class="line"><span class="tag">  &gt;</span></span><br><span class="line">  ...</span><br></pre></td></tr></table></figure><h3 id="修饰符"><a href="#修饰符" class="headerlink" title="修饰符"></a>修饰符</h3><p>修饰符 (modifier) 是以半角句号 <code>.</code> 指明的特殊后缀，用于指出一个指令应该以特殊方式绑定。例如，<code>.prevent</code> 修饰符告诉 <code>v-on</code> 指令对于触发的事件调用 <code>event.preventDefault()</code>：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">v-on:click.prevent</span>=<span class="string">&quot;handleLinkClick&quot;</span>&gt;</span>...<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">a</span></span></span><br><span class="line"><span class="tag">    <span class="attr">v-bind:</span>[<span class="attr">attributeName</span>]=<span class="string">&quot;msg&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">v-on:</span>[<span class="attr">eventName</span>]<span class="attr">.prevent</span>=<span class="string">&quot;handleClick&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">href</span>=<span class="string">&quot;https://www.lanqiao.cn/courses&quot;</span></span></span><br><span class="line"><span class="tag">  &gt;</span></span><br><span class="line">    &#123;&#123; &quot;hello&quot; + msg &#125;&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="data属性"><a href="#data属性" class="headerlink" title="data属性"></a>data属性</h3><p>组件的 <code>Data</code> 属性是一个函数。Vue 在创建新组件实例的过程中调用此函数。它应该返回一个对象，然后 Vue 会通过响应性系统将其包裹起来，并以 <code>$data</code> 的形式存储在组件实例中。可以直接通过组件实例访问 <code>$data</code> 对象中的属性。</p><p>组件外可以通过组件实例来访问组件 Data 属性</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">&quot;./App.vue&quot;</span>;</span><br><span class="line"><span class="comment">// 创建 app 应用实例</span></span><br><span class="line"><span class="keyword">const</span> app = createApp(App);</span><br><span class="line"><span class="comment">// 获取 App 根组件实例</span></span><br><span class="line"><span class="keyword">const</span> rootComponent = app.mount(<span class="string">&quot;#app&quot;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;App 组件中的 Data 属性：&quot;</span>, rootComponent.$data);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;App 组件中的 msg 数据：&quot;</span>, rootComponent.msg);</span><br><span class="line"><span class="comment">// 修改组件的响应式数据 msg</span></span><br><span class="line">rootComponent.msg = <span class="string">&quot;我是 msg 数据，我在组件外被修改了&quot;</span>;</span><br></pre></td></tr></table></figure><p>在定义 <code>methods</code> 时应避免使用<strong>箭头函数</strong>，因为这会阻止 Vue 绑定恰当的 <code>this</code> 指向。</p><h3 id="计算属性"><a href="#计算属性" class="headerlink" title="计算属性"></a>计算属性</h3><p>计算属性可以依赖多个 Vue 实例的数据，只要其中任一数据变化，计算属性就会重新执行，视图也会更新。</p><p>计算属性 <code>computed</code> 在使用时，一定要注意，函数里面的变量都会被监听，只要里面的某一个值变动，便会将整个函数执行一遍。</p><p>计算属性的setter与getter</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;fieldset&gt;</span><br><span class="line">      &lt;legend&gt;单价：&lt;/legend&gt;</span><br><span class="line">      &lt;input :value=&quot;price&quot; @input=&quot;handlePriceInput&quot; /&gt;</span><br><span class="line">    &lt;/fieldset&gt;</span><br><span class="line">    &lt;fieldset&gt;</span><br><span class="line">      &lt;legend&gt;数量：&lt;/legend&gt;</span><br><span class="line">      &lt;input :value=&quot;count&quot; @input=&quot;handleCountInput&quot; /&gt;</span><br><span class="line">    &lt;/fieldset&gt;</span><br><span class="line">    总价：&#123;&#123; total &#125;&#125;</span><br><span class="line">    &lt;div @click=&quot;handleTotal&quot;&gt;私自修改一下 total&lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &quot;App&quot;,</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      count: 0, // 数量</span><br><span class="line">      price: 0, // 单价</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  computed: &#123;</span><br><span class="line">    // 计算属性声明</span><br><span class="line">    total: &#123;</span><br><span class="line">      // 定义 total 计算属性</span><br><span class="line">      // getter</span><br><span class="line">      get() &#123;</span><br><span class="line">        return parseInt(this.count) * parseFloat(this.price);</span><br><span class="line">      &#125;,</span><br><span class="line">      // setter</span><br><span class="line">      set(newValue) &#123;</span><br><span class="line">        alert(&quot;不允许直接操作 total 的值，你计算的：&quot; + newValue + &quot;无效！&quot;);</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    /**</span><br><span class="line">      处理单价输入</span><br><span class="line">     */</span><br><span class="line">    handlePriceInput(event) &#123;</span><br><span class="line">      this.price = event.target.value;</span><br><span class="line">    &#125;,</span><br><span class="line">    /**</span><br><span class="line">      处理数量输入</span><br><span class="line">     */</span><br><span class="line">    handleCountInput(event) &#123;</span><br><span class="line">      this.count = event.target.value;</span><br><span class="line">    &#125;,</span><br><span class="line">    /**</span><br><span class="line">     * 自定义处理 total</span><br><span class="line">     */</span><br><span class="line">    handleTotal() &#123;</span><br><span class="line">      this.total = 0;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h3 id="监听器"><a href="#监听器" class="headerlink" title="监听器"></a>监听器</h3><p>虽然计算属性在大多数情况下更合适，但有时也需要一个自定义的侦听器。这就是为什么 Vue 通过 <code>watch</code> 选项提供了一个更通用的方法，来响应数据的变化。当需要在数据变化时<strong>执行异步</strong>或开销较大的操作时，这个方式是最有用的</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;fieldset&gt;</span><br><span class="line">      &lt;legend&gt;单价：&lt;/legend&gt;</span><br><span class="line">      &lt;input :value=&quot;price&quot; @input=&quot;handlePriceInput&quot; /&gt;</span><br><span class="line">    &lt;/fieldset&gt;</span><br><span class="line">    &lt;fieldset&gt;</span><br><span class="line">      &lt;legend&gt;数量：&lt;/legend&gt;</span><br><span class="line">      &lt;input :value=&quot;count&quot; @input=&quot;handleCountInput&quot; /&gt;</span><br><span class="line">    &lt;/fieldset&gt;</span><br><span class="line">    总价：&#123;&#123; total &#125;&#125;</span><br><span class="line">    &lt;div @click=&quot;handleTotal&quot;&gt;私自修改一下 total&lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &quot;App&quot;,</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      count: 0, // 数量</span><br><span class="line">      price: 0, // 单价</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  computed: &#123;</span><br><span class="line">    // 计算属性声明</span><br><span class="line">    total: &#123;</span><br><span class="line">      // 定义 total 计算属性</span><br><span class="line">      // getter</span><br><span class="line">      get() &#123;</span><br><span class="line">        return parseInt(this.count) * parseFloat(this.price);</span><br><span class="line">      &#125;,</span><br><span class="line">      // setter</span><br><span class="line">      set(newValue) &#123;</span><br><span class="line">        alert(&quot;不允许直接操作 total 的值，你计算的：&quot; + newValue + &quot;无效！&quot;);</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  watch: &#123;</span><br><span class="line">    // 侦听器声明</span><br><span class="line">    count(newCount, oldCount) &#123;</span><br><span class="line">      // 定义一个侦听器，名称跟响应式数据 count 一致</span><br><span class="line">      // 商品数量必须 &gt;= 0</span><br><span class="line">      if (Number.isNaN(parseFloat(newCount)) || parseFloat(newCount) &lt; 0) &#123;</span><br><span class="line">        this.count = oldCount;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    price(newPrice, oldPrice) &#123;</span><br><span class="line">      // 定义一个侦听器，名称跟响应式数据 price 一致</span><br><span class="line">      // 单价必须 &gt;= 0</span><br><span class="line">      if (Number.isNaN(parseFloat(newPrice)) || parseFloat(newPrice) &lt; 0) &#123;</span><br><span class="line">        this.price = oldPrice;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    /**</span><br><span class="line">      处理单价输入</span><br><span class="line">     */</span><br><span class="line">    handlePriceInput(event) &#123;</span><br><span class="line">      this.price = event.target.value;</span><br><span class="line">    &#125;,</span><br><span class="line">    /**</span><br><span class="line">      处理数量输入</span><br><span class="line">     */</span><br><span class="line">    handleCountInput(event) &#123;</span><br><span class="line">      this.count = event.target.value;</span><br><span class="line">    &#125;,</span><br><span class="line">    /**</span><br><span class="line">     * 自定义处理 total</span><br><span class="line">     */</span><br><span class="line">    handleTotal() &#123;</span><br><span class="line">      this.total = 0;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>除了可以在 watch 选项中执行条件判断外，我们甚至可以在里面进行异步请求，并在我们得到最终结果前，设置中间状态。这些都是计算属性无法做到的</p><p><strong>计算属性与侦听器的区别：</strong></p><div class="table-container"><table><thead><tr><th>名称</th><th>特性</th></tr></thead><tbody><tr><td>计算属性（computed）</td><td>1. 计算一个或多个响应式数据的值。 2. 应用：简化模版语法中的变量计算。 3. 具有缓存性，页面重新渲染值不变化，计算属性会立即返回之前的计算结果，而不必再次执行函数。</td></tr><tr><td>侦听器（watch）</td><td>1. 观察一个响应式数据变化。 2. 应用：监听响应式数据的变化，做对应逻辑处理。 3. 具有缓存性，页面重新渲染值不变化，监听方法不会执行。</td></tr></tbody></table></div><h3 id="Vue-router"><a href="#Vue-router" class="headerlink" title="Vue-router"></a>Vue-router</h3><h4 id="Hash模式"><a href="#Hash模式" class="headerlink" title="Hash模式"></a>Hash模式</h4><p>hash 模式是用 <code>createWebHashHistory()</code> 创建的：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createRouter, createWebHashHistory &#125; <span class="keyword">from</span> <span class="string">&quot;vue-router&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> router = createRouter(&#123;</span><br><span class="line">  <span class="attr">history</span>: createWebHashHistory(),</span><br><span class="line">  <span class="attr">routes</span>: [</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">  ],</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>它在内部传递的实际 URL 之前使用了一个哈希字符（<code>#</code>）。由于这部分 URL 从未被发送到服务器，所以它不需要在服务器层面上进行任何特殊处理。不过，<strong>它在 SEO 中确实有不好的影响</strong>。如果你担心这个问题，可以使用 HTML5 模式</p><h4 id="HTML5模式"><a href="#HTML5模式" class="headerlink" title="HTML5模式"></a>HTML5模式</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createRouter, createWebHistory &#125; <span class="keyword">from</span> <span class="string">&quot;vue-router&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> router = createRouter(&#123;</span><br><span class="line">  <span class="attr">history</span>: createWebHistory(),</span><br><span class="line">  <span class="attr">routes</span>: [</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">  ],</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="Vue-element-template"><a href="#Vue-element-template" class="headerlink" title="Vue-element-template"></a>Vue-element-template</h2><p>直接先看一下文档</p><p><a href="http://panjiachen.github.io/vue-element-admin">vue-element-admin</a> 是一个后台前端解决方案，它基于 <a href="https://github.com/vuejs/vue">vue</a> 和 <a href="https://github.com/ElemeFE/element">element-ui</a>实现。它使用了最新的前端技术栈，内置了 i18 国际化解决方案，动态路由，权限验证，提炼了典型的业务模型，提供了丰富的功能组件</p><p><strong>建议</strong>你可以把 <code>vue-element-admin</code>当做工具箱或者集成方案仓库，在 <code>vue-admin-template</code> 的基础上进行二次开发，想要什么功能或者组件就去 <code>vue-element-admin</code> 那里复制过来。</p><h2 id="布局"><a href="#布局" class="headerlink" title="布局"></a>布局</h2><h3 id="layout"><a href="#layout" class="headerlink" title="layout"></a>layout</h3><p>对应代码@/layout</p><p><code>vue-element-admin</code> 中大部分页面都是基于这个 <code>layout</code> 的，除了个别页面如：<code>login</code> , <code>404</code>, <code>401</code> 等页面没有使用该<code>layout</code>。如果你想在一个项目中有多种不同的<code>layout</code>也是很方便的，只要在一级路由那里选择不同的<code>layout</code>组件就行</p><h3 id="app-main"><a href="#app-main" class="headerlink" title="app-main"></a>app-main</h3><p>对应代码</p><p><a href="https://github.com/PanJiaChen/vue-element-admin/blob/master/src/layout/components/AppMain.vue">@/layout/components/AppMain</a></p><p>这里在 <code>app-main</code> 外部包了一层 <code>keep-alive</code> 主要是为了缓存 <code>&lt;router-view&gt;</code> 的，配合页面的 <code>tabs-view</code> 标签导航使用，如不需要可自行<a href="https://panjiachen.gitee.io/vue-element-admin-site/zh/guide/essentials/tags-view.html">去除</a>。</p><p>其中<code>transition</code> 定义了页面之间切换动画，可以根据自己的需求，自行修改转场动画。相关<a href="https://cn.vuejs.org/v2/guide/transitions.html">文档</a>。默认提供了<code>fade</code>和<code>fade-transform</code>两个转场动画，具体 css 实现见<a href="https://github.com/PanJiaChen/vue-element-admin/blob/master/src/styles/transition.scss">transition.scss</a>。如果需要调整可在<a href="https://github.com/PanJiaChen/vue-element-admin/blob/master/src/layout/components/AppMain.vue">AppMain.vue</a>中调整<code>transition</code> 的 <code>name</code>。</p><h2 id="路由和侧边栏"><a href="#路由和侧边栏" class="headerlink" title="路由和侧边栏"></a>路由和侧边栏</h2><p>本项目侧边栏和路由是绑定在一起的，所以你只有在 <code>@/router/index.js</code> 下面配置对应的路由，侧边栏就能动态的生成了。大大减轻了手动重复编辑侧边栏的工作量。当然这样就需要在配置路由的时候遵循一些约定的规则</p><h2 id="资料"><a href="#资料" class="headerlink" title="资料"></a>资料</h2><p><a href="https://panjiachen.gitee.io/vue-element-admin-site/zh/">vue-element-admin (gitee.io)</a></p><p><a href="https://www.cnblogs.com/jyk/p/16248880.html">一篇文章说清 webpack、vite、vue-cli、create-vue 的区别 - 金色海洋（jyk） - 博客园 (cnblogs.com)</a></p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      
        <tags>
            
            <tag> vue </tag>
            
            <tag> vue-element-template </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Obsidian学习与Zotero联动</title>
      <link href="2022/10/01/Obsidian%E5%AD%A6%E4%B9%A0/"/>
      <url>2022/10/01/Obsidian%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>比typora多一点功能,管理与看文献更方便<br><span id="more"></span></p><p>我看重Obsidian的点在于文档双向链接以及有关系图而Zotero适用于管理文献的,可以通过插件获取更多功能.</p><h2 id="Obesidian"><a href="#Obesidian" class="headerlink" title="Obesidian"></a>Obesidian</h2><p>Markdown语法,双向链接,网络视图(关系图)此外还有很多插件以及可以设置模板</p><p>Markdown不用多说了,多媒体文件插入类似typora直接插入即可.</p><p>双向链接,输入[[]]可以跳出链接,用于链接其他文件.至于网络视图<img data-src="http://cdn.sekyoro.top/imgs/image-20221005191227303.png" alt="image-20221005191227303" style="zoom:67%;" /></p><p>​           </p><p>打开局部关系图即可</p><h2 id="Zotero"><a href="#Zotero" class="headerlink" title="Zotero"></a>Zotero</h2><p>用于文献管理,可以下载一些插件,按照提示装上那个浏览器的插件</p><h3 id="文献导入"><a href="#文献导入" class="headerlink" title="文献导入"></a>文献导入</h3><p>先建立一个文件夹, 打开文献网站点击插件就能直接导入了,或者下载文件拖拽到相应位置.</p><p><img data-src="http://cdn.sekyoro.top/imgs/image-20221005200640214.png" alt="image-20221005200640214" style="zoom:50%;" /></p><h3 id="打标签"><a href="#打标签" class="headerlink" title="打标签"></a>打标签</h3><p>简单但很有用的操作,打上标签就知道论文是什么类型了.</p><p><img data-src="http://cdn.sekyoro.top/imgs/image-20221005205211225.png" alt="image-20221005205211225" style="zoom:67%;" /></p><p>还可以修改标签颜色</p><p><img data-src="http://cdn.sekyoro.top/imgs/image-20221005205915134.png" alt="image-20221005205915134" style="zoom:67%;" /></p><p>还可以添加笔记</p><p><img data-src="http://cdn.sekyoro.top/imgs/image-20221005210030322.png" alt="image-20221005210030322" style="zoom:67%;" /></p><p>双击查看文章</p><p><img data-src="http://cdn.sekyoro.top/imgs/image-20221005210204818.png" alt="image-20221005210204818" style="zoom:67%;" /></p><h3 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h3><p><img data-src="http://cdn.sekyoro.top/imgs/image-20221005211654155.png" alt="image-20221005211654155"></p><p>Zotero文件由pdf文件和快照组成</p><h3 id="Zotfile插件"><a href="#Zotfile插件" class="headerlink" title="Zotfile插件"></a>Zotfile插件</h3><p>重命名是 ZotFile 插件提供的功能，但属于文献的日常管理，所以放在这里讲。除了会将 PDF 标题修改为规定格式，该功能最常用来将文献迁移到自定义的目录下，也就是说它会把原本存在 Zotero 数据目录下的 PDF 文件转换为一个指向 OneDrive（对于我来说）中文件的软链接。</p><p>这也意味着导入一篇文献需要完成三步操作：拖入 PDF 文献，等待元数据检索完成并检查（或先导入元数据再拖入 PDF 文件），最后右键选择 Rename Attachments。比较繁琐，但没办法。</p><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://www.bilibili.com/video/BV1Ya4y1E7Mo/?vd_source=177ef88aa6608bc3652c72d71b0aa098">超好用笔记软件！神奇的Obsidian黑曜石Markdown文本编辑知识管理工具，成为你的第二大脑【方俊皓同学】_哔哩哔哩_bilibili</a></p><p><a href="https://www.bilibili.com/video/BV1up4y1i7Hr/">我是如何使用Obsidian的 | 黑曜石Markdown笔记软件入门讲解 | 轻松设置懒人包【方俊皓同学】_哔哩哔哩_bilibili</a></p><p><a href="https://zhuanlan.zhihu.com/p/347493385">Zotero：科研小白的第一款文献管理软件 - 知乎 (zhihu.com)</a></p><p><a href="https://zhuanlan.zhihu.com/p/349638221">Obsidian：一款完美的科研笔记/知识管理软件 - 知乎 (zhihu.com)</a></p><p><a href="https://zhuanlan.zhihu.com/p/98428625?from_voters_page=true">文献管理工具（一）：Zotero的操作指南 - 知乎 (zhihu.com)</a></p><p><a href="https://bend1031.github.io/2021/01/10/Zotero-uses-plug-in-Mdnotes-to-link-with-Obsidian/">Zotero 利用插件 Mdnotes 与 Obsidian 联动 - Bend的博客 | Bend’s Blog (bend1031.github.io)</a></p><p><a href="https://www.bilibili.com/video/BV1ZE411p7qT/?spm_id_from=333.337.search-card.all.click&amp;vd_source=177ef88aa6608bc3652c72d71b0aa098">Zotero基础操作，比Endnote更好用的文献管理软件_哔哩哔哩_bilibili</a></p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      
        <tags>
            
            <tag> Obsidian </tag>
            
            <tag> workflow </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>记录一次wp重装</title>
      <link href="2022/09/28/%E8%AE%B0%E5%BD%95%E4%B8%80%E6%AC%A1wp%E9%87%8D%E8%A3%85/"/>
      <url>2022/09/28/%E8%AE%B0%E5%BD%95%E4%B8%80%E6%AC%A1wp%E9%87%8D%E8%A3%85/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>网站出现了一点问题<br><span id="more"></span></p><p>之前用wordpress安装了主题但后面出了点问题,像是少了css文件<del>不排除被攻击了:cry:</del>,后面发现获取不到样式文件应该https有关.</p><p>重新装,把之前的wordpress文件都删掉,然后开始重装.这里主要写一下注意点.</p><h2 id="创建网站"><a href="#创建网站" class="headerlink" title="创建网站"></a>创建网站</h2><p>我用的是宝塔面板,添加站点,没有什么特别的,但是我在创建后发现进入网页还是显示不存在,这样反复几次我都崩溃了,结果在手机上访问网页又可以.浏览器退出再访问又行了,说明跟浏览器缓存有关.</p><p><img data-src="http://cdn.sekyoro.top/imgs/image-20220928152210895.png" alt="image-20220928152210895"></p><p>这是第一步,先在宝塔面板上创建一个站点,具体方法看参考网址,这里我不说了.这一步主要设置域名和ip,网站文件夹</p><h2 id="wordpress文件"><a href="#wordpress文件" class="headerlink" title="wordpress文件"></a>wordpress文件</h2><p>下载wordpress,放入第一步的文件夹中,解压后进入网页</p><p>创建数据库并填入信息,进入安装页</p><p><img data-src="http://cdn.sekyoro.top/imgs/image-20220928152659012.png" alt="image-20220928152659012"></p><h2 id="更换主题"><a href="#更换主题" class="headerlink" title="更换主题"></a>更换主题</h2><p>然后是换主题,下载一个主题,放入wp-content中的theme的文件夹中,在wp中有主题更改选项,直接改就行.</p><h2 id="SSL证书"><a href="#SSL证书" class="headerlink" title="SSL证书"></a>SSL证书</h2><p>我是在腾讯云买的域名,也是在办的免费SSL证书,然后在宝塔面板填上密钥和证书</p><h2 id="下载插件"><a href="#下载插件" class="headerlink" title="下载插件"></a>下载插件</h2><p>可以直接在wordpress中下载,也可以在其他地方下载放到文件夹下</p><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://zhuanlan.zhihu.com/p/47166916">wordpress怎么安装？小白教程 - 知乎 (zhihu.com)</a></p><p><a href="https://zhuanlan.zhihu.com/p/313474705">宝塔面板安装和搭建wordpress完整教程(新手指南) - 知乎 (zhihu.com)</a></p><p><a href="https://www.vpsss.net/19231.html">如何申请腾讯云免费ssl证书并部署到宝塔面板？-魏艾斯笔记 (vpsss.net)</a></p><p><a href="https://themeforwp.net/archives/wordpress-install-plugin/#:~:text=对于免费插件，一般我们都可以通过在 WordPress插件库,中搜索名称寻找，找到插件后点开详情页，会看到一个蓝色的Download按钮，点击它就会下载插件的安装包 如果是付费插件的话，一般都需要在插件的网站单独下载 下载下来一般都是zip的安装包，这个安装包就是插件的文件，接下来我们直接将其上传即可">WordPress安装插件的3种方法 - WP主题站 (themeforwp.net)</a></p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      
        <tags>
            
            <tag> wordpress </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>cs224w学习</title>
      <link href="2022/09/22/cs224w%E5%AD%A6%E4%B9%A0/"/>
      <url>2022/09/22/cs224w%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>顺便学一下,还很重要的.主讲人是斯坦福大牛Jure Leskovec，他是图表示学习方法 node2vec 和 GraphSAGE 作者之一。<br><span id="more"></span></p><blockquote><p>Complex data can be represented as a graph of relationships between objects. Such networks are a fundamental tool for modeling social, technological, and biological systems. This course focuses on the computational, algorithmic, and modeling challenges specific to the analysis of massive graphs. By means of studying the underlying graph structure and its features, students are introduced to machine learning techniques and data mining tools apt to reveal insights on a variety of networks.</p></blockquote><p>网络相比一般的图像,文字的特殊性.没有空间局部性</p><h2 id="资料"><a href="#资料" class="headerlink" title="资料"></a>资料</h2><p><a href="http://web.stanford.edu/class/cs224w/">CS224W | Home (stanford.edu)</a></p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>flask学习</title>
      <link href="2022/09/19/flask%E5%AD%A6%E4%B9%A0/"/>
      <url>2022/09/19/flask%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>java有一套spring但是略显笨重而且对于个人平时玩玩来说总感觉没必要(如果掌握了的话效率还是不错的) python的web框架有django和flask等</p><span id="more"></span><p>先安装环境</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install flask</span><br></pre></td></tr></table></figure><p>即可 安装最新版</p><p>按照官网教程</p><h2 id="最小的应用"><a href="#最小的应用" class="headerlink" title="最小的应用"></a>最小的应用</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello_world</span>():</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;Hello, World!&#x27;</span></span><br></pre></td></tr></table></figure><ol><li>首先我们导入了 <a href="https://flask.net.cn/api.html#flask.Flask"><code>Flask</code></a> 类。 该类的实例将会成为我们的 WSGI 应用。</li><li>接着我们创建一个该类的实例。第一个参数是应用模块或者包的名称。如果你使用 一个单一模块（就像本例），那么应当使用 <code>__name__</code> ，因为名称会根据这个 模块是按应用方式使用还是作为一个模块导入而发生变化（可能是 ‘<strong>main</strong>’ ， 也可能是实际导入的名称）。这个参数是必需的，这样 Flask 才能知道在哪里可以 找到模板和静态文件等东西。更多内容详见 <a href="https://flask.net.cn/api.html#flask.Flask"><code>Flask</code></a> 文档。</li><li>然后我们使用 <a href="https://flask.net.cn/api.html#flask.Flask.route"><code>route()</code></a> 装饰器来告诉 Flask 触发函数的 URL 。</li><li>函数名称被用于生成相关联的 URL 。函数最后返回需要在用户浏览器中显示的信息。</li></ol><p><strong>WSGI的介绍</strong>：</p><p>全称Python Web Server Gateway Interface，指定了web服务器和Python web应用或web框架之间的标准接口，以提高web应用在一系列web服务器间的移植性。 具体可查看 <a href="https://link.zhihu.com/?target=https%3A//www.python.org/dev/peps/pep-0333/">官方文档</a></p><p>从以上介绍我们可以看出：</p><ol><li>WSGI是一套接口标准协议/规范；</li><li>通信（作用）区间是Web服务器和Python Web应用程序之间；</li><li>目的是制定标准，以保证不同Web服务器可以和不同的Python程序之间相互通信</li></ol><p>请不要使用 <code>flask.py</code> 作为应用名称，这会与 Flask 本身发生冲突。</p><p><strong>flask</strong> 命令或者 python 的 <code>-m</code> 开关来运行这个应用。在 运行应用之前，需要在终端里导出 <code>FLASK_APP</code> 环境变量:</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">export</span> FLASK_APP=hello.py</span><br><span class="line">$ flask run</span><br><span class="line"> * Running on http:<span class="comment">//127.0.0.1:5000/</span></span><br></pre></td></tr></table></figure><p>通过flask run -h [host] -p [port]指定主机和端口</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export FLASK_ENV=development</span><br></pre></td></tr></table></figure><p>打开开发环境的功能</p><ol><li>激活调试器。</li><li>激活自动重载。</li><li>打开 Flask 应用的调试模式。</li></ol><p>还可以通过导出 <code>FLASK_DEBUG=1</code> 来单独控制调试模式的开关,<strong>绝对不能在生产环境 中使用调试器</strong></p><h2 id="路由"><a href="#路由" class="headerlink" title="路由"></a>路由</h2><p>现代 web 应用都使用有意义的 URL ，这样有助于用户记忆，网页会更得到用户的青睐， 提高回头率</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line">app = Flask(__name__)</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello_world</span>():</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;index page&#x27;</span></span><br><span class="line"><span class="comment"># print(__name__)</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/hello&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello</span>():</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;hello world&#x27;</span></span><br></pre></td></tr></table></figure><p>可以动态变化 URL 的某些部分， 还可以为一个函数指定多个规则</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/user/&lt;username&gt;&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show_user_profile</span>(<span class="params">username</span>):</span></span><br><span class="line">    <span class="comment"># 显示用户名</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;User &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(username)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/post/&lt;int:post_id&gt;&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show_post</span>(<span class="params">post_id</span>):</span></span><br><span class="line">    <span class="comment"># 显示提交整型的用户&quot;id&quot;的结果，注意&quot;int&quot;是将输入的字符串形式转换为整型数据</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;Post &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(post_id)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/path/&lt;path:subpath&gt;&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show_subpath</span>(<span class="params">subpath</span>):</span></span><br><span class="line">    <span class="comment"># 显示 /path/ 之后的路径名</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;Subpath &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(subpath)</span><br></pre></td></tr></table></figure><p>转换器的主要类型如下：</p><div class="table-container"><table><thead><tr><th>类型</th><th>含义</th></tr></thead><tbody><tr><td>string</td><td>默认的数据类型，接受没有任何斜杠“/”的字符串</td></tr><tr><td>int</td><td>接受整型</td></tr><tr><td>float</td><td>接受浮点类型</td></tr><tr><td>path</td><td>和 string 类似，但是接受斜杠“/”</td></tr><tr><td>uuid</td><td>只接受 uuid 字符串</td></tr></tbody></table></div><h3 id="唯一的-URL-重定向行为"><a href="#唯一的-URL-重定向行为" class="headerlink" title="唯一的 URL / 重定向行为"></a>唯一的 URL / 重定向行为</h3><p>以下两条规则的不同之处在于是否使用尾部的斜杠。:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/projects/&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">projects</span>():</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;The project page&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/about&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">about</span>():</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;The about page&#x27;</span></span><br></pre></td></tr></table></figure><p><code>projects</code> 的 URL 是中规中矩的，尾部有一个斜杠，看起来就如同一个文件夹。 访问一个没有斜杠结尾的 URL 时 Flask 会自动进行重定向，帮你在尾部加上一个斜杠。</p><p><code>about</code> 的 URL 没有尾部斜杠，因此其行为表现与一个文件类似。如果访问这个 URL 时添加了尾部斜杠就会得到一个 404 错误。这样可以保持 URL 唯一，并帮助 搜索引擎避免重复索引同一页面。</p><h3 id="构建URL"><a href="#构建URL" class="headerlink" title="构建URL"></a>构建URL</h3><p>使用url_for()函数</p><p><a href="https://flask.net.cn/api.html#flask.url_for"><code>url_for()</code></a> 函数用于构建指定函数的 URL。它把函数名称作为第一个 参数。它可以接受任意个关键字参数，每个关键字参数对应 URL 中的变量。未知变量 将添加到 URL 中作为查询参数。</p><p>为什么不在把 URL 写死在模板中，而要使用反转函数 <a href="https://flask.net.cn/api.html#flask.url_for"><code>url_for()</code></a> 动态构建？</p><ol><li>反转通常比硬编码 URL 的描述性更好。</li><li>你可以只在一个地方改变 URL ，而不用到处乱找。</li><li>URL 创建会为你处理特殊字符的转义和 Unicode 数据，比较直观。</li><li>生产的路径总是绝对路径，可以避免相对路径产生副作用。</li><li>如果你的应用是放在 URL 根路径之外的地方（如在 <code>/myapplication</code> 中，不在 <code>/</code> 中）， <a href="https://flask.net.cn/api.html#flask.url_for"><code>url_for()</code></a> 会为你妥善处理。</li></ol><h3 id="HTTP方法"><a href="#HTTP方法" class="headerlink" title="HTTP方法"></a>HTTP方法</h3><p>Web 应用使用不同的 HTTP 方法处理 URL 。当你使用 Flask 时，应当熟悉 HTTP 方法。 缺省情况下，一个路由只回应 <code>GET</code> 请求。 可以使用 <a href="https://flask.net.cn/api.html#flask.Flask.route"><code>route()</code></a> 装饰器的 <code>methods</code> 参数来处理不同的 HTTP 方法:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> request</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/login&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span>():</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> do_the_login()</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> show_the_login_form()</span><br></pre></td></tr></table></figure><p>如果当前使用了 GET 方法， Flask 会自动添加 <code>HEAD</code> 方法支持，并且同时还会 按照 <a href="https://www.ietf.org/rfc/rfc2068.txt">HTTP RFC</a> 来处理 <code>HEAD</code> 请求。同样， <code>OPTIONS</code> 也会自动实现。</p><h2 id="静态文件"><a href="#静态文件" class="headerlink" title="静态文件"></a>静态文件</h2><p>动态的 web 应用也需要静态文件，一般是 CSS 和 JavaScript 文件。理想情况下你的 服务器已经配置好了为你的提供静态文件的服务。但是在开发过程中， Flask 也能做好 这项工作。只要在你的包或模块旁边创建一个名为 <code>static</code> 的文件夹就行了。 静态文件位于应用的 <code>/static</code> 中。</p><p>使用特定的 <code>&#39;static&#39;</code> 端点就可以生成相应的 URL</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url_for(<span class="string">&#x27;static&#x27;</span>, filename=<span class="string">&#x27;style.css&#x27;</span>)</span><br></pre></td></tr></table></figure><p>这个静态文件在文件系统中的位置应该是 <code>static/style.css</code> 。</p><h3 id="渲染模板"><a href="#渲染模板" class="headerlink" title="渲染模板"></a>渲染模板</h3><p>在 Python 内部生成 HTML 不好玩，且相当笨拙。因为你必须自己负责 HTML 转义， 以确保应用的安全。因此， Flask 自动为你配置 <a href="http://jinja.pocoo.org/">Jinja2</a> 模板引擎</p><p>Flask 将会在 <code>templates</code> 文件夹中寻找模板。因此如果你的应用是个模块，这个文件夹在模块的旁边，如果它是一个包，那么这个文件夹在你的包里面</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Hello From Flask<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"></span><br><span class="line">&#123;% if name %&#125;</span><br><span class="line"><span class="comment">&lt;!-- 如果 name 不为空则将 name 渲染出来 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello &#123;&#123; name &#125;&#125;!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">&#123;% else %&#125;</span><br><span class="line"><span class="comment">&lt;!-- 如果 name 为空则打印 Hello World! --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello World!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">&#123;% endif %&#125;</span><br></pre></td></tr></table></figure><p>在模板中你也可以使用 <a href="http://flask.pocoo.org/docs/1.0/api/#flask.request">request</a>、<a href="http://flask.pocoo.org/docs/1.0/api/#flask.session">session</a> 和 <a href="http://flask.pocoo.org/docs/1.0/api/#flask.g">g</a> 对象，也能使用函数 <a href="http://flask.pocoo.org/docs/1.0/api/#flask.get_flashed_messages">get_flashed_messages()</a> 。</p><p>模板继承是十分有用的。如果想要知道模板继承如何工作的话，请阅读文档<a href="http://flask.pocoo.org/docs/1.0/patterns/templateinheritance/#template-inheritance">模板继承</a>。基本的模板继承使得某些特定元素（如标题、导航和页脚）在每一页成为可能</p><p>引入css文件</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;zh-CN&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span></span></span><br><span class="line"><span class="tag">      <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">href</span>=<span class="string">&quot;&#123;&#123; url_for(&#x27;static&#x27;, filename=&#x27;style.css&#x27;) &#125;&#125;&quot;</span></span></span><br><span class="line"><span class="tag">    /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello ShiYanLou &#123;&#123;name&#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="接收请求数据"><a href="#接收请求数据" class="headerlink" title="接收请求数据"></a>接收请求数据</h2><p>在 Flask 中由全局对象 <code>request</code> 来提供这些信息。如果你有一定的 Python 经验，你会好奇这个对象怎么可能是全局的，并且 Flask 是怎么还能保证线程安全。答案是上下文作用域</p><h3 id="请求对象"><a href="#请求对象" class="headerlink" title="请求对象"></a>请求对象</h3><p>首先你需要从 flask 模块中导入 <code>request</code> ：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> request</span><br></pre></td></tr></table></figure><p>当前请求的方法可以用<code>method</code>属性来访问。你可以用<code>form</code>属性来访问表单数据 (数据在 <code>POST</code> 或者<code>PUT</code>中传输)。</p><p>如果在<code>form</code>属性中不存在上述键值会发生些什么？在这种情况下会触发一个特别的 <code>KeyError</code>。你可以像捕获标准的<code>KeyError</code>一样来捕获它，如果你不这样去做，会显示一个<code>HTTP 400 Bad Request</code>错误页面。所以很多情况下你不需要处理这个问题。</p><p>你可以用<code>args</code>属性来接收在<code>URL ( ?key=value )</code>中提交的参数：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">searchword = request.args.get(<span class="string">&#x27;key&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure><p>我们推荐使用<code>get</code>来访问 URL 参数或捕获<code>KeyError</code>，因为用户可能会修改 URL，向他们显示一个<code>400 bad request</code>页面不是用户友好的。</p><h3 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h3><p>你能够很容易地用 Flask 处理文件上传。只要确保在你的 HTML 表单中不要忘记设置属性 <code>enctype=&quot;multipart/form-data&quot;</code> ，否则浏览器将不会传送文件。</p><p>上传的文件是存储在内存或者文件系统上一个临时位置。你可以通过请求对象中<code>files</code>属性访问这些文件。每个上传的文件都会存储在这个属性字典里。它表现得像一个标准的 Python <code>file</code>对象，但是它同样具有<code>save()</code>方法，该方法允许你存储文件在服务器的文件系统上。</p><p>已上传的文件被储存在内存或文件系统的临时位置。你可以通过请求对象 <code>files</code> 属性来访问上传的文件。每个上传的文件都储存在这个 字典型属性中。这个属性基本和标准 Python <code>file</code> 对象一样，另外多出一个 用于把上传文件保存到服务器的文件系统中的 <a href="https://werkzeug.palletsprojects.com/en/0.15.x/datastructures/#werkzeug.datastructures.FileStorage.save"><code>save()</code></a> 方法。下例展示其如何运作:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> request</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/upload&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">upload_file</span>():</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        f = request.files[<span class="string">&#x27;the_file&#x27;</span>]</span><br><span class="line">        f.save(<span class="string">&#x27;/var/www/uploads/uploaded_file.txt&#x27;</span>)</span><br></pre></td></tr></table></figure><p>如果你想要知道在上传到你的应用之前在客户端的文件名称，你可以访问<code>filename</code>属性。但请记住永远不要信任这个值，因为这个值可以伪造。如果你想要使用客户端的文件名来在服务器上存储文件，把它传递到 <code>Werkzeug</code> 提供给你的 <code>secure_filename()</code> 函数：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> request</span><br><span class="line"><span class="keyword">from</span> werkzeug <span class="keyword">import</span> secure_filename</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/upload&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">upload_file</span>():</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        f = request.files[<span class="string">&#x27;the_file&#x27;</span>]</span><br><span class="line">        f.save(<span class="string">&#x27;/var/www/uploads/&#x27;</span> + secure_filename(f.filename))</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure><h3 id="文件上传方案"><a href="#文件上传方案" class="headerlink" title="文件上传方案"></a>文件上传方案</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, flash, request, redirect, url_for</span><br><span class="line"><span class="keyword">from</span> werkzeug.utils <span class="keyword">import</span> secure_filename</span><br><span class="line"></span><br><span class="line">UPLOAD_FOLDER = <span class="string">&#x27;/path/to/the/uploads&#x27;</span></span><br><span class="line">ALLOWED_EXTENSIONS = &#123;<span class="string">&#x27;txt&#x27;</span>, <span class="string">&#x27;pdf&#x27;</span>, <span class="string">&#x27;png&#x27;</span>, <span class="string">&#x27;jpg&#x27;</span>, <span class="string">&#x27;jpeg&#x27;</span>, <span class="string">&#x27;gif&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.config[<span class="string">&#x27;UPLOAD_FOLDER&#x27;</span>] = UPLOAD_FOLDER</span><br></pre></td></tr></table></figure><p>首先我们导入了一堆东西，大多数是浅显易懂的。 <code>werkzeug.secure_filename()</code> 会在稍后解释。 <code>UPLOAD_FOLDER</code> 是上传文 件要储存的目录， <code>ALLOWED_EXTENSIONS</code> 是允许上传的文件扩展名的集合。</p><p>下一个函数检查扩展名是否合法，上传文件，把用户重定向到已上传文件的 URL:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">allowed_file</span>(<span class="params">filename</span>):</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;.&#x27;</span> <span class="keyword">in</span> filename <span class="keyword">and</span> \</span><br><span class="line">           filename.rsplit(<span class="string">&#x27;.&#x27;</span>, <span class="number">1</span>)[<span class="number">1</span>].lower() <span class="keyword">in</span> ALLOWED_EXTENSIONS</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">upload_file</span>():</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        <span class="comment"># check if the post request has the file part</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;file&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> request.files:</span><br><span class="line">            flash(<span class="string">&#x27;No file part&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span> redirect(request.url)</span><br><span class="line">        file = request.files[<span class="string">&#x27;file&#x27;</span>]</span><br><span class="line">        <span class="comment"># if user does not select file, browser also</span></span><br><span class="line">        <span class="comment"># submit an empty part without filename</span></span><br><span class="line">        <span class="keyword">if</span> file.filename == <span class="string">&#x27;&#x27;</span>:</span><br><span class="line">            flash(<span class="string">&#x27;No selected file&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span> redirect(request.url)</span><br><span class="line">        <span class="keyword">if</span> file <span class="keyword">and</span> allowed_file(file.filename):</span><br><span class="line">            filename = secure_filename(file.filename)</span><br><span class="line">            file.save(os.path.join(app.config[<span class="string">&#x27;UPLOAD_FOLDER&#x27;</span>], filename))</span><br><span class="line">            <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;uploaded_file&#x27;</span>,</span><br><span class="line">                                    filename=filename))</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    &lt;!doctype html&gt;</span></span><br><span class="line"><span class="string">    &lt;title&gt;Upload new File&lt;/title&gt;</span></span><br><span class="line"><span class="string">    &lt;h1&gt;Upload new File&lt;/h1&gt;</span></span><br><span class="line"><span class="string">    &lt;form method=post enctype=multipart/form-data&gt;</span></span><br><span class="line"><span class="string">      &lt;input type=file name=file&gt;</span></span><br><span class="line"><span class="string">      &lt;input type=submit value=Upload&gt;</span></span><br><span class="line"><span class="string">    &lt;/form&gt;</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><p>那么 <a href="https://werkzeug.palletsprojects.com/en/0.15.x/utils/#werkzeug.utils.secure_filename"><code>secure_filename()</code></a> 函数到底是有什么用？有一条原 则是“永远不要信任用户输入”。这条原则同样适用于已上传文件的文件名。所有提 交的表单数据可能是伪造的，文件名也可以是危险的。此时要谨记：在把文件保存到 文件系统之前总是要使用这个函数对文件名进行安检。</p><h2 id="cookies"><a href="#cookies" class="headerlink" title="cookies"></a>cookies</h2><p>要访问 cookies ，可以使用 <a href="https://flask.net.cn/api.html#flask.Request.cookies"><code>cookies</code></a> 属性。可以使用响应 对象 的 <a href="https://flask.net.cn/api.html#flask.Response.set_cookie"><code>set_cookie</code></a> 方法来设置 cookies 。请求对象的 <a href="https://flask.net.cn/api.html#flask.Request.cookies"><code>cookies</code></a> 属性是一个包含了客户端传输的所有 cookies 的字典。在 Flask 中，如果使用 <a href="https://flask.net.cn/quickstart.html#sessions">会话</a> ，那么就不要直接使用 cookies ，因为 <a href="https://flask.net.cn/quickstart.html#sessions">会话</a> 比较安全一些。</p><p>读取 cookies:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> request</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>():</span></span><br><span class="line">    username = request.cookies.get(<span class="string">&#x27;username&#x27;</span>)</span><br><span class="line">    <span class="comment"># use cookies.get(key) instead of cookies[key] to not get a</span></span><br><span class="line">    <span class="comment"># KeyError if the cookie is missing.</span></span><br></pre></td></tr></table></figure><h2 id="重定向"><a href="#重定向" class="headerlink" title="重定向"></a>重定向</h2><p>使用 <a href="https://flask.net.cn/api.html#flask.redirect"><code>redirect()</code></a> 函数可以重定向。使用 <a href="https://flask.net.cn/api.html#flask.abort"><code>abort()</code></a> 可以 更早退出请求，并返回错误代码:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> abort, redirect, url_for</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>():</span></span><br><span class="line">    <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;login&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/login&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span>():</span></span><br><span class="line">    abort(<span class="number">401</span>)</span><br><span class="line">    this_is_never_executed()</span><br></pre></td></tr></table></figure><p>上例实际上是没有意义的，它让一个用户从索引页重定向到一个无法访问的页面（401 表示禁止访问）。但是上例可以说明重定向和出错跳出是如何工作的。</p><p>缺省情况下每种出错代码都会对应显示一个黑白的出错页面。使用 <a href="https://flask.net.cn/api.html#flask.Flask.errorhandler"><code>errorhandler()</code></a> 装饰器可以定制出错页面:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> render_template</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.errorhandler(<span class="params"><span class="number">404</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">page_not_found</span>(<span class="params">error</span>):</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;page_not_found.html&#x27;</span>), <span class="number">404</span></span><br></pre></td></tr></table></figure><p>注意 <a href="https://flask.net.cn/api.html#flask.render_template"><code>render_template()</code></a> 后面的 <code>404</code> ，这表示页面对就的出错 代码是 404 ，即页面不存在。缺省情况下 200 表示：一切正常</p><h2 id="响应"><a href="#响应" class="headerlink" title="响应"></a>响应</h2><p>一个视图函数的返回值会被自动转换为一个响应对象。如果返回值是一个字符串，它被转换成一个响应主体是该字符串，错误代码为 <code>200 OK</code> ，媒体类型为<code>text/html</code>的响应对象。Flask 把返回值转换成响应对象的逻辑如下：</p><ol><li>如果返回的是一个合法的响应对象，它会直接从视图返回。</li><li>如果返回的是一个字符串，响应对象会用字符串数据和默认参数创建。</li><li>如果返回的是一个元组而且元组中元素能够提供额外的信息。这样的元组必须是(<code>response, status, headers</code>) 形式且至少含有其中的一个元素。<code>status</code>值将会覆盖状态代码，<code>headers</code>可以是一个列表或额外的消息头值字典。</li><li>如果上述条件均不满足，Flask 会假设返回值是一个合法的 WSGI 应用程序，并转换为一个请求对象</li></ol><h2 id="会话"><a href="#会话" class="headerlink" title="会话"></a>会话</h2><p>除了请求对象之外还有一种称为 <a href="https://flask.net.cn/api.html#flask.session"><code>session</code></a> 的对象，允许你在不同请求 之间储存信息。这个对象相当于用密钥签名加密的 cookie ，即用户可以查看你的 cookie ，但是如果没有密钥就无法修改它。</p><p>使用会话之前你必须设置一个密钥。举例说明:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, session, redirect, url_for, escape, request</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Set the secret key to some random bytes. Keep this really secret!</span></span><br><span class="line">app.secret_key = <span class="string">b&#x27;_5#y2L&quot;F4Q8z\n\xec]/&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>():</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;username&#x27;</span> <span class="keyword">in</span> session:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;Logged in as %s&#x27;</span> % escape(session[<span class="string">&#x27;username&#x27;</span>])</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;You are not logged in&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/login&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span>():</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        session[<span class="string">&#x27;username&#x27;</span>] = request.form[<span class="string">&#x27;username&#x27;</span>]</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;index&#x27;</span>))</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        &lt;form method=&quot;post&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;p&gt;&lt;input type=text name=username&gt;</span></span><br><span class="line"><span class="string">            &lt;p&gt;&lt;input type=submit value=Login&gt;</span></span><br><span class="line"><span class="string">        &lt;/form&gt;</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/logout&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">logout</span>():</span></span><br><span class="line">    <span class="comment"># remove the username from the session if it&#x27;s there</span></span><br><span class="line">    session.pop(<span class="string">&#x27;username&#x27;</span>, <span class="literal">None</span>)</span><br><span class="line">    <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;index&#x27;</span>))</span><br></pre></td></tr></table></figure><p>这里用到的 <a href="https://flask.net.cn/api.html#flask.escape"><code>escape()</code></a> 是用来转义的。如果不使用模板引擎就可以像上例 一样使用这个函数来转义</p><h2 id="消息闪烁"><a href="#消息闪烁" class="headerlink" title="消息闪烁"></a>消息闪烁</h2><p>好的应用和用户界面全部是关于反馈。如果用户得不到足够的反馈，他们可能会变得讨厌这个应用。Flask 提供了一个真正的简单的方式来通过消息闪现系统给用户反馈。消息闪现系统基本上使得在请求结束时记录信息并在下一个 （且仅在下一个）请求中访问。通常结合模板布局来显示消息。</p><p>使用<code>flash()</code>方法来闪现一个消息，使用<code>get_flashed_messages()</code>能够获取消息，<code>get_flashed_messages()</code>也能用于模板中。</p><h2 id="日志和整合-WSGI-中间件"><a href="#日志和整合-WSGI-中间件" class="headerlink" title="日志和整合 WSGI 中间件"></a>日志和整合 WSGI 中间件</h2><h3 id="日志"><a href="#日志" class="headerlink" title="日志"></a>日志</h3><p>有时候你会遇到一种情况：理论上来说你处理的数据应该是正确的，然而实际上并不正确。比如你可能有一些客户端代码，代码向服务器发送一个 HTTP 请求，但是显然它是错误的。这可能是由于用户篡改数据，或客户端代码失败。大部分时候针对这一情况返回<code>400 Bad Request</code>就可以了，但是有时候不能这样做，代码必须继续工作。</p><p>你也有可能想要记录一些发生的不正常事情。这时候日志就派上用处。从 Flask 0.3 开始日志记录是预先配置好的</p><h4 id="整合-WSGI-中间件"><a href="#整合-WSGI-中间件" class="headerlink" title="整合 WSGI 中间件"></a>整合 WSGI 中间件</h4><p>如果你想给你的应用添加 WSGI 中间件，你可以封装内部 WSGI 应用。例如如果你想使用 Werkzeug 包中的某个中间件来应付 lighttpd 中的 bugs，你可以这样做:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> werkzeug.contrib.fixers <span class="keyword">import</span> LighttpdCGIRootFix</span><br><span class="line">app.wsgi_app = LighttpdCGIRootFix(app.wsgi_app)</span><br></pre></td></tr></table></figure><h3 id="实践"><a href="#实践" class="headerlink" title="实践"></a>实践</h3><p>包括四个视图函数的编写：主页视图、新建博客视图、登录视图和等初始图以及三个模板文件。最后编写了针对页面进行美化的 style.css 文件。完成后，即可启动项目并执行登录、编写博客等操作</p><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><p><a href="https://flask.net.cn/">Flask 中文网</a></p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      
        <tags>
            
            <tag> flask </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>c++与算法学习</title>
      <link href="2022/07/09/c-%E4%B8%8E%E7%AE%97%E6%B3%95%E5%AD%A6%E4%B9%A0/"/>
      <url>2022/07/09/c-%E4%B8%8E%E7%AE%97%E6%B3%95%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>考研咯,现在复习复习c++写点数据结构和算法题.<br><span id="more"></span></p><h2 id="C-复习"><a href="#C-复习" class="headerlink" title="C++复习"></a>C++复习</h2><p>基本的数组指针字符串结构体控制结构就不说了,主要写写STL.</p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      
        <tags>
            
            <tag> c++ </tag>
            
            <tag> 算法 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>animeGAN</title>
      <link href="2022/06/14/animeGAN/"/>
      <url>2022/06/14/animeGAN/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>acwj_01</title>
      <link href="2022/05/30/acwj-01/"/>
      <url>2022/05/30/acwj-01/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>继续之前的写编译器.<br><span id="more"></span></p><p><a href="https://github.com/DoctorWkt/acwj">教程地址</a></p><p>acwj意思是A Compiler Writing Journey.</p><p>之前写了scan和parser,简单的过了加减乘除的操作.</p><h3 id="操作符优先级"><a href="#操作符优先级" class="headerlink" title="操作符优先级"></a>操作符优先级</h3><p>现在需要定一下操作符优先级.有两种办法,都是递归下降方法</p><ol><li><p>在语言语法中明确运算符优先级 </p></li><li><p>使用运算符优先级表影响现有解析器</p></li></ol><p>这里采用改变语法的方法</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">expression: additive<span class="built_in">_</span>expression</span><br><span class="line">    ;</span><br><span class="line"></span><br><span class="line">additive<span class="built_in">_</span>expression:</span><br><span class="line">      multiplicative<span class="built_in">_</span>expression</span><br><span class="line">    | additive<span class="built_in">_</span>expression &#x27;+&#x27; multiplicative<span class="built_in">_</span>expression</span><br><span class="line">    | additive<span class="built_in">_</span>expression &#x27;-&#x27; multiplicative<span class="built_in">_</span>expression</span><br><span class="line">    ;</span><br><span class="line"></span><br><span class="line">multiplicative<span class="built_in">_</span>expression:</span><br><span class="line">      number</span><br><span class="line">    | number &#x27;*&#x27; multiplicative<span class="built_in">_</span>expression</span><br><span class="line">    | number &#x27;/&#x27; multiplicative<span class="built_in">_</span>expression</span><br><span class="line">    ;</span><br><span class="line"></span><br><span class="line">number:  T<span class="built_in">_</span>INTLIT</span><br><span class="line">         ;</span><br></pre></td></tr></table></figure><p>可以看到先进行乘再进行加.</p><p>在代码中,定义乘除函数与加减函数.</p><p>加减法优先级较低,所以在加减函数中需要调用乘除函数.而乘除函数自然需要调用primary,这里就是取字面量的意思.</p><p>乘除函数核心代码.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">left = primary(); <span class="comment">//取值 primary中也有scan.</span></span><br><span class="line"></span><br><span class="line">  tokentype = Token.token; <span class="comment">//更新tokentype</span></span><br><span class="line">  <span class="keyword">if</span> (tokentype == _EOF) <span class="comment">//若读到末尾则直接返回.</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">return</span> left;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// * /</span></span><br><span class="line"><span class="comment">//如果有乘除号 进入循环</span></span><br><span class="line">  <span class="keyword">while</span> (tokentype == STAR || tokentype == SLASH)</span><br><span class="line">  &#123;</span><br><span class="line">      <span class="comment">//继续得到右边的值</span></span><br><span class="line">    scan(&amp;Token);</span><br><span class="line">      </span><br><span class="line">    right = primary(); <span class="comment">//获取intlitnode,right是一个leaf node.</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// e.g  * 2 6</span></span><br><span class="line">    left = mkastnode(tok2aop(tokentype), left, right, <span class="number">0</span>); <span class="comment">//e.g * 2 5</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Update the details of the current token.</span></span><br><span class="line">    <span class="comment">// If no tokens left, return just the left node</span></span><br><span class="line">    tokentype = Token.token; <span class="comment">//更新</span></span><br><span class="line">    <span class="keyword">if</span> (tokentype == _EOF)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125; <span class="comment">//看是否读到文件末尾 否则继续读 直到不是乘除号</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> left;</span><br></pre></td></tr></table></figure><p>加减函数</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">left = multiplicative_expr(); <span class="comment">//首先需要调用乘除 优先级问题</span></span><br><span class="line">  tokentype = Token.token;</span><br><span class="line">  <span class="keyword">if</span>(tokentype == _EOF)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">return</span> left;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="comment">//同上</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> (<span class="number">1</span>) <span class="comment">//进入循环</span></span><br><span class="line">  &#123;</span><br><span class="line">    scan(&amp;Token);</span><br><span class="line"></span><br><span class="line">    right = multiplicative_expr();  <span class="comment">//同理 先调用乘除</span></span><br><span class="line"></span><br><span class="line">    left = mkastnode(tok2aop(tokentype),left,right,<span class="number">0</span>); <span class="comment">// left = left + right</span></span><br><span class="line">    tokentype = Token.token;</span><br><span class="line">    <span class="keyword">if</span>(tokentype == _EOF)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;  </span><br><span class="line">  <span class="keyword">return</span> left;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>这种方法缺点是需要为每种运算设置谁优先级高,比较麻烦.</p><p>还可以用Pratt Parsing.</p><p>也就是为每一种操作符设置一个优先级值.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">left = primary();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// If no tokens left, return just the left node</span></span><br><span class="line">  tokentype = Token.token;</span><br><span class="line">  <span class="keyword">if</span> (tokentype == T_EOF)</span><br><span class="line">    <span class="keyword">return</span> (left);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// While the precedence of this token is</span></span><br><span class="line">  <span class="comment">// more than that of the previous token precedence</span></span><br><span class="line">  <span class="keyword">while</span> (op_precedence(tokentype) &gt; ptp) &#123;</span><br><span class="line">    <span class="comment">// Fetch in the next integer literal</span></span><br><span class="line">    scan(&amp;Token);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Recursively call binexpr() with the</span></span><br><span class="line">    <span class="comment">// precedence of our token to build a sub-tree</span></span><br><span class="line">    right = binexpr(OpPrec[tokentype]);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Join that sub-tree with ours. Convert the token</span></span><br><span class="line">    <span class="comment">// into an AST operation at the same time.</span></span><br><span class="line">    left = mkastnode(arithop(tokentype), left, right, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Update the details of the current token.</span></span><br><span class="line">    <span class="comment">// If no tokens left, return just the left node</span></span><br><span class="line">    tokentype = Token.token;</span><br><span class="line">    <span class="keyword">if</span> (tokentype == T_EOF)</span><br><span class="line">      <span class="keyword">return</span> (left);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Return the tree we have when the precedence</span></span><br><span class="line">  <span class="comment">// is the same or lower</span></span><br><span class="line">  <span class="keyword">return</span> (left);</span><br></pre></td></tr></table></figure><h3 id="生成汇编"><a href="#生成汇编" class="headerlink" title="生成汇编"></a>生成汇编</h3><p>尝试生成汇编代码.</p><p>生成汇编也是遍历AST.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">generatecode</span><span class="params">(struct ASTnode *n)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> reg;</span><br><span class="line"></span><br><span class="line">  cgpreamble();</span><br><span class="line">  reg= genAST(n);</span><br><span class="line">  cgprintint(reg);      <span class="comment">// Print the register with the result as an int</span></span><br><span class="line">  cgpostamble();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>pre和post是汇编进出main的一般语句.同时为了打印寄存器的值使用了printint函数也在汇编pre中声明了.</p><p>另外有free,allocate寄存器。先free使寄存器值为1,再allocate使用,由置为0.allocate后又能free.</p><p>当然还有一些运算的汇编代码,比如</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">cgmul</span><span class="params">(<span class="keyword">int</span> r1,<span class="keyword">int</span> r2)</span> </span>&#123;</span><br><span class="line">  <span class="built_in">fprintf</span>(Outfile,<span class="string">&quot;\timulq\t%s,%s\n&quot;</span>,reglist[r1],reglist[r2]);</span><br><span class="line">  free_reg(r1);</span><br><span class="line">  <span class="keyword">return</span> r2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>减法,除法需要注意顺序.</p><p>注意除法相对麻烦</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">fprintf</span>(Outfile, <span class="string">&quot;\tmovq\t%s,%%rax\n&quot;</span>, reglist[r1]);</span><br><span class="line">  <span class="built_in">fprintf</span>(Outfile, <span class="string">&quot;\tcqo\n&quot;</span>);</span><br><span class="line">  <span class="built_in">fprintf</span>(Outfile, <span class="string">&quot;\tidivq\t%s\n&quot;</span>, reglist[r2]);</span><br><span class="line">  <span class="built_in">fprintf</span>(Outfile, <span class="string">&quot;\tmovq\t%%rax,%s\n&quot;</span>, reglist[r1]);</span><br></pre></td></tr></table></figure><blockquote><p>Division is also not commutative, so the previous notes apply. On the x86-64, it’s even more complicated. We need to load <code>%rax</code> with the <em>dividend</em> from <code>r1</code>. This needs to be extended to eight bytes with <code>cqo</code>. Then, <code>idivq</code> will divide <code>%rax</code> with the divisor in <code>r2</code>, leaving the <em>quotient</em> in <code>%rax</code>, so we need to copy it out to either <code>r1</code> or <code>r2</code>. Then we can free the other register.</p></blockquote><h3 id="增加一些语句"><a href="#增加一些语句" class="headerlink" title="增加一些语句"></a>增加一些语句</h3><p>之前词法语法分析都是一些运算符,现在增加一些Statement.</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">statements: statement</span><br><span class="line">     | statement statements</span><br><span class="line">     ;</span><br><span class="line"></span><br><span class="line">statement: &#x27;print&#x27; expression &#x27;;&#x27;</span><br><span class="line">     ;</span><br></pre></td></tr></table></figure><p>先只有print语句</p><blockquote><p>An input file consists of several statements. They are either one statement, or a statement followed by more statements. Each statement starts with the keyword <code>print</code>, then one expression, then a semicolon.</p></blockquote><p>statement语句是print后接binexpr再有一个分号</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ASTnode</span> *<span class="title">tree</span>;</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">int</span> reg;</span><br><span class="line">  <span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// match print</span></span><br><span class="line">    match(PRINT, <span class="string">&quot;print&quot;</span>);</span><br><span class="line"></span><br><span class="line">    tree = binexpr(<span class="number">0</span>);  <span class="comment">// expr ast</span></span><br><span class="line">    reg = genAST(tree); <span class="comment">// return reg num</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// print value</span></span><br><span class="line">    genprintint(reg);</span><br><span class="line">    genfreeregs();</span><br><span class="line"></span><br><span class="line">    semi();</span><br><span class="line">    <span class="comment">// 之前卡在这 因为 == 写成了 = :(</span></span><br><span class="line">    <span class="comment">// 判断到达文件尾 </span></span><br><span class="line">    <span class="keyword">if</span> (Token.token == _EOF)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>之前写了binexpr,根据这个生成AST再遍历得到值.</p><p>此外还要判定identifier,以字母或_开头</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="built_in">isalpha</span>(c) || <span class="string">&#x27;_&#x27;</span> == c)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">// read ident</span></span><br><span class="line">      scanident(c, Text, TEXTLEN);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// ! focus,it&#x27;s =</span></span><br><span class="line">      <span class="keyword">if</span> (tokentype = keyword(Text))</span><br><span class="line">      &#123;</span><br><span class="line">        t-&gt;token = tokentype;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// if this is not keyword</span></span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;Unrecognised symbol %s on line %d\n&quot;</span>, Text, Line);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>如果是关键字,设置toke类型.</p><p>此外还要设置匹配关键字</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 匹配</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">match</span><span class="params">(<span class="keyword">int</span> t, <span class="keyword">char</span> *what)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (Token.token == t)</span><br><span class="line">  &#123;</span><br><span class="line">    scan(&amp;Token);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%s expected on line %d\n&quot;</span>, what, Line);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>*what是需要匹配的关键字,t是token的类型,比如PRINT.</p><p>当匹配成功继续读入下一个字符.</p><p>读入ident</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> (<span class="built_in">isalpha</span>(c) || <span class="built_in">isdigit</span>(c) || <span class="string">&#x27;_&#x27;</span> == c)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// Error if we hit the identifier length limit,</span></span><br><span class="line">    <span class="comment">// else append to buf[] and get next character</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// lim is the identifier max length that we defined</span></span><br><span class="line">    <span class="keyword">if</span> (lim - <span class="number">1</span> == i)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;identifier too long on line %d\n&quot;</span>, Line);</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (i &lt; lim - <span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">      buf[i++] = c;</span><br><span class="line">    &#125;</span><br><span class="line">    c = next();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// c is not included in this ident so we trace back</span></span><br><span class="line">  putback(c);</span><br><span class="line">  buf[i] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">  <span class="keyword">return</span> i;</span><br></pre></td></tr></table></figure><p>当匹配首字符后,读入ident,限定ident大小.同时当读入的token不满足条件时跳出,并将其putback.方便下次读入.</p><p>同时在expr中改为遇到分号就结束,而不是文件尾.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">left = primary();</span><br><span class="line"></span><br><span class="line"> tokentype = Token.token;</span><br><span class="line"> <span class="keyword">if</span> (tokentype == SEMI)</span><br><span class="line"> &#123;</span><br><span class="line">   <span class="keyword">return</span> left;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="comment">// While the precedence of this token is</span></span><br><span class="line"> <span class="comment">// more than that of the previous token precedence</span></span><br><span class="line"> <span class="keyword">while</span> (op_precedence(tokentype) &gt; ptp)</span><br><span class="line"> &#123;</span><br><span class="line">   scan(&amp;Token);</span><br><span class="line"></span><br><span class="line">   right = binexpr(OpPrec[tokentype]);</span><br><span class="line"></span><br><span class="line">   left = mkastnode(tok2aop(tokentype), left, right, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">   <span class="comment">// Update the details of the current token.</span></span><br><span class="line">   <span class="comment">// If no tokens left, return just the left node</span></span><br><span class="line">   tokentype = Token.token;</span><br><span class="line">   <span class="keyword">if</span> (tokentype == SEMI)</span><br><span class="line">     <span class="keyword">return</span> (left);</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">return</span> left;</span><br></pre></td></tr></table></figure><h3 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h3><p>我们需要</p><ul><li>Declare variables</li><li>Use variables to get stored values</li><li>Assign to variables</li></ul><p>需要一个全局变量表</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Symbol table structure</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">symtable</span> &#123;</span></span><br><span class="line">  <span class="keyword">char</span> *name;                   <span class="comment">// Name of a symbol</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>变量表</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> NSYMBOLS        1024            <span class="comment">// Number of symbol table entries 最多几个变量</span></span></span><br><span class="line">extern_ <span class="class"><span class="keyword">struct</span> <span class="title">symtable</span> <span class="title">Gsym</span>[<span class="title">NSYMBOLS</span>];</span> <span class="comment">// Global symbol table 变量表</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">int</span> Globs = <span class="number">0</span>;                   <span class="comment">// Position of next free global symbol slot 变量在变量表中位置</span></span><br></pre></td></tr></table></figure><blockquote><ul><li><code>int findglob(char *s)</code>: Determine if the symbol s is in the global symbol table. Return its slot position or -1 if not found.</li><li><code>static int newglob(void)</code>: Get the position of a new global symbol slot, or die if we’ve run out of positions.</li><li><code>int addglob(char *name)</code>: Add a global symbol to the symbol table. Return the slot number in the symbol table</li></ul></blockquote><p>同时需要新的语法</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">statements: statement</span><br><span class="line">     |      statement statements</span><br><span class="line">     ;</span><br><span class="line"></span><br><span class="line">statement: &#x27;print&#x27; expression &#x27;;&#x27;</span><br><span class="line">     |     &#x27;int&#x27;   identifier &#x27;;&#x27;</span><br><span class="line">     |     identifier &#x27;=&#x27; expression &#x27;;&#x27;</span><br><span class="line">     ;</span><br><span class="line"></span><br><span class="line">identifier: T<span class="built_in">_</span>IDENT</span><br><span class="line">     ;</span><br></pre></td></tr></table></figure><p>statementes需要更改</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Parse one or more statements</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">statements</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">switch</span> (Token.token) &#123;</span><br><span class="line">    <span class="keyword">case</span> T_PRINT:</span><br><span class="line">      print_statement();</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> T_INT:</span><br><span class="line">      var_declaration();</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> T_IDENT:</span><br><span class="line">      assignment_statement();</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> T_EOF:</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      fatald(<span class="string">&quot;Syntax error, token&quot;</span>, Token.token);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>we will make the expression the left sub-tree of the A_ASSIGN node and save the A_LVIDENT details in the right sub-tree. Why? Because we need to evaluate the expression <em>before</em> we save it into the variable.</p><p>Note that we evaluate the left-hand AST child first, and we get back a register number that holds the left-hand sub-tree’s value. We now pass this register number to the right-hand sub-tree. We need to do this for A_LVIDENT nodes, so that the <code>cgstorglob()</code> function in <code>cg.c</code> knows which register holds the rvalue result of the assignment expression.</p></blockquote><p>这里左右是反的,由于我们是先序遍历AST,但又需要先计算右值,所以在赋值语句中,先读入identifier,创建LVIDENT节点赋值给rightreg,然后为leftreg创建expr,最后生成赋值节点.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// identifier &#x27;=&#x27; expression &#x27;;&#x27;</span></span><br><span class="line"> <span class="class"><span class="keyword">struct</span> <span class="title">ASTnode</span> *<span class="title">left</span>, *<span class="title">right</span>, *<span class="title">tree</span>;</span></span><br><span class="line"></span><br><span class="line"> <span class="comment">// pos of reg</span></span><br><span class="line"> <span class="keyword">int</span> id;</span><br><span class="line"></span><br><span class="line"> ident();</span><br><span class="line"></span><br><span class="line"> <span class="keyword">if</span> ((id = findglob(Text)) == <span class="number">-1</span>)</span><br><span class="line"> &#123;</span><br><span class="line">   fatals(<span class="string">&quot;Undeclared variable&quot;</span>, Text);</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> right = mkastleaf(A_LVIDENT, id);</span><br><span class="line"></span><br><span class="line"> match(EQUAL, <span class="string">&quot;=&quot;</span>);</span><br><span class="line"></span><br><span class="line"> <span class="comment">// Parse the following expression</span></span><br><span class="line"> left = binexpr(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"> <span class="comment">// Make an assignment AST tree</span></span><br><span class="line"> tree = mkastnode(A_ASSIGN, left, right, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"> <span class="comment">// Generate the assembly code for the assignment</span></span><br><span class="line"> genAST(tree, <span class="number">-1</span>);</span><br><span class="line"> genfreeregs();</span><br><span class="line"></span><br><span class="line"> semi();</span><br></pre></td></tr></table></figure><blockquote><p>Also note that the AST leaf node that <em>retrieves</em> a variable’s value is an A_IDENT node. The leaf that saves into a variable is an A_LVIDENT node. This is the difference between <em>rvalues</em> and <em>lvalues</em>.</p></blockquote><h3 id="比较符"><a href="#比较符" class="headerlink" title="比较符"></a>比较符</h3><p>增加词法分析,增加genAST操作.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> A_EQ:</span><br><span class="line">    <span class="keyword">return</span> cgequal(leftreg,rightreg);</span><br><span class="line">  <span class="keyword">case</span> A_NE:</span><br><span class="line">    <span class="keyword">return</span> cgnotequal(leftreg,rightreg);</span><br><span class="line">  <span class="keyword">case</span> A_LT:</span><br><span class="line">    <span class="keyword">return</span> cglessthan(leftreg,rightreg);</span><br><span class="line">  <span class="keyword">case</span> A_GT:</span><br><span class="line">    <span class="keyword">return</span> cggreaterthan(leftreg,rightreg);</span><br><span class="line">  <span class="keyword">case</span> A_LE:</span><br><span class="line">    <span class="keyword">return</span> cglessequal(leftreg,rightreg);</span><br><span class="line">  <span class="keyword">case</span> A_GE:</span><br><span class="line">    <span class="keyword">return</span> cggreaterequal(leftreg,rightreg);</span><br><span class="line">  <span class="keyword">default</span>:</span><br><span class="line">    fatald(<span class="string">&quot;Unknown AST operator&quot;</span>,n-&gt;op);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>遇到的问题</p><blockquote><p>There are six x86-64 instructions which set a register to 1 or 0 based on the two flag values: <code>sete</code>, <code>setne</code>, <code>setg</code>, <code>setl</code>, <code>setge</code> and <code>setle</code> in the order of the above table rows.</p><p>The problem is, these instructions only set the lowest byte of a register. If the register already has bits set outside of the lowest byte, they will stay set. So we might set a variable to 1, but if it already has the value 1000 (decimal), then it will now be 1001 which is not what we want.</p></blockquote><p>The solution is to <code>andq</code> the register after the <code>setX</code> instruction to get rid of the unwanted bits. In <code>cg.c</code> there is a general comparison function to do this:</p><p>核心代码</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">fprintf</span>(Outfile,<span class="string">&quot;\tcmpq\t%s,%s\n&quot;</span>,reglist[r2],reglist[r1]);</span><br><span class="line"><span class="built_in">fprintf</span>(Outfile,<span class="string">&quot;\t%s\t%s\n&quot;</span>,how,breglist[r2]);</span><br><span class="line">  <span class="comment">// 低字节与1相与 全设置为1 因为setx指令只设置低字节 高字节不变,所以需要将高字节清除</span></span><br><span class="line"><span class="built_in">fprintf</span>(Outfile, <span class="string">&quot;\tandq\t$255,%s\n&quot;</span>, reglist[r2]);</span><br><span class="line">  </span><br><span class="line">free_reg(r1);</span><br><span class="line"><span class="keyword">return</span> r2;</span><br></pre></td></tr></table></figure><blockquote><p>Note that we perform</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">cmpq</span> reglist[r<span class="number">2</span>], reglist[r<span class="number">1</span>]</span><br></pre></td></tr></table></figure><p>because this is actually <code>reglist[r1] - reglist[r2]</code> which is what we really want.</p></blockquote><h3 id="if语句"><a href="#if语句" class="headerlink" title="if语句"></a>if语句</h3><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">if (condition is true) </span><br><span class="line">    perform this first block of code</span><br><span class="line">  else</span><br><span class="line">    perform this other block of code</span><br></pre></td></tr></table></figure><p>使用比较运算符</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">       perform the opposite comparison</span><br><span class="line">       jump to L1 if true</span><br><span class="line">       perform the first block of code</span><br><span class="line">       jump to L2</span><br><span class="line">L1:</span><br><span class="line">       perform the other block of code</span><br><span class="line">L2:</span><br></pre></td></tr></table></figure><p>举一个例子</p><p>Right now, we output code to set a register based on a comparison, e.g.</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">int</span> x; x= <span class="number">7</span> &lt; <span class="number">9</span>;         From input<span class="number">04</span></span><br></pre></td></tr></table></figure><p>becomes</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">movq</span>    $<span class="number">7</span>, %r<span class="number">8</span></span><br><span class="line"><span class="attribute">movq</span>    $<span class="number">9</span>, %r<span class="number">9</span></span><br><span class="line"><span class="attribute">cmpq</span>    %r<span class="number">9</span>, %r<span class="number">8</span></span><br><span class="line"><span class="attribute">setl</span>    %r<span class="number">9</span>b        Set if less than </span><br><span class="line"><span class="attribute">andq</span>    $<span class="number">255</span>,%r<span class="number">9</span></span><br></pre></td></tr></table></figure><p>But for an IF statement, we need to jump on the opposite comparison:</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">if</span> (<span class="number">7</span> &lt; <span class="number">9</span>) </span><br></pre></td></tr></table></figure><p>should become:</p><figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">        movq    <span class="variable">$7</span>, <span class="meta">%r8</span></span><br><span class="line">        movq    <span class="variable">$9</span>, <span class="meta">%r9</span></span><br><span class="line">        cmpq    <span class="meta">%r9</span>, <span class="meta">%r8</span></span><br><span class="line">        jge     L1         Jump <span class="keyword">if</span> greater <span class="keyword">then</span> <span class="keyword">or</span> equal <span class="keyword">to</span></span><br><span class="line">        ....</span><br><span class="line">L1:</span><br></pre></td></tr></table></figure><p>文法</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">compound<span class="built_in">_</span>statement: &#x27;&#123;&#x27; &#x27;&#125;&#x27;          // empty, i.e. no statement</span><br><span class="line">     |      &#x27;&#123;&#x27; statement &#x27;&#125;&#x27;</span><br><span class="line">     |      &#x27;&#123;&#x27; statement statements &#x27;&#125;&#x27;</span><br><span class="line">     ;</span><br><span class="line"></span><br><span class="line">statement: print<span class="built_in">_</span>statement</span><br><span class="line">     |     declaration</span><br><span class="line">     |     assignment<span class="built_in">_</span>statement</span><br><span class="line">     |     if<span class="built_in">_</span>statement</span><br><span class="line">     ;</span><br><span class="line"></span><br><span class="line">print<span class="built_in">_</span>statement: &#x27;print&#x27; expression &#x27;;&#x27;  ;</span><br><span class="line"></span><br><span class="line">declaration: &#x27;int&#x27; identifier &#x27;;&#x27;  ;</span><br><span class="line"></span><br><span class="line">assignment<span class="built_in">_</span>statement: identifier &#x27;=&#x27; expression &#x27;;&#x27;   ;</span><br><span class="line"></span><br><span class="line">if<span class="built_in">_</span>statement: if<span class="built_in">_</span>head</span><br><span class="line">     |        if<span class="built_in">_</span>head &#x27;else&#x27; compound<span class="built_in">_</span>statement</span><br><span class="line">     ;</span><br><span class="line"></span><br><span class="line">if<span class="built_in">_</span>head: &#x27;if&#x27; &#x27;(&#x27; true<span class="built_in">_</span>false<span class="built_in">_</span>expression &#x27;)&#x27; compound<span class="built_in">_</span>statement  ;</span><br><span class="line"></span><br><span class="line">identifier: T<span class="built_in">_</span>IDENT ;</span><br></pre></td></tr></table></figure><blockquote><p>Note the grammar for the IF statement: it’s either an <code>if_head</code> (with no ‘else’ clause), or an <code>if_head</code> followed by a ‘else’ and a <code>compound_statement</code>.</p></blockquote><p>解决悬挂else问题</p><p>if ast 修改ast结构以适应if</p><ul><li>the sub-tree that evaluates the condition</li><li>the compound statement immediately following</li><li>the optional compound statement after the ‘else’ keyword</li></ul><p><img data-src="http://cdn.sekyoro.top/imgs/if_stme.png" alt="if_stme" style="zoom:67%;" /></p><h3 id="实现while循环"><a href="#实现while循环" class="headerlink" title="实现while循环"></a>实现while循环</h3><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Lstart: evaluate condition</span><br><span class="line">jump to Lend if condition false</span><br><span class="line">statements</span><br><span class="line">jump to Lstart</span><br><span class="line">Lend:</span><br></pre></td></tr></table></figure><p>while的BNF</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">// while<span class="built_in">_</span>statement: &#x27;while&#x27; &#x27;(&#x27; true<span class="built_in">_</span>false<span class="built_in">_</span>expression &#x27;)&#x27; compound<span class="built_in">_</span>statement  ;</span><br></pre></td></tr></table></figure><p>说实话做起来要比if简单些,主要是在if中实现了添加label和跳转的x86汇编.后面直接做词法语法分析就行了.</p><p>词法分析</p><p>while_stmt</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">struct ASTnode *<span class="title">while_stmt</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">ASTnode</span> *<span class="title">condAST</span>, *<span class="title">bodyAST</span>;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// match while(</span></span><br><span class="line">  match(WHILE, <span class="string">&quot;while&quot;</span>);</span><br><span class="line">  lparen();</span><br><span class="line"></span><br><span class="line">  condAST = binexpr(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">if</span> (condAST-&gt;op &lt; A_EQ || condAST-&gt;op &gt; A_GE)</span><br><span class="line">  &#123;</span><br><span class="line">    fatal(<span class="string">&quot;Bad comparison operator&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  rparen();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// get the ast for com_stmt</span></span><br><span class="line">  bodyAST = compound_stmt();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> mkastnode(A_WHILE, condAST, <span class="literal">NULL</span>, bodyAST, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>gen.c</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span>  <span class="title">genWHILE</span><span class="params">(struct ASTnode *n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> Lstart, Lend;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// get label</span></span><br><span class="line">  Lstart = label();</span><br><span class="line">  Lend = label();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// generate label</span></span><br><span class="line">  cglabel(Lstart);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 与if类似 计算n-&gt;left 满足条件跳转</span></span><br><span class="line">  genAST(n-&gt;left, Lend, n-&gt;op);</span><br><span class="line">  genfreeregs();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// compound stmt</span></span><br><span class="line">  genAST(n-&gt;right, NOREG, n-&gt;op);</span><br><span class="line">  genfreeregs();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Finally output the jump back to the condition,</span></span><br><span class="line">  <span class="comment">// and the end label</span></span><br><span class="line">  <span class="comment">// 继续跳回去计算</span></span><br><span class="line">  cgjump(Lstart);</span><br><span class="line"></span><br><span class="line">  cglabel(Lend);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> NOREG;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="for循环"><a href="#for循环" class="headerlink" title="for循环"></a>for循环</h3><p>BNF范式</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">for<span class="built_in">_</span>statement: &#x27;for&#x27; &#x27;(&#x27; preop<span class="built_in">_</span>statement &#x27;;&#x27;</span><br><span class="line">                          true<span class="built_in">_</span>false<span class="built_in">_</span>expression &#x27;;&#x27;</span><br><span class="line">                          postop<span class="built_in">_</span>statement &#x27;)&#x27; compound<span class="built_in">_</span>statement  ;</span><br><span class="line"></span><br><span class="line"> preop<span class="built_in">_</span>statement:  statement  ;        (for now)</span><br><span class="line"> postop<span class="built_in">_</span>statement: statement  ;        (for now)</span><br></pre></td></tr></table></figure><p>遇到的问题</p><blockquote><p>The wrinkle is that the <code>postop_statement</code> is parsed before the <code>compound_statement</code>, but we have to generate the code for the <code>postop_statement</code> <em>after</em> the code for the <code>compound_statement</code>.</p></blockquote><p>解决</p><blockquote><p>There are several ways to solve this problem. When I wrote a previous compiler, I chose to put the <code>compound_statement</code> assembly code in a temporary buffer, and “play back” the buffer once I’d generated the code for the <code>postop_statement</code>. In the SubC compiler, Nils makes clever use of labels and jumps to labels to “thread” the code’s execution to enforce the correct sequence.</p></blockquote><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">preop<span class="built_in">_</span>statement;</span><br><span class="line"> while ( true<span class="built_in">_</span>false<span class="built_in">_</span>expression ) &#123;</span><br><span class="line">   compound<span class="built_in">_</span>statement;</span><br><span class="line">   postop<span class="built_in">_</span>statement;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>ast仍采用三节点</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">    A<span class="built_in">_</span>GLUE</span><br><span class="line">     /     <span class="keyword">\</span></span><br><span class="line"><span class="keyword"></span>preop     A<span class="built_in">_</span>WHILE</span><br><span class="line">          /    <span class="keyword">\</span></span><br><span class="line"><span class="keyword"></span>     decision  A<span class="built_in">_</span>GLUE</span><br><span class="line">               /    <span class="keyword">\</span></span><br><span class="line"><span class="keyword"></span>         compound  postop</span><br></pre></td></tr></table></figure><blockquote><p>For the FOR grammar, I only want a single statement as the <code>preop_statement</code> and the <code>postop_statement</code>. Right now, we have a <code>compound_statement()</code> function that simply loops until it hits a right curly bracket ‘}’. We need to separate this out so <code>compound_statement()</code> calls <code>single_statement()</code> to get one statement</p></blockquote><p>需要写一个single_stmt()</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> struct ASTnode *<span class="title">single_stmt</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">switch</span> (Token.token)</span><br><span class="line">  &#123;</span><br><span class="line">  <span class="keyword">case</span> PRINT:</span><br><span class="line">    <span class="keyword">return</span> print_stmt();</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  <span class="keyword">case</span> INT:</span><br><span class="line">    int_decl();</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">  <span class="keyword">case</span> IDENT:</span><br><span class="line">    <span class="keyword">return</span> assign_stmt();</span><br><span class="line">  <span class="keyword">case</span> IF:</span><br><span class="line">    <span class="keyword">return</span> if_stmt();</span><br><span class="line">  <span class="keyword">case</span> WHILE:</span><br><span class="line">    <span class="keyword">return</span> while_stmt();</span><br><span class="line">  <span class="keyword">case</span> FOR:</span><br><span class="line">    <span class="keyword">return</span> for_stmt();</span><br><span class="line">  <span class="keyword">default</span>:</span><br><span class="line">    fatald(<span class="string">&quot;Syntax error, token&quot;</span>, Token.token);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这个不需要;</p><p>将assign和print语句的分号需求也去掉.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">struct ASTnode *<span class="title">compound_stmt</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">ASTnode</span> *<span class="title">left</span> =</span> <span class="literal">NULL</span>;</span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">ASTnode</span> *<span class="title">tree</span>;</span></span><br><span class="line">  <span class="comment">// match &#123;</span></span><br><span class="line">  lbrace();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">  &#123;</span><br><span class="line"></span><br><span class="line">    tree = single_stmt();</span><br><span class="line">    <span class="comment">// assign,print need simicon</span></span><br><span class="line">    <span class="keyword">if</span> (tree != <span class="literal">NULL</span> &amp;&amp; (tree-&gt;op == A_PRINT || tree-&gt;op == A_ASSIGN))</span><br><span class="line">    &#123;</span><br><span class="line">      semi();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// For each new tree, either save it in left</span></span><br><span class="line">    <span class="comment">// if left is empty, or glue the left and the</span></span><br><span class="line">    <span class="comment">// new tree together</span></span><br><span class="line">    <span class="keyword">if</span> (tree != <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> (left == <span class="literal">NULL</span>)</span><br><span class="line">      &#123;</span><br><span class="line">        left = tree;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">        left = mkastnode(A_GLUE, left, <span class="literal">NULL</span>, tree, <span class="number">0</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line">    <span class="keyword">if</span> (Token.token == RBRACE)</span><br><span class="line">    &#123;</span><br><span class="line">      rbrace();</span><br><span class="line">      <span class="keyword">return</span> left;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在复合语句中对print和赋值语句的分号做要求.</p><blockquote><p>What we need is for the single statement parser <em>not</em> to scan in the semicolon, but to leave that up to the compound statement parser. And we scan in semicolons for some statements (e.g. between assignment statements) and not for other statements (e.g. not between successive IF statements).</p></blockquote><p>在生成ast时注意顺序</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Glue the compound statement and the postop tree</span></span><br><span class="line">tree= mkastnode(A_GLUE, bodyAST, <span class="literal">NULL</span>, postopAST, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Make a WHILE loop with the condition and this new body</span></span><br><span class="line">tree= mkastnode(A_WHILE, condAST, <span class="literal">NULL</span>, tree, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// And glue the preop tree to the A_WHILE tree</span></span><br><span class="line"><span class="keyword">return</span>(mkastnode(A_GLUE, preopAST, <span class="literal">NULL</span>, tree, <span class="number">0</span>));</span><br></pre></td></tr></table></figure><h3 id="实现函数"><a href="#实现函数" class="headerlink" title="实现函数"></a>实现函数</h3><p>需要处理的部分</p><ul><li>Types of data: <code>char</code>, <code>int</code>, <code>long</code> etc.</li><li>The return type of each function</li><li>The number of arguments to each function</li><li>Variables local to a function versus global variables</li></ul><p>首先是简单部分</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">function<span class="built_in">_</span>declaration: &#x27;void&#x27; identifier &#x27;(&#x27; &#x27;)&#x27; compound<span class="built_in">_</span>statement   ;</span><br></pre></td></tr></table></figure><p>即函数声明,与变量声明类似.</p><p>需要将函数名加入globsym.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">match(T_VOID, <span class="string">&quot;void&quot;</span>);</span><br><span class="line">ident();</span><br><span class="line">nameslot= addglob(Text);</span><br><span class="line">lparen();</span><br><span class="line">rparen();</span><br><span class="line"></span><br><span class="line"><span class="comment">// Get the AST tree for the compound statement</span></span><br><span class="line">tree= compound_statement();</span><br><span class="line"></span><br><span class="line"><span class="comment">// Return an A_FUNCTION node which has the function&#x27;s nameslot</span></span><br><span class="line"><span class="comment">// and the compound statement sub-tree</span></span><br><span class="line"><span class="keyword">return</span>(mkastunary(A_FUNCTION, tree, nameslot));</span><br></pre></td></tr></table></figure><p>在main中修改</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">scan(&amp;Token);                 <span class="comment">// Get the first token from the input</span></span><br><span class="line">genpreamble();                <span class="comment">// Output the preamble</span></span><br><span class="line"><span class="keyword">while</span> (<span class="number">1</span>) &#123;                   <span class="comment">// Parse a function and</span></span><br><span class="line">  tree = function_declaration();</span><br><span class="line">  genAST(tree, NOREG, <span class="number">0</span>);     <span class="comment">// generate the assembly code for it</span></span><br><span class="line">  <span class="keyword">if</span> (Token.token == T_EOF)   <span class="comment">// Stop when we have reached EOF</span></span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>生成汇编</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> A_FUNCTION:</span><br><span class="line">    <span class="comment">// generate code</span></span><br><span class="line">    cgfuncpreamble(Gsym[n-&gt;v.id].name);</span><br><span class="line">    genAST(n-&gt;left, NOREG, n-&gt;op);</span><br><span class="line">    cgfuncpostamble();</span><br><span class="line">    <span class="keyword">return</span> NOREG;</span><br></pre></td></tr></table></figure><h3 id="增加类型"><a href="#增加类型" class="headerlink" title="增加类型"></a>增加类型</h3><p>增加char</p><p>every expression has a type. This includes:</p><ul><li>integer literals, e.g 56 is an <code>int</code></li><li>maths expressions, e.g. 45 - 12 is an <code>int</code></li><li>variables, e.g. if we declared <code>x</code> as a <code>char</code>, then it’s <em>rvalue</em> is a <code>char</code></li></ul><p>增加原型类型</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Primitive types</span></span><br><span class="line"><span class="class"><span class="keyword">enum</span> &#123;</span></span><br><span class="line">  P_NONE, P_VOID, P_CHAR, P_INT</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>现阶段,none修饰控制语句,void是函数符号,char,int是变量符号.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ASTnode</span> &#123;</span></span><br><span class="line">  <span class="keyword">int</span> op;                       <span class="comment">// &quot;Operation&quot; to be performed on this tree</span></span><br><span class="line">  <span class="keyword">int</span> type;                     <span class="comment">// Type of any expression this tree generates</span></span><br><span class="line">  ...</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ast也有type,现在主要用于widen.</p><p>主要修改一些语句,比如primary</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Parse a primary factor and return an</span></span><br><span class="line"><span class="comment">// AST node representing it.</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> struct ASTnode *<span class="title">primary</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">ASTnode</span> *<span class="title">n</span>;</span></span><br><span class="line">  <span class="keyword">int</span> id;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">switch</span> (Token.token) &#123;</span><br><span class="line">    <span class="keyword">case</span> T_INTLIT:</span><br><span class="line">      <span class="comment">// For an INTLIT token, make a leaf AST node for it.</span></span><br><span class="line">      <span class="comment">// Make it a P_CHAR if it&#x27;s within the P_CHAR range</span></span><br><span class="line">      <span class="keyword">if</span> ((Token.intvalue) &gt;= <span class="number">0</span> &amp;&amp; (Token.intvalue &lt; <span class="number">256</span>))</span><br><span class="line">        n = mkastleaf(A_INTLIT, P_CHAR, Token.intvalue);</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">        n = mkastleaf(A_INTLIT, P_INT, Token.intvalue);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">case</span> T_IDENT:</span><br><span class="line">      <span class="comment">// Check that this identifier exists</span></span><br><span class="line">      id = findglob(Text);</span><br><span class="line">      <span class="keyword">if</span> (id == <span class="number">-1</span>)</span><br><span class="line">        fatals(<span class="string">&quot;Unknown variable&quot;</span>, Text);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Make a leaf AST node for it</span></span><br><span class="line">      n = mkastleaf(A_IDENT, Gsym[id].type, id);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      fatald(<span class="string">&quot;Syntax error, token&quot;</span>, Token.token);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Scan in the next token and return the leaf node</span></span><br><span class="line">  scan(&amp;Token);</span><br><span class="line">  <span class="keyword">return</span> (n);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>根据值看生成CHAR类型还是INT类型节点.</p><p>print语句</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> struct ASTnode *<span class="title">print_statement</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">ASTnode</span> *<span class="title">tree</span>;</span></span><br><span class="line">  <span class="keyword">int</span> lefttype, righttype;</span><br><span class="line">  <span class="keyword">int</span> reg;</span><br><span class="line"></span><br><span class="line">  ...</span><br><span class="line">  <span class="comment">// Parse the following expression</span></span><br><span class="line">  tree = binexpr(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Ensure the two types are compatible.</span></span><br><span class="line">  lefttype = P_INT; righttype = tree-&gt;type;</span><br><span class="line">  <span class="keyword">if</span> (!type_compatible(&amp;lefttype, &amp;righttype, <span class="number">0</span>))</span><br><span class="line">    fatal(<span class="string">&quot;Incompatible types&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Widen the tree if required. </span></span><br><span class="line">  <span class="keyword">if</span> (righttype) tree = mkastunary(righttype, P_INT, tree, <span class="number">0</span>);</span><br></pre></td></tr></table></figure><p>print 后面要求是int(char其实也可以)</p><p>如果需要widen,则生成一个WIDEN节点,类型是int.</p><p>最后生成print节点,类型也是None.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tree = mkastunary(A_PRINT,P_NONE,tree,<span class="number">0</span>);</span><br></pre></td></tr></table></figure><p>assign语句</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> struct ASTnode *<span class="title">assignment_statement</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">ASTnode</span> *<span class="title">left</span>, *<span class="title">right</span>, *<span class="title">tree</span>;</span></span><br><span class="line">  <span class="keyword">int</span> lefttype, righttype;</span><br><span class="line">  <span class="keyword">int</span> id;</span><br><span class="line"></span><br><span class="line">  ...</span><br><span class="line">  <span class="comment">// Make an lvalue node for the variable</span></span><br><span class="line">  right = mkastleaf(A_LVIDENT, Gsym[id].type, id);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Parse the following expression</span></span><br><span class="line">  left = binexpr(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Ensure the two types are compatible.</span></span><br><span class="line">  lefttype = left-&gt;type;</span><br><span class="line">  righttype = right-&gt;type;</span><br><span class="line">  <span class="keyword">if</span> (!type_compatible(&amp;lefttype, &amp;righttype, <span class="number">1</span>))  <span class="comment">// Note the 1</span></span><br><span class="line">    fatal(<span class="string">&quot;Incompatible types&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Widen the left if required.</span></span><br><span class="line">  <span class="keyword">if</span> (lefttype)</span><br><span class="line">    left = mkastunary(lefttype, right-&gt;type, left, <span class="number">0</span>);</span><br></pre></td></tr></table></figure><p>也是主要检查是否可以widen,而赋值语句只允许char widens to int.右值是char.</p><p>注意赋值语句中节点的right是左值,left是右值.所以onlyright设置为1</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> i;</span><br><span class="line">i = <span class="number">6</span>;</span><br></pre></td></tr></table></figure><p>这里6其实是char类型,因为6处在char范围内,但是赋值语句生成widen节点,相当于</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">left = mkastunary(lefttype, right-&gt;type, left, <span class="number">0</span>);</span><br></pre></td></tr></table></figure><p>op:WIDEN,type:int</p><p>最后返回赋值语句节点</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tree = mkastnode(A_ASSIGN,P_INT,left,<span class="literal">NULL</span>,right,<span class="number">0</span>);</span><br></pre></td></tr></table></figure><h3 id="更多函数"><a href="#更多函数" class="headerlink" title="更多函数"></a>更多函数</h3><ul><li>define a function, which we already have,</li><li>call a function with a single value which for now cannot be used,</li><li>return a value from a function,</li><li>use a function call as both a statement and also an expression, and</li><li>ensure that void functions never return a value and non-void functions must return a value.</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">function_call: identifier <span class="string">&#x27;(&#x27;</span> expression <span class="string">&#x27;)&#x27;</span>   ;</span><br></pre></td></tr></table></figure><p>后面移植到了ARM下,在Linux上安装了gcc的arm版本,可以生成arm汇编生成可执行程序.安装qemu,执行arm程序.</p><h3 id="新的语法"><a href="#新的语法" class="headerlink" title="新的语法"></a>新的语法</h3><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">global<span class="built_in">_</span>declarations : global<span class="built_in">_</span>declarations </span><br><span class="line">     | global<span class="built_in">_</span>declaration global<span class="built_in">_</span>declarations</span><br><span class="line">     ;</span><br><span class="line"></span><br><span class="line">global<span class="built_in">_</span>declaration: function<span class="built_in">_</span>declaration | var<span class="built_in">_</span>declaration ;</span><br><span class="line"></span><br><span class="line">function<span class="built_in">_</span>declaration: type identifier &#x27;(&#x27; &#x27;)&#x27; compound<span class="built_in">_</span>statement   ;</span><br><span class="line"></span><br><span class="line">var<span class="built_in">_</span>declaration: type identifier<span class="built_in">_</span>list &#x27;;&#x27;  ;</span><br><span class="line"></span><br><span class="line">type: type<span class="built_in">_</span>keyword opt<span class="built_in">_</span>pointer  ;</span><br><span class="line"></span><br><span class="line">type<span class="built_in">_</span>keyword: &#x27;void&#x27; | &#x27;char&#x27; | &#x27;int&#x27; | &#x27;long&#x27;  ;</span><br><span class="line"></span><br><span class="line">opt<span class="built_in">_</span>pointer: &lt;empty&gt; | &#x27;*&#x27; opt<span class="built_in">_</span>pointer  ;</span><br><span class="line"></span><br><span class="line">identifier<span class="built_in">_</span>list: identifier | identifier &#x27;,&#x27; identifier<span class="built_in">_</span>list ;</span><br></pre></td></tr></table></figure><p>Prefix Operators ‘*’ and ‘&amp;’</p><p>With declarations out of the road, let’s now look at parsing expressions where ‘*’ and ‘&amp;’ are operators that come before an expression. The BNF grammar looks like this:</p><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">prefix_expression:</span> primary</span><br><span class="line">    | <span class="string">&#x27;*&#x27;</span> prefix_expression</span><br><span class="line">    | <span class="string">&#x27;&amp;&#x27;</span> prefix_expression</span><br><span class="line">    <span class="comment">;</span></span><br></pre></td></tr></table></figure><h3 id="更多操作"><a href="#更多操作" class="headerlink" title="更多操作"></a>更多操作</h3><div class="table-container"><table><thead><tr><th>`</th><th></th><th>`</th><th>T_LOGOR</th></tr></thead><tbody><tr><td><code>&amp;&amp;</code></td><td>T_LOGAND</td></tr><tr><td>`</td><td>`</td><td>T_OR</td></tr><tr><td><code>^</code></td><td>T_XOR</td></tr><tr><td><code>&lt;&lt;</code></td><td>T_LSHIFT</td></tr><tr><td><code>&gt;&gt;</code></td><td>T_RSHIFT</td></tr><tr><td><code>++</code></td><td>T_INC</td></tr><tr><td><code>--</code></td><td>T_DEC</td></tr><tr><td><code>~</code></td><td>T_INVERT</td></tr><tr><td><code>!</code></td><td>T_LOGNO</td></tr></tbody></table></div><p>增加全局变量与局部变量.</p><p>Type Checking and Pointer Offsets</p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      
        <tags>
            
            <tag> compiler </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>write_a_compiler_by_yourself</title>
      <link href="2022/05/06/write-a-compiler-by-yourself/"/>
      <url>2022/05/06/write-a-compiler-by-yourself/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>这是一个tough part<br><span id="more"></span><br>本人学艺不精,这里先列举一下用到的资料.<br><a href="https://compilers.iecc.com/">自己写一个编译器</a></p><p><a href="https://lotabout.me/2015/write-a-C-interpreter-1/">手把手教你构建 C 语言编译器</a></p><p>一个英文一个中文,可以说是比较详细了.</p><p>还有国内清华的<a href="https://decaf-lang.github.io/minidecaf-tutorial">minidecaf</a>,最后我还是用了北大的.</p><p>需要装docker.输入docker version报错.应该是Hyper-V或是WSL2未开启,开了之后</p><p><img data-src="https://s2.loli.net/2022/05/08/EcgFvkbuN63iV75.png" alt="image-20220508192521986"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd &quot;C:\Program Files\Docker\Docker&quot;</span><br><span class="line"></span><br><span class="line">DockerCli.exe -SwitchDaemon</span><br></pre></td></tr></table></figure><p>一顿操作,基本就行了.如果遇到这种错误<a href="https://blog.csdn.net/sunshineGGB/article/details/122838156">Containers feature is disabled. Enable it using the PowerShell script in an administrative</a></p><h2 id="开始"><a href="#开始" class="headerlink" title="开始"></a>开始</h2><h3 id="编译器结构"><a href="#编译器结构" class="headerlink" title="编译器结构"></a>编译器结构</h3><p>一般而言，编译器的编写分为 3 个步骤：</p><ol><li>词法分析器，用于将字符串转化成内部的表示结构。</li><li>语法分析器，将词法分析得到的标记流（token）生成一棵语法树。</li><li>目标代码的生成，将语法树转化成目标代码。</li></ol><p>在这里我们只需要设计一个程序, 将输入的 SysY 源代码, 编译到 RISC-V 汇编即可. 在这种意义之下, 编译器通常由以下几个部分组成:</p><ul><li><strong>前端:</strong> 通过词法分析和语法分析, 将源代码解析成抽象语法树 (abstract syntax tree, AST). 通过语义分析, 扫描抽象语法树, 检查其是否存在语义错误.</li><li><strong>中端:</strong> 将抽象语法树转换为中间表示 (intermediate representation, IR), 并在此基础上完成一些机器无关优化.</li><li><strong>后端:</strong> 将中间表示转换为目标平台的汇编代码, 并在此基础上完成一些机器相关优化.</li></ul><p>在前端中, 我们的目的是把文本形式的源代码, 转换为内存中的一种树形的数据结构. 因为相比于处理字符串, 在树形结构上进行处理显然要更方便, 且效率更高. 把文本形式的源代码变成数据结构形式的 AST 有很多种方法, 但相对科学的方法是对源代码进行词法分析和语法分析.</p><p>而语法分析的目的, 按照程序的语法规则, 将输入的 token 流变成程序的 AST. 例如, 对于 SysY 程序, 关键字 <code>int</code> 后跟的一定是一个标识符, 而不可能是一个整数字面量, 这便是语法规则. Parser 会通过某些语法分析算法, 例如 LL 分析法或 LR 分析法, 对 token 流做一系列的分析, 并最终得到 AST.</p><p>语义分析阶段, 编译器通常会:</p><ul><li><strong>建立符号表</strong>, 跟踪程序里变量的声明和使用, 确定程序在某处用到了哪一个变量, 同时也可发现变量重复定义/引用未定义变量之类的错误.</li><li><strong>进行类型检查</strong>, 确定程序中是否存在诸如 “对整数变量进行数组访问” 这种类型问题. 同时标注程序中表达式的类型, 以便进行后续的生成工作. 对于某些编程语言 (例如 C++11 之后的 C++, Rust 等等), 编译器还会进行类型推断.</li><li><strong>进行必要的编译期计算</strong>. SysY 中支持使用常量表达式作为数组定义时的长度, 而我们在生成 IR 之前, 必须知道数组的长度 (SysY 不支持 <a href="https://en.wikipedia.org/wiki/Variable-length_array">VLA</a>), 这就要求编译器必须能在编译的时候算出常量表达式的值, 同时对那些无法计算的常量表达式报错. 对于某些支持元编程的语言, 这一步可能会非常复杂.</li></ul><p>至此, 我们就能得到一个语法正确, 语义清晰的 AST 表示了.</p><p>编译器通常不会直接通过扫描 AST 来生成目标代码 (汇编)——当然这么做也不是不可以, 因为从定义上讲, AST 也是一种 “中间表示”. 只不过, AST 在形式上更接近源语言, 而且其中可能会包含一些更为高级的语义, 例如分支/循环, 甚至结构体/类等等, 这些内容要一步到位变成汇编还是比较复杂的.</p><p>所以, 编译器通常会将 AST 转换为另一种形式的数据结构, 我们把它称作 IR. IR 的抽象层次比 AST 更低, 但又不至于低到汇编代码的程度. 在此基础上, 无论是直接把 IR 进一步转换为汇编代码, 还是在 IR 之上做出一些优化, 都相对更容易.</p><p>有了 IR 的存在, 我们也可以大幅降低编译器的开发成本: 假设我们想开发 MM 种语言的编译器, 要求它们能把输入编译成 NN 种指令系统的目标代码, 在没有统一的 IR 的情况下, 我们需要开发 M \times NM×N 个相关模块. 如果我们先把所有源语言都转换到同一种 IR, 然后再将这种 IR 翻译为不同的目标代码, 我们就只需要开发 M + NM+N 个相关模块.</p><p>现实世界的确存在这样的操作, 例如 <a href="https://llvm.org/docs/">LLVM IR</a> 就是一种被广泛使用的 IR. 有很多语言的编译器实现, 例如 Rust, Swift, Julia, 都会将源语言翻译到 LLVM IR. 同时, LLVM IR 可被生成为 x86, ARM, RISC-V 等一系列指令系统的目标代码. 此时, 编译器的前后端是完全解耦的, 两部分可以各自维护, 十分方便.</p><p>此外, IR 也可以极大地方便开发者调试自己的编译器. 在编译实践中, 你的编译器对于同一个 SysY 文件的输入, 既可以输出 Koopa IR, 也可以输出 RISC-V. 你可以借助相关测试工具来测试这两部分的正确性, 进而定位你的编译器到底是在前端/中端部分出了问题, 还是在后端的部分出了问题.</p><p>编译器进行的最后一步操作, 就是将 IR 转换为目标代码, 也就是目标指令系统的汇编代码. 通常情况下, 这一步通常要做以下几件事:</p><ol><li><strong>指令选择:</strong> 决定 IR 中的指令应该被翻译为哪些目标指令系统的指令. 例如前文的 Koopa IR 程序中出现的 <code>lt</code> 指令可以被翻译为 RISC-V 中的 <code>slt</code>/<code>slti</code> 指令.</li><li><strong>寄存器分配:</strong> 决定 IR 中的值和指令系统中寄存器的对应关系. 例如前文的 Koopa IR 程序中的 <code>@x</code>, <code>%cond</code>, <code>%0</code> 等等, 它们最终可能会被放在 RISC-V 的某些寄存器中. 由于指令系统中寄存器的数量通常是有限的 (RISC-V 中只有 32 个整数通用寄存器, 且它们并不都能用来存放数据), 某些值还可能会被分配在内存中.</li><li><strong>指令调度:</strong> 决定 IR 生成的指令序列最终的顺序如何. 我们通常希望编译器能生成一个最优化的指令序列, 它可以最大程度地利用目标平台的微结构特性, 这样生成的程序的性能就会很高. 例如编译器可能会穿插调度访存指令和其他指令, 以求减少访存导致的停顿.</li></ol><p>EBNF, 即 <a href="https://en.wikipedia.org/wiki/Extended_Backus–Naur_form">Extended Backus–Naur Form</a>, 扩展巴科斯范式, 可以用来描述编程语言的语法. 基于 SysY 的 EBNF, 我们可以从开始符号出发, 推导出任何一个符合 SysY 语法定义的 SysY 程序. </p><p>makefile</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># C++ 模式</span></span><br><span class="line">flex -o 文件名.lex.cpp 文件名.l</span><br><span class="line">bison -d -o 文件名.tab.cpp 文件名.y   <span class="comment"># 此时 bison 还会生成 `文件名.tab.hpp`</span></span><br><span class="line"><span class="comment"># C 模式</span></span><br><span class="line">flex -o 文件名.lex.c 文件名.l</span><br><span class="line">bison -d -o 文件名.tab.c 文件名.y     <span class="comment"># 此时 bison 还会生成 `文件名.tab.h`</span></span><br></pre></td></tr></table></figure><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">%option noyywrap</span></span><br><span class="line"><span class="comment">%option nounput</span></span><br><span class="line"><span class="comment">%option noinput</span></span><br><span class="line"></span><br><span class="line"><span class="comment">%&#123;</span></span><br><span class="line"></span><br><span class="line"><span class="params">#</span>include &lt;cstdlib&gt;</span><br><span class="line"><span class="params">#</span>include &lt;string&gt;</span><br><span class="line"></span><br><span class="line">// 因为 Flex 会用到 Bison 中关于 token 的定义</span><br><span class="line">// 所以需要 include Bison 生成的头文件</span><br><span class="line"><span class="params">#</span>include &quot;sysy.tab.hpp&quot;</span><br><span class="line"></span><br><span class="line">using namespace std;</span><br><span class="line"></span><br><span class="line"><span class="comment">%&#125;</span></span><br><span class="line"></span><br><span class="line">/* 空白符和注释 */</span><br><span class="line">WhiteSpace    [ <span class="keyword">\t</span><span class="keyword">\n</span><span class="keyword">\r</span>]*</span><br><span class="line">LineComment   &quot;//&quot;.*<span class="built_in">$</span></span><br><span class="line"></span><br><span class="line">/* 标识符 */</span><br><span class="line">Identifier    [a-zA-Z<span class="built_in">_</span>][a-zA-Z0-9<span class="built_in">_</span>]*</span><br><span class="line"></span><br><span class="line">/* 整数字面量 */</span><br><span class="line">Decimal       [1-9][0-9]*</span><br><span class="line">Octal         0[0-7]*</span><br><span class="line">Hexadecimal   0[xX][0-9a-fA-F]+</span><br><span class="line"></span><br><span class="line"><span class="comment">%%</span></span><br><span class="line"></span><br><span class="line">&#123;WhiteSpace&#125;    &#123; /* 忽略, 不做任何操作 */ &#125;</span><br><span class="line">&#123;LineComment&#125;   &#123; /* 忽略, 不做任何操作 */ &#125;</span><br><span class="line"></span><br><span class="line">&quot;int&quot;           &#123; return INT; &#125;</span><br><span class="line">&quot;return&quot;        &#123; return RETURN; &#125;</span><br><span class="line"></span><br><span class="line">&#123;Identifier&#125;    &#123; yylval.str<span class="built_in">_</span>val = new string(yytext); return IDENT; &#125;</span><br><span class="line"></span><br><span class="line">&#123;Decimal&#125;       &#123; yylval.int<span class="built_in">_</span>val = strtol(yytext, nullptr, 0); return INT<span class="built_in">_</span>CONST; &#125;</span><br><span class="line">&#123;Octal&#125;         &#123; yylval.int<span class="built_in">_</span>val = strtol(yytext, nullptr, 0); return INT<span class="built_in">_</span>CONST; &#125;</span><br><span class="line">&#123;Hexadecimal&#125;   &#123; yylval.int<span class="built_in">_</span>val = strtol(yytext, nullptr, 0); return INT<span class="built_in">_</span>CONST; &#125;</span><br><span class="line"></span><br><span class="line">.               &#123; return yytext[0]; &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">%%</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>文件最开头我们设置了一些选项, 你可以 RTFM 这些选项的含义. 如果不设置这些选项, Flex 就会要求我们在代码里定义一些额外的东西, 但我们实际上用不到这些东西.</li><li>第二部分声明了必要的头文件, 然后是经典的 <code>using namespace std</code>.</li><li>第三部分定义了一些正则表达式的规则, 比如空白符, 行注释等等. 这些规则其实直接写在第四部分也可以, 但那样太乱了, 还是给它们起个名字比较好理解一些.</li><li>第四部分定义了 lexer 的行为:<ul><li>遇到空白符和注释就跳过.</li><li>遇到 <code>int</code>, <code>return</code> 这种关键字就返回对应的 token.</li><li>遇到标识符就把标识符存起来, 然后返回对应的 token. <code>yytext</code> 代表 lexer 当前匹配到的字符串的内容, 它的类型是 <code>char *</code>, 在此处对应读取到的一个标识符. <code>yylval</code> 用来向 parser 传递 lexer 读取到的内容, <code>str_val</code> 和之后的 <code>int_val</code> 是我们在 Bison 文件中定义的字段, 之后再解释.</li><li>遇到整数字面量, 先把读取到的字符串转换成整数, 然后存起来, 并返回对应的 token.</li><li>遇到单个字符, 就直接返回单个字符作为 token. <code>.</code> 这个正则表达式会匹配任意单个字符, 而 <code>yytext[0]</code> 实际上读取了目前匹配到的这个字符. 在 Flex/Bison 中, token 实际就是整数, 之前出现的 <code>INT</code>, <code>RETURN</code>, <code>IDENT</code> 等, 其实是 Bison 根据我们的定义生成的枚举 (<code>enum</code>). 所以此处相当于, 我们取了当前匹配到的字符, 然后把它转成了整数, 交给 Bison 生成的 parser 处理. 在 Bison 里, 我们可以直接通过写字符 (比如 <code>&#39;(&#39;</code>), 来表示我们希望匹配 lexer 返回的一个字符转换得到的 token.</li></ul></li></ul><p>由于在<strong>union</strong>里也不允许存放带有构造函数、析构函数和复制构造函数等的类的对象，但是可以存放对应的类对象指针。</p><h1 id="pragma-once一般由编译器提供保证：同一个文件不会被包含多次。这里所说的”同一个文件”是指物理上的一个文件，而不是指内容相同的两个文件。无法对一个头文件中的一段代码作-pragma-once声明，而只能针对文件。此方式不会出现宏名碰撞引发的奇怪问题，大型项目的编译速度也因此提供了一些。缺点是如果某个头文件有多份拷贝，此方法不能保证它们不被重复包含。在C-C-中，-pragma-once是一个非标准但是被广泛支持的方式。"><a href="#pragma-once一般由编译器提供保证：同一个文件不会被包含多次。这里所说的”同一个文件”是指物理上的一个文件，而不是指内容相同的两个文件。无法对一个头文件中的一段代码作-pragma-once声明，而只能针对文件。此方式不会出现宏名碰撞引发的奇怪问题，大型项目的编译速度也因此提供了一些。缺点是如果某个头文件有多份拷贝，此方法不能保证它们不被重复包含。在C-C-中，-pragma-once是一个非标准但是被广泛支持的方式。" class="headerlink" title="pragma once一般由编译器提供保证：同一个文件不会被包含多次。这里所说的”同一个文件”是指物理上的一个文件，而不是指内容相同的两个文件。无法对一个头文件中的一段代码作#pragma once声明，而只能针对文件。此方式不会出现宏名碰撞引发的奇怪问题，大型项目的编译速度也因此提供了一些。缺点是如果某个头文件有多份拷贝，此方法不能保证它们不被重复包含。在C/C++中，#pragma once是一个非标准但是被广泛支持的方式。"></a>pragma once一般由编译器提供保证：同一个文件不会被包含多次。这里所说的”同一个文件”是指物理上的一个文件，而不是指内容相同的两个文件。无法对一个头文件中的一段代码作#pragma once声明，而只能针对文件。此方式不会出现宏名碰撞引发的奇怪问题，大型项目的编译速度也因此提供了一些。缺点是如果某个头文件有多份拷贝，此方法不能保证它们不被重复包含。在C/C++中，#pragma once是一个非标准但是被广泛支持的方式。</h1><pre><code>    #pragma once方式产生于#ifndef之后。#ifndef方式受C/C++语言标准的支持，不受编译器的任何限制；而#pragma once方式有些编译器不支持(较老编译器不支持，如GCC 3.4版本之前不支持#pragmaonce)，兼容性不够好。#ifndef可以针对一个文件中的部分代码，而#pragma once只能针对整个文件。相对而言，#ifndef更加灵活，兼容性好，#pragma once操作简单，效率高。</code></pre><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">%code requires &#123;</span></span><br><span class="line">  <span class="params">#</span>include &lt;memory&gt;</span><br><span class="line">  <span class="params">#</span>include &lt;string&gt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">%&#123;</span></span><br><span class="line"></span><br><span class="line"><span class="params">#</span>include &lt;iostream&gt;</span><br><span class="line"><span class="params">#</span>include &lt;memory&gt;</span><br><span class="line"><span class="params">#</span>include &lt;string&gt;</span><br><span class="line"></span><br><span class="line">// 声明 lexer 函数和错误处理函数</span><br><span class="line">int yylex();</span><br><span class="line">void yyerror(std::unique<span class="built_in">_</span>ptr&lt;std::string&gt; <span class="built_in">&amp;</span>ast, const char *s);</span><br><span class="line"></span><br><span class="line">using namespace std;</span><br><span class="line"></span><br><span class="line"><span class="comment">%&#125;</span></span><br><span class="line"></span><br><span class="line">// 定义 parser 函数和错误处理函数的附加参数</span><br><span class="line">// 我们需要返回一个字符串作为 AST, 所以我们把附加参数定义成字符串的智能指针</span><br><span class="line">// 解析完成后, 我们要手动修改这个参数, 把它设置成解析得到的字符串</span><br><span class="line"><span class="comment">%parse-param &#123; std::unique_ptr&lt;std::string&gt; &amp;ast &#125;</span></span><br><span class="line"></span><br><span class="line">// yylval 的定义, 我们把它定义成了一个联合体 (union)</span><br><span class="line">// 因为 token 的值有的是字符串指针, 有的是整数</span><br><span class="line">// 之前我们在 lexer 中用到的 str<span class="built_in">_</span>val 和 int<span class="built_in">_</span>val 就是在这里被定义的</span><br><span class="line">// 至于为什么要用字符串指针而不直接用 string 或者 unique<span class="built_in">_</span>ptr&lt;string&gt;?</span><br><span class="line">// 请自行 STFW 在 union 里写一个带析构函数的类会出现什么情况</span><br><span class="line"><span class="comment">%union &#123;</span></span><br><span class="line">  std::string *str<span class="built_in">_</span>val;</span><br><span class="line">  int int<span class="built_in">_</span>val;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// lexer 返回的所有 token 种类的声明</span><br><span class="line">// 注意 IDENT 和 INT<span class="built_in">_</span>CONST 会返回 token 的值, 分别对应 str<span class="built_in">_</span>val 和 int<span class="built_in">_</span>val</span><br><span class="line"><span class="comment">%token INT RETURN</span></span><br><span class="line"><span class="comment">%token &lt;str_val&gt; IDENT</span></span><br><span class="line"><span class="comment">%token &lt;int_val&gt; INT_CONST</span></span><br><span class="line"></span><br><span class="line">// 非终结符的类型定义</span><br><span class="line"><span class="comment">%type &lt;str_val&gt; FuncDef FuncType Block Stmt Number</span></span><br><span class="line"></span><br><span class="line"><span class="comment">%%</span></span><br><span class="line"></span><br><span class="line">// 开始符, CompUnit ::= FuncDef, 大括号后声明了解析完成后 parser 要做的事情</span><br><span class="line">// 之前我们定义了 FuncDef 会返回一个 str<span class="built_in">_</span>val, 也就是字符串指针</span><br><span class="line">// 而 parser 一旦解析完 CompUnit, 就说明所有的 token 都被解析了, 即解析结束了</span><br><span class="line">// 此时我们应该把 FuncDef 返回的结果收集起来, 作为 AST 传给调用 parser 的函数</span><br><span class="line">// <span class="built_in">$</span>1 指代规则里第一个符号的返回值, 也就是 FuncDef 的返回值</span><br><span class="line">CompUnit</span><br><span class="line">  : FuncDef &#123;</span><br><span class="line">    ast = unique<span class="built_in">_</span>ptr&lt;string&gt;(<span class="built_in">$</span>1);</span><br><span class="line">  &#125;</span><br><span class="line">  ;</span><br><span class="line"></span><br><span class="line">// FuncDef ::= FuncType IDENT &#x27;(&#x27; &#x27;)&#x27; Block;</span><br><span class="line">// 我们这里可以直接写 &#x27;(&#x27; 和 &#x27;)&#x27;, 因为之前在 lexer 里已经处理了单个字符的情况</span><br><span class="line">// 解析完成后, 把这些符号的结果收集起来, 然后拼成一个新的字符串, 作为结果返回</span><br><span class="line">// <span class="built_in">$</span><span class="built_in">$</span> 表示非终结符的返回值, 我们可以通过给这个符号赋值的方法来返回结果</span><br><span class="line">// 你可能会问, FuncType, IDENT 之类的结果已经是字符串指针了</span><br><span class="line">// 为什么还要用 unique<span class="built_in">_</span>ptr 接住它们, 然后再解引用, 把它们拼成另一个字符串指针呢</span><br><span class="line">// 因为所有的字符串指针都是我们 new 出来的, new 出来的内存一定要 delete</span><br><span class="line">// 否则会发生内存泄漏, 而 unique<span class="built_in">_</span>ptr 这种智能指针可以自动帮我们 delete</span><br><span class="line">// 虽然此处你看不出用 unique<span class="built_in">_</span>ptr 和手动 delete 的区别, 但当我们定义了 AST 之后</span><br><span class="line">// 这种写法会省下很多内存管理的负担</span><br><span class="line">FuncDef</span><br><span class="line">  : FuncType IDENT &#x27;(&#x27; &#x27;)&#x27; Block &#123;</span><br><span class="line">    auto type = unique<span class="built_in">_</span>ptr&lt;string&gt;(<span class="built_in">$</span>1);</span><br><span class="line">    auto ident = unique<span class="built_in">_</span>ptr&lt;string&gt;(<span class="built_in">$</span>2);</span><br><span class="line">    auto block = unique<span class="built_in">_</span>ptr&lt;string&gt;(<span class="built_in">$</span>5);</span><br><span class="line">    <span class="built_in">$</span><span class="built_in">$</span> = new string(*type + &quot; &quot; + *ident + &quot;() &quot; + *block);</span><br><span class="line">  &#125;</span><br><span class="line">  ;</span><br><span class="line"></span><br><span class="line">// 同上, 不再解释</span><br><span class="line">FuncType</span><br><span class="line">  : INT &#123;</span><br><span class="line">    <span class="built_in">$</span><span class="built_in">$</span> = new string(&quot;int&quot;);</span><br><span class="line">  &#125;</span><br><span class="line">  ;</span><br><span class="line"></span><br><span class="line">Block</span><br><span class="line">  : &#x27;&#123;&#x27; Stmt &#x27;&#125;&#x27; &#123;</span><br><span class="line">    auto stmt = unique<span class="built_in">_</span>ptr&lt;string&gt;(<span class="built_in">$</span>2);</span><br><span class="line">    <span class="built_in">$</span><span class="built_in">$</span> = new string(&quot;&#123; &quot; + *stmt + &quot; &#125;&quot;);</span><br><span class="line">  &#125;</span><br><span class="line">  ;</span><br><span class="line"></span><br><span class="line">Stmt</span><br><span class="line">  : RETURN Number &#x27;;&#x27; &#123;</span><br><span class="line">    auto number = unique<span class="built_in">_</span>ptr&lt;string&gt;(<span class="built_in">$</span>2);</span><br><span class="line">    <span class="built_in">$</span><span class="built_in">$</span> = new string(&quot;return &quot; + *number + &quot;;&quot;);</span><br><span class="line">  &#125;</span><br><span class="line">  ;</span><br><span class="line"></span><br><span class="line">Number</span><br><span class="line">  : INT<span class="built_in">_</span>CONST &#123;</span><br><span class="line">    <span class="built_in">$</span><span class="built_in">$</span> = new string(to<span class="built_in">_</span>string(<span class="built_in">$</span>1));</span><br><span class="line">  &#125;</span><br><span class="line">  ;</span><br><span class="line"></span><br><span class="line"><span class="comment">%%</span></span><br><span class="line"></span><br><span class="line">// 定义错误处理函数, 其中第二个参数是错误信息</span><br><span class="line">// parser 如果发生错误 (例如输入的程序出现了语法错误), 就会调用这个函数</span><br><span class="line">void yyerror(unique<span class="built_in">_</span>ptr&lt;string&gt; <span class="built_in">&amp;</span>ast, const char *s) &#123;</span><br><span class="line">  cerr &lt;&lt; &quot;error: &quot; &lt;&lt; s &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>设置一些必要的选项, 比如 <code>%code requires</code>.</li><li>引用头文件, 声明 lexer 函数和错误处理函数. 如果不声明这些函数的话, parser 会找不到 Flex 中定义的 lexer, 也没办法正常报错.</li><li>定义 parser 函数的参数. Bison 生成的 parser 函数返回类型一定是 <code>int</code>, 所以我们没办法通过返回值返回 AST, 所以只能通过参数来返回 AST 了. 当然你也可以通过全局变量来返回 AST, 但, 那样做很 dirty (如果你接触过函数式编程或了解软件工程技术的话).</li><li>定义了 <code>yylval</code>, token 和非终结符的类型.</li><li>定义了语法规则, 同时定义了 parser 解析完语法规则之后执行的操作.</li><li>定义了错误处理函数.</li></ul><p>这里主要涉及到flex和bison的知识,这个可能要看一会.</p><h3 id="设计AST"><a href="#设计AST" class="headerlink" title="设计AST"></a>设计AST</h3><p>设计 AST 这件事其实很简单, 你首先要知道:</p><ol><li>AST 保留了程序语法的结构.</li><li>AST 是为了方便程序的处理而存在的, 不存在什么设计规范</li></ol><p>注意%token是终结符,而其他的是非终结符</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%type &lt;str_val&gt; FuncDef FuncType Block Stmt Number</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">%<span class="class"><span class="keyword">union</span> &#123;</span></span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">string</span> *str_val;</span><br><span class="line">  <span class="keyword">int</span> int_val;</span><br><span class="line">  BaseAST *ast_val;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>修改yylval类型.</p><p>生成了AST后,继续生成IR.</p><p>一旦完成了 IR 的生成, 你的编译器就已经初步成型了. 因为有一些基础设施的存在, 比如 LLVM IR, 现代的很多编译器都只会进行到 IR 生成这一步, 然后把后续的工作交给这些基础设施完成.</p><ul><li>编译器首先会对源代码做词法/语法分析, 生成 AST.</li><li>然后在 AST 上进行语义分析, 建立符号表, 做类型检查, 报告语义错误, 等等.</li><li>接着, 遍历语义分析后的 AST, 生成 IR.</li></ul><p>我们会在每章的<a href="https://pku-minic.github.io/online-doc/#/lv1-main/">开头</a>给出本章涉及内容的语法规范和语义规范. 一个功能完备的编译器应该能够检查输入程序是否符合语义规范, 并在发生语义错误时报错.</p><p>不过, 在课程实践中, 所有的测试用例均为符合语法/语义规范的 SysY 程序. <strong>我们不要求你编写的编译器具备处理语法/语义错误的能力, 也不会考察这些内容.</strong> 但我们希望学有余力的同学, 能够在自己的编译器中检查这些问题, 并对其作出合适的处理, 比如像 <code>clang</code> 或 <code>rustc</code> 一样, 给出精确到行列的错误信息, 甚至具备忽略错误继续扫描, 以及对错误给出修改建议的高级功能.</p><p>Koopa IR 中, 最大的单位是 <code>Program</code>, 它代表一个 Koopa IR 程序. <code>Program</code> 由若干全局变量 (<code>Value</code>) 和函数 (<code>Function</code>) 构成. <code>Function</code> 又由若干基本块 (<code>BasicBlock</code>) 构成, 基本块中是一系列指令, 指令也是 <code>Value</code>. 所以 Koopa IR 程序的结构如下所示:</p><ul><li>```<br>Program<figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">-<span class="ruby"> 全局变量列表:</span></span><br><span class="line"><span class="ruby"></span></span><br><span class="line">  -<span class="ruby"> <span class="string">`Value`</span> <span class="number">1</span>.</span></span><br><span class="line"><span class="ruby"></span>  -<span class="ruby"> <span class="string">`Value`</span> <span class="number">2</span>.</span></span><br><span class="line"><span class="ruby"></span>  -<span class="ruby"> …</span></span><br><span class="line"><span class="ruby"></span></span><br><span class="line">-<span class="ruby"> 函数列表:</span></span><br><span class="line"><span class="ruby"></span></span><br><span class="line">  -<span class="ruby"> <span class="string">``</span><span class="string">`</span></span></span><br><span class="line"><span class="string"><span class="ruby"></span></span>    Function</span><br></pre></td></tr></table></figure></li></ul><pre><code>  1.  - 基本块列表:    - ```      BasicBlock      <figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="code">           </span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="bullet">          1.</span></span><br><span class="line"></span><br><span class="line">          - 指令列表:</span><br><span class="line"><span class="bullet">            -</span> <span class="code">`Value`</span> 1.</span><br><span class="line"><span class="bullet">            -</span> <span class="code">`Value`</span> 2.</span><br><span class="line"><span class="bullet">            -</span> …</span><br><span class="line"></span><br><span class="line"><span class="bullet">        -</span> <span class="code">`BasicBlock`</span> 2.</span><br><span class="line"></span><br><span class="line"><span class="bullet">        -</span> …</span><br><span class="line"></span><br><span class="line"><span class="bullet">    -</span> <span class="code">`Function`</span> 2.</span><br><span class="line"></span><br><span class="line"><span class="bullet">    -</span> …</span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="strong">**各类常量:**</span> 整数常量 (<span class="code">`Integer`</span>), 零初始化器 (<span class="code">`ZeroInit`</span>), 等等.</span><br><span class="line"><span class="bullet">-</span> <span class="strong">**参数引用:**</span> 函数参数引用 (<span class="code">`FuncArgRef`</span>) 等, 用来指代传入的参数.</span><br><span class="line"><span class="bullet">-</span> <span class="strong">**内存分配:**</span> 全局内存分配 (<span class="code">`GlobalAlloc`</span>, 所有的全局变量都是这个玩意) 和局部内存分配 (<span class="code">`Alloc`</span>).</span><br><span class="line"><span class="bullet">-</span> <span class="strong">**访存指令:**</span> 加载 (<span class="code">`Load`</span>) 和存储 (<span class="code">`Store`</span>).</span><br><span class="line"><span class="bullet">-</span> <span class="strong">**指针运算:**</span> <span class="code">`GetPtr`</span> 和 <span class="code">`GetElemPtr`</span>.</span><br><span class="line"><span class="bullet">-</span> <span class="strong">**二元运算:**</span> <span class="code">`Binary`</span>, 比如加减乘除模/比较之类的运算都属于此类.</span><br><span class="line"><span class="bullet">-</span> <span class="strong">**控制转移:**</span> 条件分支 (<span class="code">`Branch`</span>) 和无条件跳转 (<span class="code">`Jump`</span>).</span><br><span class="line"><span class="bullet">-</span> <span class="strong">**函数相关:**</span> 函数调用 (<span class="code">`Call`</span>) 和函数返回 (<span class="code">`Return`</span>).</span><br><span class="line"></span><br><span class="line">目标很明确了:</span><br><span class="line"></span><br><span class="line"><span class="bullet">1.</span> 我们应该生成一个 Koopa IR 程序.</span><br><span class="line"><span class="bullet">2.</span> 程序中有一个名字叫 <span class="code">`main`</span> 的函数.</span><br><span class="line"><span class="bullet">3.</span> 函数里有一个入口基本块.</span><br><span class="line"><span class="bullet">4.</span> 基本块里有一条返回指令.</span><br><span class="line"><span class="bullet">5.</span> 返回指令的返回值就是 SysY 里 <span class="code">`return`</span> 语句后跟的值, 也就是一个整数常量.</span><br><span class="line"></span><br><span class="line"> Koopa IR 目前有两种形式:</span><br><span class="line"></span><br><span class="line"><span class="bullet">1.</span> <span class="strong">**文本形式:**</span> 就是你在前文见到的字符串形式, 方便人类阅读.</span><br><span class="line"><span class="bullet">2.</span> <span class="strong">**内存形式:**</span> 即数据结构的形式, 你可以把它理解为另一种 “AST”, 方便程序处理.</span><br><span class="line"></span><br><span class="line">你的编译器输出的文本形式 IR, 最终会被 Koopa IR 的相关工具 (比如 <span class="code">`koopac`</span>) 读取, 变成内存形式的 IR, 然后作进一步处理. Koopa IR 的框架也提供了在两种形式的 IR 之间互相转换的接口.</span><br><span class="line"></span><br><span class="line">所以, 考虑到上述情况, 你有以下几种生成 IR 的思路:</span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> 遍历 AST, 输出文本形式的 IR. 这样最简单, 适用于任何语言实现的编译器.</span><br><span class="line"><span class="bullet">-</span> 调用 Koopa IR 框架提供的接口. 使用 Rust 的同学可以尝试, 详见 Koopa IR 框架的 [<span class="string">crates.io</span>](<span class="link">https://crates.io/crates/koopa</span>) 以及[<span class="string">文档</span>](<span class="link">https://docs.rs/koopa</span>).</span><br><span class="line"><span class="bullet">-</span> 像定义 AST 一样定义表示 Koopa IR 的数据结构 (比如指令/基本块/函数等等), 然后遍历 AST 输出这种结构, 再遍历这种结构输出字符串.</span><br><span class="line"><span class="bullet">-</span> 对于使用 C/C++ 的同学, 在上一条的基础上, 你可以考虑把这种结构转换成 raw program, 然后使用 <span class="code">`libkoopa`</span> 中的相关接口, 将 raw program 转换成其他形式的 Koopa IR 程序</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">第一种思路可能是大部分同学会采用的思路, 因为它相当简单且直观, 实现难度很低. 但其缺点是, 你在生成目标代码之前, 不得不再次将文本形式的 Koopa IR 转换成某种数据结构——这相当于再写一个编译器. 否则, 你的程序几乎无法直接基于文本形式 IR 生成汇编.</span><br><span class="line"></span><br><span class="line">不过好在, 我们为大家提供了能够处理 Koopa IR 的库, 你可以使用其中的实现, 来将文本形式的 IR 转换为内存形式.</span><br><span class="line"></span><br><span class="line"><span class="code">```c</span></span><br><span class="line"><span class="code">// 解析字符串 str, 得到 Koopa IR 程序</span></span><br><span class="line"><span class="code">koopa_program_t program;</span></span><br><span class="line"><span class="code">koopa_error_code_t ret = koopa_parse_from_string(str, &amp;program);</span></span><br><span class="line"><span class="code">assert(ret == KOOPA_EC_SUCCESS);  // 确保解析时没有出错</span></span><br><span class="line"><span class="code">// 创建一个 raw program builder, 用来构建 raw program</span></span><br><span class="line"><span class="code">koopa_raw_program_builder_t builder = koopa_new_raw_program_builder();</span></span><br><span class="line"><span class="code">// 将 Koopa IR 程序转换为 raw program</span></span><br><span class="line"><span class="code">koopa_raw_program_t raw = koopa_build_raw_program(builder, program);</span></span><br><span class="line"><span class="code">// 释放 Koopa IR 程序占用的内存</span></span><br><span class="line"><span class="code">koopa_delete_program(program);</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">// 处理 raw program</span></span><br><span class="line"><span class="code">// ...</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">// 处理完成, 释放 raw program builder 占用的内存</span></span><br><span class="line"><span class="code">// 注意, raw program 中所有的指针指向的内存均为 raw program builder 的内存</span></span><br><span class="line"><span class="code">// 所以不要在 raw program 处理完毕之前释放 builder</span></span><br><span class="line"><span class="code">koopa_delete_raw_program_builder(builder);</span></span><br></pre></td></tr></table></figure></code></pre><ul><li>最上层是 <code>koopa_raw_program_t</code>, 也就是 <code>Program</code>.</li><li>之下是全局变量定义列表和函数定义列表.<ul><li>在 raw program 中, 列表的类型是 <code>koopa_raw_slice_t</code>.</li><li>本质上这是一个指针数组, 其中的 <code>buffer</code> 字段记录了指针数组的地址 (类型是 <code>const void **</code>), <code>len</code> 字段记录了指针数组的长度, <code>kind</code> 字段记录了数组元素是何种类型的指针</li><li>在访问时, 你可以通过 <code>slice.buffer[i]</code> 拿到列表元素的指针, 然后通过判断 <code>kind</code> 来决定把这个指针转换成什么类型.</li></ul></li><li><code>koopa_raw_function_t</code> 代表函数, 其中是基本块列表.</li><li><code>koopa_raw_basic_block_t</code> 代表基本块, 其中是指令列表.</li><li><code>koopa_raw_value_t</code> 代表全局变量, 或者基本块中的指令.</li></ul><p>现在卡在了ast生成IR,根据教程貌似需要遍历ast.也就是遍历类似树的结构.当然方法也不知这一种.我从网上copy了一份代码阅读阅读.</p><h3 id="代码鉴赏"><a href="#代码鉴赏" class="headerlink" title="代码鉴赏"></a>代码鉴赏</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br><span class="line">816</span><br><span class="line">817</span><br><span class="line">818</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*****************************************************</span></span><br><span class="line"><span class="comment"> *  Definition of the AST nodes.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *  Please read the description of each class for details.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *  Keltin Leung </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> __MIND_AST__</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __MIND_AST__</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;define.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// the prefix of an ast attribution</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ATTR(x) ast_attr_##x##_</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> mind &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MIND_AST_DEFINED</span></span><br><span class="line"><span class="keyword">namespace</span> ast &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* The base class of all AST nodes.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">NOTE:</span> Don&#x27;t instantiate this class.</span></span><br><span class="line"><span class="comment"> *       Please read the description of the subclasses.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ASTNode</span> &#123;</span></span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// types of the AST nodes</span></span><br><span class="line">    <span class="keyword">typedef</span> <span class="class"><span class="keyword">enum</span> &#123;</span></span><br><span class="line">        ADD_EXPR,</span><br><span class="line">        AND_EXPR,</span><br><span class="line">        ASSIGN_EXPR,</span><br><span class="line">        BOOL_CONST,</span><br><span class="line">        BIT_NOT_EXPR,</span><br><span class="line">        BOOL_TYPE,</span><br><span class="line">        BREAK_STMT,</span><br><span class="line">        CONTINUE_STMT,</span><br><span class="line">        CALL_EXPR,</span><br><span class="line">        COMP_STMT,</span><br><span class="line">        DIV_EXPR,</span><br><span class="line">        EQU_EXPR,</span><br><span class="line">        EMPTY_STMT,</span><br><span class="line">        EXPR_STMT,</span><br><span class="line">        FUNC_DEFN,</span><br><span class="line">        GEQ_EXPR,</span><br><span class="line">        GRT_EXPR,</span><br><span class="line">        IF_STMT,</span><br><span class="line">        IF_EXPR,</span><br><span class="line">        INT_CONST,</span><br><span class="line">        INT_TYPE,</span><br><span class="line">        LEQ_EXPR,</span><br><span class="line">        LES_EXPR,</span><br><span class="line">        LVALUE_EXPR,</span><br><span class="line">        MOD_EXPR,</span><br><span class="line">        MUL_EXPR,</span><br><span class="line">        NEG_EXPR,</span><br><span class="line">        NEQ_EXPR,</span><br><span class="line">        NOT_EXPR,</span><br><span class="line">        OR_EXPR,</span><br><span class="line">        PROGRAM,</span><br><span class="line">        RETURN_STMT,</span><br><span class="line">        SUB_EXPR,</span><br><span class="line">        VAR_DECL,</span><br><span class="line">        VAR_REF,</span><br><span class="line">        WHILE_STMT,</span><br><span class="line">        FOR_STMT,</span><br><span class="line">        FOD,</span><br><span class="line">        INDEX_EXPR</span><br><span class="line">    &#125; NodeType; <span class="comment">// 定义了一个，枚举类型  ast节点类型 </span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">protected</span>:</span><br><span class="line">    <span class="comment">// names of each kind of the AST nodes</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">char</span> *node_name[];  </span><br><span class="line">    <span class="comment">// kind of this node</span></span><br><span class="line">    NodeType kind;  <span class="comment">//上面声明的节点类型</span></span><br><span class="line">    <span class="comment">// position in the source text</span></span><br><span class="line">    Location *loc; <span class="comment">//在另一各文件中声明的  是一个结构体 有构造函数  表示ast节点位置</span></span><br><span class="line">    <span class="comment">// for subclass constructors only</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">setBasicInfo</span><span class="params">(NodeType, Location *)</span></span>; <span class="comment">//she</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// gets the node kind</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> NodeType <span class="title">getKind</span><span class="params">(<span class="keyword">void</span>)</span></span>;</span><br><span class="line">    <span class="comment">// gets the location</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> Location *<span class="title">getLocation</span><span class="params">(<span class="keyword">void</span>)</span></span>;</span><br><span class="line">    <span class="comment">// prints to the specified output stream</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">dumpTo</span><span class="params">(<span class="built_in">std</span>::ostream &amp;)</span></span>;</span><br><span class="line">    <span class="comment">// for Visitor</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Visitor *)</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// remember: let alone the memory deallocation stuff</span></span><br><span class="line">    <span class="keyword">virtual</span> ~ASTNode(<span class="keyword">void</span>) &#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Node representing a type.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">NOTE:</span></span></span><br><span class="line"><span class="comment"> *   it is purely an interface.</span></span><br><span class="line"><span class="comment"> * IMPLEMENTATION:</span></span><br><span class="line"><span class="comment"> *   IntType, BoolType, ArrayType</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Type</span> :</span> <span class="keyword">public</span> ASTNode &#123;</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    <span class="function">type::Type *<span class="title">ATTR</span><span class="params">(type)</span></span>; <span class="comment">// for semantic analysis</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Node representing a statement.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">NOTE:</span></span></span><br><span class="line"><span class="comment"> *   it is purely an interface.</span></span><br><span class="line"><span class="comment"> * IMPLEMENTATION:</span></span><br><span class="line"><span class="comment"> *   AssignStmt, ReturnStmt,</span></span><br><span class="line"><span class="comment"> *   IfStmt, WhileStmt,</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Statement</span> :</span> <span class="keyword">public</span> ASTNode &#123; <span class="comment">/* pure interface */</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Node representing an expression.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">NOTE:</span></span></span><br><span class="line"><span class="comment"> *   it is purely an interface.</span></span><br><span class="line"><span class="comment"> * IMPLEMENTATION:</span></span><br><span class="line"><span class="comment"> *   ...</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">EmptyStmt</span> :</span> <span class="keyword">public</span> Statement &#123;</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    EmptyStmt(Location *l);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Visitor *)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">dumpTo</span><span class="params">(<span class="built_in">std</span>::ostream &amp;)</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Expr</span> :</span> <span class="keyword">public</span> ASTNode &#123;</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    <span class="function">type::Type *<span class="title">ATTR</span><span class="params">(type)</span></span>; <span class="comment">// for semantic analysis</span></span><br><span class="line">    <span class="function">tac::Temp <span class="title">ATTR</span><span class="params">(val)</span></span>;    <span class="comment">// for tac generation</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Node representing a left-value expression (lvalue).</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">NOTE:</span></span></span><br><span class="line"><span class="comment"> *   it is purely an interface.</span></span><br><span class="line"><span class="comment"> * IMPLEMENTATION:</span></span><br><span class="line"><span class="comment"> *   VarRef, ArrayRef</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Lvalue</span> :</span> <span class="keyword">public</span> ASTNode &#123;</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    <span class="class"><span class="keyword">enum</span> &#123;</span></span><br><span class="line">        SIMPLE_VAR, <span class="comment">// referencing simple variable</span></span><br><span class="line">        ARRAY_ELE   <span class="comment">// referencing array element</span></span><br><span class="line">    &#125; ATTR(lv_kind);</span><br><span class="line"></span><br><span class="line">    <span class="function">type::Type *<span class="title">ATTR</span><span class="params">(type)</span></span>; <span class="comment">// for semantic analysis</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Node representing a program.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * SERIALIZED FORM:</span></span><br><span class="line"><span class="comment"> *   (program [ FUNC_1 FUNC_2 ... FUNC_N ])</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Program</span> :</span> <span class="keyword">public</span> ASTNode &#123;</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    Program(ASTNode *first, Location *l);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Visitor *)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">dumpTo</span><span class="params">(<span class="built_in">std</span>::ostream &amp;)</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">//   FuncList* functions;</span></span><br><span class="line">    <span class="comment">//   VarList* globals;</span></span><br><span class="line">    FuncOrGlobalList *func_and_globals;</span><br><span class="line">    <span class="function">symb::Function *<span class="title">ATTR</span><span class="params">(main)</span></span>;       <span class="comment">// for semantic analysis</span></span><br><span class="line">    <span class="function">scope::GlobalScope *<span class="title">ATTR</span><span class="params">(gscope)</span></span>; <span class="comment">// for semantic analysis</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Node representing a variable declaration.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * SERIALIZED FORM:</span></span><br><span class="line"><span class="comment"> *   (var NAME TYPE)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">VarDecl</span> :</span> <span class="keyword">public</span> Statement &#123;</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    VarDecl(<span class="built_in">std</span>::<span class="built_in">string</span> name, Type *type, Location *l);</span><br><span class="line">    VarDecl(<span class="built_in">std</span>::<span class="built_in">string</span> name, Type *type, DimList *dim, Location *l);</span><br><span class="line"></span><br><span class="line">    VarDecl(<span class="built_in">std</span>::<span class="built_in">string</span> name, Type *type, Expr *init, Location *l);</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Visitor *)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">dumpTo</span><span class="params">(<span class="built_in">std</span>::ostream &amp;)</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">string</span> name;</span><br><span class="line">    Type *type;</span><br><span class="line">    Expr *init;</span><br><span class="line">    DimList *dim;</span><br><span class="line"></span><br><span class="line">    <span class="function">symb::Variable *<span class="title">ATTR</span><span class="params">(sym)</span></span>; <span class="comment">// for semantic analysis</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FuncDefn</span> :</span> <span class="keyword">public</span> ASTNode &#123;</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    FuncDefn(<span class="built_in">std</span>::<span class="built_in">string</span> name, Type *type, VarList *formals, StmtList *stmts,</span><br><span class="line">             Location *l);</span><br><span class="line">    FuncDefn(<span class="built_in">std</span>::<span class="built_in">string</span> name, Type *type, VarList *formals, EmptyStmt *empty,</span><br><span class="line">             Location *l);</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Visitor *)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">dumpTo</span><span class="params">(<span class="built_in">std</span>::ostream &amp;)</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">string</span> name;</span><br><span class="line">    Type *ret_type;</span><br><span class="line">    VarList *formals;</span><br><span class="line">    StmtList *stmts;</span><br><span class="line">    <span class="keyword">bool</span> forward_decl; <span class="comment">// is this FuncDefn a forward declaration or full</span></span><br><span class="line">                       <span class="comment">// definition?</span></span><br><span class="line">    <span class="function">symb::Function *<span class="title">ATTR</span><span class="params">(sym)</span></span>; <span class="comment">// for semantic analysis</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CallExpr</span> :</span> <span class="keyword">public</span> Expr &#123;</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    CallExpr(ExprList *expr_list, <span class="built_in">std</span>::<span class="built_in">string</span> func, Location *l);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Visitor *)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">dumpTo</span><span class="params">(<span class="built_in">std</span>::ostream &amp;)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">string</span> func;</span><br><span class="line">    ExprList *expr_list;</span><br><span class="line">    <span class="function">symb::Function *<span class="title">ATTR</span><span class="params">(sym)</span></span>; <span class="comment">// for tac generation</span></span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IndexExpr</span> :</span> <span class="keyword">public</span> Expr &#123;</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    IndexExpr(Expr *, ExprList *, Location *l);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Visitor *)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">dumpTo</span><span class="params">(<span class="built_in">std</span>::ostream &amp;)</span></span>;</span><br><span class="line"></span><br><span class="line">    ExprList *expr_list;</span><br><span class="line">    <span class="function">DimList *<span class="title">ATTR</span><span class="params">(dim)</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FuncOrGlobal</span> &#123;</span></span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    FuncOrGlobal(FuncDefn *f, VarDecl *d) &#123;</span><br><span class="line">        func = f;</span><br><span class="line">        decl = d;</span><br><span class="line">    &#125;</span><br><span class="line">    FuncDefn *func; <span class="comment">// assert ( func == NULL xor decl == NULL)</span></span><br><span class="line">    VarDecl *decl;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FOD</span> &#123;</span></span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    FOD(FuncList *f, VarList *d) &#123;</span><br><span class="line">        func = f;</span><br><span class="line">        decl = d;</span><br><span class="line">    &#125;</span><br><span class="line">    FuncList *func;</span><br><span class="line">    VarList *decl;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/* Node representing the integer type.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * SERIALIZED FORM:</span></span><br><span class="line"><span class="comment"> *   (itype)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IntType</span> :</span> <span class="keyword">public</span> Type &#123;</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    IntType(Location *l);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Visitor *)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">dumpTo</span><span class="params">(<span class="built_in">std</span>::ostream &amp;)</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Node representing the Boolean type.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * SERIALIZED FORM:</span></span><br><span class="line"><span class="comment"> *   (btype)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BoolType</span> :</span> <span class="keyword">public</span> Type &#123;</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    BoolType(Location *l);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Visitor *)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">dumpTo</span><span class="params">(<span class="built_in">std</span>::ostream &amp;)</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Node representing an assignment statement.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * SERIALIZED FORM:</span></span><br><span class="line"><span class="comment"> *   (assign LEFT RIGHT)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AssignExpr</span> :</span> <span class="keyword">public</span> Expr &#123;</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    AssignExpr(Lvalue *left, Expr *e, Location *l);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Visitor *)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">dumpTo</span><span class="params">(<span class="built_in">std</span>::ostream &amp;)</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    Lvalue *left;</span><br><span class="line">    Expr *e;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Node representing a return statement.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * SERIALIZED FORM:</span></span><br><span class="line"><span class="comment"> *   (return EXPR)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ReturnStmt</span> :</span> <span class="keyword">public</span> Statement &#123;</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    ReturnStmt(Expr *e, Location *l);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Visitor *)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">dumpTo</span><span class="params">(<span class="built_in">std</span>::ostream &amp;)</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    Expr *e;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Node representing a while statement.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * SERIALIZED FORM:</span></span><br><span class="line"><span class="comment"> *   (while CONDITION LOOP_BODY) </span></span><br><span class="line"><span class="comment"> *   //(for INIT COND UPDATE LOOP_BODY)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WhileStmt</span> :</span> <span class="keyword">public</span> Statement &#123;</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    WhileStmt(Expr *cond, Statement *loop_body, Location *l);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Visitor *)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">dumpTo</span><span class="params">(<span class="built_in">std</span>::ostream &amp;)</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    Expr *condition;</span><br><span class="line">    Statement *loop_body;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Node representing a for statement.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * SERIALIZED FORM:</span></span><br><span class="line"><span class="comment"> *   (while CONDITION LOOP_BODY) </span></span><br><span class="line"><span class="comment"> *   //(for INIT COND UPDATE LOOP_BODY)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ForStmt</span> :</span> <span class="keyword">public</span> Statement &#123;</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    ForStmt(Statement *init, Expr *cond, Expr *update, Statement *loop_body, Location *l);</span><br><span class="line">    ForStmt(Expr *init, Expr *cond, Expr *update, Statement *loop_body, Location *l);</span><br><span class="line">    ForStmt(Expr *first_condition, Statement *loop_body, Location *l);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Visitor *)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">dumpTo</span><span class="params">(<span class="built_in">std</span>::ostream &amp;)</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    Expr *condition, *update, *first_condition;</span><br><span class="line">    Statement *loop_body;</span><br><span class="line">    ASTNode *init;</span><br><span class="line">    <span class="function">scope::Scope *<span class="title">ATTR</span><span class="params">(scope)</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Node representing an comp statement.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * SERIALIZED FORM:</span></span><br><span class="line"><span class="comment"> *   ( &#123; StmtList &#125; )</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CompStmt</span> :</span> <span class="keyword">public</span> Statement &#123;</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    CompStmt(StmtList *stmts, Location *l);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Visitor *)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">dumpTo</span><span class="params">(<span class="built_in">std</span>::ostream &amp;)</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    StmtList *stmts;</span><br><span class="line"></span><br><span class="line">    <span class="function">scope::Scope *<span class="title">ATTR</span><span class="params">(scope)</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/* Node representing an if statement.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * SERIALIZED FORM:</span></span><br><span class="line"><span class="comment"> *   (if CONDITION TRUE_BRANCH FALSE_BRANCH)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IfStmt</span> :</span> <span class="keyword">public</span> Statement &#123;</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    IfStmt(Expr *cond, Statement *true_branch, Statement *false_branch,</span><br><span class="line">           Location *l);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Visitor *)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">dumpTo</span><span class="params">(<span class="built_in">std</span>::ostream &amp;)</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    Expr *condition;</span><br><span class="line">    Statement *true_brch;</span><br><span class="line">    Statement *false_brch;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Node representing an expression statement.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * SERIALIZED FORM:</span></span><br><span class="line"><span class="comment"> *   (expr EXPR)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ExprStmt</span> :</span> <span class="keyword">public</span> Statement &#123;</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    ExprStmt(Expr *e, Location *l);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Visitor *)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">dumpTo</span><span class="params">(<span class="built_in">std</span>::ostream &amp;)</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    Expr *e;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BreakStmt</span> :</span> <span class="keyword">public</span> Statement &#123;</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    BreakStmt(Location *l);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Visitor *)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">dumpTo</span><span class="params">(<span class="built_in">std</span>::ostream &amp;)</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ContinueStmt</span> :</span> <span class="keyword">public</span> Statement &#123;</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    ContinueStmt(Location *l);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Visitor *)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">dumpTo</span><span class="params">(<span class="built_in">std</span>::ostream &amp;)</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ContStmt</span> :</span> <span class="keyword">public</span> Statement &#123;</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    ContStmt(Location *l);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Visitor *)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">dumpTo</span><span class="params">(<span class="built_in">std</span>::ostream &amp;)</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Node representing the reference to a variable.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">NOTE:</span></span></span><br><span class="line"><span class="comment"> *   (object == NULL) means there is no receiver.</span></span><br><span class="line"><span class="comment"> * SERIALIZED FORM:</span></span><br><span class="line"><span class="comment"> *   (varref VAR_NAME OBJECT_EXPR)</span></span><br><span class="line"><span class="comment"> *   (varref VAR_NAME ())</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">VarRef</span> :</span> <span class="keyword">public</span> Lvalue &#123;</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">//  VarRef (Expr* object, SID var_name,Location* l);</span></span><br><span class="line">    VarRef(<span class="built_in">std</span>::<span class="built_in">string</span> var_name, Location *l);</span><br><span class="line">    VarRef(<span class="built_in">std</span>::<span class="built_in">string</span> var_name, IndexExpr *expr, Location* l);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Visitor *)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">dumpTo</span><span class="params">(<span class="built_in">std</span>::ostream &amp;)</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    Expr *owner; <span class="comment">// only to pass compilation, not used</span></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">string</span> var;</span><br><span class="line">    IndexExpr *expr;</span><br><span class="line"></span><br><span class="line">    <span class="function">symb::Variable *<span class="title">ATTR</span><span class="params">(sym)</span></span>; <span class="comment">// for tac generation</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PointerRef</span> :</span> <span class="keyword">public</span> Lvalue &#123;</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    PointerRef(Expr *pointer, Location *l);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Visitor *)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">dumpTo</span><span class="params">(<span class="built_in">std</span>::ostream &amp;)</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    Expr *pointer;</span><br><span class="line"></span><br><span class="line">    <span class="function">symb::Variable *<span class="title">ATTR</span><span class="params">(sym)</span></span>; <span class="comment">// for tac generation</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Node representing an expression of lvalue.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * SERIALIZED FORM:</span></span><br><span class="line"><span class="comment"> *   (lvalue REFERENCE)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LvalueExpr</span> :</span> <span class="keyword">public</span> Expr &#123;</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    LvalueExpr(Lvalue *lv, Location *l);</span><br><span class="line">    <span class="comment">//   LvalueExpr (Lvalue* lv, Expr* rv,</span></span><br><span class="line">    <span class="comment">//   Location* l);</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Visitor *)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">dumpTo</span><span class="params">(<span class="built_in">std</span>::ostream &amp;)</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    Lvalue *lvalue;</span><br><span class="line">    <span class="comment">// Expr*  rvalue;</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/* Node representing an integer constant .</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * SERIALIZED FORM:</span></span><br><span class="line"><span class="comment"> *   (iconst VALUE)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IntConst</span> :</span> <span class="keyword">public</span> Expr &#123;</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    IntConst(<span class="keyword">int</span> value, Location *l);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Visitor *)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">dumpTo</span><span class="params">(<span class="built_in">std</span>::ostream &amp;)</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">int</span> value;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Node representing a Boolean constant .</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * SERIALIZED FORM:</span></span><br><span class="line"><span class="comment"> *   (bconst VALUE)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BoolConst</span> :</span> <span class="keyword">public</span> Expr &#123;</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    BoolConst(<span class="keyword">bool</span> value, Location *l);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Visitor *)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">dumpTo</span><span class="params">(<span class="built_in">std</span>::ostream &amp;)</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">bool</span> value;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Node representing the null expression .</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * SERIALIZED FORM:</span></span><br><span class="line"><span class="comment"> *   (null)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NullExpr</span> :</span> <span class="keyword">public</span> Expr &#123;</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    NullExpr(Location *l);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Visitor *)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">dumpTo</span><span class="params">(<span class="built_in">std</span>::ostream &amp;)</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Node representing an addition.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * SERIALIZED FORM:</span></span><br><span class="line"><span class="comment"> *   (add EXPR1 EXPR2)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AddExpr</span> :</span> <span class="keyword">public</span> Expr &#123;</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    AddExpr(Expr *e1, Expr *e2, Location *l);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Visitor *)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">dumpTo</span><span class="params">(<span class="built_in">std</span>::ostream &amp;)</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    Expr *e1;</span><br><span class="line">    Expr *e2;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Node representing a substraction.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * SERIALIZED FORM:</span></span><br><span class="line"><span class="comment"> *   (sub EXPR1 EXPR2)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SubExpr</span> :</span> <span class="keyword">public</span> Expr &#123;</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    SubExpr(Expr *e1, Expr *e2, Location *l);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Visitor *)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">dumpTo</span><span class="params">(<span class="built_in">std</span>::ostream &amp;)</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    Expr *e1;</span><br><span class="line">    Expr *e2;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Node representing a multiplcation.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * SERIALIZED FORM:</span></span><br><span class="line"><span class="comment"> *   (mul EXPR1 EXPR2)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MulExpr</span> :</span> <span class="keyword">public</span> Expr &#123;</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    MulExpr(Expr *e1, Expr *e2, Location *l);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Visitor *)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">dumpTo</span><span class="params">(<span class="built_in">std</span>::ostream &amp;)</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    Expr *e1;</span><br><span class="line">    Expr *e2;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Node representing a division.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * SERIALIZED FORM:</span></span><br><span class="line"><span class="comment"> *   (div EXPR1 EXPR2)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DivExpr</span> :</span> <span class="keyword">public</span> Expr &#123;</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    DivExpr(Expr *e1, Expr *e2, Location *l);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Visitor *)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">dumpTo</span><span class="params">(<span class="built_in">std</span>::ostream &amp;)</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    Expr *e1;</span><br><span class="line">    Expr *e2;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Node representing a modular operation.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * SERIALIZED FORM:</span></span><br><span class="line"><span class="comment"> *   (mod EXPR1 EXPR2)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ModExpr</span> :</span> <span class="keyword">public</span> Expr &#123;</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    ModExpr(Expr *e1, Expr *e2, Location *l);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Visitor *)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">dumpTo</span><span class="params">(<span class="built_in">std</span>::ostream &amp;)</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    Expr *e1;</span><br><span class="line">    Expr *e2;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/* Node representing a greater-than comparision.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * SERIALIZED FORM:</span></span><br><span class="line"><span class="comment"> *   (grt EXPR1 EXPR2)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GrtExpr</span> :</span> <span class="keyword">public</span> Expr &#123;</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    GrtExpr(Expr *e1, Expr *e2, Location *l);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Visitor *)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">dumpTo</span><span class="params">(<span class="built_in">std</span>::ostream &amp;)</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    Expr *e1;</span><br><span class="line">    Expr *e2;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Node representing a greater-than-or-equal-to comparision.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * SERIALIZED FORM:</span></span><br><span class="line"><span class="comment"> *   (geq EXPR1 EXPR2)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GeqExpr</span> :</span> <span class="keyword">public</span> Expr &#123;</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    GeqExpr(Expr *e1, Expr *e2, Location *l);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Visitor *)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">dumpTo</span><span class="params">(<span class="built_in">std</span>::ostream &amp;)</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    Expr *e1;</span><br><span class="line">    Expr *e2;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Node representing a less-than comparision.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * SERIALIZED FORM:</span></span><br><span class="line"><span class="comment"> *   (les EXPR1 EXPR2)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LesExpr</span> :</span> <span class="keyword">public</span> Expr &#123;</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    LesExpr(Expr *e1, Expr *e2, Location *l);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Visitor *)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">dumpTo</span><span class="params">(<span class="built_in">std</span>::ostream &amp;)</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    Expr *e1;</span><br><span class="line">    Expr *e2;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Node representing a less-than-or-equal-to comparision.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * SERIALIZED FORM:</span></span><br><span class="line"><span class="comment"> *   (leq EXPR1 EXPR2)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LeqExpr</span> :</span> <span class="keyword">public</span> Expr &#123;</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    LeqExpr(Expr *e1, Expr *e2, Location *l);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Visitor *)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">dumpTo</span><span class="params">(<span class="built_in">std</span>::ostream &amp;)</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    Expr *e1;</span><br><span class="line">    Expr *e2;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Node representing an equivalence comparision.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * SERIALIZED FORM:</span></span><br><span class="line"><span class="comment"> *   (equ EXPR1 EXPR2)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">EquExpr</span> :</span> <span class="keyword">public</span> Expr &#123;</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    EquExpr(Expr *e1, Expr *e2, Location *l);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Visitor *)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">dumpTo</span><span class="params">(<span class="built_in">std</span>::ostream &amp;)</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    Expr *e1;</span><br><span class="line">    Expr *e2;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/* Node representing an non-equivalence comparision.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * SERIALIZED FORM:</span></span><br><span class="line"><span class="comment"> *   (neq EXPR1 EXPR2)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NeqExpr</span> :</span> <span class="keyword">public</span> Expr &#123;</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    NeqExpr(Expr *e1, Expr *e2, Location *l);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Visitor *)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">dumpTo</span><span class="params">(<span class="built_in">std</span>::ostream &amp;)</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    Expr *e1;</span><br><span class="line">    Expr *e2;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Node representing a logical-and operation .</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * SERIALIZED FORM:</span></span><br><span class="line"><span class="comment"> *   (and EXPR1 EXPR2)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AndExpr</span> :</span> <span class="keyword">public</span> Expr &#123;</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    AndExpr(Expr *e1, Expr *e2, Location *l);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Visitor *)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">dumpTo</span><span class="params">(<span class="built_in">std</span>::ostream &amp;)</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    Expr *e1;</span><br><span class="line">    Expr *e2;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Node representing a logical-or operation .</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * SERIALIZED FORM:</span></span><br><span class="line"><span class="comment"> *   (and EXPR1 EXPR2)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OrExpr</span> :</span> <span class="keyword">public</span> Expr &#123;</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    OrExpr(Expr *e1, Expr *e2, Location *l);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Visitor *)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">dumpTo</span><span class="params">(<span class="built_in">std</span>::ostream &amp;)</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    Expr *e1;</span><br><span class="line">    Expr *e2;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IfExpr</span> :</span> <span class="keyword">public</span> Expr &#123;</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    IfExpr(Expr *cond, Expr *e1, Expr *e2, Location *l);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Visitor *)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">dumpTo</span><span class="params">(<span class="built_in">std</span>::ostream &amp;)</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    Expr *condition;</span><br><span class="line">    Expr *true_brch;</span><br><span class="line">    Expr *false_brch;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Node representing a negating operation.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * SERIALIZED FORM:</span></span><br><span class="line"><span class="comment"> *   (neg EXPR)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NegExpr</span> :</span> <span class="keyword">public</span> Expr &#123;</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    NegExpr(Expr *e, Location *l);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Visitor *)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">dumpTo</span><span class="params">(<span class="built_in">std</span>::ostream &amp;)</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    Expr *e;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/* Node representing a logical-not operation.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * SERIALIZED FORM:</span></span><br><span class="line"><span class="comment"> *   (not EXPR)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NotExpr</span> :</span> <span class="keyword">public</span> Expr &#123;</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    NotExpr(Expr *e, Location *l);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Visitor *)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">dumpTo</span><span class="params">(<span class="built_in">std</span>::ostream &amp;)</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    Expr *e;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/* Node representing a bitwise-not operation.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * SERIALIZED FORM:</span></span><br><span class="line"><span class="comment"> *   (bitnot EXPR)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BitNotExpr</span> :</span> <span class="keyword">public</span> Expr &#123;</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    BitNotExpr(Expr *e, Location *l);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Visitor *)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">dumpTo</span><span class="params">(<span class="built_in">std</span>::ostream &amp;)</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    Expr *e;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">extern</span> <span class="keyword">bool</span> print_decorated_ast;</span><br><span class="line">&#125; <span class="comment">// namespace ast</span></span><br><span class="line">&#125; <span class="comment">// namespace mind</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">// __MIND_AST__</span></span></span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*****************************************************</span></span><br><span class="line"><span class="comment"> *  Implementation of the &quot;ASTNode&quot; abstract class.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *  Keltin Leung </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;ast/ast.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;config.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;location.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;options.hpp&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> mind;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> mind::ast;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*  Names of the AST nodes.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">NOTE:</span> The order of node_name&#x27;s must be the same with that of NodeType&#x27;s.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">char</span> *ASTNode::node_name[] = &#123;<span class="string">&quot;add&quot;</span>,</span><br><span class="line">                                    <span class="string">&quot;and&quot;</span>,</span><br><span class="line">                                    <span class="string">&quot;assign&quot;</span>,</span><br><span class="line">                                    <span class="string">&quot;bconst&quot;</span>,</span><br><span class="line">                                    <span class="string">&quot;bitnot&quot;</span>,</span><br><span class="line"></span><br><span class="line">                                    <span class="string">&quot;btype&quot;</span>,</span><br><span class="line">                                    <span class="string">&quot;break&quot;</span>,</span><br><span class="line">                                    <span class="string">&quot;continue&quot;</span>,</span><br><span class="line">                                    <span class="string">&quot;call&quot;</span>,</span><br><span class="line">                                    <span class="string">&quot;comp&quot;</span>,</span><br><span class="line">                                    <span class="string">&quot;div&quot;</span>,</span><br><span class="line"></span><br><span class="line">                                    <span class="string">&quot;equ&quot;</span>,</span><br><span class="line">                                    <span class="string">&quot;empty&quot;</span>,</span><br><span class="line">                                    <span class="string">&quot;expr&quot;</span>,</span><br><span class="line">                                    <span class="string">&quot;func&quot;</span>,</span><br><span class="line">                                    <span class="string">&quot;geq&quot;</span>,</span><br><span class="line"></span><br><span class="line">                                    <span class="string">&quot;grt&quot;</span>,</span><br><span class="line">                                    <span class="string">&quot;if&quot;</span>,</span><br><span class="line">                                    <span class="string">&quot;if&quot;</span>,</span><br><span class="line">                                    <span class="string">&quot;iconst&quot;</span>,</span><br><span class="line">                                    <span class="string">&quot;itype&quot;</span>,</span><br><span class="line">                                    <span class="string">&quot;leq&quot;</span>,</span><br><span class="line">                                    <span class="string">&quot;les&quot;</span>,</span><br><span class="line">                                    <span class="string">&quot;lvalue&quot;</span>,</span><br><span class="line">                                    <span class="string">&quot;mod&quot;</span>,</span><br><span class="line">                                    <span class="string">&quot;mul&quot;</span>,</span><br><span class="line">                                    <span class="string">&quot;neg&quot;</span>,</span><br><span class="line">                                    <span class="string">&quot;neq&quot;</span>,</span><br><span class="line">                                    <span class="string">&quot;not&quot;</span>,</span><br><span class="line">                                    <span class="string">&quot;or&quot;</span>,</span><br><span class="line">                                    <span class="string">&quot;program&quot;</span>,</span><br><span class="line">                                    <span class="string">&quot;return&quot;</span>,</span><br><span class="line">                                    <span class="string">&quot;sub&quot;</span>,</span><br><span class="line">                                    <span class="string">&quot;var&quot;</span>,</span><br><span class="line">                                    <span class="string">&quot;varref&quot;</span>,</span><br><span class="line">                                    <span class="string">&quot;while&quot;</span>,</span><br><span class="line">                                    <span class="string">&quot;for&quot;</span>,</span><br><span class="line">                                    <span class="string">&quot;FuncOrDecl&quot;</span>,</span><br><span class="line">                                    <span class="string">&quot;index&quot;</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*  Whether to print the decorated abstract syntax tree.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">bool</span> print_decorated_ast = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*  Sets the basic information of a node.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *  PARAMETERS:</span></span><br><span class="line"><span class="comment"> *    k     - the node kind</span></span><br><span class="line"><span class="comment"> *    l     - position in the source text</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ASTNode::setBasicInfo</span><span class="params">(NodeType k, Location *l)</span> </span>&#123;</span><br><span class="line">    kind = k;</span><br><span class="line">    loc = l;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*  Gets the node kind.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *  RETURNS:</span></span><br><span class="line"><span class="comment"> *    the node kind</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">ASTNode::NodeType <span class="title">ASTNode::getKind</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123; <span class="keyword">return</span> kind; &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*  Gets the source text location of this node</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *  RETURNS:</span></span><br><span class="line"><span class="comment"> *    the source text location</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">Location *<span class="title">ASTNode::getLocation</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123; <span class="keyword">return</span> loc; &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*  Dumps this node to an output stream.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *  PARAMETERS:</span></span><br><span class="line"><span class="comment"> *    os    - the output stream</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ASTNode::dumpTo</span><span class="params">(<span class="built_in">std</span>::ostream &amp;os)</span> </span>&#123;</span><br><span class="line">    os &lt;&lt; <span class="string">&quot;(&quot;</span> &lt;&lt; node_name[kind];</span><br><span class="line">    <span class="keyword">if</span> (Option::getLevel() != Option::PARSER)</span><br><span class="line">        os &lt;&lt; <span class="string">&quot; (&quot;</span> &lt;&lt; loc-&gt;line &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; loc-&gt;col &lt;&lt; <span class="string">&quot;)&quot;</span>;</span><br><span class="line">    incIndent(os);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*  Outputs an ASTNode.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *  PARAMETERS:</span></span><br><span class="line"><span class="comment"> *    os    - the output stream</span></span><br><span class="line"><span class="comment"> *    p     - the ASTNode</span></span><br><span class="line"><span class="comment"> *  RETURNS:</span></span><br><span class="line"><span class="comment"> *    the output stream</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="built_in">std</span>::ostream &amp;mind::<span class="keyword">operator</span>&lt;&lt;(<span class="built_in">std</span>::ostream &amp;os, ASTNode *p) &#123;</span><br><span class="line">    <span class="keyword">if</span> (p == <span class="literal">NULL</span>)</span><br><span class="line">        os &lt;&lt; <span class="string">&quot;!!NULL!!&quot;</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        p-&gt;dumpTo(os);</span><br><span class="line">    <span class="keyword">return</span> os;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*  Outputs a FuncList.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *  PARAMETERS:</span></span><br><span class="line"><span class="comment"> *    os    - the output stream</span></span><br><span class="line"><span class="comment"> *    l     - the Func list</span></span><br><span class="line"><span class="comment"> *  RETURNS:</span></span><br><span class="line"><span class="comment"> *    the output stream</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="built_in">std</span>::ostream &amp;mind::<span class="keyword">operator</span>&lt;&lt;(<span class="built_in">std</span>::ostream &amp;os, FuncList *l) &#123;</span><br><span class="line">    os &lt;&lt; <span class="string">&quot;[&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span> (!l-&gt;empty()) &#123;</span><br><span class="line">        incIndent(os);</span><br><span class="line">        os &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">        FuncList::iterator it = l-&gt;begin();</span><br><span class="line">        os &lt;&lt; *it;</span><br><span class="line">        <span class="keyword">while</span> (++it != l-&gt;end()) &#123;</span><br><span class="line">            newLine(os);</span><br><span class="line">            os &lt;&lt; *it;</span><br><span class="line">        &#125;</span><br><span class="line">        decIndent(os);</span><br><span class="line">        newLine(os);</span><br><span class="line">    &#125;</span><br><span class="line">    os &lt;&lt; <span class="string">&quot;]&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> os;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*  Outputs a VarList.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *  PARAMETERS:</span></span><br><span class="line"><span class="comment"> *    os    - the output stream</span></span><br><span class="line"><span class="comment"> *    l     - the VarDecl list</span></span><br><span class="line"><span class="comment"> *  RETURNS:</span></span><br><span class="line"><span class="comment"> *    the output stream</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="built_in">std</span>::ostream &amp;mind::<span class="keyword">operator</span>&lt;&lt;(<span class="built_in">std</span>::ostream &amp;os, VarList *l) &#123;</span><br><span class="line">    os &lt;&lt; <span class="string">&quot;[&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span> (!l-&gt;empty()) &#123;</span><br><span class="line">        incIndent(os);</span><br><span class="line">        os &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">        VarList::iterator it = l-&gt;begin();</span><br><span class="line">        os &lt;&lt; *it;</span><br><span class="line">        <span class="keyword">while</span> (++it != l-&gt;end()) &#123;</span><br><span class="line">            newLine(os);</span><br><span class="line">            os &lt;&lt; *it;</span><br><span class="line">        &#125;</span><br><span class="line">        decIndent(os);</span><br><span class="line">        newLine(os);</span><br><span class="line">    &#125;</span><br><span class="line">    os &lt;&lt; <span class="string">&quot;]&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> os;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*  Outputs a StmtList.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *  PARAMETERS:</span></span><br><span class="line"><span class="comment"> *    os    - the output stream</span></span><br><span class="line"><span class="comment"> *    l     - the Statement list</span></span><br><span class="line"><span class="comment"> *  RETURNS:</span></span><br><span class="line"><span class="comment"> *    the output stream</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="built_in">std</span>::ostream &amp;mind::<span class="keyword">operator</span>&lt;&lt;(<span class="built_in">std</span>::ostream &amp;os, StmtList *l) &#123;</span><br><span class="line">    os &lt;&lt; <span class="string">&quot;[&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span> (!l-&gt;empty()) &#123;</span><br><span class="line">        incIndent(os);</span><br><span class="line">        os &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">        StmtList::iterator it = l-&gt;begin();</span><br><span class="line">        os &lt;&lt; *it;</span><br><span class="line">        <span class="keyword">while</span> (++it != l-&gt;end()) &#123;</span><br><span class="line"></span><br><span class="line">            newLine(os);</span><br><span class="line">            os &lt;&lt; *it;</span><br><span class="line">        &#125;</span><br><span class="line">        decIndent(os);</span><br><span class="line">        newLine(os);</span><br><span class="line">    &#125;</span><br><span class="line">    os &lt;&lt; <span class="string">&quot;]&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> os;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*  Outputs an ExprList .</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *  PARAMETERS:</span></span><br><span class="line"><span class="comment"> *    os    - the output stream</span></span><br><span class="line"><span class="comment"> *    l     - the Expr list</span></span><br><span class="line"><span class="comment"> *  RETURNS:</span></span><br><span class="line"><span class="comment"> *    the output stream</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="built_in">std</span>::ostream &amp;mind::<span class="keyword">operator</span>&lt;&lt;(<span class="built_in">std</span>::ostream &amp;os, ExprList *l) &#123;</span><br><span class="line">    os &lt;&lt; <span class="string">&quot;[&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span> (!l-&gt;empty()) &#123;</span><br><span class="line">        incIndent(os);</span><br><span class="line">        os &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">        ExprList::iterator it = l-&gt;begin();</span><br><span class="line">        os &lt;&lt; *it;</span><br><span class="line">        <span class="keyword">while</span> (++it != l-&gt;end()) &#123;</span><br><span class="line">            newLine(os);</span><br><span class="line">            os &lt;&lt; *it;</span><br><span class="line">        &#125;</span><br><span class="line">        decIndent(os);</span><br><span class="line">        newLine(os);</span><br><span class="line">    &#125;</span><br><span class="line">    os &lt;&lt; <span class="string">&quot;]&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> os;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">std</span>::ostream &amp;mind::<span class="keyword">operator</span>&lt;&lt;(<span class="built_in">std</span>::ostream &amp;os, DimList *l) &#123;</span><br><span class="line">    os &lt;&lt; <span class="string">&quot;[&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span> (!l-&gt;empty()) &#123;</span><br><span class="line">        incIndent(os);</span><br><span class="line">        os &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">        DimList::iterator it = l-&gt;begin();</span><br><span class="line">        os &lt;&lt; *it;</span><br><span class="line">        <span class="keyword">while</span> (++it != l-&gt;end()) &#123;</span><br><span class="line">            newLine(os);</span><br><span class="line">            os &lt;&lt; *it;</span><br><span class="line">        &#125;</span><br><span class="line">        decIndent(os);</span><br><span class="line">        newLine(os);</span><br><span class="line">    &#125;</span><br><span class="line">    os &lt;&lt; <span class="string">&quot;]&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> os;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">std</span>::ostream &amp;mind::<span class="keyword">operator</span>&lt;&lt;(<span class="built_in">std</span>::ostream &amp;os, FuncOrGlobalList *l) &#123;</span><br><span class="line">    os &lt;&lt; <span class="string">&quot;[&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span> (!l-&gt;empty()) &#123;</span><br><span class="line">        incIndent(os);</span><br><span class="line">        os &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">        FuncOrGlobalList::iterator it = l-&gt;begin();</span><br><span class="line">        os &lt;&lt; *it;</span><br><span class="line">        <span class="keyword">while</span> (++it != l-&gt;end()) &#123;</span><br><span class="line"></span><br><span class="line">            newLine(os);</span><br><span class="line">            os &lt;&lt; *it;</span><br><span class="line">        &#125;</span><br><span class="line">        decIndent(os);</span><br><span class="line">        newLine(os);</span><br><span class="line">    &#125;</span><br><span class="line">    os &lt;&lt; <span class="string">&quot;]&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> os;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*****************************************************</span></span><br><span class="line"><span class="comment"> *  Definition of the AST visitor pattern.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *  It is only an interface (we provide an empty body</span></span><br><span class="line"><span class="comment"> *  just to make your life easier..).</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *  Keltin Leung </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> __MIND_VISITOR__</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __MIND_VISITOR__</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;ast/ast.hpp&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> mind &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> ast &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*  AST Visitor Pattern.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *  HOW TO USE:</span></span><br><span class="line"><span class="comment"> *    1. Create a subclass of Visitor;</span></span><br><span class="line"><span class="comment"> *    2. Implement visit(ast::Program*)  (required);</span></span><br><span class="line"><span class="comment"> *    3. Implement the other visiting functions as you need;</span></span><br><span class="line"><span class="comment"> *    4. We provide an empty function body (&#123;  &#125;) instead of</span></span><br><span class="line"><span class="comment"> *       setting it pure (= 0) so that you do not need to</span></span><br><span class="line"><span class="comment"> *       implement all the functions as you do with a pure</span></span><br><span class="line"><span class="comment"> *       interface.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Visitor</span> &#123;</span></span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// Expressions</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">visit</span><span class="params">(CallExpr *)</span> </span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">visit</span><span class="params">(AddExpr *)</span> </span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">visit</span><span class="params">(AndExpr *)</span> </span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">visit</span><span class="params">(AssignExpr *)</span> </span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">visit</span><span class="params">(IfExpr *)</span> </span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">visit</span><span class="params">(OrExpr *)</span> </span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">visit</span><span class="params">(BoolConst *)</span> </span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">visit</span><span class="params">(DivExpr *)</span> </span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">visit</span><span class="params">(EquExpr *)</span> </span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">visit</span><span class="params">(GeqExpr *)</span> </span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">visit</span><span class="params">(GrtExpr *)</span> </span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">visit</span><span class="params">(NeqExpr *)</span> </span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">visit</span><span class="params">(IntConst *)</span> </span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">visit</span><span class="params">(LeqExpr *)</span> </span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">visit</span><span class="params">(LesExpr *)</span> </span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">visit</span><span class="params">(LvalueExpr *)</span> </span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">visit</span><span class="params">(ModExpr *)</span> </span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">visit</span><span class="params">(MulExpr *)</span> </span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">visit</span><span class="params">(NegExpr *)</span> </span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">visit</span><span class="params">(NotExpr *)</span> </span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">visit</span><span class="params">(BitNotExpr *)</span> </span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">visit</span><span class="params">(SubExpr *)</span> </span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">visit</span><span class="params">(IndexExpr *)</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Lvalues</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">visit</span><span class="params">(VarRef *)</span> </span>&#123;&#125;</span><br><span class="line">    <span class="comment">// Types</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">visit</span><span class="params">(BoolType *)</span> </span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">visit</span><span class="params">(IntType *)</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Statements</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">visit</span><span class="params">(ExprStmt *)</span> </span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">visit</span><span class="params">(CompStmt *)</span> </span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">visit</span><span class="params">(WhileStmt *)</span> </span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">visit</span><span class="params">(ForStmt *)</span> </span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">visit</span><span class="params">(EmptyStmt *)</span> </span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">visit</span><span class="params">(BreakStmt *)</span> </span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">visit</span><span class="params">(ContinueStmt *)</span> </span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">visit</span><span class="params">(IfStmt *)</span> </span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">visit</span><span class="params">(ReturnStmt *)</span> </span>&#123;&#125;</span><br><span class="line">    <span class="comment">// Declarations</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">visit</span><span class="params">(Program *)</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">visit</span><span class="params">(FuncDefn *)</span> </span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">visit</span><span class="params">(VarDecl *)</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">virtual</span> ~Visitor() &#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line">&#125; <span class="comment">// namespace ast</span></span><br><span class="line">&#125; <span class="comment">// namespace mind</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">// __MIND_VISITOR__</span></span></span><br></pre></td></tr></table></figure><h2 id="Update"><a href="#Update" class="headerlink" title="Update"></a>Update</h2><p>新找到一个项目,<a href="git@github.com:DoctorWkt/acwj.git">journey to compiler</a></p><p>这个比较好一点,我尝试照着这个做一下.可能要分几个专题.</p><h3 id="lexical-scanning"><a href="#lexical-scanning" class="headerlink" title="lexical scanning"></a>lexical scanning</h3><p>首先开始词法分析,主要是识别+ - * /和字面数字</p><blockquote><p>However, there will be times when we need to “put back” a character if we have read too far ahead in the input stream. We also want to track what line we are currently on so that we can print the line number in our debug messages. All of this is done by the <code>next()</code> function:</p></blockquote><p><img data-src="https://s2.loli.net/2022/05/30/kIOan4cNbL839Kf.png" alt="大致流程" style="zoom:67%;" /></p><h3 id="parser"><a href="#parser" class="headerlink" title="parser"></a>parser</h3><p>语法分析设计到BNF或者EBNF.需要设计AST.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// AST node types</span></span><br><span class="line"><span class="class"><span class="keyword">enum</span> &#123;</span></span><br><span class="line">  A_ADD, A_SUBTRACT, A_MULTIPLY, A_DIVIDE, A_INTLIT</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Abstract Syntax Tree structure</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ASTnode</span> &#123;</span></span><br><span class="line">  <span class="keyword">int</span> op;                               <span class="comment">// &quot;Operation&quot; to be performed on this tree</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">ASTnode</span> *<span class="title">left</span>;</span>                 <span class="comment">// Left and right child trees</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">ASTnode</span> *<span class="title">right</span>;</span></span><br><span class="line">  <span class="keyword">int</span> intvalue;                         <span class="comment">// For A_INTLIT, the integer value</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>defs文件新增ASTnode</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ASTnode</span> &#123;</span></span><br><span class="line">  <span class="comment">// op to be performed on this tree</span></span><br><span class="line">  <span class="comment">// e.g. A_ADD</span></span><br><span class="line">  <span class="keyword">int</span> op;</span><br><span class="line">  <span class="comment">// left and right child tree</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">ASTnode</span> *<span class="title">left</span>;</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">ASTnode</span> *<span class="title">right</span>;</span></span><br><span class="line">  <span class="keyword">int</span> intvalue; <span class="comment">//for integer</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>增加产生ast节点函数</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">struct ASTnode *<span class="title">binexpr</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">ASTnode</span> *<span class="title">n</span>, *<span class="title">left</span>, *<span class="title">right</span>;</span></span><br><span class="line">  <span class="keyword">int</span> nodetype;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 左值</span></span><br><span class="line">  <span class="comment">// Get the integer literal on the left.</span></span><br><span class="line">  <span class="comment">// Fetch the next token at the same time.</span></span><br><span class="line">  left = primary();</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span> (Token.token == _EOF)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">return</span> left;</span><br><span class="line">  &#125;</span><br><span class="line">  nodetype = tok2aop(Token.token);</span><br><span class="line"></span><br><span class="line">  scan(&amp;Token);</span><br><span class="line">  <span class="comment">// 创建右值</span></span><br><span class="line">  right = binexpr();</span><br><span class="line"></span><br><span class="line">  n = mkastnode(nodetype, left, right, <span class="number">0</span>);</span><br><span class="line">  <span class="keyword">return</span> n;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>以及对于ast节点赋值的一些操作.</p><p>还需要遍历树结构,这里采用先序遍历.</p><h2 id="misc"><a href="#misc" class="headerlink" title="misc"></a>misc</h2><p><a href="https://www.cnblogs.com/EQ1024/p/15660909.html">Docker -v | volume 挂载宿主机目录导致容器内文件被覆盖问题 - 二柒席地而坐 - 博客园 (cnblogs.com)</a></p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      
        <tags>
            
            <tag> c </tag>
            
            <tag> compiler </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>html精学</title>
      <link href="2022/05/02/html%E7%B2%BE%E5%AD%A6/"/>
      <url>2022/05/02/html%E7%B2%BE%E5%AD%A6/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>之前多次学习过html,css.奈何每次学了就忘,写的东西也不多(写了也忘).这里打算写一些html的基本知识和前沿新东西巩固一下.<br><span id="more"></span></p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      
        <tags>
            
            <tag> html </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>GAN学习</title>
      <link href="2022/04/30/GAN%E5%AD%A6%E4%B9%A0/"/>
      <url>2022/04/30/GAN%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>好累<br><span id="more"></span></p><p>使用keras构建</p><h2 id="GAN理论"><a href="#GAN理论" class="headerlink" title="GAN理论"></a>GAN理论</h2><p><a href="https://arxiv.org/abs/1406.2661">GAN</a>（Generative Adversarial Networks，生成式对抗网络）由 Goodfellow 等人于 2014 年提出，它能够迫使网络生成的合成图像与真实图像在统计上几乎无法区分，从而获得相当逼真的合成图像。</p><p>GAN 由以下两部分组成：</p><ul><li>生成器网络（Generator Network）：它以一个随机向量作为输入，并将其解码为一张合成图像。</li><li>判别器网络（Discriminator Network）：以一张图像作为输入，并预测该图像是来自训练集的真实图像还是由生成器网络生成的合成图像</li></ul><blockquote><p>想象一名伪造者试图伪造一副毕加索的画作。一开始，伪造者非常不擅长这项任务。他将自己的一些赝品与毕加索真迹混在一起，并将其展示给一位艺术商人。艺术商人对每幅画进行真实性评估，并向伪造者给出反馈，告诉他是什么让毕加索作品看起来像一幅毕加索作品。伪造者回到自己的工作室，并准备一些新的赝品。随着时间的推移，伪造者变得越来越擅长模仿毕加索的风格，艺术商人也变得越来越擅长找出赝品。最后，他们手上拥有了一些优秀的毕加索赝品。</p></blockquote><p><img data-src="https://dn-simplecloud.shiyanlou.com/questions/uid788648-20190514-1557814594170" alt="img" style="zoom:50%;" /></p><ul><li>一开始，我们手头上只有真实图像，生成器首先根据潜在空间中的随机向量生成第一批合成图像，由于没有参照物，得到的图像很糟糕。</li><li>接着，将合成图像的标签设为 0，真实图像的标签设为 1，混合后输入到判别器中。这时判别器就像一个二元分类器，它输出每张图像为真实图像的概率，使得输入真实图像时，输出向 1 靠近，输入合成图像时，输出向 0 靠近，由此形成一个判别标准。</li><li>然后，训练生成器，根据判别器的训练反馈结果更新参数，训练生成器网络的目的是使其能够欺骗判别器网络，因此随着训练的进行，它能够逐渐生成越来越逼真的图像，即看起来与真实图像无法区分的人造图像，以至于判别器网络无法区分二者。与此同时，判别器也在不断适应生成器逐渐提高的能力，使得其判别真假图像的能力愈来愈高。</li><li>一旦训练结束，在最理想的状态下，生成器就能够生成十分逼真的合成图像，使得判别器无法辨别真实图像和合成图像的差别。</li></ul><h3 id="开始"><a href="#开始" class="headerlink" title="开始"></a>开始</h3><p>本节分步实现一个最原始的 GAN，并使用 <a href="http://yann.lecun.com/exdb/mnist/">MNIST</a> 手写数字数据集中的图像作为真实图像，在 GAN 上合成手写数字图像。</p><h4 id="生成器"><a href="#生成器" class="headerlink" title="生成器"></a>生成器</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">img_rows = <span class="number">28</span></span><br><span class="line">img_cols = <span class="number">28</span></span><br><span class="line">channels = <span class="number">1</span></span><br><span class="line">img_shape = (img_rows, img_cols, channels)</span><br><span class="line">latent_dim = <span class="number">100</span></span><br><span class="line"></span><br><span class="line">generator_input = Input(shape=(latent_dim,))</span><br><span class="line"></span><br><span class="line"><span class="comment"># model</span></span><br><span class="line">x = Dense(<span class="number">256</span>)(generator_input)</span><br><span class="line">x = LeakyReLU(alpha=<span class="number">0.2</span>)(x)</span><br><span class="line">x = BatchNormalization(momentum=<span class="number">0.8</span>)(x)</span><br><span class="line">x = Dense(<span class="number">512</span>)(x)</span><br><span class="line">x = LeakyReLU(alpha=<span class="number">0.2</span>)(x)</span><br><span class="line">x = BatchNormalization(momentum=<span class="number">0.8</span>)(x)</span><br><span class="line">x = Dense(<span class="number">1024</span>)(x)</span><br><span class="line">x = LeakyReLU(alpha=<span class="number">0.2</span>)(x)</span><br><span class="line">x = BatchNormalization(momentum=<span class="number">0.8</span>)(x)</span><br><span class="line"></span><br><span class="line">x = Dense(np.prod(img_shape), activation=<span class="string">&#x27;tanh&#x27;</span>)(x)</span><br><span class="line">x = Reshape(img_shape)(x)</span><br><span class="line"></span><br><span class="line">generator = Model(generator_input,x)</span><br><span class="line"><span class="built_in">print</span>(generator.summary())</span><br></pre></td></tr></table></figure><p>上面是一个生成器,可以看到我们尝试输入一个大小为100向量,输出为28x28x1的矩阵.即单通道28x28的图像.</p><p><img data-src="https://s2.loli.net/2022/04/30/aMONJ15GRljTh79.png" alt="Generator模型" style="zoom: 67%;" /></p><h4 id="判别器"><a href="#判别器" class="headerlink" title="判别器"></a>判别器</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">discriminator_input = Input(shape=img_shape)</span><br><span class="line">x = Flatten()(discriminator_input)</span><br><span class="line">x = Dense(<span class="number">512</span>)(x)</span><br><span class="line">x = LeakyReLU(alpha=<span class="number">0.2</span>)(x)</span><br><span class="line">x = Dense(<span class="number">256</span>)(x)</span><br><span class="line">x = LeakyReLU(alpha=<span class="number">0.2</span>)(x)</span><br><span class="line">x = Dense(<span class="number">1</span>,activation=<span class="string">&#x27;sigmoid&#x27;</span>)(x)</span><br><span class="line">discriminator = Model(discriminator_input,x)</span><br><span class="line"><span class="built_in">print</span>(discriminator.summary())</span><br></pre></td></tr></table></figure><p>输入时MINIST数据集的数据,中间都是全连接层,加的leakyrelu激活函数.注意最后输出一个值,表示是不是真的图像,如果大则表示相近.</p><p><img data-src="https://s2.loli.net/2022/04/30/3G5mHqLE4icVWvS.png" alt="discriminator模型"></p><p>编译判别器网络</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">discriminator.<span class="built_in">compile</span>(loss=<span class="string">&#x27;binary_crossentropy&#x27;</span>,</span><br><span class="line">                      optimizer=<span class="string">&#x27;adam&#x27;</span>,metrics=[<span class="string">&#x27;accuracy&#x27;</span>])</span><br></pre></td></tr></table></figure><h4 id="构建GAN"><a href="#构建GAN" class="headerlink" title="构建GAN"></a>构建GAN</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">gan_input = Input(shape=(latent_dim,))</span><br><span class="line">generator_image = generator(gan_input)</span><br><span class="line"></span><br><span class="line">discriminator.trainable = <span class="literal">False</span></span><br><span class="line">gan_output = discriminator(generator_image)</span><br><span class="line"></span><br><span class="line">gan = Model(gan_input,gan_output)</span><br><span class="line"></span><br><span class="line">gan.<span class="built_in">compile</span>(loss=<span class="string">&#x27;binary_crossentropy&#x27;</span>,optimizer=<span class="string">&#x27;adam&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(gan.summary())</span><br></pre></td></tr></table></figure><p>编译GAN </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gan.<span class="built_in">compile</span>(loss=<span class="string">&#x27;binary_crossentropy&#x27;</span>,</span><br><span class="line">            optimizer=<span class="string">&#x27;adam&#x27;</span>)</span><br></pre></td></tr></table></figure><ul><li>从潜在空间中抽取随机的点，即随机噪声。</li><li>利用这些随机噪声通过生成器生成图像。</li><li>将生成的合成图像与真实图像混合。</li><li>使用这些混合后的图像以及相应的标签（真实图像为「1」，合成图像为「0」）来训练判别器。</li><li>在潜在空间中随机抽取新的点。</li><li>使用这些新的随机向量以及全部是「1」的标签训练 GAN。由于此时已经在 GAN 模型中冻结了判别器，故只会更新生成器的权重，其更新方向是使得判别器能够将合成图像预测为「真实图像」。这个过程就是训练生成器去欺骗判别器。</li></ul><p>导入数据</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> tensorflow.keras.datasets <span class="keyword">import</span> mnist</span><br><span class="line">(X_train, _), (_, _) = mnist.load_data()</span><br></pre></td></tr></table></figure><p>数据标准化，将每张图像的每个像素值都缩放到 -1 至 1 之间，有利于模型学习与训练。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">X_train = X_train / <span class="number">127.5</span> - <span class="number">1.</span></span><br></pre></td></tr></table></figure><p>由于数据是6000*28*28,缺少一个维度,我们需要28*28*1</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">X_train = np.expand_dims(X_train, axis=<span class="number">3</span>)</span><br></pre></td></tr></table></figure><p>接下来开始训练</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">epochs = <span class="number">1000</span></span><br><span class="line">batch_size = <span class="number">128</span></span><br><span class="line"><span class="comment"># 标签 label</span></span><br><span class="line">valid = np.ones((batch_size, <span class="number">1</span>))</span><br><span class="line">fake = np.zeros((batch_size, <span class="number">1</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> epochs <span class="keyword">in</span> <span class="built_in">range</span>(epochs):</span><br><span class="line">    <span class="comment"># 训练判别器</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 随机选一个batch的照片</span></span><br><span class="line">    idx = np.random.randint(<span class="number">0</span>, X_train.shape[<span class="number">0</span>], batch_size)</span><br><span class="line">    imgs = X_train[idx]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 生成噪音(一般正态分布)</span></span><br><span class="line">    noise = np.random.normal(<span class="number">0</span>, <span class="number">1</span>, (batch_size, latent_dim))</span><br><span class="line">    <span class="comment"># 根据噪音生成图片</span></span><br><span class="line">    gen_imgs = generator.predict(noise)</span><br><span class="line">    d_loss_real = discriminator.train_on_batch(imgs, valid)</span><br><span class="line">    d_loss_fake = discriminator.train_on_batch(gen_imgs, fake)</span><br><span class="line"></span><br><span class="line">    d_loss = <span class="number">0.5</span> * np.add(d_loss_fake, d_loss_real)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 使用这些随机向量以及全部是「1」的标签</span></span><br><span class="line">    <span class="comment"># 通过 GAN 模型训练生成器（此时判别器权重已被冻结）</span></span><br><span class="line">    noise = np.random.normal(<span class="number">0</span>, <span class="number">1</span>, (batch_size, latent_dim))</span><br><span class="line">    g_loss = gan.train_on_batch(noise, valid)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> epochs % <span class="number">200</span> == <span class="number">0</span>:</span><br><span class="line">        <span class="comment">#  打印出判别器的损失值 loss 和 准确率 acc，及生成器的 loss</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;%d [D loss:%f,acc:%.2f%%][G loss:%f]&quot;</span> % (epochs, d_loss[<span class="number">0</span>], <span class="number">100</span> * d_loss[<span class="number">1</span>], g_loss))</span><br><span class="line">        gen_imgs = <span class="number">0.5</span> * gen_imgs + <span class="number">0.5</span></span><br><span class="line">        _, axs = plt.subplots(<span class="number">5</span>, <span class="number">5</span>)</span><br><span class="line">        cnt = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">                axs[i, j].imshow(gen_imgs[cnt, :, :, <span class="number">0</span>], cmap=<span class="string">&#x27;gray&#x27;</span>)</span><br><span class="line">                axs[i, j].axis(<span class="string">&#x27;off&#x27;</span>)</span><br><span class="line">                cnt += <span class="number">1</span></span><br><span class="line">        plt.show()</span><br><span class="line">        plt.close()</span><br><span class="line">        <span class="comment"># _, axs = plt.subplots(5, 5)</span></span><br><span class="line">        <span class="comment"># cnt = 0</span></span><br><span class="line">        <span class="comment"># for i in range(5):</span></span><br><span class="line">        <span class="comment">#     for j in range(5):</span></span><br><span class="line">        <span class="comment">#         axs[i, j].imshow(X_train[cnt, :, :, 0], cmap=&#x27;gray&#x27;)</span></span><br><span class="line">        <span class="comment">#         axs[i, j].axis(&#x27;off&#x27;)</span></span><br><span class="line">        <span class="comment">#         cnt += 1</span></span><br><span class="line">        <span class="comment"># plt.show()</span></span><br><span class="line">        <span class="comment"># plt.close()</span></span><br></pre></td></tr></table></figure><h3 id="结果"><a href="#结果" class="headerlink" title="结果"></a>结果</h3><p><img data-src="https://s2.loli.net/2022/04/30/87lfTjUcZip1Gk5.png" alt="image0" style="zoom:50%;" /></p><p><img data-src="https://s2.loli.net/2022/04/30/IPy2vi5EGBlMhpS.png" alt="image1" style="zoom:50%;" /></p><p><img data-src="https://s2.loli.net/2022/04/30/dke7PwDhFtS8JvY.png" alt="image2" style="zoom:50%;" /></p><p><img data-src="https://s2.loli.net/2022/04/30/taFMk9RO6iH3Yjo.png" alt="image3" style="zoom:50%;" /></p><p>貌似最终效果一般,但能看到每次的变化</p><h3 id="details"><a href="#details" class="headerlink" title="details"></a>details</h3><p>当discriminator被compile之后，即使设置了discriminator.trainable=False，该discriminator仍然可以通过train_on_batch的方式被训练；</p><p>但是如果discriminator在被compile之前就把训练状态设置为False，那么即使是使用discriminator.train_on_batch的方式也不能训练该判别器。</p><p>当compile一个模型时，该模型的训练状态就被固定成当前状态了（比如discriminator.trainable=True）;</p><p>当尝试修改compile之后的discriminator的训练状态时，实质上是对另外一个discriminator的训练状态进行修改（也许接下来会compile）;</p><p>由于框架自身的机制，上面compile之后的两个discriminator拥有相同的网络权重（即使它们被看作是两个独立的模型）</p><h2 id="DCGAN"><a href="#DCGAN" class="headerlink" title="DCGAN"></a>DCGAN</h2><p>普通的GAN训练效果挺差的.</p><p>DCGAN（深度卷积生成对抗网络，Deep Convolution Generative Adversarial Network）基于 GAN 做了网络结构的改进，将 <a href="https://baike.baidu.com/item/卷积神经网络/17541100?fr=aladdin">卷积神经网络</a> 应用在生成器网络和判别器网络中，使得整个模型具有更好的训练稳定性和性能表现。其工作原理和 GAN 相同，这里不再赘述</p><h3 id="生成器网络结构"><a href="#生成器网络结构" class="headerlink" title="生成器网络结构"></a>生成器网络结构</h3><p><img data-src="https://dn-simplecloud.shiyanlou.com/questions/uid788648-20190513-1557739698486" alt="img" style="zoom:50%;" /></p><h3 id="鉴别器网络结构"><a href="#鉴别器网络结构" class="headerlink" title="鉴别器网络结构"></a>鉴别器网络结构</h3><p><img data-src="https://dn-simplecloud.shiyanlou.com/questions/uid788648-20190521-1558405128517" alt="img" style="zoom:50%;" /></p><p>DCGAN 是一类模型的总称，其结构特点如下所示：</p><ul><li>所有的池化层使用步幅卷积和 <a href="https://buptldy.github.io/2016/10/29/2016-10-29-deconv/">微步幅卷积 Fractionally Strided Convolution</a> 或 <a href="https://www.cnblogs.com/jokerjason/p/9429452.html">上采样</a> 进行替换，步幅卷积指的是卷积层的步长 <code>strides&gt;1</code>。</li><li>判别器网络中使用步幅卷积，目的是进行图像压缩；生成器网路中使用微步幅卷积或上采样，目的是进行图像放大。</li><li>在生成器网络和判别器网络中使用批标准化。</li><li>对于更深的构架去掉 Dense 全连接层。</li><li>生成器网络中输出层使用 <a href="https://baike.baidu.com/item/激活函数/2520792?fr=aladdin">Tanh</a> 激活函数，其他所有的层都使用 <a href="https://baike.baidu.com/item/ReLU 函数/22689567?fr=aladdin">ReLu</a> 激活函数。</li><li>判别器网络中所有的层使用 LeakyReLu 激活函数</li></ul><p>这里写一下明显差别</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> tensorflow.keras.layers <span class="keyword">import</span> Input</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras.layers <span class="keyword">import</span> Dense, Reshape</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras.layers <span class="keyword">import</span> UpSampling2D</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras.layers <span class="keyword">import</span> Conv2D</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras.layers <span class="keyword">import</span> BatchNormalization, Activation</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras.models <span class="keyword">import</span> Model</span><br><span class="line"><span class="comment"># 生成器</span></span><br><span class="line">img_rows = <span class="number">28</span></span><br><span class="line">img_cols = <span class="number">28</span></span><br><span class="line">channels = <span class="number">1</span></span><br><span class="line">img_shape = (img_rows, img_cols, channels)</span><br><span class="line">latent_dim = <span class="number">100</span></span><br><span class="line">generator_input = Input(shape=(latent_dim,))</span><br><span class="line">x = Dense(<span class="number">128</span> * <span class="number">7</span> * <span class="number">7</span>, activation=<span class="string">&quot;relu&quot;</span>,)(generator_input)</span><br><span class="line">x = Reshape((<span class="number">7</span>, <span class="number">7</span>, <span class="number">128</span>))(x)</span><br><span class="line">x = UpSampling2D()(x)</span><br><span class="line">x = Conv2D(<span class="number">128</span>, kernel_size=<span class="number">3</span>, padding=<span class="string">&#x27;same&#x27;</span>)(x)</span><br><span class="line">x = BatchNormalization(momentum=<span class="number">0.8</span>)(x)</span><br><span class="line">x = Activation(<span class="string">&quot;relu&quot;</span>)(x)</span><br><span class="line">x = UpSampling2D()(x)</span><br><span class="line">x = Conv2D(<span class="number">64</span>, <span class="number">3</span>, padding=<span class="string">&#x27;same&#x27;</span>)(x)</span><br><span class="line">x = BatchNormalization(momentum=<span class="number">0.8</span>)(x)</span><br><span class="line">x = Activation(<span class="string">&quot;relu&quot;</span>)(x)</span><br><span class="line">x = Conv2D(channels, kernel_size=<span class="number">3</span>, activation=<span class="string">&#x27;tanh&#x27;</span>, padding=<span class="string">&#x27;same&#x27;</span>)(x)</span><br><span class="line">generator = Model(generator_input, x)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 构建判别器</span></span><br><span class="line"><span class="keyword">from</span> tensorflow.keras.layers <span class="keyword">import</span> LeakyReLU</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras.layers <span class="keyword">import</span> Dropout</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras.layers <span class="keyword">import</span> Flatten, ZeroPadding2D</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras.optimizers <span class="keyword">import</span> Adam</span><br><span class="line">discriminator_input = Input(shape=img_shape)</span><br><span class="line">x = Conv2D(<span class="number">32</span>, kernel_size=<span class="number">3</span>, strides=<span class="number">2</span>, padding=<span class="string">&quot;same&quot;</span>)(discriminator_input)</span><br><span class="line">x = LeakyReLU(alpha=<span class="number">0.2</span>)(x)</span><br><span class="line">x = Dropout(<span class="number">0.25</span>)(x)</span><br><span class="line">x = Conv2D(<span class="number">64</span>, kernel_size=<span class="number">3</span>, strides=<span class="number">2</span>, padding=<span class="string">&quot;same&quot;</span>)(x)</span><br><span class="line">x = ZeroPadding2D(padding=((<span class="number">0</span>, <span class="number">1</span>), (<span class="number">0</span>, <span class="number">1</span>)))(x)</span><br><span class="line">x = BatchNormalization(momentum=<span class="number">0.8</span>)(x)</span><br><span class="line">x = LeakyReLU(alpha=<span class="number">0.2</span>)(x)</span><br><span class="line">x = Dropout(<span class="number">0.25</span>)(x)</span><br><span class="line">x = Conv2D(<span class="number">128</span>, kernel_size=<span class="number">3</span>, strides=<span class="number">2</span>, padding=<span class="string">&quot;same&quot;</span>)(x)</span><br><span class="line">x = BatchNormalization(momentum=<span class="number">0.8</span>)(x)</span><br><span class="line">x = LeakyReLU(alpha=<span class="number">0.2</span>)(x)</span><br><span class="line">x = Dropout(<span class="number">0.25</span>)(x)</span><br><span class="line">x = Conv2D(<span class="number">256</span>, kernel_size=<span class="number">3</span>, strides=<span class="number">1</span>, padding=<span class="string">&quot;same&quot;</span>)(x)</span><br><span class="line">x = BatchNormalization(momentum=<span class="number">0.8</span>)(x)</span><br><span class="line">x = LeakyReLU(alpha=<span class="number">0.2</span>)(x)</span><br><span class="line">x = Dropout(<span class="number">0.25</span>)(x)</span><br><span class="line">x = Flatten()(x)</span><br><span class="line">x = Dense(<span class="number">1</span>, activation=<span class="string">&#x27;sigmoid&#x27;</span>)(x)</span><br><span class="line">discriminator = Model(discriminator_input, x)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 实例化 Adam 优化器</span></span><br><span class="line">optimizer = Adam(<span class="number">0.0002</span>, <span class="number">0.5</span>)</span><br><span class="line"><span class="comment"># 编译模型</span></span><br><span class="line">discriminator.<span class="built_in">compile</span>(loss=<span class="string">&#x27;binary_crossentropy&#x27;</span>,</span><br><span class="line">                      optimizer=optimizer,</span><br><span class="line">                      metrics=[<span class="string">&#x27;accuracy&#x27;</span>])</span><br></pre></td></tr></table></figure><p>其他的都类似.</p><p>训练DCGAN的技巧</p><ul><li>使用正态分布（高斯分布）对潜在空间中的点进行采样，而不用均匀分布。</li><li>随机性能够提高稳健性。训练 GAN 得到的是一个动态平衡，所以 GAN 可能以各种方式“卡住”。在训练过程中引入随机性有助于防止出现这种情况。可通过两种方式引入随机性：一种是在判别器中使用 Dropout，另一种是向判别器的标签添加随机噪声。</li><li>稀疏的梯度会妨碍 GAN 的训练。最大池化运算和 ReLU 激活函数都可能导致梯度稀疏。故本次实验在判别器网络中使用步幅卷积代替 <a href="https://baike.baidu.com/item/最大池化/22692585?fr=aladdin">最大池化</a>，使用 LeakyReLU 层来代替 ReLU。</li></ul><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p>李宏毅 机器学习</p><p>deep learning 吴恩达</p><p><a href="https://easyai.tech/ai-definition/gan/">生成对抗网络 - GAN</a></p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      
        <tags>
            
            <tag> GAN </tag>
            
            <tag> deep learning </tag>
            
            <tag> keras </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>写一个音乐播放器_轮播图实现</title>
      <link href="2022/04/27/%E5%86%99%E4%B8%80%E4%B8%AA%E9%9F%B3%E4%B9%90%E6%92%AD%E6%94%BE%E5%99%A8-%E8%BD%AE%E6%92%AD%E5%9B%BE%E5%AE%9E%E7%8E%B0/"/>
      <url>2022/04/27/%E5%86%99%E4%B8%80%E4%B8%AA%E9%9F%B3%E4%B9%90%E6%92%AD%E6%94%BE%E5%99%A8-%E8%BD%AE%E6%92%AD%E5%9B%BE%E5%AE%9E%E7%8E%B0/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>轮播图还是很常用的<br><span id="more"></span></p><p>轮播图使用的场景通常在网页首页上，在有限的空间可以通过轮播图，循环播放同一类型的图片、文字等内容。轮播图目前表现形式有 2 种，一种是常规的只出现一张图片，另一种是出现三张图片凸显一张的卡片化的。因为轮播图广泛使用，目前很多工具库（例如 swiper ）都提供了现成的轮播图解决方案.</p><h4 id="知识点"><a href="#知识点" class="headerlink" title="知识点"></a>知识点</h4><ul><li>事件防抖</li><li>轮播图</li></ul><p><del>我都不想写了</del></p><p>首页中间内容初始化</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- index.html --&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;zh-CN&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>音乐播放器<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;./css/reset.css&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;./css/common.css&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;./css/home.css&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./assets/iconfont.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;wrapper d-flex  flex-column&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">header</span> <span class="attr">class</span>=<span class="string">&quot;header&quot;</span> <span class="attr">id</span>=<span class="string">&quot;header-title&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#home&quot;</span>&gt;</span> 推荐页<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">header</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">section</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span> <span class="attr">class</span>=<span class="string">&quot;content&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 此处为中间内容，通过 js 动态生成 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">section</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">section</span> <span class="attr">class</span>=<span class="string">&quot;player-control d-flex justify-content-start &quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;player-control-songinfo d-flex justify-content-start&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;img &quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">img</span></span></span><br><span class="line"><span class="tag">              <span class="attr">src</span>=<span class="string">&quot;https://th.bing.com/th/id/R7466240255fa48164e1d741fb8b29893?rik=qd9WWhLotZqIAg&amp;riu=http%3a%2f%2fpicture.ik123.com%2fuploads%2fallimg%2f160906%2f3-160Z6154A8.jpg&amp;ehk=T2cuZ%2fECZd2tvUCSXRgW2e2axgZ8c4rM2GQpotzo3Ec%3d&amp;risl=&amp;pid=ImgRaw&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">alt</span>=<span class="string">&quot;&quot;</span></span></span><br><span class="line"><span class="tag">            /&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;songinfo d-flex flex-column align-items-start&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;songname&quot;</span>&gt;</span>歌曲一<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;single-text-omitted singer&quot;</span>&gt;</span>歌手2323232323232<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;player-control-unit d-flex justify-content-between&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;control&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">svg</span> <span class="attr">class</span>=<span class="string">&quot;icon&quot;</span> <span class="attr">aria-hidden</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">use</span> <span class="attr">xlink:href</span>=<span class="string">&quot;#icon-shangyiqu&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">use</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">svg</span> <span class="attr">class</span>=<span class="string">&quot;icon&quot;</span> <span class="attr">aria-hidden</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">use</span> <span class="attr">xlink:href</span>=<span class="string">&quot;#icon-zanting&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">use</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">svg</span> <span class="attr">class</span>=<span class="string">&quot;icon&quot;</span> <span class="attr">aria-hidden</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">use</span> <span class="attr">xlink:href</span>=<span class="string">&quot;#icon-xiayiqu&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">use</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;d-flex justify-content-between&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;song-progress d-flex justify-content-between&quot;</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;current-time&quot;</span>&gt;</span>00:00<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;progress&quot;</span> <span class="attr">id</span>=<span class="string">&quot;progress-bar&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;progress-bar&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;progress-dot&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;total-time&quot;</span>&gt;</span>00:00<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;volume d-flex&quot;</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">svg</span> <span class="attr">class</span>=<span class="string">&quot;icon volume-icon&quot;</span> <span class="attr">aria-hidden</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">use</span> <span class="attr">xlink:href</span>=<span class="string">&quot;#icon-yinliang&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">use</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;progress&quot;</span> <span class="attr">id</span>=<span class="string">&quot;volume-bar&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;progress-bar&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;progress-dot&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;list&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">svg</span> <span class="attr">class</span>=<span class="string">&quot;icon&quot;</span> <span class="attr">aria-hidden</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">use</span> <span class="attr">xlink:href</span>=<span class="string">&quot;#icon-liebiaoxunhuan&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">use</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">svg</span> <span class="attr">class</span>=<span class="string">&quot;icon&quot;</span> <span class="attr">aria-hidden</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">use</span> <span class="attr">xlink:href</span>=<span class="string">&quot;#icon-bofangliebiao&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">use</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">section</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./js/index.js&quot;</span> <span class="attr">type</span>=<span class="string">&quot;module&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><ol><li>在 js 文件夹下，新建 home 文件夹，在 home 文件夹内新增 home.js 文件，写下 <code>document.querySelector(&#39;#app&#39;).innerHTML = &#39;111&#39;;</code>。</li><li>动态加载 home.js 文件。在 index.js 文件中监听 window 的 load 事件，动态生成 script 标签，设置 src 属性为 home.js 文件夹的相对位置。</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="built_in">window</span>.addEventListener(<span class="string">&quot;load&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;load&quot;</span>);</span><br><span class="line">  <span class="keyword">const</span> script = <span class="built_in">document</span>.createElement(<span class="string">&quot;SCRIPT&quot;</span>);</span><br><span class="line">  script.src = <span class="string">&quot;./js/home/home.js&quot;</span>;</span><br><span class="line">  script.setAttribute(<span class="string">&quot;type&quot;</span>, <span class="string">&quot;module&quot;</span>);</span><br><span class="line">  <span class="built_in">document</span>.querySelector(<span class="string">&quot;body&quot;</span>).appendChild(script);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// home.js</span></span><br><span class="line"><span class="keyword">const</span> homePageTemplate = <span class="string">`</span></span><br><span class="line"><span class="string">&lt;div class=&quot;w&quot;&gt;</span></span><br><span class="line"><span class="string">    &lt;div class=&quot;carousel-wrapper&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;div class=&quot;carousel-container &quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;!-- 切换箭头 --&gt;</span></span><br><span class="line"><span class="string">            &lt;!-- 轮播图图片需要动态生成 --&gt;</span></span><br><span class="line"><span class="string">        &lt;/div&gt;</span></span><br><span class="line"><span class="string">        &lt;!-- 指示器 --&gt;</span></span><br><span class="line"><span class="string">        &lt;ul class=&quot;carousel-indicators d-flex&quot;&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        &lt;/ul&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;div class=&quot;recommend-playlist&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;h3 class=&quot;recommend-playlist-header&quot;&gt;推荐歌单&lt;svg class=&quot;icon&quot; aria-hidden=&quot;true&quot;&gt;</span></span><br><span class="line"><span class="string">                &lt;use xlink:href=&quot;#icon-arrow-right&quot;&gt;&lt;/use&gt;</span></span><br><span class="line"><span class="string">            &lt;/svg&gt;</span></span><br><span class="line"><span class="string">        &lt;/h3&gt;</span></span><br><span class="line"><span class="string">        &lt;ul class=&quot;recommend-playlist-container d-flex justify-content-between align-items-start&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;!-- 推荐歌单需要动态生成 --&gt;</span></span><br><span class="line"><span class="string">        &lt;/ul&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">&lt;/div&gt;</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"><span class="comment">//首页初始化</span></span><br><span class="line"><span class="built_in">document</span>.querySelector(<span class="string">&quot;#app&quot;</span>).innerHTML = homePageTemplate;</span><br></pre></td></tr></table></figure><h3 id="轮播图"><a href="#轮播图" class="headerlink" title="轮播图"></a>轮播图</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ajax.js</span></span><br><span class="line"><span class="keyword">const</span> BASE_URL = <span class="string">&quot;http://localhost:3000&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">Ajax</span>(<span class="params">&#123;</span></span></span><br><span class="line"><span class="params"><span class="function">  <span class="regexp">//</span>请求参数配置</span></span></span><br><span class="line"><span class="params"><span class="function">  method = <span class="string">&quot;GET&quot;</span>, <span class="regexp">//</span>默认为<span class="string">&#x27;get&#x27;</span>请求</span></span></span><br><span class="line"><span class="params"><span class="function">  url,</span></span></span><br><span class="line"><span class="params"><span class="function">  data = &#123;&#125;,</span></span></span><br><span class="line"><span class="params"><span class="function">&#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 通过 Promise 返回异步请求</span></span><br><span class="line">    <span class="keyword">const</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">    xhr.open(method, BASE_URL + url);</span><br><span class="line">    xhr.onload = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      resolve(<span class="built_in">JSON</span>.parse(xhr.response));</span><br><span class="line">    &#125;;</span><br><span class="line">    xhr.onerror = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="comment">// 待最后进行错误处理操作</span></span><br><span class="line">      <span class="keyword">if</span> (xhr.status == <span class="number">0</span>) &#123;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    xhr.send(<span class="built_in">JSON</span>.stringify(data));</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: 获得轮播图信息</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;*&#125;</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return <span class="type">&#123;*&#125;</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">getBannerList</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> result = Ajax(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">`/homepage/block/page`</span>,</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//home.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; getBannerList &#125; <span class="keyword">from</span> <span class="string">&quot;../service/ajax.js&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> result = <span class="keyword">await</span> getBannerList();</span><br><span class="line"><span class="keyword">const</span> carouselData = result.data.blocks[<span class="number">0</span>].extInfo.banners;</span><br></pre></td></tr></table></figure><p>在 home 文件夹内新建一个 carousel.js 的文件来单独完成轮播图</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//carousel.js</span></span><br><span class="line"><span class="comment">// 切换箭头为静态 HTML 样式，无需根据图片数量动态生成。</span></span><br><span class="line"><span class="keyword">const</span> carouselControl = <span class="string">`</span></span><br><span class="line"><span class="string">&lt;button class=&quot;carousel-control carousel-control-left carousel-control-hover&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;svg class=&quot;icon&quot; aria-hidden=&quot;true&quot;&gt;</span></span><br><span class="line"><span class="string">    &lt;use xlink:href=&quot;#icon-arrow-left&quot;&gt;&lt;/use&gt;</span></span><br><span class="line"><span class="string">&lt;/svg&gt;</span></span><br><span class="line"><span class="string">&lt;/button&gt;</span></span><br><span class="line"><span class="string">&lt;button class=&quot;carousel-control carousel-control-right carousel-control-hover&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;svg class=&quot;icon&quot; aria-hidden=&quot;true&quot;&gt;</span></span><br><span class="line"><span class="string">    &lt;use xlink:href=&quot;#icon-arrow-right&quot;&gt;&lt;/use&gt;</span></span><br><span class="line"><span class="string">&lt;/svg&gt;</span></span><br><span class="line"><span class="string">&lt;/button&gt;</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"><span class="comment">//轮播图配置</span></span><br><span class="line"><span class="keyword">const</span> carousel = &#123;</span><br><span class="line">  <span class="attr">data</span>: [], <span class="comment">//轮播图数据</span></span><br><span class="line">  <span class="attr">currentIndex</span>: <span class="number">0</span>, <span class="comment">//轮播图当前切换的画面</span></span><br><span class="line">  <span class="attr">times</span>: <span class="number">2000</span>, <span class="comment">//轮播图多少时间切换画面</span></span><br><span class="line">  <span class="attr">animationTimes</span>: <span class="number">0.5</span>, <span class="comment">//轮播图动画持续时间，单位s</span></span><br><span class="line">  <span class="attr">autoCycleTimer</span>: <span class="keyword">new</span> <span class="built_in">Set</span>(), <span class="comment">//如果在切换动画，无法进行切换画面</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">carouselRender</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//初始化轮播图</span></span><br><span class="line">  <span class="keyword">let</span> carouselItem = <span class="string">&quot;&quot;</span>,</span><br><span class="line">    carouselIndicatorsLi = <span class="string">&quot;&quot;</span>;</span><br><span class="line">  <span class="keyword">const</span> wrapper = <span class="built_in">document</span>.querySelector(<span class="string">&quot;.carousel-wrapper&quot;</span>);</span><br><span class="line">  <span class="keyword">let</span> &#123; width = <span class="number">0</span> &#125; = wrapper.getBoundingClientRect(); <span class="comment">//得到图片的宽度</span></span><br><span class="line">  <span class="comment">//动态生成轮播图</span></span><br><span class="line">  data.forEach(<span class="function">(<span class="params">item, index</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//指示器激活选中判断</span></span><br><span class="line">    <span class="keyword">let</span> isActive = carousel.currentIndex == index ? <span class="string">&quot;active&quot;</span> : <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="comment">//动态生成轮播图图片，并给每一张图片加上偏移量和动画效果</span></span><br><span class="line">    carouselItem += <span class="string">`</span></span><br><span class="line"><span class="string">            &lt;div class=&quot;carousel-item <span class="subst">$&#123;</span></span></span><br><span class="line"><span class="subst"><span class="string">              <span class="string">&quot;#&quot;</span> + index</span></span></span><br><span class="line"><span class="subst"><span class="string">            &#125;</span>&quot; style=&#x27;transform:translateX(<span class="subst">$&#123;</span></span></span><br><span class="line"><span class="subst"><span class="string">      width * (index - <span class="number">1</span>)</span></span></span><br><span class="line"><span class="subst"><span class="string">    &#125;</span>px);transition-duration:<span class="subst">$&#123;carousel.animationTimes&#125;</span>s&#x27;&gt;</span></span><br><span class="line"><span class="string">                &lt;img src=&quot;<span class="subst">$&#123;item.pic&#125;</span>&quot; alt=&quot;&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;/div&gt;</span></span><br><span class="line"><span class="string">            `</span>;</span><br><span class="line">    <span class="comment">//动态生成轮播图指示器</span></span><br><span class="line">    carouselIndicatorsLi += <span class="string">`</span></span><br><span class="line"><span class="string">                &lt;li data-slide-to=&quot;<span class="subst">$&#123;index&#125;</span>&quot; class=&quot;carousel-indicators-li <span class="subst">$&#123;isActive&#125;</span>&quot;&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">            `</span>;</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="comment">// 通过模板字符串，按照 home.html 中的 html 结构进行排布</span></span><br><span class="line">  <span class="keyword">const</span> carouselContainer = <span class="string">`</span></span><br><span class="line"><span class="string">        &lt;div class=&quot;carousel-container&quot; style=&quot;transition:transform <span class="subst">$&#123;carousel.animationTimes&#125;</span>s &quot;&gt;</span></span><br><span class="line"><span class="string">            <span class="subst">$&#123;carouselControl&#125;</span></span></span><br><span class="line"><span class="string">            &lt;div class=&quot;carousel-content&quot;&gt;</span></span><br><span class="line"><span class="string">                <span class="subst">$&#123;carouselItem&#125;</span></span></span><br><span class="line"><span class="string">            &lt;/div&gt;</span></span><br><span class="line"><span class="string">        &lt;/div&gt;</span></span><br><span class="line"><span class="string">        `</span>;</span><br><span class="line">  <span class="keyword">const</span> carouselIndicators = <span class="string">`</span></span><br><span class="line"><span class="string">        &lt;ul class=&quot;carousel-indicators d-flex&quot;&gt;</span></span><br><span class="line"><span class="string">            <span class="subst">$&#123;carouselIndicatorsLi&#125;</span></span></span><br><span class="line"><span class="string">        &lt;/ul&gt;</span></span><br><span class="line"><span class="string">        `</span>;</span><br><span class="line">  <span class="comment">// 将得到的字符串通过 innerHTML 插入到轮播图盒子</span></span><br><span class="line">  wrapper.innerHTML = carouselContainer + carouselIndicators;</span><br><span class="line">&#125;</span><br><span class="line">Ajax(&#123;</span><br><span class="line">  <span class="attr">url</span>: <span class="string">&quot;/homepage/block/page&quot;</span>,</span><br><span class="line">&#125;).then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(res);</span><br><span class="line">  carousel.data = res.data.blocks[<span class="number">0</span>].extInfo.banners;</span><br><span class="line">  <span class="comment">//首次渲染轮播图</span></span><br><span class="line">  carouselRender(carousel.data);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>写一个音乐播放器_静态页面实现</title>
      <link href="2022/04/23/%E5%86%99%E4%B8%80%E4%B8%AA%E9%9F%B3%E4%B9%90%E6%92%AD%E6%94%BE%E5%99%A8-%E9%9D%99%E6%80%81%E9%A1%B5%E9%9D%A2%E5%AE%9E%E7%8E%B0/"/>
      <url>2022/04/23/%E5%86%99%E4%B8%80%E4%B8%AA%E9%9F%B3%E4%B9%90%E6%92%AD%E6%94%BE%E5%99%A8-%E9%9D%99%E6%80%81%E9%A1%B5%E9%9D%A2%E5%AE%9E%E7%8E%B0/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>静态页面<br><span id="more"></span></p><p><img data-src="https://doc.shiyanlou.com/courses/3871/1621685/ba2421d02b10c8444d27b2dad8d23b5a-0" alt="2-1" style="zoom:50%;" /></p><h4 id="知识点"><a href="#知识点" class="headerlink" title="知识点"></a>知识点</h4><ul><li>flex 布局</li><li>绝对定位和相对定位的使用</li><li>svg 图标使用</li><li>文字溢出处理</li></ul><h3 id="首页头部"><a href="#首页头部" class="headerlink" title="首页头部"></a>首页头部</h3><p>css文件</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* home.css */</span></span><br><span class="line"><span class="selector-class">.wrapper</span> &#123;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#eee</span>;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">950px</span>;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span> auto;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.wrapper</span> <span class="selector-class">.header</span> &#123;</span><br><span class="line">    <span class="attribute">margin-bottom</span>: <span class="number">10px</span>;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">20px</span>;</span><br><span class="line">    <span class="attribute">text-align</span>: center;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#2bb669</span>;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#fff</span>;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">15px</span> <span class="number">0px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.wrapper</span> <span class="selector-class">.content</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">min-height</span>: <span class="number">450px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.wrapper</span> <span class="selector-class">.player-control</span> &#123;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#f6f6f8</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">65px</span>;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* http://meyerweb.com/eric/tools/css/reset/</span></span><br><span class="line"><span class="comment">   v5.0.1 | 20191019</span></span><br><span class="line"><span class="comment">   License: none (public domain)</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="selector-tag">html</span>, <span class="selector-tag">body</span>, <span class="selector-tag">div</span>, <span class="selector-tag">span</span>, applet, <span class="selector-tag">object</span>, <span class="selector-tag">iframe</span>,</span><br><span class="line"><span class="selector-tag">h1</span>, <span class="selector-tag">h2</span>, <span class="selector-tag">h3</span>, <span class="selector-tag">h4</span>, <span class="selector-tag">h5</span>, <span class="selector-tag">h6</span>, <span class="selector-tag">p</span>, <span class="selector-tag">blockquote</span>, pre,</span><br><span class="line"><span class="selector-tag">a</span>, <span class="selector-tag">abbr</span>, acronym, <span class="selector-tag">address</span>, big, <span class="selector-tag">cite</span>, <span class="selector-tag">code</span>,</span><br><span class="line"><span class="selector-tag">del</span>, <span class="selector-tag">dfn</span>, <span class="selector-tag">em</span>, <span class="selector-tag">img</span>, <span class="selector-tag">ins</span>, <span class="selector-tag">kbd</span>, <span class="selector-tag">q</span>, s, <span class="selector-tag">samp</span>,</span><br><span class="line">small, strike, <span class="selector-tag">strong</span>, sub, <span class="selector-tag">sup</span>, tt, <span class="selector-tag">var</span>,</span><br><span class="line"><span class="selector-tag">b</span>, u, <span class="selector-tag">i</span>, center,</span><br><span class="line"><span class="selector-tag">dl</span>, <span class="selector-tag">dt</span>, <span class="selector-tag">dd</span>, <span class="selector-tag">menu</span>, <span class="selector-tag">ol</span>, <span class="selector-tag">ul</span>, <span class="selector-tag">li</span>,</span><br><span class="line"><span class="selector-tag">fieldset</span>, <span class="selector-tag">form</span>, <span class="selector-tag">label</span>, <span class="selector-tag">legend</span>,</span><br><span class="line"><span class="selector-tag">table</span>, <span class="selector-tag">caption</span>, <span class="selector-tag">tbody</span>, <span class="selector-tag">tfoot</span>, <span class="selector-tag">thead</span>, <span class="selector-tag">tr</span>, <span class="selector-tag">th</span>, <span class="selector-tag">td</span>,</span><br><span class="line"><span class="selector-tag">article</span>, <span class="selector-tag">aside</span>, <span class="selector-tag">canvas</span>, <span class="selector-tag">details</span>, embed,</span><br><span class="line"><span class="selector-tag">figure</span>, <span class="selector-tag">figcaption</span>, <span class="selector-tag">footer</span>, <span class="selector-tag">header</span>, <span class="selector-tag">hgroup</span>,</span><br><span class="line"><span class="selector-tag">main</span>, <span class="selector-tag">menu</span>, <span class="selector-tag">nav</span>, output, ruby, <span class="selector-tag">section</span>, <span class="selector-tag">summary</span>,</span><br><span class="line"><span class="selector-tag">time</span>, <span class="selector-tag">mark</span>, <span class="selector-tag">audio</span>, <span class="selector-tag">video</span> &#123;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">font</span>: inherit;</span><br><span class="line">    <span class="attribute">vertical-align</span>: baseline;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* HTML5 display-role reset for older browsers */</span></span><br><span class="line"><span class="selector-tag">article</span>, <span class="selector-tag">aside</span>, <span class="selector-tag">details</span>, <span class="selector-tag">figcaption</span>, <span class="selector-tag">figure</span>,</span><br><span class="line"><span class="selector-tag">footer</span>, <span class="selector-tag">header</span>, <span class="selector-tag">hgroup</span>, <span class="selector-tag">main</span>, <span class="selector-tag">menu</span>, <span class="selector-tag">nav</span>, <span class="selector-tag">section</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: block;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* HTML5 hidden-attribute fix for newer browsers */</span></span><br><span class="line">*<span class="selector-attr">[hidden]</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: none;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">    <span class="attribute">line-height</span>: <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">menu</span>, <span class="selector-tag">ol</span>, <span class="selector-tag">ul</span> &#123;</span><br><span class="line">    <span class="attribute">list-style</span>: none;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">blockquote</span>, <span class="selector-tag">q</span> &#123;</span><br><span class="line">    <span class="attribute">quotes</span>: none;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">blockquote</span>:before, blockquote:after,</span><br><span class="line">q:before, q:after &#123;</span><br><span class="line">    content: <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="attribute">content</span>: none;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">table</span> &#123;</span><br><span class="line">    <span class="attribute">border-collapse</span>: collapse;</span><br><span class="line">    <span class="attribute">border-spacing</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* common.css */</span></span><br><span class="line"><span class="selector-class">.d-flex</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">justify-content</span>: center;</span><br><span class="line">    <span class="attribute">align-items</span>: center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.justify-content-start</span> &#123;</span><br><span class="line">    <span class="attribute">justify-content</span>: flex-start;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.justify-content-end</span> &#123;</span><br><span class="line">    <span class="attribute">justify-content</span>: flex-end;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.justify-content-center</span> &#123;</span><br><span class="line">    <span class="attribute">justify-content</span>: center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.justify-content-between</span> &#123;</span><br><span class="line">    <span class="attribute">justify-content</span>: space-between;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.justify-content-around</span> &#123;</span><br><span class="line">    <span class="attribute">justify-content</span>: space-around;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.align-items-start</span> &#123;</span><br><span class="line">    <span class="attribute">align-items</span>: flex-start;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.align-items-end</span> &#123;</span><br><span class="line">    <span class="attribute">align-items</span>: flex-end;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.align-items-center</span> &#123;</span><br><span class="line">    <span class="attribute">align-items</span>: center;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.flex-column</span> &#123;</span><br><span class="line">    <span class="attribute">flex-direction</span>: column;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 单行文本溢出处理 */</span></span><br><span class="line"><span class="selector-class">.single-text-omitted</span> &#123;</span><br><span class="line">    <span class="attribute">text-overflow</span>: ellipsis;</span><br><span class="line">    <span class="attribute">overflow</span>: hidden;</span><br><span class="line">    <span class="attribute">white-space</span>: nowrap;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 两行文本溢出处理 */</span></span><br><span class="line"><span class="selector-class">.multi-text-omitted</span> &#123;</span><br><span class="line">    <span class="attribute">text-overflow</span>: ellipsis;</span><br><span class="line">    <span class="attribute">overflow</span>: hidden;</span><br><span class="line">    <span class="attribute">display</span>: -webkit-box;</span><br><span class="line">    -webkit-line-clamp: <span class="number">2</span>;</span><br><span class="line">    -webkit-box-orient: vertical;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.green</span> &#123;</span><br><span class="line">    <span class="attribute">background-color</span>: green;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- home.html --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;wrapper d-flex flex-column&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">header</span> <span class="attr">class</span>=<span class="string">&quot;header&quot;</span> <span class="attr">id</span>=<span class="string">&quot;header-title&quot;</span>&gt;</span>推荐页<span class="tag">&lt;/<span class="name">header</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">section</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span> <span class="attr">class</span>=<span class="string">&quot;content&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 中间页面html结构 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">section</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">section</span> <span class="attr">class</span>=<span class="string">&quot;player-control&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 页面底部html结构 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">section</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>最外层的类选择器 wrapper 实现内容居中和设置背景色。头部类选择器 header 样式：定高，设置文字居中，背景色。</p><h3 id="首页中间内容布局"><a href="#首页中间内容布局" class="headerlink" title="首页中间内容布局"></a>首页中间内容布局</h3><p>中间内容由两部分构成：轮播图和推荐歌单</p><p>中间内容包括轮播图和推荐歌单，采用居中布局，居中样式由 <code>w</code> 选择器控制样式，所有的 css 都在 home.css 文件中完成。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- home.html --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 中间页面html结构 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">section</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span> <span class="attr">class</span>=<span class="string">&quot;content&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;w&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;carousel-wrapper&quot;</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- 轮播图结构 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;recommend-playlist&quot;</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- 推荐歌单结构 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">section</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* home.css */</span></span><br><span class="line"><span class="selector-class">.wrapper</span> <span class="selector-class">.content</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.w</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">90%</span>;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0</span> auto;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="轮播图"><a href="#轮播图" class="headerlink" title="轮播图"></a>轮播图</h4><p>包括显示的图片，切换箭头，指示器。显示的图片和切换箭头包含在同一个 div 容器内，html 布局如下：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- home.html --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;carousel-wrapper&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 轮播图结构 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;carousel-container &quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 切换箭头 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span></span></span><br><span class="line"><span class="tag">      <span class="attr">class</span>=<span class="string">&quot;carousel-control carousel-control-left carousel-control-hover&quot;</span></span></span><br><span class="line"><span class="tag">    &gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">svg</span> <span class="attr">class</span>=<span class="string">&quot;icon&quot;</span> <span class="attr">aria-hidden</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">use</span> <span class="attr">xlink:href</span>=<span class="string">&quot;#icon-arrow-left&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">use</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span></span></span><br><span class="line"><span class="tag">      <span class="attr">class</span>=<span class="string">&quot;carousel-control carousel-control-right carousel-control-hover&quot;</span></span></span><br><span class="line"><span class="tag">    &gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">svg</span> <span class="attr">class</span>=<span class="string">&quot;icon&quot;</span> <span class="attr">aria-hidden</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">use</span> <span class="attr">xlink:href</span>=<span class="string">&quot;#icon-arrow-right&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">use</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 轮播图图片需要动态生成 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;carousel-item&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">img</span></span></span><br><span class="line"><span class="tag">        <span class="attr">src</span>=<span class="string">&quot;https://tse2-mm.cn.bing.net/th/id/OIP.tXLPDc_5P-E7ca-KtD_UVAHaEK?pid=ImgDet&amp;rs=1&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">alt</span>=<span class="string">&quot;&quot;</span></span></span><br><span class="line"><span class="tag">      /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 指示器 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">&quot;carousel-indicators d-flex&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">data-slide-to</span>=<span class="string">&quot;0&quot;</span> <span class="attr">class</span>=<span class="string">&quot;active&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">data-slide-to</span>=<span class="string">&quot;1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">data-slide-to</span>=<span class="string">&quot;2&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>下载矢量图并引入js文件</p><p># iconfont 图标 <a href="https://labfile.oss.aliyuncs.com/courses/3871/iconfont.zip">https://labfile.oss.aliyuncs.com/courses/3871/iconfont.zip</a></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- home.html --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./assets/iconfont.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>加入css样式</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* common.css */</span></span><br><span class="line"><span class="selector-class">.icon</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">1em</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">1em</span>;</span><br><span class="line">  <span class="attribute">vertical-align</span>: -<span class="number">0.15em</span>;</span><br><span class="line">  fill: currentColor;</span><br><span class="line">  <span class="attribute">overflow</span>: hidden;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>接下来完成轮播图最外围容器 css 样式。样式定宽高，设置相对定位为箭头和图片提供定位父级。</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* home.css */</span></span><br><span class="line"><span class="selector-class">.carousel-wrapper</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.carousel-container</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">300px</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>轮播图切换箭头 css 样式。类选择器 <code>carousel-control</code> 设置相对定位位置，通过设置等宽高和 <code>border-radius：50%</code> button 变为圆形。类选择器 <code>carousel-control-hover</code> 设置移入效果，触发方式： 当鼠标移入，通过 js 动态添加 ，移出动态删除.</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* home.css */</span></span><br><span class="line"><span class="selector-class">.carousel-control</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">25px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">25px</span>;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">25px</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">50%</span>;</span><br><span class="line">  <span class="attribute">border</span>: none;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">50%</span>;</span><br><span class="line">  <span class="attribute">transform</span>: <span class="built_in">translateY</span>(-<span class="number">50%</span>);</span><br><span class="line">  <span class="attribute">z-index</span>: <span class="number">2021</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0.2</span>);</span><br><span class="line">  <span class="attribute">text-align</span>: center;</span><br><span class="line">  <span class="attribute">color</span>: <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0.6</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.carousel-control-left</span> &#123;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">10px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.carousel-control-right</span> &#123;</span><br><span class="line">  <span class="attribute">right</span>: <span class="number">10px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.carousel-control-hover</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0.5</span>);</span><br><span class="line">  <span class="attribute">color</span>: <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0.9</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>类选择器 <code>carousel-container</code> 控制图片 css 样式：定宽，定高（防止因图片大小不一致导致轮播图样式不一致）。类选择器 <code>carousel-item</code> 开启相对定位，后续通过 js 改变 transform：translateX 来实现图片移动。子选择器 <code>carousel-item&gt;img</code> 定宽 100%达到自适应效果</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* home.css */</span></span><br><span class="line"><span class="selector-class">.carousel-container</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">300px</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.carousel-item</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">overflow</span>: hidden;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.carousel-item</span> &gt; <span class="selector-tag">img</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">height</span>: auto;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>指示器 css 样式。类选择器 <code>carousel-indicators</code> 设置相对定位位置。子选择器 <code>carousel-indicators&gt;li</code> 定宽高，设置背景颜色，开启弹性盒子。类选择器 <code>active</code> 改变背景颜色，通过 js 指定相应指示器的 active 状态。</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* home.css */</span></span><br><span class="line"><span class="selector-class">.carousel-indicators</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">bottom</span>: <span class="number">0px</span>;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">50%</span>;</span><br><span class="line">  <span class="attribute">transform</span>: <span class="built_in">translateX</span>(-<span class="number">50%</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.carousel-indicators</span> &gt; <span class="selector-tag">li</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">50px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">4px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0.4</span>);</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">15px</span> <span class="number">2px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.carousel-indicators</span> &gt; <span class="selector-class">.active</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0.9</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="推荐歌单"><a href="#推荐歌单" class="headerlink" title="推荐歌单"></a>推荐歌单</h4><p>推荐歌单 html 布局包括三个部分：歌单标题/封面/名字，歌单封面和名字在同一容器内</p><p><img data-src="https://doc.shiyanlou.com/courses/3871/1621685/cb194c68a0eea0907db392221cfc8971-0" alt="2-13" style="zoom:67%;" /></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* home.css */</span></span><br><span class="line"><span class="selector-class">.recommend-playlist</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">10px</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.recommend-playlist-header</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">20px</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">10px</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>歌单封面和文字 css 样式。歌单封面和文字最外围容器样式 ：定宽，开启弹性盒子,主轴上排列方式设置为 <code>space-between</code>。 每一项歌单封面和文字容器样式：定宽，开启弹性盒，设置 <code>flex-column</code> 将图文改为从上到下排列。歌曲封面容器样式 ：定宽，设置相对定位为后面增加 <code>hover</code> 出现图标作为定位父级（ <code>hover</code> 样式通过 js 动态添加）。歌曲封面图片：定宽，高度字适应。歌单标题：定宽，为后续的文字处理限定宽度，设置 margin。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- home.html --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;recommend-playlist&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 推荐歌单结构 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h3</span> <span class="attr">class</span>=<span class="string">&quot;recommend-playlist-header&quot;</span>&gt;</span></span><br><span class="line">    推荐歌单<span class="tag">&lt;<span class="name">svg</span> <span class="attr">class</span>=<span class="string">&quot;icon&quot;</span> <span class="attr">aria-hidden</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">use</span> <span class="attr">xlink:href</span>=<span class="string">&quot;#icon-arrow-right&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">use</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;recommend-playlist-container d-flex justify-content-between&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 推荐歌单需要动态生成，静态页面先手动复制4份 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;recommend-playlist-item d-flex flex-column hover&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;recommend-playlist-cover&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">img</span></span></span><br><span class="line"><span class="tag">          <span class="attr">src</span>=<span class="string">&quot;https://tse2-mm.cn.bing.net/th/id/OIP.ZTmNathhKflijArYDaQEDAHaEo?pid=ImgDet&amp;rs=1&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">alt</span>=<span class="string">&quot;&quot;</span></span></span><br><span class="line"><span class="tag">        /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">svg</span> <span class="attr">class</span>=<span class="string">&quot;recommend-playlist-icon icon&quot;</span> <span class="attr">aria-hidden</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">use</span> <span class="attr">xlink:href</span>=<span class="string">&quot;#icon-zanting&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">use</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;recommend-playlist-title multi-text-omitted&quot;</span>&gt;</span></span><br><span class="line">        图片使用世界前沿的人工智能技术，为用户甄选海量的高清美图</span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* home.css */</span></span><br><span class="line"><span class="selector-class">.recommend-playlist</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">10px</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.recommend-playlist-header</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">20px</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">10px</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* home.css */</span></span><br><span class="line"><span class="selector-class">.recommend-playlist-container</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.recommend-playlist-item</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">18%</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.recommend-playlist-cover</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">8px</span>;</span><br><span class="line">  <span class="attribute">overflow</span>: hidden;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.recommend-playlist-cover</span> &gt; <span class="selector-tag">img</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">height</span>: auto;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.recommend-playlist-cover</span> <span class="selector-class">.recommend-playlist-icon</span> &#123;</span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">bottom</span>: <span class="number">10px</span>;</span><br><span class="line">  <span class="attribute">right</span>: <span class="number">5px</span>;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#ccc</span>;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">20px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.hover</span> <span class="selector-class">.recommend-playlist-icon</span> &#123;</span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.recommend-playlist-title</span> &#123;</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">5px</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="播放器首页底部布局"><a href="#播放器首页底部布局" class="headerlink" title="播放器首页底部布局"></a>播放器首页底部布局</h4><p>分为左右两个部分，共 4 个小模块</p><p><img data-src="https://doc.shiyanlou.com/courses/3871/1621685/7349ac402e69e873561fb4243f6e71f8-0" alt="2-15" style="zoom:50%;" /></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- home.html --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">section</span> <span class="attr">class</span>=<span class="string">&quot;player-control d-flex justify-content-start &quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 页面底部html结构 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;player-control-songinfo d-flex justify-content-start&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 歌曲信息 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;player-control-unit d-flex justify-content-between&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;control&quot;</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- 播放控制 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;d-flex justify-content-between&quot;</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- 播放进度和音量 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;list&quot;</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- 歌曲循环和列表 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">section</span>&gt;</span></span><br></pre></td></tr></table></figure><p>首页底部 css 样式。最外层容器样式 <code>player-control</code>：开启弹性盒，设置背景色，定宽高。两栏布局：左侧定宽，右侧通过 <code>flex-grow</code> 实现自适应。</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* home.css */</span></span><br><span class="line"><span class="selector-class">.wrapper</span> <span class="selector-class">.player-control</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#f6f6f8</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">65px</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.player-control-songinfo</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">15%</span>;</span><br><span class="line">  <span class="attribute">margin-left</span>: <span class="number">10px</span>;</span><br><span class="line">  <span class="attribute">min-height</span>: <span class="number">80%</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.player-control-unit</span> &#123;</span><br><span class="line">  <span class="attribute">flex-grow</span>: <span class="number">1</span>;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0</span> <span class="number">20px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="歌曲信息"><a href="#歌曲信息" class="headerlink" title="歌曲信息"></a>歌曲信息</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- home.html --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;player-control-songinfo d-flex justify-content-start&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 歌曲信息 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;img &quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span></span></span><br><span class="line"><span class="tag">      <span class="attr">src</span>=<span class="string">&quot;https://th.bing.com/th/id/R7466240255fa48164e1d741fb8b29893?rik=qd9WWhLotZqIAg&amp;riu=http%3a%2f%2fpicture.ik123.com%2fuploads%2fallimg%2f160906%2f3-160Z6154A8.jpg&amp;ehk=T2cuZ%2fECZd2tvUCSXRgW2e2axgZ8c4rM2GQpotzo3Ec%3d&amp;risl=&amp;pid=ImgRaw&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">alt</span>=<span class="string">&quot;&quot;</span></span></span><br><span class="line"><span class="tag">    /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;songinfo d-flex flex-column align-items-start&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;songname&quot;</span>&gt;</span>歌曲一<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;single-text-omitted singer&quot;</span>&gt;</span>歌手2323232323232<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>歌曲信息 css 样式。歌曲封面 <code>img</code>：定宽，设置圆角。歌曲信息 <code>songinfo</code>：定宽，开启弹性盒，内容从上到下排列。</p><h4 id="播放控制"><a href="#播放控制" class="headerlink" title="播放控制"></a>播放控制</h4><p>播放控制和歌曲循环和列表布局主要为引入 iconfont 图标，及设置字体大小。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- home.html --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;control&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 播放控制 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">svg</span> <span class="attr">class</span>=<span class="string">&quot;icon&quot;</span> <span class="attr">aria-hidden</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">use</span> <span class="attr">xlink:href</span>=<span class="string">&quot;#icon-shangyiqu&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">use</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">svg</span> <span class="attr">class</span>=<span class="string">&quot;icon&quot;</span> <span class="attr">aria-hidden</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">use</span> <span class="attr">xlink:href</span>=<span class="string">&quot;#icon-zanting&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">use</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">svg</span> <span class="attr">class</span>=<span class="string">&quot;icon&quot;</span> <span class="attr">aria-hidden</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">use</span> <span class="attr">xlink:href</span>=<span class="string">&quot;#icon-xiayiqu&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">use</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;list&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 歌曲循环和列表 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">svg</span> <span class="attr">class</span>=<span class="string">&quot;icon&quot;</span> <span class="attr">aria-hidden</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">use</span> <span class="attr">xlink:href</span>=<span class="string">&quot;#icon-liebiaoxunhuan&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">use</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">svg</span> <span class="attr">class</span>=<span class="string">&quot;icon&quot;</span> <span class="attr">aria-hidden</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">use</span> <span class="attr">xlink:href</span>=<span class="string">&quot;#icon-bofangliebiao&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">use</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* home.css */</span></span><br><span class="line"><span class="selector-class">.player-control-unit</span> <span class="selector-class">.control</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">35px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.player-control-unit</span> <span class="selector-class">.list</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">25px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>播放进度和音量 html 布局，该部分重要的是进度条的布局。进度条布局分为三部分：总进度 <code>progress</code>，当前进度 <code>progress-bar</code>，进度点 <code>progress-dot</code>，其中总进度作为父级容器设置相对定位，当前进度和进度点作为子级设置绝对定位，进度和进度点通过 js 实时更新 width 和 left 大小。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- home.html --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;d-flex justify-content-between&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 播放进度和音量 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;song-progress d-flex justify-content-between&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;current-time&quot;</span>&gt;</span>00:00<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;progress&quot;</span> <span class="attr">id</span>=<span class="string">&quot;progress-bar&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;progress-bar&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;progress-dot&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;total-time&quot;</span>&gt;</span>00:00<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;volume d-flex&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">svg</span> <span class="attr">class</span>=<span class="string">&quot;icon volume-icon&quot;</span> <span class="attr">aria-hidden</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">use</span> <span class="attr">xlink:href</span>=<span class="string">&quot;#icon-yinliang&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">use</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;progress&quot;</span> <span class="attr">id</span>=<span class="string">&quot;volume-bar&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;progress-bar&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;progress-dot&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>播放进度和音量 html 布局，该部分重要的是进度条的布局。进度条布局分为三部分：总进度 <code>progress</code>，当前进度 <code>progress-bar</code>，进度点 <code>progress-dot</code>，其中总进度作为父级容器设置相对定位，当前进度和进度点作为子级设置绝对定位，进度和进度点通过 js 实时更新 width 和 left 大小</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- home.html --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;d-flex justify-content-between&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 播放进度和音量 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;song-progress d-flex justify-content-between&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;current-time&quot;</span>&gt;</span>00:00<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;progress&quot;</span> <span class="attr">id</span>=<span class="string">&quot;progress-bar&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;progress-bar&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;progress-dot&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;total-time&quot;</span>&gt;</span>00:00<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;volume d-flex&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">svg</span> <span class="attr">class</span>=<span class="string">&quot;icon volume-icon&quot;</span> <span class="attr">aria-hidden</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">use</span> <span class="attr">xlink:href</span>=<span class="string">&quot;#icon-yinliang&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">use</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;progress&quot;</span> <span class="attr">id</span>=<span class="string">&quot;volume-bar&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;progress-bar&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;progress-dot&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>播放进度和音量 css 样式。总进度 <code>progress</code>：设置相对定位和背景色。当前进度 <code>progress-bar</code>：设置绝对定位和背景色。进度点 <code>progress-dot</code>：设置绝对定位和背景色，等宽高，<code>border-radius:50%</code> 设置为圆角。</p><p>flex 作为目前越来越流行的布局方式，这个知识点必须要掌握。本实验中 flex 的知识点主要是 justify-content 和 align-item 的应用，如果不熟悉的话需要下去补强。对于常见的两栏和三栏布局，这个也是必须要掌握的。本实验是通过 flex 完成的，其他的方式还包括 float 和定位。</p><p>svg 矢量图标，可以做到缩放无变形，目前也已经被广泛应用。iconfont 开源免费且资源众多，且支持 Unicode 引用/font-class 引用/Symbol 引用，可以满足绝大多数图标需求。</p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      
        <tags>
            
            <tag> javascript </tag>
            
            <tag> music player </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>写一个音乐播放器_基础知识介绍</title>
      <link href="2022/04/23/%E5%86%99%E4%B8%80%E4%B8%AA%E9%9F%B3%E4%B9%90%E6%92%AD%E6%94%BE%E5%99%A8/"/>
      <url>2022/04/23/%E5%86%99%E4%B8%80%E4%B8%AA%E9%9F%B3%E4%B9%90%E6%92%AD%E6%94%BE%E5%99%A8/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>这东西写得是真的累</p><span id="more"></span><h2 id="项目简介"><a href="#项目简介" class="headerlink" title="项目简介"></a>项目简介</h2><p>本项目采用原生 JavaScript 搭建类似网易云的音乐播放器，旨在帮助前端初学者快速入门项目开发，同时参照目前主流的响应式框架思想，未后续的框架学习打下一定的基础。其中应用到的技术包括 ES6 新增的语法糖如解构赋值、箭头函数、展开运算符模板字符串 ，异步处理 Promise，ES6 模块化，异步网络请求 Ajax，单页面应用思想，数据响应式思想。通过上述技术最终完成页面切换，轮播图，音乐播放器等功能</p><p><img data-src="https://doc.shiyanlou.com/courses/3871/1621685/79b5e6aa937b3b52871d095f268a37db-0" alt="01-1-1" style="zoom:50%;" /></p><p><img data-src="https://doc.shiyanlou.com/courses/3871/1621685/fd6ab8ff23b77b9c7b230ef459884ca1-0" alt="01-2" style="zoom:50%;" /></p><h4 id="项目一般约束"><a href="#项目一般约束" class="headerlink" title="项目一般约束"></a>项目一般约束</h4><ol><li>开发环境约束：<ul><li>开发工具：VSCode</li><li>开发语言：HTML5 、CSS3 、JavaScript</li></ul></li><li>时间约束：建议开发周期控制在 2 周内，需要开发者合理规划好时间</li><li>技术约束：HTML5 、CSS3 、JavaScript（ES6）、Ajax</li></ol><h3 id="具体功能"><a href="#具体功能" class="headerlink" title="具体功能"></a>具体功能</h3><h4 id="首页"><a href="#首页" class="headerlink" title="首页"></a>首页</h4><p>包括:轮播图,推荐歌单列表,歌曲控制栏,播放列表</p><p><img data-src="https://doc.shiyanlou.com/courses/3871/1621685/a2ff126d5c31bd5840a39e61fb50f6ee-0" alt="01-3" style="zoom:67%;" /></p><p>涉及到的功能如下：</p><ul><li>共通部分（所有页面都使用到的）：所用到的数据都是通过 Ajax 向后端发起请求，结合异步操作 Promise 等待结果；使用模板字符串，根据数据大小动态生成页面上所有的 DOM 元素；proxy 实现数据响应式，监听到数据变化自动渲染视图；基于单页面应用实现页面跳转；</li><li>轮播图：循环显示图片；</li><li><p>推荐歌单列表：使用 CSS3 的 transition 当移入歌单时会有缩放动画效果，点击歌单跳转到推荐歌单详情页（页面二）</p></li><li><p>歌曲控制栏：使用 HMTL5 的 audio 元素的属性和方法，控制歌曲的播放、暂停、进度、音量，进度条、歌单列表及歌曲图标信息显示，点击歌单图标页面跳转到播放器页面（页面三）；</p></li><li>播放列表：对歌曲控制栏按钮添加事件监听，绑定点击事件实现关闭和隐藏，列表中的歌曲绑定点击事件实现歌曲播放</li></ul><h4 id="推荐歌单详情页"><a href="#推荐歌单详情页" class="headerlink" title="推荐歌单详情页"></a>推荐歌单详情页</h4><p>推荐歌单详情页（页面二）包括三部分：导航栏，歌单信息，歌曲列表</p><p><img data-src="https://doc.shiyanlou.com/courses/3871/1621685/374a393d6bcdd74a44aafd112f5ab8f3-0" alt="01-5" style="zoom:50%;" /></p><p>涉及到的功能如下：</p><ul><li>导航栏：实现返回首页功能，导航栏为 a 标签，点击导航栏 hash 值变化，hash 值是数据响应式，数据变化会调用页面跳转的函数；</li><li>歌单信息：显示歌单信息，添加按钮绑定点击事件，将歌单添加到播放列表中，播放列表是数据响应式，数据变化播放列表重新渲染。</li></ul><p>歌曲列表：显示歌曲列表绑定鼠标移入移出事件，鼠标移入高亮，双击歌曲播放对应歌曲</p><h4 id="播放器页面"><a href="#播放器页面" class="headerlink" title="播放器页面"></a>播放器页面</h4><p>播放器页面（页面三）包括三部分：播放器背景，歌曲封面，歌词</p><p><img data-src="https://doc.shiyanlou.com/courses/3871/1621685/656538697fef2d8048051ed8da71592b-0" alt="01-8" style="zoom:50%;" /></p><ul><li>播放器背景：通过 canvas 实现图片的像素点操作，对图片进行高斯模糊，同时背景半透明黑化解决纯色画面显示不佳的问题</li><li>歌曲封面：随歌曲播放/暂停，封面旋转/暂停</li><li>歌词：通过正则表达式提取歌词和时间信息，并随歌曲进度自动滚动/高亮当前进度歌词</li></ul><p>接口</p><h4 id="获得轮播图信息"><a href="#获得轮播图信息" class="headerlink" title="获得轮播图信息"></a>获得轮播图信息</h4><ul><li>接口描述：获取首页数据，包括轮播图和推荐歌单数据</li><li>数据格式：JSON</li><li>请求方式：GET</li><li>接口 URL ：<code>http://localhost:3000/homepage/block/page</code></li><li>提示：端口地址为本地启动端口，推荐使用 VSCode 下，Live Server 插件。</li></ul><p>响应数据说明：用到的数据 <code>data.blocks</code></p><div class="table-container"><table><thead><tr><th>名称</th><th>说明</th></tr></thead><tbody><tr><td>data.blocks[0].extInfo.banners</td><td>轮播图数组</td></tr><tr><td>data.blocks[0].extInfo.banners.pic</td><td>轮播图图片地址</td></tr><tr><td>data.blocks[0].extInfo.banners.bannerId</td><td>轮播图图片 id</td></tr><tr><td>data.blocks[1].creatives</td><td>推荐歌单数组</td></tr><tr><td>data.blocks[1].creatives.creativeId</td><td>歌单 id</td></tr><tr><td>data.blocks[1].creatives.uiElement.image.imageUrl</td><td>歌单图片</td></tr><tr><td>data.blocks[1].creatives.uiElement.mainTitle.title</td><td>歌单名称</td></tr></tbody></table></div><details style="box-sizing: border-box; display: block; margin-top: 0px; margin-bottom: 16px; color: rgb(36, 41, 46); font-family: &quot;Helvetica Neue&quot;, Arial, &quot;Hiragino Sans GB&quot;, STHeiti, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, SimSun, Song, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;"><summary style="box-sizing: border-box; touch-action: manipulation; display: list-item; cursor: pointer; outline: none;">响应示例</summary><pre style="box-sizing: border-box; font-size: 14px; font-family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace; margin-top: 0px; margin-bottom: 1rem; overflow: visible; display: block; color: rgb(33, 37, 41); position: relative; word-break: break-all; border-radius: 4px; white-space: pre-wrap;"><code class="language-json hljs" style="box-sizing: border-box; font-size: inherit; font-family: &quot;Source Code Pro&quot;, Consolas, monospace; color: rgb(248, 248, 242); overflow-wrap: break-word; word-break: normal; display: block; overflow-x: auto; padding: 0.5em; background: rgb(35, 36, 31);"><span class="hljs-attr" style="box-sizing: border-box; color: rgb(249, 38, 114);"></span><span class="hljs-number" style="box-sizing: border-box; color: rgb(174, 129, 255);"></span><span class="hljs-attr" style="box-sizing: border-box; color: rgb(249, 38, 114);"></span><span class="hljs-attr" style="box-sizing: border-box; color: rgb(249, 38, 114);"></span><span class="hljs-literal" style="box-sizing: border-box; color: rgb(174, 129, 255);"></span><span class="hljs-attr" style="box-sizing: border-box; color: rgb(249, 38, 114);"></span><span class="hljs-attr" style="box-sizing: border-box; color: rgb(249, 38, 114);"></span><span class="hljs-string" style="box-sizing: border-box; color: rgb(230, 219, 116);"></span><span class="hljs-attr" style="box-sizing: border-box; color: rgb(249, 38, 114);"></span><span class="hljs-string" style="box-sizing: border-box; color: rgb(230, 219, 116);"></span><span class="hljs-attr" style="box-sizing: border-box; color: rgb(249, 38, 114);"></span><span class="hljs-attr" style="box-sizing: border-box; color: rgb(249, 38, 114);"></span><span class="hljs-attr" style="box-sizing: border-box; color: rgb(249, 38, 114);"></span><span class="hljs-string" style="box-sizing: border-box; color: rgb(230, 219, 116);"></span><span class="hljs-attr" style="box-sizing: border-box; color: rgb(249, 38, 114);"></span><span class="hljs-string" style="box-sizing: border-box; color: rgb(230, 219, 116);"></span><span class="hljs-attr" style="box-sizing: border-box; color: rgb(249, 38, 114);"></span><span class="hljs-string" style="box-sizing: border-box; color: rgb(230, 219, 116);"></span><span class="hljs-attr" style="box-sizing: border-box; color: rgb(249, 38, 114);"></span><span class="hljs-attr" style="box-sizing: border-box; color: rgb(249, 38, 114);"></span><span class="hljs-attr" style="box-sizing: border-box; color: rgb(249, 38, 114);"></span><span class="hljs-string" style="box-sizing: border-box; color: rgb(230, 219, 116);"></span><span class="hljs-attr" style="box-sizing: border-box; color: rgb(249, 38, 114);"></span><span class="hljs-attr" style="box-sizing: border-box; color: rgb(249, 38, 114);"></span><span class="hljs-string" style="box-sizing: border-box; color: rgb(230, 219, 116);"></span><span class="hljs-attr" style="box-sizing: border-box; color: rgb(249, 38, 114);"></span><span class="hljs-string" style="box-sizing: border-box; color: rgb(230, 219, 116);"></span><span class="hljs-attr" style="box-sizing: border-box; color: rgb(249, 38, 114);"></span><span class="hljs-attr" style="box-sizing: border-box; color: rgb(249, 38, 114);"></span><span class="hljs-attr" style="box-sizing: border-box; color: rgb(249, 38, 114);"></span><span class="hljs-string" style="box-sizing: border-box; color: rgb(230, 219, 116);"></span><span class="hljs-attr" style="box-sizing: border-box; color: rgb(249, 38, 114);"></span><span class="hljs-attr" style="box-sizing: border-box; color: rgb(249, 38, 114);"></span><span class="hljs-string" style="box-sizing: border-box; color: rgb(230, 219, 116);"></span><span class="hljs-attr" style="box-sizing: border-box; color: rgb(249, 38, 114);"></span><span class="hljs-attr" style="box-sizing: border-box; color: rgb(249, 38, 114);"></span><span class="hljs-string" style="box-sizing: border-box; color: rgb(230, 219, 116);"></span><span class="hljs-attr" style="box-sizing: border-box; color: rgb(249, 38, 114);"></span><span class="hljs-string" style="box-sizing: border-box; color: rgb(230, 219, 116);"></span><span class="hljs-string" style="box-sizing: border-box; color: rgb(230, 219, 116);"></span><span class="hljs-string" style="box-sizing: border-box; color: rgb(230, 219, 116);"></span></code><div class="btn-copy" style="box-sizing: border-box; position: absolute; display: flex; flex-direction: column; align-items: center; width: 18px; right: 8px; top: 8px; cursor: pointer; opacity: 0; transition: opacity 0.3s linear 0s; word-break: normal; white-space: normal;"><img class="icon-copy" title="copy" data-src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAYAAACtWK6eAAALCElEQVR4Xu2dXchlZRXH/+uiyDAV7SIm+pg+MBvxow9IpNTArFCbQrS6iKhJ+zCwspu8UKOb6MML+8BREypTCCslI6xw1IiCbMopSTCxEiSKagy8qIsVD52hSXrfs85+zrP3c/b6bTjMxbvW86z1X//fu8857569TRwogAJbKmBogwIosLUCAII7UGAbBQAEe6AAgOABFBimAGeQYbqRlUQBAEkyaNocpgCADNONrCQKAEiSQdPmMAUAZJhuZCVRAECSDJo2hykAIMN0IyuJAgCSZNC0OUwBABmmG1lJFOgGEHc/RdJuScce9joiyRx6bfMOSfea2f29Fti6rkkBcfcTJF0s6WxJu1o3y/qDFfi4mX12cPYGJ04CiLs/Q9LHJF0u6ZgN1i9T6a81sx9narj0Ojog7n6upE9KOjWb2Bve78/M7DUb3sPK5Y8KiLt/SNIXVq6ShF4U2Glmj/ZSzBh1jAaIu39A0pfGaIo9mikAIC2kdffXSbqnxdqsOZoCB8zspNF262Sj5mcQdz9R0p2Snt9Jz5QxTIGrzeyqYambmzUGINctvsrdXJWo/JtmdmFGGZoC4u6vlPTzgcI+IukPA3NJW48CZQY/MrNvrGe5zVulNSCrnj3uk3STpPvM7OHNk5OK56ZAM0DcvVwm8tjispGIbinf40aEIWY6BVoC8jZJtwVb22FmjwdjCUOB0RRoCcj1kvYEOuHMERCJkGkUaAnIAUnlK97tjiclvYSzxzTDZ9flCrQE5J+SnrakhP1m9orlZRKBAtMo0AQQd3+RpN8FWrrFzN4ZiCMEBSZRoBUgZ0q6O9ARnz8CIhEynQIAMp327LwBCgDIBgyJEqdTAECm056dN0ABANmAIVHidAoAyHTas/MGKAAgGzAkSpxOAQCZTnt23gAFUgLi7i+XVP6vyvGSXibpuA2Y1ZxLLJccPXToZWb7emk2DSDu/kZJZ0g6j5vU9WK/Lev48+JK8HvM7NYpq509IO5+uqQPS7poSqHZe7AC5bane81s7+AVKhJnDYi7f17SRyr0IbUfBQool4/99mu2gLj7TySd1s98qWQNCvxL0hvGhGSWgLi7r2EYLNGvArvM7MExypsdIO5+syQuoR/DPdPuMQokswLE3T8l6Ypp58buIynwG0kXtj6TzAYQd399uYfTSMNhmz4UKN9uXdKylDkBUm5v+uaWYrF2lwq8quUTsGYBiLu/V9INK4zvL5I+LekBSb8ysz+tkEvomhVw9yMllRtjl1d54tgqz45pehaZCyB3LR7jFhlduXvjbjP7aySYmPEVcPdV5nlQ0gvMrPy79mPjAXH3561wD9/bzOyCtavIgmtXwN2vkXRZcOF3mdnXgrErhc0BkEslXRvsmjs4BoXqIczd90sqTz9edjT7xTcHQD4n6aPLFJTEHVQCIvUU4u7nS7o9UNMvzKxcnb32Yw6AlLvBvzugzDlmVt7bcmyIAu7+dEnlyt6jlpT8qJntbNHWHAApD7svl7BvdzxhZke3EJA12yrg7t+XdM5U850DIOUGdeVGddsd+8zsrLajZPUWCrh7eezblcvWNrMmXm6yqLuPdmdFdweQZe7Z4J8DSOWDIQFkg90fKB1AACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whcwXkKEkHA2M9z8y+G4jbMsTd75Z05pI19pnZWTX7kDuNArMEpEjp7rdLOn+JrDvM7PEa6QGkRr3+c+cMSPmtXn67b3XsNbNLakcEILUK9p0/W0AWZ5H3S/qMpCOfMoarrfKzx6H1AKRvg9dWN2tAFpCcLOlUSS+U9EdJvzezH9YKByDrUrDvdWYPSGv5OYO0Vnja9QGkUn8AqRSw83QAqRwQgFQK2Hk6gFQOCEAqBew8HUAqBwQglQJ2ng4glQMCkEoBO08HkMoBAUilgJ2nA0jlgACkUsDO0wGkckAAUilg5+kAUjkgAKkUsPN0AKkcEIBUCth5OoBUDghAKgXsPB1AKgcEIJUCdp4OIJUDApBKATtPB5DKAQFIpYCdpwNI5YAApFLAztMBpHJAAFIpYOfpAFI5IACpFLDzdACpHBCAVArYeTqAVA4IQCoF7DwdQCoH5O53STp7yTKPmNmLK7cifQIF3P0aSZct2fqgmR3TojxrseiYa7r7LZLeHtjzpWb2cCCOkI4UcPf9kk5ZUtIBMzupRdlzAORaSZcGxHmPmd0UiCOkEwXc/XhJvw2Uc6eZnRuIWzlkDoBcJenKQOc/NbPTAnGEdKKAu18n6eJAOWu5S+f/22cOgJTTbzkNR44bzOx9kUBiplXA3d8k6XvBKtZ2p86n7rfxgJSG3P3XknYFxXyHmd0ajCVsAgXc/URJB4JbPynp5FafL+cCSOSbjsP1/qqkvZIeMLN/BAdBWGMF3L3covYCSZ9YYavrzSzyNmyFJf8bOhdAyle490raMUCFhyRVPYJhwJ6k/K8Cz5J0gqRnDhDmDDMrs29yzAKQxdusD0r6YhOVWLRXBb5jZm9tWdxsAFlA8m1Ju1sKxtrdKPB3Saeb2YMtK5obIM9efLh7TkvRWLsLBfaY2Y2tK5kVIIuzSHkeyS9bC8f6kypwo5ntGaOC2QGygKR8aL9f0tFjiMgeoyrwZTMrnzdHOWYJyAKSYyV9RdJbRlGSTVor8DdJF5nZD1pvdPj6swXkUJPufoWk8jpiTGHZa60KfKtc0Wtm5RF+ox6zB2RxNnn1AhLOJqPaq2qz8hfymyV9veXfOZZVmAKQw84mz5VUrvEpr52Syrdexw38A9Uybfl5XIEnFg94fUzSoVcBY/L/npAKkPi8iESB/ygAIDgBBbZRAECwBwoACB5AgWEKcAYZphtZSRQAkCSDps1hCgDIMN3ISqIAgCQZNG0OUwBAhulGVhIFACTJoGlzmAIAMkw3spIoACBJBk2bwxQAkGG6kZVEAQBJMmjaHKbAvwGyE7Iy90AbtwAAAABJRU5ErkJggg==" style="box-sizing: initial; vertical-align: middle; border-style: none; max-width: 100%; background: rgb(35, 35, 30); border-radius: 4px;"></div></pre></details><h4 id="获得推荐歌单列表信息"><a href="#获得推荐歌单列表信息" class="headerlink" title="获得推荐歌单列表信息"></a>获得推荐歌单列表信息</h4><ul><li>接口描述：传入歌单 id, 可以获取对应歌单内的所有的音乐信息</li><li>数据格式：JSON</li><li>请求方式：GET</li><li>接口 URL ：<code>http://localhost:3000/playlist/detail?id=5146191146</code></li><li>必选参数 : <code>id</code></li><li>提示：端口地址为本地启动端口，推荐使用 VSCode 下，Live Server 插件。</li></ul><p>响应数据说明：用到的数据 <code>playlist</code></p><div class="table-container"><table><thead><tr><th>名称</th><th>说明</th></tr></thead><tbody><tr><td>playlist</td><td>歌单对象</td></tr><tr><td>playlist.name</td><td>歌单名</td></tr><tr><td>playlist.createTime</td><td>歌单创建时间</td></tr><tr><td>playlist.coverImgUrl</td><td>歌单封面</td></tr><tr><td>playlist.creator.avatarUrl</td><td>歌单创建者头像</td></tr><tr><td>playlist.description</td><td>歌单描述</td></tr><tr><td>playlist.tracks</td><td>歌单歌曲列表数组</td></tr><tr><td>playlist.tracks.id</td><td>歌曲 id</td></tr><tr><td>playlist.tracks.name</td><td>歌曲名称</td></tr><tr><td>playlist.tracks.ar</td><td>歌曲歌手信息</td></tr><tr><td>playlist.tracks.al</td><td>歌曲所属专辑信息</td></tr><tr><td>playlist.tracks.dt</td><td>歌曲时长</td></tr></tbody></table></div><details style="box-sizing: border-box; display: block; margin-top: 0px; margin-bottom: 16px; color: rgb(36, 41, 46); font-family: &quot;Helvetica Neue&quot;, Arial, &quot;Hiragino Sans GB&quot;, STHeiti, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, SimSun, Song, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;"><summary style="box-sizing: border-box; touch-action: manipulation; display: list-item; cursor: pointer; outline: none;">响应示例</summary><pre style="box-sizing: border-box; font-size: 14px; font-family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace; margin-top: 0px; margin-bottom: 1rem; overflow: visible; display: block; color: rgb(33, 37, 41); position: relative; word-break: break-all; border-radius: 4px; white-space: pre-wrap;"><code class="language-json hljs" style="box-sizing: border-box; font-size: inherit; font-family: &quot;Source Code Pro&quot;, Consolas, monospace; color: rgb(248, 248, 242); overflow-wrap: break-word; word-break: normal; display: block; overflow-x: auto; padding: 0.5em; background: rgb(35, 36, 31);"><span class="hljs-attr" style="box-sizing: border-box; color: rgb(249, 38, 114);"></span><span class="hljs-number" style="box-sizing: border-box; color: rgb(174, 129, 255);"></span><span class="hljs-attr" style="box-sizing: border-box; color: rgb(249, 38, 114);"></span><span class="hljs-attr" style="box-sizing: border-box; color: rgb(249, 38, 114);"></span><span class="hljs-number" style="box-sizing: border-box; color: rgb(174, 129, 255);"></span><span class="hljs-attr" style="box-sizing: border-box; color: rgb(249, 38, 114);"></span><span class="hljs-string" style="box-sizing: border-box; color: rgb(230, 219, 116);"></span><span class="hljs-attr" style="box-sizing: border-box; color: rgb(249, 38, 114);"></span><span class="hljs-number" style="box-sizing: border-box; color: rgb(174, 129, 255);"></span><span class="hljs-attr" style="box-sizing: border-box; color: rgb(249, 38, 114);"></span><span class="hljs-string" style="box-sizing: border-box; color: rgb(230, 219, 116);"></span><span class="hljs-attr" style="box-sizing: border-box; color: rgb(249, 38, 114);"></span><span class="hljs-number" style="box-sizing: border-box; color: rgb(174, 129, 255);"></span><span class="hljs-attr" style="box-sizing: border-box; color: rgb(249, 38, 114);"></span><span class="hljs-string" style="box-sizing: border-box; color: rgb(230, 219, 116);"></span><span class="hljs-string" style="box-sizing: border-box; color: rgb(230, 219, 116);"></span><span class="hljs-string" style="box-sizing: border-box; color: rgb(230, 219, 116);"></span><span class="hljs-attr" style="box-sizing: border-box; color: rgb(249, 38, 114);"></span><span class="hljs-string" style="box-sizing: border-box; color: rgb(230, 219, 116);"></span><span class="hljs-attr" style="box-sizing: border-box; color: rgb(249, 38, 114);"></span><span class="hljs-literal" style="box-sizing: border-box; color: rgb(174, 129, 255);"></span><span class="hljs-attr" style="box-sizing: border-box; color: rgb(249, 38, 114);"></span><span class="hljs-number" style="box-sizing: border-box; color: rgb(174, 129, 255);"></span><span class="hljs-attr" style="box-sizing: border-box; color: rgb(249, 38, 114);"></span><span class="hljs-literal" style="box-sizing: border-box; color: rgb(174, 129, 255);"></span><span class="hljs-attr" style="box-sizing: border-box; color: rgb(249, 38, 114);"></span><span class="hljs-number" style="box-sizing: border-box; color: rgb(174, 129, 255);"></span><span class="hljs-attr" style="box-sizing: border-box; color: rgb(249, 38, 114);"></span><span class="hljs-literal" style="box-sizing: border-box; color: rgb(174, 129, 255);"></span><span class="hljs-attr" style="box-sizing: border-box; color: rgb(249, 38, 114);"></span><span class="hljs-literal" style="box-sizing: border-box; color: rgb(174, 129, 255);"></span><span class="hljs-attr" style="box-sizing: border-box; color: rgb(249, 38, 114);"></span><span class="hljs-literal" style="box-sizing: border-box; color: rgb(174, 129, 255);"></span><span class="hljs-attr" style="box-sizing: border-box; color: rgb(249, 38, 114);"></span><span class="hljs-literal" style="box-sizing: border-box; color: rgb(174, 129, 255);"></span><span class="hljs-attr" style="box-sizing: border-box; color: rgb(249, 38, 114);"></span><span class="hljs-attr" style="box-sizing: border-box; color: rgb(249, 38, 114);"></span><span class="hljs-string" style="box-sizing: border-box; color: rgb(230, 219, 116);"></span><span class="hljs-attr" style="box-sizing: border-box; color: rgb(249, 38, 114);"></span><span class="hljs-attr" style="box-sizing: border-box; color: rgb(249, 38, 114);"></span><span class="hljs-string" style="box-sizing: border-box; color: rgb(230, 219, 116);"></span><span class="hljs-attr" style="box-sizing: border-box; color: rgb(249, 38, 114);"></span><span class="hljs-number" style="box-sizing: border-box; color: rgb(174, 129, 255);"></span><span class="hljs-attr" style="box-sizing: border-box; color: rgb(249, 38, 114);"></span><span class="hljs-attr" style="box-sizing: border-box; color: rgb(249, 38, 114);"></span><span class="hljs-number" style="box-sizing: border-box; color: rgb(174, 129, 255);"></span><span class="hljs-attr" style="box-sizing: border-box; color: rgb(249, 38, 114);"></span><span class="hljs-string" style="box-sizing: border-box; color: rgb(230, 219, 116);"></span><span class="hljs-attr" style="box-sizing: border-box; color: rgb(249, 38, 114);"></span><span class="hljs-attr" style="box-sizing: border-box; color: rgb(249, 38, 114);"></span><span class="hljs-attr" style="box-sizing: border-box; color: rgb(249, 38, 114);"></span><span class="hljs-attr" style="box-sizing: border-box; color: rgb(249, 38, 114);"></span><span class="hljs-number" style="box-sizing: border-box; color: rgb(174, 129, 255);"></span><span class="hljs-attr" style="box-sizing: border-box; color: rgb(249, 38, 114);"></span><span class="hljs-string" style="box-sizing: border-box; color: rgb(230, 219, 116);"></span><span class="hljs-attr" style="box-sizing: border-box; color: rgb(249, 38, 114);"></span><span class="hljs-string" style="box-sizing: border-box; color: rgb(230, 219, 116);"></span><span class="hljs-attr" style="box-sizing: border-box; color: rgb(249, 38, 114);"></span><span class="hljs-attr" style="box-sizing: border-box; color: rgb(249, 38, 114);"></span><span class="hljs-string" style="box-sizing: border-box; color: rgb(230, 219, 116);"></span><span class="hljs-attr" style="box-sizing: border-box; color: rgb(249, 38, 114);"></span><span class="hljs-number" style="box-sizing: border-box; color: rgb(174, 129, 255);"></span><span class="hljs-attr" style="box-sizing: border-box; color: rgb(249, 38, 114);"></span><span class="hljs-number" style="box-sizing: border-box; color: rgb(174, 129, 255);"></span></code><div class="btn-copy" style="box-sizing: border-box; position: absolute; display: flex; flex-direction: column; align-items: center; width: 18px; right: 8px; top: 8px; cursor: pointer; opacity: 0; transition: opacity 0.3s linear 0s; word-break: normal; white-space: normal;"><img class="icon-copy" title="copy" data-src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAYAAACtWK6eAAALCElEQVR4Xu2dXchlZRXH/+uiyDAV7SIm+pg+MBvxow9IpNTArFCbQrS6iKhJ+zCwspu8UKOb6MML+8BREypTCCslI6xw1IiCbMopSTCxEiSKagy8qIsVD52hSXrfs85+zrP3c/b6bTjMxbvW86z1X//fu8857569TRwogAJbKmBogwIosLUCAII7UGAbBQAEe6AAgOABFBimAGeQYbqRlUQBAEkyaNocpgCADNONrCQKAEiSQdPmMAUAZJhuZCVRAECSDJo2hykAIMN0IyuJAgCSZNC0OUwBABmmG1lJFOgGEHc/RdJuScce9joiyRx6bfMOSfea2f29Fti6rkkBcfcTJF0s6WxJu1o3y/qDFfi4mX12cPYGJ04CiLs/Q9LHJF0u6ZgN1i9T6a81sx9narj0Ojog7n6upE9KOjWb2Bve78/M7DUb3sPK5Y8KiLt/SNIXVq6ShF4U2Glmj/ZSzBh1jAaIu39A0pfGaIo9mikAIC2kdffXSbqnxdqsOZoCB8zspNF262Sj5mcQdz9R0p2Snt9Jz5QxTIGrzeyqYambmzUGINctvsrdXJWo/JtmdmFGGZoC4u6vlPTzgcI+IukPA3NJW48CZQY/MrNvrGe5zVulNSCrnj3uk3STpPvM7OHNk5OK56ZAM0DcvVwm8tjispGIbinf40aEIWY6BVoC8jZJtwVb22FmjwdjCUOB0RRoCcj1kvYEOuHMERCJkGkUaAnIAUnlK97tjiclvYSzxzTDZ9flCrQE5J+SnrakhP1m9orlZRKBAtMo0AQQd3+RpN8FWrrFzN4ZiCMEBSZRoBUgZ0q6O9ARnz8CIhEynQIAMp327LwBCgDIBgyJEqdTAECm056dN0ABANmAIVHidAoAyHTas/MGKAAgGzAkSpxOAQCZTnt23gAFUgLi7i+XVP6vyvGSXibpuA2Y1ZxLLJccPXToZWb7emk2DSDu/kZJZ0g6j5vU9WK/Lev48+JK8HvM7NYpq509IO5+uqQPS7poSqHZe7AC5bane81s7+AVKhJnDYi7f17SRyr0IbUfBQool4/99mu2gLj7TySd1s98qWQNCvxL0hvGhGSWgLi7r2EYLNGvArvM7MExypsdIO5+syQuoR/DPdPuMQokswLE3T8l6Ypp58buIynwG0kXtj6TzAYQd399uYfTSMNhmz4UKN9uXdKylDkBUm5v+uaWYrF2lwq8quUTsGYBiLu/V9INK4zvL5I+LekBSb8ysz+tkEvomhVw9yMllRtjl1d54tgqz45pehaZCyB3LR7jFhlduXvjbjP7aySYmPEVcPdV5nlQ0gvMrPy79mPjAXH3561wD9/bzOyCtavIgmtXwN2vkXRZcOF3mdnXgrErhc0BkEslXRvsmjs4BoXqIczd90sqTz9edjT7xTcHQD4n6aPLFJTEHVQCIvUU4u7nS7o9UNMvzKxcnb32Yw6AlLvBvzugzDlmVt7bcmyIAu7+dEnlyt6jlpT8qJntbNHWHAApD7svl7BvdzxhZke3EJA12yrg7t+XdM5U850DIOUGdeVGddsd+8zsrLajZPUWCrh7eezblcvWNrMmXm6yqLuPdmdFdweQZe7Z4J8DSOWDIQFkg90fKB1AACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whcwXkKEkHA2M9z8y+G4jbMsTd75Z05pI19pnZWTX7kDuNArMEpEjp7rdLOn+JrDvM7PEa6QGkRr3+c+cMSPmtXn67b3XsNbNLakcEILUK9p0/W0AWZ5H3S/qMpCOfMoarrfKzx6H1AKRvg9dWN2tAFpCcLOlUSS+U9EdJvzezH9YKByDrUrDvdWYPSGv5OYO0Vnja9QGkUn8AqRSw83QAqRwQgFQK2Hk6gFQOCEAqBew8HUAqBwQglQJ2ng4glQMCkEoBO08HkMoBAUilgJ2nA0jlgACkUsDO0wGkckAAUilg5+kAUjkgAKkUsPN0AKkcEIBUCth5OoBUDghAKgXsPB1AKgcEIJUCdp4OIJUDApBKATtPB5DKAQFIpYCdpwNI5YAApFLAztMBpHJAAFIpYOfpAFI5IACpFLDzdACpHBCAVArYeTqAVA4IQCoF7DwdQCoH5O53STp7yTKPmNmLK7cifQIF3P0aSZct2fqgmR3TojxrseiYa7r7LZLeHtjzpWb2cCCOkI4UcPf9kk5ZUtIBMzupRdlzAORaSZcGxHmPmd0UiCOkEwXc/XhJvw2Uc6eZnRuIWzlkDoBcJenKQOc/NbPTAnGEdKKAu18n6eJAOWu5S+f/22cOgJTTbzkNR44bzOx9kUBiplXA3d8k6XvBKtZ2p86n7rfxgJSG3P3XknYFxXyHmd0ajCVsAgXc/URJB4JbPynp5FafL+cCSOSbjsP1/qqkvZIeMLN/BAdBWGMF3L3covYCSZ9YYavrzSzyNmyFJf8bOhdAyle490raMUCFhyRVPYJhwJ6k/K8Cz5J0gqRnDhDmDDMrs29yzAKQxdusD0r6YhOVWLRXBb5jZm9tWdxsAFlA8m1Ju1sKxtrdKPB3Saeb2YMtK5obIM9efLh7TkvRWLsLBfaY2Y2tK5kVIIuzSHkeyS9bC8f6kypwo5ntGaOC2QGygKR8aL9f0tFjiMgeoyrwZTMrnzdHOWYJyAKSYyV9RdJbRlGSTVor8DdJF5nZD1pvdPj6swXkUJPufoWk8jpiTGHZa60KfKtc0Wtm5RF+ox6zB2RxNnn1AhLOJqPaq2qz8hfymyV9veXfOZZVmAKQw84mz5VUrvEpr52Syrdexw38A9Uybfl5XIEnFg94fUzSoVcBY/L/npAKkPi8iESB/ygAIDgBBbZRAECwBwoACB5AgWEKcAYZphtZSRQAkCSDps1hCgDIMN3ISqIAgCQZNG0OUwBAhulGVhIFACTJoGlzmAIAMkw3spIoACBJBk2bwxQAkGG6kZVEAQBJMmjaHKbAvwGyE7Iy90AbtwAAAABJRU5ErkJggg==" style="box-sizing: initial; vertical-align: middle; border-style: none; max-width: 100%; background: rgb(35, 35, 30); border-radius: 4px;"></div></pre></details><h4 id="获得歌曲信息"><a href="#获得歌曲信息" class="headerlink" title="获得歌曲信息"></a>获得歌曲信息</h4><ul><li>接口描述： 传入音乐 ids, 可获得歌曲详情</li><li>数据格式：JSON</li><li>请求方式：GET</li><li>接口 URL ：<code>http://localhost:3000/song/detail?ids=5243631</code></li><li>必选参数 : <code>ids</code></li><li>提示：端口地址为本地启动端口，推荐使用 VSCode 下，Live Server 插件。</li></ul><p>响应数据说明：用到的数据 <code>songs</code></p><div class="table-container"><table><thead><tr><th>名称</th><th>说明</th></tr></thead><tbody><tr><td>name</td><td>歌曲名称</td></tr><tr><td>id</td><td>歌曲 id</td></tr><tr><td>ar</td><td>歌手信息</td></tr><tr><td>al</td><td>专辑信息</td></tr></tbody></table></div><details style="box-sizing: border-box; display: block; margin-top: 0px; margin-bottom: 16px; color: rgb(36, 41, 46); font-family: &quot;Helvetica Neue&quot;, Arial, &quot;Hiragino Sans GB&quot;, STHeiti, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, SimSun, Song, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial;"><summary style="box-sizing: border-box; touch-action: manipulation; display: list-item; cursor: pointer; outline: none;">响应示例</summary><pre style="box-sizing: border-box; font-size: 14px; font-family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace; margin-top: 0px; margin-bottom: 1rem; overflow: visible; display: block; color: rgb(33, 37, 41); position: relative; word-break: break-all; border-radius: 4px; white-space: pre-wrap;"><code class="language-json hljs" style="box-sizing: border-box; font-size: inherit; font-family: &quot;Source Code Pro&quot;, Consolas, monospace; color: rgb(248, 248, 242); overflow-wrap: break-word; word-break: normal; display: block; overflow-x: auto; padding: 0.5em; background: rgb(35, 36, 31);"><span class="hljs-attr" style="box-sizing: border-box; color: rgb(249, 38, 114);"></span><span class="hljs-attr" style="box-sizing: border-box; color: rgb(249, 38, 114);"></span><span class="hljs-string" style="box-sizing: border-box; color: rgb(230, 219, 116);"></span><span class="hljs-attr" style="box-sizing: border-box; color: rgb(249, 38, 114);"></span><span class="hljs-number" style="box-sizing: border-box; color: rgb(174, 129, 255);"></span><span class="hljs-attr" style="box-sizing: border-box; color: rgb(249, 38, 114);"></span><span class="hljs-number" style="box-sizing: border-box; color: rgb(174, 129, 255);"></span><span class="hljs-attr" style="box-sizing: border-box; color: rgb(249, 38, 114);"></span><span class="hljs-attr" style="box-sizing: border-box; color: rgb(249, 38, 114);"></span><span class="hljs-number" style="box-sizing: border-box; color: rgb(174, 129, 255);"></span><span class="hljs-attr" style="box-sizing: border-box; color: rgb(249, 38, 114);"></span><span class="hljs-string" style="box-sizing: border-box; color: rgb(230, 219, 116);"></span><span class="hljs-attr" style="box-sizing: border-box; color: rgb(249, 38, 114);"></span><span class="hljs-attr" style="box-sizing: border-box; color: rgb(249, 38, 114);"></span><span class="hljs-attr" style="box-sizing: border-box; color: rgb(249, 38, 114);"></span><span class="hljs-attr" style="box-sizing: border-box; color: rgb(249, 38, 114);"></span><span class="hljs-number" style="box-sizing: border-box; color: rgb(174, 129, 255);"></span><span class="hljs-attr" style="box-sizing: border-box; color: rgb(249, 38, 114);"></span><span class="hljs-string" style="box-sizing: border-box; color: rgb(230, 219, 116);"></span><span class="hljs-attr" style="box-sizing: border-box; color: rgb(249, 38, 114);"></span><span class="hljs-string" style="box-sizing: border-box; color: rgb(230, 219, 116);"></span><span class="hljs-attr" style="box-sizing: border-box; color: rgb(249, 38, 114);"></span><span class="hljs-attr" style="box-sizing: border-box; color: rgb(249, 38, 114);"></span><span class="hljs-number" style="box-sizing: border-box; color: rgb(174, 129, 255);"></span><span class="hljs-attr" style="box-sizing: border-box; color: rgb(249, 38, 114);"></span><span class="hljs-number" style="box-sizing: border-box; color: rgb(174, 129, 255);"></span><span class="hljs-attr" style="box-sizing: border-box; color: rgb(249, 38, 114);"></span><span class="hljs-number" style="box-sizing: border-box; color: rgb(174, 129, 255);"></span></code><div class="btn-copy" style="box-sizing: border-box; position: absolute; display: flex; flex-direction: column; align-items: center; width: 18px; right: 8px; top: 8px; cursor: pointer; opacity: 0; transition: opacity 0.3s linear 0s; word-break: normal; white-space: normal;"><img class="icon-copy" title="copy" data-src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAYAAACtWK6eAAALCElEQVR4Xu2dXchlZRXH/+uiyDAV7SIm+pg+MBvxow9IpNTArFCbQrS6iKhJ+zCwspu8UKOb6MML+8BREypTCCslI6xw1IiCbMopSTCxEiSKagy8qIsVD52hSXrfs85+zrP3c/b6bTjMxbvW86z1X//fu8857569TRwogAJbKmBogwIosLUCAII7UGAbBQAEe6AAgOABFBimAGeQYbqRlUQBAEkyaNocpgCADNONrCQKAEiSQdPmMAUAZJhuZCVRAECSDJo2hykAIMN0IyuJAgCSZNC0OUwBABmmG1lJFOgGEHc/RdJuScce9joiyRx6bfMOSfea2f29Fti6rkkBcfcTJF0s6WxJu1o3y/qDFfi4mX12cPYGJ04CiLs/Q9LHJF0u6ZgN1i9T6a81sx9narj0Ojog7n6upE9KOjWb2Bve78/M7DUb3sPK5Y8KiLt/SNIXVq6ShF4U2Glmj/ZSzBh1jAaIu39A0pfGaIo9mikAIC2kdffXSbqnxdqsOZoCB8zspNF262Sj5mcQdz9R0p2Snt9Jz5QxTIGrzeyqYambmzUGINctvsrdXJWo/JtmdmFGGZoC4u6vlPTzgcI+IukPA3NJW48CZQY/MrNvrGe5zVulNSCrnj3uk3STpPvM7OHNk5OK56ZAM0DcvVwm8tjispGIbinf40aEIWY6BVoC8jZJtwVb22FmjwdjCUOB0RRoCcj1kvYEOuHMERCJkGkUaAnIAUnlK97tjiclvYSzxzTDZ9flCrQE5J+SnrakhP1m9orlZRKBAtMo0AQQd3+RpN8FWrrFzN4ZiCMEBSZRoBUgZ0q6O9ARnz8CIhEynQIAMp327LwBCgDIBgyJEqdTAECm056dN0ABANmAIVHidAoAyHTas/MGKAAgGzAkSpxOAQCZTnt23gAFUgLi7i+XVP6vyvGSXibpuA2Y1ZxLLJccPXToZWb7emk2DSDu/kZJZ0g6j5vU9WK/Lev48+JK8HvM7NYpq509IO5+uqQPS7poSqHZe7AC5bane81s7+AVKhJnDYi7f17SRyr0IbUfBQool4/99mu2gLj7TySd1s98qWQNCvxL0hvGhGSWgLi7r2EYLNGvArvM7MExypsdIO5+syQuoR/DPdPuMQokswLE3T8l6Ypp58buIynwG0kXtj6TzAYQd399uYfTSMNhmz4UKN9uXdKylDkBUm5v+uaWYrF2lwq8quUTsGYBiLu/V9INK4zvL5I+LekBSb8ysz+tkEvomhVw9yMllRtjl1d54tgqz45pehaZCyB3LR7jFhlduXvjbjP7aySYmPEVcPdV5nlQ0gvMrPy79mPjAXH3561wD9/bzOyCtavIgmtXwN2vkXRZcOF3mdnXgrErhc0BkEslXRvsmjs4BoXqIczd90sqTz9edjT7xTcHQD4n6aPLFJTEHVQCIvUU4u7nS7o9UNMvzKxcnb32Yw6AlLvBvzugzDlmVt7bcmyIAu7+dEnlyt6jlpT8qJntbNHWHAApD7svl7BvdzxhZke3EJA12yrg7t+XdM5U850DIOUGdeVGddsd+8zsrLajZPUWCrh7eezblcvWNrMmXm6yqLuPdmdFdweQZe7Z4J8DSOWDIQFkg90fKB1AACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whAAIged0f6BxAACRgk7whcwXkKEkHA2M9z8y+G4jbMsTd75Z05pI19pnZWTX7kDuNArMEpEjp7rdLOn+JrDvM7PEa6QGkRr3+c+cMSPmtXn67b3XsNbNLakcEILUK9p0/W0AWZ5H3S/qMpCOfMoarrfKzx6H1AKRvg9dWN2tAFpCcLOlUSS+U9EdJvzezH9YKByDrUrDvdWYPSGv5OYO0Vnja9QGkUn8AqRSw83QAqRwQgFQK2Hk6gFQOCEAqBew8HUAqBwQglQJ2ng4glQMCkEoBO08HkMoBAUilgJ2nA0jlgACkUsDO0wGkckAAUilg5+kAUjkgAKkUsPN0AKkcEIBUCth5OoBUDghAKgXsPB1AKgcEIJUCdp4OIJUDApBKATtPB5DKAQFIpYCdpwNI5YAApFLAztMBpHJAAFIpYOfpAFI5IACpFLDzdACpHBCAVArYeTqAVA4IQCoF7DwdQCoH5O53STp7yTKPmNmLK7cifQIF3P0aSZct2fqgmR3TojxrseiYa7r7LZLeHtjzpWb2cCCOkI4UcPf9kk5ZUtIBMzupRdlzAORaSZcGxHmPmd0UiCOkEwXc/XhJvw2Uc6eZnRuIWzlkDoBcJenKQOc/NbPTAnGEdKKAu18n6eJAOWu5S+f/22cOgJTTbzkNR44bzOx9kUBiplXA3d8k6XvBKtZ2p86n7rfxgJSG3P3XknYFxXyHmd0ajCVsAgXc/URJB4JbPynp5FafL+cCSOSbjsP1/qqkvZIeMLN/BAdBWGMF3L3covYCSZ9YYavrzSzyNmyFJf8bOhdAyle490raMUCFhyRVPYJhwJ6k/K8Cz5J0gqRnDhDmDDMrs29yzAKQxdusD0r6YhOVWLRXBb5jZm9tWdxsAFlA8m1Ju1sKxtrdKPB3Saeb2YMtK5obIM9efLh7TkvRWLsLBfaY2Y2tK5kVIIuzSHkeyS9bC8f6kypwo5ntGaOC2QGygKR8aL9f0tFjiMgeoyrwZTMrnzdHOWYJyAKSYyV9RdJbRlGSTVor8DdJF5nZD1pvdPj6swXkUJPufoWk8jpiTGHZa60KfKtc0Wtm5RF+ox6zB2RxNnn1AhLOJqPaq2qz8hfymyV9veXfOZZVmAKQw84mz5VUrvEpr52Syrdexw38A9Uybfl5XIEnFg94fUzSoVcBY/L/npAKkPi8iESB/ygAIDgBBbZRAECwBwoACB5AgWEKcAYZphtZSRQAkCSDps1hCgDIMN3ISqIAgCQZNG0OUwBAhulGVhIFACTJoGlzmAIAMkw3spIoACBJBk2bwxQAkGG6kZVEAQBJMmjaHKbAvwGyE7Iy90AbtwAAAABJRU5ErkJggg==" style="box-sizing: initial; vertical-align: middle; border-style: none; max-width: 100%; background: rgb(35, 35, 30); border-radius: 4px;"></div></pre></details><h4 id="获得歌曲歌词"><a href="#获得歌曲歌词" class="headerlink" title="获得歌曲歌词"></a>获得歌曲歌词</h4><ul><li>接口描述： 传入音乐 id, 可获得对应音乐的歌词</li><li>数据格式：JSON</li><li>请求方式：GET</li><li>接口 URL ：<code>http://localhost:3000/lyric?id=5243631</code></li><li>必选参数 : <code>id</code></li><li>提示：端口地址为本地启动端口，推荐使用 VSCode 下，Live Server 插件。</li></ul><p>响应数据说明：用到的数据 <code>lrc</code></p><div class="table-container"><table><thead><tr><th>名称</th><th>说明</th></tr></thead><tbody><tr><td>lrc</td><td>歌词</td></tr></tbody></table></div><h2 id="模块化以及ajax使用"><a href="#模块化以及ajax使用" class="headerlink" title="模块化以及ajax使用"></a>模块化以及ajax使用</h2><h4 id="知识点"><a href="#知识点" class="headerlink" title="知识点"></a>知识点</h4><ul><li>模块化及使用</li><li>Ajax 及使用</li><li>Promise 异步处理</li></ul><p>模块就是一个 JS 文件，它实现了一部分功能，并隐藏自己的内部实现，同时提供了一些接口供其他模块使用。模块解决的问题是全局变量污染和依赖混乱问题，为前端开发大型应用提供了基础。目前成熟的模块化解决方案有 CommonJS/AMD/CMD/ESM。</p><p>common js使用module.exports和require.</p><p>es6使用import和export</p><p>下面介绍一下es6的模块</p><p>本实验采用的是 ESM，ESM 作为 ES6 模块化的正式标准 ，目前主流浏览器能够正常运行。</p><ul><li>ESM 使用</li></ul><p>首先在浏览器使用 ESM，仅需要在 script 标签加入 <code>type=&quot;module&quot;</code>属性</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;入口文件&quot;</span> <span class="attr">type</span>=<span class="string">&quot;module&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li><p>基本导入导出</p><p><strong>基本导出</strong>：类似于 <code>exports.xxx = xxxx</code> ，基本导出可以有多个，每个必须有名称</p><p>基本导出的语法如下：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> 声明表达式</span><br><span class="line">或</span><br><span class="line"><span class="keyword">export</span> &#123;具名符号&#125;</span><br></pre></td></tr></table></figure><p>由于基本导出必须具有名称，所以要求导出内容必须跟上声明表达式或具名符号。</p><p><strong>基本导入</strong>：由于使用的是依赖预加载，因此，导入任何其他模块，导入代码必须放置到所有代码之前。对于基本导出，如果要进行导入，使用下面的代码</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; 导入的符号列表 &#125; <span class="keyword">from</span> <span class="string">&quot;模块路径&quot;</span>;</span><br></pre></td></tr></table></figure><p>注意以下细节：</p><ul><li>导入时，可以通过关键字<code>as</code>对导入的符号进行重命名</li><li>导入时使用的符号是常量，不可修改</li><li>可以使用*号导入所有的基本导出，形成一个对象</li></ul></li></ul><p>默认导入导出</p><p><strong>默认导出</strong>：每个模块，除了允许有多个基本导出之外，还允许有一个默认导出，默认导出类似于 CommonJS 中的<code>module.exports</code>，由于只有一个，因此无需具名</p><p>具体的语法是</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> 默认导出的数据</span><br><span class="line">或</span><br><span class="line"><span class="keyword">export</span> &#123;默认导出的数据 <span class="keyword">as</span> <span class="keyword">default</span>&#125;</span><br></pre></td></tr></table></figure><p>由于每个模块仅允许有一个默认导出，因此，每个模块不能出现多个默认导出语句</p><p><strong>默认导入</strong>：需要想要导入一个模块的默认导出，需要使用下面的语法</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> 接收变量名 <span class="keyword">from</span> <span class="string">&quot;模块路径&quot;</span>;</span><br></pre></td></tr></table></figure><p>由于默认导入时变量名是自行定义的，因此没有别名一说</p><p>如果希望同时导入某个模块的默认导出和基本导出，可以使用下面的语法</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> 接收默认导出的变量, &#123; 接收基本导出的变量 &#125; <span class="keyword">from</span> <span class="string">&quot;模块路径&quot;</span>;</span><br></pre></td></tr></table></figure><p>注：如果使用*号，会将所有基本导出和默认导出聚合到一个对象中，默认导出会作为属性 default 存在</p><p>需要好好学习</p><h2 id="Ajax介绍及使用"><a href="#Ajax介绍及使用" class="headerlink" title="Ajax介绍及使用"></a>Ajax介绍及使用</h2><h4 id="什么是-Ajax"><a href="#什么是-Ajax" class="headerlink" title="什么是 Ajax"></a>什么是 Ajax</h4><p>Ajax 全称 Asynchronous JavaScript and XML，AJAX 是一种用于创建快速动态网页的技术。通过在后台与服务器进行少量数据交换，AJAX 可以使网页实现异步更新。这意味着可以在不重新加载整个网页的情况下，对网页的某部分进行更新。</p><p><img data-src="https://doc.shiyanlou.com/courses/3871/1621685/782b2a04710662f07d1e68bf0adc2ee3-0" alt="3-2" style="zoom:50%;" /></p><p>基于 Ajax 工作原理，使用 Ajax 最主要就是完成下列事项：</p><ul><li>在不重新加载页面的情况下发送请求给服务器。</li><li>接受并使用从服务器发来的数据。</li></ul><p>代码表示</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 创建 xmlHttpRequest 对象</span></span><br><span class="line"><span class="keyword">let</span> xmlhttp;</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">window</span>.XMLHttpRequest) &#123;</span><br><span class="line">  <span class="comment">//  IE7+, Firefox, Chrome, Opera, Safari 浏览器执行代码</span></span><br><span class="line">  xmlhttp = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="comment">// IE6, IE5 浏览器执行代码</span></span><br><span class="line">  xmlhttp = <span class="keyword">new</span> ActiveXObject(<span class="string">&quot;Microsoft.XMLHTTP&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 设置回调函数</span></span><br><span class="line">xmlHttp.onreadystatechange = callback;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 使用 open 方法与服务器建立连接</span></span><br><span class="line">xmlhttp.open(method, url, <span class="keyword">async</span>);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">method：请求的类型；GET 或 POST</span></span><br><span class="line"><span class="comment">url：文件在服务器上的位置</span></span><br><span class="line"><span class="comment">async：true（异步）或 false（同步）</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加请求头信息（可选）</span></span><br><span class="line">xmlhttp.setRequestHeader(header, value);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. 使用 send 方法发送请求</span></span><br><span class="line">xmlhttp.send(string);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">string：仅用于 POST 请求,格式可以为 multipart/form-data，JSON，XML</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p>当请求发送出去后，会得到一个响应结果，在回调函数中针对不同的响应状态进行处理。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">callback</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (xmlHttp.readyState == <span class="number">4</span>) &#123;</span><br><span class="line">    <span class="comment">//判断交互是否成功</span></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    readyState属性：表示请求/响应过程的当前阶段</span></span><br><span class="line"><span class="comment">    0：未初始化。尚未调用 open()方法。</span></span><br><span class="line"><span class="comment">    1：启动。已经调用 open()方法，但尚未调用 send()方法。</span></span><br><span class="line"><span class="comment">    2：发送。已经调用 send()方法，但尚未接收到响应。</span></span><br><span class="line"><span class="comment">    3：接收。已经接收到部分响应数据。</span></span><br><span class="line"><span class="comment">    4：完成。已经接收到全部响应数据，而且已经可以在客户端使用了。</span></span><br><span class="line"><span class="comment">    只有在XMLHttpRequest对象完成了以上5个步骤之后，才可以获取从服务器端返回的数据。</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">if</span> (xmlHttp.status == <span class="number">200</span>) &#123;</span><br><span class="line">      <span class="comment">/*</span></span><br><span class="line"><span class="comment">        status属性：响应的 HTTP 状态码,常见的状态码如下</span></span><br><span class="line"><span class="comment">        200：响应成功</span></span><br><span class="line"><span class="comment">        301：永久重定向/永久转移</span></span><br><span class="line"><span class="comment">        302：临时重定向/临时转移</span></span><br><span class="line"><span class="comment">        304：本次获取内容是读取缓存中的数据</span></span><br><span class="line"><span class="comment">        400：请求参数错误</span></span><br><span class="line"><span class="comment">        401：无权限访问</span></span><br><span class="line"><span class="comment">        404：访问的资源不存在</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">      <span class="comment">//服务器的响应，可使用 XMLHttpRequest 对象的 responseText（获得字符串形式的响应数据） 或</span></span><br><span class="line">      <span class="comment">// responseXML (获得 XML 形式的响应数据) 属性获得</span></span><br><span class="line">      <span class="keyword">let</span> responseText = xmlHttp.responseText;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// 失败，根据响应码判断失败原因</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>针对响应成功和响应失败，除了对状态码进行判断外，XMLHttpRequest 提供了响应成功和失败的 api 使用</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//将请求时候步骤2改为以下代码</span></span><br><span class="line">xmlHttp.onload = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line"><span class="comment">//等效于</span></span><br><span class="line">xmlHttp.onreadystatechange = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (xmlHttp.readyState == <span class="number">4</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (xmlHttp.status == <span class="number">200</span>) &#123;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//将请求时候步骤2改为以下代码</span></span><br><span class="line">xmlHttp.onerror = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line"><span class="comment">//等效于</span></span><br><span class="line">xmlHttp.onreadystatechange = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (xmlHttp.readyState == <span class="number">4</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (xmlHttp.status !== <span class="number">200</span>) &#123;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="Promise异步处理"><a href="#Promise异步处理" class="headerlink" title="Promise异步处理"></a>Promise异步处理</h2><h4 id="事件循环"><a href="#事件循环" class="headerlink" title="事件循环"></a>事件循环</h4><p>JavaScript 有一个基于<strong>事件循环</strong>的并发模型，事件循环负责执行代码、收集和处理事件以及执行队列中的子任务。对于事件循环的理解，首先需要明确的三个概念：栈（Stack），堆（Heap），和事件队列（Queue）。</p><p><strong>栈</strong>（执行栈）：每个函数调用形成了一个由若干帧组成的栈。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params">b</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> a = <span class="number">10</span>;</span><br><span class="line">  <span class="keyword">return</span> a + b + <span class="number">11</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bar</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> y = <span class="number">3</span>;</span><br><span class="line">  <span class="keyword">return</span> foo(x * y);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(bar(<span class="number">7</span>)); <span class="comment">//</span></span><br></pre></td></tr></table></figure><p>当调用 <code>bar</code> 时，第一个帧被创建并压入栈中，帧中包含了 <code>bar</code> 的参数和局部变量。 当 <code>bar</code> 调用 <code>foo</code> 时，第二个帧被创建并被压入栈中，放在第一个帧之上，帧中包含 <code>foo</code> 的参数和局部变量。当 <code>foo</code> 执行完毕然后返回时，第二个帧就被弹出栈（剩下 <code>bar</code> 函数的调用帧 ）。当 <code>bar</code> 也执行完毕然后返回时，第一个帧也被弹出，栈就被清空了</p><p><strong>堆</strong>：对象被分配在堆中，堆是一个用来表示一大块（通常是非结构化的）内存区域的计算机术语。</p><p><strong>队列</strong>：一个 JavaScript 运行时包含了一个待处理消息的消息队列。每一个消息都关联着一个用以处理这个消息的回调函数。</p><p>在浏览器中，队列分为两种：</p><ul><li>宏任务（队列）：macroTask，计时器结束的回调、事件回调、http 回调等等绝大部分异步函数进入宏队列</li><li>微任务（队列）：MutationObserver，Promise 产生的回调进入微队列</li></ul><blockquote><p>MutationObserver 用于监听某个 DOM 对象的变化</p></blockquote><p>当执行栈清空时，JS 引擎首先会将微任务中的所有任务依次执行结束，如果没有微任务，则执行宏任务。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;这是开始&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn1</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;这是一条消息2&quot;</span>);</span><br><span class="line">  fn2();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn2</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;这是一条消息3&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function"><span class="keyword">function</span> <span class="title">cb1</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;这是来自第一个回调的消息&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;这是一条消息1&quot;</span>);</span><br><span class="line">fn1();</span><br><span class="line"></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function"><span class="keyword">function</span> <span class="title">cb2</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;这是来自第二个回调的消息&quot;</span>);</span><br><span class="line">&#125;, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;这是结束&quot;</span>);</span><br></pre></td></tr></table></figure><p>上面程序执行顺序如下：</p><p><img data-src="https://doc.shiyanlou.com/courses/3871/1621685/387ac59fb47627723469e6b8f276ece8-0" alt="04-7"></p><p>输出的结果：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//这是开始</span></span><br><span class="line"><span class="comment">//这是一条消息1</span></span><br><span class="line"><span class="comment">//这是一条消息2</span></span><br><span class="line"><span class="comment">//这是一条消息3</span></span><br><span class="line"><span class="comment">//这是结束</span></span><br><span class="line"><span class="comment">//这是来自第一个回调的消息</span></span><br><span class="line"><span class="comment">//这是来自第二个回调的消息</span></span><br></pre></td></tr></table></figure><h4 id="Promise-异步处理"><a href="#Promise-异步处理" class="headerlink" title="Promise 异步处理"></a>Promise 异步处理</h4><p>Promise 提供了一套异步处理的通用模型，理解该 API，最重要的，是理解它的异步模型。</p><ol><li>ES6 将某一件可能发生异步操作的事情，分为两个阶段：<strong>unsettled</strong> 和 <strong>settled</strong></li></ol><p><img data-src="https://doc.shiyanlou.com/courses/3871/1621685/6bf4c245659daad31a5f3b57d348e880-0" alt="04-8"></p><ul><li>unsettled： 未决阶段，表示事情还在进行前期的处理，并没有发生通向结果的那件事</li><li>settled：已决阶段，事情已经有了一个结果，不管这个结果是好是坏，整件事情无法逆转</li></ul><p>事情总是从 未决阶段 逐步发展到 已决阶段的。并且，未决阶段拥有控制何时通向已决阶段的能力。</p><ol><li>ES6 将事情划分为三种状态： pending、resolved、rejected</li></ol><ul><li>pending: 挂起，处于未决阶段，则表示这件事情还在挂起（最终的结果还没出来）</li><li>resolved：已处理，已决阶段的一种状态，表示整件事情已经出现结果，并是一个可以按照正常逻辑进行下去的结果</li><li>rejected：已拒绝，已决阶段的一种状态，表示整件事情已经出现结果，并是一个无法按照正常逻辑进行下去的结果，通常用于表示有一个错误</li></ul><p>既然未决阶段有权力决定事情的走向，因此，未决阶段可以决定事情最终的状态！ 我们将 把事情变为 resolved 状态的过程叫做：<strong>resolve</strong>，推向该状态时，可能会传递一些数据 我们将 把事情变为 rejected 状态的过程叫做：<strong>reject</strong>，推向该状态时，同样可能会传递一些数据，通常为错误信息</p><p><strong>始终记住，无论是阶段，还是状态，是不可逆的！</strong></p><p><img data-src="https://doc.shiyanlou.com/courses/3871/1621685/602c59f144986e0701383e1df04baed8-0" alt="04-9"></p><ol><li>当事情达到已决阶段后，通常需要进行后续处理，不同的已决状态，决定了不同的后续处理。</li></ol><ul><li>resolved 状态：这是一个正常的已决状态，后续处理表示为 thenable</li><li>rejected 状态：这是一个非正常的已决状态，后续处理表示为 catchable</li></ul><p>后续处理可能有多个，因此会形成作业队列，这些后续处理会按照顺序，当状态到达后依次执行</p><p><img data-src="https://doc.shiyanlou.com/courses/3871/1621685/1799a7a752ca136a48b60cae42f5ab3d-0" alt="04-10"></p><ol><li>整件事称之为 Promise</li></ol><p><img data-src="https://doc.shiyanlou.com/courses/3871/1621685/5b7d9109d938ea4de96db414c606ba97-0" alt="04-11"></p><p>Promise 的基本使用</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> pro = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 未决阶段的处理</span></span><br><span class="line">  <span class="comment">// 通过调用resolve函数将Promise推向已决阶段的resolved状态</span></span><br><span class="line">  <span class="comment">// 通过调用reject函数将Promise推向已决阶段的rejected状态</span></span><br><span class="line">  <span class="comment">// resolve和reject均可以传递最多一个参数，表示推向状态的数据</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">pro.then(</span><br><span class="line">  <span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//这是thenable函数，如果当前的Promise已经是resolved状态，该函数会立即执行</span></span><br><span class="line">    <span class="comment">//如果当前是未决阶段，则会加入到作业队列，等待到达resolved状态后执行</span></span><br><span class="line">    <span class="comment">//data为状态数据</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//这是catchable函数，如果当前的Promise已经是rejected状态，该函数会立即执行</span></span><br><span class="line">    <span class="comment">//如果当前是未决阶段，则会加入到作业队列，等待到达rejected状态后执行</span></span><br><span class="line">    <span class="comment">//err为状态数据</span></span><br><span class="line">  &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p><strong>细节</strong></p><ol><li>未决阶段的处理函数是同步的，会立即执行</li><li>thenable 和 catchable 函数是异步的，就算是立即执行，也会加入到事件队列中等待执行，并且，加入的队列是微队列</li><li>pro.then 可以只添加 thenable 函数，pro.catch 可以单独添加 catchable 函数</li><li>在未决阶段的处理函数中，如果发生未捕获的错误，会将状态推向 rejected，并会被 catchable 捕获</li><li>一旦状态推向了已决阶段，无法再对状态做任何更改</li><li><strong>Promise 并没有消除回调，只是让回调变得可控</strong></li></ol><p>举例说明</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 题目一</span></span><br><span class="line"><span class="keyword">const</span> promise1 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;promise1&quot;</span>);</span><br><span class="line">  resolve(<span class="string">&quot;resolve1&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">const</span> promise2 = promise1.then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(res);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;1&quot;</span>, promise1);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;2&quot;</span>, promise2);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">&#x27;promise1&#x27;</span></span><br><span class="line"><span class="comment">&#x27;1&#x27; Promise&#123;&lt;resolved&gt;: &#x27;resolve1&#x27;&#125;</span></span><br><span class="line"><span class="comment">&#x27;2&#x27; Promise&#123;&lt;pending&gt;&#125;</span></span><br><span class="line"><span class="comment">&#x27;resolve1&#x27;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 题目二</span></span><br><span class="line"><span class="keyword">const</span> promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">1</span>);</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;timerStart&quot;</span>);</span><br><span class="line">    resolve(<span class="string">&quot;success&quot;</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;timerEnd&quot;</span>);</span><br><span class="line">  &#125;, <span class="number">0</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">2</span>);</span><br><span class="line">&#125;);</span><br><span class="line">promise.then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(res);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="number">4</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">1</span></span><br><span class="line"><span class="comment">2</span></span><br><span class="line"><span class="comment">4</span></span><br><span class="line"><span class="comment">&quot;timerStart&quot;</span></span><br><span class="line"><span class="comment">&quot;timerEnd&quot;</span></span><br><span class="line"><span class="comment">&quot;success&quot;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//题目三</span></span><br><span class="line"><span class="built_in">Promise</span>.resolve().then(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;promise1&quot;</span>);</span><br><span class="line">  <span class="keyword">const</span> timer2 = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;timer2&quot;</span>);</span><br><span class="line">  &#125;, <span class="number">0</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">const</span> timer1 = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;timer1&quot;</span>);</span><br><span class="line">  <span class="built_in">Promise</span>.resolve().then(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;promise2&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;, <span class="number">0</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;start&quot;</span>);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">&#x27;start&#x27;</span></span><br><span class="line"><span class="comment">&#x27;promise1&#x27;</span></span><br><span class="line"><span class="comment">&#x27;timer1&#x27;</span></span><br><span class="line"><span class="comment">&#x27;promise2&#x27;</span></span><br><span class="line"><span class="comment">&#x27;timer2&#x27;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p>为了简化 Promise api 的使用，ES2016 中新增了 async 和 await 两个关键字，下面我们来看下其简写方式又是怎么替代 Promise api 的。</p><h4 id="async-和-await"><a href="#async-和-await" class="headerlink" title="async 和 await"></a>async 和 await</h4><p><strong>async</strong>：目的是简化在函数的返回值中对 Promise 的创建，用于修饰函数（无论是函数字面量还是函数表达式），放置在函数最开始的位置，被修饰函数的返回结果一定是 Promise 对象。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">1</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//等效于</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">1</span>);</span><br><span class="line">    resolve(<span class="number">2</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>await</strong>：await 关键字必须出现在 async 函数中，用在某个表达式之前，如果表达式是一个 Promise，则得到的是 thenable 中的状态数据。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">test1</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">1</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">test2</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> result = <span class="keyword">await</span> test1();</span><br><span class="line">  <span class="built_in">console</span>.log(result);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">test2();</span><br></pre></td></tr></table></figure><p>等效于</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test1</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">1</span>);</span><br><span class="line">    resolve(<span class="number">2</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test2</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    test1().then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> result = data;</span><br><span class="line">      <span class="built_in">console</span>.log(result);</span><br><span class="line">      resolve();</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">test2();</span><br></pre></td></tr></table></figure><p>如果 await 的表达式不是 Promise，则会将其使用 Promise.resolve 包装后按照规则运行。</p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      
        <tags>
            
            <tag> javascript </tag>
            
            <tag> music player </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>pytorch学习</title>
      <link href="2022/04/15/pytorch%E5%AD%A6%E4%B9%A0/"/>
      <url>2022/04/15/pytorch%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>之前用了tensorflow的keras api,比较简单快捷.单光那样肯定是不行的<br><span id="more"></span></p><p><a href="https://pytorch.org/"><em>PyTorch</em></a> 是 Facebook 主导开发的，基于 Python 的科学计算包</p><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>直接在官网按教程即可.一般都需要gpu版的,所以需要cuda(当然也需要英伟达的gpu了).</p><p>知道cuda版本后对应安装即可.conda和pip无所谓.</p><p>cuDNN是一个SDK，是一个专门用于神经网络的加速包，注意，它跟我们的CUDA没有一一对应的关系，即每一个版本的CUDA可能有好几个版本的cuDNN与之对应，但一般有一个最新版本的cuDNN版本与CUDA对应更好。</p><h4 id="检验"><a href="#检验" class="headerlink" title="检验"></a>检验</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(torch.cuda.is_available())</span><br><span class="line"><span class="built_in">print</span>(torch.__version__)</span><br></pre></td></tr></table></figure><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">True</span><br><span class="line">1.11.0+cu113</span><br></pre></td></tr></table></figure><p>我cuda版本是11.6,pytorch版本1.110.安装的gpu版本对应cuda11.3</p><h3 id="张量"><a href="#张量" class="headerlink" title="张量"></a>张量</h3><p>tensors与numpy中的数组类似,差别是其可以用gpu计算</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"></span><br><span class="line">torch.empty(<span class="number">5</span>, <span class="number">3</span>)</span><br></pre></td></tr></table></figure><p>使用 <a href="https://pytorch.org/docs/stable/torch.html?highlight=torch empty#torch.empty"><code>torch.empty</code></a> 可以返回填充了未初始化数据的张量。张量的形状由可变参数大小定义。</p><p>创建随机初始化矩阵 </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">torch.rand(<span class="number">5</span>,<span class="number">3</span>)  <span class="comment">#均匀分布</span></span><br><span class="line">torch.zeros(<span class="number">5</span>, <span class="number">3</span>, dtype=torch.long) <span class="comment">#0填充矩阵 类型long </span></span><br><span class="line">x = torch.tensor([<span class="number">5.5</span>, <span class="number">3</span>]) <span class="comment">#创建一个tensor</span></span><br></pre></td></tr></table></figure><p>根据现有张量创建新张量。这些方法将重用输入张量的属性，除非设置新的值进行覆盖</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">x = x.new_ones(<span class="number">5</span>, <span class="number">3</span>, dtype=torch.double)</span><br></pre></td></tr></table></figure><p>覆盖 <code>dtype</code>，对象的 <code>size</code> 是相同的，只是值和类型发生了变化</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">x = torch.randn_like(x, dtype=torch.<span class="built_in">float</span>)</span><br></pre></td></tr></table></figure><p>获取张量size</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">x.size()</span><br></pre></td></tr></table></figure><h3 id="针对张量的操作"><a href="#针对张量的操作" class="headerlink" title="针对张量的操作"></a>针对张量的操作</h3><p>加法运算</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">y = torch.rand(<span class="number">5</span>, <span class="number">3</span>)</span><br><span class="line">torch.add(x, y)</span><br></pre></td></tr></table></figure><p>提供输出 Tensor 作为参数</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">result = torch.empty(<span class="number">5</span>, <span class="number">3</span>)</span><br><span class="line">torch.add(x, y, out=result)</span><br><span class="line">y.add_(x)  <span class="comment"># 将 x 加到 y</span></span><br></pre></td></tr></table></figure><p>任何以下划线结尾的操作都会用结果替换原变量</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">x[:, <span class="number">1</span>]</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">x = torch.randn(<span class="number">4</span>, <span class="number">4</span>)</span><br><span class="line">y = x.view(<span class="number">16</span>)</span><br><span class="line">z = x.view(-<span class="number">1</span>, <span class="number">8</span>)  <span class="comment"># size -1 从其他维度推断</span></span><br></pre></td></tr></table></figure><p>如果张量只有一个元素，使用 <code>.item()</code> 来得到 Python 数据类型的数值</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">x = torch.randn(<span class="number">1</span>)</span><br><span class="line"><span class="built_in">print</span>(x.item())</span><br></pre></td></tr></table></figure><h3 id="与numpy转换"><a href="#与numpy转换" class="headerlink" title="与numpy转换"></a>与numpy转换</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">b = a.numpy()</span><br></pre></td></tr></table></figure><p>NumPy 数组转换成 PyTorch 张量时，可以使用 <code>from_numpy</code> 完成</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">a = np.ones(<span class="number">5</span>)</span><br><span class="line">b = torch.from_numpy(a)</span><br><span class="line">np.add(a, <span class="number">1</span>, out=a)</span><br></pre></td></tr></table></figure><p>所有的 Tensor 类型默认都是基于 CPU</p><h4 id="gpu"><a href="#gpu" class="headerlink" title="gpu"></a>gpu</h4><p>CUDA 张量是能够在 GPU 设备中运算的张量。使用 <code>.to</code> 方法可以将 Tensor 移动到 GPU 设备中</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># is_available 函数判断是否有 GPU 可以使用</span></span><br><span class="line"><span class="keyword">if</span> torch.cuda.is_available():</span><br><span class="line">    device = torch.device(<span class="string">&quot;cuda&quot;</span>)          <span class="comment"># torch.device 将张量移动到指定的设备中</span></span><br><span class="line">    y = torch.ones_like(x, device=device)  <span class="comment"># 直接从 GPU 创建张量</span></span><br><span class="line">    x = x.to(device)                       <span class="comment"># 或者直接使用 .to(&quot;cuda&quot;) 将张量移动到 cuda 中</span></span><br><span class="line">    z = x + y</span><br><span class="line">    <span class="built_in">print</span>(z)</span><br><span class="line">    <span class="built_in">print</span>(z.to(<span class="string">&quot;cpu&quot;</span>, torch.double))  </span><br></pre></td></tr></table></figure><h3 id="autograd"><a href="#autograd" class="headerlink" title="autograd"></a>autograd</h3><blockquote><p><a href="https://pytorch.org/docs/stable/autograd.html?highlight=autograd#module-torch.autograd"><code>autograd</code></a>为张量上的所有操作提供了自动求导。它是一个在运行时定义的框架，这意味着反向传播是根据你的代码来确定如何运行。<code>torch.Tensor</code> 是这个包的核心类。如果设置 <code>.requires_grad</code> 为 <code>True</code>，那么将会追踪所有对于该张量的操作。当完成计算后通过调用 <code>.backward()</code> 会自动计算所有的梯度，这个张量的所有梯度将会自动积累到 <code>.grad</code> 属性。这也就完成了自动求导的过程</p></blockquote><p>要阻止张量跟踪历史记录，可以调用 <code>.detach()</code> 方法将其与计算历史记录分离。为了防止跟踪历史记录（和使用内存），可以将代码块包装在 <code>with torch.no_grad():</code> 语句中。这一点在评估模型时特别有用，因为模型可能具有 <code>requires_grad=True</code> 的可训练参数，但是我们并不需要计算梯度.</p><p>自动求导中还有另外一个重要的类 <code>Function</code>。<code>Tensor</code> 和 <code>Function</code> 互相连接并生成一个非循环图，其存储了完整的计算历史。</p><p>如果需要计算导数，你可以在 <code>Tensor</code> 上调用 <code>.backward()</code>。 如果 <code>Tensor</code> 是一个标量（即它包含一个元素数据）则不需要为 <code>backward()</code> 指定任何参数。但是，如果它有多个元素，你需要指定一个 <code>gradient</code> 参数来匹配张量的形状。</p><p>.requires<em>grad</em>( … )<code>可以改变现有张量的</code>requires_grad<code>属性。 如果没有指定的话，默认输入的 flag 是</code>False.</p><p><strong>注意</strong>:将某个变量设置为requires_grad=True后,意味着后面涉及到这个变量计算产生的变量其grad_fn存在。x.grad_fn只有产生这个变量x的变量中有requires_grad且x不是末端情况下存在</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">f1 = torch.randn(<span class="number">1</span>,requires_grad=<span class="literal">True</span>)</span><br><span class="line">f1 = <span class="number">2</span>*f1</span><br><span class="line">f2 = y+z</span><br><span class="line"><span class="comment"># 查看变量是否存在求梯度函数</span></span><br><span class="line"><span class="built_in">print</span>(f1.grad_fn)</span><br></pre></td></tr></table></figure><p>结果为MulBackward0 object</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">f1.backward(retain_graph=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><p>计算梯度.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">a = torch.randn(<span class="number">2</span>, <span class="number">2</span>)</span><br><span class="line">a = ((a * <span class="number">3</span>) / (a - <span class="number">1</span>))</span><br><span class="line"><span class="built_in">print</span>(a.requires_grad)</span><br><span class="line">a.requires_grad_(<span class="literal">True</span>)</span><br><span class="line"><span class="built_in">print</span>(a.requires_grad)</span><br><span class="line">b = (a * a).<span class="built_in">sum</span>()</span><br><span class="line"><span class="built_in">print</span>(b.grad_fn)</span><br></pre></td></tr></table></figure><p>如果使用函数 <code>k.backward(p)</code> 则得到的的变量 <code>x.grad</code> 的值为：</p><script type="math/tex; mode=display">x.grad=p\cdot \frac{dk}{dx}</script><p>完成了梯度的自动追踪后，下面通过反向传播打印对应节点的梯度。因为 <code>out</code> 是一个纯量 Scalar，<code>out.backward()</code> 等于 <code>out.backward(torch.tensor(1))</code></p><p>总结一下,x.grad_fn就是看有没有梯度函数.</p><p>x.backward()计算梯度,x.grad显示值.</p><p>可以使用 <a href="https://pytorch.org/docs/stable/nn.html?highlight=torch nn#module-torch.nn"><code>torch.nn</code></a>来构建神经网络</p><p>它是一个简单的前馈神经网络，它接受一个输入，然后一层接着一层地传递，最后输出计算的结果。</p><p>神经网络的典型训练过程如下：</p><ol><li><p>定义包含可学习参数（权重）的神经网络模型。</p></li><li><p>在数据集上迭代。</p></li><li><p>通过神经网络处理输入。</p></li><li><p>计算损失（输出结果和正确值的差值大小）。</p></li><li><p>将梯度反向传播回网络节点。</p></li><li><p>更新网络的参数，一般可使用梯度下降等最优化方法。</p><p>停止张量梯队计算</p></li></ol><p>如果我们不需要某些张量的梯度计算，我们就可以使用下面三种方法告诉计算机停止梯度的计算：</p><ul><li><code>x.requires_grad_(False)</code>。</li><li><code>x.detach()</code>。</li><li><code>with torch.no_grad():</code></li></ul><p>为了避免多次求导后梯度累加情况，一般我们在计算完梯度后，都会清空梯度，即清空 <code>x.grad</code> 。在清空梯度后，我们再进行其他张量的梯度求解</p><p>使用 <code>x.grad.zero_()</code> 清空梯度</p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      
        <tags>
            
            <tag> deep learning </tag>
            
            <tag> pytorch </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>flex_bison学习</title>
      <link href="2022/04/12/flex-bison%E5%AD%A6%E4%B9%A0/"/>
      <url>2022/04/12/flex-bison%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>利用flex,bison实现词法和语法分析,利用llvm实现代码优化和代码生成.</p><p>这里介绍一下lex和yacc(unix环境下).</p><p>linux环境下是flex和bison.(当然lex和flex,yacc和bison还是有差别的)</p><span id="more"></span><h2 id="lex"><a href="#lex" class="headerlink" title="lex"></a>lex</h2><p>用lex源语言编写的程序,扩展名为.l的文件.经lex系统处理后输出c程序文件.该文件包含依据正规式构建的状态转移表,用来驱动该状态表的总控程序yylex().</p><p>文件格式</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">定义部分</span><br><span class="line"><span class="comment">%%</span></span><br><span class="line">识别规则部分</span><br><span class="line"><span class="comment">%%</span></span><br><span class="line">辅助函数部分</span><br></pre></td></tr></table></figure><p>第二个%%可以省略(即辅助函数部分没有的情况下)</p><p>一个例子</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">%&#123;</span></span><br><span class="line"><span class="params">#</span>include &lt;stdio.h&gt;</span><br><span class="line">int num<span class="built_in">_</span>lines = 0,num<span class="built_in">_</span>chars = 0;</span><br><span class="line"><span class="comment">%&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">%%</span></span><br><span class="line"><span class="keyword">\n</span> &#123;num<span class="built_in">_</span>lines++;num<span class="built_in">_</span>chars++;&#125;</span><br><span class="line">. &#123;++num<span class="built_in">_</span>chars;&#125; //除空白字符</span><br><span class="line"><span class="comment">%%</span></span><br><span class="line">int main(void)</span><br><span class="line">&#123;</span><br><span class="line">    yylex();</span><br><span class="line">    printf(&quot;num of lines =<span class="comment">%d,num of chars=%d\n&quot;,num_lines,num_chars);</span></span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>定义部分对规则部分要引用的文件和变量进行说明.可包含头文件,常数定义,全局变量定义,外部变量定义以及正规式定义.</p><p>识别规则部分 </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">P &#123;/\*<span class="keyword">do</span> something*/&#125;</span><br></pre></td></tr></table></figure><p>辅助函数部分</p><div class="table-container"><table><thead><tr><th>变量和函数</th><th>介绍</th></tr></thead><tbody><tr><td>yyin</td><td>FILE*类型 指向输入文件</td></tr><tr><td>yyout</td><td>指向输出文件</td></tr><tr><td>yytext</td><td>char* 指向识别规则中的一个正规式匹配的单词的首字符</td></tr><tr><td>yylex()</td><td>从该函数分析</td></tr><tr><td>yyleng</td><td>int类型 记录与识别规则中正规式匹配的单词的首字符长度</td></tr><tr><td>yywrap()</td><td>文件结束处理函数 若返回值1就停止解析  可用来解析多个文件</td></tr><tr><td>echo</td><td>将yytext打印到yyout</td></tr></tbody></table></div><p>正规式就不多介绍了</p><h2 id="yacc"><a href="#yacc" class="headerlink" title="yacc"></a>yacc</h2><p>基于LALR(1)语法分析,可以输出两个文件,一个是包含语法分析函数yyparse()的c程序,另一个是包含原文件中所有终结符编码的宏定义文件,扩展名.h.</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">%&#123;</span></span><br><span class="line"><span class="params">#</span>include &lt;stdio.h&gt;</span><br><span class="line">void yyerror(const char* msg) &#123;&#125;</span><br><span class="line"><span class="comment">%&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">%token T_NUM</span></span><br><span class="line"></span><br><span class="line"><span class="comment">%left &#x27;+&#x27; &#x27;-&#x27;</span></span><br><span class="line"><span class="comment">%left &#x27;*&#x27; &#x27;/&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">%%</span></span><br><span class="line"></span><br><span class="line">S   :   S E &#x27;<span class="keyword">\n</span>&#x27;        &#123; printf(&quot;ans = <span class="comment">%d\n&quot;, $2); &#125;</span></span><br><span class="line">    |   /* empty */     &#123; /* empty */ &#125;</span><br><span class="line">    ;</span><br><span class="line"></span><br><span class="line">E   :   E &#x27;+&#x27; E         &#123; <span class="built_in">$</span><span class="built_in">$</span> = <span class="built_in">$</span>1 + <span class="built_in">$</span>3; &#125;</span><br><span class="line">    |   E &#x27;-&#x27; E         &#123; <span class="built_in">$</span><span class="built_in">$</span> = <span class="built_in">$</span>1 - <span class="built_in">$</span>3; &#125;</span><br><span class="line">    |   E &#x27;*&#x27; E         &#123; <span class="built_in">$</span><span class="built_in">$</span> = <span class="built_in">$</span>1 * <span class="built_in">$</span>3; &#125;</span><br><span class="line">    |   E &#x27;/&#x27; E         &#123; <span class="built_in">$</span><span class="built_in">$</span> = <span class="built_in">$</span>1 / <span class="built_in">$</span>3; &#125;</span><br><span class="line">    |   T<span class="built_in">_</span>NUM           &#123; <span class="built_in">$</span><span class="built_in">$</span> = <span class="built_in">$</span>1; &#125;</span><br><span class="line">    |   &#x27;(&#x27; E &#x27;)&#x27;       &#123; <span class="built_in">$</span><span class="built_in">$</span> = <span class="built_in">$</span>2; &#125;</span><br><span class="line">    ;</span><br><span class="line"></span><br><span class="line"><span class="comment">%%</span></span><br><span class="line"></span><br><span class="line">int main() &#123;</span><br><span class="line">    return yyparse();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>生成的头文件</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> YY_YY_CAL2_TAB_H_INCLUDED</span></span><br><span class="line"><span class="meta"># <span class="meta-keyword">define</span> YY_YY_CAL2_TAB_H_INCLUDED</span></span><br><span class="line"><span class="comment">/* Debug traces.  */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> YYDEBUG</span></span><br><span class="line"><span class="meta"># <span class="meta-keyword">define</span> YYDEBUG 0</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> YYDEBUG</span></span><br><span class="line"><span class="keyword">extern</span> <span class="keyword">int</span> yydebug;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Token type.  */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> YYTOKENTYPE</span></span><br><span class="line"><span class="meta"># <span class="meta-keyword">define</span> YYTOKENTYPE</span></span><br><span class="line">  <span class="class"><span class="keyword">enum</span> <span class="title">yytokentype</span></span></span><br><span class="line"><span class="class">  &#123;</span></span><br><span class="line">    NUMBER = <span class="number">258</span>,</span><br><span class="line">    ADD = <span class="number">259</span>,</span><br><span class="line">    SUB = <span class="number">260</span>,</span><br><span class="line">    MUL = <span class="number">261</span>,</span><br><span class="line">    DIV = <span class="number">262</span>,</span><br><span class="line">    ABS = <span class="number">263</span>,</span><br><span class="line">    EOL = <span class="number">264</span></span><br><span class="line">  &#125;;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Value type.  */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> ! defined YYSTYPE &amp;&amp; ! defined YYSTYPE_IS_DECLARED</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">int</span> YYSTYPE;</span><br><span class="line"><span class="meta"># <span class="meta-keyword">define</span> YYSTYPE_IS_TRIVIAL 1</span></span><br><span class="line"><span class="meta"># <span class="meta-keyword">define</span> YYSTYPE_IS_DECLARED 1</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> YYSTYPE yylval;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">yyparse</span> <span class="params">(<span class="keyword">void</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* !YY_YY_CAL2_TAB_H_INCLUDED  */</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>可以直接引入到.l文件中</p><p>文件格式</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[说明部分]</span><br><span class="line"><span class="comment">%%</span></span><br><span class="line">翻译规则</span><br><span class="line">[<span class="comment">%%</span></span><br><span class="line">辅助过程]</span><br></pre></td></tr></table></figure><p>说明部分包括两部分,一部分是处于<code>%&#123;%&#125;</code>之间的c语言代码,定义全局变量和相关文件.</p><p>第二部分是文法记号声明,该部分每一项均以%开头.</p><p>语义值类型定义</p><p>语法分析器除了包含用来保存文法符号和状态的分析栈之外,还有一个用来保存与分析栈中文法符号相对应的语义值的语义栈.即YYSTYPE,抽象数据类型,缺省为int</p><p>用户定义YYSTYPE</p><p>若为简单类型</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">%&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> YYSTYPE float</span></span><br><span class="line">%&#125;</span><br></pre></td></tr></table></figure><p>若为复杂类型,使用共用体.</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">%union</span><br><span class="line">&#123;</span><br><span class="line">SYMBOL *sym;</span><br><span class="line">ENODE *<span class="keyword">NODE</span></span><br><span class="line"><span class="title">&#125;</span></span><br></pre></td></tr></table></figure><p>引用时</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">%token &lt;sym&gt; id</span><br><span class="line">%type &lt;node&gt; expr</span><br></pre></td></tr></table></figure><p>%token表示终结符</p><p>%type表示非终结符</p><p>文法开始符定义</p><p>一般以%start S表明S是文法的开始符号.默认为规则部分中出现的第一个产生式的左部非终极符号.</p><p>优先性与结合性</p><p>%left 左结合</p><p>%nonassoc 无结合性</p><p>结合性说明排列的次序决定运算符的优先级,在后写的优先级越高</p><p>翻译规则</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">A: a1 &#123;语义动作&#125;</span><br><span class="line">|a2 &#123;&#125;</span><br><span class="line">;</span><br></pre></td></tr></table></figure><p>$$表示与产生式做不非终结符号相关的属性值.</p><p>$i 表示与产生式右部第i个文法符号相关的属性值. 在每个$i算出来之后再进行归约.</p><p>辅助过程</p><p>包含主程序,词法分析程序yylex,yyerror.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br></pre></td><td class="code"><pre><span class="line">YY_DECL</span><br><span class="line">&#123;</span><br><span class="line">yy_state_type yy_current_state;</span><br><span class="line"><span class="keyword">char</span> *yy_cp, *yy_bp;</span><br><span class="line"><span class="keyword">int</span> yy_act;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">if</span> ( !(yy_init) )</span><br><span class="line">&#123;</span><br><span class="line">(yy_init) = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> YY_USER_INIT</span></span><br><span class="line">YY_USER_INIT;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ( ! (yy_start) )</span><br><span class="line">(yy_start) = <span class="number">1</span>;<span class="comment">/* first start state */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ( ! yyin )</span><br><span class="line">yyin = <span class="built_in">stdin</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ( ! yyout )</span><br><span class="line">yyout = <span class="built_in">stdout</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ( ! YY_CURRENT_BUFFER ) &#123;</span><br><span class="line">yyensure_buffer_stack ();</span><br><span class="line">YY_CURRENT_BUFFER_LVALUE =</span><br><span class="line">yy_create_buffer( yyin, YY_BUF_SIZE );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">yy_load_buffer_state(  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">line</span> 15 <span class="meta-string">&quot;cal2.l&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">line</span> 681 <span class="meta-string">&quot;lex.yy.c&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> ( <span class="comment">/*CONSTCOND*/</span><span class="number">1</span> )<span class="comment">/* loops until end-of-file is reached */</span></span><br><span class="line">&#123;</span><br><span class="line">yy_cp = (yy_c_buf_p);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Support of yytext. */</span></span><br><span class="line">*yy_cp = (yy_hold_char);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* yy_bp points to the position in yy_ch_buf of the start of</span></span><br><span class="line"><span class="comment"> * the current run.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">yy_bp = yy_cp;</span><br><span class="line"></span><br><span class="line">yy_current_state = (yy_start);</span><br><span class="line">yy_match:</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">&#123;</span><br><span class="line">YY_CHAR yy_c = yy_ec[YY_SC_TO_UI(*yy_cp)] ;</span><br><span class="line"><span class="keyword">if</span> ( yy_accept[yy_current_state] )</span><br><span class="line">&#123;</span><br><span class="line">(yy_last_accepting_state) = yy_current_state;</span><br><span class="line">(yy_last_accepting_cpos) = yy_cp;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">while</span> ( yy_chk[yy_base[yy_current_state] + yy_c] != yy_current_state )</span><br><span class="line">&#123;</span><br><span class="line">yy_current_state = (<span class="keyword">int</span>) yy_def[yy_current_state];</span><br><span class="line"><span class="keyword">if</span> ( yy_current_state &gt;= <span class="number">15</span> )</span><br><span class="line">yy_c = yy_meta[yy_c];</span><br><span class="line">&#125;</span><br><span class="line">yy_current_state = yy_nxt[yy_base[yy_current_state] + yy_c];</span><br><span class="line">++yy_cp;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">while</span> ( yy_base[yy_current_state] != <span class="number">13</span> );</span><br><span class="line"></span><br><span class="line">yy_find_action:</span><br><span class="line">yy_act = yy_accept[yy_current_state];</span><br><span class="line"><span class="keyword">if</span> ( yy_act == <span class="number">0</span> )</span><br><span class="line">&#123; <span class="comment">/* have to back up */</span></span><br><span class="line">yy_cp = (yy_last_accepting_cpos);</span><br><span class="line">yy_current_state = (yy_last_accepting_state);</span><br><span class="line">yy_act = yy_accept[yy_current_state];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">YY_DO_BEFORE_ACTION;</span><br><span class="line"></span><br><span class="line">do_action:<span class="comment">/* This label is used only to access EOF actions. */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">switch</span> ( yy_act )</span><br><span class="line">&#123; <span class="comment">/* beginning of action switch */</span></span><br><span class="line"><span class="keyword">case</span> <span class="number">0</span>: <span class="comment">/* must back up */</span></span><br><span class="line"><span class="comment">/* undo the effects of YY_DO_BEFORE_ACTION */</span></span><br><span class="line">*yy_cp = (yy_hold_char);</span><br><span class="line">yy_cp = (yy_last_accepting_cpos);</span><br><span class="line">yy_current_state = (yy_last_accepting_state);</span><br><span class="line"><span class="keyword">goto</span> yy_find_action;</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">YY_RULE_SETUP</span><br><span class="line"><span class="meta">#<span class="meta-keyword">line</span> 16 <span class="meta-string">&quot;cal2.l&quot;</span></span></span><br><span class="line">&#123;<span class="keyword">return</span> ADD; &#125;</span><br><span class="line">YY_BREAK</span><br><span class="line"><span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">YY_RULE_SETUP</span><br><span class="line"><span class="meta">#<span class="meta-keyword">line</span> 17 <span class="meta-string">&quot;cal2.l&quot;</span></span></span><br><span class="line">&#123;<span class="keyword">return</span> SUB; &#125;</span><br><span class="line">YY_BREAK</span><br><span class="line"><span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">YY_RULE_SETUP</span><br><span class="line"><span class="meta">#<span class="meta-keyword">line</span> 18 <span class="meta-string">&quot;cal2.l&quot;</span></span></span><br><span class="line">&#123;<span class="keyword">return</span> MUL; &#125;</span><br><span class="line">YY_BREAK</span><br><span class="line"><span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">YY_RULE_SETUP</span><br><span class="line"><span class="meta">#<span class="meta-keyword">line</span> 19 <span class="meta-string">&quot;cal2.l&quot;</span></span></span><br><span class="line">&#123;<span class="keyword">return</span> DIV; &#125;</span><br><span class="line">YY_BREAK</span><br><span class="line"><span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">YY_RULE_SETUP</span><br><span class="line"><span class="meta">#<span class="meta-keyword">line</span> 20 <span class="meta-string">&quot;cal2.l&quot;</span></span></span><br><span class="line">&#123;<span class="keyword">return</span> ABS; &#125;</span><br><span class="line">YY_BREAK</span><br><span class="line"><span class="keyword">case</span> <span class="number">6</span>:</span><br><span class="line">YY_RULE_SETUP</span><br><span class="line"><span class="meta">#<span class="meta-keyword">line</span> 21 <span class="meta-string">&quot;cal2.l&quot;</span></span></span><br><span class="line">&#123; yylval = atoi(yytext); <span class="keyword">return</span> NUMBER; &#125; <span class="comment">//yytext匹配 yylval返回值</span></span><br><span class="line">YY_BREAK</span><br><span class="line"><span class="keyword">case</span> <span class="number">7</span>:</span><br><span class="line"><span class="comment">/* rule 7 can match eol */</span></span><br><span class="line">YY_RULE_SETUP</span><br><span class="line"><span class="meta">#<span class="meta-keyword">line</span> 22 <span class="meta-string">&quot;cal2.l&quot;</span></span></span><br><span class="line">&#123;<span class="keyword">return</span> EOL;&#125;</span><br><span class="line">YY_BREAK</span><br><span class="line"><span class="keyword">case</span> <span class="number">8</span>:</span><br><span class="line">YY_RULE_SETUP</span><br><span class="line"><span class="meta">#<span class="meta-keyword">line</span> 23 <span class="meta-string">&quot;cal2.l&quot;</span></span></span><br><span class="line">&#123;&#125;</span><br><span class="line">YY_BREAK</span><br><span class="line"><span class="keyword">case</span> <span class="number">9</span>:</span><br><span class="line">YY_RULE_SETUP</span><br><span class="line"><span class="meta">#<span class="meta-keyword">line</span> 24 <span class="meta-string">&quot;cal2.l&quot;</span></span></span><br><span class="line">&#123; ECHO ;&#125;</span><br><span class="line">YY_BREAK</span><br><span class="line"><span class="keyword">case</span> <span class="number">10</span>:</span><br><span class="line">YY_RULE_SETUP</span><br><span class="line"><span class="meta">#<span class="meta-keyword">line</span> 25 <span class="meta-string">&quot;cal2.l&quot;</span></span></span><br><span class="line">ECHO;</span><br><span class="line">YY_BREAK</span><br><span class="line"><span class="meta">#<span class="meta-keyword">line</span> 789 <span class="meta-string">&quot;lex.yy.c&quot;</span></span></span><br><span class="line"><span class="function"><span class="keyword">case</span> <span class="title">YY_STATE_EOF</span><span class="params">(INITIAL)</span>:</span></span><br><span class="line"><span class="function"><span class="title">yyterminate</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> YY_END_OF_BUFFER:</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">/* Amount of text matched not including the EOB char. */</span></span><br><span class="line"><span class="keyword">int</span> yy_amount_of_matched_text = (<span class="keyword">int</span>) (yy_cp - (yytext_ptr)) - <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Undo the effects of YY_DO_BEFORE_ACTION. */</span></span><br><span class="line">*yy_cp = (yy_hold_char);</span><br><span class="line"><span class="function">YY_RESTORE_YY_MORE_OFFSET</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">if</span> <span class="params">( YY_CURRENT_BUFFER_LVALUE-&gt;yy_buffer_status == YY_BUFFER_NEW )</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">/* We&#x27;re scanning a new file or input source.  It&#x27;s</span></span><br><span class="line"><span class="comment"> * possible that this happened because the user</span></span><br><span class="line"><span class="comment"> * just pointed yyin at a new source and called</span></span><br><span class="line"><span class="comment"> * yylex().  If so, then we have to assure</span></span><br><span class="line"><span class="comment"> * consistency between YY_CURRENT_BUFFER and our</span></span><br><span class="line"><span class="comment"> * globals.  Here is the right place to do so, because</span></span><br><span class="line"><span class="comment"> * this is the first action (other than possibly a</span></span><br><span class="line"><span class="comment"> * back-up) that will match for the new input source.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">(yy_n_chars) = YY_CURRENT_BUFFER_LVALUE-&gt;yy_n_chars;</span><br><span class="line">YY_CURRENT_BUFFER_LVALUE-&gt;yy_input_file = yyin;</span><br><span class="line">YY_CURRENT_BUFFER_LVALUE-&gt;yy_buffer_status = YY_BUFFER_NORMAL;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Note that here we test for yy_c_buf_p &quot;&lt;=&quot; to the position</span></span><br><span class="line"><span class="comment"> * of the first EOB in the buffer, since yy_c_buf_p will</span></span><br><span class="line"><span class="comment"> * already have been incremented past the NUL character</span></span><br><span class="line"><span class="comment"> * (since all states make transitions on EOB to the</span></span><br><span class="line"><span class="comment"> * end-of-buffer state).  Contrast this with the test</span></span><br><span class="line"><span class="comment"> * in input().</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">if</span> ( (yy_c_buf_p) &lt;= &amp;YY_CURRENT_BUFFER_LVALUE-&gt;yy_ch_buf[(yy_n_chars)] )</span><br><span class="line">&#123; <span class="comment">/* This was really a NUL. */</span></span><br><span class="line">yy_state_type yy_next_state;</span><br><span class="line"></span><br><span class="line">(yy_c_buf_p) = (yytext_ptr) + yy_amount_of_matched_text;</span><br><span class="line"></span><br><span class="line">yy_current_state = yy_get_previous_state(  );</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Okay, we&#x27;re now positioned to make the NUL</span></span><br><span class="line"><span class="comment"> * transition.  We couldn&#x27;t have</span></span><br><span class="line"><span class="comment"> * yy_get_previous_state() go ahead and do it</span></span><br><span class="line"><span class="comment"> * for us because it doesn&#x27;t know how to deal</span></span><br><span class="line"><span class="comment"> * with the possibility of jamming (and we don&#x27;t</span></span><br><span class="line"><span class="comment"> * want to build jamming into it because then it</span></span><br><span class="line"><span class="comment"> * will run more slowly).</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line">yy_next_state = yy_try_NUL_trans( yy_current_state );</span><br><span class="line"></span><br><span class="line">yy_bp = (yytext_ptr) + YY_MORE_ADJ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ( yy_next_state )</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">/* Consume the NUL. */</span></span><br><span class="line">yy_cp = ++(yy_c_buf_p);</span><br><span class="line">yy_current_state = yy_next_state;</span><br><span class="line"><span class="keyword">goto</span> yy_match;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">yy_cp = (yy_c_buf_p);</span><br><span class="line"><span class="keyword">goto</span> yy_find_action;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">else</span> <span class="keyword">switch</span> ( yy_get_next_buffer(  ) )</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">case</span> EOB_ACT_END_OF_FILE:</span><br><span class="line">&#123;</span><br><span class="line">(yy_did_buffer_switch_on_eof) = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ( yywrap(  ) )</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">/* Note: because we&#x27;ve taken care in</span></span><br><span class="line"><span class="comment"> * yy_get_next_buffer() to have set up</span></span><br><span class="line"><span class="comment"> * yytext, we can now set up</span></span><br><span class="line"><span class="comment"> * yy_c_buf_p so that if some total</span></span><br><span class="line"><span class="comment"> * hoser (like flex itself) wants to</span></span><br><span class="line"><span class="comment"> * call the scanner after we return the</span></span><br><span class="line"><span class="comment"> * YY_NULL, it&#x27;ll still work - another</span></span><br><span class="line"><span class="comment"> * YY_NULL will get returned.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">(yy_c_buf_p) = (yytext_ptr) + YY_MORE_ADJ;</span><br><span class="line"></span><br><span class="line">yy_act = YY_STATE_EOF(YY_START);</span><br><span class="line"><span class="keyword">goto</span> do_action;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> ( ! (yy_did_buffer_switch_on_eof) )</span><br><span class="line">YY_NEW_FILE;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> EOB_ACT_CONTINUE_SCAN:</span><br><span class="line">(yy_c_buf_p) =</span><br><span class="line">(yytext_ptr) + yy_amount_of_matched_text;</span><br><span class="line"></span><br><span class="line">yy_current_state = yy_get_previous_state(  );</span><br><span class="line"></span><br><span class="line">yy_cp = (yy_c_buf_p);</span><br><span class="line">yy_bp = (yytext_ptr) + YY_MORE_ADJ;</span><br><span class="line"><span class="keyword">goto</span> yy_match;</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> EOB_ACT_LAST_MATCH:</span><br><span class="line">(yy_c_buf_p) =</span><br><span class="line">&amp;YY_CURRENT_BUFFER_LVALUE-&gt;yy_ch_buf[(yy_n_chars)];</span><br><span class="line"></span><br><span class="line">yy_current_state = yy_get_previous_state(  );</span><br><span class="line"></span><br><span class="line">yy_cp = (yy_c_buf_p);</span><br><span class="line">yy_bp = (yytext_ptr) + YY_MORE_ADJ;</span><br><span class="line"><span class="keyword">goto</span> yy_find_action;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">YY_FATAL_ERROR(</span><br><span class="line"><span class="string">&quot;fatal flex scanner internal error--no action found&quot;</span> );</span><br><span class="line">&#125; <span class="comment">/* end of action switch */</span></span><br><span class="line">&#125; <span class="comment">/* end of scanning one token */</span></span><br><span class="line">&#125; <span class="comment">/* end of user&#x27;s declarations */</span></span><br><span class="line">&#125; <span class="comment">/* end of yylex */</span></span><br></pre></td></tr></table></figure><p>以上是yylex函数.</p><h3 id="流程"><a href="#流程" class="headerlink" title="流程"></a>流程</h3><p>yyparse调用yylex,调用yylex时得到一个二元式,&lt;记号 属性值&gt;</p><p>记号通过return会送给yyparse(),记号必须在yacc中%token声明.属性值通过全局变量yylval会送给yyparse</p><h2 id="参考书籍6"><a href="#参考书籍6" class="headerlink" title="参考书籍6"></a>参考书籍6</h2><p>flex和bison</p><p>编译与反编译实战</p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      
        <tags>
            
            <tag> flex </tag>
            
            <tag> lex </tag>
            
            <tag> yacc </tag>
            
            <tag> bison </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>密码破解学习</title>
      <link href="2022/04/11/%E5%AF%86%E7%A0%81%E7%A0%B4%E8%A7%A3%E5%AD%A6%E4%B9%A0/"/>
      <url>2022/04/11/%E5%AF%86%E7%A0%81%E7%A0%B4%E8%A7%A3%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>利用python学习密码</p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      
        <tags>
            
            <tag> crypto </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>django学习</title>
      <link href="2022/04/07/django%E5%AD%A6%E4%B9%A0/"/>
      <url>2022/04/07/django%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>说到web后端框架,其主要是用于提供curd和restapi.有Java的Spring系列,还有现在比较火的Go,js也有一些用于web的库.而python有flask,django和fastapi(重点是提供api).</p><span id="more"></span><h2 id="一点历史"><a href="#一点历史" class="headerlink" title="一点历史"></a>一点历史</h2><p><a href="https://www.djangoproject.com/">官网</a></p><p>Django 最初被设计用于具有快速开发需求的新闻类站点，目的是要实现简单快捷的网站开发</p><blockquote><p>以下是安装 Django 的推荐方式。</p><ol><li>安装 <a href="https://pip.pypa.io/">pip</a>。最简单的方式是使用 <a href="https://pip.pypa.io/en/latest/installation/">独立 pip 安装器</a>。若你的系统早已安装 <code>pip</code>，你可能需要更新它，因为它可能过期了。如果它过期了，你会知道的，因为过期的用不了。</li><li>看一下 <a href="https://docs.python.org/3/tutorial/venv.html">venv</a>。这个工具提供了隔离的Python环境，比在系统内安装包更实用。它还允许在没有管理员权限的情况下安装包。<a href="https://docs.djangoproject.com/zh-hans/4.0/intro/contributing/">贡献指南</a> 介绍了如何创建一个虚拟环境。</li></ol></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -m pip install Django</span><br></pre></td></tr></table></figure><p>当然还要安装数据库和python关于控制数据库的库.</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">django-admin startproject myProject</span><br><span class="line">ll</span><br><span class="line">tree myProject</span><br></pre></td></tr></table></figure><p><img data-src="https://s2.loli.net/2022/04/07/O4GWP79FYylhKBQ.png" alt="项目结构" style="zoom:67%;" /></p><p>可以看到Django项目还是很简练的,我个人认为Python的很多东西设计都很不错,虽然我对这门语言有点偏见.</p><p><code>manage.py</code> 项目的入口文件</p><p><code>myProject</code> 主目录下的同名子目录，为项目的核心目录，它里面包含配置文件和管理应用的文件。</p><p><code>myProject/__init__.py</code> 每个子目录都会包含这样一个 <code>__init__.py</code> 文件，它是一个空文件，在需要的时候会引入目录下的对象。</p><p><code>myProject/settings.py</code> 配置文件，里面包含对数据库的设置项、CSRF Token 的设置项、模板的设置项等全部设置。</p><p><code>myProject/urls.py</code> 路由控制文件，处理客户端请求，分发到对应的视图函数去处理</p><p><code>myProject/wsgi.py</code> 处理请求和响应.</p><h2 id="开始"><a href="#开始" class="headerlink" title="开始"></a>开始</h2><p>接下来直接开始</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> myProject</span><br><span class="line">python3 manage.py startapp myApp</span><br></pre></td></tr></table></figure><p>创建一个名为 myApp 的应用，注意实验环境里不可以创建名为 test 的应用，某些情况下它与 Python 模块冲突</p><p>在项目的主目录下出现了名为 myApp 的目录，这就是应用目录。</p><ul><li><code>myApp/admin.py</code> 用于控制后台管理的文件。</li><li><code>myApp/apps.py</code> 用于管理应用本身的文件，包括应用的名字如何命名，默认就是 myApp 。</li><li><code>myApp/__init__.py</code> 空文件。</li><li><code>myApp/migrations</code> 这是用于记录数据库变更信息的目录，Django 中自带的数据库版本控制功能就体现在这个目录，在学习数据存储时会详细介绍。</li><li><code>myApp/models.py</code> 创建映射类的文件。</li><li><code>myApp/tests.py</code> 编写测试代码的文件。</li><li><code>myApp/views.py</code> 创建视图函数的文件，视图函数用于处理客户端发来的请求。</li></ul><p><strong>配置应用</strong></p><p>在项目的setting.py下增加myApp</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">INSTALLED_APPS = [</span><br><span class="line">    <span class="string">&#x27;django.contrib.admin&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.auth&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.contenttypes&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.sessions&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.messages&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.staticfiles&#x27;</span>,</span><br><span class="line">    <span class="string">&quot;myApp&quot;</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 manage.py runserver</span><br></pre></td></tr></table></figure><p>开启服务.默认8000端口 更改端口后面直接加端口号.</p><h2 id="视图"><a href="#视图" class="headerlink" title="视图"></a>视图</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># myApp/views.py</span></span><br><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render</span><br><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponse</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">&quot;Hello, world!&quot;</span>)</span><br></pre></td></tr></table></figure><p>映射到url</p><blockquote><p>Examples:<br>Function views</p><ol><li><p>Add an import:  from my_app import views</p></li><li><p>Add a URL to urlpatterns:  path(‘’, views.home, name=’home’)</p><p>   Class-based views</p><p>   1.Add an import:  from other_app.views import Home</p><p>   2.Add a URL to urlpatterns:  path(‘’, Home.as_view(), name=’home’)<br>   Including another URLconf</p><p>   1.Import the include() function: from django.urls import include, path</p><p>   2.Add a URL to urlpatterns:  path(‘blog/‘, include(‘blog.urls’))</p></li></ol></blockquote><p>path函数</p><div class="table-container"><table><thead><tr><th>参数</th><th>意义</th><th>是否必须</th></tr></thead><tbody><tr><td>route</td><td>route 是一个匹配 URL 的准则（类似正则表达式）。当 Django 响应一个请求时，它会从 urlpatterns 的第一项开始，按顺序依次匹配列表中的项，直到找到匹配的项。</td><td>必须</td></tr><tr><td>view</td><td>当 Django 找到了一个匹配的准则，就会调用这个特定的视图函数，并传入一个 HttpRequest 对象作为第一个参数，被“捕获”的参数以关键字参数的形式传入。</td><td>必须</td></tr><tr><td>kwargs</td><td>任意个关键字参数可以作为一个字典传递给目标视图函数。</td><td>可选</td></tr><tr><td>name</td><td>为你的 URL 取名能使你在 Django 的任意地方唯一地引用它，尤其是在模板中。这个有用的特性允许你只改一个文件就能全局地修改某个 URL 模式。</td><td>可选</td></tr></tbody></table></div><h2 id="模型"><a href="#模型" class="headerlink" title="模型"></a>模型</h2><p>在创建的应用程序中有model</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># myApp/models.py</span></span><br><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Book</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">    name = models.CharField(max_length=<span class="number">200</span>)</span><br><span class="line">    author = models.CharField(max_length=<span class="number">100</span>)</span><br><span class="line">    pub_house = models.CharField(max_length=<span class="number">200</span>)</span><br><span class="line">    pub_date = models.DateTimeField(<span class="string">&#x27;date published&#x27;</span>)</span><br></pre></td></tr></table></figure><p>我觉得这里跟Java Bean有点像.模型是 <code>django.db.models.Model</code> 类的子类。每个模型有一些类变量，它们都表示模型里的一个数据库字段。</p><p>每个字段都是 <code>Field</code> 类的实例。比如字符字段是 <code>CharField</code>，日期字段被表示为 <code>DateTImeField</code>。这将告诉 Django 每个字段要处理的数据类型。</p><p>定义某些 <code>Field</code> 类实例需要参数。如上面的 <code>max_length=100</code> 中的 <code>max_length</code>。这个参数的用处不止于用来定义数据结构，也用于验证数据。</p><p>在setting中修改</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># myProject/settings.py</span></span><br><span class="line">INSTALLED_APPS = [</span><br><span class="line">    <span class="string">&#x27;django.contrib.admin&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.auth&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.contenttypes&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.sessions&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.messages&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.staticfiles&#x27;</span>,</span><br><span class="line">    <span class="comment"># &#x27;myApp&#x27;, 这一注释掉，不注释掉会因重复而报错</span></span><br><span class="line">    <span class="string">&#x27;myApp.apps.MyappConfig&#x27;</span>,</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>然后进行迁移</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python manage.py makemigrations myApp</span><br></pre></td></tr></table></figure><p>这样就创建了模型</p><p><img data-src="https://s2.loli.net/2022/04/08/Rl4HF5k9iVYeUIL.png" alt="Book模型"></p><p><img data-src="https://s2.loli.net/2022/04/08/jfT1dzUhuAc8RgH.png" alt="产生的文件"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Migration</span>(<span class="params">migrations.Migration</span>):</span></span><br><span class="line"></span><br><span class="line">    initial = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    dependencies = [</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    operations = [</span><br><span class="line">        migrations.CreateModel(</span><br><span class="line">            name=<span class="string">&#x27;Book&#x27;</span>,</span><br><span class="line">            fields=[</span><br><span class="line">                (<span class="string">&#x27;id&#x27;</span>, models.AutoField(auto_created=<span class="literal">True</span>, primary_key=<span class="literal">True</span>, serialize=<span class="literal">False</span>, verbose_name=<span class="string">&#x27;ID&#x27;</span>)),</span><br><span class="line">                (<span class="string">&#x27;name&#x27;</span>, models.CharField(max_length=<span class="number">200</span>)),</span><br><span class="line">                (<span class="string">&#x27;author&#x27;</span>, models.CharField(max_length=<span class="number">100</span>)),</span><br><span class="line">                (<span class="string">&#x27;pub_house&#x27;</span>, models.CharField(max_length=<span class="number">200</span>)),</span><br><span class="line">                (<span class="string">&#x27;pub_date&#x27;</span>, models.DateTimeField(verbose_name=<span class="string">&#x27;date published&#x27;</span>)),</span><br><span class="line">            ],</span><br><span class="line">        ),</span><br><span class="line">    ]</span><br></pre></td></tr></table></figure><p>通过运行 <code>makemigrations</code> 命令，Django 会检测你对模型文件的修改，并且把修改的部分储存为一次迁移.</p><p>通过命令查看创建数据库的命令</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 manage.py sqlmigrate myApp 0001</span><br></pre></td></tr></table></figure><h2 id="模板"><a href="#模板" class="headerlink" title="模板"></a>模板</h2><p>默认的设置文件设置了 <code>DjangoTemplates</code> 后端，并设置 <code>APP_DIRS = True</code>。这一选项将会让 <code>DjangoTemplates</code> 在每个 <code>INSTALLED_APPS</code> 文件夹中寻找 templates 子目录。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">TEMPLATES = [</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&#x27;BACKEND&#x27;</span>: <span class="string">&#x27;django.template.backends.django.DjangoTemplates&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;DIRS&#x27;</span>: [],</span><br><span class="line">        <span class="string">&#x27;APP_DIRS&#x27;</span>: <span class="literal">True</span>,</span><br><span class="line">        <span class="string">&#x27;OPTIONS&#x27;</span>: &#123;</span><br><span class="line">            <span class="string">&#x27;context_processors&#x27;</span>: [</span><br><span class="line">                <span class="string">&#x27;django.template.context_processors.debug&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;django.template.context_processors.request&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;django.contrib.auth.context_processors.auth&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;django.contrib.messages.context_processors.messages&#x27;</span>,</span><br><span class="line">            ],</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">]</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>在views.py中添加视图</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render</span><br><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponse</span><br><span class="line"><span class="keyword">from</span> myApp.models <span class="keyword">import</span> Book</span><br><span class="line"><span class="comment"># Create your views here.</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>(<span class="params">requst</span>):</span></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">&quot;Hello World&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">detail</span>(<span class="params">request</span>):</span></span><br><span class="line">    book_list = Book.objects.order_by(<span class="string">&#x27;pub_date&#x27;</span>)[:<span class="number">5</span>]</span><br><span class="line">    context = &#123;<span class="string">&#x27;book_list&#x27;</span>:book_list&#125;</span><br><span class="line">    <span class="keyword">return</span> render(request,<span class="string">&quot;myApp/detail.html&quot;</span>,context)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>再进行视图绑定</p><h2 id="使用MTV模式实现数据库增删改"><a href="#使用MTV模式实现数据库增删改" class="headerlink" title="使用MTV模式实现数据库增删改"></a>使用MTV模式实现数据库增删改</h2><p>首先设计界面.</p><p> <code>myApp/templates/myApp/detail.html</code> 里，添加一个表单。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">name</span>=<span class="string">&quot;addBook&quot;</span>&gt;</span></span><br><span class="line">  &#123;% csrf_token %&#125;</span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>书名：<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> /&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>作者：<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;author&quot;</span> /&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>出版社：<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;pub_house&quot;</span> /&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;添加&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>上面的模板是输入相应的书名、作者和出版社后，点击添加，将数据存储到数据库并刷新页面显示出来。</li><li>我们设置表单的 <code>action=&quot;/addBook/&quot;</code>，并设置 <code>method=&quot;post&quot;</code>。使用 <code>method=&quot;post&quot;</code>（与其相对的是 <code>method=&quot;get&quot;</code>）是非常重要的，因为这个提交表单的行为会改变服务器端的数据,无论何时，当你需要创建一个改变服务器端数据的表单时，请使用 <code>method=&quot;post&quot;</code>。这不是 Django 的特定技巧，这是优秀的网站开发技巧。</li><li>由于我们创建一个 POST 表单（它具有修改数据的作用），所以我们需要小心跨站点请求伪造。 但你不必太过担心，因为 Django 已经拥有一个用来防御它的非常容易使用的系统。 简而言之，所有针对内部 URL 的 POST 表单都应该使用 <code>&#123;% csrf_token %&#125;</code> 模板标签</li></ul><p>在根 URLconf 中添加命名空间。在 <code>myProject/urls.py</code> 文件中稍作修改，加上 <code>app_name</code> 设置命名空间：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line"><span class="keyword">from</span> myApp <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line">app_name = <span class="string">&#x27;myApp&#x27;</span> <span class="comment"># 添加这一行</span></span><br><span class="line">urlpatterns = [</span><br><span class="line">    <span class="comment"># path(&#x27;admin/&#x27;, admin.site.urls),</span></span><br><span class="line">    path(<span class="string">&#x27;&#x27;</span>, views.detail, name=<span class="string">&#x27;detail&#x27;</span>),</span><br><span class="line">    path(<span class="string">&#x27;addBook/&#x27;</span>, views.addBook, name=<span class="string">&#x27;addBook&#x27;</span>),</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>现在回到 <code>myApp/templates/myApp/detail.html</code> 更改 <code>action</code>：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/addBook/&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">name</span>=<span class="string">&quot;addBook&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure><p>创建 <code>addBook</code> 函数来实现我们添加书籍的功能。</p><p>将下面的代码添加到 myApp/views.py：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># myApp/views.py</span></span><br><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponseRedirect</span><br><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> reverse</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">addBook</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        temp_name = request.POST[<span class="string">&#x27;name&#x27;</span>]</span><br><span class="line">        temp_author = request.POST[<span class="string">&#x27;author&#x27;</span>]</span><br><span class="line">        temp_pub_house = request.POST[<span class="string">&#x27;pub_house&#x27;</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">from</span> django.utils <span class="keyword">import</span> timezone</span><br><span class="line">    temp_book = Book(name=temp_name, author=temp_author, pub_house=temp_pub_house, pub_date=timezone.now())</span><br><span class="line">    temp_book.save()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 重定向</span></span><br><span class="line">    <span class="keyword">return</span> HttpResponseRedirect(reverse(<span class="string">&#x27;detail&#x27;</span>))</span><br></pre></td></tr></table></figure><p>在 myProject/urls.py 里添加 URL 地址映射：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># myProject/urls.py</span></span><br><span class="line">path(<span class="string">&#x27;addBook/&#x27;</span>, views.addBook, name=<span class="string">&#x27;addBook&#x27;</span>),</span><br></pre></td></tr></table></figure><p>简单说明：</p><ul><li><code>request.POST</code> 是一个类字典对象，可以通过关键字的名字获取提交的数据。 这个例子中，<code>request.POST[&#39;name&#39;]</code> 以字符串形式返回<code>name</code>的值。<code>request.POST</code> 的值永远是字符串。</li><li>在添加书籍之后，代码返回一个 <code>HttpResponseRedirect</code> 而不是常用的 <code>HttpResponse</code>，<code>HttpResponseRedirect</code> 只接收一个参数：用户将要被重定向的 URL。</li><li>你应该在每次处理 POST 数据时，都返回<code>HttpResponseRedirect</code>。这也不是 Django 的特定技巧，这是优秀的网站开发的实践。</li><li>在这个例子中，我们在 <code>HttpResponseRedirect</code> 的构造函数中使用 <code>reverse()</code> 函数。这个函数避免了我们在视图函数中硬编码 URL。它需要我们给出想要跳转的视图的名字和该视图所对应的 URL 模式中需要给该视图提供的参数。<code>reverse()</code> 调用后将返回这样一个字符串：<code>/detail/</code>。</li></ul><p>删除书籍功能实现起来也很简单。</p><p>首先，在 <code>myApp/detail.html</code> 中设计我们的模板。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;% for book in book_list.all %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; book.name &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; book.author &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; book.pub_house &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; book.pub_date &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&#123;% url &#x27;delBook&#x27; book.id %&#125;&quot;</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="comment">&lt;!--只添加这一行--&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">&#123;% endfor %&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br></pre></td></tr></table></figure><p>可以看出，只需要在每个书籍后面添加一个删除的按钮。删除时也传递了需要删除的图书的 <code>id</code>。</p><p>接着，配置 url，只需在 <code>myProject/urls.py</code> 中添加这一行：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># myProject/urls.py</span></span><br><span class="line">path(<span class="string">&#x27;delBook/&lt;int:book_id&gt;&#x27;</span>, views.deleteBook, name=<span class="string">&#x27;delBook&#x27;</span>),</span><br></pre></td></tr></table></figure><p>这里 <code>&lt;int:book_id&gt;</code> 是接收传递的参数 <code>book_id</code>。</p><p>最后设计视图函数：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># myApp/views.py</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">deleteBook</span>(<span class="params">request, book_id</span>):</span></span><br><span class="line">    bookID = book_id</span><br><span class="line">    Book.objects.<span class="built_in">filter</span>(<span class="built_in">id</span>=bookID).delete()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 重定向</span></span><br><span class="line">    <span class="keyword">return</span> HttpResponseRedirect(reverse(<span class="string">&#x27;detail&#x27;</span>))</span><br></pre></td></tr></table></figure><p>这个视图中，获取到 book 的 id，根据 id 来删除指定书籍。最后跟上面的添加书籍函数相同，使用重定位刷新页面。</p><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a href="https://docs.djangoproject.com/zh-hans/4.0">官网</a>这个是中文版的,很详细.</p><p>蓝桥云在线平台.</p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> django </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
            <tag> web </tag>
            
            <tag> django </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>graphviz学习</title>
      <link href="2022/04/01/graphviz%E5%AD%A6%E4%B9%A0/"/>
      <url>2022/04/01/graphviz%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>这是一个好用的工具,跟UML一样能起到很好的作用.<br><span id="more"></span></p><p>官方网站<a href="https://graphviz.org/">Graphviz</a></p><p>其官网在介绍Dot language时也用了文法推导.</p><h2 id="Layout-Engines"><a href="#Layout-Engines" class="headerlink" title="Layout Engines"></a>Layout Engines</h2><p>使用这些引擎可以得到不同的图</p><h3 id="dot"><a href="#dot" class="headerlink" title="dot"></a>dot</h3><blockquote><p>Makes “hierarchical” or layered drawings of directed graphs.</p><p><code>dot</code> is the default tool to use if edges have directionality.</p></blockquote><p>dot是使用有向图的默认工具.</p><blockquote><p>The layout algorithm aims edges in the same direction (top to bottom, or left to right) and then attempts to avoid edge crossings and reduce edge length.</p></blockquote><p>使箭头尽量从上到下,从左到右.其输出格式包括PostScript，PDF，SVG，PNG，含注解的文本等等。</p><h3 id="neato"><a href="#neato" class="headerlink" title="neato"></a>neato</h3><blockquote><p><code>neato</code> is the default tool to use if the graph is not too large (about 100 nodes) and you don’t know anything else about it.</p><p><code>neato</code> attempts to minimize a global energy function, which is equivalent to statistical multi-dimensional scaling.</p></blockquote><p>放射状,节点不能过多.</p><h3 id="twopi"><a href="#twopi" class="headerlink" title="twopi"></a>twopi</h3><blockquote><p>Nodes are placed on concentric circles depending their distance from a given root node.</p></blockquote><p>同心圆</p><h3 id="circo"><a href="#circo" class="headerlink" title="circo"></a>circo</h3><blockquote><p>This is suitable for certain diagrams of multiple cyclic structures, such as certain telecommunications networks</p></blockquote><p>圆形图形</p><h3 id="fdp"><a href="#fdp" class="headerlink" title="fdp"></a>fdp</h3><blockquote><p>“spring model” layouts similar to those of <a href="https://graphviz.org/docs/layouts/neato/">neato</a>, but does this by reducing forces rather than working with energy.</p><p><code>fdp</code> implements the Fruchterman-Reingold heuristic including a multigrid solver that handles larger graphs and clustered undirected graphs.</p></blockquote><p>用于生成无向图的工具</p><p>此外还有osage,patchwork和sfdp</p><blockquote><p><code>osage</code> draws clustered graphs</p><p><code>patchwork</code> draws clustered graphs using a squarified treemap layout</p><p>Multiscale version of <code>fdp</code> for the layout of large graphs.</p></blockquote><p>可以输出的类型也非常多,除了常见的图片类型png,jpg,ico,webp还有svg,ps(postscript)/pdf</p><h2 id="Dot语言"><a href="#Dot语言" class="headerlink" title="Dot语言"></a>Dot语言</h2><p>描述图的生成.</p><p>另外还有节点颜色形状,边的颜色箭头样式, 图的颜色等设置,这些直接翻阅官方文档即可.</p><p>可以直接写一个dot文件然后命令行输出得到图,也可以配合一些编辑器,例如vscode,下载插件plantUML或者直接Graphviz就有扩展.</p><p><img data-src="http://cdn.sekyoro.top/imgs/image-20220402093358726.png" alt="示例" style="zoom:50%;" /></p><p>我基本上就在vscode上练了.</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">digraph demo &#123;</span><br><span class="line">   label = &quot;示例&quot;</span><br><span class="line">   bgcolor = &quot;beige&quot;</span><br><span class="line">   node[color = &quot;grey&quot;]</span><br><span class="line">    father[label = &quot;爸爸&quot;,shape = &quot;box&quot;]</span><br><span class="line">    node[color=&quot;<span class="params">#</span>FF6347&quot;]</span><br><span class="line">    strangers[label=&quot;路人&quot;]</span><br><span class="line">    edge[color=&quot;yellow&quot;]</span><br><span class="line">    father-&gt;mother[dir=both,label=&quot;爱人&quot;]</span><br><span class="line">    strangers-&gt;mother[label=&quot;??&quot;]</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这里说一下问题,vscode插件导出图片后中文变乱码了,预览的时候好好的.</p><p><img data-src="http://cdn.sekyoro.top/imgs/%E5%A5%87%E5%A6%99%E7%9A%84%E5%85%B3%E7%B3%BB.png" alt="奇妙的关系" style="zoom:67%;" /></p><p>然后我发现这不只是插件的问题,事实上在windows上使用graphviz中文就是会乱码,所以需要额外的设置(不用中文也不是不行),在mac上我记得是不会乱码的.</p><p>可行的解决方法是手动添加字体属性,要给node,edge和graph都添加上</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"> digraph demo &#123;</span><br><span class="line">   graph[label=&quot;图&quot;,fontname=&quot;FangSong&quot;]</span><br><span class="line">   bgcolor = &quot;beige&quot;</span><br><span class="line">   node[color = &quot;grey&quot;,fontname=&quot;FangSong&quot;]</span><br><span class="line">    edge[color=&quot;yellow&quot;,fontname=&quot;FangSong&quot;]</span><br><span class="line">    father[label = &quot; 爸爸 &quot;,shape = &quot;box&quot;]</span><br><span class="line">    strangers[label=&quot; 路人 &quot;]</span><br><span class="line">    </span><br><span class="line">    father-&gt;mother[dir=both,label=&quot; 爱人 &quot;]</span><br><span class="line">    strangers-&gt;mother[label=&quot;??&quot;]</span><br><span class="line">    me[shape=&quot;record&quot;,label=&quot; |你好| &quot;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后就正常了.后面如果有解决方法我再更新.</p><h3 id="题外话"><a href="#题外话" class="headerlink" title="题外话"></a>题外话</h3><p>这里再介绍一下其他的一堆东西.原因是我发现我装的graphviz是msys2中的.</p><p>clang和llvm,cygwin,msys2,minGW,msvc.</p><blockquote><p>在<strong>windows下clang指令只是负责编译的前端工作，即识别编译指令，与提供报错提示</strong>。并<strong>不负责具体的代码编译工作</strong>，所以在windows下光安装llvm是不够的，还需<strong>要</strong>有实际的编译链接库，例如<strong>安装MinGW或者MSVC来获取需要的运行库</strong></p></blockquote><p>其实clang的含义有一定的歧义,一般可以认为其包含llvm作为后端,下载时直接下载llvm包含clang,苹果一般是自带clang的.狭义理解clang就是前端负责词法语法和语义生成中间代码.</p><p><strong>Cygwin是一个可原生运行于Windows系统上的POSIX兼容环境</strong>。这意味着我们我可以在windows上使用经典的一些linux东西,比如GNU套装.</p><p>MinGW，<em>Minimalist GNU for Windows</em>，用于开发原生（32位） Windows 应用的开发环境。它主要提供了针对 win32 应用的 GCC、GNU binutils 等工具，以及对等于 Windows SDK（的子集）的头文件和用于 MinGW 版本 linker 的库文件（so、a等，而不是 VC 的 lib）。</p><p>MinGW 能够替代 cl 用于编译不包含 MFC 的、以 WinSDK 为主的 Windows 应用，并且编译出来的应用不依赖于第三方的模拟层支持，其运行时为大部分 Windows 标配的 msvcrt（故称原生 Windows 应用）。除此之外，MinGW 也支持 GCC 支持的其他语言。</p><p>而msys2是msys的升级版,msys是MinGW的分支,作用类似.</p><p>区别（小结）：Cygwin是模拟 POSIX 系统，源码移植 Linux 应用到 Windows 下；MinGW 是用于开发 Windows 应用的开发环境.</p><p>MSVC，就是微软（MS）的VC运行库。VC运行库，是Visual C++的运行库。很多程序在编制的时候，使用了微软的运行库，大大减少了软件的编码量，却提高了兼容性。但运行的时候，需要这些运行库。这些运行库简称就是MSVC。</p><h2 id="一些重点"><a href="#一些重点" class="headerlink" title="一些重点"></a>一些重点</h2><p>事实上这些东西较难也没有必要完全记住,把官方文档保存,掌握基本要点就行了.<br>掌握四个重点,图,子图,节点与边.</p><h3 id="Graph"><a href="#Graph" class="headerlink" title="Graph"></a>Graph</h3><div class="table-container"><table><thead><tr><th>属性名</th><th>默认值</th><th>说明</th></tr></thead><tbody><tr><td>label</td><td></td><td>图片标签，如上面<code>示例</code></td></tr><tr><td>bgcolor</td><td></td><td>背景颜色，颜色文档<a href="http://www.graphviz.org/content/color-names">点此</a></td></tr><tr><td>fontcolor</td><td>black</td><td>字体颜色，定义上面<code>示例</code>的颜色</td></tr><tr><td>fontname</td><td>Times-Roman</td><td>字体</td></tr><tr><td>fontsize</td><td>14</td><td>字体大小</td></tr><tr><td>rank</td><td></td><td>子图等级限制， same,min,max,source,sink</td></tr><tr><td>rankdir</td><td>TB</td><td>排序方向，LR(left to right) or TB(top to bottom)</td></tr><tr><td>compound</td><td>false</td><td>If true, allow edges between clusters. 配合 lhead 和 ltail 使用</td></tr></tbody></table></div><p>label设置图的标题.</p><p>graph[设置全局图属性] 注意这种设置会被局部的覆盖,对于图来说倒不是很要紧</p><p>如果中文字图出现乱码可以设置fontname.一般rankdir和compound用的较多,可以设置排序方向和边的连接.</p><p>注意,有向边只能在有向图中使用,无向边只能在无向图中使用</p><h3 id="Node"><a href="#Node" class="headerlink" title="Node"></a>Node</h3><div class="table-container"><table><thead><tr><th>属性名</th><th>默认值</th><th>说明</th></tr></thead><tbody><tr><td>label</td><td>node name</td><td>节点显示内容</td></tr><tr><td>color</td><td>black</td><td>node边框颜色</td></tr><tr><td>fontcolor</td><td>black</td><td>字体颜色</td></tr><tr><td>fillcolor</td><td></td><td>背景色</td></tr><tr><td>fontname</td><td>Times-Roman</td><td>字体</td></tr><tr><td>fontsize</td><td>14</td><td>字体大小</td></tr><tr><td>shape</td><td>ellipse</td><td>形状,box、ellipse、circle、diamond、plaintext、point、triangle、invtriangle</td></tr><tr><td>style</td><td></td><td>图形样式，eg. bold、dashed、dotted、filled</td></tr><tr><td>image</td><td></td><td>背景图片地址</td></tr></tbody></table></div><p>style设置节点样式(主要针对节点的边框的样式),shape设置节点形状.color设置边框颜色.</p><p>将节点shape设置为record,用 | 隔开的串会在绘制出来的节点中展现为一条分隔符，用 &lt;&gt; 括起来的串称为锚点</p><p>记录形式的节点也可以是竖形排列的。与横向排列的记录的不同只是label的形式不同，label中内容使用 {} 包围则是竖形排列的</p><h3 id="Edge"><a href="#Edge" class="headerlink" title="Edge"></a>Edge</h3><div class="table-container"><table><thead><tr><th>属性名</th><th>默认值</th><th>说明</th></tr></thead><tbody><tr><td>label</td><td></td><td>描述关系</td></tr><tr><td>color</td><td>black</td><td>箭头颜色</td></tr><tr><td>fontcolor</td><td>black</td><td>关系文字颜色</td></tr><tr><td>dir</td><td>forward</td><td>设置方向：forward,back,both,none</td></tr><tr><td>arrowhead</td><td>normal</td><td>箭头头部形状。box、crow、diamond、dot、none、normal、vee。箭头文档<a href="http://www.graphviz.org/content/arrow-shapes">点此</a></td></tr><tr><td>arrowtail</td><td></td><td>箭头尾部形状</td></tr><tr><td>arrowsize</td><td>1.0</td><td>箭头大小</td></tr><tr><td>style</td><td></td><td>图形样式，eg. bold、dashed、dotted、filled</td></tr><tr><td>lhead</td><td></td><td>当 compound 为true时，lhead用于指定边指向的cluster</td></tr><tr><td>ltail</td><td></td><td>与ltail类似</td></tr></tbody></table></div><p>设置边的属性,dir可以设置双向</p><h3 id="子图"><a href="#子图" class="headerlink" title="子图"></a>子图</h3><p>很多属性与图类似</p><p>子图名字要以cluster开头</p><p>边直接指向cluster，需要设置 compound 为true，并配合 lhead 或 ltail 来实现.</p><h3 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h3><p>全局生命的属性(例如node[…])只对声明语句后才创建的结构起作用.</p><p>看一个例子.</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">digraph G &#123;    </span><br><span class="line">  start -&gt; a0;</span><br><span class="line">  start -&gt; b0;</span><br><span class="line">  a1 -&gt; b3;</span><br><span class="line">  node[color=&quot;yellow&quot;];</span><br><span class="line">  b2 -&gt; a3;</span><br><span class="line">  a3 -&gt; a0;</span><br><span class="line">  a3 -&gt; end;</span><br><span class="line">  b3 -&gt; end; </span><br><span class="line">  start [shape=diamond];</span><br><span class="line">  end [shape=Msquare];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img data-src="http://cdn.sekyoro.top/imgs/image-20220402231223552.png" alt="image-20220402231223552"></p><p>可以看到b2,a3,end节点是黄色,而这三个节点是在声明语句后才创建的.</p><h2 id="实战"><a href="#实战" class="headerlink" title="实战"></a>实战</h2><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">digraph G &#123;</span><br><span class="line"></span><br><span class="line">  subgraph cluster<span class="built_in">_</span>0 &#123;</span><br><span class="line">    style=filled;</span><br><span class="line">    color=lightgrey;</span><br><span class="line">    node [style=filled,color=white];</span><br><span class="line">    a0 -&gt; a1 -&gt; a2 -&gt; a3;</span><br><span class="line">    label = &quot;process <span class="params">#1</span>&quot;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  subgraph cluster<span class="built_in">_</span>1 &#123;</span><br><span class="line">    node [style=filled];</span><br><span class="line">    b0 -&gt; b1 -&gt; b2 -&gt; b3;</span><br><span class="line">    label = &quot;process <span class="params">#2</span>&quot;;</span><br><span class="line">    color=blue</span><br><span class="line">  &#125;</span><br><span class="line">  start -&gt; a0;</span><br><span class="line">  start -&gt; b0;</span><br><span class="line">  a1 -&gt; b3;</span><br><span class="line">  b2 -&gt; a3;</span><br><span class="line">  a3 -&gt; a0;</span><br><span class="line">  a3 -&gt; end;</span><br><span class="line">  b3 -&gt; end;</span><br><span class="line"></span><br><span class="line">  start [shape=diamond];</span><br><span class="line">  end [shape=Msquare];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>首先digraph表示有向图,随后声明两个子图,然后node生命全局属性,然后节点连接.</p><p>然后在子图中声明节点属性和图的color属性.</p><h2 id="资料"><a href="#资料" class="headerlink" title="资料"></a>资料</h2><p><a href="https://www.cnblogs.com/shuqin/p/11897207.html">Graphviz 画图的一些总结 - 小胖西瓜 - 博客园 (cnblogs.com)</a></p><p><a href="https://itopic.org/graphviz.html">简介而全面的介绍</a></p><p><a href="https://blog.csdn.net/myRealization/article/details/119459490">【VS Code】Windows10下VS Code配置Graphviz和DOT语言环境_memcpy0的博客-CSDN博客</a>介绍了vscode上的几款插件,我建议下载可以直接导出pdf的.</p><p><a href="https://www.cnblogs.com/tshua/p/5932501.html">Cygwin、Msys、MinGW、Msys2的区别与联系(转) - 紫色年华 - 博客园 (cnblogs.com)</a></p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      
        <tags>
            
            <tag> 编译原理 </tag>
            
            <tag> graphviz </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Keras学习</title>
      <link href="2022/03/11/Keras%E5%AD%A6%E4%B9%A0/"/>
      <url>2022/03/11/Keras%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>因学习所需,使用这种东西研究机器学习,包括神经网络<br><span id="more"></span></p><h2 id="历史"><a href="#历史" class="headerlink" title="历史"></a>历史</h2><p>随着机器学习兴起,一堆框架跑出来.神经网咯也很火热.比如pytorch和tensorflow,Caffe啥的.</p><p>在深度学习中，像pytorch,tensorflow都是作为后备大引擎,进行计算.而Keras更像是调用api的.</p><blockquote><p><strong>Tensorflow位于较低级别：这是像MXNet、Theano和Pythorch这样的框架所在的位置。</strong>这是实现数学运算（如广义矩阵矩阵乘法）和神经网络原语（如卷积运算）的层次。</p><p><strong>Keras在更高的水平上。在这个层次上，较低层次的原语用于实现神经网络的抽象，如层次和模型。</strong>通常，在这个级别上，还实现了其他有用的API，如模型保存和模型培训。</p><p>在 v1.1.0 之前，Keras 的默认后端都是 Theano。与此同时，Google 发布了 TensorFlow，这是一个用于机器学习和神经网络训练的符号数学库。Keras 开始支持 TensorFlow 作为后端。渐渐地，TensorFlow 成为最受欢迎的后端，这也就使得 TensorFlow 从 Keras v1.1.0 发行版开始成为 Keras 的默认后端。</p></blockquote><h2 id="在官网学习"><a href="#在官网学习" class="headerlink" title="在官网学习"></a>在官网学习</h2><p><a href="https://tensorflow.google.cn/tutorials/keras/">tensorflow官网</a></p><p><a href="https://keras.io/zh/">keras</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install tensorflow</span><br></pre></td></tr></table></figure><p>tensorflow中有keras</p><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a href="https://cloud.tencent.com/developer/article/1552598">TensorFlow 2.0中的tf.keras和Keras有何区别？为什么以后一定要用tf.keras？ - 云+社区 - 腾讯云 (tencent.com)</a></p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      
        <tags>
            
            <tag> Keras </tag>
            
            <tag> tensorlow </tag>
            
            <tag> AI </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>汇编原理课程学习</title>
      <link href="2022/03/09/%E6%B1%87%E7%BC%96%E5%8E%9F%E7%90%86%E8%AF%BE%E7%A8%8B%E5%AD%A6%E4%B9%A0/"/>
      <url>2022/03/09/%E6%B1%87%E7%BC%96%E5%8E%9F%E7%90%86%E8%AF%BE%E7%A8%8B%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>课程作业</p><span id="more"></span><h2 id="1"><a href="#1" class="headerlink" title="1."></a>1.</h2><p>请自己编写的一个简单C语言例子（至少包括3个C文件、至少一个头文件；含有初始化全局变量、未初始化全局变量、函数内静态变量与局部变量、函数调用、if语句、while语句等），尽量不要包含第三方的头文件，按照预处理-&gt;编译-&gt;汇编-&gt;链接的操作过程，截图分析做成文档，分析源程序与可执行程序Section的对应关系，特别是数据与指令，通过分析阐述编译器的功能。着重分析LLVM的IR与源语句的对应关系。</p><h3 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h3><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Ubuntu 20.04.3   gcc 9.3.0</span><br></pre></td></tr></table></figure><p><img data-src="http://cdn.sekyoro.top/imgs/093035.png" alt="环境信息"></p><p><img data-src="http://cdn.sekyoro.top/imgs/image-20220113225054383.png" alt="gcc信息" style="zoom:67%;" /></p><h3 id="使用GCC"><a href="#使用GCC" class="headerlink" title="使用GCC"></a>使用GCC</h3><p>gcc具体使用参考教程.这里大概写一下</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">gcc -E <span class="comment">#预处理</span></span><br><span class="line">gcc -S <span class="comment">#进行编译</span></span><br><span class="line">gcc -c<span class="comment">#进行汇编,获得目标文件</span></span><br><span class="line">gcc -o <span class="comment"># -o本是指定输入文件名,不加参数直接进行链接</span></span><br></pre></td></tr></table></figure><p>注意,-Wall选项可以输出尽可能多的提示信息,建议每次都加上</p><p><strong>源文件 </strong> </p><p><img data-src="http://cdn.sekyoro.top/imgs/image-20220114125236250.png" alt="main源文件"></p><p>可以看到变量类型涉及到 全局变量,全局静态变量,局部变量和局部静态变量.</p><p>同时由引入的函数头文件,while和if结构. 先进行单个文件由.c-&gt;.i-&gt;.S-&gt;.o-&gt;可执行文件的过程.从中分析每个过程的变化以及一些信息.</p><h4 id="预处理"><a href="#预处理" class="headerlink" title="预处理"></a>预处理</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc -E -o main.i main.c -Wall</span><br></pre></td></tr></table></figure><p>可以看到main.c引入了一些头文件,主要是stdio.h,我们可以查看.i文件大小</p><p><img data-src="http://cdn.sekyoro.top/imgs/image-20220113225844722.png" alt="预处理文件大小变化" style="zoom:67%;" /></p><p>可以看到由原本467B变为17KB,可见文件中引入了许多信息,都是由宏处理的.</p><p><img data-src="http://cdn.sekyoro.top/imgs/image-20220114000424117.png" alt="预处理后的文件" style="zoom:67%;" /></p><blockquote><p>所谓预处理操作，主要是处理那些源文件和头文件中以 # 开头的命令（比如 #include、#define、#ifdef 等），并删除程序中所有的注释 // 和 /<em> … </em>/</p></blockquote><p>这一步没有太多要说的</p><h4 id="编译"><a href="#编译" class="headerlink" title="编译"></a>编译</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc -S -o main.S  main.i -Wall</span><br></pre></td></tr></table></figure><p><img data-src="http://cdn.sekyoro.top/imgs/image-20220114000538225.png" alt="编译" style="zoom:67%;" /></p><p>可以看到报了几个warning,这是因为局部变量如果没有初始化,它们是不会在.bss段的,而是在栈中<sup><a href="#fn_1" id="reffn_1">1</a></sup>,代码段中(局部变量是函数的变量,而函数在代码段中<sup><a href="#fn_2" id="reffn_2">2</a></sup>),也就是程序运行过程随着调用函数开栈,随着栈帧的创建而创建,随着函数结束生命周期也就结束了.(在当前gcc版本下),同时如果定义了但没有使用也会报warning.如果加了-O优化这种代码很可能被优化处理.</p><p>值得注意的是,代码段中也会存储一些const值.</p><blockquote><p><code>C语言</code>中定义的字符串常量</p><p><code>const型</code>常量：<code>C语言</code>中<code>const</code>关键字用来定义常量</p></blockquote><p>我们可以根据编译得到的汇编代码更加详细地查看．</p><p><img data-src="http://cdn.sekyoro.top/imgs/image-20220113232659992.png" alt="汇编代码" style="zoom:67%;" /></p><p>由于main.c文件写得有点复杂,这里挑重点说一下.</p><p>.file标识文件名 .text就是一个熟悉的重要的section,就是代码段.存着函数以及一些常量(比如c语言的字符串和const常量)</p><p>我发现这里有些符号没遇到过,网上搜索一番<sup><a href="#fn_3" id="reffn_3">3</a></sup>,而且貌似全局未初始化变量并没有直接放在.bss段的.</p><p>.comm表示的就是未初始化的全局变量.</p><p>可以得知g1是全局变量,因为是.comm(这与.lcomm都在链接后分配在.bss),</p><p>g2为20为全局变量(.global),.long 20.g3值为5,但可以看出其没有了.global,推测这是因为加了static导致,同时因为其进行了初始化,所以不会加在.bss段,即这里不会在.comm。</p><p>(.comm是未初始化全局变量,.lcomm是静态全局变量)可以这么简单理解</p><p>可以看出g4就是全局静态变量(.local)且未进行初始化.</p><p><strong>总结一下</strong></p><blockquote><p>g2和g3变量在*.S文件中差别是g2有 .global g2表示全局(全文件的作用域) g3没有.</p><p>表示全局变量加上static导致的作用域减小.即g2可以在其他文件中使用extern使用.</p><p>g2和g3都有type @object,都分配在.data段.表示经过了初始化,如果加了static作用域受限,没有.global.</p><p>g1和g4差别是g1是.comm,g4是.local .comm即.lcomm表示g1是未初始化的全局变量,链接后在.bss段,而g4是静态的未初始化全局变量,同理其作用域也是所在的文件,编译后也分配在.bss段.</p></blockquote><p><img data-src="http://cdn.sekyoro.top/imgs/065315.png" alt="静态局部变量"></p><p>而main函数中的变量,比如local1和local2是在栈中,在汇编代码中没有相关符号.</p><p>而两个静态局部变量 s_local3应该分配在.bss段,s_local4分配在.data段,因为其初始化过了.</p><blockquote><p>全局未初始化变量没有被放到任何段，而是作为未定义的COMMON符号。这个和不同语言、编译器实现有关，有的编译器放到.bss 段，有的仅仅是预留一个COMMON符号，在链接的时候再在.bss段分配预留空间。编译单元内部可见的静态变量，比如在上述中加上static的 static int global_static_var则确实被放到了.bss，是因为这个仅仅是编译单元内部可见</p><p>对于全局变量来说，如果初始化了不为0的值，那么该全局变量则被保存在data段，如果初始化的值为0，那么将其保存在bss段，如果没有初始化，则将其保存在common段，等到链接时再将其放入到BSS段。关于第三点不同编译器行为会不同，有的编译器会把没有初始化的全局变量直接放到BSS段</p></blockquote><p>.LC0等这些存储着字符串,这是固定值.还有一些汇编符号<sup><a href="#fn_4" id="reffn_4">4</a></sup>.值得注意的是,尽管这个汇编代码中没有.bss,但是.data中包含了.bss,.comm或.lcomm表示这个变量分配在.bss段</p><p><img data-src="http://cdn.sekyoro.top/imgs/065318.png" alt="bss段与data段描述"></p><p>从这个汇编代码得到的信息不太够.</p><p><img data-src="http://cdn.sekyoro.top/imgs/093121.png" alt="局部变量"></p><p>可以看到这里有movl $40 -8(%rbp)这其实就是int local1=40表示局部变量初始化.在这之前有 </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pushq %rbp</span><br><span class="line">movq %rsp %rbp</span><br><span class="line">subq $16 %rbp</span><br></pre></td></tr></table></figure><p>这其实就是栈帧的开始,表明局部变量(不是静态)分配在栈中(.data),而静态变量在编译时就有了.</p><h4 id="汇编"><a href="#汇编" class="headerlink" title="汇编"></a>汇编</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc -c -o main.o main.c -Wall -g</span><br></pre></td></tr></table></figure><p><img data-src="http://cdn.sekyoro.top/imgs/093122.png" alt="进行汇编"></p><p>得到目标文件<img data-src="http://cdn.sekyoro.top/imgs/065327.png" alt="查看信息"></p><p>注意格式relocatable,表示没有进行重定位.直接运行是有问题的,需要进行链接.</p><h5 id="objdump"><a href="#objdump" class="headerlink" title="objdump"></a>objdump</h5><p>使用objdump对于目标文件以及可执行文件进行反编译<sup><a href="#fn_8" id="reffn_8">8</a></sup>.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">objdump -f  <span class="comment">#file headers</span></span><br></pre></td></tr></table></figure><p><img data-src="http://cdn.sekyoro.top/imgs/093124.png" alt="文件头"></p><p>可以知道main.o目标文件是需要重定位且开始地址还未定.</p><p>main可执行文件程序开始地址已经定了.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">objdump -x  <span class="comment">#查看所有的头信息(文件头,section头,程序头(*.o文件没有程序头),符号表,重定位信息)</span></span><br></pre></td></tr></table></figure><p><strong>对于main.o文件</strong></p><p>section头</p><p><img data-src="http://cdn.sekyoro.top/imgs/093127.png" alt="节点头信息"></p><p>重点关注.text .data .bss .rodata.由于没有重定位,逻辑地址都是0</p><p>.text代码段,只读  .data数据段初始化全局变量(不管是否是static,如果加了static,则作用域减小). .bss未初始化段,包含未初始化的全局变量或者静态变量.</p><p>符号表</p><p><img data-src="http://cdn.sekyoro.top/imgs/093130.png" alt="符号表信息"></p><p>通过符号表可以更方便地查看某个量分配在哪个section.</p><p>由于这是main.o文件,没有进行链接,可以观察到后面几个函数都是und(undefined).</p><p>g3在.data段,g4在.bss段.s_local4在.data段,s_local3在.bss段</p><p>后面还有重定位记录,但是由于是main.o这些地址不是最终地址.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">objdump -s   <span class="comment">#查看所有内容 二进制</span></span><br><span class="line">objdump -d   <span class="comment">#反汇编 .text</span></span><br><span class="line">objdump -D   <span class="comment">#反汇编所有</span></span><br></pre></td></tr></table></figure><p>查看 .data段</p><p><img data-src="http://cdn.sekyoro.top/imgs/093132.png" alt=".data段内容"></p><p>可以看见.data都是初始化了的静态变量或全局变量.</p><p>局部变量加了static初始化后分配在.data</p><p>查看.bss</p><p><img data-src="http://cdn.sekyoro.top/imgs/093136.png" alt=".bss段信息"></p><p>.text段内容是main函数中的内容,局部变量在这.</p><p><img data-src="http://cdn.sekyoro.top/imgs/093137.png" alt=".text段内容"></p><p>将main.o反汇编后与main.S比较,可以看出main.S中值表示是十进制的,而反汇编后是16进制.</p><p>call指令跳转,在*.S中,直接指定跳转函数名,反汇编是指令相对地址</p><p>同时,如果使用.bss或.data的内容,会使用%RIP(指令地址)+偏移获得值.</p><p>在*.S文件中同样的使用符号表示偏移,即相对地址.</p><p>具体可以看这个例子</p><p><img data-src="http://cdn.sekyoro.top/imgs/065335.png" alt="变量"></p><p>可以看到,当把g1,g2全局变量(分配在.data或.bss段)进行运算时,利用%rip作为基址,变量名为偏移.同时可以看出 -4(%rbp)是d,-8(%rpb)是c,-12(%rbp)是a,-16(%rbp)是b.</p><p>gcc -c得到目标文件再反汇编可以看到</p><p><img data-src="http://cdn.sekyoro.top/imgs/093140.png" alt="image-20220114155704049"></p><p>可以看到这里地址是0x0(%rip),为什么是这样呢?推测这是因为目标文件没有进行重定位,所以这里的地址都是0,需要链接后才是真正的地址.</p><p>同时发现符号表中g1并没有在.bss段<img data-src="http://cdn.sekyoro.top/imgs/093142.png" alt="查看目标文件信息"></p><p>同时.bss段的大小也是0<img data-src="http://cdn.sekyoro.top/imgs/093145.png" alt="image-20220114160713548"></p><p>但是g1作为未初始化的全局变量,分配在.bss段,按理说.bss段大小不应该为0.这表明需要在链接后才能查看bss段大小(若有不对之处还望指出).</p><p>接下来分析这个程序的可执行文件的反汇编结果.<img data-src="http://cdn.sekyoro.top/imgs/093151.png" alt="可执行文件反汇编"></p><p>值得注意的是,链接后得到的文件.text段内容增加了一些动态库的信息.重定位文件*.o.text段开头简简单单的就是一个main函数.现在开头有一些初始化函数.</p><p>找到main<img data-src="http://cdn.sekyoro.top/imgs/093154.png" alt="可执行文件的反汇编"></p><p>可以明显看出g1,g2这种分配在.data或是.bss段的值由%rip作为基址(需要注意的是当我们执行一条指令时%rip的值已经是下一条指令的地址了)取引用.</p><p>0x113e+0x2eda = 0x4018</p><p><img data-src="http://cdn.sekyoro.top/imgs/093152.png" alt=".bss段"></p><p>根据得到的地址找到g1,发现这个地址下啥都没有,表明.bss段只记录地址.而值在每次运行时由os清零<sup><a href="#fn_5" id="reffn_5">5</a></sup>.</p><p>114c+2ec4 = 4010</p><p><img data-src="http://cdn.sekyoro.top/imgs/093158.png" alt="初始化全局变量"></p><p>可以在.data段下看到这个地址即对应的值 g2值为0x14.比较有意思的是,因为g2是4个字节.</p><p>所以表示为1400,然后因为是小段存放,所以低字节上的14先放,所以成了14 00,objdump就将这个14 00编码成了汇编代码,但是后面的adc $0x0,%al并不是正确要表达的意思.</p><p>call调用函数类似,在汇编代码中,call的调用是按照函数名称的,不是按照地址的.</p><p>在目标文件中(可重定位文件),call的相对地址是%RIP的值,即下一条指令的地址,显然这是有问题的.不符合实际情况.</p><p>在执行文件中偏移地址+%RIP,下一条指令地址加上偏移,这里不细说了.可以在.data中</p><p>注意在可重定位文件中,由于没有链接,用的函数是UND,且未初始化的全局变量是COM.</p><p>查看调用函数时跳转地址.</p><p><img data-src="http://cdn.sekyoro.top/imgs/093200.png" alt="函数跳转地址"></p><p>在符号表中查找,</p><p><img data-src="http://cdn.sekyoro.top/imgs/093203.png" alt="calc函数地址"></p><p>可以看到函数地址 0x13e9</p><p>也可以进行反编译,查看这个函数符号的代码.</p><p><img data-src="http://cdn.sekyoro.top/imgs/093205.png" alt="函数地址"></p><p>到这里基本的变量和符号(section和函数符号)就分析完了.</p><p>下面分析一下if和while得到的汇编代码.</p><p><strong>if代码</strong></p><p><img data-src="http://cdn.sekyoro.top/imgs/093207.png" alt="if汇编代码"></p><p>可以看到40与10比较,</p><blockquote><p>cmpl指令将两个操作数相减，但计算结果并不保存，只是根据计算结果改变eflags寄存器中的标志位。如果两个操作数相等，则计算结果为0，eflags中的ZF位置1.</p></blockquote><p>通过标志跳转.L2,再次体现了汇编代码通过符号跳转这个概念.</p><p><img data-src="http://cdn.sekyoro.top/imgs/093215.png" alt="while结构"></p><p>可以看到进入.L4后,与0比较,如果大于就跳转到.L5,.L5就是while中的语句,值减去10,再进入.L4进行判断.</p><p>分析重定位文件.</p><p><img data-src="http://cdn.sekyoro.top/imgs/093218.png" alt="重定位文件反汇编"></p><p>汇编代码中通过jle .L2符号跳转,而重定位文件中,通过函数内偏移,0x2c是跳转的对应的地址,因为是main.o目的文件,没有经过链接,没有重定位,所以地址都是相对的.链接后地址会变化.</p><p><img data-src="http://cdn.sekyoro.top/imgs/065337.png" alt="while结构汇编"></p><p>可以看到在while语句中,结束时会再次判断,根据结果再选择跳转.跳转地址是main内相对地址</p><p>对于可执行程序,反汇编得到.text段.</p><p><img data-src="http://cdn.sekyoro.top/imgs/093220.png" alt="可执行程序反汇编"></p><p>可以看到相对地址是没有变的,这表明在一个函数内的if,while等跳转遵循相对跳转,且相对地址没有变化,基址是函数地址.</p><p>如果是调用函数或者使用全局变量就是利用%RIP作为基址,在.data,.bss,.text段中找到数据.</p><p><img data-src="http://cdn.sekyoro.top/imgs/093222.png" alt="可执行文件符号表"></p><p>可以看见这些函数在.text段,可以得到它们的地址和大小.</p><p>分析ELF文件既可以用objdump也可以用readelf,不过这两个命令有一些差别.</p><p>使用</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">man readelf</span><br><span class="line">man objdump</span><br></pre></td></tr></table></figure><p>可以详细查看两者的命令参数.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">readelf -S  <span class="comment">#也可以查看section header</span></span><br></pre></td></tr></table></figure><p><img data-src="http://cdn.sekyoro.top/imgs/093224.png" alt="readelf查看节点头文件"></p><p>同时readelf -h可以查看文件头,从中可以知道section header和program header.</p><p><img data-src="http://cdn.sekyoro.top/imgs/093227.png" alt="readelf  -h"></p><p>可以看出main.o是没有程序头的.</p><p><img data-src="http://cdn.sekyoro.top/imgs/093231.jpg" alt="ELF文件"></p><p>上图是ELF文件视图</p><p>下面对可执行文件main分析</p><p><img data-src="http://cdn.sekyoro.top/imgs/093233.png" alt="main文件头"></p><p>可以看到有起始地址,而且是dynamic链接.</p><p>由于文件链接了很多其他文件,内容较多.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">objdump -x main <span class="comment">#查看所有头信息</span></span><br></pre></td></tr></table></figure><p>可以看到多个了program header</p><p><img data-src="http://cdn.sekyoro.top/imgs/093237.png" alt="可执行文件的程序头"></p><p>其中有段的地址.</p><p>此外由于链接了一些动态库,出现了dynamic section,不过这相对来说不重要.</p><p>关注Sections </p><p><img data-src="http://cdn.sekyoro.top/imgs/093242.png" alt="可执行文件的section表头"></p><p>可以看到已经有了地址和大小</p><p>另外也有符号表的信息</p><p><img data-src="http://cdn.sekyoro.top/imgs/093245.png" alt="可执行文件符号表"></p><p>注意到重定位信息已被删去<sup><a href="#fn_9" id="reffn_9">9</a></sup></p><h4 id="函数的调用和返回"><a href="#函数的调用和返回" class="headerlink" title="函数的调用和返回"></a>函数的调用和返回</h4><p>这方面的内容我在做cmu的炸弹实验已经了解过了(自我认为).可以查看网站上的之前文章.</p><p>现在在windows上直接使用MinGW.</p><p>源文件很简单</p><p><img data-src="http://cdn.sekyoro.top/imgs/image-20220402210438375.png" alt="源文件"></p><p>scanf函数调用了八个参数,一个字符串以及7个数.</p><p><img data-src="http://cdn.sekyoro.top/imgs/image-20220402210354837.png" alt="反汇编main" style="zoom:67%;" /></p><p>在.rodata中的就是字符串,利用%rcx传参,n1在%eax上.</p><p>有意思的是在Linux的gcc上并不是这样</p><p><img data-src="http://cdn.sekyoro.top/imgs/image-20220402210533785.png" alt="linux下" style="zoom:67%;" /></p><p>鉴于这并不直观,看一下另一个源文件。</p><p><img data-src="http://cdn.sekyoro.top/imgs/image-20220402210919739.png" alt="另一个源文件" style="zoom:67%;" /></p><p>反编译得到结果</p><p><img data-src="http://cdn.sekyoro.top/imgs/image-20220402210950053.png" alt="反汇编结果" style="zoom:67%;" /></p><p>我们传参是1,2..8. 其首先从最后一个参数开始,有六个寄存器用于传参(64位下),多余的传入栈中.</p><p>在这里push两个值,剩余的六个值用寄存器传参.即以$rdi,%rsi,%rdx,%rcx寄存器的顺序</p><p>在这里,值6直接传到%r9d,注意%r9d就是低32位的%r9.</p><p>同理,其余值也依次传到寄存器中.</p><p><img data-src="http://cdn.sekyoro.top/imgs/image-20220402211606553.png" alt="被调用函数" style="zoom:67%;" /></p><p>可以看到函数中先开栈,然后依次将1,2..的值从寄存器中使用.</p><p><a href="https://www.jianshu.com/p/57128e477efb">寄存器</a>这个网站简洁分析了各个寄存器.</p><blockquote><p><strong>结论</strong>：当参数个数小于等于6个时，使用寄存器<strong>rdi,rsi,rdx,rcx,r8,r9，从第7个参数开始通过栈传递，顺序为从右往左入栈。</strong></p></blockquote><h3 id="LLVM"><a href="#LLVM" class="headerlink" title="LLVM"></a>LLVM</h3><p>传统的编译器是前端,优化(可选),后端.在某些书中也称为analysis和synthetic.</p><p><img data-src="http://cdn.sekyoro.top/imgs/093248.jpg" alt="传统编译器架构"></p><p>LLVM本身并不是一个编译器,它是一种架构.</p><p><img data-src="http://cdn.sekyoro.top/imgs/093249.jpg" alt="LLVM架构"></p><p>编译器根据前端生成的AST(抽象语法树)得到一种中间语言,对IR进行优化后由后端生成对应的机器代码.</p><blockquote><p>IR可以说是集中体现了这款编译器的特征—-他的算法，优化方式，汇编流程等等，想要完全掌握某种编译器的工作和运行原理，分析和学习这款编译器的中间语言无疑是重要手段，另外，由于中间语言相当于一款编译器前端和后端的“桥梁”</p><p>对于现代编译器来说，编译器前端和后端分别指分析输入源语言和生成目标平台汇编代码的两编译阶段，大部分现代编译器在前端和后端之间会有个中间表示层。有了一个设计良好的中间表示，有m种前端编程语言（C\C++、Fortran、Ada、Java等）和n种后端平台（x86、MIPS、Sparc、ARM等）的编译器设计，这样就减少了为了设计m中语言和n个平台从而设计m*n个编译器设计</p></blockquote><p>同时LLVM可以提供优化算法,在优化时可以将其提供的算法链接进来.</p><p><a href="https://www.cnblogs.com/zuopeng/p/4141467.html">LLVM和GCC的区别</a></p><p>GCC的中间语言RTL形式.</p><p><a href="https://blog.csdn.net/sonicling/article/details/7915301">GCC源码分析</a></p><blockquote><p>gimple和RTL是gcc用来表示指令的两种形式。因此每个基本块都包含有两组指令序列，一组是gimple指令，一组是RTL指令。每个函数将首先被gimple化，此时基本块里只包含gimple指令，之后由gimple生成RT</p></blockquote><p><a href="https://blog.csdn.net/u012150792/article/details/50651743">GENERIC，GIMPLE和RTL</a></p><p><a href="https://blog.csdn.net/u012491514/article/details/25000519">gcc编译器——中间表示</a></p><blockquote><p>中间表示RTL：RTL叫做“寄存器转移语言”（Register Transfer Language），它是以一种虚拟寄存器（pseudo register）的方式来叙述计算机行为的语言。RTL 是一种接近机器指令的语言，既有指令序列组成的内部形式，又有机器描述和调试信息组成的文本形式。</p></blockquote><p><img data-src="http://cdn.sekyoro.top/imgs/093251.jpg" alt="LLVM"></p><h4 id="对于GCC"><a href="#对于GCC" class="headerlink" title="对于GCC"></a>对于GCC</h4><p>gcc的设计并不是教科书般的,它的前端和后端也并没有那么明确.</p><p>使用命令</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc -S fdump-tree-all main.c</span><br></pre></td></tr></table></figure><p>得到一大堆文件.</p><p><img data-src="http://cdn.sekyoro.top/imgs/065338.png" alt="结果"></p><p>这些都是中间文件,我们看看cfg和ssa.</p><p>我的源文件</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//main.c</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;add.h&quot;</span></span></span><br><span class="line"><span class="keyword">int</span> g1 = <span class="number">10</span>;</span><br><span class="line"><span class="keyword">int</span> g2;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> a = <span class="number">10</span>;</span><br><span class="line">        <span class="keyword">int</span> c;</span><br><span class="line">        c =  add(a,g1);</span><br><span class="line">        c = ADD(c,g2);</span><br><span class="line">        <span class="keyword">return</span> c;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="CFG文件"><a href="#CFG文件" class="headerlink" title="CFG文件"></a>CFG文件</h5><p>cfg是控制流图.</p><blockquote><p>每个函数翻译为GENERIC的语法树之后，会进行gimplification，在这一过程中函数的语法树被翻译为了控制流图的形式。每个函数对应一个控制流图</p></blockquote><p><img data-src="http://cdn.sekyoro.top/imgs/065339.png" alt="cfg中间文件"></p><p>可以看到有很多cfg中间文件,应该是经过了多次处理.</p><p><img data-src="http://cdn.sekyoro.top/imgs/093252.png" alt="不同的cfg文件对比"></p><h5 id="SSA文件"><a href="#SSA文件" class="headerlink" title="SSA文件"></a>SSA文件</h5><blockquote><p>SSA 形式的 IR 主要特征是每个变量只赋值一次。相比而言，非 SSA 形式的 IR 里一个变量可以赋值多次。为了得到 SSA 形式的 IR，起初的 IR 中的变量会被分割成不同的版本（version），每个定义（definition：静态分析术语，可以理解为赋值）对应着一个版本.</p><p>把程序转换为 SSA 形式，最简单的方法就是将每个被赋值的变量用一个新的变量（版本）来取代，同时将每次使用的变量替换为这个变量到达该程序点的“”版本”</p></blockquote><p>可以看到有两个ssa中间文件</p><p><img data-src="http://cdn.sekyoro.top/imgs/065345.png" alt="ssa文件"></p><p>值得一提的是前面这个ssa文件与最新的cfg文件是相同的.而这个release版的ssa文件只增加了一些东西</p><p><img data-src="http://cdn.sekyoro.top/imgs/065347.png" alt="ssa增加的东西"></p><p>这表明ssa过程并没有改变什么(当然只是针对我这个源文件而言)</p><p>对于gcc的中间语言就不做分析了.</p><h4 id="对于clang"><a href="#对于clang" class="headerlink" title="对于clang"></a>对于clang</h4><p>以LLVM为后端的是苹果的clang编译器,其作为前端<sup><a href="#fn_10" id="reffn_10">10</a></sup>.</p><p>clang优点</p><blockquote><p>编译速度快:在某些平台上，Clang的编译速度显著的快过GCC(Debug模式下编译OC速度比GGC快3倍)</p><p>占用内存小:Clang生成的AST所占用的内存是GCC的五分之一左右</p><p>模块化设计:Clang采用基于库的模块化设计，易于 IDE 集成及其他用途的重用</p><p>诊断信息可读性强:在编译过程中，Clang 创建并保留了大量详细的元数据 (metadata)，有利于调试和错误报告</p><p>设计清晰简单，容易理解，易于扩展增强</p></blockquote><p>在Linux或者其他平台上需要自己安装.苹果上应该是自带的.</p><p><a href="https://buaa-se-compiling.github.io/miniSysY-tutorial/pre/llvm_download.html">LLVM 工具链下载 · GitBook (buaa-se-compiling.github.io)</a></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install llvm</span><br><span class="line">sudo apt-get install clang</span><br></pre></td></tr></table></figure><p>Ubuntu 20.04.</p><p>继续用刚才的源程序分析.</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">clang -emit-llvm -S -o main.ll main.c</span><br></pre></td></tr></table></figure><p><img data-src="http://cdn.sekyoro.top/imgs/093254.png" alt="得到ll文件"></p><p><img data-src="http://cdn.sekyoro.top/imgs/093257.png" alt="ll中间文件"></p><p>下面来分析一下这个IR代码.</p><blockquote><p><code>arget triple</code> 与 <code>target datalayout</code> 是程序的标签属性说明 </p><p>align<code>字段描述了程序的对齐属性</code>；<br><code>dso_local</code> 是变量和函数的的运行时抢占说明符` dso_local 是一个<strong>Runtime Preemption</strong>,表明该变量会在同一个链接单元内解析符号</p><p>; 开头的字符串是 LLVM IR 的注释</p></blockquote><p>根据源程序我们知道g1,g2是全局变量.且g1进行了初始化,g2没有所以分配在.bss段</p><p>在ll文件中 所有的全局变量都以 @ 为前缀，后面的 global 关键字表明了它是一个全局变量.</p><p>i32显而易见表示32位整数.后面跟着值. align表示对齐字节数.</p><p>common表示的是未初始化的全局变量.</p><p>这几行语句就是声明与初始化全局变量</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> g1 = <span class="number">10</span>;</span><br><span class="line"><span class="keyword">int</span> g2;</span><br></pre></td></tr></table></figure><p><strong>对于main函数</strong></p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">define dso<span class="built_in">_</span>local i32 @main() <span class="params">#0</span> &#123;</span><br><span class="line">  <span class="comment">%1 = alloca i32, align 4</span></span><br><span class="line">  <span class="comment">%2 = alloca i32, align 4</span></span><br><span class="line">  <span class="comment">%3 = alloca i32, align 4</span></span><br><span class="line">  store i32 0, i32* <span class="comment">%1, align 4</span></span><br><span class="line">  store i32 10, i32* <span class="comment">%2, align 4</span></span><br><span class="line">  <span class="comment">%4 = load i32, i32* %2, align 4</span></span><br><span class="line">  <span class="comment">%5 = load i32, i32* @g1, align 4</span></span><br><span class="line">  <span class="comment">%6 = call i32 @add(i32 %4, i32 %5)</span></span><br><span class="line">  store i32 <span class="comment">%6, i32* %3, align 4</span></span><br><span class="line">  <span class="comment">%7 = load i32, i32* %3, align 4</span></span><br><span class="line">  <span class="comment">%8 = load i32, i32* @g2, align 4</span></span><br><span class="line">  <span class="comment">%9 = add nsw i32 %7, %8</span></span><br><span class="line">  store i32 <span class="comment">%9, i32* %3, align 4</span></span><br><span class="line">  <span class="comment">%10 = load i32, i32* %3, align 4</span></span><br><span class="line">  ret i32 <span class="comment">%10</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可以看出 main函数返回值是一个32位整数(就是c语言中的int).</p><p>ret i32 %10表明返回一个值存储在%10(类似寄存器),其类型为int.</p><blockquote><p>一个函数定义的最简单的语法形如 <code>define + 返回值 (i32) + 函数名 (@foo) + 参数列表 ((i32 %a,i32 %b)) +函数体 (&#123;ret i32 0&#125;)</code></p></blockquote><p>这里的 <code>#0</code> 与<code>main.ll</code>中靠后的<code>attributes #0 = ...</code>是对应的，他们被用来给函数加上特定的标记，例如是否是能够被内联。</p><p><img data-src="http://cdn.sekyoro.top/imgs/093259.png" alt="func attribute"></p><p>表示的是main函数的特性,比如noinline是不进行内联.说实话,这里有点复杂而且没必要进一步阐述了.可以查阅官方文档<a href="https://llvm.org/docs/LangRef.html#function-attributes">LLVM Language Reference Manual — LLVM 15.0.0git documentation</a></p><p>接下来分析main函数内部</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">%1 = alloca i32, align 4</span></span><br><span class="line">  <span class="comment">%2 = alloca i32, align 4</span></span><br><span class="line">  <span class="comment">%3 = alloca i32, align 4</span></span><br><span class="line">  store i32 0, i32* <span class="comment">%1, align 4</span></span><br><span class="line">  store i32 10, i32* <span class="comment">%2, align 4</span></span><br></pre></td></tr></table></figure><p>alloca表示分配空间,i32类型 4字节对齐</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">以 <span class="comment">% 开头的符号表示虚拟寄存器，你可以把它当作一个临时变量（与全局变量相区分），或称之为临时寄存器</span></span><br></pre></td></tr></table></figure><p>其余同理.</p><p>store i32 0表示将0存入%1. i32*表示i32类型内存的值,是一个地址.类似指针的感觉.</p><p>store i32 10类似将10存入另一个寄存器.</p><p>这几行语句类似main函数中</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> a = <span class="number">10</span>;</span><br><span class="line"><span class="keyword">int</span> c;</span><br></pre></td></tr></table></figure><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">%4 = load i32, i32* %2, align 4   //1</span></span><br><span class="line">  <span class="comment">%5 = load i32, i32* @g1, align 4  //2</span></span><br><span class="line">  <span class="comment">%6 = call i32 @add(i32 %4, i32 %5)  //3</span></span><br><span class="line">  store i32 <span class="comment">%6, i32* %3, align 4   //4</span></span><br><span class="line">  <span class="comment">%7 = load i32, i32* %3, align 4  //5</span></span><br><span class="line">  <span class="comment">%8 = load i32, i32* @g2, align 4 //6</span></span><br><span class="line">  <span class="comment">%9 = add nsw i32 %7, %8  //7</span></span><br></pre></td></tr></table></figure><p>第一行表示 从 %2（i32*）中 load 出一个值（类型为 i32），这个值的名字为 %4</p><p>第二行表示将全局变量g1赋值给%5.  第三行表示执行call函数.call函数声明在后面,顺便实参是%4与%5.</p><p>第四行表示将上一行得到的结果存入%3. 第5行表示将%3结果load出给%7.</p><p>第六行表示将全局变量g2赋给%8. 关于nsw查阅官方文档.表示不进行有符号转换.即无符号运算.</p><blockquote><p><code>nuw</code> and <code>nsw</code> stand for “No Unsigned Wrap” and “No Signed Wrap”, respectively. If the <code>nuw</code> and/or <code>nsw</code> keywords are present, the result value of the <code>add</code> is a <a href="https://llvm.org/docs/LangRef.html#poisonvalues">poison value</a> if unsigned and/or signed overflow, respectively, occurs.</p><p>A poison value is a result of an erroneous operation.</p></blockquote><p>所以第七行表示将%7和%8值相加赋给%9.</p><p>接着将%9的值存入%3.再将%3的值load给%10.然后返回%10.</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">store i32 <span class="comment">%9, i32* %3, align 4</span></span><br><span class="line"> <span class="comment">%10 = load i32, i32* %3, align 4</span></span><br><span class="line"> ret i32 <span class="comment">%10</span></span><br></pre></td></tr></table></figure><p>这样main函数中代码说明完了.</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">declare dso<span class="built_in">_</span>local i32 @add(i32, i32) <span class="params">#1</span></span><br></pre></td></tr></table></figure><p>表示声明函数add. add有两个参数均为i32类型.</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">!llvm.module.flags = !&#123;!0&#125;</span><br><span class="line">!llvm.ident = !&#123;!1&#125;</span><br><span class="line"></span><br><span class="line">!0 = !&#123;i32 1, !&quot;wchar<span class="built_in">_</span>size&quot;, i32 4&#125;</span><br><span class="line">!1 = !&#123;!&quot;clang version 10.0.0-4ubuntu1 &quot;&#125;</span><br></pre></td></tr></table></figure><p>这些就是一些信息了,不用在意.</p><p>LLVM中也有SSA.</p><blockquote><p>在 LLVM IR 中，变量是以 SSA 形式存在的，为了生成正确的 LLVM IR 并实现我们的实验，对 SSA 的知识是必不可少的，LLVM IR 的代码有两种状态，分别是存取内存形式的 IR 以及带有 <code>phi</code> 指令的 SSA IR</p></blockquote><p>我们其实可以看出LLVM的IR与汇编代码还是有很大类似之处的,不过IR需要SSA.即程序中的每个变量都有且只有一个赋值语句,这是比较大的差别.</p><p>再看一下分支和循环语句的IR.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;add.h&quot;</span></span></span><br><span class="line"><span class="keyword">int</span> g1 = <span class="number">10</span>;</span><br><span class="line"><span class="keyword">int</span> g2;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> a = <span class="number">10</span>;</span><br><span class="line">        <span class="keyword">int</span> c;</span><br><span class="line">        <span class="keyword">if</span>(a&lt;<span class="number">5</span>)</span><br><span class="line">        &#123;</span><br><span class="line">                c = <span class="number">2</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span>(a&gt;<span class="number">5</span>)</span><br><span class="line">        &#123;</span><br><span class="line">                a = a<span class="number">-5</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>看一下得到的ll文件</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">define dso<span class="built_in">_</span>local i32 @main() <span class="params">#0</span> &#123;</span><br><span class="line">  <span class="comment">%1 = alloca i32, align 4 //分配空间i32</span></span><br><span class="line">  <span class="comment">%2 = alloca i32, align 4</span></span><br><span class="line">  <span class="comment">%3 = alloca i32, align 4</span></span><br><span class="line">  store i32 0, i32* <span class="comment">%1, align 4 //赋值 0    c</span></span><br><span class="line">  store i32 10, i32* <span class="comment">%2, align 4 //赋值10   a</span></span><br><span class="line">  <span class="comment">%4 = load i32, i32* %2, align 4 //将%2所存的值赋给%4  t=a</span></span><br><span class="line">  <span class="comment">%5 = icmp slt i32 %4, 5 //icmp就是有符号比较 即%4与5比较如果%4小于5则slt=1</span></span><br><span class="line">  br i1 <span class="comment">%5, label %6, label %7 //i1表示一个类型即%5 比较%5是否为1,若是则跳转%6否则跳%7</span></span><br><span class="line"></span><br><span class="line">6:                                                ; preds = <span class="comment">%0</span></span><br><span class="line">  store i32 2, i32* <span class="comment">%3, align 4 //即c语言c=2</span></span><br><span class="line">  br label <span class="comment">%7//跳出 至此if分支语句结束</span></span><br><span class="line"></span><br><span class="line">7:                                                ; preds = <span class="comment">%6, %0</span></span><br><span class="line">  br label <span class="comment">%8// a&gt;=5跳转到这</span></span><br><span class="line"></span><br><span class="line">8:                                                ; preds = <span class="comment">%11, %7</span></span><br><span class="line">  <span class="comment">%9 = load i32, i32* %2, align 4 //将%2赋值给%5 t = a</span></span><br><span class="line">  <span class="comment">%10 = icmp sgt i32 %9, 5 // 又是进行比较sgt与slt相反 大于则置为1  t&gt;5</span></span><br><span class="line">  br i1 <span class="comment">%10, label %11, label %14 //如果%10=1则跳转到11处否则跳转14处</span></span><br><span class="line"></span><br><span class="line">11:                                               ; preds = <span class="comment">%8</span></span><br><span class="line">  <span class="comment">%12 = load i32, i32* %2, align 4 //t&gt;5则跳转到这 将%2赋给%12  t2 = a</span></span><br><span class="line">  <span class="comment">%13 = sub nsw i32 %12, 5 //t3 = t2-5</span></span><br><span class="line">  store i32 <span class="comment">%13, i32* %2, align 4 // a = t3</span></span><br><span class="line">  br label <span class="comment">%8</span></span><br><span class="line"></span><br><span class="line">14:                                               ; preds = <span class="comment">%8</span></span><br><span class="line">  ret i32 0</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>slt在mips指令集有解释 </p><blockquote><p>如果第一个源寄存器的内容小于第二个源寄存器的内容，则 SLT 指令将目标寄存器的内容设置为值 1。 否则，它被设置为值 0。</p></blockquote><p>br<code>指令的语法为</code>br + 标志位 + truelabel + falselabel<code>，或者</code>br + label.是跳转指令.</p><p>如注释.</p><h4 id="update"><a href="#update" class="headerlink" title="update"></a>update</h4><p>现在更新一下clang对于一个源程序文件的整体编译过程.之前只分析了前端.</p><p>clang的官方文档还是有点复杂.</p><p><code>-fmodules</code>:启用“模块”语言功能。关于<code>Modules</code>特性，详见<a href="https://links.jianshu.com/go?to=https%3A%2F%2Fclang.llvm.org%2Fdocs%2FModules.html%23introduction">此处</a>，大意为使用<code>import</code>代替<code>include</code>，编译速度快。</p><p><code>-fsyntax-only</code>:运行预处理器，解析器和类型检查阶段。</p><p><code>-Xclang &lt;arg&gt;</code>:传递参数到<code>clang</code>的编译器。</p><p><code>dump-tokens</code>:运行预处理器，转储<code>Token</code>的内部表示</p><p>这里参照博客<a href="https://www.jianshu.com/p/2da08634b53a">编译器与Clang编译过程 - 简书 (jianshu.com)</a>看一下clang的使用</p><h5 id="预处理-1"><a href="#预处理-1" class="headerlink" title="预处理"></a>预处理</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">clang -E test.c</span><br></pre></td></tr></table></figure><p>预处理</p><blockquote><p>1、删除所有的#define，代码中使用宏定义的地方会进行替换</p><p>2、将#include包含的文件插入到文件的位置，这个插入的过程是递归的</p><p>3、删除掉注释符号及注释</p><p>4、添加行号和文件标识，便于调试</p></blockquote><p>查看文件发现前几行都是注释,大致是包含一些文件路径.再下面是typedef定义变量.</p><p>还定义了一些结构体,声明了函数.最后是源代码</p><p><img data-src="http://cdn.sekyoro.top/imgs/image-20220402215053078.png" alt="预处理文件"></p><h5 id="分析词法功能"><a href="#分析词法功能" class="headerlink" title="分析词法功能"></a>分析词法功能</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">clang -fsyntax-only -Xclang -dump-tokens test.c</span><br></pre></td></tr></table></figure><p>这一步顾名思义是词法分析,得到valueType value loc这样形式的数据</p><p>有标识符identifier类型,有comma逗号类型,const类型等等</p><p><img data-src="http://cdn.sekyoro.top/imgs/image-20220402215528693.png" alt="词法分析得到元组"></p><p>处理文件后可以得到三元组,即属性,值以及位置.</p><ul><li><code>Sourece Location</code>：表示<code>Token</code>开始的位置，比如：<code>Loc=&lt;main.m:11:5&gt;</code>；</li><li><code>Token Kind</code>：表示<code>Token</code>的类型，比如：<code>identifier</code>、<code>numeric_constant</code>、<code>string_literal</code>；</li><li><code>Flags</code>：词法分析器和处理器跟踪每个<code>Token</code>的基础，目前有四个<code>Flag</code>分别是：</li></ul><ol><li><code>StartOfLine</code>：表示这是每行开始的第一个<code>Token</code>；</li><li><code>LeadingSpace</code>：当通过宏扩展<code>Token</code>时，在<code>Token</code>之前有一个空格字符。该标志的定义是依据预处理器的字符串化要求而进行的非常严格地定义。</li><li><code>DisableExpand</code>：该标志在预处理器内部使用，用来表示<code>identifier</code>令牌禁用宏扩展。</li><li><code>NeedsCleaning</code>：如果令牌的原始拼写包含三字符组或转义的换行符，则设置此标志</li></ol><h5 id="分析语法产生出的抽象语法树"><a href="#分析语法产生出的抽象语法树" class="headerlink" title="分析语法产生出的抽象语法树"></a>分析语法产生出的抽象语法树</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">clang -fsyntax-only -Xclang -ast-dump test.c</span><br></pre></td></tr></table></figure><blockquote><p>-ast-dump: Build ASTs and then debug dump them</p><p>表示生成抽象语法树</p></blockquote><p><img data-src="http://cdn.sekyoro.top/imgs/image-20220402220439060.png" alt="语法分析后的抽象语法树" style="zoom: 50%;" /></p><p>很好,我并不是和能看懂这个东西.</p><p><a href="https://links.jianshu.com/go?to=https%3A%2F%2Fclang.llvm.org%2Fdoxygen%2Fclassclang_1_1Type.html">Type</a> ：表示类型，比如<code>BuiltinType</code></p><p><a href="https://links.jianshu.com/go?to=https%3A%2F%2Fclang.llvm.org%2Fdoxygen%2Fclassclang_1_1Decl.html">Decl</a> ：表示一个声明<code>declaration</code>或者一个定义<code>definition</code>，比如：变量，函数，结构体，<code>typedef</code>；</p><p><a href="https://links.jianshu.com/go?to=https%3A%2F%2Fclang.llvm.org%2Fdoxygen%2Fclassclang_1_1DeclContext.html">DeclContext</a> ：用来声明表示上下文的特定<code>decl</code>类型的基类；</p><p><a href="https://links.jianshu.com/go?to=https%3A%2F%2Fclang.llvm.org%2Fdoxygen%2Fclassclang_1_1Stmt.html">Stmt</a> ：表示一条陈述<code>statement</code>;</p><p><a href="https://links.jianshu.com/go?to=https%3A%2F%2Fclang.llvm.org%2Fdoxygen%2Fclassclang_1_1Expr.html">Expr</a>：在<code>Clang</code>的语法树中也表示一条陈述<code>statements</code>;</p><h5 id="中间代码生成"><a href="#中间代码生成" class="headerlink" title="中间代码生成"></a>中间代码生成</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">clang -S -emit-llvm -o test.ll test.c</span><br></pre></td></tr></table></figure><p>这个中间代码之前已经分析过了<a href="#IR分析">点击查看</a></p><p><img data-src="http://cdn.sekyoro.top/imgs/image-20220402222535565.png" alt="IR代码"></p><p>这是f函数的中间代码,i32表示类型,align表示对齐.alloca分配空间,store存储值.</p><h5 id="汇编语言生成"><a href="#汇编语言生成" class="headerlink" title="汇编语言生成"></a>汇编语言生成</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">llc test.ll -o test.s</span><br></pre></td></tr></table></figure><p>汇编语言生成</p><p><img data-src="http://cdn.sekyoro.top/imgs/image-20220402223339213.png" alt="image-20220402223339213"></p><p>到这一步生成汇编代码与及其相关,就没有太多可以说了.</p><h5 id="可执行程序生成"><a href="#可执行程序生成" class="headerlink" title="可执行程序生成"></a>可执行程序生成</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">clang test.s -o <span class="built_in">test</span></span><br></pre></td></tr></table></figure><p><img data-src="http://cdn.sekyoro.top/imgs/image-20220402223551048.png" alt="生成可执行程序"></p><h5 id="反汇编程序"><a href="#反汇编程序" class="headerlink" title="反汇编程序"></a>反汇编程序</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">objdump -dS <span class="built_in">test</span></span><br><span class="line">clang -g -o <span class="built_in">test</span> test.c</span><br></pre></td></tr></table></figure><p>clang -g -o test test.c可以直接生成目标程序.</p><p><img data-src="http://cdn.sekyoro.top/imgs/image-20220402223849933.png" alt="反汇编可执行程序"></p><p>objdump -S命令可以显示源代码,但需要编译时加上-g</p><p>使用clang -g test.c -o test得到的可执行程序反汇编.</p><p><img data-src="http://cdn.sekyoro.top/imgs/image-20220402224120628.png" alt="image-20220402224120628" style="zoom:67%;" /></p><p>可以看到这里有更多的调试信息.</p><h2 id="2"><a href="#2" class="headerlink" title="2."></a>2.</h2><p>对所编写的例子尝试编写一个Makefile文件,然后进行make编译,然后通过make -j #n来编译,也可采用cmake.证明并行编译确实提高了.</p><p>makefile编写本身就遵循一定技巧,好的makefile能让人一眼看上去知道规则.由于我编写的比较少,makefile写的不是很好,但是勉强能用.</p><h3 id="make并行编译"><a href="#make并行编译" class="headerlink" title="make并行编译"></a>make并行编译</h3><p><img data-src="http://cdn.sekyoro.top/imgs/093301.png" alt="Makefile"></p><p>重点关注编译,即build这一行.进行了main.c主文件的编译以及引入的其他五个c文件的编译</p><p><img data-src="http://cdn.sekyoro.top/imgs/093303.png" alt="make编译"></p><p>time命令可以得到运行时间<sup><a href="#fn_6" id="reffn_6">6</a></sup>,0.08s是执行用户态代码所耗费的 CPU 时间</p><p>0.19s是内核态运行所耗费的CPU时间,0.592包括了阻塞时间和其他进程耗费时间</p><p>每次编译时间或多说少有一点差异,</p><p><img data-src="http://cdn.sekyoro.top/imgs/093305.png" alt="再次进行编译"></p><p>但基本上用户态时间0.1s左右,管态时间要多一点</p><p>可以看见make -j 3,并行三条指令编译时间减少了.</p><p>看来编译的任务还不够多,于是我又增加了几个个源文件进行编译,每个源文件代码二三十行也不算多.</p><p><img data-src="http://cdn.sekyoro.top/imgs/093307.png" alt="make并行编译"></p><p>可以看到时间减少了,但不是很明显.可能是因为我用的虚拟机,分配的cpu与实机有一定差别.</p><p>我在windows上的测试.</p><p><img data-src="http://cdn.sekyoro.top/imgs/093309.png" alt="image-20220114212732480"></p><p>进行并行编译</p><p><img data-src="http://cdn.sekyoro.top/imgs/093311.png" alt="make并行编译"></p><p>可以看到时间由用户态的0.03s-&gt;0.015s,可以说明并行编译时间变短了.</p><h3 id="update-1"><a href="#update-1" class="headerlink" title="update"></a>update</h3><p>由于之前做的编译量有一点少,运行时间太短以及测试次数不够.这里继续做一下补充.</p><p>我继续增加源文件的代码量.</p><p>由于我使用的是虚拟机,查看我主机电脑配置信息6核cpu.</p><p>所以这里我设置虚拟机分配了3个虚拟cpu.</p><p>同时我增加了一些代码,当时并不是很多.</p><p>可惜的是还是因为代码量不够的原因导致差别不是很大.考虑到make -j使用多处理器并行,所以time命令结果看total time更合适.因为使用并行减少时间</p><p><img data-src="http://cdn.sekyoro.top/imgs/093312.png" alt="编译1"></p><p>由于代码还是写的不规范,有warning不过不影响</p><p><img data-src="http://cdn.sekyoro.top/imgs/093315.png" alt="编译结果"></p><p>make -j2  make -j3 make -j6</p><p><img data-src="http://cdn.sekyoro.top/imgs/065348.png" alt="-j2"></p><p><img data-src="http://cdn.sekyoro.top/imgs/065351.png" alt="-j2编译结果"></p><p><img data-src="http://cdn.sekyoro.top/imgs/093317.png" alt="-j3编译结果"></p><p><img data-src="http://cdn.sekyoro.top/imgs/065353.png" alt="-j6编译结果"></p><p>进行了7组实验,根据total时间结果,也就是进程从开始到结束所用的实际时间。这个时间包括其他进程使用的时间片和进程阻塞的时间.因为使用了多处理器并行处理编译.</p><p><img data-src="http://cdn.sekyoro.top/imgs/093318.png" alt="试验结果"></p><p>但是user时间也就是用户态时间并没有明显变化.<del>估计是代码还是不够</del></p><p><img data-src="http://cdn.sekyoro.top/imgs/093319.png" alt="sys+usr时间"></p><p>经过我的考虑,认为make -j本是是让多个cpu内核并行处理指令,这也不意味着优化.即usr+sys时间变化不大是正常的,real时间即总时间(包括其他进程及IO)应该变化,因为多个cpu并行就像多个人一起干同一件事一样,总的来说时间减少了.但放在每个人身上都花了一点时间,这个时间是变化不大的<sup><a href="#fn_11" id="reffn_11">11</a></sup>.</p><p>现在进行Linux源码部分模块的编译<sup><a href="#fn_12" id="reffn_12">12</a></sup></p><p><img data-src="http://cdn.sekyoro.top/imgs/065355.png" alt="linux内核源码"></p><p>由于编译全部代码太耗时了,这里编译部分代码.</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">time make SUBDIRS=./samples/kprobes  modules</span><br></pre></td></tr></table></figure><p>网上教程有点难,直接使用这个命令.选择某个模块的文件夹编译.</p><p><img data-src="http://cdn.sekyoro.top/imgs/093321.png" alt="模块编译"></p><p>上图是直接make的编译时间</p><p>下图是 -j3编译内核某模块时间</p><p><img data-src="http://cdn.sekyoro.top/imgs/065357.png" alt="-j3编译时间"></p><p>-j6编译时间</p><p><img data-src="http://cdn.sekyoro.top/imgs/065402.png" alt="-j6编译时间"></p><p><img data-src="http://cdn.sekyoro.top/imgs/065404.png" alt="内核模块编译时间"></p><p>由于是虚拟机并且因为编译内核时间有点久只做了一组实验.</p><p>但是结果还是比较清晰的,usr和sys时间并没有太大变化.主要是total时间减少.</p><p>有意思的是-j6情况下编译时间并没有想象的减小的那么多,初步估计是虚拟机的逻辑cpu机制导致.</p><h3 id="Cmake使用"><a href="#Cmake使用" class="headerlink" title="Cmake使用"></a>Cmake使用</h3><p>同时,由于makefile编写较为麻烦,这里用cmake实现一下,不过本质上差别不大.</p><p>CMake是一个<strong>跨平台</strong>的编译(Build)工具,可以用简单的语句来描述所有平台的编译过程。</p><p>CMake能够输出各种各样的makefile或者project文件.也就是说只要我们配置好了cmake文件(CMakeLists.txt),就能输出对应的makefile,我们再make就行了<sup><a href="#fn_7" id="reffn_7">7</a></sup>.</p><p>cmake是跨平台的,我在windows上编写cmakelists,cmake可以指定构建的目的,可以是一般的MinGW,也可以是Ninja等.</p><p>需要在CMakeLists.txt文件中指定如下几项，cmake版本、工程名、构建目标app的源文件</p><ol><li><code>cmake_minimum_required</code>：指定运行此配置文件所需的 CMake 的最低版本；</li><li><code>project</code>：参数值是 <code>Demo1</code>，该命令表示项目的名称是 <code>Demo1</code> 。</li><li><code>add_executable</code>： 将名为 main.cc 的源文件编译成一个名称为 Demo 的可执行文件</li></ol><p><img data-src="http://cdn.sekyoro.top/imgs/093322.png" alt="cmake构建"></p><p>cmake在不同平台默认的构建目标(generators)不一样,我的在Windows上是visual studio,Linux上是Unix Makefiles,需要按照自己要求修改.</p><p>执行cmake后会在根据指定路径找到CMakeLists.txt,然后按照要求构建,构建文件等在执行命令的本目录下产生.由CMakeCache.txt,cmake_install.cmake,Makefile和CMakeFiles文件夹等.</p><p>我们主要关注生成的Makefile.然后在该目录下make即可.</p><p><img data-src="http://cdn.sekyoro.top/imgs/093324.png" alt="cmake"><img data-src="http://cdn.sekyoro.top/imgs/093327.png" alt="make"></p><p>这样按照generator的makefile等构建就完成了.</p><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><p><sup><a href="#fn_1" id="reffn_1">1</a></sup>:<a href="https://zhuanlan.zhihu.com/p/345669064">C语言未初始化的局部变量是多少？ - 知乎 (zhihu.com)</a> 事实上,未初始化的局部变量不一定为0,这与编译器有关.<br><sup><a href="#fn_2" id="reffn_2">2</a></sup>:<a href="https://blog.csdn.net/weixin_43955214/article/details/104138416">(58条消息) 代码段(.text)、数据区(.data)和bss段<em>baymaxly的博客-CSDN博客</em>.text段</a></p><p><sup><a href="#fn_3" id="reffn_3">3</a></sup>:<a href="https://www.cnblogs.com/james1207/archive/2013/10/10/3362277.html">C语言全局未初始化数据段分析 - Class Xman - 博客园 (cnblogs.com)</a>很好的文章<br><sup><a href="#fn_4" id="reffn_4">4</a></sup>:<a href="https://blog.csdn.net/qqliyunpeng/article/details/45116615">(58条消息) ARM中的—-汇编指令<em>老鹏-CSDN博客</em>汇编.quad</a><br><sup><a href="#fn_5" id="reffn_5">5</a></sup>:<a href="https://www.cnblogs.com/yanghong-hnu/p/4705755.html">(深入理解计算机系统) bss段，data段、text段、堆(heap)和栈(stack) - 跑马灯的忧伤 - 博客园 (cnblogs.com)</a><br><sup><a href="#fn_6" id="reffn_6">6</a></sup>:<a href="http://c.biancheng.net/linux/time.html">time命令_Linux time命令：测量命令的执行时间或者系统资源的使用情况 (biancheng.net)</a><br><sup><a href="#fn_7" id="reffn_7">7</a></sup>:<a href="https://www.cnblogs.com/ybqjymy/p/13409050.html">超详细的CMake教程 - 一杯清酒邀明月 - 博客园 (cnblogs.com)</a></p><p><sup><a href="#fn_8" id="reffn_8">8</a></sup>:<a href="https://blog.csdn.net/lqy971966/article/details/106905237">readelf 和 objdump 例子详解及区别_哈尼的博客-CSDN博客_readelf和objdump</a></p><p><sup><a href="#fn_9" id="reffn_9">9</a></sup>:<a href="https://www.jianshu.com/p/863b279c941e">使用readelf和objdump解析目标文件 - 简书 (jianshu.com)</a></p><h3 id="个人感想"><a href="#个人感想" class="headerlink" title="个人感想"></a>个人感想</h3><p>我更加熟悉了变量和函数在段的分配以及ELF文件链接视图和执行视图.</p><p>LLVM相对于gcc确实是好很多,中间代码很容易懂也很容易研究,模块更加分离.了解了编译器的大概设计,从词法,语法到语义的前端生成AST,再由AST得到IR,再对IR进行优化.后端根据优化后的IR生成对应平台的机器代码.这个过程中IR的代码就显得很重要.</p><p>最后使用了make并行编译.不过我写的代码量还是上不去,real时间0.5秒左右,不过也能看到并行编译带来的优势了.编译了Linux部分模块源码,耗时比较久,并没有多做几组实验.</p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> course </category>
          
      </categories>
      
      
        <tags>
            
            <tag> course </tag>
            
            <tag> compile </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>nginx学习</title>
      <link href="2022/03/05/nginx%E5%AD%A6%E4%B9%A0/"/>
      <url>2022/03/05/nginx%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>因为要做服务器的一些代理转发等,学习一下nginx</p><span id="more"></span><p>Nginx 是一款高性能的 HTTP 和反向代理服务器软件.</p><p>Nginx 由内核和一系列模块组成：内核提供 web 服务的基本功能，如启用网络协议、创建运行环境、接收和分配客户端请求、处理模块之间的交互。模块实现 Nginx 的各种功能和操作，Nginx 的模块从结构上分为核心模块、基础模块和第三方模块。</p><ul><li>核心模块： HTTP 模块、EVENT 模块和 MAIL 模块</li><li>基础模块： HTTP Access 模块、HTTP FastCGI 模块、HTTP Proxy 模块和 HTTP Rewrite 模块</li><li>第三方模块： HTTP Upstream Request Hash 模块、Notice 模块和 HTTP Access Key 模块及用户自己开发的模块</li></ul><blockquote><p>当 web 应用发展到一定程度时，单台服务器不足以支撑业务的正常运行，为增大吞吐量往往会使用多台服务器一起提供服务，如何充分利用多台服务器的资源，就需要一个‘调度员’，这个调度员要求能高效的接收并分发请求，知道后端的服务器健康状态，要能方便的扩展和移除，这就是 Nginx 又一常见应用架构，此架构充分利用了 Nginx 的反向代理和负载均衡的优势，Nginx 本身不提供 web 服务，而是在前端接受 Web 请求并分发到后端服务器处理，后端服务器可以是 Apache、Tomcat、IIS 等</p></blockquote><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> Nginx </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Nginx </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Bomb lab实验</title>
      <link href="2022/02/24/Bomb-lab%E5%AE%9E%E9%AA%8C/"/>
      <url>2022/02/24/Bomb-lab%E5%AE%9E%E9%AA%8C/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>csapp的第二个实验.<br>之前稀里糊涂的做过,但是并不是太懂.现在重做一下.<br><span id="more"></span></p><h2 id="开始的准备"><a href="#开始的准备" class="headerlink" title="开始的准备"></a>开始的准备</h2><p><a href="http://csapp.cs.cmu.edu/3e/labs.html">CS:APP3e, Bryant and O’Hallaron (cmu.edu)</a></p><p>实验网址,有好几个lab.选择Bomb lab的self-study就行了.最新版2016年的.</p><p>原来做的时候老师没有发文档,现在有个bomblab文档,很有用.</p><p>我还找到了这篇pdf的机翻,不过建议一起看.<a href="https://blog.csdn.net/weixin_43362650/article/details/121047514">《深入理解计算机系统》实验二Bomb Lab下载和官方文档机翻_达的程序员日记-CSDN博客</a></p><p><del>说实话,到现在我还是有点不懂</del></p><p>需要一点对于二进制文件和汇编基础.</p><p><img data-src="http://cdn.sekyoro.top/imgs/093711.png" alt="二进制文件组成"></p><ul><li>ELF文件头：存储文件类型和大小的有关信息，以及文件加载后程序执行的入口信息</li><li>程序头表：可执行文件的数据在虚拟地址空间中的组织方式，以及段的数目，位置以及用途</li><li>节：将文件分成一个个节区，每个节区都有其对应的功能，如符号表，哈希表等</li><li>段：就是将文件分成一段一段映射到内存中。段中通常包括一个或多个节区</li><li>节头表：存储段的附加信息</li></ul><p><img data-src="http://cdn.sekyoro.top/imgs/093713.png" alt="类似的"></p><p>大端模式与小端模式  </p><blockquote><p><strong>大端：多字节值的大端存储在该值的起始位置；（老大站排头为大） </strong></p><p><strong>小端：多字节值的小端存储在该值的起始位置</strong></p></blockquote><p>我这里是小端</p><p><img data-src="http://cdn.sekyoro.top/imgs/065644.png" alt="64位cpu"></p><h3 id="objdump与gdb常用命令"><a href="#objdump与gdb常用命令" class="headerlink" title="objdump与gdb常用命令"></a>objdump与gdb常用命令</h3><p>(其实我觉得命令太多了记不完的,记住重要的需要时再查就行了)</p><h4 id="objdump"><a href="#objdump" class="headerlink" title="objdump"></a>objdump</h4><blockquote><p>-f 文件头信息</p><p>-h 节头表信息 输出目标文件中节表（Section Table）中所包含的所有节头（Section Header）的信息</p><p>-x 所有的头信息 包括文件头,程序头和节头还包括符号表信息</p><p>-d 反汇编 可执行节(段)信息</p><p>-D 反汇编所有节(段)信息</p><p>-S 源代码与汇编混合 编译时需要-g</p><p>-s 所有节以及二进制</p><p>-t 显示符号表</p><p>-T 动态符号表</p></blockquote><p><strong>文件头</strong></p><p><img data-src="http://cdn.sekyoro.top/imgs/065645.png" alt="文件头信息"></p><p><strong>节(段)头信息</strong></p><p><img data-src="http://cdn.sekyoro.top/imgs/093715.png" alt="段头表"></p><p><strong>反汇编结果</strong></p><p><img data-src="http://cdn.sekyoro.top/imgs/093718.png" alt="反汇编"></p><p><strong>符号表</strong></p><p><img data-src="http://cdn.sekyoro.top/imgs/093721.png" alt="符号表"></p><p><a href="https://ipcmen.com/objdump">Linux objdump 命令用法详解-Linux命令大全（手册） (ipcmen.com)</a></p><p>节(段)介绍(注意.bss与.data .rodata)</p><blockquote><ul><li>.text：已编译程序的机器代码。</li><li>.rodata：只读数据，比如printf语句中的格式串和开关（switch）语句的跳转表。</li><li>.data：已初始化的全局C变量。局部C变量在运行时被保存在栈中，既不出现在.data中，也不出现在.bss节中。</li><li>.bss：未初始化的全局C变量。在目标文件中这个节不占据实际的空间，它仅仅是一个占位符。目标文件格式区分初始化和未初始化变量是为了空间效率在：在目标文件中，未初始化变量不需要占据任何实际的磁盘空间。</li><li>.symtab：一个符号表（symbol table），它存放在程序中被定义和引用的函数和全局变量的信息。一些程序员错误地认为必须通过-g选项来编译一个程序，得到符号表信息。实际上，每个可重定位目标文件在.symtab中都有一张符号表。然而，和编译器中的符号表不同，.symtab符号表不包含局部变量的表目。</li><li>.rel.text：当链接噐把这个目标文件和其他文件结合时，.text节中的许多位置都需要修改。一般而言，任何调用外部函数或者引用全局变量的指令都需要修改。另一方面调用本地函数的指令则不需要修改。注意，可执行目标文件中并不需要重定位信息，因此通常省略，除非使用者显式地指示链接器包含这些信息。</li><li>.rel.data：被模块定义或引用的任何全局变量的信息。一般而言，任何已初始化全局变量的初始值是全局变量或者外部定义函数的地址都需要被修改。</li><li>.debug：一个调试符号表，其有些表目是程序中定义的局部变量和类型定义，有些表目是程序中定义和引用的全局变量，有些是原始的C源文件。只有以-g选项调用编译驱动程序时，才会得到这张表。</li><li>.line：原始C源程序中的行号和.text节中机器指令之间的映射。只有以-g选项调用编译驱动程序时，才会得到这张表。</li><li>.strtab：一个字符串表，其内容包括.symtab和.debug节中的符号表，以及节头部中的节名字。字符串表就是以null结尾的字符串序列。</li></ul></blockquote><h4 id="gdb"><a href="#gdb" class="headerlink" title="gdb"></a>gdb</h4><blockquote><p>gdb <file> 运行二进制文件</p><p>run 简介r 运行 直到执行整个程序或断点处</p><p>break 简写b 打断点</p><p>注意打断点可以在 行号 函数 内存地址处</p><p>delete 简写d 删除断点</p><p>x/nfu addr 按照指定的格式而非程序的数据类型考察内存数据(这个指令很有意思)</p><p>continue 简写c 继续执行被调试程序 直到下一个断点或结束</p><p>step 简写s 执行一行源程序代码，如果此行代码中有函数调用，则进入该函数</p><p>next 简写n 执行一行源程序代码，此行代码中的函数调用也一并执行</p><p>注意对于汇编我们需要使用si,ni代替</p><p>print 简写p 显示变量值</p><p>display  设置程序中断后欲显示的数据及其格式  /i 表示以十六进行显示</p><p>undispaly，取消先前的display设置，编号从1开始递增</p><p>quit 简写q 退出</p></blockquote><p>值得一提的是gdb tui模式,</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">gdb -tui <span class="comment">#进入</span></span><br><span class="line"><span class="comment">#或者gdb进入后</span></span><br><span class="line">focous <span class="comment">#进入tui</span></span><br><span class="line">ctrl+x a <span class="comment">#退出tui</span></span><br><span class="line">layout  asm|reg|split|src <span class="comment">#展示相关信息</span></span><br><span class="line">ctrl+p ctrl+n <span class="comment">#gdb上一条 下一条命令</span></span><br><span class="line">Ctrl + L <span class="comment">#刷新窗口</span></span><br><span class="line">Ctrl + x <span class="comment">#再按1：单窗口模式，显示一个窗口</span></span><br><span class="line">Ctrl + x <span class="comment">#再按2：双窗口模式，显示两个窗口</span></span><br></pre></td></tr></table></figure><p>先知道这么多吧.</p><p><a href="https://blog.csdn.net/qq_41071068/article/details/103007550">Linux 调试器gdb命令及TUI模式</a></p><p><a href="http://csapp.cs.cmu.edu/3e/docs/gdbnotes-x86-64.pdf">Enscript Output (cmu.edu)</a></p><p>注意汇编指令也有格式 可以看出这里是AT&amp;T格式</p><p><a href="https://www.cnblogs.com/hdk1993/p/4820353.html">Intel格式和AT&amp;T格式汇编区别</a></p><p>同时注意汇编指令 call ret leave</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">call addr:</span><br><span class="line">push rip</span><br><span class="line">mov addr rip</span><br><span class="line">#call指令 调用函数</span><br><span class="line">ret :</span><br><span class="line">pop rip</span><br><span class="line">#ret指令  返回</span><br><span class="line">leave :</span><br><span class="line">mov rbp rsp</span><br><span class="line">pop rbp</span><br><span class="line">#leave指令 关闭栈帧</span><br></pre></td></tr></table></figure><p><a href="http://c.biancheng.net/view/3537.html">汇编语言CALL和RET指令：调用一个过程 (biancheng.net)</a></p><p>还有vim查看16进制,因为需要修改二进制可执行文件</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="params">#</span>打开file文件</span><br><span class="line">vim file</span><br><span class="line"><span class="params">#</span>在命令模式下输入.. 以16进制显示</span><br><span class="line">:<span class="comment">%!xxd</span></span><br><span class="line"><span class="params">#</span>在命令模式下输入.. 切换回默认显示</span><br><span class="line">:<span class="comment">%!xxd -r</span></span><br></pre></td></tr></table></figure><h4 id="readelf"><a href="#readelf" class="headerlink" title="readelf"></a>readelf</h4><blockquote><p>-h ELF文件开始的文件头信息</p><p>-l 程序头  节到段的映射</p><p>-S 显示节头信息</p><p>-s 符号表信息</p><p>-r 显示可重定位段的信息</p><p>-d 显示动态段的信息</p></blockquote><h2 id="正式开始"><a href="#正式开始" class="headerlink" title="正式开始"></a>正式开始</h2><h3 id="initial-bomb"><a href="#initial-bomb" class="headerlink" title="initial_bomb"></a>initial_bomb</h3><p>首先先看源文件,不得不说这个作者真的很humorous.</p><p>注意如果运行时无参数就读取输入,否则读取文件.</p><p><img data-src="http://cdn.sekyoro.top/imgs/093724.png" alt="根据参数确定输入"></p><p>然后进入了initialize_bomb函数,我们尝试看一看.</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">objdump -d bomb</span><br></pre></td></tr></table></figure><p>这样可以查看.text段里的信息.</p><p>查看initialize_bomb这个函数</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">00000000004013a2 &lt;initialize_bomb&gt;:</span><br><span class="line">  4013a2:       48 83 ec 08             sub    $0x8,%rsp</span><br><span class="line">  4013a6:       be a0 12 40 00          mov    $0x4012a0,%esi</span><br><span class="line">  4013ab:       bf 02 00 00 00          mov    $0x2,%edi</span><br><span class="line">  4013b0:       e8 db f7 ff ff          callq  400b90 &lt;signal@plt&gt;</span><br><span class="line">  4013b5:       48 83 c4 08             add    $0x8,%rsp</span><br><span class="line">  4013b9:       c3   </span><br></pre></td></tr></table></figure><p>首先开栈,注意这是x86_64架构的,mov指令是mov src-&gt;dst,这跟intel指令不一样.</p><div class="table-container"><table><thead><tr><th><strong>AT&amp;T</strong> <strong>格式</strong></th><th><strong>Intel</strong> <strong>格式</strong></th></tr></thead><tbody><tr><td>movl -4(%ebp), %eax</td><td>mov eax, [ebp - 4]</td></tr><tr><td>movl array(, %eax, 4), %eax</td><td>mov eax, [eax*4 + array]</td></tr><tr><td>movw array(%ebx, %eax, 4), %cx</td><td>mov cx, [ebx + 4*eax + array]</td></tr><tr><td>movb $4, %fs:(%eax)</td><td>mov fs:eax, 4</td></tr></tbody></table></div><div class="table-container"><table><thead><tr><th>寄存器</th><th>描述</th></tr></thead><tbody><tr><td>rdi</td><td>传递第一个参数</td></tr><tr><td>rsi</td><td>传递第二个参数</td></tr></tbody></table></div><p><a href="https://blog.csdn.net/lidonghat/article/details/70244288">寄存器介绍</a>这个可以看一看</p><p>这里有一篇很好的文章<a href="https://mengkang.net/1390.html">x86-64 规定只有6个寄存器来存参数，那 C 函数为什么还能超过6个参数呢？ (mengkang.net)</a></p><p>当了解了汇编基础知识(其实可以面向搜索引擎学习,遇到不懂的指令去搜索就可以了)后,我们知道esi值第二个参数,edi是第一个参数.然后callq 400b90转去执行这个函数.</p><p><img data-src="http://cdn.sekyoro.top/imgs/093729.png" alt="signal@plt函数"></p><p>注意jmpq *0x2024c2(%rip)表示跳转到 %rip+0x2024c2地址所存储的值,即0x603058地址存储的值(是一个地址)</p><p>这个函数叫signal@plt,我也不懂,我在网上搜索后.这跟链接,重定位相关<a href="https://blog.csdn.net/u012741741/article/details/51870752">重定位和链接</a></p><p><a href="https://www.cnblogs.com/xingyun/archive/2011/12/10/2283149.html">Linux动态链接之GOT与PLT</a></p><p><a href="https://blog.csdn.net/anzhsoft/article/details/18776111">Linux Debugging（七）: 使用反汇编理解动态库函数调用方式GOT/PLT<em>anzhsoft的技术专栏-CSDN博客</em>动态库反汇编</a></p><p><a href="https://stackoverflow.com/questions/5469274/what-does-plt-mean-here">assembly - What does @plt mean here? - Stack Overflow</a></p><p>在实际的可执行程序或者共享目标文件中，GOT表在名称为.got.plt的section中，PLT表在名称为.plt的section中</p><blockquote><p>GOT是Global Offset Table，是保存库函数地址的区域。程序运行时，库函数的地址会设置到GOT中。由于动态库的函数是在使用时才被加载，因此刚开始GOT表是空的。地址的设置就涉及到了PLT，Procedure Linkage Table，它包含了一些代码以调用库函数，它可以被理解成一系列的小函数，这些小函数的数量其实就是库函数的被使用到的函数的数量。</p><p>简单来说，PLT就是跳转到GOT中所设置的地址而已。如果这个地址是空，那么PLT的跳转会巧妙的调用_dl_runtime_resolve去获取最终地址并设置到GOT中去。由于库函数的地址在运行时不会变，因此GOT一旦设置以后PLT就可以直接跳转到库函数的真实地址了。</p></blockquote><p>stack overflow中的解答,类似的</p><blockquote><p><code>printf@plt</code> is actually a small stub which (eventually) calls the real <code>printf</code> function, modifying things on the way to make subsequent calls faster.</p><p>The <em>real</em> <code>printf</code> function may be mapped into <em>any</em> location in a given process (virtual address space) as may the code that is trying to call it.</p><p>So, in order to allow proper code sharing of calling code (left side below) and called code (right side below), you don’t want to apply any fixups to the calling code directly since that will restrict where it can be located in <em>other</em> processes.</p></blockquote><p>让我们也试试看吧.</p><p>首先signal@plt跳转到一个地址(*0x603058),这里需要gdb看一看</p><p><img data-src="http://cdn.sekyoro.top/imgs/065647.png" alt="0x603058地址上是什么呢"></p><p>所以jmp到了0x00400b96,这个这份地址又是什么呢,有点眼熟？注意signal@plt中的汇编代码,貌似我们又跳回来了.</p><p><img data-src="http://cdn.sekyoro.top/imgs/065648.png" alt="地址上的指令"></p><p>使用gdb的x指令查看内存的数据,指定x /5i 表示往后五个单位的指令(i表示指令),可以看出先把0x0b压栈,又跳转一个地址0x400ad0</p><p><img data-src="http://cdn.sekyoro.top/imgs/093732.png" alt="跳转的地方"></p><p>使用gdb执行到0x400ad0处</p><p><img data-src="http://cdn.sekyoro.top/imgs/065650.png" alt="image-20220225200719489"></p><p>我在这卡了很久,因为我以为跳转的就是这个地址,实际上这是32位的值,是原本64位地址的低地址.jmpq跳转到64位地址.这也跟我gdb使用不熟练有关</p><p><img data-src="http://cdn.sekyoro.top/imgs/065651.png" alt="image-20220225201622362"></p><p>然后执行函数</p><p><img data-src="http://cdn.sekyoro.top/imgs/093736.png" alt="动态库函数"></p><p>这中间又跳转执行了很多函数。</p><p>最后又跳了回来.</p><p><img data-src="http://cdn.sekyoro.top/imgs/093738.png" alt="流程图"></p><p><a href="https://blog.csdn.net/qq_18661257/article/details/54694748?locationNum=1&amp;fps=1">GOT表和PLT表知识详解_qq_18661257的专栏-CSDN博客_got表</a></p><p>再来看看传入的参数0x4012a0,可以看到这是函数的地址<img data-src="http://cdn.sekyoro.top/imgs/065652.png" alt="一个函数的地址"></p><p>可以知道在initial_bomb中使用了signal函数,传入信号量2,调用写的sig_handler函数.</p><p>sig_handler中进行了一些设置,主要捕获中断信号,针对ctrl+c.</p><p><a href="https://www.runoob.com/cprogramming/c-function-signal.html">C 库函数 – signal() | 菜鸟教程 (runoob.com)</a></p><p>好了,initial_bomb就解析到这吧.</p><h3 id="phase-1"><a href="#phase-1" class="headerlink" title="phase_1"></a>phase_1</h3><p><img data-src="http://cdn.sekyoro.top/imgs/065654.png" alt="phase_1"></p><p>还是很好理解的,读取输入并传输函数.</p><p>第一行就不说明了,使用gdb调试第二行.</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">b phase_1 <span class="comment">#打断点</span></span><br><span class="line">r <span class="comment">#运行</span></span><br></pre></td></tr></table></figure><p>随便进行输入,然后进入函数.接下来就是艰难的读汇编代码阶段.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">0x400ee0 &lt;phase_1&gt;      sub    $0x8,%rsp                                                                                          </span><br><span class="line">  0x400ee4 &lt;phase_1+4&gt;    mov    $0x402400,%esi                                                                                     </span><br><span class="line">  0x400ee9 &lt;phase_1+9&gt;    callq  0x401338 &lt;strings_not_equal&gt;                                                                        </span><br><span class="line">  0x400eee &lt;phase_1+14&gt;   test   %eax,%eax                                                                                           </span><br><span class="line">  0x400ef0 &lt;phase_1+16&gt;   je     0x400ef7 &lt;phase_1+23&gt;                                                                               </span><br><span class="line">  0x400ef2 &lt;phase_1+18&gt;   callq  0x40143a &lt;explode_bomb&gt;                                                                             </span><br><span class="line">  0x400ef7 &lt;phase_1+23&gt;   add    $0x8,%rsp                                                                                           </span><br><span class="line">  0x400efb &lt;phase_1+27&gt;   retq  </span><br></pre></td></tr></table></figure><p>可以看到首先是开栈,栈顶移动8个字节,然后将$0x402400赋值给函数第二个调用参数,然后调用函数,通过名字就可以知道是判断字符串是否相等.然后测试结果根据结果进行跳转.je 表示相等就跳转否则调用炸弹爆炸.</p><p>我们到stings_not_equal中看看,其实不用细看,我们主要想知道进行比较的是什么字符串,它们的地址是什么.</p><p><img data-src="http://cdn.sekyoro.top/imgs/093741.png" alt="stings_not_equal"></p><p>首先需要肯定的是,调用字符串比较函数需要参数,%esi是第二个参数.我们看看这个寄存器的值</p><p>x /s显示地址上的值,以字符串形式.</p><p><img data-src="http://cdn.sekyoro.top/imgs/093745.png" alt="查看内存地址的字符串"></p><p>使用info r查看寄存器%rdi值<img data-src="http://cdn.sekyoro.top/imgs/065657.png" alt="寄存器值"></p><p>看到了之前随意输入的参数</p><p><img data-src="http://cdn.sekyoro.top/imgs/093748.png" alt="%rdi所存地址上的值"></p><p>所以字符串修改为0x402400上的字符串即可.</p><p>参数可以为文件,每行一个题答案.</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./bomb myanswers.txt</span><br></pre></td></tr></table></figure><p><img data-src="http://cdn.sekyoro.top/imgs/093803.png" alt="解决第一题"></p><p>phase_defused函数,我们也可以看看.估计就是输出一些语句就行了.</p><p><img data-src="http://cdn.sekyoro.top/imgs/093808.png" alt="phase_defused"></p><h3 id="phase-2"><a href="#phase-2" class="headerlink" title="phase_2"></a>phase_2</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* The second phase is harder.  No one will ever figure out</span></span><br><span class="line"><span class="comment">     * how to defuse this... */</span></span><br><span class="line">    input = read_line();</span><br><span class="line">    phase_2(input);</span><br><span class="line">    phase_defused();</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;That&#x27;s number 2.  Keep going!\n&quot;</span>);</span><br></pre></td></tr></table></figure><p>可以在gdb使用set args设置参数为答案文本.</p><p>然后继续打断点,打在phase_2即可</p><p><img data-src="http://cdn.sekyoro.top/imgs/093811.png" alt="phase_2代码"></p><p>可以看到先读取了调用函数6个数字,在这之前将栈顶地址移到$rsi中,可以看看这个函数</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">0x40145c &lt;read_six_numbers&gt;     sub    $0x18,%rsp                                                                                  │</span><br><span class="line">│   0x401460 &lt;read_six_numbers+4&gt;   mov    %rsi,%rdx                                                                                   │</span><br><span class="line">│   0x401463 &lt;read_six_numbers+7&gt;   lea    0x4(%rsi),%rcx                                                                              │</span><br><span class="line">│   0x401467 &lt;read_six_numbers+11&gt;  lea    0x14(%rsi),%rax                                                                             │</span><br><span class="line">│   0x40146b &lt;read_six_numbers+15&gt;  mov    %rax,0x8(%rsp)                                                                              │</span><br><span class="line">│   0x401470 &lt;read_six_numbers+20&gt;  lea    0x10(%rsi),%rax                                                                             │</span><br><span class="line">│   0x401474 &lt;read_six_numbers+24&gt;  mov    %rax,(%rsp)                                                                                 │</span><br><span class="line">│   0x401478 &lt;read_six_numbers+28&gt;  lea    0xc(%rsi),%r9                                                                               │</span><br><span class="line">│   0x40147c &lt;read_six_numbers+32&gt;  lea    0x8(%rsi),%r8                                                                               │</span><br><span class="line">│   0x401480 &lt;read_six_numbers+36&gt;  mov    $0x4025c3,%esi                                                                              │</span><br><span class="line">│   0x401485 &lt;read_six_numbers+41&gt;  mov    $0x0,%eax                                                                                   │</span><br><span class="line">│   0x40148a &lt;read_six_numbers+46&gt;  callq  0x400bf0 &lt;__isoc99_sscanf@plt&gt;                                                              │</span><br><span class="line">│   0x40148f &lt;read_six_numbers+51&gt;  cmp    $0x5,%eax                                                                                   │</span><br><span class="line">│   0x401492 &lt;read_six_numbers+54&gt;  jg     0x401499 &lt;read_six_numbers+61&gt;                                                              │</span><br><span class="line">│   0x401494 &lt;read_six_numbers+56&gt;  callq  0x40143a &lt;explode_bomb&gt;                                                                     │</span><br><span class="line">│   0x401499 &lt;read_six_numbers+61&gt;  add    $0x18,%rsp                                                                                  │</span><br><span class="line">│   0x40149d &lt;read_six_numbers+65&gt;  retq</span><br></pre></td></tr></table></figure><p>可以看到调用了sscanf@plt也就是后面会执行sanf函数,需要两参数,一个格式字符串.看到mov $0x4025c3 %esi,看一下是什么</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(gdb) x 0x4025c3</span><br><span class="line">0x4025c3:       &quot;%d %d %d %d %d %d&quot;</span><br></pre></td></tr></table></figure><p>也就是六个整数.这一有一个知识点,传函数参数时,如果数量比较多那么就会使用栈.也就是使用%rbp或%rsp指示,同时函数参数是从右往左开始的,也就是最后一个输入的参数会先被传入寄存器或栈中.</p><p>再看看%edi</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(gdb) x /s $edi</span><br><span class="line">0x6037d0 &lt;input_strings+80&gt;:    &quot;1 12 23 34 13 100&quot;</span><br></pre></td></tr></table></figure><p>即传入了这个字符串到read_six_numbers函数.</p><p>注意到后面有jg即大于跳转,也就是输入的正确参数要大于5,即6个(跟函数名称一样就行了).然后跳出这个函数.继续执行</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"> 0x400f05 &lt;phase_2+9&gt;    callq  0x40145c &lt;read_six_numbers&gt;                                                                         </span><br><span class="line">0x400f0a &lt;phase_2+14&gt;   cmpl   $0x1,(%rsp)                                                                                         </span><br><span class="line"> 0x400f0e &lt;phase_2+18&gt;   je     0x400f30 &lt;phase_2+52&gt; </span><br></pre></td></tr></table></figure><p>后面又继续跳转到0x400f30(当然这里有条件寄存器rsp值等于1,后面会说)</p><p><img data-src="http://cdn.sekyoro.top/imgs/093813.png" alt="跳转到这"></p><p>这里进行了赋值后又继续跳转到0x400f17</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">0x400f17 &lt;phase_2+27&gt;   mov    -0x4(%rbx),%eax                                                                                     </span><br><span class="line">  0x400f1a &lt;phase_2+30&gt;   add    %eax,%eax                                                                                          </span><br><span class="line"> 0x400f1c &lt;phase_2+32&gt;   cmp    %eax,(%rbx)                                                                                         </span><br><span class="line">  0x400f1e &lt;phase_2+34&gt;   je     0x400f25 &lt;phase_2+41&gt;                                                                               </span><br><span class="line"> 0x400f20 &lt;phase_2+36&gt;   callq  0x40143a &lt;explode_bomb&gt; </span><br></pre></td></tr></table></figure><p>可以看出又会进行比较值相等才能避免爆炸,相等的话又会跳转到一个地址0x400f25.</p><p>0x400f25</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">0x400f25 &lt;phase_2+41&gt;   add    $0x4,%rbx                                                                                           │</span><br><span class="line">│   0x400f29 &lt;phase_2+45&gt;   cmp    %rbp,%rbx                                                                                           │</span><br><span class="line">│   0x400f2c &lt;phase_2+48&gt;   jne    0x400f17 &lt;phase_2+27&gt;                                                                               │</span><br><span class="line">│   0x400f2e &lt;phase_2+50&gt;   jmp    0x400f3c &lt;phase_2+64&gt;                                                                               │</span><br><span class="line">│   0x400f30 &lt;phase_2+52&gt;   lea    0x4(%rsp),%rbx                                                                                      │</span><br><span class="line">│   0x400f35 &lt;phase_2+57&gt;   lea    0x18(%rsp),%rbp                                                                                     │</span><br><span class="line">│   0x400f3a &lt;phase_2+62&gt;   jmp    0x400f17 &lt;phase_2+27&gt;                                                                               │</span><br><span class="line">│   0x400f3c &lt;phase_2+64&gt;   add    $0x28,%rsp                                                                                          │</span><br><span class="line">│   0x400f40 &lt;phase_2+68&gt;   pop    %rbx                                                                                                │</span><br><span class="line">│   0x400f41 &lt;phase_2+69&gt;   pop    %rbp                                                                                                │</span><br><span class="line">│   0x400f42 &lt;phase_2+70&gt;   retq           </span><br></pre></td></tr></table></figure><p>可以看到这里又会进行比较如果不等又会跳回去,相等才能脱离苦海.如果你想锻炼你的汇编代码阅读能力可以直接硬读,我这直接设置6个特别的数值然后看看寄存器存储的什么值.</p><p>跳出读取6个值的函数后,跳回0x400f0a,这里对寄存器$rsp值进行了比较(如果你设置特殊值进行多次测试就知道这个值等于什么了)</p><p>这里我们回去关注一下%rsp的值(关于寄存器符号我这里%与$混合使用)</p><p>所以我们需要好好探讨一下read_six_numbers中传给scanf的参数.</p><p>关于函数传参寄存器中存储的值.</p><p><a href="https://blog.csdn.net/qq_31917799/article/details/104233427">C语言参数传递所使用的寄存器<em>天马行空-CSDN博客</em>参数寄存器</a></p><p>由于%edi是phase_2传入read_six_numbers的参数,所以read_six_numbers向scanf传参是从%esi开始,需要七个参数(6个数字与一个格式化参数).rdx,rcx,r8,r9也是传参的寄存器,算上%esi就有五个,还有两个就需要用栈了.</p><p>可以看到在read_six_numbers中将%rsi传给了%rdx,这是第一个参,然后将0x4(%rsi)存储的值赋给%rcx,就是第二个参数.(一个值4字节,但一个寄存器大小是8字节).也就是说%rcx存储的是第二个参数的地址.</p><p><img data-src="http://cdn.sekyoro.top/imgs/093815.png" alt="栈与寄存器"></p><p>还是画图好理解.开始的4个用寄存器存,后面的寄存器不够雷人用栈存.当scanf执行完后,%rsp = %rsp’.所以(%rsp)就是输入的第一个值.返回值%eax就是6(正确读取了6个值)</p><p>所以第一个值为1.至于为什么是第一个而不是最后一个,因为要存储最后两个值寄存器不够所以入栈了,它们值存储在距离phase_2栈帧的栈顶最远的地方.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">0x400f30 &lt;phase_2+52&gt;   lea    0x4(%rsp),%rbx                                                                                      </span><br><span class="line">   0x400f35 &lt;phase_2+57&gt;   lea    0x18(%rsp),%rbp                                                                                    </span><br><span class="line">   0x400f3a &lt;phase_2+62&gt;   jmp    0x400f17 &lt;phase_2+27&gt;  </span><br></pre></td></tr></table></figure><p>然后便是将%rbx赋值为第二个值的地址,栈底赋值为%rsp+24.24个字节是6个int大小.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">0x400f17 &lt;phase_2+27&gt;   mov    -0x4(%rbx),%eax                                                                                     </span><br><span class="line">   0x400f1a &lt;phase_2+30&gt;   add    %eax,%eax                                                                                           </span><br><span class="line">   0x400f1c &lt;phase_2+32&gt;   cmp    %eax,(%rbx)</span><br></pre></td></tr></table></figure><p>然后将上一个值赋给%eax,再加倍.判断与当前值的大小.相等才能避免爆炸</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">0x400f25 &lt;phase_2+41&gt;   add    $0x4,%rbx                                                                                           </span><br><span class="line">0x400f29 &lt;phase_2+45&gt;   cmp    %rbp,%rbx</span><br></pre></td></tr></table></figure><p>再将当前值指向下一个(4字节是一个int大小),然后将地址与%rbp比较.因为%rbp = 0x18(%rsp).经历五次循环后就结束了.而每循环都需要将当前值设置为前一个值的二倍.</p><p>所以结果就是1 2 4 8 16 32</p><h3 id="phase-3"><a href="#phase-3" class="headerlink" title="phase_3"></a>phase_3</h3><p>有空了,开冲.</p><p><img data-src="http://cdn.sekyoro.top/imgs/093817.png" alt="phase_3"></p><p>代码类似.在这之前</p><p><img data-src="http://cdn.sekyoro.top/imgs/065659.png" alt="将读取的字符串传参"></p><p>将输入值传入phase_3参数.</p><p><img data-src="http://cdn.sekyoro.top/imgs/093818.png" alt="phase_3代码"></p><p>进入phase_3函数查看0x4025cf的值</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(gdb) x 0x4025cf</span><br><span class="line">0x4025cf:       &quot;%d %d&quot;</span><br></pre></td></tr></table></figure><p>后面调用scanf函数,第一个参数就在%esi中,”%d %d”表示传入两个整数,第一个在%rdx,第二个在%rcx.</p><p>cmp $0x1,%eax表示比较,必须大于一个才能跳转.</p><p>后面比较第二个参数,ja表示无符号比较.<a href="https://blog.csdn.net/poptar/article/details/111686050">汇编语言—-跳转指令ja、jb、jl<em>poptar的博客-CSDN博客</em>汇编语言ja</a></p><p><img data-src="http://cdn.sekyoro.top/imgs/093821.png" alt="比较输入的参数"></p><p>0x400fad跳转到一个调用引爆炸弹的地方,所以第一个参数要小于等于7.</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash">0x400fad &lt;phase_3+106&gt;  callq  0x40143a &lt;explode_bomb&gt;</span> </span><br></pre></td></tr></table></figure><p>后面jmp到一个地址,<em>(0x402470)(,%rax,8)  8表示8个字节,即(0x402470)(,%rax,8)表示0x402470+%rax\</em>8.</p><p><strong>寻址方式</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">地址或偏移(%基址或偏移量寄存器, %索引寄存器, 比例因子)</span><br></pre></td></tr></table></figure><p>地址的计算公式是:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">最终地址 = 地址或偏移 + %基址或偏移量寄存器 + %索引寄存器  * 比例因子</span><br></pre></td></tr></table></figure><p>这里第一个参数假设为6,地址是400f9f  x/10gx 表示查看后面10个giant(8字节)以16进制形式的数据</p><p><img data-src="http://cdn.sekyoro.top/imgs/093822.png" alt="跳转的地址"></p><p>0x2aa移到%eax值然后与第二个参数进行比较,需要等于才能避免爆炸.</p><p>所以这就是一个答案,一共应该有0-6七组答案,这里我就不写了.</p><h3 id="phase-4"><a href="#phase-4" class="headerlink" title="phase_4"></a>phase_4</h3><p>进入phase_4函数,查看x $edi表明是将输入的参数传入函数phase_4.</p><p>在函数中后面又继续传入参数,x 0x4025cf</p><p><img data-src="http://cdn.sekyoro.top/imgs/093824.png" alt="phase_4"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(gdb) x 0x4025cf</span><br><span class="line">0x4025cf:       &quot;%d %d&quot;</span><br></pre></td></tr></table></figure><p>表明需要输入两个整数.0xc(%rsp)是第二个参数,0x8(%rsp)是第一个参数.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;0x40102c &lt;phase_4+32&gt;   jne    0x401035 &lt;phase_4+41&gt;                                                                               </span><br><span class="line">  0x40102e &lt;phase_4+34&gt;   cmpl   $0xe,0x8(%rsp)                                                                                      </span><br><span class="line">  0x401033 &lt;phase_4+39&gt;   jbe    0x40103a &lt;phase_4+46&gt;                                                                               </span><br><span class="line">  0x401035 &lt;phase_4+41&gt;   callq  0x40143a &lt;explode_bomb&gt; </span><br></pre></td></tr></table></figure><p>如果不是输入了两个整数jne跳向炸弹爆炸.接着进行比较第一个整数,与0xe(14)比较.jbe表示小于等于.也就是第一个参数如果小于等于14则跳转否则不跳转爆炸.</p><p>这里我们输入14,后面跳转到0x40103a,将14赋值给%edx. %esi赋值为0.第一个参数赋值给%edi.调用func4.</p><p>也就是func4(第一个参数(这里我们是14),0,14).</p><p>查看func4函数</p><p><img data-src="http://cdn.sekyoro.top/imgs/093826.png" alt="func4函数"></p><p>SHR（右移）指令使目的操作数逻辑右移若干位，最高位用 0 填充。最低位复制到进位标志位，而进位标志位中原来的数值被丢弃.因为%ecx值是0xe,最低位是0.CF=0.</p><p>sar与shr差别 两者的区别在于SAR右移时保留操作数的符号，即用符号位来补足，而SHR右移时总是用0来补足</p><p>sar %eax表示将%eax存储的值右移一位,最高位由符号位补齐.14右移一位得到7.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">│   0x400fdf &lt;func4+17&gt;     lea    (%rax,%rsi,1),%ecx                                                                                  │</span><br><span class="line">│  &gt;0x400fe2 &lt;func4+20&gt;     cmp    %edi,%ecx                                                                                           │</span><br><span class="line">│   0x400fe4 &lt;func4+22&gt;     jle    0x400ff2 &lt;func4+36&gt;                                                                                 │</span><br><span class="line">│   0x400fe6 &lt;func4+24&gt;     lea    -0x1(%rcx),%edx                                                                                     │</span><br><span class="line">│   0x400fe9 &lt;func4+27&gt;     callq  0x400fce &lt;func4&gt;                                                                                    │</span><br><span class="line">│   0x400fee &lt;func4+32&gt;     add    %eax,%eax                                                                                           │</span><br><span class="line">    0x400ff0 &lt;func4+34&gt;     jmp    0x401007 &lt;func4+57&gt; </span><br></pre></td></tr></table></figure><p>我们可以先看看函数外的判断</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">40104d:       85 c0                   test   %eax,%eax</span><br><span class="line">40104f:       75 07                   jne    401058 &lt;phase_4+0x4c&gt;</span><br><span class="line">401051:       83 7c 24 0c 00          cmpl   $0x0,0xc(%rsp)</span><br><span class="line">401056:       74 05                   je     40105d &lt;phase_4+0x51</span><br></pre></td></tr></table></figure><p><a href="https://blog.csdn.net/counsellor/article/details/81005101">test和je指令的组合用法_counsellor的专栏-CSDN博客_je指令</a></p><p>所以我们需要函数结果为0,同时第二个参数也为0.</p><p>比较简单的处理就是第一个参数等于%ecx,也就是等于7.</p><p><img data-src="http://cdn.sekyoro.top/imgs/093827.png" alt="大致流程"></p><h3 id="phase-5"><a href="#phase-5" class="headerlink" title="phase_5"></a>phase_5</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">40107a:       e8 9c 02 00 00          callq  40131b &lt;string_length&gt;</span><br><span class="line">40107f:       83 f8 06                cmp    $0x6,%eax</span><br></pre></td></tr></table></figure><p>输入参数,字符串长度等于6.所以需要输入含有6个字符的字符串.</p><p>进入phase_5函数.</p><p>注意后面的代码</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">4010b3:       be 5e 24 40 00          mov    $0x40245e,%esi</span><br><span class="line">4010b8:       48 8d 7c 24 10          lea    0x10(%rsp),%rdi</span><br><span class="line">4010bd:       e8 76 02 00 00          callq  401338 &lt;strings_not_equal&gt;</span><br><span class="line">4010c2:       85 c0                   test   %eax,%eax</span><br><span class="line">4010c4:       74 13                   je     4010d9 &lt;phase_5+0x77&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>可以看到将0x40245e赋值给%esi</p><p>看一下是什么</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(gdb) x /s 0x40245e</span><br><span class="line">0x40245e:       &quot;flyers&quot;</span><br></pre></td></tr></table></figure><p>表明我们的%rdi的需要等于这个字符串.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">40108b:       0f b6 0c 03             movzbl (%rbx,%rax,1),%ecx</span><br><span class="line">40108f:       88 0c 24                mov    %cl,(%rsp)</span><br><span class="line">401092:       48 8b 14 24             mov    (%rsp),%rdx</span><br><span class="line">401096:       83 e2 0f                and    $0xf,%edx</span><br><span class="line">401099:       0f b6 92 b0 24 40 00    movzbl 0x4024b0(%rdx),%edx</span><br><span class="line">4010a0:       88 54 04 10             mov    %dl,0x10(%rsp,%rax,1)</span><br><span class="line">4010a4:       48 83 c0 01             add    $0x1,%rax</span><br><span class="line">4010a8:       48 83 f8 06             cmp    $0x6,%rax</span><br><span class="line">4010ac:       75 dd                   jne    40108b &lt;phase_5+0x29&gt;</span><br><span class="line">4010ae:       c6 44 24 16 00          movb   $0x0,0x16(%rsp)</span><br></pre></td></tr></table></figure><p>注意到将0x4024b0后面的字节移动到%edi.而之前的%rdx是由我们输入的字符的ascii码与0xf相与得到的.</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(gdb) x 0x4024b0</span><br><span class="line">0x4024b0 &lt;array.3449&gt;:  &quot;maduiersnfotvbylSo you think you can stop the bomb with ctrl-c, do you?&quot;</span><br></pre></td></tr></table></figure><p>所以需要首先得到flyers每个字母在上面字符串中的位置,分别是(从0开始)9 15 14 5 6.</p><p>我们输入的6个字符的ascii码与0xf相与后必须是以上的值.所以答案有很多.</p><p>比如0x69 0x6f 0x6e 0x65 0x66.即ionefg</p><h3 id="phase-6"><a href="#phase-6" class="headerlink" title="phase_6"></a>phase_6</h3><p><img data-src="http://cdn.sekyoro.top/imgs/093829.png" alt="phase_6"></p><p>一开始进行比较</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> 0x401145 &lt;phase_6+81&gt;   add    $0x1,%ebx                                                                                           │</span><br><span class="line">│  &gt;0x401148 &lt;phase_6+84&gt;   cmp    $0x5,%ebx                                                                                           │</span><br><span class="line">│   0x40114b &lt;phase_6+87&gt;   jle    0x401135 &lt;phase_6+65&gt;                                                                               │</span><br><span class="line">│   0x40114d &lt;phase_6+89&gt;   add    $0x4,%r13                                                                                           │</span><br><span class="line">│   0x401151 &lt;phase_6+93&gt;   jmp    0x401114 &lt;phase_6+32&gt;                                                                               │</span><br><span class="line">│   0x401153 &lt;phase_6+95&gt;   lea    0x18(%rsp),%rsi  </span><br></pre></td></tr></table></figure><p>6个数均小于等于6且不能相等.</p><p>后面跳转到0x0000000000401153,用7去减去每一个数</p><p>0x40116f  0x40116f 0x401188  </p><p>0x4011ab这里的代码将链表反向串联,便于比较.</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">x</span> /<span class="number">24</span>wx <span class="number">0</span>x<span class="number">6032</span>d<span class="number">0</span></span><br></pre></td></tr></table></figure><p><img data-src="http://cdn.sekyoro.top/imgs/093831.png" alt="链表结构"></p><p><img data-src="http://cdn.sekyoro.top/imgs/093832.png" alt="存储的值"></p><p>执行完后</p><p><img data-src="http://cdn.sekyoro.top/imgs/093836.png" alt="循环执行完毕"></p><p><img data-src="http://cdn.sekyoro.top/imgs/065701.png" alt="node结构"></p><p><strong>关键代码</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">  0x4011d0 &lt;phase_6+220&gt;  jmp    0x4011bd &lt;phase_6+201&gt;                                                                              │</span><br><span class="line">│   0x4011d2 &lt;phase_6+222&gt;  movq   $0x0,0x8(%rdx)                                                                                      │</span><br><span class="line">│   0x4011da &lt;phase_6+230&gt;  mov    $0x5,%ebp                                                                                           │</span><br><span class="line">│   0x4011df &lt;phase_6+235&gt;  mov    0x8(%rbx),%rax                                                                                      │</span><br><span class="line">│   0x4011e3 &lt;phase_6+239&gt;  mov    (%rax),%eax                                                                                         │</span><br><span class="line">│  &gt;0x4011e5 &lt;phase_6+241&gt;  cmp    %eax,(%rbx)                                                                                         │</span><br><span class="line">│   0x4011e7 &lt;phase_6+243&gt;  jge    0x4011ee &lt;phase_6+250&gt;                                                                              │</span><br><span class="line">│   0x4011e9 &lt;phase_6+245&gt;  callq  0x40143a &lt;explode_bomb&gt; </span><br></pre></td></tr></table></figure><p>000032d0是node1的地址,这里需要修改二进制文件.</p><p>将节点值从头到尾依次增大(假设输入 1 2 3 4 5 6).</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">0x4011e5 &lt;phase_6+241&gt;  cmp    %eax,(%rbx)                                                                                         │</span><br><span class="line">│   0x4011e7 &lt;phase_6+243&gt;  jge    0x4011ee &lt;phase_6+250&gt;                                                                              │</span><br><span class="line">│   0x4011e9 &lt;phase_6+245&gt;  callq  0x40143a &lt;explode_bomb&gt;                                                                             │</span><br><span class="line">│   0x4011ee &lt;phase_6+250&gt;  mov    0x8(%rbx),%rbx                                                                                      │</span><br><span class="line">│   0x4011f2 &lt;phase_6+254&gt;  sub    $0x1,%ebp                                                                                           │</span><br><span class="line">│   0x4011f5 &lt;phase_6+257&gt;  jne    0x4011df &lt;phase_6+235&gt;                                                                              │</span><br><span class="line">│   0x4011f7 &lt;phase_6+259&gt;  add    $0x50,%rsp                                                                                          │</span><br><span class="line">│  &gt;0x4011fb &lt;phase_6+263&gt;  pop    %rbx                                                                                                │</span><br><span class="line">│   0x4011fc &lt;phase_6+264&gt;  pop    %rbp                                                                                                │</span><br><span class="line">│   0x4011fd &lt;phase_6+265&gt;  pop    %r12 </span><br></pre></td></tr></table></figure><h3 id="secret-phase"><a href="#secret-phase" class="headerlink" title="secret_phase"></a>secret_phase</h3><p>strings bomb发现有一个secret_phase很可疑.</p><p>查看反汇编文件发现与phase_defused有关</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">00000000004015c4 &lt;phase_defused&gt;:</span><br><span class="line">  4015c4:       48 83 ec 78             sub    $0x78,%rsp</span><br><span class="line">  4015c8:       64 48 8b 04 25 28 00    mov    %fs:0x28,%rax</span><br><span class="line">  4015cf:       00 00 </span><br><span class="line">  4015d1:       48 89 44 24 68          mov    %rax,0x68(%rsp)</span><br><span class="line">  4015d6:       31 c0                   xor    %eax,%eax</span><br><span class="line">  4015d8:       83 3d 81 21 20 00 06    cmpl   $0x6,0x202181(%rip)        # 603760 &lt;num_input_strings&gt;</span><br><span class="line">  4015df:       75 5e                   jne    40163f &lt;phase_defused+0x7b&gt;</span><br><span class="line">  4015e1:       4c 8d 44 24 10          lea    0x10(%rsp),%r8</span><br><span class="line">  4015e6:       48 8d 4c 24 0c          lea    0xc(%rsp),%rcx</span><br><span class="line">  4015eb:       48 8d 54 24 08          lea    0x8(%rsp),%rdx</span><br><span class="line">  4015f0:       be 19 26 40 00          mov    $0x402619,%esi</span><br><span class="line">  4015f5:       bf 70 38 60 00          mov    $0x603870,%edi</span><br><span class="line">  4015fa:       e8 f1 f5 ff ff          callq  400bf0 &lt;__isoc99_sscanf@plt&gt;</span><br><span class="line">  4015ff:       83 f8 03                cmp    $0x3,%eax</span><br><span class="line">  401602:       75 31                   jne    401635 &lt;phase_defused+0x71&gt;</span><br><span class="line">  401604:       be 22 26 40 00          mov    $0x402622,%esi</span><br><span class="line">  401609:       48 8d 7c 24 10          lea    0x10(%rsp),%rdi</span><br><span class="line">  40160e:       e8 25 fd ff ff          callq  401338 &lt;strings_not_equal&gt;</span><br><span class="line">  401613:       85 c0                   test   %eax,%eax</span><br><span class="line">  401615:       75 1e                   jne    401635 &lt;phase_defused+0x71&gt;</span><br><span class="line">  401617:       bf f8 24 40 00          mov    $0x4024f8,%edi</span><br><span class="line">  40161c:       e8 ef f4 ff ff          callq  400b10 &lt;puts@plt&gt;</span><br><span class="line">  401621:       bf 20 25 40 00          mov    $0x402520,%edi</span><br><span class="line">  401626:       e8 e5 f4 ff ff          callq  400b10 &lt;puts@plt&gt;</span><br></pre></td></tr></table></figure><p><img data-src="http://cdn.sekyoro.top/imgs/093840.png" alt="进入secret_phase的方法"></p><p>需要在第四题答案后加上这个字符串.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(gdb) x /s 0x603870</span><br><span class="line">0x603870 &lt;input_strings+240&gt;:   &quot;7 0&quot;</span><br><span class="line">(gdb) x /s 0x402619</span><br><span class="line">0x402619:       &quot;%d %d %s&quot;</span><br></pre></td></tr></table></figure><p>比较输入过的答案数量,等于6则进行特殊的测试.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">0x4015d8 &lt;phase_defused+20&gt;     cmpl   $0x6,0x202181(%rip)        # 0x603760 &lt;num_input_strings&gt;                                   │</span><br><span class="line">│  &gt;0x4015df &lt;phase_defused+27&gt;     jne    0x40163f &lt;phase_defused+123&gt;                                                                │</span><br><span class="line">│   0x4015e1 &lt;phase_defused+29&gt;     lea    0x10(%rsp),%r8                                                                              │</span><br><span class="line">│   0x4015e6 &lt;phase_defused+34&gt;     lea    0xc(%rsp),%rcx                                                                              │</span><br><span class="line">│   0x4015eb &lt;phase_defused+39&gt;     lea    0x8(%rsp),%rdx                                                                              │</span><br><span class="line">│   0x4015f0 &lt;phase_defused+44&gt;     mov    $0x402619,%esi                                                                              │</span><br><span class="line">│   0x4015f5 &lt;phase_defused+49&gt;     mov    $0x603870,%edi     </span><br></pre></td></tr></table></figure><p><img data-src="http://cdn.sekyoro.top/imgs/093844.png" alt="secrete_phase"></p><p>最后结果需要等于2</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">0000000000401204 &lt;fun7&gt;:</span><br><span class="line">  401204:       48 83 ec 08             sub    $0x8,%rsp</span><br><span class="line">  401208:       48 85 ff                test   %rdi,%rdi</span><br><span class="line">  40120b:       74 2b                   je     401238 &lt;fun7+0x34&gt;</span><br><span class="line">  40120d:       8b 17                   mov    (%rdi),%edx</span><br><span class="line">  40120f:       39 f2                   cmp    %esi,%edx</span><br><span class="line">  401211:       7e 0d                   jle    401220 &lt;fun7+0x1c&gt;</span><br><span class="line">  401213:       48 8b 7f 08             mov    0x8(%rdi),%rdi</span><br><span class="line">  401217:       e8 e8 ff ff ff          callq  401204 &lt;fun7&gt;</span><br><span class="line">  40121c:       01 c0                   add    %eax,%eax</span><br><span class="line">  40121e:       eb 1d                   jmp    40123d &lt;fun7+0x39&gt;</span><br><span class="line">  401220:       b8 00 00 00 00          mov    $0x0,%eax</span><br><span class="line">  401225:       39 f2                   cmp    %esi,%edx</span><br><span class="line">  401227:       74 14                   je     40123d &lt;fun7+0x39&gt;</span><br><span class="line">  401229:       48 8b 7f 10             mov    0x10(%rdi),%rdi</span><br><span class="line">  40122d:       e8 d2 ff ff ff          callq  401204 &lt;fun7&gt;</span><br><span class="line">  401232:       8d 44 00 01             lea    0x1(%rax,%rax,1),%eax</span><br><span class="line">  401236:       eb 05                   jmp    40123d &lt;fun7+0x39&gt;</span><br><span class="line">  401238:       b8 ff ff ff ff          mov    $0xffffffff,%eax</span><br><span class="line">  40123d:       48 83 c4 08             add    $0x8,%rsp</span><br><span class="line">  401241:       c3                      retq</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>需要等于一个类似二叉树中节点的值才能跳出来.</p><p><img data-src="http://cdn.sekyoro.top/imgs/093846.png" alt="fun7逻辑"></p><p>同时不能随便等于一个节点值,2 = 1+1,需要等与第二个节点值.如果给的参数值大于等于节点值才能进行进一步等于的比较</p><p><img data-src="http://cdn.sekyoro.top/imgs/093854.png" alt="全部完成"></p><p>gdb设置汇编代码风格,Linux下是AT&amp;T.</p><p><a href="https://blog.csdn.net/freezing111/article/details/70576865">Linux下gdb显示intel和at&amp;t汇编_freezing111的博客-CSDN博客</a></p><p><a href="https://blog.csdn.net/astrotycoon/article/details/8211754">使用vim编辑可执行文件—16进制模式_astrotycoon-CSDN博客</a></p><h2 id="结束语"><a href="#结束语" class="headerlink" title="结束语"></a>结束语</h2><p>网上搜到的资料</p><p><a href="https://www.jianshu.com/p/c219e4df2521">CSAPP: Bomb Lab 实验解析 - 简书 (jianshu.com)</a></p><p>IDA反汇编工具</p><p>做到后面不想写了…核心还是函数的一些知识和循环分支语句的汇编代码,传参用的寄存器.</p><p>注意第六题其实并不需要改变可执行文件,需要按顺序排列1-6,这里我直接改变的可执行文件…</p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      
        <tags>
            
            <tag> csapp </tag>
            
            <tag> bomb lab </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>疫情填报字段解析</title>
      <link href="2022/02/22/%E7%96%AB%E6%83%85%E5%A1%AB%E6%8A%A5%E5%AD%97%E6%AE%B5%E8%A7%A3%E6%9E%90/"/>
      <url>2022/02/22/%E7%96%AB%E6%83%85%E5%A1%AB%E6%8A%A5%E5%AD%97%E6%AE%B5%E8%A7%A3%E6%9E%90/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>弄着玩玩.<br><span id="more"></span></p><h2 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h2><p>首先去疫情填报这个网页下抓抓报文.可以在浏览器网络下看一下,凭借<del>敏锐</del>直觉,jsp结尾的比较可疑,表明是java web后台. jsp文件jrsb_xs.jsp</p><p>注意一下文件中的重要字段.比如这里用$.ajax()提交请求.比较经典的用JQuery提交异步请求.</p><p>值得注意的是,根据代码,在校学生和不在校学生提交的表单不一样.</p><h3 id="开始"><a href="#开始" class="headerlink" title="开始"></a>开始</h3><p>可以先看看点击提交按钮会发生什么.</p><p><img data-src="http://cdn.sekyoro.top/imgs/065539.png" alt="执行一个js函数"></p><p>点击填报信息跳转到js函数,然后会有一个承诺,注意go_sub函数并没有提交信息.而是将信息存了.</p><p>后面会说.然后点击确认提交.</p><p><img data-src="http://cdn.sekyoro.top/imgs/093603.png" alt="confirm"></p><p><img data-src="http://cdn.sekyoro.top/imgs/065539-1.png" alt="执行save函数"></p><p>有意思的是,在go_sub中代码将您填写的数据进行了检验(排除空值等),然后给了个paramData,很长.</p><p><img data-src="http://cdn.sekyoro.top/imgs/093604.png" alt="go_sub中的表单数据"></p><p>可惜的是貌似这个值并没有用到.因为go_sub中并没有提交表单请求,例如$.ajax().</p><p>而是在save函数中.</p><p><img data-src="http://cdn.sekyoro.top/imgs/093606.png" alt="save函数"></p><p>可以看到save函数中又进行了类似的操作.我对这两个函数进行了对比.</p><p>发现save这个函数还是比较新的,应该跟go_sub()不是同一时候写的,或者是后面改了的.</p><p>比如说go_sub中还是有对于经停武汉的的提醒.</p><p><img data-src="http://cdn.sekyoro.top/imgs/065544.png" alt="go_sub函数"></p><p>save中换成了经停中高风险地区,同时save中增加了更多的字段还有提交的函数,这个才是比较重要的.</p><p><img data-src="http://cdn.sekyoro.top/imgs/093607.png" alt="芭比q了"></p><p>同时发现了一个savefx函数,里面的字段比较少,但是现在还没使用,估计是之前用的.</p><p><img data-src="http://cdn.sekyoro.top/imgs/093609.png" alt="hsjc字段"></p><p><img data-src="http://cdn.sekyoro.top/imgs/093610.png" alt="savefx的表单"></p><p>post请求的正文就是我们要交的数据.一个一个看看.</p><p><img data-src="http://cdn.sekyoro.top/imgs/093612.png" alt="image-20220222150256115"></p><h3 id="1-hsjc"><a href="#1-hsjc" class="headerlink" title="1.hsjc"></a>1.hsjc</h3><p>明显的是是否进行了核酸检测.那个选项checked的话就是1.</p><p>有意思的是因为截止到现在(2022.2.22)没有在做核酸了.这个东西被隐藏了.</p><p><img data-src="http://cdn.sekyoro.top/imgs/093613.png" alt="已经被隐藏了"></p><p>同时我们发现hsjc使用拼音表示核酸检测的,所以猜测其他字段基本都是拼音表示的.</p><p>大家现在可以猜猜其他字段是什么意思.</p><p>后面就直接在jrsb_xs.jsp这个报文下搜索关键字就行了.</p><h3 id="2-sfczbcqca"><a href="#2-sfczbcqca" class="headerlink" title="2.sfczbcqca"></a>2.sfczbcqca</h3><p>这个字段貌似已经没用了.代码直接给它赋空字符.可以猜猜是什么意思.我就不猜了.</p><p><img data-src="http://cdn.sekyoro.top/imgs/065545.png" alt="赋为空值"></p><p>上图的其他四个字段现在也是没用的.</p><h3 id="3-actionType"><a href="#3-actionType" class="headerlink" title="3.actionType"></a>3.actionType</h3><p><img data-src="http://cdn.sekyoro.top/imgs/065547.png" alt="找值"></p><p>直接搜索就行了</p><p><img data-src="http://cdn.sekyoro.top/imgs/065549.png" alt="image-20220222151112854"></p><p>然后发现了这几个字段,不过都设置为隐藏了.</p><p>addRbxx我并不太懂是什么意思,不过如果都是这个字段那就是默认值了.</p><p>后面就是学号.</p><h3 id="4-szcsbm"><a href="#4-szcsbm" class="headerlink" title="4.szcsbm"></a>4.szcsbm</h3><p>所在城市编码,不过这个编码是这个代码表示的.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> szcsbm = $(<span class="string">&quot;input[name=&#x27;szcsbm&#x27;]:checked&quot;</span>).val();</span><br></pre></td></tr></table></figure><p><img data-src="http://cdn.sekyoro.top/imgs/093615.png" alt="四个选项"></p><p>四个选项从上到下依次为1,2,3,4.对应着szcsdm的值.也就是说如果你在校,就是1.</p><p>接下来就要做判断了.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (szcsbm == <span class="string">&#x27;2&#x27;</span>) &#123;</span><br><span class="line">                <span class="keyword">var</span> qx = $(<span class="string">&quot;#district&quot;</span>).val(); <span class="comment">//取值</span></span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">&quot;dsad&quot;</span> + qx);  <span class="comment">//debug??</span></span><br><span class="line">                <span class="keyword">if</span> (qx == <span class="string">&quot;610100&quot;</span> || qx == <span class="string">&quot;&quot;</span> || qx == <span class="literal">undefined</span>) &#123;</span><br><span class="line">                    $(<span class="string">&#x27;#iosDialog2 .weui-dialog__bd&#x27;</span>).html(<span class="string">&quot;请选择当前所在省市区/县！&quot;</span>);</span><br><span class="line">                    $(<span class="string">&#x27;#iosDialog2&#x27;</span>).fadeIn(<span class="number">200</span>);</span><br><span class="line">                    $(<span class="string">&quot;#district&quot;</span>).focus();</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">var</span> xaxxdz = $(<span class="string">&quot;#xaxxdz&quot;</span>).val();</span><br><span class="line">                <span class="keyword">if</span> (xaxxdz == <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line">                    $(<span class="string">&#x27;#iosDialog2 .weui-dialog__bd&#x27;</span>).html(<span class="string">&quot;根据防控要求，在西安人员需要填写当前详细居住信息&quot;</span>);</span><br><span class="line">                    $(<span class="string">&#x27;#iosDialog2&#x27;</span>).fadeIn(<span class="number">200</span>);</span><br><span class="line">                    $(<span class="string">&quot;#xaxxdz&quot;</span>).focus();</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                szcsbm = $(<span class="string">&quot;#district&quot;</span>).val();</span><br><span class="line">                szcsmc = $(<span class="string">&#x27;#province option&#x27;</span>).not(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">                    <span class="keyword">return</span> !<span class="built_in">this</span>.selected;</span><br><span class="line">                &#125;).text() + $(<span class="string">&#x27;#city option&#x27;</span>).not(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">                    <span class="keyword">return</span> !<span class="built_in">this</span>.selected;</span><br><span class="line">                &#125;).text() + $(<span class="string">&#x27;#district option&#x27;</span>).not(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">                    <span class="keyword">return</span> !<span class="built_in">this</span>.selected;</span><br><span class="line">                &#125;).text();</span><br><span class="line">                szcsmc += $(<span class="string">&quot;#xaxxdz&quot;</span>).val();</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (szcsbm == <span class="string">&#x27;3&#x27;</span>) &#123;</span><br><span class="line">                <span class="keyword">var</span> szcsbm = $(<span class="string">&quot;#district&quot;</span>).val();</span><br><span class="line">                <span class="keyword">if</span> ($(<span class="string">&#x27;#district&#x27;</span>).css(<span class="string">&#x27;display&#x27;</span>) == <span class="string">&#x27;none&#x27;</span>) &#123;</span><br><span class="line">                    <span class="keyword">var</span> city = $(<span class="string">&quot;#city&quot;</span>).val();</span><br><span class="line">                    <span class="keyword">if</span> (city == <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line">                        $(<span class="string">&#x27;#iosDialog2 .weui-dialog__bd&#x27;</span>).html(<span class="string">&quot;请选择当前所在省市！&quot;</span>);</span><br><span class="line">                        $(<span class="string">&#x27;#iosDialog2&#x27;</span>).fadeIn(<span class="number">200</span>);</span><br><span class="line">                        $(<span class="string">&quot;#city&quot;</span>).focus();</span><br><span class="line">                        <span class="keyword">return</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    szcsbm = city + <span class="string">&quot;00&quot;</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (szcsbm == <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line">                        $(<span class="string">&#x27;#iosDialog2 .weui-dialog__bd&#x27;</span>).html(<span class="string">&quot;请选择当前所在省市区/县！&quot;</span>);</span><br><span class="line">                        $(<span class="string">&#x27;#iosDialog2&#x27;</span>).fadeIn(<span class="number">200</span>);</span><br><span class="line">                        $(<span class="string">&quot;#district&quot;</span>).focus();</span><br><span class="line">                        <span class="keyword">return</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                szcsmc = $(<span class="string">&#x27;#province option&#x27;</span>).not(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">                    <span class="keyword">return</span> !<span class="built_in">this</span>.selected;</span><br><span class="line">                &#125;).text();</span><br><span class="line">                szcsmc += $(<span class="string">&#x27;#city option&#x27;</span>).not(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">                    <span class="keyword">return</span> !<span class="built_in">this</span>.selected;</span><br><span class="line">                &#125;).text();</span><br><span class="line">                <span class="keyword">if</span> ($(<span class="string">&#x27;#district&#x27;</span>).css(<span class="string">&#x27;display&#x27;</span>) != <span class="string">&#x27;none&#x27;</span>) &#123;</span><br><span class="line">                    szcsmc += $(<span class="string">&#x27;#district option&#x27;</span>).not(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">                        <span class="keyword">return</span> !<span class="built_in">this</span>.selected;</span><br><span class="line">                    &#125;).text();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (szcsbm == <span class="string">&#x27;4&#x27;</span>) &#123;</span><br><span class="line">                <span class="keyword">var</span> gwcs = $(<span class="string">&quot;#gwcs&quot;</span>).val();</span><br><span class="line">                <span class="keyword">if</span> (gwcs == <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line">                    $(<span class="string">&#x27;#iosDialog2 .weui-dialog__bd&#x27;</span>).html(<span class="string">&quot;请输入当前所在国外城市！&quot;</span>);</span><br><span class="line">                    $(<span class="string">&#x27;#iosDialog2&#x27;</span>).fadeIn(<span class="number">200</span>);</span><br><span class="line">                    $(<span class="string">&quot;#gwcs&quot;</span>).focus();</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                szcsmc = $(<span class="string">&quot;#gwcs&quot;</span>).val();</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (szcsbm == <span class="string">&#x27;1&#x27;</span>) &#123;</span><br><span class="line">                szcsmc = <span class="string">&quot;在学校&quot;</span>;</span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure><p>粗略看一看,它会根据所选择的地方产生一个szcsmc,如果是在学校那szcsmc就是在学校.如果不是就比较麻烦了.</p><p>如果选择在西安,就要求选择西安的某个区县.然后根据选择的区县对应的值,就是下面选项option的value.这个是城市编码,网上有.</p><p><img data-src="http://cdn.sekyoro.top/imgs/093617.png" alt="选择在西安"></p><p>还需要填写一个居住地址,不能为空.有意思的是,这里szcsmc还添加了其他的值.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//不得不吐槽一下,这个真是jquery一把梭...我Jquery就稍微看了一点真顶不住</span></span><br><span class="line">szcsmc = $(<span class="string">&#x27;#province option&#x27;</span>).not(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">                    <span class="keyword">return</span> !<span class="built_in">this</span>.selected;</span><br><span class="line">                &#125;).text() + $(<span class="string">&#x27;#city option&#x27;</span>).not(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">                    <span class="keyword">return</span> !<span class="built_in">this</span>.selected;</span><br><span class="line">                &#125;).text() + $(<span class="string">&#x27;#district option&#x27;</span>).not(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">                    <span class="keyword">return</span> !<span class="built_in">this</span>.selected;</span><br><span class="line">                &#125;).text();</span><br><span class="line">                szcsmc += $(<span class="string">&quot;#xaxxdz&quot;</span>).val();</span><br></pre></td></tr></table></figure><p>需要用到Jquery的知识,这里会把没有选择的值都从里面删除.其实就是剩下了陕西省西安市.</p><p>所以最后szcsmc字段就是陕西省西安市+区/县+现居住地址.</p><p>当明白其中一个其他的就好办了.</p><p>如果szcsbm==3,那么就去取#city的值,然后将szcsdm赋值city+”00”,这就是szcsdm的值.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">szcsmc = $(<span class="string">&#x27;#province option&#x27;</span>).not(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> !<span class="built_in">this</span>.selected;</span><br><span class="line">        &#125;).text();</span><br><span class="line">        szcsmc += $(<span class="string">&#x27;#city option&#x27;</span>).not(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> !<span class="built_in">this</span>.selected;</span><br><span class="line">        &#125;).text();</span><br><span class="line">        <span class="keyword">if</span> ($(<span class="string">&#x27;#district&#x27;</span>).css(<span class="string">&#x27;display&#x27;</span>) != <span class="string">&#x27;none&#x27;</span>) &#123;</span><br><span class="line">            szcsmc += $(<span class="string">&#x27;#district option&#x27;</span>).not(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> !<span class="built_in">this</span>.selected;</span><br><span class="line">            &#125;).text();</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><p>而szcsmc就是省+城市+(如果存在的区/县)编码.</p><p>如果在国外的话,szcsmc直接取输入框的值.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (szcsbm == <span class="string">&#x27;4&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> gwcs = $(<span class="string">&quot;#gwcs&quot;</span>).val();</span><br><span class="line">        <span class="keyword">if</span> (gwcs == <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line">            $(<span class="string">&#x27;#iosDialog2 .weui-dialog__bd&#x27;</span>).html(<span class="string">&quot;请输入当前所在国外城市！&quot;</span>);</span><br><span class="line">            $(<span class="string">&#x27;#iosDialog2&#x27;</span>).fadeIn(<span class="number">200</span>);</span><br><span class="line">            $(<span class="string">&quot;#gwcs&quot;</span>).focus();</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        szcsmc = $(<span class="string">&quot;#gwcs&quot;</span>).val();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>到这里其实最复杂的就过去了,主要就是获得城市的编码.</p><h3 id="5-sfjt"><a href="#5-sfjt" class="headerlink" title="5.sfjt"></a>5.sfjt</h3><p>这个字段表示是否经停.别问我怎么知道的.</p><p><img data-src="http://cdn.sekyoro.top/imgs/093618.png" alt="sfjt"></p><p>有三个值,跟三个选项对应.从上到下分别是0,1,2.我怕麻烦,直接默认1即可不然还要填写经停的信息.</p><p><img data-src="http://cdn.sekyoro.top/imgs/093620.png" alt="检测代码"></p><p>可以看到sfjt设置为0的话就不用去填写sfjtsm了.</p><h3 id="6-sfjcry"><a href="#6-sfjcry" class="headerlink" title="6.sfjcry"></a>6.sfjcry</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> sfjcry = $(<span class="string">&quot;input[name=&#x27;radio3&#x27;]:checked&quot;</span>).val();</span><br><span class="line">    <span class="keyword">var</span> sfjcrysm = $(<span class="string">&quot;#hbjry_ms&quot;</span>).val();</span><br><span class="line">    <span class="keyword">if</span> (sfjcry == <span class="string">&#x27;1&#x27;</span> || sfjcry == <span class="string">&#x27;2&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (sfjcrysm == <span class="string">&#x27;&#x27;</span>) &#123;</span><br><span class="line">            $(<span class="string">&#x27;#iosDialog2 .weui-dialog__bd&#x27;</span>).html(<span class="string">&quot;请选择近15天接触过出入或居住在中高风险地区的人员，以及其他有新冠患者病例报告的发热或呼吸道症状患者！&quot;</span>);</span><br><span class="line">            $(<span class="string">&#x27;#iosDialog2&#x27;</span>).fadeIn(<span class="number">200</span>);</span><br><span class="line">            $(<span class="string">&quot;#hbjry_ms&quot;</span>).focus();</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>是否接触人员,道理类似.三个选项依次为0,1,2.只要设置sfjcry为0,就能不用填sfjcrysm了.</p><h3 id="7-sfjcqz"><a href="#7-sfjcqz" class="headerlink" title="7.sfjcqz"></a>7.sfjcqz</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> sfjcqz = $(<span class="string">&quot;input[name=&#x27;radio4&#x27;]:checked&quot;</span>).val();</span><br><span class="line">   <span class="keyword">var</span> sfjcqzsm = $(<span class="string">&quot;#sfjcqzsm&quot;</span>).val();</span><br><span class="line">   <span class="keyword">if</span> (sfjcqz == <span class="string">&#x27;1&#x27;</span>) &#123;</span><br><span class="line">       <span class="keyword">if</span> (sfjcqzsm == <span class="string">&#x27;&#x27;</span>) &#123;</span><br><span class="line">           $(<span class="string">&#x27;#iosDialog2 .weui-dialog__bd&#x27;</span>).html(<span class="string">&quot;请选择近15天您或家属是否接触过疑似或确诊患者，或无症状感染患者（核酸检测阳性者）！&quot;</span>);</span><br><span class="line">           $(<span class="string">&#x27;#iosDialog2&#x27;</span>).fadeIn(<span class="number">200</span>);</span><br><span class="line">           $(<span class="string">&quot;#sfjcqzsm&quot;</span>).focus();</span><br><span class="line">           <span class="keyword">return</span>;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>是否接触确诊.两个选项,0,1.设置为0即可.这样后面的信息不用填.</p><h3 id="8-sfyzz"><a href="#8-sfyzz" class="headerlink" title="8.sfyzz"></a>8.sfyzz</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> sfyzz = $(<span class="string">&quot;input[name=&#x27;radio5&#x27;]:checked&quot;</span>).val();</span><br><span class="line">    <span class="keyword">var</span> sfqz_array = <span class="keyword">new</span> <span class="built_in">Array</span>();</span><br><span class="line">    $(<span class="string">&#x27;input[name=&quot;radio6&quot;]:checked&#x27;</span>).each(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        sfqz_array.push($(<span class="built_in">this</span>).val());</span><br><span class="line">        <span class="comment">//向数组中添加元素  </span></span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure><p>是否有症状,说实话我就照着敲拼音就知道字段的意思了.</p><p><del>两个值,0,1.设置0无症状.</del>妈的把我骗了,这个字段表示体温范围.4个值0~3.</p><p>sfqz_array疑似症状,可多选.</p><p><img data-src="http://cdn.sekyoro.top/imgs/093621.png" alt="疑似症状"></p><p>从上到下值依次为0,1,6,7,8.会把这些值加入数组.然后join为字符串.得到sfqz</p><h3 id="9-ycqksm"><a href="#9-ycqksm" class="headerlink" title="9.ycqksm"></a>9.ycqksm</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> ycqksm = $(<span class="string">&quot;#ycqk_ms&quot;</span>).val();</span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">undefined</span> == sfqz || sfqz == <span class="string">&#x27;&#x27;</span>) &#123;</span><br><span class="line">        $(<span class="string">&#x27;#iosDialog2 .weui-dialog__bd&#x27;</span>).html(<span class="string">&quot;请选择您或家属有无疑似症状！&quot;</span>);</span><br><span class="line">        $(<span class="string">&#x27;#iosDialog2&#x27;</span>).fadeIn(<span class="number">200</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (sfqz != <span class="string">&#x27;0&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (ycqksm == <span class="string">&#x27;&#x27;</span>) &#123;</span><br><span class="line">            $(<span class="string">&#x27;#iosDialog2 .weui-dialog__bd&#x27;</span>).html(<span class="string">&quot;请简单描述一下您或家属的疑似情况！&quot;</span>);</span><br><span class="line">            $(<span class="string">&#x27;#iosDialog2&#x27;</span>).fadeIn(<span class="number">200</span>);</span><br><span class="line">            $(<span class="string">&quot;#ycqk_ms&quot;</span>).focus();</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>这个字段是选择了有疑似症状,也就是sfqz不是0时需要填写的.如果sfqz是0的话就不用写了.</p><p><img data-src="http://cdn.sekyoro.top/imgs/093622.png" alt="ycqksm字段"></p><h3 id="10-glqk"><a href="#10-glqk" class="headerlink" title="10.glqk"></a>10.glqk</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> glqk = $(<span class="string">&quot;input[name=&#x27;radio7&#x27;]:checked&quot;</span>).val();</span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">undefined</span> == glqk || glqk == <span class="string">&#x27;&#x27;</span>) &#123;</span><br><span class="line">        $(<span class="string">&#x27;#iosDialog2 .weui-dialog__bd&#x27;</span>).html(<span class="string">&quot;请选择是否隔离及隔离情况！&quot;</span>);</span><br><span class="line">        $(<span class="string">&#x27;#iosDialog2&#x27;</span>).fadeIn(<span class="number">200</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>隔离情况.<img data-src="http://cdn.sekyoro.top/imgs/093624.png" alt="隔离情况"></p><p>4个值0~3.设置0就对了.</p><h3 id="11-glksrq"><a href="#11-glksrq" class="headerlink" title="11.glksrq"></a>11.glksrq</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> glksrq = $(<span class="string">&quot;#glksrq&quot;</span>).val();</span><br><span class="line">   <span class="keyword">var</span> gljsrq = $(<span class="string">&quot;#gljsrq&quot;</span>).val();</span><br><span class="line">   <span class="keyword">var</span> glyy = $(<span class="string">&quot;#glyy&quot;</span>).val();</span><br><span class="line">   <span class="keyword">if</span> (glqk != <span class="string">&#x27;0&#x27;</span>) &#123;</span><br><span class="line">       <span class="keyword">if</span> (glksrq == <span class="string">&#x27;&#x27;</span>) &#123;</span><br><span class="line">           $(<span class="string">&#x27;#iosDialog2 .weui-dialog__bd&#x27;</span>).html(<span class="string">&quot;请选择隔离开始日期！&quot;</span>);</span><br><span class="line">           $(<span class="string">&#x27;#iosDialog2&#x27;</span>).fadeIn(<span class="number">200</span>);</span><br><span class="line">           <span class="keyword">return</span>;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">if</span> (gljsrq == <span class="string">&#x27;&#x27;</span>) &#123;</span><br><span class="line">           $(<span class="string">&#x27;#iosDialog2 .weui-dialog__bd&#x27;</span>).html(<span class="string">&quot;请选择隔离结束日期！&quot;</span>);</span><br><span class="line">           $(<span class="string">&#x27;#iosDialog2&#x27;</span>).fadeIn(<span class="number">200</span>);</span><br><span class="line">           <span class="keyword">return</span>;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">if</span> (glyy == <span class="string">&#x27;&#x27;</span>) &#123;</span><br><span class="line">           $(<span class="string">&#x27;#iosDialog2 .weui-dialog__bd&#x27;</span>).html(<span class="string">&quot;请输入隔离原因！&quot;</span>);</span><br><span class="line">           $(<span class="string">&#x27;#iosDialog2&#x27;</span>).fadeIn(<span class="number">200</span>);</span><br><span class="line">           <span class="keyword">return</span>;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>这些其实就是隔离情况了.只要不选择隔离就行了.太麻烦,</p><p><img data-src="http://cdn.sekyoro.top/imgs/093625.png" alt="隔离信息"></p><p>glksrq,gljsrq,glyy字段就是上面这三个值.我们可以看到直接空值(或者不发送这个数据都行)</p><h3 id="12-tbly"><a href="#12-tbly" class="headerlink" title="12.tbly"></a>12.tbly</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> tbly = $(<span class="string">&quot;#tbly&quot;</span>).val();</span><br><span class="line"><span class="keyword">var</span> qtqksm = $(<span class="string">&quot;#qtqksm&quot;</span>).val();</span><br></pre></td></tr></table></figure><p><img data-src="http://cdn.sekyoro.top/imgs/093627.png" alt="默认的值"></p><p>sso应该是默认值,是吧,应该是吧.だよね！</p><p>qtqksm就是最后的情况说明.空即可.</p><h3 id="13-sfjkqk"><a href="#13-sfjkqk" class="headerlink" title="13.sfjkqk"></a>13.sfjkqk</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> sfjkqk = $(<span class="string">&quot;input[name=&#x27;radio8&#x27;]:checked&quot;</span>).val();</span><br><span class="line">    <span class="keyword">var</span> jkqksm = $(<span class="string">&quot;#jkqk_ms&quot;</span>).val();</span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">undefined</span> == sfjkqk || sfjkqk == <span class="string">&#x27;&#x27;</span>) &#123;</span><br><span class="line">        $(<span class="string">&#x27;#iosDialog2 .weui-dialog__bd&#x27;</span>).html(<span class="string">&quot;请选择您或家属当前健康状态！&quot;</span>);</span><br><span class="line">        $(<span class="string">&#x27;#iosDialog2&#x27;</span>).fadeIn(<span class="number">200</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (sfjkqk != <span class="string">&#x27;0&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (jkqksm == <span class="string">&#x27;&#x27;</span>) &#123;</span><br><span class="line">            $(<span class="string">&#x27;#iosDialog2 .weui-dialog__bd&#x27;</span>).html(<span class="string">&quot;请简单描述一下您或家属的健康情况！&quot;</span>);</span><br><span class="line">            $(<span class="string">&#x27;#iosDialog2&#x27;</span>).fadeIn(<span class="number">200</span>);</span><br><span class="line">            $(<span class="string">&quot;#jkqk_ms&quot;</span>).focus();</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>表示是否健康情况</p><p><img data-src="http://cdn.sekyoro.top/imgs/093629.png" alt="健康情况"></p><p>五个值注意是0,2,3,4,5.选0即可.否则jkqksm字段又要填写信息.</p><p>OK,剩下的字段都是服务器发过来的,我们爬取到报文后正则或者其他方式直接获取就可以了.</p><p>此外注意一下$.ajax发的网址,这个字段很重要.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url: <span class="string">&#x27;ry_util.jsp?sign=xxx&amp;timeStamp=xxx&#x27;</span></span><br></pre></td></tr></table></figure><p>抓取报文后直接往这个网址发.</p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>可以看到很多字段其实不用写都行,因为只要没有被隔离或者出现症状,那些信息就不用填.</p><p>最重要的是城市编码(1,2,3,4)和城市名称(行政区划分编码).</p><p>同时,我在最开始提到,返校后的程序是go_subfx以及savefx.有一点差别.</p><p>比如说有xasymt字段.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//xasymt 字段 表示西安市一码通  </span></span><br><span class="line"><span class="keyword">var</span> xasymt = $(<span class="string">&#x27;input[type=radio][name=radio11]:checked&#x27;</span>).val();</span><br><span class="line">            <span class="keyword">if</span> (!xasymt) &#123;</span><br><span class="line">                $(<span class="string">&#x27;#iosDialog2 .weui-dialog__bd&#x27;</span>).html(<span class="string">&quot;请选择西安市一码通是否绿码！&quot;</span>);</span><br><span class="line">                $(<span class="string">&#x27;#iosDialog2&#x27;</span>).fadeIn(<span class="number">200</span>);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure><p>同样的操作,我尝试在html中找到这个input,可惜并没有.连隐藏都没有.也就是现在并没有这个西安一码通是否绿码的选项了.</p><h2 id="题外话"><a href="#题外话" class="headerlink" title="题外话"></a>题外话</h2><p>这篇文章并不是想写一个爬虫自动打卡的(事实上我的博客中已经写过了,不管是笨重的selenium还是直接post),也不是逆向,因为这也不足以涉及到逆向的知识.主要目的是在自动打卡时避免出现打卡失败或者错误的情况,了解这些字段的意义还是很重要的.</p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      
        <tags>
            
            <tag> js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Electron学习</title>
      <link href="2022/02/18/Electron%E5%AD%A6%E4%B9%A0/"/>
      <url>2022/02/18/Electron%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>个人看法是利用主要利用前端技术<strong>快速</strong>开发跨平台应用程序.趁现在发展还不错(至少比winform,wpf,qt,安卓开发更年轻)</p><span id="more"></span><h2 id="知识点"><a href="#知识点" class="headerlink" title="知识点"></a>知识点</h2><h3 id="流程模型"><a href="#流程模型" class="headerlink" title="流程模型"></a>流程模型</h3><p>Electron是多进程的,因为单进程意味着一个网站的崩溃或无响应会影响到整个浏览器.</p><p>Electron 应用程序的结构非常相似。 作为应用开发者，你将控制两种类型的进程：<a href="https://www.electronjs.org/zh/docs/latest/tutorial/process-model#the-main-process">主进程</a> 和 <a href="https://www.electronjs.org/zh/docs/latest/tutorial/process-model#the-renderer-process">渲染器进程</a>。 这类似于上文所述的 Chrome 的浏览器和渲染器进程。</p><h4 id="主进程"><a href="#主进程" class="headerlink" title="主进程"></a>主进程</h4><p>每个 Electron 应用都有一个单一的主进程，作为应用程序的入口点。 主进程在 Node.js 环境中运行，这意味着它具有 <code>require</code> 模块和使用所有 Node.js API 的能力</p><p><strong>窗口管理</strong></p><p>主进程的主要目的是使用 <a href="https://www.electronjs.org/zh/docs/latest/api/browser-window"><code>BrowserWindow</code></a> 模块创建和管理应用程序窗口。</p><p><code>BrowserWindow</code> 类的每个实例创建一个应用程序窗口，且在单独的渲染器进程中加载一个网页。 从主进程用 window 的 <a href="https://www.electronjs.org/zh/docs/latest/api/web-contents"><code>webContent</code></a> 对象与网页内容进行交互。</p><p>由于 <code>BrowserWindow</code> 模块是一个 <a href="https://nodejs.org/api/events.html#events_class_eventemitter"><code>EventEmitter</code></a>， 所以您也可以为各种用户事件 ( 例如，最小化 或 最大化您的窗口 ) 添加处理程序。</p><p>当一个 <code>BrowserWindow</code> 实例被销毁时，与其相应的渲染器进程也会被终止</p><p>下面介绍一下EventEmitter类</p><p>Node.js 所有的异步 I/O 操作在完成时都会发送一个事件到事件队列。</p><p>Node.js 里面的许多对象都会分发事件：一个 net.Server 对象会在每次有新连接时触发一个事件， 一个 fs.readStream 对象会在文件被打开的时候触发一个事件。 所有这些产生事件的对象都是 events.EventEmitter 的实例。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//event.js 文件</span></span><br><span class="line"><span class="keyword">var</span> EventEmitter = <span class="built_in">require</span>(<span class="string">&#x27;events&#x27;</span>).EventEmitter; </span><br><span class="line"><span class="keyword">var</span> event = <span class="keyword">new</span> EventEmitter(); </span><br><span class="line">event.on(<span class="string">&#x27;some_event&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;some_event 事件触发&#x27;</span>); </span><br><span class="line">&#125;); </span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">    event.emit(<span class="string">&#x27;some_event&#x27;</span>); </span><br><span class="line">&#125;, <span class="number">1000</span>); </span><br></pre></td></tr></table></figure><p><strong>应用程序生命周期</strong></p><p>主进程还能通过 Electron 的 <a href="https://www.electronjs.org/zh/docs/latest/api/app"><code>app</code></a> 模块来控制您应用程序的生命周期。 该模块提供了一整套的事件和方法，可以让您用来添加自定义的应用程序行为 (例如：以编程方式退出您的应用程序、修改应用程序坞，或显示一个关于面板) </p><p><strong>原生 API</strong></p><p>为了使 Electron 的功能不仅仅限于对网页内容的封装，主进程也添加了自定义的 API 来与用户的作业系统进行交互。 Electron 有着多种控制原生桌面功能的模块，例如菜单、对话框以及托盘图标。</p><h3 id="预加载脚本"><a href="#预加载脚本" class="headerlink" title="预加载脚本"></a>预加载脚本</h3><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      
        <tags>
            
            <tag> Electron </tag>
            
            <tag> front </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>pyqt学习</title>
      <link href="2022/02/04/pyqt%E5%AD%A6%E4%B9%A0/"/>
      <url>2022/02/04/pyqt%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>桌面编程,基本就是Qt和winform、WPF.我为什么会用PyQt呢?大概是对于c++没感觉.winform又不能跨平台而且python好开发吧.当然,这也注定了这种一般都是小工具啥的.<br><span id="more"></span><br>在进行这种编程时,我的体会就是不要太关注控件.应该关注这种设计.<br>这种开发一般是会涉及到多线程编程的.应该关注这种机制.</p><p><strong>PyQt5 主要学习内容</strong></p><ul><li>PyQt5 基本窗口控件：QMainWindow、Qwidget、Qlabel、QLineEdit、菜单、工具栏等</li><li>PyQt5 高级组件：QTableView、容器等</li><li>PyQt5 布局管理：QBoxLayout、QGridLayout、QFormLayout、嵌套布局等</li><li>PyQt5 信号与槽：事件处理、数据传递等</li><li>PyQt5 图形与特效：定制窗口风格、QSS 样式表与 GUI 界面美化等</li><li>PyQt5 扩展应用：制作 PyQt5 安装程序和数据处理等</li></ul><p>值得注意的是,现在Qt6都有了.</p><div class="table-container"><table><thead><tr><th>模块</th><th>功能</th></tr></thead><tbody><tr><td>QtCore</td><td>包含了核心的非 GUI 的功能，主要和时间、文件与文件夹、各种数据、流、URL、mime 类文件、进程与线程一起使用。</td></tr><tr><td>QtGui</td><td>包含了窗口系统、事件处理、2D 图像、基本绘画、字体和文字类。</td></tr><tr><td>QtWidgets</td><td>类包含了一系列创建桌面应用的 UI 元素。</td></tr><tr><td>QtMultimedia</td><td>包含了处理多媒体的内容和调用摄像头 API 的类。</td></tr><tr><td>QtBluetooth</td><td>模块包含了查找和连接蓝牙的类。</td></tr><tr><td>QtNetwork</td><td>包含了（TCP/IP/UDP）网络编程的类。</td></tr><tr><td>QtPositioning</td><td>包含了定位的类，可以使用卫星、WiFi 甚至文本。</td></tr><tr><td>Engine</td><td>包含了通过客户端进入和管理 Qt Cloud 的类。</td></tr><tr><td>QtWebSockets</td><td>包含了 WebSocket 协议的类。</td></tr><tr><td>QtWebKit</td><td>包含了一个基 WebKit2 的 web 浏览器。</td></tr><tr><td>QtWebKitWidgets</td><td>包含了基于 QtWidgets 的 WebKit1 的类。</td></tr><tr><td>QtXml</td><td>包含了处理 xml 的类，提供了 SAX 和 DOM API 的工具。</td></tr><tr><td>QtSvg</td><td>提供了显示 SVG 内容的类。</td></tr><tr><td>QtSql</td><td>提供了处理数据库的工具。</td></tr><tr><td>QtTest</td><td>提供了测试 PyQt5 应用的工具。</td></tr></tbody></table></div><div class="table-container"><table><thead><tr><th>模块</th><th>功能</th></tr></thead><tbody><tr><td>QtCore</td><td>包含了核心的非 GUI 的功能，主要和时间、文件与文件夹、各种数据、流、URL、mime 类文件、进程与线程一起使用。</td></tr><tr><td>QtGui</td><td>包含了窗口系统、事件处理、2D 图像、基本绘画、字体和文字类。</td></tr><tr><td>QtWidgets</td><td>类包含了一系列创建桌面应用的 UI 元素。</td></tr><tr><td>QtMultimedia</td><td>包含了处理多媒体的内容和调用摄像头 API 的类。</td></tr><tr><td>QtBluetooth</td><td>模块包含了查找和连接蓝牙的类。</td></tr><tr><td>QtNetwork</td><td>包含了（TCP/IP/UDP）网络编程的类。</td></tr><tr><td>QtPositioning</td><td>包含了定位的类，可以使用卫星、WiFi 甚至文本。</td></tr><tr><td>Engine</td><td>包含了通过客户端进入和管理 Qt Cloud 的类。</td></tr><tr><td>QtWebSockets</td><td>包含了 WebSocket 协议的类。</td></tr><tr><td>QtWebKit</td><td>包含了一个基 WebKit2 的 web 浏览器。</td></tr><tr><td>QtWebKitWidgets</td><td>包含了基于 QtWidgets 的 WebKit1 的类。</td></tr><tr><td>QtXml</td><td>包含了处理 xml 的类，提供了 SAX 和 DOM API 的工具。</td></tr><tr><td>QtSvg</td><td>提供了显示 SVG 内容的类。</td></tr><tr><td>QtSql</td><td>提供了处理数据库的工具。</td></tr><tr><td>QtTest</td><td>提供了测试 PyQt5 应用的工具。</td></tr></tbody></table></div><p>重点掌握 QtWidgets、QtGui、QtCore 模块的功能</p><h2 id="搭建环境"><a href="#搭建环境" class="headerlink" title="搭建环境"></a>搭建环境</h2><p>创建虚拟环境避免模块冲突.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">virtualenv qt5env <span class="comment">#或使用pycharm直接创建虚拟环境.</span></span><br><span class="line">source qt5env/<span class="built_in">bin</span>/activate  <span class="comment">#Linux环境下激活虚拟环境</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip intall pyqt5</span><br></pre></td></tr></table></figure><p>值得注意的是,python与qt有两个包.另一个是pyside Qt官方的.免费可商用.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> PyQt5.QtWidgets <span class="keyword">import</span> QApplication,QWidget</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app = QApplication(sys.argv)</span><br><span class="line">    w = QWidget()</span><br><span class="line"></span><br><span class="line">    w.resize(<span class="number">250</span>,<span class="number">150</span>)</span><br><span class="line">    w.move(<span class="number">300</span>,<span class="number">300</span>)</span><br><span class="line">    w.setWindowTitle(<span class="string">&quot;我的第一个qt应用&quot;</span>)</span><br><span class="line">    w.show()</span><br><span class="line">    sys.exit(app.<span class="built_in">exec</span>())</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> PyQt5.QtWidgets <span class="keyword">import</span> QApplication,QWidget</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Example</span>(<span class="params">QWidget</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span>  <span class="comment">#构造函数</span></span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        self.initUI()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">initUI</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.setGeometry(<span class="number">400</span>,<span class="number">300</span>,<span class="number">400</span>,<span class="number">300</span>)</span><br><span class="line">        self.show()</span><br><span class="line">        self.setWindowTitle(<span class="string">&quot;你好&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app = QApplication(sys.argv)</span><br><span class="line">    e = Example()</span><br><span class="line">    sys.exit(app.exec_())</span><br></pre></td></tr></table></figure><ul><li>控件 + 布局：控件与布局类似于 HMTL 中的标签和定位，要是有 HTML 基础，学习这一块上手非常容易，要是没有接触过也没关系，本课程将手把手教大家学习</li><li>QSS 样式：QSS 类似于 CSS 样式表，语法上都是相通的</li><li>信号与槽：信号与槽充当 JS 的角色，但是比 JS 更加强大，它能够完全将界面和代码隔离，你只需要负责开发相应的业务逻辑即可，不需要了解界面是如何运行的</li></ul><h3 id="QtGUI"><a href="#QtGUI" class="headerlink" title="QtGUI"></a>QtGUI</h3><p>在 Qt 中，QIcon 类提供了处于不同模式和状态下的可缩放图标，QIcon 可以把给定的一组像素图生成较小的像素图或较大的像素图，也可以将该组像素图设置为激活样式或禁用样式，Qt 窗口使用这些像素图来显示特定动作的图标。</p><p>QIcon 可以接受的参数类型：</p><ul><li><p>QIcon()：无参数，表示空图标</p></li><li><p><strong>QIcon(str)：str，str 为本地图片文件的路径</strong></p></li><li><p>QIcon(QPixmap)：参数为 QPixmap，可以加载到一个控件中，通常是标签或者按钮控件，用于在标签或按钮上显示图像</p></li><li><p>QIcon(QIcon)：参数为 QIcon 为对象</p></li><li><pre><code class="lang-python">import sysfrom PyQt5.QtGui import QIconfrom PyQt5.QtWidgets import QApplication, QWidget,QStyleclass Example(QWidget):    def __init__(self,icon):        super().__init__()        self.initui(icon)    def initui(self,icon=None):        self.move(100,0)        self.setWindowTitle(&quot;应用&quot;)        # self.setWindowIcon(icon)        self.setWindowIcon(QApplication.style().standardIcon(10))        # self.setWindowIcon(QIcon())        self.show()if __name__ == &#39;__main__&#39;:    app = QApplication(sys.argv)    # print(sys.argv)    icon = QIcon(&quot;./bella.png&quot;)    e = Example(icon)    sys.exit(app.exec_())</code></pre></li></ul><p>之前摆了一段时间.现在直接拿应用来写.</p><p>推荐一下github仓库</p><blockquote><p>git@github.com:taseikyo/PyQt5-Apps.git</p></blockquote><p>有很多应用小demo,挺实用的.(感觉桌面应用是一个无底洞啊)</p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      
        <tags>
            
            <tag> python </tag>
            
            <tag> Qt </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Web漏洞学习</title>
      <link href="2022/02/04/Web%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0/"/>
      <url>2022/02/04/Web%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>好奇<br><span id="more"></span></p><p>对于网络信息安全挺感兴趣的.</p><h2 id="SQL注入漏洞基础"><a href="#SQL注入漏洞基础" class="headerlink" title="SQL注入漏洞基础"></a>SQL注入漏洞基础</h2><ul><li>SQL 注入漏洞的原理</li><li>SQL 注入漏洞的分类</li><li>SQL 注入的利用技巧</li></ul><blockquote><p>SQL 注入攻击通过构建特殊的输入作为参数传入 Web 应用程序，而这些输入大都是 SQL 语法里的一些组合，通过执行 SQL 语句进而执行攻击者所要的操作</p></blockquote><p>SQL 注入攻击是通过将恶意的 SQL 语句插入到应用的输入参数中，再在后台数据库服务器上解析执行进行的攻击，它是目前黑客对数据库进行攻击的最常用手段之一.</p><p><strong>三层架构</strong>（<code>3-tier architecture</code>） 通常意义上就是将整个业务应用划分为：</p><ul><li>界面层（User Interface layer）</li><li>业务逻辑层（Business Logic Layer）</li><li>数据访问层（Data access layer）</li></ul><p>由数据库驱动的 Web 应用程序依从三层架构的思想分为了三层：</p><ul><li>表示层。</li><li>业务逻辑层（又称领域层）</li><li>数据访问层（又称存储层）</li></ul><p>写死到代码里的 SQL 语句执行不会有危险，但实际情况是很多时候需要<strong>结合用户的输入数据动态构造 SQL 语句</strong>，如果用户输入的数据被构造成恶意 SQL 代码，Web 应用又未对动态构造的 SQL 语句使用的参数进行审查，则会带来意想不到的危险。</p><p>SQL 注入带来的威胁主要有如下几点</p><ul><li>猜解后台数据库，这是利用最多的方式，盗取网站的敏感信息。</li><li>绕过认证，列如绕过验证登录网站后台。</li><li>注入可以借助数据库的存储过程进行提权等操作。</li></ul><p>步骤:</p><ul><li><strong>寻找注入点</strong>：指找到存在 SQL 注入的参数，SQL 注入大多发生在 GET 或 POST 请求的参数中，当然也有可能发生在其他地方，例如 UserAgent、Cookie 等</li><li><strong>判断注入类型/数据库类型</strong>：SQL 注入按照不同的分类标准，可以分成不同的种类。<ul><li>按照参数类型可分为两种：数字型和字符型。</li><li>根据数据库返回的结果，可分为回显注入、报错注入、盲注。</li><li>按照注入方法，还可以分为联合注入、堆叠注入、宽字节注入、延时注入等。</li></ul></li><li><strong>猜解数据库名</strong>：猜解后台数据库的库名</li><li><strong>猜解数据表名</strong>：成功猜解到数据库名称后，进一步猜解某一个特定数据库中数据表的名称</li><li><strong>猜解数据字段名</strong>：最后是某个特定数据库中特定数据表中的字段，因为获取到字段才能查询数据</li></ul><p>搭建DVWA,一个学习平台.</p><p>查到注入点后步骤.</p><p>查询数据库版本</p><p>version()  @@version_compile_os</p><ul><li><code>version()</code> 获取当前数据库版本.</li><li><code>@@version_compile_os</code> 获取当前操作系统。</li></ul><p>查询数据库名</p><ul><li><code>database()</code>将会返回当前网站所使用的数据库名字.</li><li><code>user()</code>将会返回执行当前查询的用户名.</li></ul><p>查询数据库表名</p><blockquote><p><em><code>information_schema</code> 是 mySQL 自带的一张表，这张数据表保存了 MySQL 服务器所有数据库的信息,如数据库名，数据库的表，表栏的数据类型与访问权限等。该数据库拥有一个名为 tables 的数据表，该表包含两个字段 table_name 和 table_schema，分别记录 DBMS 中的存储的表名和表名所在的数据库。</em></p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> table_name,table_schema <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema<span class="operator">=</span> <span class="string">&#x27;dvwa&#x27;</span></span><br></pre></td></tr></table></figure><p>猜解数据库字段名和爆库</p><p>依旧利用information_schema</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="number">1</span>,group_concat(column_name) <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name<span class="operator">=</span><span class="string">&#x27;users&#x27;</span> </span><br></pre></td></tr></table></figure><p>users是用户表,这里是猜测的.</p><p>得到结果users 表中有 8 个字段，分别是 user_id,first_name,last_name,<strong>user</strong>,<strong>password</strong>,avatar,last_login,failed_login。</p><p>然后直接查询user表的这些字段.</p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> security </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>python爬虫</title>
      <link href="2022/02/04/python%E7%88%AC%E8%99%AB/"/>
      <url>2022/02/04/python%E7%88%AC%E8%99%AB/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>一时兴起,做一个整理.不定期更新.<br><span id="more"></span></p><p>玩python爬虫断断续续一年了,<del>当然实际时间可能才几小时</del>&gt;</p><p>当理解到这个爬虫本质就是发送HTTP或HTTPS请求并对得到的数据进行分析就比较简单了.</p><h2 id="单件"><a href="#单件" class="headerlink" title="单件"></a>单件</h2><p>requests 构造请求  传入headers,cookie,referer等常会校验的字段.如果是POST请求还要传入表单数据data.这里就是发送请求.当然涉及到反爬虫,这中间涉及到东西就很多了,光反爬虫就可以出本书.JS逆向,表单字段的分析等.可以多看看视频实战分析.</p><blockquote><p>注:现在有requests-html,一样的作者.这个应该更好.</p></blockquote><p>得到的数据需要分析.re lxml BeautifulSoup. 实际上并不常用Bs,因为解析速度比较慢,而且完全可以被代替.一般信息不多直接正则就行了.</p><p><code>lxml</code> 是 Python 中一个常见的解析库，支持 HTML 与 XML 的解析，支持 <code>XPath</code> 解析方式</p><p>lxml解析文本为字符串后可以用xpath或cssselect选择节点.通过 <code>lxml</code> 解析之后的内容为一种特定类型的对象，一般称作 <code>Element</code> 对象.  html.fromstring(string) etree.HTML(string)</p><p>cssselect就是css选择器.获取属性get()  获取文本text() text_content()</p><p>xpath全称 XML Path Language，即 XML 路径语言，XPath 可以基于 XML 的树状结构，提供在数据结构树中找寻节点的能力。</p><p>bs  Beautiful Soup 4 是 Python 的一款解析库，为了书写方便下文统一用 bs4 来描述。跟 <code>lxml</code> 一样，bs4 也是一个 HTML/XML 解析库，主要配合 requests 库实现爬虫程序。</p><p>bs4 库默认使用的 Python 标准库中的 HTML 解析器，即 <code>html.parser</code>（Python 的内置标准库），使用该方式的解析速度慢，原因是该方式在解析的时候会载入整个文档之后再解析整个 DOM 树，导致内存开销变大，性能降低，所以现在使用 bs4 的时候都是配合 <code>lxml</code> 库进行，本实验也围绕 bs4 与 lxml 展开</p><p>ajax XHR </p><p>移动站点的爬取</p><blockquote><p>如果发现一个网站，当切换到移动端访问的时候，域名发生了变化，例如上述案例中 58 同城网站由 <code>https://www.58.com/</code> 变为了 <code>https://m.58.com/</code>，此时大概率网站的接口也是单独为移动端研发的，只要接口是单独研发，很容易出现逻辑上的疏漏，导致移动端站点的反爬度降低，所以当你找到一个网站存在移动站点，建议针对该移动站点编写爬虫。</p></blockquote><p>在爬取移动端接口的时候，需要注意一项内容，该内容为请求头中的 <code>User-Agent</code> 参数，前面的实验中已经对该参数进行了相关说明。该参数的内容会告知服务器客户端访问设备信息，所以在访问移动端网站的时候，建议使用特定的手机端浏览器 <code>UA</code>，该内容可直接在开发者工具中获取。</p><p>cookie的获取</p><h2 id="学习方向"><a href="#学习方向" class="headerlink" title="学习方向"></a>学习方向</h2><p>始终爬点图片或者文本总是没什么意思.</p><p>学习方向是从基础部分提高，到爬虫框架，到手机 APP 爬虫，再到分布式爬虫，每个领域都需要投入精力去学习与研究。</p><p><strong>多线程爬虫</strong></p><ol><li>Python <strong>threading</strong> 模块；</li><li>Python <strong>Queue</strong> 模块；</li><li>Python <strong>multiprocessing</strong> 模块；</li><li>Python <strong>asyncio</strong> 模块。</li></ol><p><strong>反爬</strong></p><p>基础部分除了爬虫效率外，还需要了解常见的反爬手段。之前的课程只提及了最简单的反爬手段，UA 判断，除了它以外，常见的反爬方式如下。</p><ol><li>验证码，需要掌握验证码识别技术；</li><li>IP 限制，需要学习代理相关知识；</li><li>字体反爬，JS 加密，需要学习前端加密相关知识。</li></ol><h4 id="爬虫框架"><a href="#爬虫框架" class="headerlink" title="爬虫框架"></a>爬虫框架</h4><p>在实际编码中 requests 只是最简单与最常用的爬虫库，在工作中还有 2 个常用爬虫框架需要掌握。</p><ol><li>scrapy</li><li>pyspider</li></ol><h4 id="手机-APP-爬虫"><a href="#手机-APP-爬虫" class="headerlink" title="手机 APP 爬虫"></a>手机 APP 爬虫</h4><p>本课程中所有实验都是针对 Web 端 PC 站点进行爬取，但这只是爬虫的一个方向。</p><p>随着移动互联网时代的兴起，手机 APP 爬取，也成为了爬虫工程师日常工作之一。</p><p>如何爬取手机 APP 内容，可以从下述内容开始学习。</p><ol><li>Fiddler 工具的使用；</li><li>Charles 工具的使用；</li><li>mitmproxy 与 mitmdump；</li><li>Appium。</li></ol><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
            <tag> 爬虫 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NLP学习</title>
      <link href="2022/02/03/NLP%E5%AD%A6%E4%B9%A0/"/>
      <url>2022/02/03/NLP%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>NLP即自然语言处理,入门学习一下.<br><span id="more"></span></p><p>从自然语言的角度出发，基本可以划分为两个部分：自然语言的理解和自然语言的生成</p><p>但总的来说，自然语言理解又可以分为三个方面：</p><ol><li>词义分析</li><li>句法分析</li><li>语义分析</li></ol><p>自然语言的生成则是从结构化的数据（可以通俗理解为自然语言理解分析后的数据）以读取的方式自动生成文本。主要有三个阶段：</p><ol><li>文本规划：完成结构化数据中的基础内容规划。</li><li>语句规划：从结构化数据中组合语句来表达信息流。</li><li>实现：产生语法通顺的语句来表达文本。</li></ol><h2 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h2><p>NLP 的一些基础专业术语。</p><ul><li>分词：词是 NLP 中能够独立活动的有意义的语言成分。即使某个中文单字也有活动的意义，但其实这些单字也是词，属于单字成词。</li><li>词性标注：给每个词语的词性进行标注，比如 ：跑/动词、美丽的/形容词等等。</li><li>命名实体识别：从文本中识别出具有特定类别的实体。像是识别文本中的日期，地名等等。</li><li>词义消歧：多义词判断最合理的词义。</li><li>句法分析：解析句子中各个成分的依赖关系。</li><li>指代消解：消除和解释代词「这个，他，你」等的指代问题。</li></ul><p>同时还要学习一些字符串的一些常见操作.正则表达式这些肯定是要比较熟练的.</p><p>demo.py</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 统计字串的出现次数</span></span><br><span class="line"><span class="comment"># .count() 方法返回特定的子串在字符串中出现的次数</span></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">count_example</span>():</span></span><br><span class="line">    <span class="built_in">str</span> = <span class="string">&quot;jalfjsalf;&quot;</span></span><br><span class="line">    n = <span class="built_in">str</span>.count(<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(n)</span><br><span class="line">    <span class="comment"># 可以看到python在处理这些操作时是十分简便的</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 去除字符串</span></span><br><span class="line"><span class="comment"># .strip()方法可以去除字符串首尾的指定符号。</span></span><br><span class="line"><span class="comment"># 无指定时，默认去除空格符 &#x27; &#x27; 和换行符 &#x27;\n&#x27;</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">strip_example</span>():</span></span><br><span class="line">    <span class="built_in">str</span> = <span class="string">&quot;asdfhjkasjkfas&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">str</span>.strip(<span class="string">&#x27;as&#x27;</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#     只想要去除字符串开头的某个字符串，但是字符串的末尾有一个同样的字符串并不需要去掉。</span></span><br><span class="line"><span class="comment">#     这时候可以使用 .lstrip() 方法</span></span><br><span class="line"><span class="comment">#     同理去掉末尾使用 .rstrip()</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">concate_example</span>():</span></span><br><span class="line">    seq1 = <span class="string">&quot;你&quot;</span></span><br><span class="line">    seq2 = <span class="string">&quot;好&quot;</span></span><br><span class="line">    seq = seq1 + seq2</span><br><span class="line">    <span class="built_in">print</span>(seq)</span><br><span class="line">    <span class="comment"># 需要将字符串用特定的符号拼接起来的字符的时候，可以用.join()</span></span><br><span class="line">    <span class="comment"># 方法来进行拼接</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;,&#x27;</span>.join([<span class="string">&quot;你好&quot;</span>, <span class="string">&quot;再见&quot;</span>]))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 字符串比较</span></span><br><span class="line"><span class="comment"># 当想要比较两个字符串的大小时，这里需要加载 operator 工具，</span></span><br><span class="line"><span class="comment"># 它是 Python 的标准库。不需要额外下载，</span></span><br><span class="line"><span class="comment"># 直接通过 import 调用即可。</span></span><br><span class="line"><span class="comment"># operator 从左到右第一个字符开始，根据设定的规则比较，返回布尔值（ True，False ）</span></span><br><span class="line"><span class="keyword">import</span> operator</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">compare_example</span>():</span></span><br><span class="line">    seq1 = <span class="string">&quot;字符串1号&quot;</span></span><br><span class="line">    seq2 = <span class="string">&quot;字符串2号&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(operator.lt(seq1, seq2))</span><br><span class="line">    <span class="built_in">print</span>(operator.le(seq1, seq2))</span><br><span class="line">    <span class="built_in">print</span>(operator.eq(seq1, seq2))</span><br><span class="line">    <span class="built_in">print</span>(operator.ne(seq1, seq2))</span><br><span class="line">    <span class="comment"># 另外可以直接使用&gt; &lt;比较字符串字典序</span></span><br><span class="line">    <span class="built_in">print</span>(seq1 &lt; seq2)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ulcase</span>():</span></span><br><span class="line">    <span class="built_in">str</span> = <span class="string">&quot;LkfLkas&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">str</span>.upper())</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">str</span>.lower())</span><br><span class="line"></span><br><span class="line"><span class="comment"># 字符串查找   find与index 如果没有找到 index会报错 find返回-1</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">find_str</span>():</span></span><br><span class="line">    <span class="built_in">str</span> = <span class="string">&quot;这是一段字符串&quot;</span></span><br><span class="line">    seq = <span class="string">&quot;一段&quot;</span></span><br><span class="line">    n = <span class="built_in">str</span>.find(seq)</span><br><span class="line">    <span class="built_in">print</span>(n)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 切分字符串</span></span><br><span class="line"><span class="comment"># 有两种常用的方法。第一种是直用序列截取的方法。</span></span><br><span class="line"><span class="comment"># 这种方法十分的简单，就是根据顺序来截取序列上你想要的某些片段。</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">spit_str</span>():</span></span><br><span class="line">    <span class="built_in">str</span> = <span class="string">&quot;你好,很好&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">str</span>[<span class="number">0</span>])</span><br><span class="line">    <span class="comment"># split() 函数可以完成这个操作, 函数返回一个由切分好的字符串组成的列表。</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">str</span>.split(<span class="string">&#x27;,&#x27;</span>))</span><br><span class="line"><span class="comment"># 需要翻转字符串的时候,那么我们直接用序列操作，</span></span><br><span class="line"><span class="comment"># 直接以上面截取序列的方法，但是按照逆向的来截取实现翻转</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">str</span>[::-<span class="number">1</span>])</span><br><span class="line"><span class="comment"># 判断字符串中是否存在某个字符</span></span><br><span class="line"><span class="comment"># in 关键字可以用在任何容器对象上，判断一个子对象是否存在于容器当中，并不局限于判断字符串是否存在某子串，</span></span><br><span class="line"><span class="comment"># 还可以用在其他容器对象例如 list []，tuple ()，set &#123;&#125; 等类型</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">in_example</span>():</span></span><br><span class="line">    <span class="built_in">str</span> = <span class="string">&quot;232434&quot;</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;2&#x27;</span> <span class="keyword">in</span> <span class="built_in">str</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;exists&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 有时需要把字符串中的某段字符串用另一段字符串代替</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">replace_str</span>():</span></span><br><span class="line">    seq = <span class="string">&quot;l;fjasfkfkla&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(seq.replace(<span class="string">&quot;l&quot;</span>,<span class="string">&quot;a&quot;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 当遇到需要判断字符串是否以某段字符开头的时候。比如想要判断 ‘abcdefg’ 是否以 &#x27;a&#x27; 开头。</span></span><br><span class="line"><span class="comment"># 可以用 .startswish() 方法</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">startswith</span>():</span></span><br><span class="line">    seq = <span class="string">&quot;afljsaakl&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(seq.startswith(<span class="string">&#x27;akl&#x27;</span>))</span><br><span class="line">    <span class="built_in">print</span>(seq.endswith(<span class="string">&#x27;akl&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">isDigit</span>():</span></span><br><span class="line">    <span class="comment"># 当想要检查字符串的构成，像是检查字符串是否由纯数字构成。</span></span><br><span class="line">    seq = <span class="string">&quot;hjkhfahkjas&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(seq.isdigit())</span><br><span class="line">    <span class="comment"># seq.isalnum()</span></span><br><span class="line">    <span class="comment"># seq.isalpha()</span></span><br><span class="line">    <span class="comment"># seq.isdecimal()</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">regresson</span>():</span></span><br><span class="line">    pattern = re.<span class="built_in">compile</span>(<span class="string">r&#x27;[0-9]&#123;4&#125;&#x27;</span>)</span><br><span class="line">    <span class="comment"># 正则规则</span></span><br><span class="line">    match = pattern.search(<span class="string">&quot;432432532564&quot;</span>)  <span class="comment">#search查找</span></span><br><span class="line">    <span class="comment"># print(match) #对象 &lt;re.Match object; span=(0, 4), match=&#x27;4324&#x27;&gt;</span></span><br><span class="line">    <span class="built_in">print</span>(match.group(<span class="number">0</span>))  <span class="comment">#group中有匹配结果</span></span><br><span class="line"><span class="comment">#    这个方法是将正则表达式与字符串进行匹配，如果找到第一个符合正则表达式的结果，就会返回，</span></span><br><span class="line"><span class="comment">#       然后匹配结果存入group()中供后续操作。</span></span><br><span class="line">    result = pattern.findall(<span class="string">&quot;423425334&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(result)  <span class="comment">#.findall()：</span></span><br><span class="line"><span class="comment"># 这个方法可以找到符合正则表达式的所有匹配结果</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># .match() 方法与 .search() 方法类似，只匹配一次，并且只从字符串的开头开始匹配</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment"># count_example()</span></span><br><span class="line">    <span class="comment"># strip_example()</span></span><br><span class="line">    <span class="comment"># concate_example()</span></span><br><span class="line">    <span class="comment"># compare_example()</span></span><br><span class="line">    <span class="comment"># find_str()</span></span><br><span class="line">    <span class="comment"># spit_str()</span></span><br><span class="line">    <span class="comment"># replace_str()</span></span><br><span class="line">    <span class="comment"># startswith()</span></span><br><span class="line">    regresson()</span><br></pre></td></tr></table></figure><p>正则表达式的应用场景十分广泛：在去除网页类文本语料库中 html 符号，去除一些聊天的表情符号像是 Orz ，T_T 等等有着十分重要的应用。因此学会使用正则表达式，将会对自然语言处理实现有着不小的帮助.</p><h2 id="中英文分词方法"><a href="#中英文分词方法" class="headerlink" title="中英文分词方法"></a>中英文分词方法</h2><p>分词作为自然语言处理实际运用当中当中最基本的任务，对文本预处理来说十分的重要</p><p>在语言理解中，词是最小的能够独立活动的有意义的粒度。由词到句，由句成文。因此，将词确定下来是理解自然语言处理的第一步，只有跨越了这一步，才能进行后续任务</p><p>我的理解就是把词分开.</p><h3 id="英文分词"><a href="#英文分词" class="headerlink" title="英文分词"></a>英文分词</h3><p>对于英文来说,空格或是一些标点符号就足以.</p><blockquote><p>英文文本词与词之间有空格或者标点符号，如果想要对这种普通的英文文本进行分词的话是不需要什么算法支撑，只需暴力拆分即可，即直接通过空格或者标点来将文本进行分开就可以完成英文分词。</p></blockquote><p>假设对于一句英文,利用空格,逗号,句号,问号和感叹号来分割</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tokenize_Entext</span>(<span class="params">text</span>):</span></span><br><span class="line">    tokenize_text = []</span><br><span class="line">    <span class="keyword">for</span> data <span class="keyword">in</span> text:</span><br><span class="line">        tokenize_data = []</span><br><span class="line">        <span class="keyword">for</span> s <span class="keyword">in</span> data.split(<span class="string">&#x27;.&#x27;</span>):</span><br><span class="line">            <span class="keyword">for</span> s1 <span class="keyword">in</span> s.split(<span class="string">&#x27;?&#x27;</span>):</span><br><span class="line">                <span class="keyword">for</span> s2 <span class="keyword">in</span> s1.split(<span class="string">&quot;!&quot;</span>):</span><br><span class="line">                    <span class="keyword">for</span> s3 <span class="keyword">in</span> s2.split(<span class="string">&quot;,&quot;</span>):</span><br><span class="line">                        tokenize_data.extend(</span><br><span class="line">                            s4 <span class="keyword">for</span> s4 <span class="keyword">in</span> s3.split()</span><br><span class="line">                        )</span><br><span class="line">        tokenize_text.append(tokenize_data)</span><br><span class="line">    <span class="keyword">return</span> tokenize_text</span><br></pre></td></tr></table></figure><p>对于中文分词就难得多了.</p><h3 id="中文分词"><a href="#中文分词" class="headerlink" title="中文分词"></a>中文分词</h3><p>我们想要通过计算机将句子转化成词的表示，自动识别句子中的词，在词与词之间加入边界分隔符，分割出各个词汇。这个切词过程就叫做中文分词.</p><p>中文分词存在歧义与分词界限等问题.</p><p>中文分词这个概念自提出以来，经过多年的发展，主要可以分为三个方法：</p><ul><li>机械分词方法；</li><li>统计分词方法；</li><li>两种结合起来的分词方法</li></ul><p>机械分词方法又叫做基于规则的分词方法：这种分词方法按照一定的规则将待处理的字符串与一个词表词典中的词进行逐一匹配，若在词典中找到某个字符串，则切分，否则不切分。机械分词方法按照匹配规则的方式，又可以分为：正向最大匹配法，逆向最大匹配法和双向匹配法三种。</p><h3 id="机械分词方法"><a href="#机械分词方法" class="headerlink" title="机械分词方法"></a>机械分词方法</h3><h4 id="正向最大匹配"><a href="#正向最大匹配" class="headerlink" title="正向最大匹配"></a>正向最大匹配</h4><p>正向最大匹配法（Maximum Match Method，MM 法）是指从左向右按最大原则与词典里面的词进行匹配。假设词典中最长词是 𝑚m 个字，那么从待切分文本的最左边取 𝑚m 个字符与词典进行匹配，如果匹配成功，则分词。如果匹配不成功，那么取 𝑚−1m−1 个字符与词典匹配，一直取直到成功匹配为止。</p><h4 id="逆向最大匹配"><a href="#逆向最大匹配" class="headerlink" title="逆向最大匹配"></a>逆向最大匹配</h4><p>逆向最大匹配法（ Reverse Maximum Match Method, RMM 法）的原理与正向法基本相同，唯一不同的就是切分的方向与 MM 法相反。逆向法从文本末端开始匹配，每次用末端的最长词长度个字符进行匹配</p><h4 id="双向最大匹配"><a href="#双向最大匹配" class="headerlink" title="双向最大匹配"></a>双向最大匹配</h4><p>双向最大匹配法（Bi-direction Matching Method ，BMM）则是将正向匹配法得到的分词结果与逆向匹配法得到的分词结果进行比较，然后按照最大匹配原则，选取次数切分最少的作为结果</p><p><strong>一般步骤</strong>(正向匹配)</p><p>算法步骤：</p><ol><li><p>导入分词词典 <code>dic</code>，待分词文本 <code>text</code>，创建空集 <code>words</code> 。</p></li><li><p>遍历分词词典，找到最长词的长度，<code>max_len_word</code> 。</p></li><li><p>将待分词文本从左向右取 <code>max_len=max_len_word</code> 个字符作为待匹配字符串 <code>word</code> 。</p></li><li><p>将 <code>word</code> 与词典 <code>dic</code> 匹配</p></li><li><p>若匹配失败，则 <code>max_len = max_len - 1</code> ，然后</p></li><li><p>重复 3 - 4 步骤</p></li><li><p>匹配成功，将 <code>word</code> 添加进 <code>words</code> 当中。</p></li><li><p>去掉待分词文本前 <code>max_len</code> 个字符</p></li><li><p>重置 <code>max_len</code> 值为 <code>max_len_word</code></p></li><li><p>重复 3 - 8 步骤</p></li><li><p>返回列表 <code>words</code></p></li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 初始最长词长度为 0</span></span><br><span class="line">max_len_word0 = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> key <span class="keyword">in</span> dic:</span><br><span class="line">    <span class="comment"># 若当前词长度大于 max_len_word，则将 len(key)值赋值给 max_len_word</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(key) &gt; max_len_word0:</span><br><span class="line">        max_len_word0 = <span class="built_in">len</span>(key)</span><br></pre></td></tr></table></figure><p>max_len_word0是词典中词的最大长度</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">sent = text</span><br><span class="line">words = []   <span class="comment"># 建立一个空数组来存放分词结果：</span></span><br><span class="line">max_len_word = max_len_word0</span><br><span class="line"><span class="comment"># 判断 text 的长度是否大于 0，如果大于 0 则进行下面的循环</span></span><br><span class="line"><span class="keyword">while</span> <span class="built_in">len</span>(sent) &gt; <span class="number">0</span>:</span><br><span class="line">    <span class="comment"># 初始化想要取的字符串长度</span></span><br><span class="line">    <span class="comment"># 按照最长词长度初始化</span></span><br><span class="line">    word_len = max_len_word</span><br><span class="line">    <span class="comment"># 对每个字符串可能会有(max_len_word)次循环</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, max_len_word):</span><br><span class="line">        <span class="comment"># 令 word 等于 text 的前 word_len 个字符</span></span><br><span class="line">        word = sent[<span class="number">0</span>:word_len]</span><br><span class="line">        <span class="comment"># 为了便于观察过程，我们打印一下当前分割结果</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;用 【&#x27;</span>, word, <span class="string">&#x27;】 进行匹配&#x27;</span>)</span><br><span class="line">        <span class="comment"># 判断 word 是否在词典 dic 当中</span></span><br><span class="line">        <span class="comment"># 如果不在词典当中</span></span><br><span class="line">        <span class="keyword">if</span> word <span class="keyword">not</span> <span class="keyword">in</span> dic:</span><br><span class="line">            <span class="comment"># 则以 word_len - 1</span></span><br><span class="line">            word_len -= <span class="number">1</span></span><br><span class="line">            <span class="comment"># 清空 word</span></span><br><span class="line">            word = []</span><br><span class="line">        <span class="comment"># 如果 word 在词典当中</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># 更新 text 串起始位置</span></span><br><span class="line">            sent = sent[word_len:]</span><br><span class="line">            <span class="comment"># 为了方便观察过程，我们打印一下当前结果</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;【&#123;&#125;】 匹配成功，添加进 words 当中&#x27;</span>.<span class="built_in">format</span>(word))</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;-&#x27;</span>*<span class="number">50</span>)</span><br><span class="line">            <span class="comment"># 把匹配成功的word添加进上面创建好的words当中</span></span><br><span class="line">            words.append(word)</span><br><span class="line">            <span class="comment"># 清空word</span></span><br><span class="line">            word = []</span><br></pre></td></tr></table></figure><p>这种分词的方法缺陷主要在词库.</p><h3 id="统计分词方法"><a href="#统计分词方法" class="headerlink" title="统计分词方法"></a>统计分词方法</h3><p>目前基于统计的分词方法大体可以分两种方法：</p><ul><li>语料统计方法</li><li>序列标注方法</li></ul><h4 id="语料统计方法"><a href="#语料统计方法" class="headerlink" title="语料统计方法"></a>语料统计方法</h4><p>语料就是我们的自备的文本库</p><blockquote><p>对于语料统计方法可以这样理解：我们已经有一个由很多个文本组成的的语料库 <code>D</code> ，假设现在对一个句子【我有一个苹果】进行分词。其中两个相连的字 【苹】【果】在不同的文本中连续出现的次数越多，就说明这两个相连字很可能构成一个词【苹果】。与此同时 【个】【苹】 这两个相连的词在别的文本中连续出现的次数很少，就说明这两个相连的字不太可能构成一个词【个苹】。所以，我们就可以利用这个统计规则来反应字与字成词的可信度。当字连续组合的概率高过一个临界值时，就认为该组合构成了一个词语</p></blockquote><h4 id="序列标注方法"><a href="#序列标注方法" class="headerlink" title="序列标注方法"></a>序列标注方法</h4><p>序列标注方法则将中文分词看做是一个序列标注问题。首先，规定每个字在一个词语当中有着 4 个不同的位置，词首 B，词中 M，词尾 E，单字成词 S。我们通过给一句话中的每个字标记上述的属性，最后通过标注来确定分词结果。</p><p>在训练时，输入中文句子和对应的标注序列，训练完成得到一个模型。在测试时，输入中文句子，通过模型运算得到一个标注序列。然后通过标注序列来进行切分句子。</p><p>在统计学习方法中，可以用于序列标注任务的方法有很多。例如，隐马尔可夫模型，条件随机场等.</p><h2 id="Jieba"><a href="#Jieba" class="headerlink" title="Jieba"></a>Jieba</h2><p>第三方库 jieba帮助我们解决训练模型得到标注序列的问题.jieba 工具用的是隐马尔可夫模型与字典相结合的方法，比直接单独使用隐马尔可夫模型来分词效率高很多，准确率也高很多.</p><ul><li>基于前缀词典实现高效的词图扫描，生成句子中汉字所有可能成词情况所构成的有向无环图 (DAG)</li><li>采用了动态规划查找最大概率路径, 找出基于词频的最大切分组合</li><li>对于未登录词，采用了基于汉字成词能力的 HMM 模型，使用了 Viterbi 算法</li></ul><h3 id="分词"><a href="#分词" class="headerlink" title="分词"></a>分词</h3><p><img data-src="http://cdn.sekyoro.top/imgs/092904.png" alt="jieba"></p><p>在使用 jieba 进行分词时，有三种模式可选：</p><ol><li>全模式 将句中可以成词的词语都扫描出来</li><li>精确模式  将句子精确分开 </li><li>搜索引擎模式 再精确模式下,对长词再次切分</li></ol><p><img data-src="http://cdn.sekyoro.top/imgs/092908.png" alt="分词功能"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> jieba</span><br><span class="line"></span><br><span class="line"><span class="built_in">str</span> = <span class="string">&quot;你好,我是张三.你是谁&quot;</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">all</span>():</span></span><br><span class="line">    seg_list = jieba.cut(<span class="built_in">str</span>,cut_all=<span class="literal">True</span>)</span><br><span class="line">    <span class="comment"># print(seg_list)</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;|&quot;</span>.join(seg_list))</span><br><span class="line"><span class="comment">#     seg_list 无法直接显示，若想要显示，可以下面这样。</span></span><br><span class="line"><span class="comment">#     用 ‘|’ 把生成器中的词串起来显示。</span></span><br><span class="line"><span class="comment">#     这个方法在下面提到的精确模式和搜索引擎模式中同样适用</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pre</span>():</span></span><br><span class="line">    seg_list = jieba.cut(<span class="built_in">str</span>,cut_all=<span class="literal">False</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;|&quot;</span>.join(seg_list))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">search</span>():</span></span><br><span class="line">    seg_list = jieba.cut_for_search(<span class="built_in">str</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;|&quot;</span>.join(seg_list))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment"># all()</span></span><br><span class="line">    <span class="comment"># pre()</span></span><br><span class="line">    search()</span><br></pre></td></tr></table></figure><p>全模式和搜索引擎模式，jieba 会把全部可能组成的词都打印出来。在一般的任务当中，我们使用默认的精确模式就行了，在模糊匹配时，则需要用到全模式或者搜索引擎模式</p><h3 id="载入字典"><a href="#载入字典" class="headerlink" title="载入字典"></a>载入字典</h3><p>为了解决未分词问题(即词库中没有需要的分词) jieba 允许用户自己添加该领域的自定义词典，我们可以提前把这些词加进自定义词典当中，来增加分词的效果。调用的方法是：<code>jieba.load_userdic()</code></p><p>自定义词典的格式要求每一行一个词，有三个部分，词语，词频（词语出现的频率），词性（名词，动词……）。其中，词频和词性可省略。用户自定义词典可以直接用记事本创立即可，但是需要以 utf-8 编码模式保存。</p><p><img data-src="http://cdn.sekyoro.top/imgs/092910.png" alt="载入词典"></p><p>创建txt文件 每一行格式 词语 词频 词性</p><div class="table-container"><table><thead><tr><th>标签</th><th>含义</th><th>标签</th><th>含义</th><th>标签</th><th>含义</th><th>标签</th><th>含义</th></tr></thead><tbody><tr><td>n</td><td>普通名词</td><td>f</td><td>方位名词</td><td>s</td><td>处所名词</td><td>t</td><td>时间</td></tr><tr><td>nr</td><td>人名</td><td>ns</td><td>地名</td><td>nt</td><td>机构名</td><td>nw</td><td>作品名</td></tr><tr><td>nz</td><td>其他专名</td><td>v</td><td>普通动词</td><td>vd</td><td>动副词</td><td>vn</td><td>名动词</td></tr><tr><td>a</td><td>形容词</td><td>ad</td><td>副形词</td><td>an</td><td>名形词</td><td>d</td><td>副词</td></tr><tr><td>m</td><td>数量词</td><td>q</td><td>量词</td><td>r</td><td>代词</td><td>p</td><td>介词</td></tr><tr><td>c</td><td>连词</td><td>u</td><td>助词</td><td>xc</td><td>其他虚词</td><td>w</td><td>标点符号</td></tr><tr><td>PER</td><td>人名</td><td>LOC</td><td>地名</td><td>ORG</td><td>机构名</td><td>TIME</td><td>时间</td></tr></tbody></table></div><p>除了使用 <code>jieba.load_userdic()</code> 函数在分词开始前加载自定义词典之外，还有两种方法在可以在程序中动态修改词典。</p><ul><li>使用 <code>add_word(word, freq=None, tag=None)</code> 和 <code>del_word(word)</code> 可在程序中动态修改词典。</li><li>使用 <code>suggest_freq(segment, tune=True)</code> 可调节单个词语的词频，使其能（或不能）被分出来</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># suggest_freq</span></span><br><span class="line">jieba.suggest_freq((<span class="string">&#x27;今天&#x27;</span>, <span class="string">&#x27;天气&#x27;</span>), <span class="literal">True</span>)</span><br><span class="line">seg_list = jieba.cut(string, cut_all=<span class="literal">False</span>)</span><br><span class="line"><span class="string">&#x27;|&#x27;</span>.join(seg_list)</span><br><span class="line"></span><br><span class="line"><span class="comment"># del_word</span></span><br><span class="line">jieba.del_word(<span class="string">&#x27;今天天气&#x27;</span>)</span><br><span class="line">seg_list = jieba.cut(string, cut_all=<span class="literal">False</span>)</span><br><span class="line"><span class="string">&#x27;|&#x27;</span>.join(seg_list)</span><br></pre></td></tr></table></figure><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      
        <tags>
            
            <tag> NLP学习 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>typora解绑后出现问题</title>
      <link href="2022/01/30/typora%E8%A7%A3%E7%BB%91%E5%90%8E%E5%87%BA%E7%8E%B0%E9%97%AE%E9%A2%98/"/>
      <url>2022/01/30/typora%E8%A7%A3%E7%BB%91%E5%90%8E%E5%87%BA%E7%8E%B0%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>众所周知,typora作为一款良好的markdown编辑器,写写博客啥的很方便.图床,转pdf的功能也很实用.<br><span id="more"></span><br>本人使用这款软件也有一两年了,综合感受就是写一些几千字或者几百字的图文技术博客是很适合的,很多平台也都支持markdown.缺点就是对于一些数学符号, 科学计算等符号使用还是有一点麻烦,不过作为一款还算比较轻便的软件,这也不算什么.同时对于doc转换效果还是有一点差.因为有些人喜欢看doc文档,所以这个功能还有待提升.</p><p>现在软件收费了,我也直接14.99$入手了.不过存在一些问题,版本的更新提示不知道是不是墙的问题,直接更新不了,导致版本都1.0.3了,我一直都还在用1.0.0.</p><p>新版本作者贴心地加了国区特供,我都不好说这到底是件好事还是坏事了.另外,由于某些原因,我购买后又取消了,再次想要激活时发现一直提示服务器连接不上.网上已经有了解决方案.</p><blockquote><p>在typora1.0.3版本中有了国内服务器连接的功能,打开后就能解决. </p></blockquote><p><img data-src="http://cdn.sekyoro.top/imgs/094224.png" alt="激活撒花"></p><p>不过点击检查更新以及提示连不上</p><p><img data-src="http://cdn.sekyoro.top/imgs/094229.png" alt="检查更新失败"></p><p>当然这个软件还在一些问题,不过这个本质就是写markdown的,没必要花里胡哨.</p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      
        <tags>
            
            <tag> typora </tag>
            
            <tag> issue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>cousera_ML学习</title>
      <link href="2022/01/20/cousera-ML%E5%AD%A6%E4%B9%A0/"/>
      <url>2022/01/20/cousera-ML%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>Cousera的Andrew机器学习课程.</p><span id="more"></span><p>Maching Learning的两个定义</p><p>监督学习与非监督学习</p><p>监督学习:classificaton与regression</p><p>liner regression</p><p><img data-src="http://cdn.sekyoro.top/imgs/093030.png" alt="liner regression"></p><p>损失函数</p><p>非监督学习:clustering和non-clustering 密度估计</p><p>cost function</p><p><img data-src="http://cdn.sekyoro.top/imgs/065307.png" alt="cost function"></p><p>等高线图</p><p>梯度下降算法将代价函数最小化</p><p> <img data-src="http://cdn.sekyoro.top/imgs/065308.png" alt="gradient descending"></p><p>Gradient Descent and norm Equation</p><p><del>摆烂了</del>由于不太想写所以之前没更新了.现在写一下svm这一章的题.</p><p>推荐去看斯坦福的这门课,也是ng讲的.</p><p><img data-src="http://cdn.sekyoro.top/imgs/093033.png" alt="高斯核"></p><p><strong>update</strong></p><p>我现在课程看完了,作业可以在我的github仓库中看一看</p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> ML </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ML </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>机器学习入门</title>
      <link href="2022/01/19/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%85%A5%E9%97%A8/"/>
      <url>2022/01/19/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%85%A5%E9%97%A8/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>现在入门可能都晚了<br><span id="more"></span><br>机器学习历史</p><p>1956 年提出 AI 概念，短短3年后（1959)<a href="https://en.wikipedia.org/wiki/Arthur_Samuel">Arthur Samuel</a>就提出了机器学习的概念.</p><blockquote><p>机器学习研究和构建的是一种特殊算法（<strong>而非某一个特定的算法</strong>），能够让计算机自己在数据中学习从而进行预测。</p></blockquote><p>所以，<strong>机器学习不是某种具体的算法，而是很多算法的统称。</strong></p><p>此外还有一个经典概念.</p><blockquote><p>假设用 P 来评估计算机程序在某任务类 T 上的性能，若一个程序利用经验 E 在任务 T 上获得了性能改善，则我们就说关于 T 和 P, 该程序对 E 进行了学习。</p></blockquote><p>机器学习中一些流行的任务 T 包括：</p><ul><li>分类：基于特征将实例分为某一类。</li><li>回归：基于实例的其他特征预测该实例的数值型目标特征。</li><li>聚类：基于实例的特征实现实例的分组，从而让组内成员比组间成员更为相似。</li><li>异常检测：寻找与其他样本或组内实例有很大区别的实例。</li><li>其他更多任务</li></ul><blockquote><p>经验 E 指的是数据（没有数据我们什么也干不了）。根据训练方式，机器学习算法可以分为监督（supervised）和无监督（unsupervised）两类。无监督学习需要训练含有很多特征的数据集，然后学习出这个数据集上有用的结构性质。而监督学习的数据集除了含有很多特征外，它的每个样本都要有一个标签（label）或目标（target）</p></blockquote><p>机器学习包含了很多种不同的算法，深度学习就是其中之一，其他方法包括决策树，聚类，贝叶斯等。</p><p>需要的知识:学会Numpy,matplotlib,seaborn,pandas和scipy.基本的一些方法要知道同时要知道如何查阅文档,这个可能更重要.</p><p>同时需要一些基础的数学知识.</p><p>监督学习:regression和classification.</p><p>无监督学习:clustering和密度估计.</p><p><strong>一般步骤</strong></p><ol><li><p>收集数据  </p><p>利用爬虫或是已有数据得到一般的未处理的文本文件等 格式可以为json,csv,xml或者一般的txt.</p></li><li><p>准备数据</p><p>使用python解析文本文件,一般利用简单的open读取,pandas等能够对所有数据进行解析.</p><p>目的得到数据的特征值和目标向量.</p></li><li><p>分析数据<br> 使用matplotlib等可视化数据进行初步分析(通常需要得到二维扩散图)</p></li><li><p>训练算法<br> 后面会提到 </p></li><li><p>测试算法<br>使用测试数据作为测试样本,通过这一步得到算法的正确率</p></li><li><p>使用算法<br> 输入数据判断</p></li></ol><h2 id="Classification"><a href="#Classification" class="headerlink" title="Classification"></a>Classification</h2><p>进行分类  标称值</p><h3 id="KNN"><a href="#KNN" class="headerlink" title="KNN"></a>KNN</h3><p>第一个分类器</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> operator</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">createDataSet</span>():</span></span><br><span class="line">    group = np.array([[<span class="number">1.0</span>, <span class="number">1.1</span>], [<span class="number">1.0</span>, <span class="number">1.0</span>], [<span class="number">0</span>, <span class="number">0</span>], [<span class="number">0</span>, <span class="number">0.1</span>]]) <span class="comment">#创建 numpy数组  特征值</span></span><br><span class="line">    labels = [<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;B&#x27;</span>]  <span class="comment">#目标变量</span></span><br><span class="line">    <span class="keyword">return</span> group, labels</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">classify0</span>(<span class="params">inX, dataSet, labels, k</span>):</span></span><br><span class="line">    dataSetSize = dataSet.shape[<span class="number">0</span>] <span class="comment">#获得数据集的数目</span></span><br><span class="line">    diffMat = np.tile(inX, (dataSetSize, <span class="number">1</span>)) - dataSet  <span class="comment">#inX是分类向量(1X2) 列数为特征数 广播后与数据集相减</span></span><br><span class="line">    sqDiffMat = diffMat ** <span class="number">2</span> <span class="comment">#每个值平方</span></span><br><span class="line">    sqDistances = sqDiffMat.<span class="built_in">sum</span>(axis=<span class="number">1</span>) <span class="comment">#返回一个List,值是每一行值相加  相当于得到每一个点与需要测试点的距离(还未开根)</span></span><br><span class="line">    distances = sqDistances ** <span class="number">0.5</span> <span class="comment">#开根</span></span><br><span class="line">    sortedDistIndices = distances.argsort() <span class="comment">#返回一个list 值是输入数组的值从小到大的索引  相当于按照距离给值排序</span></span><br><span class="line">    classCount = &#123;&#125;</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(k):</span><br><span class="line">        voteIlabel = labels[sortedDistIndices[i]]  <span class="comment">#取得最近的第i个值 </span></span><br><span class="line">        classCount[voteIlabel] = classCount.get(voteIlabel, <span class="number">0</span>) + <span class="number">1</span> <span class="comment">#个数+1</span></span><br><span class="line">    sortdClassCount = <span class="built_in">sorted</span>(classCount.items(),</span><br><span class="line">                             key=operator.itemgetter(<span class="number">1</span>), reverse=<span class="literal">True</span>) <span class="comment">#排序 返回一个List</span></span><br><span class="line">    <span class="keyword">return</span> sortdClassCount[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="解析数据"><a href="#解析数据" class="headerlink" title="解析数据"></a>解析数据</h4><p>假设我们已经有了文本或是其他格式的数据,需要用python解析数据将特征和标签提取出来转为numpy格式.</p><p>下面是从文本中提取.格式为</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">valuevalue valuelabel</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">file2matrix</span>(<span class="params">filename</span>):</span></span><br><span class="line">    fr = <span class="built_in">open</span>(filename)</span><br><span class="line">    arrayOLines = fr.readlines()</span><br><span class="line">    numberOfLines = <span class="built_in">len</span>(arrayOLines)</span><br><span class="line">    returnMat = np.zeros((numberOfLines,<span class="number">3</span>))  <span class="comment">#3个特征</span></span><br><span class="line">    classLabelVector = []</span><br><span class="line">    index = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> arrayOLines:</span><br><span class="line">        line = line.strip()</span><br><span class="line">        listFromLine = line.split(<span class="string">&#x27;\t&#x27;</span>)</span><br><span class="line">        returnMat[index,] = listFromLine[<span class="number">0</span>:<span class="number">3</span>]</span><br><span class="line">        classLabelVector.append(<span class="built_in">int</span>(listFromLine[-<span class="number">1</span>]))</span><br><span class="line">        index += <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> returnMat,classLabelVector</span><br></pre></td></tr></table></figure><h4 id="分析数据"><a href="#分析数据" class="headerlink" title="分析数据"></a>分析数据</h4><p>利用matplotlib可视化</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">scatter = plt.scatter(datingDataMat[:,<span class="number">1</span>],datingDataMat[:,<span class="number">2</span>],<span class="number">15</span>*np.array(labelvector),<span class="number">12</span>*np.array(labelvector))</span><br><span class="line">i, j = scatter.legend_elements()</span><br><span class="line"><span class="comment"># print(i, j)</span></span><br><span class="line">j = [<span class="string">&#x27;$\\mathdefault&#123;不受欢迎&#125;$&#x27;</span>, <span class="string">&#x27;$\\mathdefault&#123;受欢迎&#125;$&#x27;</span>, <span class="string">&#x27;$\\mathdefault&#123;一般&#125;$&#x27;</span>]</span><br><span class="line">ax.legend(i,j,loc=<span class="string">&#x27;best&#x27;</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><h4 id="准备数据"><a href="#准备数据" class="headerlink" title="准备数据"></a>准备数据</h4><h5 id="归一化"><a href="#归一化" class="headerlink" title="归一化"></a>归一化</h5><p>一个样本有多个特征,这些特征的值是不一样的,有些可能一般的值是几十左右,但是其他特征一般的值要高上很大的数量级,但这些特征是等价的.我们需要特征归一化,将取值范围缩小.比如均缩为(0,1)</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">newvalue = (oldValue-<span class="built_in">min</span>)/(<span class="built_in">max</span>-<span class="built_in">min</span>)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">autonorm</span>(<span class="params">dataSet</span>):</span></span><br><span class="line">    minVals = dataSet.<span class="built_in">min</span>(<span class="number">0</span>)</span><br><span class="line">    maxVals = dataSet.<span class="built_in">max</span>(<span class="number">0</span>)</span><br><span class="line">    ranges = maxVals - minVals</span><br><span class="line">    normDataSet = np.zeros(dataSet.shape)</span><br><span class="line">    m = dataSet.shape[<span class="number">0</span>]</span><br><span class="line">    normDataSet = dataSet - np.tile(minVals,(m,<span class="number">1</span>))</span><br><span class="line">    normDataSet = normDataSet/np.tile(ranges,(m,<span class="number">1</span>))</span><br><span class="line">    <span class="keyword">return</span> normDataSet,ranges,minVals</span><br></pre></td></tr></table></figure><h4 id="测试算法"><a href="#测试算法" class="headerlink" title="测试算法"></a>测试算法</h4><p>评估算法的正确率</p><p>将已有数据的一部分用来训练(在KNN这里不需要训练),另一部分用来测试错误率,即这个算法是否优秀</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">datingClassTest</span>():</span></span><br><span class="line">    hoRatio = <span class="number">0.1</span>  <span class="comment">#测试数据 10%</span></span><br><span class="line">    datingDataMat,datingLabels = file2matrix(<span class="string">&#x27;datingTestSet2.txt&#x27;</span>)</span><br><span class="line">    normMat,ranges,minVals = autonorm(datingDataMat)</span><br><span class="line">    m = normMat.shape[<span class="number">0</span>]</span><br><span class="line">    numTestVecs = <span class="built_in">int</span>(m*hoRatio)</span><br><span class="line">    errorCount = <span class="number">0.0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(numTestVecs):</span><br><span class="line">        classifierResult = classify0(normMat[i],normMat[numTestVecs:m],datingLabels[numTestVecs:m],<span class="number">3</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;the classifier came back with:%d,the real answer is %d&quot;</span> %(classifierResult,datingLabels[i]))</span><br><span class="line">        <span class="keyword">if</span> classifierResult!=datingLabels[i]:</span><br><span class="line">            errorCount +=<span class="number">1</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;the total error rate is:%f&quot;</span> %(errorCount/<span class="built_in">float</span>(numTestVecs)))</span><br></pre></td></tr></table></figure><h4 id="使用算法"><a href="#使用算法" class="headerlink" title="使用算法"></a>使用算法</h4><p>当测试算法后即可直接使用了,输入自己的数据预测</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">classifyPerson</span>():</span></span><br><span class="line">    resultList = [<span class="string">&#x27;not at all&#x27;</span>,<span class="string">&#x27;in small doses&#x27;</span>,<span class="string">&#x27;in large doses&#x27;</span>]</span><br><span class="line">    percentTats = <span class="built_in">float</span>(<span class="built_in">input</span>(<span class="string">&quot;percentage of time spent playing games?&quot;</span>))</span><br><span class="line">    ffMiles = <span class="built_in">float</span>(<span class="built_in">input</span>(<span class="string">&quot;frequent flier miles earned per year?&quot;</span>))</span><br><span class="line">    iceCream = <span class="built_in">float</span>(<span class="built_in">input</span>(<span class="string">&quot;liters of ice cream consumed per year?&quot;</span>))</span><br><span class="line">    datingDataMat,datingLabels = file2matrix(<span class="string">&quot;./datingTestSet2.txt&quot;</span>)</span><br><span class="line">    normMat,ranges,minVals = autonorm(datingDataMat)</span><br><span class="line">    inArr = np.array([ffMiles,percentTats,iceCream])</span><br><span class="line">    classifierResult = classify0((inArr-minVals)/ranges,normMat,datingLabels,<span class="number">3</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;you will probably look like this person:&quot;</span>,resultList[classifierResult-<span class="number">1</span>])</span><br></pre></td></tr></table></figure><p>这样一个分类器就实现了.不过比较简单而且是KNN,没有经过算法训练.</p><h4 id="手写识别系统"><a href="#手写识别系统" class="headerlink" title="手写识别系统"></a>手写识别系统</h4><p><strong>步骤</strong>:</p><ol><li>收集数据 提供文本文件</li><li>准备数据 编写函数img2vector() 将图像格式转为分类器使用的向量</li><li>分析数据 </li><li>训练算法,knn不需要</li><li>测试算法</li><li>使用算法 </li></ol><p>手写识别也就是识别图像,而图像的特征可以有很多.</p><p>这里识别32<em>32的图像,将每个像素当作特征,也就是一个样本数据是1\</em>1024的向量</p><p>首先编写函数32<em>32的二度图转为1\</em>1024的一个样本,特征有1024个</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">img2vector</span>(<span class="params">filename</span>):</span></span><br><span class="line">    returnVect = np.zeros((<span class="number">1</span>, <span class="number">1024</span>))</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(filename, <span class="string">&quot;r+&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">            lineStr = f.readline()</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">                returnVect[<span class="number">0</span>, i * <span class="number">32</span> + j] = <span class="built_in">int</span>(lineStr[j])</span><br><span class="line">    <span class="keyword">return</span> returnVect</span><br></pre></td></tr></table></figure><p>这样一转化就跟上面一个例子类似了.</p><p>然后只要根据已给数据得到特征集和对应label</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">handwritingClassTest</span>():</span></span><br><span class="line">    hwLabel = []</span><br><span class="line">    trainingDataFileList = os.listdir(<span class="string">&quot;trainingDigits&quot;</span>)</span><br><span class="line">    <span class="comment"># print(trainingDataFileList)</span></span><br><span class="line">    m = <span class="built_in">len</span>(trainingDataFileList)</span><br><span class="line">    trainingMat = np.zeros((m, <span class="number">1024</span>))  <span class="comment"># 数据集 m个样本 1024个特征</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(m):</span><br><span class="line">        fileNameStr = trainingDataFileList[i]</span><br><span class="line">        fileStr = fileNameStr.split(<span class="string">&#x27;.&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line">        classNumStr = fileStr.split(<span class="string">&#x27;_&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line">        hwLabel.append(<span class="built_in">int</span>(classNumStr))   <span class="comment">#label 目标向量</span></span><br><span class="line">        trainingMat[i, :] = img2vector(<span class="string">&#x27;trainingDigits/%s&#x27;</span> % fileNameStr) <span class="comment">#得到每一个样本的特征</span></span><br><span class="line">    testFileList = os.listdir(<span class="string">&#x27;testDigits&#x27;</span>)</span><br><span class="line">    errorCount = <span class="number">0</span></span><br><span class="line">    mTest = <span class="built_in">len</span>(testFileList)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(mTest):  <span class="comment">#类似的处理流程  通过得到结果进行比较</span></span><br><span class="line">        fileNameStr = testFileList[i]</span><br><span class="line">        fileStr = fileNameStr.split(<span class="string">&#x27;.&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line">        classNumStr = <span class="built_in">int</span>(fileNameStr.split(<span class="string">&#x27;_&#x27;</span>)[<span class="number">0</span>])</span><br><span class="line">        vectorUnderTest = img2vector(<span class="string">&quot;testDigits/%s&quot;</span> % fileNameStr)</span><br><span class="line">        classifierResult = classify0(vectorUnderTest, trainingMat, hwLabel, <span class="number">3</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;the classifier came back with:%d,and the real answer is %s&quot;</span> % (classifierResult, classNumStr))</span><br><span class="line">        <span class="keyword">if</span> classifierResult != classNumStr:</span><br><span class="line">            errorCount += <span class="number">1</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;the total number of errors is %d\n&quot;</span> % errorCount)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;the total error rate is %f\n&quot;</span> % (errorCount / <span class="built_in">float</span>(mTest)))</span><br></pre></td></tr></table></figure><p>因为特征值都是0或1,在一个量级不需要归一化.</p><p>通过上面的KNN学习,可以了解到KNN的时间和空间效率并不高,需要改进.</p><p>特点:简单有效,使用算法时必须有接近实际数据的训练样本数据.必须保存全部数据集,必须对每个数据计算距离值,实际使用时可能非常耗时.</p><h3 id="决策树"><a href="#决策树" class="headerlink" title="决策树"></a>决策树</h3><p><del>不好意思鸽了这么久</del></p><p>决策树常常是专家经验的概括，是一种分享特定过程知识的方式。例如，在引入可扩展机器学习算法之前，银行业的信用评分任务是由专家解决的，能否放贷是基于一些直观（或经验）的规则，这些规则就可以表示为决策树的形式.它合并一连串逻辑规则，使之成为一个树形的数据结构，这些规则的形式为「特征 a 的值小于 x，特征 b 的值小于 y … =&gt; 类别 1」</p><p><img data-src="http://cdn.sekyoro.top/imgs/092956.png" alt="决策树"></p><p>可以简单地发现,决策树可以认为是一种状态图.</p><p>根据不同的决策剔除选项.那么如何判断哪些决策能剔除更多的选项呢?</p><h4 id="重要概念"><a href="#重要概念" class="headerlink" title="重要概念"></a>重要概念</h4><p><strong>熵</strong></p><p>熵是一个在物理、信息论和其他领域中广泛应用的重要概念，可以衡量获得的信息量。</p><p>对于具有 N 种可能状态的系统而言,熵定义为</p><script type="math/tex; mode=display">S = -\sum_{i=1}^{N}p_i \log_2{p_i},</script><p>其中，$p_i$ 是系统位于第 i 个状态的概率。熵可以描述为系统的混沌程度，熵越高，系统的有序性越差，反之亦然。</p><p><strong>信息增益</strong></p><p>熵的下降被称为信息增益</p><script type="math/tex; mode=display">IG(Q) = S_O - \sum_{i=1}^{q}\frac{N_i}{N}S_i,</script><p>对数据进行分组后,对每一组进行熵的计算,再将每组的熵乘以该组所占的比例.得到的就是分组后的熵</p><p>所以决策树的构建就很重要.需要避免过拟合的问题.为了避免过拟合，直到熵为某个较小的值。不同的算法使用不同的推断，通过「提前停止」或「截断」以避免构建出过拟合的树.</p><p>不同的决策树构建算法依据的指标不一样.</p><p>C4.5是信息增益率,ID3是信息增益.同时还有基尼不确定性,$G = 1 - \sum\limits_k (p_k)^2$</p><p>错分率 $E = 1 - \max\limits_k p_k$</p><p>基尼不确定性和信息增益的效果差不多</p><p>二元分类熵的计算 <script type="math/tex">S = -p_+ \log_2{p_+} -p_- \log_2{p_-} = -p_+ \log_2{p_+} -(1 - p_{+}) \log_2{(1 - p_{+})}</script></p><p>基尼不确定性 <script type="math/tex">G = 1 - p_+^2 - p_-^2 = 1 - p_+^2 - (1 - p_+)^2 = 2p_+(1-p_+)</script></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">plt.figure(figsize=(<span class="number">6</span>, <span class="number">4</span>))</span><br><span class="line">xx = np.linspace(<span class="number">0</span>, <span class="number">1</span>, <span class="number">50</span>)</span><br><span class="line">plt.plot(xx, [<span class="number">2</span> * x * (<span class="number">1</span>-x) <span class="keyword">for</span> x <span class="keyword">in</span> xx], label=<span class="string">&#x27;gini&#x27;</span>)</span><br><span class="line">plt.plot(xx, [<span class="number">4</span> * x * (<span class="number">1</span>-x) <span class="keyword">for</span> x <span class="keyword">in</span> xx], label=<span class="string">&#x27;2*gini&#x27;</span>)</span><br><span class="line">plt.plot(xx, [-x * np.log2(x) - (<span class="number">1</span>-x) * np.log2(<span class="number">1</span> - x)</span><br><span class="line">              <span class="keyword">for</span> x <span class="keyword">in</span> xx], label=<span class="string">&#x27;entropy&#x27;</span>)</span><br><span class="line">plt.plot(xx, [<span class="number">1</span> - <span class="built_in">max</span>(x, <span class="number">1</span>-x) <span class="keyword">for</span> x <span class="keyword">in</span> xx], label=<span class="string">&#x27;missclass&#x27;</span>)</span><br><span class="line">plt.plot(xx, [<span class="number">2</span> - <span class="number">2</span> * <span class="built_in">max</span>(x, <span class="number">1</span>-x) <span class="keyword">for</span> x <span class="keyword">in</span> xx], label=<span class="string">&#x27;2*missclass&#x27;</span>)</span><br><span class="line">plt.xlabel(<span class="string">&#x27;p+&#x27;</span>)</span><br><span class="line">plt.ylabel(<span class="string">&#x27;criterion&#x27;</span>)</span><br><span class="line">plt.title(<span class="string">&#x27;Criteria of quality as a function of p+ (binary classification)&#x27;</span>)</span><br><span class="line">plt.legend()</span><br></pre></td></tr></table></figure><p>区分不同的标准 </p><h2 id="附件"><a href="#附件" class="headerlink" title="附件"></a>附件</h2><p>1936图灵 自动机理论</p><p>自动机有如下基本概念：</p><p>符号 ：有某种意义或在这个机器上有效的任意数据(datum)。符号有时就叫做“字母”。</p><p>字：通过一些符号串接而形成的有限字符串。</p><p>字母表 ：符号的有限集合。字母表经常指示为Sigma,它是在字母表中所有字母的集合。</p><p>语言 ：字的集合，由给顶字母表中的符号形成。可以是也可以不是无限的。</p><h2 id="学习资料"><a href="#学习资料" class="headerlink" title="学习资料"></a>学习资料</h2><p>Cousera吴恩达的机器学习课程</p><p><a href="https://easyai.tech/">很好的ai学习网站</a></p><p>《机器学习实战》python2.x</p><p>蓝桥云课程.</p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      
        <tags>
            
            <tag> ML </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>可视化图的工具</title>
      <link href="2022/01/19/%E5%8F%AF%E8%A7%86%E5%8C%96%E5%9B%BE%E7%9A%84%E5%B7%A5%E5%85%B7/"/>
      <url>2022/01/19/%E5%8F%AF%E8%A7%86%E5%8C%96%E5%9B%BE%E7%9A%84%E5%B7%A5%E5%85%B7/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>pandas学习</title>
      <link href="2022/01/17/pandas%E5%AD%A6%E4%B9%A0/"/>
      <url>2022/01/17/pandas%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>机器学习有必要好好学会numpy,pandas和matplotlib<br><span id="more"></span></p><h2 id="开始"><a href="#开始" class="headerlink" title="开始"></a>开始</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install pandas</span><br></pre></td></tr></table></figure><p>安装.</p><p>Pandas 一个强大的分析结构化数据的工具集，基础是 <a href="https://www.runoob.com/numpy/numpy-tutorial.html">Numpy</a>（提供高性能的矩阵运算）。</p><p>Pandas 可以从各种文件格式比如 CSV、JSON、SQL、Microsoft Excel 导入数据。</p><p>Pandas 可以对各种数据进行运算操作，比如归并、再成形、选择，还有数据清洗和数据加工特征</p><h3 id="数据结构"><a href="#数据结构" class="headerlink" title="数据结构"></a>数据结构</h3><p>Series,DataFrame</p><p>前者是一列,类似一维数组,后者是表格。</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">pandas.Series( data, index, dtype, name, copy)</span><br><span class="line">参数说明：</span><br><span class="line"></span><br><span class="line">data：一组数据(ndarray 类型)。</span><br><span class="line"></span><br><span class="line">index：数据索引标签，如果不指定，默认从 0 开始。</span><br><span class="line"></span><br><span class="line">dtype：数据类型，默认会自己判断。</span><br><span class="line"></span><br><span class="line">name：设置名称。</span><br><span class="line"></span><br><span class="line">copy：拷贝数据，默认为 False。</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line">a = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"></span><br><span class="line">myvar = pd.Series(a)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(myvar)</span><br></pre></td></tr></table></figure><p><img data-src="http://cdn.sekyoro.top/imgs/094014.png" alt="Series"></p><p>索引默认从0开始,可以修改索引名字.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line">a = [<span class="string">&quot;Google&quot;</span>, <span class="string">&quot;Runoob&quot;</span>, <span class="string">&quot;Wiki&quot;</span>]</span><br><span class="line"></span><br><span class="line">myvar = pd.Series(a, index = [<span class="string">&quot;x&quot;</span>, <span class="string">&quot;y&quot;</span>, <span class="string">&quot;z&quot;</span>])</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(myvar)</span><br></pre></td></tr></table></figure><p><img data-src="http://cdn.sekyoro.top/imgs/094015.png" alt="对象作为数据"></p><p>也可以使用字典创建对象,</p><p>DataFrame 构造方法如下：</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pandas.<span class="constructor">DataFrame( <span class="params">data</span>, <span class="params">index</span>, <span class="params">columns</span>, <span class="params">dtype</span>, <span class="params">copy</span>)</span></span><br></pre></td></tr></table></figure><p>参数说明：</p><ul><li><strong>data</strong>：一组数据(ndarray、series, map, lists, dict 等类型)。</li><li><strong>index</strong>：索引值，或者可以称为行标签。</li><li><strong>columns</strong>：列标签，默认为 RangeIndex (0, 1, 2, …, n) 。</li><li><strong>dtype</strong>：数据类型。</li><li><strong>copy</strong>：拷贝数据，默认为 False。</li></ul><p>使用二维数组创建</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line">data = [[<span class="string">&#x27;Google&#x27;</span>,<span class="number">10</span>],[<span class="string">&#x27;Runoob&#x27;</span>,<span class="number">12</span>],[<span class="string">&#x27;Wiki&#x27;</span>,<span class="number">13</span>]]</span><br><span class="line"></span><br><span class="line">df = pd.DataFrame(data,columns=[<span class="string">&#x27;Site&#x27;</span>,<span class="string">&#x27;Age&#x27;</span>],dtype=<span class="built_in">float</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(df)</span><br></pre></td></tr></table></figure><p>使用numpy类型创建</p><p><img data-src="http://cdn.sekyoro.top/imgs/094017.png" alt="创建dataframe"></p><p>loc属性返回指定行或列</p><p><img data-src="http://cdn.sekyoro.top/imgs/094018.png" alt="loc"></p><h3 id="读取csv文件"><a href="#读取csv文件" class="headerlink" title="读取csv文件"></a>读取csv文件</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">df = pd.read_csv()</span><br><span class="line">df.tostring() <span class="comment">#to_string() 用于返回 DataFrame 类型的数据，如果不使用该函数，则输出结果为数据的前面 5 行和末尾 5 行</span></span><br><span class="line">df</span><br></pre></td></tr></table></figure><p><img data-src="http://cdn.sekyoro.top/imgs/094019.png" alt="读取csv"></p><p>存为csv文件</p><p>to_csv()将DataFrame数据存为csv</p><p><img data-src="http://cdn.sekyoro.top/imgs/094021.png" alt="存为csv文件"></p><h3 id="数据处理"><a href="#数据处理" class="headerlink" title="数据处理"></a>数据处理</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">head() <span class="comment">#前面几行</span></span><br><span class="line">tail() <span class="comment">#后面几行</span></span><br><span class="line">info() <span class="comment">#返回表格基本信息</span></span><br></pre></td></tr></table></figure><p><img data-src="http://cdn.sekyoro.top/imgs/094021-1.png" alt="查看csv文件"></p><h3 id="读取json文件"><a href="#读取json文件" class="headerlink" title="读取json文件"></a>读取json文件</h3><p>存储和交换文本信息的语法，类似 XML</p><p>JSON 比 XML 更小、更快，更易解析</p><p>主要是内嵌的json.</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">read_json</span><span class="params">()</span></span> #读取json文件</span><br><span class="line"><span class="function"><span class="title">json_normalize</span><span class="params">()</span></span> #将内嵌的数据完整解析</span><br></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;school_name&quot;</span>: <span class="string">&quot;ABC primary school&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;class&quot;</span>: <span class="string">&quot;Year 1&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;students&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">&quot;id&quot;</span>: <span class="string">&quot;A001&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;Tom&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;math&quot;</span>: <span class="number">60</span>,</span><br><span class="line">        <span class="attr">&quot;physics&quot;</span>: <span class="number">66</span>,</span><br><span class="line">        <span class="attr">&quot;chemistry&quot;</span>: <span class="number">61</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">&quot;id&quot;</span>: <span class="string">&quot;A002&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;James&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;math&quot;</span>: <span class="number">89</span>,</span><br><span class="line">        <span class="attr">&quot;physics&quot;</span>: <span class="number">76</span>,</span><br><span class="line">        <span class="attr">&quot;chemistry&quot;</span>: <span class="number">51</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">&quot;id&quot;</span>: <span class="string">&quot;A003&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;Jenny&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;math&quot;</span>: <span class="number">79</span>,</span><br><span class="line">        <span class="attr">&quot;physics&quot;</span>: <span class="number">90</span>,</span><br><span class="line">        <span class="attr">&quot;chemistry&quot;</span>: <span class="number">78</span></span><br><span class="line">    &#125;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>读取students并包括了school_name,class</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用 Python JSON 模块载入数据</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;nested_list.json&#x27;</span>,<span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    data = json.loads(f.read())</span><br><span class="line"></span><br><span class="line"><span class="comment"># 展平数据</span></span><br><span class="line">df_nested_list = pd.json_normalize(</span><br><span class="line">    data,</span><br><span class="line">    record_path =[<span class="string">&#x27;students&#x27;</span>],</span><br><span class="line">    meta=[<span class="string">&#x27;school_name&#x27;</span>, <span class="string">&#x27;class&#x27;</span>]</span><br><span class="line">)</span><br><span class="line"><span class="built_in">print</span>(df_nested_list)</span><br></pre></td></tr></table></figure><p>使用glom模块处理数据嵌套</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;school_name&quot;</span>: <span class="string">&quot;local primary school&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;class&quot;</span>: <span class="string">&quot;Year 1&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;students&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">&quot;id&quot;</span>: <span class="string">&quot;A001&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;Tom&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;grade&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;math&quot;</span>: <span class="number">60</span>,</span><br><span class="line">            <span class="attr">&quot;physics&quot;</span>: <span class="number">66</span>,</span><br><span class="line">            <span class="attr">&quot;chemistry&quot;</span>: <span class="number">61</span></span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">&quot;id&quot;</span>: <span class="string">&quot;A002&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;James&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;grade&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;math&quot;</span>: <span class="number">89</span>,</span><br><span class="line">            <span class="attr">&quot;physics&quot;</span>: <span class="number">76</span>,</span><br><span class="line">            <span class="attr">&quot;chemistry&quot;</span>: <span class="number">51</span></span><br><span class="line">        &#125;</span><br><span class="line">       </span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">&quot;id&quot;</span>: <span class="string">&quot;A003&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;Jenny&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;grade&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;math&quot;</span>: <span class="number">79</span>,</span><br><span class="line">            <span class="attr">&quot;physics&quot;</span>: <span class="number">90</span>,</span><br><span class="line">            <span class="attr">&quot;chemistry&quot;</span>: <span class="number">78</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>只读取math字段</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">from</span> glom <span class="keyword">import</span> glom</span><br><span class="line"></span><br><span class="line">df = pd.read_json(<span class="string">&#x27;nested_deep.json&#x27;</span>)</span><br><span class="line"></span><br><span class="line">data = df[<span class="string">&#x27;students&#x27;</span>].apply(<span class="keyword">lambda</span> row: glom(row, <span class="string">&#x27;grade.math&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span>(data)</span><br></pre></td></tr></table></figure><p>说实话,包括numpy这些东西找官网找api就行了.现在只需要大概过一遍.</p><h2 id="资料"><a href="#资料" class="headerlink" title="资料"></a>资料</h2><p><a href="https://www.runoob.com/pandas/pandas-series.html">Pandas 数据结构 – Series | 菜鸟教程 (runoob.com)</a></p><p><a href="http://www.pypandas.cn/">Pandas 中文 (pypandas.cn)</a></p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      
        <tags>
            
            <tag> python </tag>
            
            <tag> pandas </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>汇编实战</title>
      <link href="2022/01/12/%E6%B1%87%E7%BC%96%E5%AE%9E%E6%88%98/"/>
      <url>2022/01/12/%E6%B1%87%E7%BC%96%E5%AE%9E%E6%88%98/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>不多说,直接开冲<br><span id="more"></span></p><h2 id="开始"><a href="#开始" class="headerlink" title="开始"></a>开始</h2><p>环境 Ubuntu 20.0.4</p><p>工具 GNU套装包括gcc gdb</p><p>词法分析器flex,Bison,就是向后兼容的lex和yacc</p><p>词法分析是编译过程第一阶段,将输入的各种符号转为相应的标识符号.我们要使标识符号便于后续处理.</p><p>lex将*.l文件编译后生成lex.yy.c文件,然后由从编译器生成一个词法分析器.然后由c编译器编译生成词法分析器.lex接收输入并将输入按照规则转换.lex将输入的表达式和动作代码转换为宿主语言(这里是c),生成yylex函数.yylex识别字符流中的表达式,当匹配后就输出相应动作.</p><h3 id="Lex文件结构"><a href="#Lex文件结构" class="headerlink" title="Lex文件结构"></a>Lex文件结构</h3><figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">declarations</span><br><span class="line"><span class="variable">%%</span></span><br><span class="line"><span class="variable"></span>translation rules</span><br><span class="line"><span class="variable">%%</span></span><br><span class="line"><span class="variable"></span></span><br></pre></td></tr></table></figure><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      
        <tags>
            
            <tag> 汇编 </tag>
            
            <tag> 实战 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>python_opencv学习</title>
      <link href="2022/01/11/python-opencv%E5%AD%A6%E4%B9%A0/"/>
      <url>2022/01/11/python-opencv%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>之前碰过,现在想系统学一下.设计opencv-python,Numpy,Matploylib这几个库<br><span id="more"></span></p><h1 id="开始"><a href="#开始" class="headerlink" title="开始"></a>开始</h1><p>将涉及到的库安装后,导入</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> cv2 <span class="comment">#导入需要用cv2</span></span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br></pre></td></tr></table></figure><p>安装opencv-python时已经装了numpy了.</p><p>涉及方法</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">imread()  <span class="comment">#传入图像路径</span></span><br><span class="line">imsave()  <span class="comment">#保存图像名字以及image</span></span><br></pre></td></tr></table></figure><p>我们读入一个图像并尝试打印</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">image = imread(<span class="string">&quot;image.jpg&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(image)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(image))</span><br></pre></td></tr></table></figure><p><img data-src="http://cdn.sekyoro.top/imgs/093951.png" alt="打印image"></p><p>可以看到结果是多维数组,类型其实是Numpy的数组类型,所以搭配Numpy很好操作.</p><p>这里涉及到图像的知识,图像在计算机中的存储.</p><p><img data-src="http://cdn.sekyoro.top/imgs/065829.png" alt="三信道矩阵"></p><p><strong>值得注意的:opencv得到的三通道像素点是BGR格式.</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#得到image对象后</span></span><br><span class="line">image[<span class="number">0</span>,<span class="number">0</span>]  <span class="comment">#0,0位置上像素  直接修改即可</span></span><br><span class="line">image[<span class="number">0</span>:<span class="number">100</span>,<span class="number">0</span>:<span class="number">200</span>] = (<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>) <span class="comment">#将一个矩形区域改为黑色</span></span><br></pre></td></tr></table></figure><h3 id="拆分和合并图像信道"><a href="#拆分和合并图像信道" class="headerlink" title="拆分和合并图像信道"></a>拆分和合并图像信道</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">split() <span class="comment">#拆分信道</span></span><br><span class="line">merge() <span class="comment">#合并信道</span></span><br><span class="line"><span class="comment">#拆分信道  结果为bgr</span></span><br><span class="line"><span class="comment">#image打印得到一个numpy矩阵</span></span><br><span class="line">b,g,r = cv2.split(image)</span><br><span class="line"><span class="comment">#合并信道</span></span><br><span class="line"><span class="built_in">sum</span> = cv2.merge([r,g,b])</span><br><span class="line">cv2.imwrite(<span class="string">&#x27;reverse.jpg&#x27;</span>,<span class="built_in">sum</span>)</span><br></pre></td></tr></table></figure><p>主要用于将三信道彩色图像拆分为b,g,r三个单信道,也就是三个灰度图.</p><h3 id="访问图像属性"><a href="#访问图像属性" class="headerlink" title="访问图像属性"></a>访问图像属性</h3><p>一张图像具有多个属性：行数、列数、通道数、图像数据类型、像素数等.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">image = imread(<span class="string">&quot;&quot;</span>)  <span class="comment">#参数是一个图像地址</span></span><br><span class="line">image.shape <span class="comment">#图像属性</span></span><br><span class="line">image.dtype <span class="comment">#图像的数值类型</span></span><br><span class="line">image.size  <span class="comment">#图像大小,其实就是高x宽</span></span><br></pre></td></tr></table></figure><p>当意识到imread返回的其实是一个矩阵,我们就能利用numpy的一些方法.</p><p><img data-src="http://cdn.sekyoro.top/imgs/065830.png" alt="image-20220111172001806"></p><p>可以看到 <code>image.shape</code> 返回的是一组包含图片属性的元组。第一个元素是图片的高，表示图片有多少行像素。第二个元素是图片的宽，表示图片有多少列像素。最后一个元素 <code>3</code> 是图片的通道数，我们使用的是 RGB 彩色图片，所以一共有三个通道.是彩色图像</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(image))</span><br><span class="line"><span class="comment"># ndarray</span></span><br></pre></td></tr></table></figure><p><code>image.dtype</code> 获取像素值的数据类型，可以看到像素值的数据类型是 <code>uint8</code> 表示 8 位无符号整数。因为像素值的范围是 0 到 255，而 <code>uint8</code> 也是在这一范围.</p><div class="table-container"><table><thead><tr><th style="text-align:left">属性</th><th style="text-align:left">说明</th></tr></thead><tbody><tr><td style="text-align:left">ndarray.ndim</td><td style="text-align:left">秩，即轴的数量或维度的数量</td></tr><tr><td style="text-align:left">ndarray.shape</td><td style="text-align:left">数组的维度，对于矩阵，n 行 m 列</td></tr><tr><td style="text-align:left">ndarray.size</td><td style="text-align:left">数组元素的总个数，相当于 .shape 中 n*m 的值</td></tr><tr><td style="text-align:left">ndarray.dtype</td><td style="text-align:left">ndarray 对象的元素类型</td></tr><tr><td style="text-align:left">ndarray.itemsize</td><td style="text-align:left">ndarray 对象中每个元素的大小，以字节为单位</td></tr><tr><td style="text-align:left">ndarray.flags</td><td style="text-align:left">ndarray 对象的内存信息</td></tr><tr><td style="text-align:left">ndarray.real</td><td style="text-align:left">ndarray元素的实部</td></tr><tr><td style="text-align:left">ndarray.imag</td><td style="text-align:left">ndarray 元素的虚部</td></tr><tr><td style="text-align:left">ndarray.data</td><td style="text-align:left">包含实际数组元素的缓冲区，由于一般通过数组的索引获取元素，所以通常不需要使用这个属性。</td></tr></tbody></table></div><h2 id="画图"><a href="#画图" class="headerlink" title="画图"></a>画图</h2><h3 id="画直线"><a href="#画直线" class="headerlink" title="画直线"></a>画直线</h3><p>首先创建一个图像,利用numpy数组</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">region = np.zeros((<span class="number">500</span>,<span class="number">500</span>,<span class="number">3</span>),dtype=np.uint8)</span><br></pre></td></tr></table></figure><p>默认dtype是浮点数,最好改为np.uint8或int.</p><p>返回值是一个全为0的三维矩阵,数据类型是uint8.</p><p>然后利用cv2line()</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">line = cv2.line(region,(<span class="number">50</span>,<span class="number">50</span>),(<span class="number">450</span>,<span class="number">450</span>),(<span class="number">0</span>,<span class="number">0</span>,<span class="number">255</span>),<span class="number">5</span>) <span class="comment">#region是背景图像,也就是创建的图片,接着的参数是线的起始和终止点,bgr颜色和厚度</span></span><br></pre></td></tr></table></figure><p>最后使用imwrite保存即可</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cv2.imwrite(<span class="string">&#x27;line.jpg&#x27;</span>,line) <span class="comment">#line是一个numpy类型</span></span><br></pre></td></tr></table></figure><p>当然也可以定义线的类型,详见官方文档</p><p>其他的创建数组方式有</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">numpy.empty()  <span class="comment">#np.empty([3,2], dtype = int) </span></span><br><span class="line">numpy.ones() <span class="comment">#np.ones([2,2], dtype = int)</span></span><br><span class="line">numpy.randn() <span class="comment">#numpy.random.randn(2,3)</span></span><br><span class="line">numpy.arange() <span class="comment">#从范围内创建数组</span></span><br><span class="line">numpy.eye()  <span class="comment">#对角矩阵 参数是行列数</span></span><br><span class="line">numpy.full() <span class="comment">#任意值的初始化</span></span><br></pre></td></tr></table></figure><h3 id="画矩形"><a href="#画矩形" class="headerlink" title="画矩形"></a>画矩形</h3><p>与画直线类似,需要定义左上角和右上角.厚度为负数则为填充图形.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">region = np.zeros((<span class="number">500</span>,<span class="number">500</span>,<span class="number">3</span>))</span><br><span class="line">rectangle = cv.rectangle(region,(<span class="number">50</span>,<span class="number">50</span>),(<span class="number">150</span>,<span class="number">150</span>),(<span class="number">0</span>,<span class="number">255</span>,<span class="number">0</span>),-<span class="number">1</span>)</span><br><span class="line">cv.imwrite(<span class="string">&quot;rectangle.jpg&quot;</span>,rectangle)</span><br></pre></td></tr></table></figure><p><img data-src="http://cdn.sekyoro.top/imgs/093954.png" alt="矩形图像"></p><p>画圆和椭圆类似,就是用的方法不一样而已</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cv2.circle() <span class="comment">#画圆</span></span><br><span class="line">cv2.ellipse() <span class="comment">#椭圆</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">#画圆</span></span><br><span class="line">region = np.zeros((<span class="number">500</span>,<span class="number">500</span>,<span class="number">3</span>))</span><br><span class="line">circle = cv.circle(region,(<span class="number">250</span>,<span class="number">250</span>),<span class="number">200</span>,(<span class="number">0</span>,<span class="number">255</span>,<span class="number">0</span>),-<span class="number">1</span>)</span><br><span class="line">cv.imwrite(<span class="string">&quot;circle.jpg&quot;</span>,circle)</span><br></pre></td></tr></table></figure><p>指定圆心与半径即可</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">region = np.zeros((<span class="number">500</span>,<span class="number">500</span>,<span class="number">3</span>))</span><br><span class="line">ellipse = cv2.ellipse(region, (<span class="number">200</span>, <span class="number">200</span>), (<span class="number">150</span>, <span class="number">50</span>), <span class="number">0</span>, <span class="number">0</span>, <span class="number">180</span>, (<span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>), -<span class="number">1</span>)</span><br><span class="line">cv2.imwrite(<span class="string">&quot;ellipse.jpg&quot;</span>, ellipse)</span><br></pre></td></tr></table></figure><p>调用 <code>cv2.ellipse</code> 函数绘制椭圆。第一个参数 <code>region</code> 是要在上面绘制椭圆的图片。第二个参数 <code>(200, 200)</code> 是椭圆中心的坐标。第三个参数 <code>(150, 50)</code> 表示椭圆的轴长，其中 <code>150</code> 表示长轴，<code>50</code> 表示短轴。第四个参数 <code>0</code> 表示椭圆处于一个水平的状态，第四个参数表示沿顺时针方向椭圆的旋转角度 。第五个参数 <code>0</code> 表示沿顺时针方向绘制椭圆的起始角度，第六个参数 <code>180</code> 表示沿顺时针方向绘制椭圆的结束角度 ，所以第五、第六参数表示我们将绘制半个椭圆。第七个参数 <code>(0, 255, 0)</code> 表示绘制椭圆的颜色为绿色。第八个参数 <code>-1</code> 表示用绿色将这半个椭圆填充满</p><p>还有多边形和添加文本,不过说实话,感觉用处不大</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pts = np.array([[[<span class="number">10</span>, <span class="number">60</span>]], [[<span class="number">290</span>, <span class="number">250</span>]], [[<span class="number">300</span>, <span class="number">350</span>]], [[<span class="number">470</span>, <span class="number">390</span>]]], np.int32)  <span class="comment">#列表是顶点数*1*2</span></span><br><span class="line">polylines = cv2.polylines(region, [pts], <span class="literal">True</span>, (<span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>), <span class="number">5</span>)</span><br><span class="line">cv2.imwrite(<span class="string">&quot;polylines.jpg&quot;</span>, polylines)</span><br></pre></td></tr></table></figure><p> True表示各个顶点连线闭合得到多边形,其余参数类似.</p><p>添加文字</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cv2.putText()  <span class="meta">#参数分别为添加文字的图像,添加的字符串,添加的位置</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">words = cv2.putText(region, <span class="string">&quot;Vision&quot;</span>, (<span class="number">100</span>, <span class="number">250</span>), cv2.FONT_HERSHEY_SIMPLEX, <span class="number">3</span>, (<span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>), <span class="number">10</span>, cv2.LINE_AA)</span><br><span class="line">cv2.imwrite(<span class="string">&quot;words.jpg&quot;</span>, words)</span><br></pre></td></tr></table></figure><p><img data-src="http://cdn.sekyoro.top/imgs/093955.png" alt="插入文本"></p><p>第四个参数 <code>cv2.FONT_HERSHEY_SIMPLEX</code> 是字体类型，第五个参数 <code>3</code> 是字体的大小，第六个参数 <code>(0, 255, 0)</code> 是字体的颜色，第七个参数 <code>10</code> 是文字线条的粗细，第八个参数 <code>cv2.LINE_AA</code> 是线条的类型。</p><h2 id="图像的处理"><a href="#图像的处理" class="headerlink" title="图像的处理"></a>图像的处理</h2><h3 id="图像的缩放"><a href="#图像的缩放" class="headerlink" title="图像的缩放"></a>图像的缩放</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cv2.resize()</span><br><span class="line">resized = cv2.resize(image, (<span class="number">0</span>, <span class="number">0</span>), fx=<span class="number">0.5</span>, fy=<span class="number">0.5</span>, interpolation = cv2.INTER_AREA)</span><br><span class="line">cv2.imwrite(<span class="string">&quot;resized.jpg&quot;</span>,resized)</span><br></pre></td></tr></table></figure><p>使用 <code>cv2.resize</code> 函数来对图片的尺寸进行缩放，该函数的第一个参数 <code>image</code> 是要被缩放的图片。第二个参数 <code>(0, 0)</code> 是一个元组，表示输出图片的尺寸，元组内的第一个元素表示图片的宽，第二个表示图片的高。第三参数 <code>fx = 0.5</code> 表示沿图片的宽的缩放系数，第四参数 <code>fy = 0.5</code> 表示沿图片的高的缩放系数。第五个参数 <code>interpolation = cv2.INTER_AREA)</code> 是插值方法，表明图片是用哪种方法被缩放的，<code>cv2.resize</code> 默认的插值方法是 <code>cv2.INTER_LINEAR</code>，大家也可以尝试使用其他方法： <code>cv2.INTER_NEAREST</code>、<code>cv2.INTER_CUBIC</code>、<code>cv2.INTER_LANCZ0S4</code>。我们也可以尝试定义输出图片尺寸来对图片进行缩放。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">resized = cv2.resize(image, (<span class="number">0</span>, <span class="number">0</span>), fx=<span class="number">0.5</span>, fy=<span class="number">0.5</span>, \</span><br><span class="line">interpolation = cv2.INTER_AREA)</span><br><span class="line">height, width = image.shape[:<span class="number">2</span>]</span><br><span class="line"><span class="comment"># height width -&gt; h w</span></span><br><span class="line">w = <span class="number">200</span></span><br><span class="line">h = <span class="built_in">int</span>(height*(w / width))</span><br><span class="line"><span class="built_in">print</span>(height,width)</span><br><span class="line">cv2.imwrite(<span class="string">&quot;resized.jpg&quot;</span>,resized)</span><br></pre></td></tr></table></figure><p>当将此参数设置为 <code>(0, 0)</code> 时，图片的输出尺寸由后面两个缩放系数 <code>fx</code> 和 <code>fy</code> 分别与函数的输入图片的宽和高相乘得出，当此参数不等于 <code>(0, 0)</code> 时，输出图片的尺寸等于我们自己设定的值</p><h3 id="图像平移"><a href="#图像平移" class="headerlink" title="图像平移"></a>图像平移</h3><p>图片的平移是让图片中所有的像素点沿着坐标轴移动相同的距离，视觉上看起来就是图片在进行上、下、左、右移动.</p><p>对图片进行平移时，我们要先确定图片向哪个方向移动、移动多少</p><p><img data-src="http://cdn.sekyoro.top/imgs/093958.png" alt="图像平移"></p><p>使用 <code>cv2.warpAffine</code> 函数对图片进行平移，第一个参数 <code>image</code> 是要被平移的图片。第二个参数 <code>M</code> 是我们刚才创建的矩阵 <code>M</code>。第三个参数 <code>(width, height)</code> 是输出的图片尺寸，这里我们输出的尺寸和输入的原始图片尺寸一样，<code>width</code> 表示图片的宽，<code>height</code> 表示图片的高</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">height,width = image.shape[:<span class="number">2</span>]</span><br><span class="line">M = np.float32([[<span class="number">1</span>,<span class="number">0</span>,<span class="number">100</span>],[<span class="number">0</span>,<span class="number">1</span>,<span class="number">50</span>]])</span><br><span class="line">translation = cv2.warpAffine(image,M,(width,height))</span><br><span class="line">cv2.imwrite(<span class="string">&#x27;translation.jpg&#x27;</span>,translation)</span><br></pre></td></tr></table></figure><h2 id="图像的运算"><a href="#图像的运算" class="headerlink" title="图像的运算"></a>图像的运算</h2><p><strong>算术运算和按位运算</strong></p><p>图像的算术运算在图像增强中普遍应用，其可对图片进行增加亮度、减少亮度、增强对比度等操作以满足特定的图像处理需求，还可以通过将两幅图片进行算术运算以达到图像融合的效果。</p><p>图像的按位运算在图像分割、目标检测和识别、模式识别中得到广泛的应用</p><h3 id="算术运算"><a href="#算术运算" class="headerlink" title="算术运算"></a>算术运算</h3><p>使用 <code>cv2.add</code> 、<code>cv2.subtract</code>、<code>cv2.multiply</code>、<code>cv2.divide</code> 即可实现加、减、乘、除运算</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">M = img1.shape</span><br><span class="line">    x = np.ones(M,dtype=np.uint8)</span><br><span class="line">    x =x *<span class="number">150</span></span><br><span class="line"></span><br><span class="line">    sums = cv2.add(img1,x)</span><br><span class="line">    cv2.imwrite(<span class="string">&quot;sums.jpg&quot;</span>,sums)  <span class="comment">#图像变亮  即像素增加</span></span><br><span class="line">     <span class="comment"># 图像变暗</span></span><br><span class="line">    sub = cv2.subtract(img2,x)</span><br><span class="line">    cv2.imwrite(<span class="string">&quot;sub.jpg&quot;</span>,sub)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 相乘</span></span><br><span class="line">    mul = cv2.multiply(img1,x)</span><br><span class="line">    cv2.imwrite(<span class="string">&quot;mul.jpg&quot;</span>,mul)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 相除</span></span><br><span class="line">    div = cv2.divide(img1,x)</span><br><span class="line">    cv2.imwrite(<span class="string">&quot;div.jpg&quot;</span>,div)</span><br></pre></td></tr></table></figure><p>对于两张图片相加减,需要将图片大小调整为相同.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">image2 = cv2.resize(image2, (image1.shape[<span class="number">1</span>], image1.shape[<span class="number">0</span>]), interpolation=cv2.INTER_CUBIC)</span><br><span class="line">sums = cv2.add(image1, image2)</span><br><span class="line">cv2.imwrite(<span class="string">&quot;sums.jpg&quot;</span>, sums)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sums = cv2.add(image1, image2)</span><br><span class="line">cv2.imwrite(<span class="string">&quot;sums.jpg&quot;</span>, sums)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sub = cv2.subtract(image1, image2)</span><br><span class="line">cv2.imwrite(<span class="string">&quot;sub.jpg&quot;</span>, sub)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mul = cv2.multiply(image1, image2)</span><br><span class="line">cv2.imwrite(<span class="string">&quot;mul.jpg&quot;</span>, mul)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">div = cv2.divide(image1, image2)</span><br><span class="line">cv2.imwrite(<span class="string">&quot;div.jpg&quot;</span>, div)</span><br></pre></td></tr></table></figure><p>运算后的结果与单纯的十进制算术运算结果不同。这是因为我们用 <code>8</code> 位无符号整数表示 0 到 255，OpenCV 的算术运算函数是饱和运算，当运算结果大于 255 时函数输出 <code>255</code>，当运算结果小于 0 时函数输出 <code>0</code>。这里需要同 NumPy 的算术运算区分开，NumPy 的运算是取模运算，即当运算结果大于 255 时则最后得到的是运算结果对 256 取模</p><h3 id="按位运算"><a href="#按位运算" class="headerlink" title="按位运算"></a>按位运算</h3><p><code>and</code> 运算是当两个像素值都大于 0 时为真，<code>or</code> 运算是当两个像素值有一个大于 0 时为真，<code>xor</code> 运算是当两个像素值有一个大于 0 但不同时都大于 0 则为真。<code>not</code> 则是一个取反的运算.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cv2.bitwise_and(a, b)</span><br><span class="line">cv2.bitwise_or(a, b)</span><br><span class="line">cv2.bitwise_xor(a, b)</span><br><span class="line">cv2.bitwise_not(a)</span><br></pre></td></tr></table></figure><p>图片的按位运算。两张图片的按位运算就是将两张尺寸通道数相同的图片中的每个像素值分别进行 <code>and</code>、<code>or</code>、<code>xor</code>、<code>not</code> 运算</p><p><img data-src="http://cdn.sekyoro.top/imgs/065833.png" alt="图片相与"></p><p><img data-src="http://cdn.sekyoro.top/imgs/065836.png" alt="图片相或"></p><p>相与可以只取白色部分,或可以去掉白色部分</p><p>所以这就涉及到掩码(mask)</p><p>利用np.zeros创造黑图,创建一张黑色图片，因为这张图片的尺寸要和进行掩膜操作的原图片的尺寸一样.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mask = np.zeros(image1.shape[:<span class="number">2</span>], np.uint8)</span><br><span class="line">mask[<span class="number">100</span>:<span class="number">300</span>, <span class="number">200</span>:<span class="number">300</span>] = <span class="number">255</span></span><br></pre></td></tr></table></figure><p>然后利用改变像素得到白图.使用 <code>cv2.bitwise_and</code> 函数进行掩膜操作，函数第一个和第二个参数相同，都是我们的原始图片 <code>image1</code> ，第三个参数 <code>mask</code> 就是我们刚才创建的掩膜图片。该函数会把原图片中对应于掩膜图片的白色区域显示出来，其他区域会被黑色遮盖</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">imagemask = cv2.bitwise_and(image1, image1, mask = mask)</span><br><span class="line">cv2.imwrite(<span class="string">&quot;imagemask.jpg&quot;</span>, imagemask)</span><br></pre></td></tr></table></figure><h3 id="颜色空间"><a href="#颜色空间" class="headerlink" title="颜色空间"></a>颜色空间</h3><p>除了RGB还有HSV和LAB,描述色彩模型.</p><p>颜色空间是一种描述色彩的模型，其作用是在不同的标准下对不同颜色的说明。OpenCV 中有上百种颜色空间转换方法</p><h3 id="图像的旋转"><a href="#图像的旋转" class="headerlink" title="图像的旋转"></a>图像的旋转</h3><p><img data-src="http://cdn.sekyoro.top/imgs/094000.png" alt="图像旋转"></p><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cv.getRotatio<span class="symbol">nMatrix2</span>D<span class="comment">()</span> <span class="attr">#参数分别为旋转中心,角度,缩放</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">img = cv.imread(<span class="string">&#x27;messi5.jpg&#x27;</span>,<span class="number">0</span>)</span><br><span class="line">rows,cols = img.shape</span><br><span class="line"><span class="comment"># cols-1 和 rows-1 是坐标限制</span></span><br><span class="line">M = cv.getRotationMatrix2D(((cols-<span class="number">1</span>)/<span class="number">2.0</span>,(rows-<span class="number">1</span>)/<span class="number">2.0</span>),<span class="number">90</span>,<span class="number">1</span>)</span><br><span class="line">dst = cv.warpAffine(img,M,(cols,rows))</span><br></pre></td></tr></table></figure><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">height</span>,width = image.shape[:<span class="number">2</span>]</span><br><span class="line"><span class="attribute">M</span> = cv<span class="number">2</span>.getRotationMatrix<span class="number">2</span>D((<span class="number">50</span>,<span class="number">50</span>),<span class="number">30</span>,<span class="number">1</span>)</span><br><span class="line"><span class="attribute">rotation</span> = cv<span class="number">2</span>.warpAffine(image,M,(width,height)) </span><br><span class="line"><span class="attribute">cv2</span>.imwrite(<span class="string">&quot;rotation1.jpg&quot;</span>, rotation)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="图像的翻转"><a href="#图像的翻转" class="headerlink" title="图像的翻转"></a>图像的翻转</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 翻转</span></span><br><span class="line">turn = cv2.flip(image, <span class="number">1</span>)  <span class="comment">#1表示水平</span></span><br><span class="line">cv2.imwrite(<span class="string">&quot;turn1.jpg&quot;</span>, turn)</span><br><span class="line"></span><br><span class="line">turn = cv2.flip(image, <span class="number">0</span>) <span class="comment"># 0表示垂直</span></span><br><span class="line">cv2.imwrite(<span class="string">&quot;turn2.jpg&quot;</span>, turn)</span><br><span class="line"></span><br><span class="line">turn = cv2.flip(image, -<span class="number">1</span>)</span><br><span class="line">cv2.imwrite(<span class="string">&quot;turn3.jpg&quot;</span>, turn) <span class="comment"># -1表示两个反向</span></span><br></pre></td></tr></table></figure><p>此外还有仿射变换和透视变换</p><h2 id="图像分割"><a href="#图像分割" class="headerlink" title="图像分割"></a>图像分割</h2><h3 id="阈值方法"><a href="#阈值方法" class="headerlink" title="阈值方法"></a>阈值方法</h3><p>通过设定一个值,通过这个值去除图像中的多于信息.这个值就叫阈值.</p><p>阈值法是一种图像分割的方法，阈值法因其简单、稳定、计算量小的特征使其在传统算法中得到广泛应用。阈值法是将灰度图像进行二值化以达到分割图像，获得特定感兴趣区域的方法。阈值法的通常做法是将灰度图转换为二值图，使得图片中的像素值只有 0 和 255 这两种值</p><h4 id="简单阈值"><a href="#简单阈值" class="headerlink" title="简单阈值"></a>简单阈值</h4><p>为的选定一个阈值 <code>T</code> ，对于灰度图片中所有小于 <code>T</code> 的像素值设置为 0，将图片中所有大于 <code>T</code> 的像素值设置为 255。也可将大于阈值的像素值设置为 0，小于阈值的设置为 255</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 简单阈值</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">simple</span>():</span></span><br><span class="line">    image = cv2.imread(<span class="string">&quot;1.jpg&quot;</span>)</span><br><span class="line">    grayimage = cv2.cvtColor(image,cv2.COLOR_BGR2GRAY)</span><br><span class="line">    cv2.imwrite(<span class="string">&#x27;gray.jpg&#x27;</span>,grayimage)</span><br><span class="line">    T,thresh = cv2.threshold(grayimage,<span class="number">200</span>,<span class="number">255</span>,cv2.THRESH_BINARY)</span><br><span class="line">    cv2.imwrite(<span class="string">&#x27;thresh1.jpg&#x27;</span>,thresh)</span><br></pre></td></tr></table></figure><p>输入上面得到的灰度图。第二个参数 <code>200</code> 是我们要设置的阈值，第三个参数 <code>255</code> 表示当图像中的像素值大于 <code>200</code> 那么该像素值将被替换成 <code>255</code>，否则像素值将会被设置为 <code>0</code>。第四个参数是设置阈值的方法，这里使用的是 <code>cv2.THRESH_BINARY</code>，该方法将会把所有大于第二个参数的像素值设置为第三个参数也就是 <code>255</code>。</p><h4 id="自适应阈值"><a href="#自适应阈值" class="headerlink" title="自适应阈值"></a>自适应阈值</h4><p>自适应阈值法可以帮助我们优化简单阈值法的弊端。自适应阈值是基于一小片区域的像素值来确定阈值的，所以处理一张图片可以获得多个阈值</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#自适应阈值</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">adapt</span>():</span></span><br><span class="line">    image = cv2.imread(<span class="string">&quot;1.jpg&quot;</span>)</span><br><span class="line">    grayimage = cv2.cvtColor(image,cv2.COLOR_BGR2GRAY)</span><br><span class="line">    thresh = cv2.adaptiveThreshold(grayimage,<span class="number">255</span>,cv2.ADAPTIVE_THRESH_MEAN_C,cv2.THRESH_BINARY,<span class="number">9</span>,<span class="number">3</span>)</span><br><span class="line">    cv2.imwrite(<span class="string">&#x27;thresh1.jpg&#x27;</span>, thresh)</span><br></pre></td></tr></table></figure><p>函数的第一个参数 <code>grayimage</code> 是要二值化的的灰度图。第二个参数 <code>255</code> 是像素的最大值，作用同 <code>cv2.threshold</code> 第三个参数一样。第三个参数 <code>cv2.ADAPTIVE_THRESH_MEAN_C</code> 是计算阈值的方法，该方法会计算像素邻近区域的平均值然后减去一个常数 <code>C</code>，这个常数是整数且是该函数的第六个参数。第四个参数 <code>cv2.THRESH_BINARY</code> 是前面讲过的设置阈值的方法。第五个参数 <code>9</code> 是用来计算阈值的区域的大小，该参数必须是奇数，这里我们设置其值为 <code>9</code> 表示我们将计算 <code>9*9</code> 区域内的阈值。第六个参数 <code>3</code> 就是前面提到的常数 <code>C</code></p><p>也可以将第三个参数设置为 <code>cv2.ADAPTIVE_THRESH_GAUSSIAN_C</code> 表示用领域值的高斯加权总和减去常数 <code>C</code></p><h4 id="Otsu阈值"><a href="#Otsu阈值" class="headerlink" title="Otsu阈值"></a>Otsu阈值</h4><p>Otsu 方法是另一种自动计算阈值的方法，是一种寻找一个阈值将图片分为前景和背景的方法，其优点是不受图像的亮度和对比度的影响</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Otsu阈值</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Otsu</span>():</span></span><br><span class="line">    image = cv2.imread(<span class="string">&quot;1.jpg&quot;</span>)</span><br><span class="line">    grayimage = cv2.cvtColor(image, cv2.COLOR_BGR2GRAY)</span><br><span class="line">    T,thresh = cv2.threshold(grayimage,<span class="number">0</span>,<span class="number">255</span>,cv2.THRESH_OTSU)</span><br><span class="line">    cv2.imwrite(<span class="string">&#x27;thresh.jpg&#x27;</span>, thresh)</span><br><span class="line">    <span class="built_in">print</span>(T)</span><br><span class="line">    T, thresh = cv2.threshold(grayimage, <span class="number">0</span>, <span class="number">255</span>, cv2.THRESH_OTSU+cv2.THRESH_BINARY_INV)</span><br><span class="line">    cv2.imwrite(<span class="string">&#x27;rthresh.jpg&#x27;</span>, thresh)</span><br></pre></td></tr></table></figure><p>还可以在 <code>cv2.threshold</code> 函数的第四个参数 <code>cv2.THRESH_OTSU</code> 后面添加设置阈值的方法来呈现不同的处理结果。</p><h2 id="图像平滑"><a href="#图像平滑" class="headerlink" title="图像平滑"></a>图像平滑</h2><p>图像平滑也可称为滤波，是一种用于减少图像噪声且会让图像变得模糊的方法。图像平滑常常在图像预处理时使用，其主要目的是减少图像中的噪声，使得后续的处理操作能够获得更好的效果和可靠性。</p><p><img data-src="http://cdn.sekyoro.top/imgs/094001.png" alt="像素值"></p><p>每个数字表示像素值，红色方框是一个 <code>3*3</code> 矩阵或者称之为卷积核。图像平滑实际上是使用一个 <code>m*k</code> 的矩阵在图片上移动并与像素值进行相应计算来实现的</p><h3 id="均值滤波"><a href="#均值滤波" class="headerlink" title="均值滤波"></a>均值滤波</h3><p>均值滤波就是线性滤波，是指用一个 <code>m*m</code> 的模板（卷积核）在图像上滑动，其中 <code>m</code> 是正整数且是奇数，当模板在滑动时，处于模板中心的像素值将会被其周围的像素值的平均值所替代。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 均值滤波</span></span><br><span class="line">image = cv2.imread(<span class="string">&quot;1.jpg&quot;</span>)</span><br><span class="line">blur = cv2.blur(image, (<span class="number">5</span>, <span class="number">5</span>))</span><br><span class="line">blur = cv2.resize(blur, (<span class="number">0</span>, <span class="number">0</span>), fx=<span class="number">0.5</span>, fy=<span class="number">0.3</span>)</span><br><span class="line">cv2.imshow(<span class="string">&#x27;blur&#x27;</span>, blur)</span><br><span class="line">cv2.waitKey(<span class="number">0</span>)</span><br></pre></td></tr></table></figure><h3 id="高斯滤波"><a href="#高斯滤波" class="headerlink" title="高斯滤波"></a>高斯滤波</h3><p>高斯滤波是为了克服平滑处理导致的图像边缘信息丢失的问题。高斯滤波比较类似均值滤波，但是高斯滤波在计算均值时使用了权重。卷积核的中心像素值是由相邻像素的加权平均得到的，越靠近中心像素的像素值的权重越大</p><p>通过 <code>cv2.GaussianBlur</code> 函数来实现高斯滤波。第一个参数 <code>image</code> 是要进行高斯平滑的图片，第二个参数 <code>(5, 5)</code> 是高斯卷积核的大小，第三个参数 <code>0</code> 是 <code>x</code> 轴方向的高斯卷积核的标准差，这里设置为 <code>0</code> 表示让 OpenCV 根据卷积核大小自动计算</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 高斯滤波</span></span><br><span class="line">image = cv2.imread(<span class="string">&quot;1.jpg&quot;</span>)</span><br><span class="line">blur = cv2.GaussianBlur(image, (<span class="number">5</span>, <span class="number">5</span>), <span class="number">0</span>)</span><br><span class="line">blur = cv2.resize(blur, (<span class="number">0</span>, <span class="number">0</span>), fx=<span class="number">0.5</span>, fy=<span class="number">0.3</span>)</span><br><span class="line">cv2.imshow(<span class="string">&#x27;blur&#x27;</span>, blur)</span><br><span class="line">cv2.waitKey(<span class="number">0</span>)</span><br></pre></td></tr></table></figure><h3 id="中位滤波"><a href="#中位滤波" class="headerlink" title="中位滤波"></a>中位滤波</h3><p>中位滤波首先需要设定一个 <code>m*m</code> 的卷积核，当卷积核在图片上滑动时将卷积核中的每个值进行排序，取排序后的中间值作为卷积核中心的像素值。中位滤波对去除图片中的椒盐噪声有较好的效果.</p><p>椒盐噪声就是图片中存在许多白色和黑色的点，其会给图像处理带来一定的困难</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 中位滤波</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">median</span>():</span></span><br><span class="line">    image = cv2.imread(<span class="string">&quot;2.jpg&quot;</span>)</span><br><span class="line">    blur = cv2.medianBlur(image, <span class="number">3</span>)</span><br><span class="line">    blur = cv2.resize(blur, (<span class="number">0</span>, <span class="number">0</span>), fx=<span class="number">0.5</span>, fy=<span class="number">0.3</span>)</span><br><span class="line">    cv2.imshow(<span class="string">&#x27;median&#x27;</span>, blur)</span><br><span class="line">    cv2.waitKey(<span class="number">0</span>)</span><br></pre></td></tr></table></figure><h3 id="双边滤波"><a href="#双边滤波" class="headerlink" title="双边滤波"></a>双边滤波</h3><p>双边滤波是一种使用两个高斯函数，在减少噪声同时也可以保留边缘信息的平滑方法。双边滤波使用两个权重，距离卷积核的中心点越近的像素权重越大，相邻区域内像素的强度与中心像素的强度越相似，其所获得的权重就越大。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 双边滤波</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bila</span>():</span></span><br><span class="line">    image = cv2.imread(<span class="string">&quot;2.jpg&quot;</span>)</span><br><span class="line">    blur = cv2.bilateralFilter(image,<span class="number">9</span>,<span class="number">45</span>,<span class="number">45</span>)</span><br><span class="line">    blur = cv2.resize(blur, (<span class="number">0</span>, <span class="number">0</span>), fx=<span class="number">0.5</span>, fy=<span class="number">0.3</span>)</span><br><span class="line">    cv2.imshow(<span class="string">&#x27;median&#x27;</span>, blur)</span><br><span class="line">    cv2.waitKey(<span class="number">0</span>)</span><br></pre></td></tr></table></figure><p>第二个参数 <code>9</code> 是在进行滤波过程中每个像素其相邻区域像素的直径，第三个参数 <code>45</code> 是颜色标准差，这个值越大表示更多的相邻区域内颜色在进行滤波时会被考虑。第四个参数 <code>45</code> 是坐标空间的标准差，这个值越大表示距离中心像素较远的像素会影响计算.</p><h2 id="边缘检测"><a href="#边缘检测" class="headerlink" title="边缘检测"></a>边缘检测</h2><p>边缘是图像中的一种重要信息，边缘将图片分成不同的区域，每个区域代表不同的物体。边缘有一个重要的特征：在边缘两侧区域的像素灰度值差异较大，而边缘上的像素灰度值差异不明显。</p><p>为了检测到边缘，我们需要找到一种方法确定哪些区域是存在灰度值的“突变”的，使用梯度可以找到灰度值变化明显的地方，梯度变化的幅度可以用来检测边缘</p><h3 id="Sobel算子"><a href="#Sobel算子" class="headerlink" title="Sobel算子"></a>Sobel算子</h3><p>使用 <code>cv2.Sobel</code> 函数来计算水平方向和垂直方向的梯度,值得注意的是梯度值可能为负数(由大到小).所以需要取绝对值.同时最后要将两个方向的图重合,利用相或操作.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sobel</span>():</span></span><br><span class="line">    x = cv2.Sobel(image, cv2.CV_64F, <span class="number">1</span>, <span class="number">0</span>)</span><br><span class="line">    y = cv2.Sobel(image, cv2.CV_64F, <span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line">    x = np.uint8(np.absolute(x))  <span class="comment"># 梯度值可能为负数,所以求绝对值</span></span><br><span class="line">    y = np.uint8(np.absolute(y))  <span class="comment"># 梯度值可能为负数,所以求绝对值</span></span><br><span class="line">    <span class="comment"># 梯度值有正负之分，如果直接将其保存为图片，那么 OpenCV</span></span><br><span class="line">    <span class="comment"># 会将小于 0 的值设置为 0导致丢失值为负数的梯度</span></span><br><span class="line">    cv2.imshow(<span class="string">&quot;horizon&quot;</span>, x)</span><br><span class="line">    cv2.imshow(<span class="string">&quot;vertical&quot;</span>, y)</span><br><span class="line">    cv2.imshow(<span class="string">&quot;edge&quot;</span>, cv2.bitwise_or(x,y))</span><br><span class="line">    cv2.waitKey(<span class="number">0</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="Laplacian算子"><a href="#Laplacian算子" class="headerlink" title="Laplacian算子"></a>Laplacian算子</h3><p>Laplacian 算子只产生一个结果即与水平和垂直方向无关。因为这个算子对噪声比较敏感，所以当图片中存在噪声时最好先对图片进行降噪处理。我们使用 <code>cv2.Laplacian</code> 函数对图片进行边缘检测.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">lap</span>():</span></span><br><span class="line">    edge = cv2.Laplacian(image,cv2.CV_64F)</span><br><span class="line">    cv2.imshow(<span class="string">&#x27;edge&#x27;</span>,edge)</span><br><span class="line">    cv2.waitKey(<span class="number">0</span>)</span><br></pre></td></tr></table></figure><h3 id="Canny算子"><a href="#Canny算子" class="headerlink" title="Canny算子"></a>Canny算子</h3><p>Canny 边缘检测是一种比较流行的算法，其在进行边缘检测过程中包含多个步骤：对图片进行降噪处理、计算水平和垂直方向的梯度、剔除干扰的边缘、使用双阈值确定哪些像素在边缘上</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">canny</span>():</span></span><br><span class="line">    edge = cv2.Canny(image,<span class="number">20</span>,<span class="number">140</span>)</span><br><span class="line">    cv2.imshow(<span class="string">&#x27;edge&#x27;</span>,edge)</span><br><span class="line">    cv2.waitKey(<span class="number">0</span>)</span><br></pre></td></tr></table></figure><p>二个参数 <code>20</code> 和第三个参数 <code>140</code> 是要设置的阈值。小于 <code>20</code> 的梯度值将被划分为非边缘，大于 <code>140</code> 的梯度值将被划分为边缘；介于 <code>20</code> 和 <code>140</code> 中间的值，如果该值与大于 <code>140</code> 的值相邻接，那么判定其为边缘。</p><h2 id="直方图"><a href="#直方图" class="headerlink" title="直方图"></a>直方图</h2><p>图像的直方图是一种通过简单的统计分析手段对像素值的分布情况进行可视化的方法。通过绘制图像直方图我们可以直观的了解图像的一些特征</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> cv2 <span class="keyword">as</span> cv</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line">image = cv.imread(<span class="string">&quot;1.jpg&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(image)</span><br><span class="line">image = cv.cvtColor(image,cv.COLOR_BGR2GRAY)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;灰度图&#x27;</span>,image)</span><br><span class="line"><span class="comment">#  照片 通道 掩码 256份 像素范围0-255</span></span><br><span class="line"><span class="comment"># fig = cv.calcHist([image],[0],None,[256],[0,256])</span></span><br><span class="line">mask = np.zeros(image.shape[:<span class="number">2</span>],dtype=<span class="string">&quot;uint8&quot;</span>)</span><br><span class="line">mask = cv.circle(mask,(<span class="number">150</span>,<span class="number">150</span>),<span class="number">100</span>,<span class="number">255</span>,-<span class="number">1</span>)</span><br><span class="line"><span class="comment"># cv.imshow(&#x27;black&#x27;,mask)</span></span><br><span class="line">mask_area = cv.bitwise_and(image,image,mask=mask)</span><br><span class="line">fig = cv.calcHist([image],[<span class="number">0</span>],<span class="literal">None</span>,[<span class="number">256</span>],[<span class="number">0</span>,<span class="number">256</span>])</span><br><span class="line">plt.figure()</span><br><span class="line">plt.plot(fig)</span><br><span class="line"><span class="comment"># plt.show()</span></span><br><span class="line"><span class="comment"># plt.savefig(&quot;histogram_mask.png&quot;)</span></span><br><span class="line">plt.savefig(<span class="string">&quot;histogram.png&quot;</span>)</span><br></pre></td></tr></table></figure><p>这是灰度图的直方图.</p><p>也可以对三通道彩图处理</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">image = cv.imread(<span class="string">&quot;1.jpg&quot;</span>)</span><br><span class="line">channel = [<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;g&#x27;</span>,<span class="string">&#x27;r&#x27;</span>]</span><br><span class="line"><span class="comment"># plt.figure()</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">    fig = cv2.calcHist([image],[i],<span class="literal">None</span>,[<span class="number">256</span>],[<span class="number">0</span>,<span class="number">256</span>])</span><br><span class="line">    plt.plot(fig,color=channel[i])</span><br><span class="line">    plt.xlim([<span class="number">0</span>,<span class="number">256</span>])</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><h3 id="二维直方图"><a href="#二维直方图" class="headerlink" title="二维直方图"></a>二维直方图</h3><p>即同时考虑多个通道的直方图.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">fig = cv.calcHist([image],[<span class="number">0</span>,<span class="number">1</span>],<span class="literal">None</span>,[<span class="number">16</span>,<span class="number">16</span>],[<span class="number">0</span>,<span class="number">256</span>,<span class="number">0</span>,<span class="number">256</span>])</span><br><span class="line"><span class="comment"># plt.imshow(fig)</span></span><br><span class="line">plt.colorbar(plt.imshow(fig))</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><h3 id="均衡化"><a href="#均衡化" class="headerlink" title="均衡化"></a>均衡化</h3><p>拍摄的照片会出现曝光过度或者曝光不足导致图片的内容缺乏辨识度，这种情况我们可以通过均衡化的方法来缓解这种问题</p><p>首先将三通道分离为三个单通道</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">splits = cv2.split(image)</span><br><span class="line">plt.figure()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">    splits[i] = cv2.equalizeHist(splits[i])</span><br><span class="line">    fig = cv2.calcHist([splits[i]], [<span class="number">0</span>], <span class="literal">None</span>, [<span class="number">256</span>], [<span class="number">0</span>,<span class="number">256</span>])</span><br><span class="line">    plt.plot(fig, color = channel[i])</span><br><span class="line">    plt.xlim([<span class="number">0</span>,<span class="number">256</span>])</span><br><span class="line">equalized = cv2.merge(splits)</span><br><span class="line">cv2.imwrite(<span class="string">&quot;equalized.png&quot;</span>, equalized)</span><br></pre></td></tr></table></figure><h2 id="抠图"><a href="#抠图" class="headerlink" title="抠图"></a>抠图</h2><h3 id="轮廓提取和分割"><a href="#轮廓提取和分割" class="headerlink" title="轮廓提取和分割"></a>轮廓提取和分割</h3><p>利用这按位运算和边缘检测方法实现从图片中抠取特定区域，然后将其融合进一张新的图片中去。要想从一张图片中抠取特定的区域我们需要用到轮廓提取的方法，轮廓是描述物体外形的一段闭合的曲线，是物体的一个重要特征，轮廓特征在图像处理中广泛应用，在图像分割中我们利用轮廓特征将物体从背景中分割开。</p><ol><li><p>首先需要边缘检测,利用之前的算子得到边缘.</p></li><li><p>使用cv.findContour根据边缘得到轮廓.</p><p><code>cv2.findContours</code> 有两个返回值 <code>contours</code> 和 <code>h</code>。<code>contours</code> 是一个列表，其中每一个元素对应检测到的轮廓，另一个 <code>h</code> 表示检测到的轮廓所对应的属性.</p><p>第一个参数 <code>edge</code> 是 <code>cv2.Canny</code> 函数输出的边缘图，这个参数必须是二值图且函数会修改输入的图片。第二个参数 <code>cv2.RETR_EXTERNAL</code> 是检索轮廓的方式，表示只检测最外层的轮廓；可以尝试使用 <code>cv2.RETR_LIST</code>，<code>cv2.RETR_CCOMP</code> 或 <code>cv2.RETR_TREE</code> 参数。第三个参数 <code>cv2.CHAIN_APPROX_SIMPLE</code> 表示逼近轮廓的方法，或者可以称为存储轮廓的方法，这个方法将会对轮廓上的所有坐标点进行压缩，只保留水平、垂直、对角线方向上的端点坐标；可以尝试 <code>cv2.CHAIN_APPROX_NONE</code>，<code>cv2.CHAIN_APPROX_TC89_L1</code> 和 <code>cv2.CHAIN_APPROX_TC89_KCOS</code> 方法。</p></li><li><p>drawCountours绘制轮廓.根据findContours得到的轮廓,规定颜色和粗细.</p></li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">image = cv.imread(<span class="string">&#x27;1.jpg&#x27;</span>)</span><br><span class="line">edge = cv.Canny(cv.cvtColor(image, cv.COLOR_BGR2GRAY), <span class="number">60</span>, <span class="number">150</span>)</span><br><span class="line">cv.imshow(<span class="string">&#x27;edge.img&#x27;</span>,edge)</span><br><span class="line"><span class="comment"># cv.imshow(&#x27;edge.jpg&#x27;, edge)</span></span><br><span class="line"><span class="comment"># cv.waitKey(0)</span></span><br><span class="line"><span class="comment"># 第一个参数 edge 是 cv2.Canny 函数输出的边缘图，这个参数必须是二值图且</span></span><br><span class="line"><span class="comment"># 函数会修改输入的图片。第二个参数 cv2.RETR_EXTERNAL 是检索轮廓的方式，</span></span><br><span class="line"><span class="comment"># 表示只检测最外层的轮廓；可以尝试使用 cv2.RETR_LIST，cv2.RETR_CCOMP 或</span></span><br><span class="line"><span class="comment"># cv2.RETR_TREE 参数。第三个参数 cv2.CHAIN_APPROX_SIMPLE 表示逼近轮廓的方</span></span><br><span class="line"><span class="comment"># 法，或者可以称为存储轮廓的方法，这个方法将会对轮廓上的所有坐标点进行压缩，只保留</span></span><br><span class="line"><span class="comment"># 水平、垂直、对角线方向上的端点坐标；可以尝试 cv2.CHAIN_APPROX_NONE，</span></span><br><span class="line"><span class="comment"># cv2.CHAIN_APPROX_TC89_L1 和 cv2.CHAIN_APPROX_TC89_KCOS 方法。</span></span><br><span class="line">countours,h = cv.findContours(edge,cv.RETR_EXTERNAL,cv.CHAIN_APPROX_SIMPLE)</span><br><span class="line"><span class="comment"># cv2.findContours 有两个返回值 contours 和 h。</span></span><br><span class="line"><span class="comment"># contours 是一个列表，其中每一个元素对应检测到的轮廓，</span></span><br><span class="line"><span class="comment"># 另一个 h 表示检测到的轮廓所对应的属性</span></span><br><span class="line">drawc = image.copy()</span><br><span class="line">cv.drawContours(drawc,countours,-<span class="number">1</span>,(<span class="number">255</span>,<span class="number">0</span>,<span class="number">0</span>),<span class="number">2</span>)</span><br></pre></td></tr></table></figure><h3 id="分割物体"><a href="#分割物体" class="headerlink" title="分割物体"></a>分割物体</h3><p>上一步得到了轮廓.现在直接根据轮廓绘制即可.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mask = np.zeros(image.shape,dtype=<span class="string">&quot;uint8&quot;</span>)</span><br><span class="line">mask = cv2.drawContours(mask, contours, <span class="number">1</span>, (<span class="number">255</span>,<span class="number">255</span>,<span class="number">255</span>), -<span class="number">1</span>)<span class="comment">#这里的1表示第二个物体的轮廓</span></span><br><span class="line">cv2.imwrite(<span class="string">&quot;mask.jpg&quot;</span>, mask)</span><br></pre></td></tr></table></figure><p>这样可以根据轮廓画出白色图形.</p><p><code>cv2.drawContours</code> 的第三个参数 <code>1</code> 表示绘制检测到的第二个物体的轮廓，第四个参数 <code>(255, 255, 255)</code> 表示轮廓的颜色为白色，第五个参数 <code>-1</code> 表示将整个轮廓内的区域填充为白色。然后保存图片</p><p>然后将这个图形与原图直接相与.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">divide = cv2.bitwise_and(mask, image1)</span><br><span class="line">cv2.imwrite(<span class="string">&quot;divide.jpg&quot;</span>, divide)</span><br></pre></td></tr></table></figure><h3 id="剪裁和图片合并"><a href="#剪裁和图片合并" class="headerlink" title="剪裁和图片合并"></a>剪裁和图片合并</h3><p>要从 <code>divide</code> 中裁剪出辣椒。我们使用 <code>cv2.boundingRect</code> 函数获得这个辣椒最小的外接矩形的坐标。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(x, y, w, h) = cv2.boundingRect(contours[<span class="number">1</span>])</span><br></pre></td></tr></table></figure><p>得到截取图形的矩形尺寸</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cut_pepper = divide[y:y + h, x:x + w]</span><br><span class="line">cv2.imwrite(<span class="string">&quot;cutpepper.jpg&quot;</span>, cut_pepper)</span><br><span class="line">cut_not = cv2.bitwise_not(cut_mask)</span><br><span class="line">cv2.imwrite(<span class="string">&quot;cut_not.jpg&quot;</span>, cut_not)</span><br></pre></td></tr></table></figure><p>将截取的区域颜色变换,方便后续与或.</p><p>注意图像运算要求图像大小相同.</p><p>将要合并的图像截取相同大小.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cut_image2 = image2[<span class="number">50</span>:<span class="number">50</span> + h, <span class="number">50</span>:<span class="number">50</span> + w]</span><br><span class="line">cv2.imwrite(<span class="string">&quot;cut_image2.jpg&quot;</span>, cut_image2)</span><br></pre></td></tr></table></figure><p>将两个图像相与</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cut_image2 = cv2.bitwise_and(cut_not, cut_image2)</span><br><span class="line">cv2.imwrite(<span class="string">&quot;cut_image2.jpg&quot;</span>, cut_image2)</span><br></pre></td></tr></table></figure><p>再将分割的图像相或</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cut_image2 = cv2.bitwise_or(cut_pepper, cut_image2)</span><br><span class="line">cv2.imwrite(<span class="string">&quot;cut_image2.jpg&quot;</span>, cut_image2)</span><br></pre></td></tr></table></figure><p>最后直接修改原图相应位置的像素</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">image2[<span class="number">50</span>:<span class="number">50</span> + h, <span class="number">50</span>:<span class="number">50</span> + w] = cut_image2[:,:]</span><br><span class="line">cv2.imwrite(<span class="string">&quot;merge.jpg&quot;</span>, image2)</span><br></pre></td></tr></table></figure><h2 id="官方文档"><a href="#官方文档" class="headerlink" title="官方文档"></a>官方文档</h2><p><a href="http://www.woshicver.com/">OpenCV中文官方文档 (woshicver.com)</a></p><p><a href="https://matplotlib.org/">Matplotlib — Visualization with Python</a></p><p><a href="https://numpy.org/">NumPy</a></p><p>国内也有很多翻译的文档,都挺不错的,基本用法是都覆盖的.</p><p>或者直接看菜鸟驿站.</p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      
        <tags>
            
            <tag> python </tag>
            
            <tag> opencv </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>gdb&amp;&amp;gcc学习</title>
      <link href="2022/01/08/gdb-gcc%E5%AD%A6%E4%B9%A0/"/>
      <url>2022/01/08/gdb-gcc%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>学一下gcc和gdb,巩固基础.<br><span id="more"></span><br>gcc与gdb都是GNU软件,是GNU组织,这个组织是由一个黑客大佬公开发起创建对抗商业软件,并开发操作系统的.</p><p>GCC是C语言编译器,现在在windows上有MinGW.</p><h2 id="开始"><a href="#开始" class="headerlink" title="开始"></a>开始</h2><h3 id="GCC"><a href="#GCC" class="headerlink" title="GCC"></a>GCC</h3><p>在使用 GCC 编译程序时，编译过程可以被细分为四个阶段：</p><ul><li>预处理（Pre-Processing）</li><li>编译（Compiling）</li><li>汇编（Assembing）</li><li>链接（Linking）</li></ul><p>在windows上装的gcc.</p><p><img data-src="http://cdn.sekyoro.top/imgs/065519.png" alt="gcc版本"></p><p>可以看到是mingw</p><p>Linux上一般是</p><p><img data-src="http://cdn.sekyoro.top/imgs/093506.png" alt="Linux gcc"></p><h3 id="命令"><a href="#命令" class="headerlink" title="命令"></a>命令</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc xx.c </span><br></pre></td></tr></table></figure><p>将c源文件经过处理得到可执行文件a.out,名字是默认的</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc xx.c -o demo.out</span><br></pre></td></tr></table></figure><p>-o指定输出文件名</p><p>这样就能直接得到可执行文件</p><p>下面简单介绍四个过程的命令</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">gcc -E  //预处理</span><br><span class="line">gcc -S  //编译</span><br><span class="line">gcc -c   //汇编</span><br><span class="line">gcc -o   //链接</span><br></pre></td></tr></table></figure><p>另外还有一些比较有用的命令</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">gcc -o xx xx.o xx.o .. -static  <span class="regexp">//</span>静态链接</span><br><span class="line">gcc -Wall ... <span class="regexp">//</span>生成所有警告信息</span><br><span class="line">gcc -O0 </span><br><span class="line">gcc -O1</span><br><span class="line">gcc -O2 ...<span class="regexp">//</span>优化代码</span><br><span class="line">gcc -g <span class="regexp">//</span>生成调试信息,方便debug</span><br></pre></td></tr></table></figure><h3 id="警告与优化"><a href="#警告与优化" class="headerlink" title="警告与优化"></a>警告与优化</h3><p>除了上述四个过程,gcc还有代码警告和优化.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-pedantic</span><br><span class="line">-Wall</span><br></pre></td></tr></table></figure><p>主要这两个命令,其实一般用-Wall就行了,这样能产生更多的警告信息.</p><p>pedantic是尽量让代码符合ANSI/ISO标准.</p><p>优化命令</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">-O0</span><br><span class="line">-O1</span><br><span class="line">-O2</span><br><span class="line">-O3</span><br></pre></td></tr></table></figure><p>值越大,优化等级越高.</p><p><img data-src="http://cdn.sekyoro.top/imgs/065520.png" alt="gcc 优化"></p><p>经过测试发现貌似文件大小一样.</p><p><img data-src="http://cdn.sekyoro.top/imgs/065523.png" alt="优化文件大小"></p><p>但是运行时间不一样,可以用time来计算</p><ul><li>程序开发的时候：优化等级越高，消耗在编译上的时间就越长，因此在开发的时候最好不要使用优化选项，只有到软件发行或开发结束的时候，才考虑对最终生成的代码进行优化。</li><li>资源受限的时候：一些优化选项会增加可执行代码的体积，如果程序在运行时能够申请到的内存资源非常紧张(如一些实时嵌入式设备)，那就不要对代码进行优化，因为由这带来的负面影响可能会产生非常严重的后果。</li><li>跟踪调试的时候：在对代码进行优化的时候，某些代码可能会被删除或改写，或者为了取得更佳的性能而进行重组，从而使跟踪和调试变得异常困难</li></ul><div class="table-container"><table><thead><tr><th>选项名</th><th>作用</th></tr></thead><tbody><tr><td>-c</td><td>通知 GCC 取消连接步骤，即编译源码并在最后生成目标文件。</td></tr><tr><td>-Dmacro</td><td>定义指定的宏，使它能够通过源码中的 <code>#ifdef</code> 进行检验。</td></tr><tr><td>-E</td><td>不经过编译预处理程序的输出而输送至标准输出。</td></tr><tr><td>-g3</td><td>获得有关调试程序的详细信息，它不能与 <code>-o</code> 选项联合使用。</td></tr><tr><td>-Idirectory</td><td>在包含文件搜索路径的起点处添加指定目录。</td></tr><tr><td>-llibrary</td><td>提示连接程序在创建最终可执行文件时包含指定的库。</td></tr><tr><td>-O -O2 -O3</td><td>将优化状态打开，该选项不能与 <code>-g</code> 选项联合使用。当出现多个优化时，以最后一个为准。</td></tr><tr><td>-O0</td><td>关闭所有优化选项。</td></tr><tr><td>-S</td><td>要求编译程序生成来自源代码的汇编程序输出。</td></tr><tr><td>-v</td><td>启动所有警报。</td></tr><tr><td>.h</td><td>预处理文件(标头文件)。</td></tr><tr><td>-Wall</td><td>在发生警报时取消编译操作，即将警报看作是错误。</td></tr><tr><td>-w</td><td>禁止所有的报警。</td></tr><tr><td>-share</td><td>此选项将尽量使用动态库，所以生成文件比较小，但是需要系统由动态库。</td></tr><tr><td>-shared</td><td>产生共享对象文件。</td></tr><tr><td>-g</td><td>在编译结果中加入调试信息。</td></tr><tr><td>-ggdb</td><td>加入 GDB 调试器能识别的格式。</td></tr></tbody></table></div><p>这里就不详细说了,后面会对编译进一步说明.</p><p>后面介绍gdb</p><h2 id="GDB"><a href="#GDB" class="headerlink" title="GDB"></a>GDB</h2><p>一般来说，GDB 主要帮忙你完成下面几个方面的功能：</p><ul><li>设置断点（断点可以是条件表达式），使程序在指定的代码行上暂停执行，便于观察。</li><li>单步执行程序，便于调试。</li><li>查看程序中变量值得变化。</li><li>动态改变程序的执行环境。</li><li>分析崩溃程序产生的 core 文件</li></ul><p><img data-src="http://cdn.sekyoro.top/imgs/093509.png" alt="进入gdb"></p><p>为了使 GDB 正常工作，必须使程序在编译的时候包含调试信息，这需要在 GCC 编译时加上 <code>-g</code> 或者 <code>-ggdb</code> 选项。调试信息包好了程序中的每个变量的类型和在可执行文件中的地址映射以及源代码的行号。而 GDB 正是利用这些信息是源代码和机器码相关联。</p><div class="table-container"><table><thead><tr><th>命令</th><th>含义描述</th></tr></thead><tbody><tr><td>file</td><td>装入想要的调试的可执行文件。</td></tr><tr><td>run</td><td>执行当前被调试的程序。</td></tr><tr><td>kill</td><td>终止正在调试的程序。</td></tr><tr><td>step</td><td>执行一行源代码而且进入函数内部。</td></tr><tr><td>next</td><td>执行一行源代码但不进入函数内部。</td></tr><tr><td>break</td><td>在代码里设置断点，这将使程序执行到这里时被挂起。</td></tr><tr><td>print</td><td>打印表达式或变量的值，或打印内存中某个变量开始的一段连续区域的值，还以用来对变量进行赋值。</td></tr><tr><td>display</td><td>设置自动显示的表达式或变量，当程序停住或在单步追踪时，这些变量会自动显示其当前值。</td></tr><tr><td>list</td><td>列出产生执行文件的源代码的一部分。</td></tr><tr><td>quit</td><td>退出 GDB。</td></tr><tr><td>watch</td><td>使你能监视一个变量的值而不管它何时被改变。</td></tr><tr><td>backtrace（或 bt）</td><td>回溯追踪。</td></tr><tr><td>frame n</td><td>定位到发生错误的代码段，<code>n</code> 为 <code>backtrace</code> 命令的输出结果中的行号。</td></tr><tr><td>examine</td><td>查看内存地址中的值。</td></tr><tr><td>jump</td><td>是程序跳转执行。</td></tr><tr><td>signal</td><td>产生信号量。</td></tr><tr><td>return</td><td>强制函数返回。</td></tr><tr><td>call</td><td>强制调用函数。</td></tr><tr><td>make</td><td>使用户不退出 GDB 就可以重新产生可执行文件。</td></tr><tr><td>shell</td><td>使用户不离开 GDB 就执行 Linux 的 shell 命令。</td></tr></tbody></table></div><h3 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h3><p>list查看源代码</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">list <span class="number">20</span>  <span class="regexp">//</span>查看第<span class="number">20</span>行代码前后<span class="number">10</span>行代码</span><br><span class="line">list main <span class="regexp">//</span>查看main函数左右<span class="number">10</span>行代码</span><br><span class="line">list   <span class="regexp">//</span>往后查看<span class="number">10</span>行代码</span><br><span class="line">list - <span class="regexp">//</span>往前查看<span class="number">10</span>行代码</span><br></pre></td></tr></table></figure><p>run运行,遇到断点停</p><p>file 将一个可执行文件装入</p><p>break 简写b 打断点 可以在行号和函数名处打断点,当然,这个命令功能很强.还可以在内存地址打断点.</p><p>info break简写i b,查看断点信息</p><p>delete num 删除断点  disable num 禁用断点</p><p>info 命令可以在调试时用来查看寄存器、断点、观察点和信号等信息</p><h4 id="gdb调试"><a href="#gdb调试" class="headerlink" title="gdb调试"></a>gdb调试</h4><p>当代码出现错误时,首先通过backtrace(bt)进行错误定位可以得到出错的行</p><p>然后使用frame命令定位到出错代码</p><p>程序被停住后，可以使用 <code>continue</code> 命令（缩写 <code>c</code>）恢复程序的运行直到程序结束，或到达下一个断点</p><p>使用watch命令查看变量值的变化.</p><ol><li>使用 <code>break</code> 命令在要观察的变量所在处设置断点。</li><li>使用 <code>run</code> 命令执行，直到断点。</li><li>使用 <code>watch</code> 命令设置观察点。</li><li>使用 <code>continue</code> 命令观察设置的观察点是否有变化</li></ol><p>print命令输出变量值,</p><ul><li><code>x</code> ：按十六进制格式显示变量。</li><li><code>d</code> ：按十进制格式显示变量。</li><li><code>u</code> ：按十六进制格式显示无符号整型。</li><li><code>o</code> ：按八进制格式显示变量。</li><li><code>t</code> ：按二进制格式显示变量。</li><li><code>a</code> ：按十六进制格式显示变量。</li><li><code>c</code> ：按字符格式显示变量。</li><li><code>f</code> ：按浮点数格式显示变量</li></ul><ul><li><code>print a[4]</code>：打印 <code>a[4]</code> 的值。</li><li><code>print a+4</code>：打印 <code>a[4]</code> 的地址。</li><li><code>print &amp;a[4]</code>：打印 <code>a[4]</code> 的地址。</li><li><code>x a[4]</code>：访问 <code>a[4]</code> 值所代表的内存,即打印 <code>a[4]</code> 值代表内存里面的值。</li><li><code>x a+4</code>：访问指针 <code>a+4</code> 代表内存里面的值，即 5。</li><li><code>x &amp;a[4]</code>：访问指针 <code>a+4</code> 代表内存里面的值，即 5。</li><li><code>x &amp;(a+4)</code>：访问 <code>a+4</code> 指针所在的地址，不存在。</li></ul><p><code>print</code> 就是打印给定变量（参数是什么，就打印什么），<code>x</code> 打印给定变量代表的内存地址里的值(即 <code>x</code> 后面的参数 是地址值，打印的是地址所在内存单元的值</p><p>help命令帮助</p><h3 id="资料"><a href="#资料" class="headerlink" title="资料"></a>资料</h3><p><a href="https://www.runoob.com/w3cnote/gcc-parameter-detail.html">GCC 参数详解 | 菜鸟教程 (runoob.com)</a></p><p><a href="https://stackoverflow.com/questions/20578196/gdb-info-line-but-contains-no-code">c - gdb info line : … but contains no code - Stack Overflow</a></p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> gcc </category>
          
          <category> gdb </category>
          
      </categories>
      
      
        <tags>
            
            <tag> gcc </tag>
            
            <tag> gdb </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring学习</title>
      <link href="2022/01/05/Spring%E5%AD%A6%E4%B9%A0/"/>
      <url>2022/01/05/Spring%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>你要问我Spring是什么,我不知道<br><span id="more"></span></p><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><blockquote><p>Spring 是一个开源的轻量级 Java SE（Java 标准版本）/Java EE（Java 企业版本）开发应用框架，其目的是用于简化企业级应用程序开发。在传统应用程序开发中，一个完整的应用是由一组相互协作的对象组成的。所以开发一个应用除了要开发业务逻辑之外，最多的是关注使这些对象协作来完成所需功能的同时，实现低耦合、高内聚。所以，业务逻辑开发是不可避免的。如果有个框架可以帮我们来创建对象及管理这些对象之间的依赖关系，能通过配置方式来创建对象，管理对象之间依赖关系，我们不需要通过工厂和生成器来创建及管理对象之间的依赖关系，这样我们必然会减少许多工作量，加快开发。Spring 框架问世之初主要就是来完成这个功能</p></blockquote><p>重点AOP IOC</p><p><img data-src="http://cdn.sekyoro.top/imgs/092901.png" alt="Spring架构图" style="zoom: 67%;" /></p><p>任何实际的应用程序都是由很多组件组成的，每个组件负责整个应用功能的一部分，这些组件需要与其他的应用元素进行协调以完成自己的任务。当应用程序运行时，需要以某种方式创建并引入这些组件。</p><h3 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h3><p>Spring 的核心是提供了一个容器（container），通常称为 Spring 应用上下文（Spring application context），它们会创建和管理应用组件。这些组件也可以称为 bean，会在 Spring 应用上下文中装配在一起，从而形成一个完整的应用程序。这就像砖块、砂浆、木材、管道和电线组合在一起，形成一栋房子似的。</p><p>将 bean 装配在一起的行为是通过一种基于依赖注入（dependency injection，DI）的模式实现的。此时，组件不会再去创建它所依赖的组件并管理它们的生命周期，使用依赖注入的应用依赖于单独的实体（容器）来创建和维护所有的组件，并将其注入到需要它们的 bean 中。通常，这是通过构造器参数和属性访问方法来实现的。</p><p>在历史上，指导 Spring 应用上下文将 bean 装配在一起的方式是使用一个或多个 XML 文件</p><p>XML版本</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;inventoryService&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">class</span>=<span class="string">&quot;com.example.InventoryService&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;productService&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">class</span>=<span class="string">&quot;com.example.ProductService&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">ref</span>=<span class="string">&quot;inventoryService&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><p>Java版本</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ServiceConfiguration</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Bean</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> InventoryService <span class="title">inventoryService</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> InventoryService();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Bean</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> ProductService <span class="title">productService</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ProductService(inventoryService());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>@Configuration</code> 注解会告知 Spring 这是一个配置类，会为 Spring 应用上下文提供 bean。这个配置类的方法使用 <code>@Bean</code> 注解进行了标注，表明这些方法所返回的对象会以 bean 的形式添加到 Spring 的应用上下文中（默认情况下，这些 bean 所对应的 bean ID 与定义它们的方法名称是相同的）。</p><p>相对于基于 XML 的配置方式，基于 Java 的配置会带来多项额外的收益，包括更强的类型安全性以及更好的重构能力。即便如此，不管是使用 Java 还是使用 XML 的显式配置，只有当 Spring 不能进行自动配置的时候才是必要的</p><p>在 Spring 技术中，自动配置起源于所谓的自动装配（autowiring）和组件扫描（component scanning）。借助组件扫描技术，Spring 能够自动发现应用类路径下的组件，并将它们创建成 Spring 应用上下文中的 bean。借助自动装配技术，Spring 能够自动为组件注入它们所依赖的其他 bean.</p><h3 id="Spring-MVC"><a href="#Spring-MVC" class="headerlink" title="Spring MVC"></a>Spring MVC</h3><p><img data-src="https://www.tutorialspoint.com/spring/images/spring_dispatcherservlet.png" alt="diagram"></p><p>Spring MVC 相关接口解释：</p><p>（1）DispatcherServlet</p><p>前端控制器，所有的请求都有经过它来统一分发，请求会被分发给对应的 Handler。</p><p>（2）HandlerMapping（处理器映射器）</p><p>解析请求链接，然后根据请求链接找到执行这个请求的类（HandlerMapping 所说的 handler）。</p><p>（3）HandlerAdapter（处理器适配器）</p><p>调用具体的方法对用户发来的请求来进行处理。</p><p>（4）Controller</p><p>Controller 将处理用户请求，Controller 处理完用户请求，则返回 ModelAndView 对象给 DispatcherServlet 前端控制器。</p><p>从宏观角度考虑，DispatcherServlet 是整个 Web 应用的控制器；从微观考虑，Controller 是单个 Http 请求处理过程中的控制器。</p><p>（5）ViewResolver（视图解析器）</p><p>解析 ModelMdoelAndView 中的逻辑视图名变为一个真正的 View 对象，并将 MdoelAndView 中的 Model 取出。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mvn archetype:generate \</span><br><span class="line">  -DgroupId=com.example \</span><br><span class="line">  -DartifactId=springboot \</span><br><span class="line">  -DarchetypeArtifactId=maven-archetype-quickstart \</span><br><span class="line">  -DinteractiveMode=<span class="literal">false</span></span><br></pre></td></tr></table></figure><ul><li>Group Id：项目的组织机构，也是包的目录结构，一般都是域名的倒序，比如 <code>com.sekyoro</code>。</li><li>Atifact Id：项目实际的名字，比如 <code>SpringMVCTest</code>。</li><li>archetype Artifact Id：使用的 maven 骨架名称。</li></ul><h3 id="Spring-Boot的引入"><a href="#Spring-Boot的引入" class="headerlink" title="Spring Boot的引入"></a>Spring Boot的引入</h3><p>随着 Spring Boot 的引入，自动配置的能力已经远远超出了组件扫描和自动装配。<strong>Spring Boot 是 Spring 框架的扩展，提供了很多增强生产效率的方法</strong>。最为大家<strong>所熟知的增强方法就是自动配置（autoconfiguration</strong>），Spring Boot 能够基于类路径中的条目、环境变量和其他因素合理猜测需要配置的组件并将它们装配在一起。</p><p>Spring Boot 极大地改善了 Spring 的开发，因此很难想象在没有它的情况下如何开发 Spring 应用</p><p>Spring XML 配置是一种过时的方式，主要关注 Spring 基于 Java 的配置。</p><h2 id="实战"><a href="#实战" class="headerlink" title="实战"></a>实战</h2><p>使用 Spring Initializr 初始化应用</p><p>Spring Initializr 是一个基于浏览器的 Web 应用，同时也是一个 REST API，能够生成一个 Spring 项目结构的骨架，我们还可以使用各种想要的功能来填充它</p><p>使用 Spring Initializr 的几种方式如下：</p><ul><li>通过地址为 <a href="https://start.spring.io/">https://start.spring.io/</a> 的 Web 应用；</li><li>在命令行中使用 <code>curl</code> 命令；</li><li>在命令行中使用 Spring Boot 命令行接口；</li><li>在 Spring Tool Suite 中创建新项目；</li><li>在 IntelliJ IDEA 中创建新项目；</li><li>在 NetBeans 中创建新项目。</li></ul><p><img data-src="http://cdn.sekyoro.top/imgs/27/0120230127132614.png" alt="image-20230127132557990" style="zoom:50%;" /></p><p>通过curl命令创建项目  <strong><a href="https://start.spring.io/starter.tgz">https://start.spring.io/starter.tgz</a></strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">curl https://start.spring.io/starter.tgz \</span><br><span class="line">-d groupId=sia \</span><br><span class="line">-d artifactId=taco-cloud \</span><br><span class="line">-d packaging=jar \</span><br><span class="line">-d name=taco-cloud \</span><br><span class="line">-d packageName=tacos \</span><br><span class="line">-d dependencies=web,devtools,thymeleaf \</span><br><span class="line">-d <span class="built_in">type</span>=maven-project \</span><br><span class="line">-d baseDir=taco-cloud \</span><br><span class="line">-d bootVersion=2.4.0 \</span><br><span class="line">-d javaVersion=1.8 \</span><br><span class="line">| tar -xzvf -</span><br></pre></td></tr></table></figure><p><code>-d</code> 指定额外的参数。</p><ul><li><code>groupId</code>：指定 <code>groupId</code>。</li><li><code>artifactId</code>：指定 <code>artifactId</code>。</li><li><code>packaging</code>：指定打包方式。</li><li><code>name</code>：指定项目名，如果没有指定 <code>applicationName</code>，则将其作为 Application Name。</li><li><code>packageName</code>：指定项目的包名。</li><li><code>dependencies</code>：指定项目的依赖。</li><li><code>type</code>：指定项目的类型（使用哪种构建工具）。</li><li><code>baseDir</code>：指定项目的根目录名称。</li><li><code>bootVersion</code>：指定 SpringBoot 的版本</li></ul><p><img data-src="http://cdn.sekyoro.top/imgs/28/01image-20230128210555390.png" alt="image-20230128210555390"></p><ul><li><code>mvnw</code> 和 <code>mvnw.cmd</code>：这是 Maven 包装器（wrapper）脚本。借助这些脚本，即便你的机器上没有安装 Maven，也可以构建项目。</li><li><code>pom.xml</code>：这是 Maven 构建规范，随后我们将会深入介绍该文件。</li><li><code>TacoCloudApplication.java</code>：这是 Spring Boot 主类，它会启动该项目。随后，我们会详细介绍这个类。</li><li><code>application.properties</code>：这个文件起初是空的，但是它为我们提供了指定配置属性的地方。在本章中，我们会稍微修改一下这个文件</li><li><code>static</code>：在这个文件夹下，你可以存放任意为浏览器提供服务的静态内容（图片、样式表、JavaScript 等），该文件夹初始为空。</li><li><code>templates</code>：这个文件夹中存放用来渲染内容到浏览器的模板文件。这个文件夹初始是空的，不过我们很快就会往里面添加 Thymeleaf 模板。</li><li><code>TacoCloudApplicationTests.java</code>：这是一个简单的测试类，它能确保 Spring 应用上下文可以成功加载。在开发应用的过程中，我们会将更多的测试添加进来。</li></ul><h3 id="POM文件"><a href="#POM文件" class="headerlink" title="POM文件"></a>POM文件</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0</span></span></span><br><span class="line"><span class="string"><span class="tag">          http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>sia<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>taco-cloud<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>taco-cloud<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">description</span>&gt;</span>Taco Cloud Example<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.4.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">        UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">project.reporting.outputEncoding</span>&gt;</span></span><br><span class="line">        UTF-8<span class="tag">&lt;/<span class="name">project.reporting.outputEncoding</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-thymeleaf<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.seleniumhq.selenium<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>selenium-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">     <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.seleniumhq.selenium<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>htmlunit-driver<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.13<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><p>项目属性 </p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>sia<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>taco-cloud<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>taco-cloud<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">description</span>&gt;</span>Demo project for Spring Boot<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br></pre></td></tr></table></figure><p>modelVersion 描述这个POM文件是遵从哪个版本的项目描述符</p><p>modelVersion：指定了当前POM模型的版本，对于Maven2及Maven 3来说，它只能是4.0.0；</p><p><code>&lt;parent&gt;</code> 元素，更具体来说是它的 <code>&lt;version&gt;</code> 子元素。这表明我们的项目要以 <code>spring-boot-starter-parent</code> 作为其父 POM。除了其他的一些功能之外，这个父 POM 为 Spring 项目常用的一些库提供了依赖管理，现在你不需要指定它们的版本，因为这是通过父 POM 来管理的</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">   <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>2.4.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br></pre></td></tr></table></figure><p> <code>&lt;parent&gt;</code> 元素，更具体来说是它的 <code>&lt;version&gt;</code> 子元素。这表明我们的项目要以 <code>spring-boot-starter-parent</code> 作为其父 POM。除了其他的一些功能之外，这个父 POM 为 Spring 项目常用的一些库提供了依赖管理，现在你不需要指定它们的版本，因为这是通过父 POM 来管理的</p><p><code>2.0.4.RELEASE</code> 表明要使用 Spring Boot 2.0.4，所以会根据这个版本的 Spring Boot 定义来继承依赖管理</p><p><code>&lt;dependencies&gt;</code> 元素下声明了 4 个依赖。在某种程度上，你可能会对前两个更熟悉一些。它们直接对应我们使用 <code>curl</code> 创建新项目中所指定的 <code>Web</code> 和 <code>Thymeleaf</code> 依赖。第四个依赖 <code>test</code> 提供了很多有用的测试功能。我们没有必要专门指定它</p><p>4 个依赖的 Artifact ID 中有 3 个都有 <code>starter</code> 这个单词。Spring Boot starter 依赖的特别之处在于它们本身并不包含库代码，而是传递性地拉取其他的库。这种 starter 依赖主要有 3 个好处。</p><ul><li>构建文件会显著减小并且更易于管理，因为这样不必为每个所需的依赖库都声明依赖。</li><li>我们能够根据它们所提供的功能来思考依赖，而不是根据库的名称。如果是开发 Web 应用，那么你只需要添加 web starter 就可以了，而不必添加一堆单独的库再编写 Web 应用。</li><li>我们不必再担心库版本的问题。你可以直接相信给定版本的 Spring Boot，传递性引入的库的版本是兼容的。现在，你只需要关心使用的是哪个版本的 Spring Boot 就可以了。</li></ul><p>构建规范还包含一个 Spring Boot 插件。这个插件提供了一些重要的功能。</p><ul><li>它提供了一个 Maven goal，允许我们使用 Maven 来运行应用。在后面小节，我们将会尝试这个 goal。</li><li>它会确保依赖的所有库都会包含在可执行 JAR 文件中，并且能够保证它们在运行时类路径下是可用的。</li><li>它会在 JAR 中生成一个 manifest 文件，将引导类（在我们的场景中，也就是 TacoCloudApplication）声明为可执行 JAR 的主类。</li></ul><h3 id="主类"><a href="#主类" class="headerlink" title="主类"></a>主类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> tacos;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TacoCloudApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">SpringApplication.run(TacoCloudApplication.class, args);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>@SpringBootConfiguration</code>：将该类声明为配置类。尽管这个类目前还没有太多的配置，但是后续我们可以按需添加基于 Java 的 Spring 框架配置。这个注解实际上是 <code>@Configuration</code> 注解的特殊形式。</li><li><code>@EnableAutoConfiguration</code>：启用 Spring Boot 的自动配置。我们随后会介绍自动配置的更多功能。就现在来说，我们只需要知道这个注解会告诉 Spring Boot 自动配置它认为我们会用到的组件。</li><li><code>@ComponentScan</code>：启用组件扫描。这样我们能够通过像 <code>@Component</code>、<code>@Controller</code>、<code>@Service</code> 这样的注解声明其他类，Spring 会自动发现它们并将它们注册为 Spring 应用上下文中的组件</li></ul><p>它的 <code>main()</code> 方法。这是 JAR 文件执行的时候要运行的方法。在大多数情况下，这个方法都是样板代码，我们编写的每个 Spring Boot 应用都会有一个类似或完全相同的方法（类名不同则另当别论）。</p><p>这个 <code>main()</code> 方法会调用 SpringApplication 中静态的 <code>run()</code> 方法，后者会真正执行应用的引导过程，也就是创建 Spring 的应用上下文。在传递给 <code>run()</code> 的两个参数中，一个是配置类，另一个是命令行参数。尽管传递给 <code>run()</code> 的配置类不一定要和引导类相同，但这是最便利和最典型的做法。</p><p>你可能并不需要修改引导类中的任何内容。对于简单的应用程序来说，你可能会发现在引导类中配置一两个组件是非常方便的，但是对于大多数应用来说，最好还是要为没有实现自动配置的功能创建一个单独的配置类。在本课程的整个过程中，我们将会创建多个配置类，所以请继续关注后续的细</p><h3 id="测试类"><a href="#测试类" class="headerlink" title="测试类"></a>测试类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> tacos;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringRunner;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span>            <span class="comment">// &lt;--- 使用Spring的运行器</span></span><br><span class="line"><span class="meta">@SpringBootTest</span>                         <span class="comment">// &lt;--- Spring Boot测试</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TacoCloudApplicationTests</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Test</span>                                   <span class="comment">// &lt;--- 测试方法</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">contextLoads</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>这个类中只有一个空的测试方法。即便如此，这个测试类还是会执行必要的检查，确保 Spring 应用上下文能够成功加载。如果你所做的变更导致 Spring 应用上下文无法创建，那么这个测试将会失败，你就可以做出反应来解决相关的问题了</p><h3 id="处理Web请求"><a href="#处理Web请求" class="headerlink" title="处理Web请求"></a>处理Web请求</h3><p>Spring 自带了一个强大的 Web 框架，名为 Spring MVC。Spring MVC 的核心是控制器（controller）的理念。控制器是处理请求并以某种方式进行信息响应的类。在面向浏览器的应用中，控制器会填充可选的数据模型并将请求传递给一个视图，以便于生成返回给浏览器的 HTML</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> tacos;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span>                   <span class="comment">// &lt;--- 控制器</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HomeController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@GetMapping(&quot;/&quot;)</span>            <span class="comment">// &lt;--- 处理对根路径“/”的请求</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">home</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;home&quot;</span>;                 <span class="comment">// &lt;--- 返回视图名</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可以看到，这个类带有 <code>@Controller</code>。就其本身而言，<code>@Controller</code> 并没有做太多的事情。它的主要目的是让组件扫描将这个类识别为一个组件。因为 HomeController 带有 <code>@Controller</code>，所以 Spring 的组件扫描功能会自动发现它，并创建一个 HomeController 实例作为 Spring 应用上下文中的 bean</p><p>有一些其他的注解与 <code>@Controller</code> 有着类似的目的（包括 <code>@Component</code>、<code>@Service</code> 和 <code>@Repository</code>）。你可以为 HomeController 添加上述的任意其他注解，其作用是完全相同的。但是，在这里选择使用 <code>@Controller</code> 更能描述这个组件在应用中的角色</p><p>“home”这个值将会被解析为视图的逻辑名。视图如何实现取决于多个因素，但是因为 Thymeleaf 位于类路径中，所以我们可以使用 Thymeleaf 来定义模板.</p><p>在 <code>src/main/resources/templates</code> 目录下创建 <code>home.html</code> 文件</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.w3.org/1999/xhtml&quot;</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Taco Cloud<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Welcome to...<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">th:src</span>=<span class="string">&quot;@&#123;/images/TacoCloud.png&#125;&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/design&#125;&quot;</span> <span class="attr">id</span>=<span class="string">&quot;design&quot;</span>&gt;</span>Design a taco<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>唯一需要注意的一行代码是用于展现 Taco Cloud Logo 的 <code>&lt;img&gt;</code> 标签。它使用了 Thymeleaf 的 <code>th:src</code> 属性和 <code>@&#123;...&#125;</code> 表达式，以便于引用相对于上下文路径的图片。除此之外，它就是一个 Hello World 页面。</p><h3 id="编写测试"><a href="#编写测试" class="headerlink" title="编写测试"></a>编写测试</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">package tacos;</span><br><span class="line"></span><br><span class="line">import static org.hamcrest.Matchers.containsString;</span><br><span class="line">import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;</span><br><span class="line">import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.content;</span><br><span class="line">import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;</span><br><span class="line">import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.view;</span><br><span class="line"></span><br><span class="line">import org.junit.Test;</span><br><span class="line">import org.junit.runner.RunWith;</span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.boot.test.autoconfigure.web.servlet.WebMvcTest;</span><br><span class="line">import org.springframework.test.context.junit4.SpringRunner;</span><br><span class="line">import org.springframework.test.web.servlet.MockMvc;</span><br><span class="line"></span><br><span class="line">@RunWith(SpringRunner.class)</span><br><span class="line">@WebMvcTest(HomeController.class)         // &lt;--- 针对HomeController的Web测试</span><br><span class="line">public class HomeControllerTest &#123;</span><br><span class="line"></span><br><span class="line">  @Autowired</span><br><span class="line">  private MockMvc mockMvc;                 // &lt;--- 注入MockMvc</span><br><span class="line"></span><br><span class="line">  @Test</span><br><span class="line">  public void testHomePage() throws Exception &#123;</span><br><span class="line">    mockMvc.perform(get(&quot;/&quot;))                // &lt;--- 发起对“/”的GET</span><br><span class="line"></span><br><span class="line">      .andExpect(status().isOk())            // &lt;--- 期望得到HTTP 200</span><br><span class="line"></span><br><span class="line">      .andExpect(view().name(&quot;home&quot;))         // &lt;--- 期望得到home视图</span><br><span class="line"></span><br><span class="line">      .andExpect(content().string(             // &lt;--- 期望包含“Welcome to...”</span><br><span class="line">             containsString(&quot;Welcome to...&quot;)));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>运行</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 测试</span></span><br><span class="line">mvn <span class="built_in">test</span></span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn clean spring-boot:run</span><br></pre></td></tr></table></figure><h3 id="Spring-Boot-DevTools"><a href="#Spring-Boot-DevTools" class="headerlink" title="Spring Boot DevTools"></a>Spring Boot DevTools</h3><p>DevTools 为 Spring 开发人员提供了一些便利的开发期工具，其中包括：</p><ul><li>代码变更后应用会自动重启；</li><li>当面向浏览器的资源（如模板、JavaScript、样式表）等发生变化时，会自动刷新浏览器（实验楼 WebIDE 中需要手动刷新 Web 服务的页面）；</li><li>自动禁用模板缓存；</li><li>如果使用 H2 数据库的话，内置了 H2 控制台</li></ul><h3 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h3><p>在 <code>pom.xml</code> 文件中，我们声明了对 Web 和 Thymeleaf starter 的依赖。这两项依赖会传递引入大量其他的依赖，包括：</p><ul><li>Spring 的 MVC 框架；</li><li>嵌入式的 Tomcat；</li><li>Thymeleaf 和 Thymeleaf 布局方言；</li></ul><p>它还引入了 Spring Boot 的自动配置库。当应用启动的时候，Spring Boot 的自动配置将会探测到这些库，并自动完成如下功能：</p><ul><li>在 Spring 应用上下文中配置 bean 以启用 Spring MVC；</li><li>在 Spring 应用上下文中配置嵌入式的 Tomcat 服务器；</li><li>配置 Thymeleaf 视图解析器，以便于使用 Thymeleaf 模板渲染 Spring MVC 视图。</li></ul><h3 id="创建控制类"><a href="#创建控制类" class="headerlink" title="创建控制类"></a>创建控制类</h3><p><img data-src="https://doc.shiyanlou.com/courses/uid1172186-20200225-1582616428-ef32o" alt="Spring MVC 请求映射注解" style="zoom: 67%;" /></p><p>新的请求映射注解具有和 <code>@RequestMapping</code> 完全相同的属性，所以我们可以在使用 <code>@RequestMapping</code> 的任何地方使用它们。</p><p>通常，只在类级别上使用 <code>@RequestMapping</code>，以便于指定基本路径。在每个处理器方法上，我会使用更具体的 <code>@GetMapping</code>、<code>@PostMapping</code> 等注解。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">showDesignForm</span><span class="params">(Model model)</span> </span>&#123;</span><br><span class="line">    model.addAttribute(<span class="string">&quot;design&quot;</span>, <span class="keyword">new</span> Taco());</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;design&quot;</span>;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p> <code>showDesignForm()</code> 方法接下来的几行代码会根据配料类型过滤列表。配料类型的列表会作为属性添加到 Model 对象上，这个对象是以参数的形式传递给 <code>showDesignForm()</code> 方法的。Model 对象负责在控制器和展现数据的视图之间传递数据。实际上，放到 Model 属性中的数据将会复制到 Servlet Response 的属性中，这样视图就能在这里找到它们了。<code>showDesignForm()</code> 方法最后返回 <code>design</code>，这是视图的逻辑名称，会用来将模型渲染到视图上。</p><h3 id="项目启动"><a href="#项目启动" class="headerlink" title="项目启动"></a>项目启动</h3><h4 id="Main-方法启动"><a href="#Main-方法启动" class="headerlink" title="Main() 方法启动"></a>Main() 方法启动</h4><p>与普通的 Web 项目相比，Spring Boot 启动项目减少了几个中间步骤，不用去配置 Servlet 容器，也不用打包并且发布到 Servlet 容器再去启动，而是直接运行主方法即可启动项目，开发调试都十分方便也节省开发时间。在你的本机上开发项目时，可以直接在 Eclipse 或者 IDEA 中运行 Spring Boot 主程序类即可，比如现在的项目中有 Application 类，可以直接运行它的 <code>run()</code> 方法，项目就能够正常启动了。</p><h4 id="Maven-插件启动"><a href="#Maven-插件启动" class="headerlink" title="Maven 插件启动"></a>Maven 插件启动</h4><p>由于 <code>pom.xml</code> 文件中引入了 spring-boot-maven-plugin 插件依赖，也可以直接使用 Maven 命令来启动 Spring Boot 项目。插件配置如下，如果 <code>pom.xml</code> 文件中没有该 Maven 插件，是无法通过这种方式启动 Spring Boot 项目的，这一点需要注意。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure><p>启动过程过程如下图所示，首先点击下方工具栏中的 Terminal 打开命令行窗口，之后在命令行中输入命令，首先是切换到 <code>lou-springboot</code> 目录，命令为 <code>cd lou-springboot</code>，之后执行命令 <code>mvn spring-boot:run</code> 即可启动项目，如下图所示，Spring Boot 项目启动成功。</p><p><img data-src="https://doc.shiyanlou.com/courses/3228/358858/1148d964da1b43d7906307ba7d804fb0-0" alt="图片描述"></p><h4 id="java-jar-命令启动"><a href="#java-jar-命令启动" class="headerlink" title="java -jar 命令启动"></a>java -jar 命令启动</h4><p>项目初始化时我们选择的打包方式为 Jar ，因此项目开发完成进行打包时的结果是一个 Jar 包， Java 运行 Jar 包的命令为 <code>java -jar xxx.jar</code> ，结合以上两个原因我们可以使用这种方式启动 Spring Boot 项目，接下来我们来演示这一过程。</p><ul><li>首先，点击下方工具栏中的 Terminal 打开命令行窗口，切换到 <code>lou-springboot</code> 目录，命令为 <code>cd lou-springboot</code>，这一步跟 Maven 命令启动一样</li><li>之后使用 Maven 命令将项目打包，执行命令为：<code>mvn clean package -Dmaven.test.skip=true</code>，等待打包结果即可</li><li>打包成功后进入 <code>target</code> 目录，<code>cd target</code></li><li>最后就是启动已经生成的 Jar 包，执行命令为 <code>java -jar springboot-demo-0.0.1-SNAPSHOT.jar</code></li></ul><h2 id="杂项"><a href="#杂项" class="headerlink" title="杂项"></a>杂项</h2><h3 id="mvn项目管理"><a href="#mvn项目管理" class="headerlink" title="mvn项目管理"></a>mvn项目管理</h3><p>maven 命令的格式为 mvn [plugin-name]:[goal-name]，可以接受的参数如下，<br> -D 指定参数，如 -Dmaven.test.skip=true 跳过单元测试；<br> -P 指定 Profile 配置，可以用于区分环境；<br> -e 显示maven运行出错的信息；<br> -o 离线执行命令,即不去远程仓库更新包；<br> -X 显示maven允许的debug信息；<br> -U 强制去远程更新snapshot的插件或依赖，默认每天只更新一次。</p><h4 id="常用maven命令"><a href="#常用maven命令" class="headerlink" title="常用maven命令"></a>常用maven命令</h4><ul><li>创建maven项目：mvn archetype:create<br> 指定 group： -DgroupId=packageName<br> 指定 artifact：-DartifactId=projectName<br> 创建web项目：-DarchetypeArtifactId=maven-archetype-webapp</li><li>创建maven项目：mvn archetype:generate</li><li>验证项目是否正确：mvn validate</li><li>maven 打包：mvn package</li><li>只打jar包：mvn jar:jar</li><li>生成源码jar包：mvn source:jar</li><li>产生应用需要的任何额外的源代码：mvn generate-sources</li><li>编译源代码： mvn compile</li><li>编译测试代码：mvn test-compile</li><li>运行测试：mvn test</li><li>运行检查：mvn verify</li><li>清理maven项目：mvn clean</li><li>生成eclipse项目：mvn eclipse:eclipse</li><li>清理eclipse配置：mvn eclipse:clean</li><li>生成idea项目：mvn idea:idea</li><li>安装项目到本地仓库：mvn install</li><li>发布项目到远程仓库：mvn:deploy</li><li>在集成测试可以运行的环境中处理和发布包：mvn integration-test</li><li>显示maven依赖树：mvn dependency:tree</li><li>显示maven依赖列表：mvn dependency:list</li><li>下载依赖包的源码：mvn dependency:sources</li><li>安装本地jar到本地仓库：mvn install:install-file -DgroupId=packageName -DartifactId=projectName -Dversion=version -Dpackaging=jar -Dfile=path</li></ul><h4 id="web项目相关命令"><a href="#web项目相关命令" class="headerlink" title="web项目相关命令"></a>web项目相关命令</h4><ul><li><p>启动tomcat：mvn tomcat:run</p></li><li><p>启动jetty：mvn jetty:run</p></li><li><p>运行打包部署：mvn tomcat:deploy</p></li><li><p>撤销部署：mvn tomcat:undeploy</p></li><li><p>启动web应用：mvn tomcat:start</p></li><li><p>停止web应用：mvn tomcat:stop</p></li><li><p>重新部署：mvn tomcat:redeploy</p></li><li><p>部署展开的war文件：mvn war:exploded tomcat:exploded</p></li></ul><p>  maven 命令的格式为 mvn [plugin-name]:[goal-name]，可以接受的参数如下，<br>   -D 指定参数，如 -Dmaven.test.skip=true 跳过单元测试；<br>   -P 指定 Profile 配置，可以用于区分环境；<br>   -e 显示maven运行出错的信息；<br>   -o 离线执行命令,即不去远程仓库更新包；<br>   -X 显示maven允许的debug信息；<br>   -U 强制去远程更新snapshot的插件或依赖，默认每天只更新一次。</p><h4 id="常用maven命令-1"><a href="#常用maven命令-1" class="headerlink" title="常用maven命令"></a>常用maven命令</h4><ul><li>创建maven项目：mvn archetype:create<br> 指定 group： -DgroupId=packageName<br> 指定 artifact：-DartifactId=projectName<br> 创建web项目：-DarchetypeArtifactId=maven-archetype-webapp</li><li>创建maven项目：mvn archetype:generate</li><li>验证项目是否正确：mvn validate</li><li>maven 打包：mvn package</li><li>只打jar包：mvn jar:jar</li><li>生成源码jar包：mvn source:jar</li><li>产生应用需要的任何额外的源代码：mvn generate-sources</li><li>编译源代码： mvn compile</li><li>编译测试代码：mvn test-compile</li><li>运行测试：mvn test</li><li>运行检查：mvn verify</li><li>清理maven项目：mvn clean</li><li>生成eclipse项目：mvn eclipse:eclipse</li><li>清理eclipse配置：mvn eclipse:clean</li><li>生成idea项目：mvn idea:idea</li><li>安装项目到本地仓库：mvn install</li><li>发布项目到远程仓库：mvn:deploy</li><li>在集成测试可以运行的环境中处理和发布包：mvn integration-test</li><li>显示maven依赖树：mvn dependency:tree</li><li>显示maven依赖列表：mvn dependency:list</li><li>下载依赖包的源码：mvn dependency:sources</li><li>安装本地jar到本地仓库：mvn install:install-file -DgroupId=packageName -DartifactId=projectName -Dversion=version -Dpackaging=jar -Dfile=path</li></ul><h4 id="web项目相关命令-1"><a href="#web项目相关命令-1" class="headerlink" title="web项目相关命令"></a>web项目相关命令</h4><ul><li>启动tomcat：mvn tomcat:run</li><li>启动jetty：mvn jetty:run</li><li>运行打包部署：mvn tomcat:deploy</li><li>撤销部署：mvn tomcat:undeploy</li><li>启动web应用：mvn tomcat:start</li><li>停止web应用：mvn tomcat:stop</li><li>重新部署：mvn tomcat:redeploy</li><li>部署展开的war文件：mvn war:exploded tomcat:exploded</li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> Spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vue实战</title>
      <link href="2022/01/05/vue%E5%AE%9E%E6%88%98/"/>
      <url>2022/01/05/vue%E5%AE%9E%E6%88%98/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>vue实战 使用cli脚手架.<br><span id="more"></span></p><h2 id="vue-cli介绍"><a href="#vue-cli介绍" class="headerlink" title="@vue/cli介绍"></a>@vue/cli介绍</h2><blockquote><p>Vue CLI 是一个基于 Vue.js 进行快速开发的完整系统，提供：</p><ul><li><p>通过 <code>@vue/cli</code> 实现的交互式的项目脚手架。</p></li><li><p>通过 <code>@vue/cli</code> + <code>@vue/cli-service-global</code> 实现的零配置原型开发。</p></li><li><p>一个运行时依赖 (</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@vue/cli-service</span><br></pre></td></tr></table></figure><p>)，该依赖：</p><ul><li>可升级；</li><li>基于 webpack 构建，并带有合理的默认配置；</li><li>可以通过项目内的配置文件进行配置；</li><li>可以通过插件进行扩展。</li></ul></li><li><p>一个丰富的官方插件集合，集成了前端生态中最好的工具。</p></li><li><p>一套完全图形化的创建和管理 Vue.js 项目的用户界面。</p></li></ul></blockquote><h3 id="首先进行安装"><a href="#首先进行安装" class="headerlink" title="首先进行安装"></a>首先进行安装</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g @vue/cli</span><br></pre></td></tr></table></figure><p>安装后运行命令初始化</p><p><img data-src="http://cdn.sekyoro.top/imgs/065827.png" alt="image-20220105142115077"></p><p>可以选择用vue2还是vue3.这里插一句,虽然可以直接学习vue3,但我看很多项目还是vue2,不过对我这种noob来说,不需要区分太多.我也不懂 :)</p><p>常用插件:vue-router 路由</p><p>element-ui 用于ui,有很多类似的框架</p><p>axios 发送HTTP请求 babel-polyfill babel有些还是不支持,这里polyfill一下(不懂的可以看一下资料)</p><blockquote><p>Babel是一个工具集，主要用于将ES6版本的JavaScript代码转为ES5等向后兼容的JS代码，从而可以运行在低版本浏览器或其它环境中。</p><p>因此，你完全可以在工作中使用ES6编写程序，最后使用Babel将代码转为ES5的代码，这样就不用担心所在环境是否支持了</p></blockquote><p>同时需要安装一些插件,用于方便的UI管理</p><p><img data-src="http://cdn.sekyoro.top/imgs/093947.png" alt="image-20220105152556639"></p><h3 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h3><p>src 目录是我们整个 Vue 项目中最为重要的一个目录文件，其中包含了我们大部分的代码：</p><ul><li>api 这个目录是用于新建接口模块并使用 axios 实例。</li><li>assets 这个目录便是模块资源目录，与 static 不同的是，他会被 webpack 所处理，而 static 文件则是直接使用即可。</li><li>components 这个目录是模块组件目录，里面存放着我们所创建的各个组件，在本次项目中将这些组件分为两组：<code>common</code> 公共组件和 <code>page</code> 页面组件。</li><li>router 这个目录是路由配置目录，里面存放着我们去中心化之后的路由配置文件。</li><li>untils 这个目录是用于存放项目公用的 js 文件。</li><li>App.vue 这个文件是主应用程序组件，也是我们项目的根组件，所有组件都需要挂载到这个根组件上面。</li><li>main.js 这个文件是项目的核心入口文件，我们之前安装的插件也是在这个文件当中去进行引入和挂载，在这里面引入的插件我们就可以直接在整个项目中进行使用</li></ul><h2 id="路由与组件"><a href="#路由与组件" class="headerlink" title="路由与组件"></a>路由与组件</h2><p>组件是我们根据需求所封装出来的 HTML 页面。</p><p>路由是一个项目中的枢纽，他能够对我们所创建的各个组件进行对应的调配，使不同页面进行切换。</p><p>在了解概念后,可以利用去中心化路由和模块化组件调控页面.</p><blockquote><p>所谓的路由，便是通过访问不同的 URL 从而访问不同的网页。这样就可以达到动态挂载组件的目的。要使用路由需要引入 Vue Router，Vue Router 是 Vue.js 官方的路由管理器，可以帮助我们更加轻松的构建单页面应用。</p></blockquote><p>步骤:</p><ol><li><p>导入vue-router</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在 router/index.js 写入以下代码</span></span><br><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> VueRouter <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span>;</span><br></pre></td></tr></table></figure></li><li><p>执行</p></li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Vue.use(VueRouter)</span><br></pre></td></tr></table></figure><p>3.设置路由配置并引入相应组件</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">//在component下写组件</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;home-wrap&quot;&gt;</span><br><span class="line">    &lt;span&gt;Login组件&lt;/span&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在 router/index.js 写入以下代码</span></span><br><span class="line"><span class="comment">//将router导出</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> VueRouter(&#123;</span><br><span class="line">  <span class="attr">routes</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">path</span>: <span class="string">&#x27;/home&#x27;</span>,</span><br><span class="line">      <span class="attr">component</span>: vHome,</span><br><span class="line">      <span class="attr">meta</span>: &#123;</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&#x27;Home组件&#x27;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">path</span>: <span class="string">&#x27;/login&#x27;</span>,</span><br><span class="line">      <span class="attr">component</span>: vLogin,</span><br><span class="line">      <span class="attr">meta</span>: &#123;</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&#x27;Login组件&#x27;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><ol><li>挂载实例</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在 main.js 写入以下代码</span></span><br><span class="line"><span class="comment">// 引入 VueRouter</span></span><br><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">&#x27;./router&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实例化 Vue</span></span><br><span class="line"><span class="keyword">new</span> Vue(&#123;</span><br><span class="line">  router,</span><br><span class="line">  <span class="attr">render</span>: <span class="function">(<span class="params">h</span>) =&gt;</span> h(App),</span><br><span class="line">&#125;).$mount(<span class="string">&#x27;#app&#x27;</span>);</span><br></pre></td></tr></table></figure><p>可以用vue3写一下类似的</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 定义路由组件.</span></span><br><span class="line"><span class="comment">// 也可以从其他文件导入</span></span><br><span class="line"><span class="keyword">const</span> Home = &#123; <span class="attr">template</span>: <span class="string">&#x27;&lt;div&gt;Home&lt;/div&gt;&#x27;</span> &#125;</span><br><span class="line"><span class="keyword">const</span> About = &#123; <span class="attr">template</span>: <span class="string">&#x27;&lt;div&gt;About&lt;/div&gt;&#x27;</span> &#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 2. 定义一些路由</span></span><br><span class="line"><span class="comment">// 每个路由都需要映射到一个组件。</span></span><br><span class="line"><span class="comment">// 我们后面再讨论嵌套路由。</span></span><br><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">  &#123; <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span>, <span class="attr">component</span>: Home &#125;,</span><br><span class="line">  &#123; <span class="attr">path</span>: <span class="string">&#x27;/about&#x27;</span>, <span class="attr">component</span>: About &#125;,</span><br><span class="line">]</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 3. 创建路由实例并传递 `routes` 配置</span></span><br><span class="line"><span class="comment">// 你可以在这里输入更多的配置，但我们在这里</span></span><br><span class="line"><span class="comment">// 暂时保持简单</span></span><br><span class="line"><span class="keyword">const</span> router = VueRouter.createRouter(&#123;</span><br><span class="line">  <span class="comment">// 4. 内部提供了 history 模式的实现。为了简单起见，我们在这里使用 hash 模式。</span></span><br><span class="line">  <span class="attr">history</span>: VueRouter.createWebHashHistory(),</span><br><span class="line">  routes, <span class="comment">// `routes: routes` 的缩写</span></span><br><span class="line">&#125;)</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 5. 创建并挂载根实例</span></span><br><span class="line"><span class="keyword">const</span> app = Vue.createApp(&#123;&#125;)</span><br><span class="line"><span class="comment">//确保 _use_ 路由实例使</span></span><br><span class="line"><span class="comment">//整个应用支持路由。</span></span><br><span class="line">app.use(router)</span><br><span class="line"> </span><br><span class="line">app.mount(<span class="string">&#x27;#app&#x27;</span>)</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 现在，应用已经启动了！</span></span><br></pre></td></tr></table></figure><h3 id="使用路由"><a href="#使用路由" class="headerlink" title="使用路由"></a>使用路由</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">router-view</span>&gt;</span><span class="tag">&lt;/<span class="name">router-view</span>&gt;</span></span><br></pre></td></tr></table></figure><p>在App.vue中使用 </p><p><code>&lt;router-view&gt;&lt;/router-view&gt;</code> 便是我们最顶层的出口，通过路由调控的组件都会被渲染到这个出口位置</p><p>根据routes配置的path切换url,就可以看到不同的内容,根据component.</p><p>根组件中的 <code>&lt;router-view&gt;&lt;/router-view&gt;</code> 是最顶层的出口，用于渲染最高级路由匹配到的组件。嵌套路由便是在最高级路由匹配到的组件中嵌套一个新的次级出口，用于渲染次级路由匹配到的组件。</p><h3 id="嵌套路由"><a href="#嵌套路由" class="headerlink" title="嵌套路由"></a>嵌套路由</h3><p>在一个路由下嵌套,利用children</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 将 router/index.js 修改为：</span></span><br><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> VueRouter <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span>;</span><br><span class="line"></span><br><span class="line">Vue.use(VueRouter);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> VueRouter(&#123;</span><br><span class="line">  <span class="attr">routes</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">path</span>: <span class="string">&#x27;/home&#x27;</span>,</span><br><span class="line">      <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;../components/common/Home.vue&#x27;</span>),</span><br><span class="line">      <span class="attr">children</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">path</span>: <span class="string">&#x27;child&#x27;</span>,</span><br><span class="line">          <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;../components/page/Children.vue&#x27;</span>),</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">path</span>: <span class="string">&#x27;child1&#x27;</span>,</span><br><span class="line">          <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;../components/page/Children1.vue&#x27;</span>),</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">path</span>: <span class="string">&#x27;child2&#x27;</span>,</span><br><span class="line">          <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;../components/page/Children2.vue&#x27;</span>),</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">path</span>: <span class="string">&#x27;child3&#x27;</span>,</span><br><span class="line">          <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;../components/page/Children3.vue&#x27;</span>),</span><br><span class="line">        &#125;,</span><br><span class="line">      ],</span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="UI"><a href="#UI" class="headerlink" title="UI"></a>UI</h2><p>使用ElementUI</p><p>学习如何将 Element UI 引入到项目之中，包括全局引入和按需引入两种方式</p><h3 id="按需引入"><a href="#按需引入" class="headerlink" title="按需引入"></a>按需引入</h3><p>根据自身需求对 Element UI 里面的组件进行单独引入。这种方法的利弊为：</p><ul><li>优点：因为是按照需求进行单独引入，抛弃了未使用的组件，从而对项目体积造成的影响不大。</li><li>缺点：手动按需引入，需要进行更多的代码工作，增大了开发人员的负担。同时繁多的组件样式，会导致代码繁杂紊乱，不利于美观</li></ul><h3 id="全局引入"><a href="#全局引入" class="headerlink" title="全局引入"></a>全局引入</h3><p>顾名思义就是将整个 Element UI 里面的组件统统引入到我们项目中。这种方法的利弊为：</p><ul><li>优点：使用方便，在经过一次引入之后就可以直接使用所有样式。</li><li>缺点：因为整体引入了所有样式，所以会导致项目体积增大。</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引入 Element UI</span></span><br><span class="line"><span class="keyword">import</span> ElementUI <span class="keyword">from</span> <span class="string">&#x27;element-ui&#x27;</span>;</span><br><span class="line"><span class="comment">// 单独引入样式文件</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;element-ui/lib/theme-chalk/index.css&#x27;</span>;</span><br><span class="line"><span class="comment">// 执行 ElementUI</span></span><br><span class="line">Vue.use(ElementUI);</span><br></pre></td></tr></table></figure><p>然后直接使用即可</p><h2 id="组件通信"><a href="#组件通信" class="headerlink" title="组件通信"></a>组件通信</h2><h3 id="父子组件通信"><a href="#父子组件通信" class="headerlink" title="父子组件通信"></a>父子组件通信</h3><p>props</p><h3 id="非父子组件通信"><a href="#非父子组件通信" class="headerlink" title="非父子组件通信"></a>非父子组件通信</h3><p>emit与on</p><h2 id="头部设计"><a href="#头部设计" class="headerlink" title="头部设计"></a>头部设计</h2><p>header</p><p>侧边栏折叠按钮、系统 logo、全屏显示按钮、消息中心、用户头像以及用户名<strong>下拉菜单</strong></p><h3 id="侧边栏折叠"><a href="#侧边栏折叠" class="headerlink" title="侧边栏折叠"></a>侧边栏折叠</h3><p>侧边栏折叠 需要两种不同的状态 </p><ol><li><p>利用v-if v-else判断 </p></li><li><p>v:on 改变状态</p><p>设置状态变量</p></li></ol><h3 id="系统logo"><a href="#系统logo" class="headerlink" title="系统logo"></a>系统logo</h3><p>直接一个div</p><h3 id="创建右边功能区的第一个功能-全屏按钮"><a href="#创建右边功能区的第一个功能-全屏按钮" class="headerlink" title="创建右边功能区的第一个功能-全屏按钮"></a>创建右边功能区的第一个功能-全屏按钮</h3><p>使用element-ui</p><p>eltooltip文字提示</p><ul><li>effect：设置 el-tooltip 的主题样式，tooltip 提供了两个主题：dark 和 light。</li><li>content：设置 提示的文字，通过三元表达式来设置不同的文字提示。</li><li>placement：设置文字提示出现的位置</li></ul><p>click点击</p><h3 id="消息中心"><a href="#消息中心" class="headerlink" title="消息中心"></a>消息中心</h3><p>类似,使用eltooltip设置文字提示.消息中心可以有一个路由跳转</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">router-link</span>&gt;</span><span class="tag">&lt;/<span class="name">routerlink</span>&gt;</span></span><br></pre></td></tr></table></figure><p>to指定跳转地址</p><h3 id="用户头像"><a href="#用户头像" class="headerlink" title="用户头像"></a>用户头像</h3><p>img即可</p><h3 id="用户名下拉菜单"><a href="#用户名下拉菜单" class="headerlink" title="用户名下拉菜单"></a>用户名下拉菜单</h3><p>将用户名设置为下拉菜单.</p><p>通过 trigger 设置触发下拉的行为；command 设置点击菜单项触发的事件回调。下拉列表则是 el-dropdown-menu，将属性 slot 设置为 dropdown 来设置下拉菜单</p><p>以上利用element-ui设计,没有太多逻辑</p><h3 id="js部分"><a href="#js部分" class="headerlink" title="js部分"></a>js部分</h3><ol><li>加载bus实现组件通信</li><li>设置数据</li><li>监听属性</li><li>方法 侧边栏折叠 </li></ol><h2 id="Sidebar组件"><a href="#Sidebar组件" class="headerlink" title="Sidebar组件"></a>Sidebar组件</h2><p>可以有一级菜单,二级菜单,三级菜单等.</p><p>第一步：对 data 数据中的 items 数组进行循环，此时的 items 数组中的数据就是第一级菜单；</p><p>第二步：判定是否具有第二级菜单，如果有第二级菜单，则渲染第一级菜单标题之后对第二级菜单进行循环；如果没有第二级菜单，则渲染第一级菜单标题之后退出循环；</p><p>第三步：循环第二级菜单，判定是否具有第三级菜单，如果有第三级菜单，则渲染第二级菜单标题之后对第三级菜单进行循环；如果没有第三级菜单，则渲染第二级菜单标题之后退出当前循环；</p><p>第四步：循环第三级菜单，渲染第三级菜单标题</p><h2 id="Tags组件"><a href="#Tags组件" class="headerlink" title="Tags组件"></a>Tags组件</h2><h2 id="资料"><a href="#资料" class="headerlink" title="资料"></a>资料</h2><p><a href="https://cli.vuejs.org/zh/">Vue CLI (vuejs.org)</a></p><ul><li>CLI：即 @vue/cli，它是一个需要全局安装的 npm 包，向我们提供了 vue 命令，我们可以通过使用它来满足我们快速创建 Vue 项目的需求。</li><li>CLI 服务：即 @vue/cli-service ，它是一个开发环境依赖，是一个局部安装在 @vue/cli 创建的项目中的 npm 包。它安装了一个名为 vue-cli-service 的命令，我们可以在创建项目后的 <code>packsge.json</code> 文件中找到对应的 script 命令。通过 npm 调用这些 script 命令可以达到配置服务器或打包的目的。</li><li>CLI 插件：它的作用是向我们创建的项目中提供可选功能的 npm 包，可以更好的帮助我们完成对项目的管理。同样，我们可以在 <code>package.json</code> 文件当中找到对应的 dependencies，这里标注了我们所安装的功能插件的信息</li></ul><p><a href="http://nodejs.cn/learn">Node.js 简介 (nodejs.cn)</a></p><h3 id="生产环境与开发环境"><a href="#生产环境与开发环境" class="headerlink" title="生产环境与开发环境"></a>生产环境与开发环境</h3><p>在 <code>Vue</code> 中， <code>NODE_ENV</code> 可以通过 <code>.env</code> 文件或者 <code>.env.[mode]</code> 文件配置。配置过后，运行 <code>Vue CLI</code> 指令（ <code>npm run dev(serve)</code> ，<code>npm run build</code> ）时，就会将该模式下的<code>NODE_ENV</code>载入其中了。而这些命令，都有自己的默认模式：</p><ul><li><code>npm run dev(serve)</code> ，其实是运行了 <code>vue-cli service serve</code> ，默认模式为  development 。可以在 <code>.env.development</code> 文件下修改该模式的 <code>NODE_ENV</code> 。</li><li><code>npm run build</code> ，其实运行了 <code>vue-cli service build</code> ，默认模式为  production 。可以在 <code>.env.production</code> 文件下修改该模式的 <code>NODE_ENV</code> 。</li></ul><p><img data-src="http://cdn.sekyoro.top/imgs/093950.png" alt="image-20220105143228846"></p><p><a href="https://www.jiangruitao.com/babel/introduction/">Babel 简介 - Babel教程 - 姜瑞涛的官方网站 (jiangruitao.com)</a></p><p><a href="https://babel.docschina.org/">Babel 中文文档 · 下一代 JavaScript 编译器 (docschina.org)</a></p><h3 id="export"><a href="#export" class="headerlink" title="export"></a>export</h3><p><strong>export</strong>和<strong>export</strong> <strong>default</strong>是ES6中导出模块中变量的语法</p><p><strong>exports</strong>和<strong>module</strong>.<strong>exports</strong>是Nodejs中导出模块中变量的语法（基于CommonJs语法规范）</p><p><a href="https://www.jianshu.com/p/2b219e6712aa">JS 之export、export default和module.exports - 简书 (jianshu.com)</a></p><p><a href="https://segmentfault.com/a/1190000016662929">vue中$router以及$route的使用 - SegmentFault 思否</a></p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> vue </category>
          
      </categories>
      
      
        <tags>
            
            <tag> vue2 </tag>
            
            <tag> ElementUI </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>codewars练习</title>
      <link href="2022/01/04/codewars%E7%BB%83%E4%B9%A0/"/>
      <url>2022/01/04/codewars%E7%BB%83%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>CodeWars刷题网站,与leetcode这种算法刷题不太一样.网速还行,没有被墙.<br><span id="more"></span><br>随缘更新.本人算法不好.</p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> codewars </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>javaweb初体验</title>
      <link href="2022/01/03/javaweb%E5%88%9D%E4%BD%93%E9%AA%8C/"/>
      <url>2022/01/03/javaweb%E5%88%9D%E4%BD%93%E9%AA%8C/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>挺有意思的,用了Tomcat和Maven管理项目,感觉java开发比较综合.<br><span id="more"></span></p><h2 id="下载与配置"><a href="#下载与配置" class="headerlink" title="下载与配置"></a>下载与配置</h2><p>话不多说,先下载Tomcat和Maven.</p><p><a href="https://tomcat.apache.org/">Apache Tomcat® - Welcome!</a></p><p><a href="https://maven.apache.org/">Maven – Welcome to Apache Maven</a></p><p>来点介绍.</p><blockquote><p>Tomcat 服务器是一个免费的开放源代码的Web 应用服务器，属于轻量级应用<a href="https://baike.baidu.com/item/服务器">服务器</a>，在中小型系统和并发访问用户不是很多的场合下被普遍使用，是开发和调试JSP 程序的首选。对于一个初学者来说，可以这样认为，当在一台机器上配置好Apache 服务器，可利用它响应<a href="https://baike.baidu.com/item/HTML">HTML</a>（<a href="https://baike.baidu.com/item/标准通用标记语言/6805073">标准通用标记语言</a>下的一个应用）页面的访问请求</p></blockquote><p>个人认为Tomcat是一个可以运行java程序,比如servlet和jsp的服务器,动态web.</p><p>Maven是包管理工具.</p><blockquote><p>Maven利用一个中央信息片断能管理一个项目的构建、报告和文档等步骤。</p><p>Maven 是一个项目管理工具，可以对 Java 项目进行构建、依赖管理。</p><p>Maven 也可被用于构建和管理各种项目</p><p>版本建议是不要最新,要比较新的.</p></blockquote><p>我的版本如下</p><p><img data-src="http://cdn.sekyoro.top/imgs/065703.png" alt="image-20220103160435764"></p><p>然后添加环境变量,添加一个maven以及之前没有添加JAVA_HOME的需要再添加一下.这些不用细说了.</p><p>需要修改maven的镜像,不然下载太慢,同时改一下本地仓库的位置,不然默认为C盘.</p><p>在conf/settings.xml中修改.不细说.我会贴一些其他资料.</p><p>利用IDEA创建Maven项目,注意修改maven,IDEA有默认的自带的Maven,要修改为自己的Maven.</p><p>然后是Tomcat,IDEA社区版也就是免费的那种貌似没有自带Tomcat server,但可以下载插件 Smart Tomcat.也能正常用.</p><h2 id="实操"><a href="#实操" class="headerlink" title="实操"></a>实操</h2><p>步骤:1.创建一个Maven的项目,可以是空的,也可以选择webapp.</p><p>2.目录结构修改如下</p><p><img data-src="http://cdn.sekyoro.top/imgs/065704.png" alt="image-20220103161126741"></p><p>java下放servlet程序,webapp可以放html或者jsp等.</p><ol><li>要使用servlet,需要引入相关jar包,利用maven的话可以直接在pom.xml中添加依赖.</li></ol><p><img data-src="http://cdn.sekyoro.top/imgs/093901.png" alt="image-20220103161312575">具体版本要看个人情况了,有可能出现一些不适配的情况.然后Maven就能依据这种信息去远端下载,如果配置了镜像,就会去那下载.不然外网速度太慢.</p><p>下载后就能导入包了.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sekyoro;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintWriter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">servelet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.doGet(request,response);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="comment">//设置网页响应类型</span></span><br><span class="line">        response.setContentType(<span class="string">&quot;text/html&quot;</span>);</span><br><span class="line">        <span class="comment">//实现具体操作</span></span><br><span class="line">        PrintWriter out = response.getWriter();</span><br><span class="line">        out.println(<span class="string">&quot;This is a new servlet page&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>在java下创建包,包中写servlet程序.</p><ol><li>然后在web.xml中添加索引</li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">web-app</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>Archetype Created Web Application<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>Demo<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>com.sekyoro.servelet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>Demo<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/Demo<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure><p>这样可以使得servelt程序能被找到.</p><p>接下来运行即可.</p><h3 id="一些体会"><a href="#一些体会" class="headerlink" title="一些体会"></a>一些体会</h3><p>这种东西真的需要自己动手来一遍,因为遇到的问题可能都不一样.</p><p>同时,servlet以及jsp没有必要学的太深,后面直接往Spring走.</p><p>Maven还是要好好用的.</p><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a href="https://www.bilibili.com/video/BV12J411M7Sj?p=8">【狂神说Java】JavaWeb入门到实战_哔哩哔哩_bilibili</a></p><p><a href="https://www.cnblogs.com/workingsugar/p/14604127.html">初学Servlet时使用IDEA中 利用Tomcat 10.0.4 构建类servlet报错：类HelloServlet不是Servlet。 - workingsugar - 博客园 (cnblogs.com)</a></p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
            <tag> Web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>疫情自动打卡</title>
      <link href="2022/01/02/%E7%96%AB%E6%83%85%E8%87%AA%E5%8A%A8%E6%89%93%E5%8D%A1/"/>
      <url>2022/01/02/%E7%96%AB%E6%83%85%E8%87%AA%E5%8A%A8%E6%89%93%E5%8D%A1/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>主要涉及到一个查询参数的逆向.疫情填报打卡,之前用selenium写过,不过比较笨重.</p><p>现在直接使用requests.<br><span id="more"></span><br>爬虫的精髓应该是js逆向,反爬技术.<br>使用python的简单之处就是利用方法简单的库,cookie自动保存,留给我们的就是去逆向,多线程处理等等.</p><h2 id="开始"><a href="#开始" class="headerlink" title="开始"></a>开始</h2><p>首先进入官网</p><p><a href="https://uis.nwpu.edu.cn/cas/login">西北工业大学</a></p><p>打开检查,一般流程是发送一个GET请求,有了cookie.如果你发现响应没有set-cookie,而请求直接就有了cookie,这一般是浏览器缓存了,可以清除一下cookie.</p><p><img data-src="http://cdn.sekyoro.top/imgs/093918.png" alt="image-20220102171907498"></p><p>这就是响应,可以看到有了set-cookie,这很重要,直接提交表单的话没有cookie,很可能失败(要说为什么不是一定,这与你调的第三方包有关).</p><p><img data-src="http://cdn.sekyoro.top/imgs/093920.png" alt="image-20220102171754941"></p><p>然后输入账号密码,查看又发了什么请求,通常会发一个POST.</p><p>打开筛选器 method:POST查看</p><p><img data-src="http://cdn.sekyoro.top/imgs/093921.png" alt="image-20220102172509367"></p><p>当看到POST请求时有必要查看PAYLOAD,也就是携带的数据.</p><p><img data-src="http://cdn.sekyoro.top/imgs/093924.png" alt="image-20220102172603819"></p><p>构造请求时直接把这个表单发过去就行了.</p><p>再看看响应头又有set-cookie说明这个很有用,因为给了你cookie.</p><p><img data-src="http://cdn.sekyoro.top/imgs/093925.png" alt="image-20220102172706501"></p><p>这样登录之后就有了基本的cookie</p><h2 id="进入疫情填报"><a href="#进入疫情填报" class="headerlink" title="进入疫情填报"></a>进入疫情填报</h2><p>然后进入疫情填报界面<a href="http://yqtb.nwpu.edu.cn/wx/xg/yz-mobile/index.jsp">疫情每日填报</a></p><p>正常一波操作:打开审查,刷新,查看重要的请求(一般是jsp或者js啥的)</p><p>看到了熟悉的set-cookie</p><p><img data-src="http://cdn.sekyoro.top/imgs/093927.png" alt="image-20220102173029972"></p><p>说明这个url是需要get的,同时查看响应发现有很多个人信息,包括姓名.</p><p>注意一下:因为我们登陆时只输入了学号和密码,如果后面需要姓名,可以通过这种方法获取响应提取出姓名.</p><p>这里就可以利用正则提取出姓名.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">name_info = s.get(get_name_url, headers=headers).text</span><br><span class="line">name = re.search(<span class="string">r&#x27;姓名：(.*)&lt;&#x27;</span>, name_info).group(<span class="number">1</span>)</span><br></pre></td></tr></table></figure><p>同时我们又可以发现还有POST请求</p><p><img data-src="http://cdn.sekyoro.top/imgs/093930.png" alt="image-20220102173401933"></p><p>查看payload,有一个</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">actionType: getRoles</span><br></pre></td></tr></table></figure><p>看不出有什么特别的作用,可以不用post.</p><h2 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h2><p>然后点击每日填报,又进入新的页面,查看有没有什么请求</p><p>筛选jsp,我们到这里就可以知道这个网站的架构了,利用jsp(不过这是常见的方法)</p><p>可以发现一个请求jrsb.jsp,貌似没什么特别作用.</p><p><img data-src="http://cdn.sekyoro.top/imgs/093931.png" alt="image-20220102173804950"></p><p>不过可以看看响应的预览,后面可能会用于提取一些数据啥的.</p><p>勾选已检测,提交表单.</p><p>可以查看新的请求</p><p><img data-src="http://cdn.sekyoro.top/imgs/093934.png" alt="image-20220102174221779"></p><p>这就是提交表单的POST. </p><p>查看Payload,重点是sign和timeStamp.表单数据正常贴过去就行.</p><p>主要是sign和timeStamp数据如何获取.</p><p><img data-src="http://cdn.sekyoro.top/imgs/093936.png" alt="image-20220102174413097"></p><p>接下来说说这个重点</p><h3 id="重点"><a href="#重点" class="headerlink" title="重点"></a>重点</h3><p>直接全局搜索sign或者其他关键词,这里的要点是不能把之前的清空了,也就是查询字符串参数与之前的响应有关.</p><p><img data-src="http://cdn.sekyoro.top/imgs/093937.png" alt="image-20220102174720756"></p><p>结果惊奇的发现这个字段在jrsb.jsp的响应里,url就是这个字段,推测是后台java生成后发过来的.</p><p><img data-src="http://cdn.sekyoro.top/imgs/093939.png" alt="image-20220102175014649"></p><p>提取出来就行了.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">query_info = s.get(get_query_url, headers=headers).text</span><br><span class="line">info = re.search(<span class="string">r&#x27;sign=(.*?)&amp;timeStamp=(\d*)&#x27;</span>, query_info)</span><br></pre></td></tr></table></figure><p>后面post需要params的参数,也就是post需要data表单数据,也需要params的字符串查询参数.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">post_url = <span class="string">&#x27;http://yqtb.nwpu.edu.cn/wx/ry/ry_util.jsp?&#x27;</span> + info.group()</span><br><span class="line">    params = &#123;</span><br><span class="line">        <span class="string">&#x27;sign&#x27;</span>: sign,</span><br><span class="line">        <span class="string">&#x27;timeStamp&#x27;</span>: timestamp</span><br><span class="line">    &#125;</span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&#x27;hsjc&#x27;</span>: <span class="string">&#x27;1&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;xasymt&#x27;</span>: <span class="string">&#x27;1&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;actionType&#x27;</span>: <span class="string">&#x27;addRbxx&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;userLoginId&#x27;</span>: sno,</span><br><span class="line">        <span class="string">&#x27;szcsbm&#x27;</span>: <span class="string">&#x27;1&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;bdzt&#x27;</span>: <span class="string">&#x27;1&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;szcsmc&#x27;</span>: <span class="string">&#x27;在学校&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;sfyzz&#x27;</span>: <span class="string">&#x27;0&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;sfqz&#x27;</span>: <span class="string">&#x27;0&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;tbly&#x27;</span>: <span class="string">&#x27;sso&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;qtqksm&#x27;</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;ycqksm&#x27;</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;userType&#x27;</span>: <span class="string">&#x27;2&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;userName&#x27;</span>: name,</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment"># 这里要加一下请求源 必要</span></span><br><span class="line">    headers.update(&#123;</span><br><span class="line">        <span class="string">&#x27;Referer&#x27;</span>: <span class="string">&#x27;http://yqtb.nwpu.edu.cn/wx/ry/jrsb.jsp&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Origin&#x27;</span>: <span class="string">&#x27;http://yqtb.nwpu.edu.cn&#x27;</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">    r = s.post(post_url, headers=headers, data=data, params=params)</span><br></pre></td></tr></table></figure><p>最后要加一下请求的referer</p><p> Referer 请求头包含了当前请求页面的来源页面的地址，即表示当前页面是通过此来源页面里的链接进入的</p><p>如果不加测试发现过不了,应该是服务器有检测.</p><p>这样整个代码基本就完成了.</p><h2 id="源代码"><a href="#源代码" class="headerlink" title="源代码"></a>源代码</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span>(<span class="params">sno, pwd</span>):</span></span><br><span class="line">    s = requests.Session()</span><br><span class="line">    <span class="comment"># CAS系统登录报文</span></span><br><span class="line">    login_url = <span class="string">&#x27;https://uis.nwpu.edu.cn/cas/login&#x27;</span></span><br><span class="line">    be_student_url = <span class="string">&#x27;http://yqtb.nwpu.edu.cn/wx/xg/yz-mobile/qj_util.jsp&#x27;</span></span><br><span class="line">    get_name_url = <span class="string">&#x27;http://yqtb.nwpu.edu.cn/wx/xg/yz-mobile/index.jsp&#x27;</span></span><br><span class="line">    get_query_url = <span class="string">&#x27;http://yqtb.nwpu.edu.cn/wx/ry/jrsb.jsp&#x27;</span></span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">&#x27;Accept-Language&#x27;</span>: <span class="string">&#x27;zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;user-agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) &#x27;</span></span><br><span class="line">                      <span class="string">&#x27;Chrome/96.0.4664.110 Safari/537.36 Edg/96.0.1054.62&#x27;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&#x27;username&#x27;</span>: sno,</span><br><span class="line">        <span class="string">&#x27;password&#x27;</span>: pwd,</span><br><span class="line">        <span class="string">&#x27;currentMenu&#x27;</span>: <span class="string">&#x27;1&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;execution&#x27;</span>: <span class="string">&#x27;e1s1&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;_eventId&#x27;</span>: <span class="string">&#x27;submit&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;geolocation&#x27;</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;submit&#x27;</span>: <span class="string">&#x27;稍等片刻……&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 获取CAS系统SESSION</span></span><br><span class="line">    <span class="comment"># 这一步是必须的 要获取cookie</span></span><br><span class="line">    s.get(login_url, headers=headers)</span><br><span class="line">    <span class="comment"># 登录</span></span><br><span class="line">    s.post(login_url, headers=headers, data=data)</span><br><span class="line">    <span class="comment"># 这一步貌似并不是必要的 通过post提交一个数据</span></span><br><span class="line">    s.post(be_student_url, headers=headers, data=&#123;<span class="string">&#x27;actionType&#x27;</span>: <span class="string">&#x27;getRoles&#x27;</span>&#125;)</span><br><span class="line">    <span class="comment"># 这一步是获得姓名信息</span></span><br><span class="line">    name_info = s.get(get_name_url, headers=headers).text</span><br><span class="line">    name = re.search(<span class="string">r&#x27;姓名：(.*)&lt;&#x27;</span>, name_info).group(<span class="number">1</span>)</span><br><span class="line">    <span class="comment"># 获得查询参数 这是之前没有的</span></span><br><span class="line">    query_info = s.get(get_query_url, headers=headers).text</span><br><span class="line">    info = re.search(<span class="string">r&#x27;sign=(.*?)&amp;timeStamp=(\d*)&#x27;</span>, query_info)</span><br><span class="line">    <span class="comment"># 查询参数</span></span><br><span class="line">    sign = info.group(<span class="number">1</span>)</span><br><span class="line">    timestamp = info.group(<span class="number">2</span>)</span><br><span class="line">    <span class="comment"># post请求提交 注意,url后面的参数可以忽略</span></span><br><span class="line">    post_url = <span class="string">&#x27;http://yqtb.nwpu.edu.cn/wx/ry/ry_util.jsp?&#x27;</span> + info.group()</span><br><span class="line">    params = &#123;</span><br><span class="line">        <span class="string">&#x27;sign&#x27;</span>: sign,</span><br><span class="line">        <span class="string">&#x27;timeStamp&#x27;</span>: timestamp</span><br><span class="line">    &#125;</span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&#x27;hsjc&#x27;</span>: <span class="string">&#x27;1&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;xasymt&#x27;</span>: <span class="string">&#x27;1&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;actionType&#x27;</span>: <span class="string">&#x27;addRbxx&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;userLoginId&#x27;</span>: sno,</span><br><span class="line">        <span class="string">&#x27;szcsbm&#x27;</span>: <span class="string">&#x27;1&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;bdzt&#x27;</span>: <span class="string">&#x27;1&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;szcsmc&#x27;</span>: <span class="string">&#x27;在学校&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;sfyzz&#x27;</span>: <span class="string">&#x27;0&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;sfqz&#x27;</span>: <span class="string">&#x27;0&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;tbly&#x27;</span>: <span class="string">&#x27;sso&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;qtqksm&#x27;</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;ycqksm&#x27;</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;userType&#x27;</span>: <span class="string">&#x27;2&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;userName&#x27;</span>: name,</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment"># 这里要加一下请求源 必要</span></span><br><span class="line">    headers.update(&#123;</span><br><span class="line">        <span class="string">&#x27;Referer&#x27;</span>: <span class="string">&#x27;http://yqtb.nwpu.edu.cn/wx/ry/jrsb.jsp&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Origin&#x27;</span>: <span class="string">&#x27;http://yqtb.nwpu.edu.cn&#x27;</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">    r = s.post(post_url, headers=headers, data=data, params=params)</span><br><span class="line">    r = json.loads(r.text)</span><br><span class="line">    <span class="keyword">if</span> r[<span class="string">&#x27;state&#x27;</span>] == <span class="string">&quot;1&quot;</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;成功&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    sno = <span class="built_in">input</span>(<span class="string">&#x27;输入你的学号&#x27;</span>)</span><br><span class="line">    pwd = <span class="built_in">input</span>(<span class="string">&#x27;输入你的密码&#x27;</span>)</span><br><span class="line">    login(sno,pwd)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="学习资料"><a href="#学习资料" class="headerlink" title="学习资料"></a>学习资料</h2><p><a href="https://www.bilibili.com/video/BV1Mu411D7rD">JS逆向破解_哔哩哔哩_bilibili</a></p><p>这是偶然看到的,感觉挺不错,无聊时可以看看</p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
            <tag> requests </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vue学习</title>
      <link href="2021/12/31/vue%E5%AD%A6%E4%B9%A0/"/>
      <url>2021/12/31/vue%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>理所当然的开始学框架,vue3.x<br><span id="more"></span></p><p>Vue.js 的核心是一个允许采用简洁的模板语法来声明式地将数据渲染进 DOM 的系统</p><h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><p>还是三种方法</p><p>下载文件本地用,CDN和npm</p><p>然后需要脚手架. vue-cli</p><p>使用</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i -g @vue/cli</span><br></pre></td></tr></table></figure><p>官方命令行工具，可用于快速搭建大型单页应用</p><h2 id="开始项目"><a href="#开始项目" class="headerlink" title="开始项目"></a>开始项目</h2><p>这样就开始</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vue init webpack projectname</span><br></pre></td></tr></table></figure><p><img data-src="http://cdn.sekyoro.top/imgs/093941.png" alt="image-20211231162223916"></p><p>然后会进行一系列配置,现在可以都选no,后面再改.</p><p>然后进入项目 </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm run dev</span><br><span class="line">或者 </span><br><span class="line">npm run start</span><br></pre></td></tr></table></figure><p>会在8080端口开启服务,注意也可以对配置文件进行修改换端口.</p><p>这是开始一个vue项目.通过vue这个命令行对于构建vue项目有很多帮助.</p><p>当然也可以不用,直接引入vue.js即可.同时菜鸟教程推荐了Vite工具使用npm下载</p><h3 id="MVVM模式"><a href="#MVVM模式" class="headerlink" title="MVVM模式"></a>MVVM模式</h3><p>M：Model 即数据逻辑处理</p><p>V：View 即视图（用户界面）</p><p>VM：ViewModel 即数据视图，用于监听更新，View 与 Model 数据的双向绑定</p><p>所以，Vue 一大特点就是数据双向绑定，另一大特点就是响应式.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;ie=edge&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>syl-vue<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="comment">&lt;!-- 通过方式引入 vue.js --&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.staticfile.org/vue/3.0.5/vue.global.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="comment">&lt;!-- 数据双向绑定 --&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123;msg&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span></span><br><span class="line"><span class="javascript"><span class="xml">      <span class="keyword">var</span> app = <span class="keyword">new</span> Vue(&#123;</span></span></span><br><span class="line"><span class="javascript"><span class="xml">        <span class="attr">el</span>: <span class="string">&#x27;#app&#x27;</span>, <span class="comment">//el: 挂载点</span></span></span></span><br><span class="line"><span class="javascript"><span class="xml"></span></span></span><br><span class="line"><span class="javascript"><span class="xml">        <span class="attr">data</span>: &#123;</span></span></span><br><span class="line"><span class="javascript"><span class="xml">          <span class="comment">//data:数据选项</span></span></span></span><br><span class="line"><span class="javascript"><span class="xml"></span></span></span><br><span class="line"><span class="javascript"><span class="xml">          <span class="attr">msg</span>: <span class="string">&#x27;hello&#x27;</span>,</span></span></span><br><span class="line"><span class="javascript"><span class="xml">        &#125;,</span></span></span><br><span class="line"><span class="javascript"><span class="xml">      &#125;);</span></span></span><br><span class="line"><span class="javascript"><span class="xml">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br></pre></td></tr></table></figure><h2 id="模板语法"><a href="#模板语法" class="headerlink" title="模板语法"></a>模板语法</h2><p>允许开发者声明式地将 DOM 绑定至底层 Vue 实例的数据。所有 Vue.js 的模板都是合法的 HTML ，所以能被遵循规范的浏览器和 HTML 解析器解析，通俗的讲 Vue 模板语法就是在使用 Vue.js 开发时，你可以写在 HTML 元素上的操作语法，让你开发更高效，例如：绑定样式，循环出元素列表等。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> app = &#123;</span><br><span class="line"><span class="function"><span class="title">data</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="keyword">return</span> &#123;<span class="comment">/*数据*/</span>&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">Vue.createApp(app).mount(<span class="string">&#x27;#app&#x27;</span>);</span><br></pre></td></tr></table></figure><p>mount用于挂载</p><p>data是一个函数,应该返回一个对象,$data形式存储在组件实例中</p><ol><li>双大括号</li></ol><figure class="highlight clojure"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;&#125;&#125;</span><br></pre></td></tr></table></figure><p>通过使用 <code>v-once</code> 指令你也能执行一次性地插值，当数据 <strong>改变时</strong>，插值处的内容 <strong>不会更新</strong>。但是需要注意一下，该元素节点下面其他数据的绑定，数据改变，内容也不会更新，所以，注意代码块的划分</p><ol><li><p>v-html</p><p>渲染为html</p></li></ol><p>3.v-bind  渲染属性</p><p>4.v-on 监听事件</p><p>5.v-model</p><p>v-model就是<strong>vue的双向绑定的指令</strong>，能将页面上控件输入的值同步更新到相关绑定的data属性，也会在更新data绑定属性时候，更新页面上输入控件的值</p><p>v-if等指令</p><h3 id="methods"><a href="#methods" class="headerlink" title="methods"></a>methods</h3><p>组件中添加方法，使用 <strong>methods</strong> 选项，该选项包含了所需方法的对象</p><h3 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 完整语法 --&gt;</span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">v-on:click</span>=<span class="string">&quot;doSomething&quot;</span>&gt;</span> ... <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line">&lt;!-- 缩写 --&gt;</span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">a</span> @<span class="attr">click</span>=<span class="string">&quot;doSomething&quot;</span>&gt;</span> ... <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line">&lt;!-- 动态参数的缩写 (<span class="number">2.6</span><span class="number">.0</span>+) --&gt;</span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">a</span> @[<span class="attr">event</span>]=<span class="string">&quot;doSomething&quot;</span>&gt;</span> ... <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br></pre></td></tr></table></figure><h3 id="修饰符"><a href="#修饰符" class="headerlink" title="修饰符"></a>修饰符</h3><ul><li>事件修饰符</li><li>按键修饰符</li><li>系统修饰符</li></ul><p>修饰符是以半角句号 <strong>.</strong> 指明的特殊后缀，用于指出一个指令应该以特殊方式绑定</p><p>v-bind与v-on简写</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;a <span class="symbol">:href=<span class="string">&quot;&quot;</span>&gt;&lt;/a&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 完整语法 --&gt;</span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">v-on:click</span>=<span class="string">&quot;handleClick&quot;</span>&gt;</span>点我<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">&lt;!-- 缩写 --&gt;</span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;handleClick&quot;</span>&gt;</span>点我<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p>v-if</p><p>v-else</p><p>v-else-if</p><p>v-show</p><h2 id="计算属性"><a href="#计算属性" class="headerlink" title="计算属性"></a>计算属性</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">computed:&#123;</span><br><span class="line"><span class="attr">get</span>:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="comment">//return ...</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">set</span>:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="comment">//this.</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>惰性</p><h2 id="侦听属性"><a href="#侦听属性" class="headerlink" title="侦听属性"></a>侦听属性</h2><p>watch关键字</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">watch:&#123;</span><br><span class="line"><span class="attr">msg</span>:<span class="function"><span class="title">funciton</span>(<span class="params"><span class="keyword">new</span>,old</span>)</span>&#123;</span><br><span class="line"><span class="comment">//</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="过滤器"><a href="#过滤器" class="headerlink" title="过滤器"></a>过滤器</h2><p>在 Vue 中我们有一个专门处理数据过滤的东西：过滤器。过滤器可以用在两个地方：<strong>双花括号插值和 v-bind 表达式</strong></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123;msg2|getString&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">v-bind:class</span>=<span class="string">&quot;msg2|getString&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span> = <span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">style</span> = <span class="string">&quot;font-size:25px;&quot;</span>&gt;</span>计数器: &#123;&#123; counter &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span> = <span class="string">&quot;counter++&quot;</span> <span class="attr">style</span> = <span class="string">&quot;font-size:25px;&quot;</span>&gt;</span>点我<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript"><span class="keyword">const</span> app = &#123;</span></span><br><span class="line"><span class="javascript">  <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="attr">counter</span>: <span class="number">1</span></span></span><br><span class="line"><span class="javascript">    &#125;</span></span><br><span class="line"><span class="javascript">  &#125;</span></span><br><span class="line"><span class="javascript">&#125;</span></span><br><span class="line"><span class="javascript">vm = Vue.createApp(app).mount(<span class="string">&#x27;#app&#x27;</span>)</span></span><br><span class="line"><span class="javascript">vm.$watch(<span class="string">&#x27;counter&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">nval, oval</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">    alert(<span class="string">&#x27;计数器值的变化 :&#x27;</span> + oval + <span class="string">&#x27; 变为 &#x27;</span> + nval + <span class="string">&#x27;!&#x27;</span>);</span></span><br><span class="line"><span class="javascript">&#125;);</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="class与style的绑定"><a href="#class与style的绑定" class="headerlink" title="class与style的绑定"></a>class与style的绑定</h2><p>1.给 <code>v-bind:class</code> 一个对象，以动态地切换 class</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">:class</span>=<span class="string">&quot;&#123; &#x27;active&#x27;: isActive &#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>同时还有数组绑定法</p><p>2.我们可以把一个数组传给 <strong>v-bind:class</strong> </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;static&quot;</span> <span class="attr">:class</span>=<span class="string">&quot;[activeClass, errorClass]&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>style的绑定方法,同时也有数组与对象的方法.</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">:style</span>=<span class="string">&quot;&#123; color: activeColor, fontSize: fontSize + &#x27;px&#x27; &#125;&quot;</span>&gt;</span>菜鸟教程<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">div id=&quot;app&quot;&gt;</span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">:style</span>=<span class="string">&quot;&#123; color: activeColor, fontSize: fontSize + &#x27;px&#x27; &#125;&quot;</span>&gt;</span>菜鸟教程<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>还有很多东西,应该可以看了官方文档.后面直接实战算了.</p><h2 id="更新"><a href="#更新" class="headerlink" title="更新"></a>更新</h2><p>鸽了太久了…</p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      
        <tags>
            
            <tag> vue3.x </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>jQurey继续学习</title>
      <link href="2021/12/30/jQurey%E7%BB%A7%E7%BB%AD%E5%AD%A6%E4%B9%A0/"/>
      <url>2021/12/30/jQurey%E7%BB%A7%E7%BB%AD%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>接着上次的继续<br><span id="more"></span></p><p>jQuery对表单表格的操作</p><p>表单在网页中主要负责数据采集功能。一个表单有三个基本组成部分：</p><ul><li>表单标签：这里面包含了处理表单数据所用 CGI 程序的 URL 以及数据提交到服务器的方法。</li><li>表单域：包含了文本框、密码框、隐藏域、多行文本框、复选框、单选框、下拉选择框和文件上传框等。</li><li>表单按钮：包括提交按钮、复位按钮和一般按钮；用于将数据传送到服务器上的 CGI 脚本或者取消输入，还可以用表单按钮来控制其他定义了处理脚本的处理工作。</li></ul><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      
        <tags>
            
            <tag> js </tag>
            
            <tag> jQuery </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>jquery学习</title>
      <link href="2021/12/30/jquery%E5%AD%A6%E4%B9%A0/"/>
      <url>2021/12/30/jquery%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>虽然有很多人说jquery不太常用了,但还是有必要掌握一些基本的知识的<br><span id="more"></span></p><h2 id="介绍jQuery"><a href="#介绍jQuery" class="headerlink" title="介绍jQuery"></a>介绍jQuery</h2><p>jQuery 是开源软件，使用 MIT 许可证授权。jQuery 的语法设计使得许多操作变得容易，如操作文档对象（document）、选择文档对象模型（DOM）元素、创建动画效果、处理事件、以及开发 Ajax 程序。jQuery 也给开发人员提供了在其上创建插件的能力。这使开发人员可以对底层交互与动画、高级效果和高级主题化的组件进行抽象化。模块化的方式使 jQuery 函数库能够创建功能强大的动态网页以及网络应用程序。</p><h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><ol><li>从官网下载,在本地导入 也可以直接使用npm或者yarn,brower等下载</li><li>从CDN中载入</li></ol><h2 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h2><p>基本就是通过某种选择规则选择某些元素然后对这些元素执行某些操作.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$(selector).action()</span><br></pre></td></tr></table></figure><h3 id="文档就绪事件"><a href="#文档就绪事件" class="headerlink" title="文档就绪事件"></a>文档就绪事件</h3><p>为了防止jquery在html加载之前才开始执行,也就是当html加载后执行jquery.</p><p>选择器以$()开始</p><h3 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h3><p><img data-src="http://cdn.sekyoro.top/imgs/092957.png" alt="image-20211230151703453"></p><p>选择器采用css类型</p><h2 id="事件"><a href="#事件" class="headerlink" title="事件"></a>事件</h2><p>页面对不同访问者的响应叫做事件。</p><p>事件处理程序指的是当 HTML 中发生某些事件时所调用的方法。</p><p><img data-src="http://cdn.sekyoro.top/imgs/092959.png" alt="image-20211230152902896"></p><h3 id="事件绑定"><a href="#事件绑定" class="headerlink" title="事件绑定"></a>事件绑定</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">on()     向元素添加事件处理程序（<span class="string">`自 jQuery 版本 1.7 起，on() 方法是向被选元素添加事件处理程序的首选方法。`</span>）</span><br><span class="line">one()    向被选元素添加一个或多个事件处理程序。该处理程序只能被每个元素触发一次</span><br></pre></td></tr></table></figure><p>如需移除事件处理程序，请使用 <code>off()</code> 方法.</p><p>简写绑定事件</p><p>像 <code>click</code>，<code>mouseover</code> 和 <code>mouseout</code> 这类事件，经常会用到，jQuery 为此提供了一套简写的方法，使得能够减少代码量.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line">     $(<span class="built_in">document</span>).ready(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">       $(<span class="string">&#x27;ul li&#x27;</span>).click(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">         $(<span class="built_in">this</span>).clone().appendTo(<span class="string">&#x27;ul&#x27;</span>);</span><br><span class="line">       &#125;);</span><br><span class="line">     &#125;);</span><br><span class="line">   &lt;/script&gt;</span><br></pre></td></tr></table></figure><h3 id="合成事件"><a href="#合成事件" class="headerlink" title="合成事件"></a>合成事件</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$(selector).hover(infunction.outfunction)</span><br></pre></td></tr></table></figure><h3 id="事件冒泡"><a href="#事件冒泡" class="headerlink" title="事件冒泡"></a>事件冒泡</h3><p>当事件发生后，这个事件就要开始传播(从里到外或者从外向里)。为什么要传播呢？因为事件源本身（可能）并没有处理事件的能力，即处理事件的函数（方法）并未绑定在该事件源上。例如我们点击一个按钮时，就会产生一个 click 事件，但这个按钮本身可能不能处理这个事件，事件必须从这个按钮传播出去，从而到达能够处理这个事件的代码中（例如我们给按钮的 onclick 属性赋一个函数的名字，就是让这个函数去处理该按钮的 click 事件），或者按钮的父级绑定有事件函数，当该点击事件发生在按钮上，按钮本身并无处理事件函数，则传播到父级去处理。</p><p>有时需要阻止事件冒泡.</p><p>在 jQuery 中提供了 <code>event.stopPropagation()</code> 方法来停止冒泡</p><p>阻止默认行为：网页中的元素都有自己默认的行为。比如单击超链接后会跳转，单击“提交”按钮后表单会提交，有时候我们需要阻止元素的默认行为。在 jQuery 中提供了 <code>event.preventDefault()</code> 方法阻止元素发生默认的行为。使用 <code>event.isDefaultPrevented()</code> 方法来检查指定的事件上是否调用了 <code>preventDefault()</code> 方法</p><h4 id="事件对象的属性"><a href="#事件对象的属性" class="headerlink" title="事件对象的属性"></a>事件对象的属性</h4><ol><li><p>event.type</p></li><li><p>event.stopPropagation</p></li><li><p>event.preventDefault</p></li><li><p>event.target</p></li><li><p>event.pageX event.pageY</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line">    $(<span class="built_in">document</span>).ready(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      $(<span class="built_in">document</span>).mousemove(<span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span><br><span class="line">        $(<span class="string">&#x27;span&#x27;</span>).text(<span class="string">&#x27;X: &#x27;</span> + event.pageX + <span class="string">&#x27;, Y: &#x27;</span> + event.pageY);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &lt;/script&gt;</span><br></pre></td></tr></table></figure><h3 id="模拟操作"><a href="#模拟操作" class="headerlink" title="模拟操作"></a>模拟操作</h3><p>在 jQuery 中，可以使用 <code>trigger()</code> 方法来完成模拟操作</p></li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$(selector).trigger(event,param1,param2,...)</span><br></pre></td></tr></table></figure><p>还可以触发自定义事件</p><p>先在某对象上on或one定义一个事件,然后去trigger触发.</p><h4 id="传递数据"><a href="#传递数据" class="headerlink" title="传递数据"></a>传递数据</h4><p><code>trigger(type,[data])</code> 方法有两个参数，第 1 个参数是要触发的事件类型，第 2 个参数是要传递给处理函数的附加数据，以数组形式传递。通常可以传递一个参数给回调函数来区别这次事件是代码触发的还是用户触发的</p><h4 id="执行默认操作"><a href="#执行默认操作" class="headerlink" title="执行默认操作"></a>执行默认操作</h4><p><code>trigger()</code> 方法触发事件后，会执行浏览器默认操作。例如：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&#x27;input&#x27;</span>).trigger(<span class="string">&#x27;focus&#x27;</span>);</span><br></pre></td></tr></table></figure><p>以上代码不仅会触发为 input 元素绑定的 foucs 事件，也会使 input 元素本身得到焦点（浏览器的默认操作）。如果我们只想触发绑定的 focus 事件，而不想执行浏览器默认操作，我们可以使用 <code>triggerHandler()</code> 方法。它们之间的不同之处有：</p><ul><li><code>triggerHandler()</code> 不触发事件的默认行为。（比如表单提交）</li><li><code>.trigger()</code> 会操作 jQuery 对象匹配的所有元素，而 <code>.triggerHandler()</code> 只影响第一个匹配元素。</li><li>由 <code>.triggerHandler()</code> 创建的事件不会在 DOM 树中冒泡；如果目标元素不直接处理它们，则不会发生任何事情。</li></ul><h3 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h3><p>jQuery对象与DOM对象</p><p>前者是利用jQuery方式选择出来的对象,后者是原生js getDocumentBy..这种得到的.</p><p>两者的相互转换通过[0]与$().</p><p>值得一提的是$()这个东西.就是一个jQuery对象制造工厂.</p><h3 id="避免冲突"><a href="#避免冲突" class="headerlink" title="避免冲突"></a>避免冲突</h3><p>$这个符号容易与其他库的符号冲突.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$.noConflict()</span><br></pre></td></tr></table></figure><p>然后使用jQuery()代替即可.</p><p>也可以进行赋值 </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> jq = $.noConflict();</span><br><span class="line">jq();</span><br></pre></td></tr></table></figure><h2 id="选择器"><a href="#选择器" class="headerlink" title="选择器"></a>选择器</h2><p>需要注意使用jQuery选择器不能使用</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>($(<span class="string">&#x27;selector&#x27;</span>))</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//do something</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这种方式判断.</p><p>而应该根据获取到元素的长度来判断，代码如下所示：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ($(<span class="string">&#x27;#syl&#x27;</span>).length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>或者转化成 DOM 对象来判断，代码如下：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ($(<span class="string">&#x27;#syl&#x27;</span>)[<span class="number">0</span>]) &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="基本选择器"><a href="#基本选择器" class="headerlink" title="基本选择器"></a>基本选择器</h3><p>通过class id tag</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&#x27;#&#x27;</span>)  $(<span class="string">&#x27;.&#x27;</span>)  $(<span class="string">&#x27;tagname&#x27;</span>)</span><br></pre></td></tr></table></figure><p>调用 jQuery() (或 $()) 带上一个选择器作为它的参数，将返回一个 jQuery 对象包含零个或一个 DOM 元素的集合.</p><p>每个 id 值在一个文件中只能使用一次。如果多个元素分配了相同的 ID，将只匹配该 ID 选择集合的第一个 DOM 元素。但这种行为不应该发生;有超过一个元素的文件使用相同的 ID 是无效的。</p><p>如果 ID 包含点号或冒号,必须将这些字符用反斜杠转义</p><p>当然也可以使用$(‘*’)选择所有.</p><p>多选 $(‘selector1,selector2,…’)</p><h3 id="层次选择器"><a href="#层次选择器" class="headerlink" title="层次选择器"></a>层次选择器</h3><ol><li>选择一个元素下的所有元素</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&#x27;ancestor descendant&#x27;</span>)</span><br></pre></td></tr></table></figure><ol><li>选择直接子元素</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&#x27;ancesotr &gt; child&#x27;</span>)</span><br></pre></td></tr></table></figure><ol><li>选择在某元素后的同级别的元素</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&#x27;prev + next&#x27;</span>)</span><br></pre></td></tr></table></figure><p><strong>只能选择第一个</strong></p><ol><li><p>选择同级元素之后的所有元素</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(<span class="string">&quot;prev ~ siblings&quot;</span>)</span><br></pre></td></tr></table></figure><p>匹配 “prev” 元素之后的所有 兄弟元素。具有相同的父元素，并匹配过滤“siblings”选择器</p></li></ol><p><strong>提示</strong>:在层次选择器中，第 1 个和第 2 个选择器比较常用，而后面两个因为在 jQuery 里面可以用更加简单的方法来代替，所以使用的几率相对会少些：</p><ul><li>可以使用 next() 方法来代替 $(‘prev+next’) 选择器。比如 <code>$(&quot;.one + div);</code> 和 <code>$(&quot;.one&quot;).next(&quot;div&quot;);</code> 是等价的。</li><li>可以使用 nextAll() 方法来代替 $(‘prev~siblings’) 选择器。比如 <code>$(&quot;#prev~div&quot;);</code>和<code>$(&quot;#prev&quot;).nextAll(&quot;div&quot;);</code> 是等价的。</li></ul><p>知道了next()以及nextAll()方法再说一下siblings()</p><p><code>$(&quot;#prev~div&quot;);</code> 选择器只能选择 “prev” 元素后面的同辈 div 元素，而 siblings() 方法与前后位置无关，只要是同辈节点都能匹配</p><h3 id="表单选择器"><a href="#表单选择器" class="headerlink" title="表单选择器"></a>表单选择器</h3><p>这个是比较重要的</p><ul><li>:input 选取所有的 <code>&lt;input&gt; 、&lt;textarea&gt;、&lt;select&gt; &lt;button&gt;</code>元素。</li><li>:text 选取所有的单行文本框。</li><li>:password 选取所有的密码框</li><li>:radio 选取所有的单选框</li><li>:checkbox 选取所有的多选框</li><li>:submit 选取所有的提交按钮</li><li>:image 选取所有的图像</li><li>:reset 选取所有的重置按钮</li><li>:button 选取所有的按钮</li><li>:file 选取所有的上传域</li><li>:hidden 选取所有不可见元素</li></ul><h3 id="过滤选择器"><a href="#过滤选择器" class="headerlink" title="过滤选择器"></a>过滤选择器</h3><h4 id="基本过滤选择器"><a href="#基本过滤选择器" class="headerlink" title="基本过滤选择器"></a>基本过滤选择器</h4><h4 id="内容过滤选择器"><a href="#内容过滤选择器" class="headerlink" title="内容过滤选择器"></a>内容过滤选择器</h4><h4 id="可见性过滤选择器"><a href="#可见性过滤选择器" class="headerlink" title="可见性过滤选择器"></a>可见性过滤选择器</h4><h4 id="属性过滤选择器"><a href="#属性过滤选择器" class="headerlink" title="属性过滤选择器"></a>属性过滤选择器</h4><h4 id="子元素过滤选择器"><a href="#子元素过滤选择器" class="headerlink" title="子元素过滤选择器"></a>子元素过滤选择器</h4><h4 id="表单对象属性过滤选择器"><a href="#表单对象属性过滤选择器" class="headerlink" title="表单对象属性过滤选择器"></a>表单对象属性过滤选择器</h4><p>这一部分直接看文档吧,太多了,没必要去记.这跟css选择器一样的.</p><h2 id="DOM操作"><a href="#DOM操作" class="headerlink" title="DOM操作"></a>DOM操作</h2><h4 id="查找结点"><a href="#查找结点" class="headerlink" title="查找结点"></a>查找结点</h4><p>文本</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> $li = $(<span class="string">&#x27;ol li:eq(0)&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> li_text = $li.text();</span><br></pre></td></tr></table></figure><p>属性</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> $para = $(<span class="string">&#x27;p&#x27;</span>); <span class="comment">//获取&lt;p&gt;节点 </span></span><br><span class="line"><span class="keyword">var</span> p_txt = $para.attr(<span class="string">&#x27;title&#x27;</span>); <span class="comment">//获取&lt;p&gt;元素节点属性title </span></span><br><span class="line">alert(p_txt); <span class="comment">//打印title属性值</span></span><br></pre></td></tr></table></figure><h3 id="创建节点"><a href="#创建节点" class="headerlink" title="创建节点"></a>创建节点</h3><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="symbol">$li</span> = $(<span class="string">&#x27;&lt;li&gt;&lt;/li&gt;&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> <span class="symbol">$li</span> = $(<span class="string">&#x27;&lt;li&gt;test&lt;/li&gt;&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> <span class="symbol">$li</span> = $(<span class="string">&quot;&lt;li title=&#x27;test&#x27;&gt;Hello&lt;/li&gt;&quot;</span>)</span><br></pre></td></tr></table></figure><p>然后使用append()</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&#x27;selector&#x27;</span>).append($li)</span><br></pre></td></tr></table></figure><h4 id="插入"><a href="#插入" class="headerlink" title="插入"></a>插入</h4><ul><li><code>.append()</code> 在每个匹配元素里面的末尾处插入参数内容。</li><li><code>.appendTo()</code> 将匹配的元素插入到目标元素的最后面。</li><li><code>.html()</code> 获取集合中第一个匹配元素的 HTML 内容 设置每一个匹配元素的 html 内容。</li><li><code>.prepend()</code> 将参数内容插入到每个匹配元素的前面（元素内部）。</li><li><code>.prependTo()</code> 将所有元素插入到目标前面（元素内）。</li><li><code>.text()</code> 得到匹配元素集合中每个元素的合并文本，包括他们的后代设置匹配元素集合中每个元素的文本内容为指定的文本内容。</li></ul><ul><li><code>.after()</code> 在匹配元素集合中的每个元素后面插入参数所指定的内容，作为其兄弟节点。</li><li><code>.before()</code> 根据参数设定，在匹配元素的前面插入内容。</li><li><code>.insertAfter()</code> 在目标元素后面插入集合中每个匹配的元素(注：插入的元素作为目标元素的兄弟元素)。</li><li><code>.insertBefore()</code> 在目标元素前面插入集合中每个匹配的元素(注：插入的元素作为目标元素的兄弟元素)。</li></ul><h3 id="删除节点"><a href="#删除节点" class="headerlink" title="删除节点"></a>删除节点</h3><ol><li><p>detach()</p></li><li><p>empty()</p></li><li>remove()</li></ol><p>一般使用remove,如果后面还要加上去就detach()</p><h3 id="复制节点"><a href="#复制节点" class="headerlink" title="复制节点"></a>复制节点</h3><p>clone() 如果传递了参数true,复制元素时同时复制所绑定的元素</p><h4 id="替换节点"><a href="#替换节点" class="headerlink" title="替换节点"></a>替换节点</h4><p>.replaceAll()  集合的匹配元素替换每个目标元素</p><p>.replaceWith() 用提供的内容替换集合中所有匹配的元素并且返回被删除元素的集合</p><h4 id="包裹节点"><a href="#包裹节点" class="headerlink" title="包裹节点"></a>包裹节点</h4><p>.wrap()</p><p>每个匹配的元素外层包上一个 html 元素。<code>.wrap()</code> 函数可以接受任何字符串或对象，可以传递给 $() 工厂函数来指定一个 DOM 结构。这种结构可以嵌套了好几层深，但应该只包含一个核心的元素。每个匹配的元素都会被这种结构包裹。该方法返回原始的元素集，以便之后使用链式方法</p><p>.wrapAll()</p><p>该元素会将所有匹配的元素用一个元素来包裹，它不同于 <code>wrap()</code> 方法，<code>wrap()</code> 方法是将所有的元素进行单独的包裹。</p><p>.wrapInner()</p><h4 id="属性操作"><a href="#属性操作" class="headerlink" title="属性操作"></a>属性操作</h4><p><code>attr()</code> 方法用来获取和设置元素的属性，<code>removeAttr()</code> 方法用来删除元素属性</p><p>设置元素属性</p><p>如果需要设置元素的属性值，也可以使用 <code>attr()</code> 方法，不同的是，需要传递两个参数即属性名称和对应的值</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="built_in">document</span>).ready(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        $(<span class="string">&#x27;div&#x27;</span>).attr(<span class="string">&#x27;class&#x27;</span>, <span class="string">&#x27;demo&#x27;</span>);</span><br><span class="line">      &#125;);</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&#x27;div&#x27;</span>).attr(&#123; <span class="attr">class</span>: <span class="string">&#x27;demo&#x27;</span>, <span class="attr">name</span>: <span class="string">&#x27;test&#x27;</span> &#125;); <span class="comment">//将一个 “名/值” 形式的对象设置为匹配元素的属性</span></span><br></pre></td></tr></table></figure><p>删除属性</p><p>removeAttr();</p><h3 id="样式操作"><a href="#样式操作" class="headerlink" title="样式操作"></a>样式操作</h3><p>attr()增加/替换属性</p><p>addClass()增加类的值</p><p>removeClass()</p><p>toggleClass()切换样式</p><p><code>.toggleClass()</code> 在匹配的元素集合中的每个元素上添加或删除一个或多个样式类,取决于这个样式类是否存在或值切换属性。即：如果存在（不存在）就删除（添加）一个类</p><p><code>.hasClass()</code> 可以用来判断元素中是否含有某个 class，如果有则返回 true，否则返回 false</p><h3 id="获取文本内容"><a href="#获取文本内容" class="headerlink" title="获取文本内容"></a>获取文本内容</h3><ol><li>html()</li></ol><p>获取元素的内容.</p><p>获取集合中第一个匹配元素的 HTML 内容 或 设置每一个匹配元素的 html 内容。类似于我们原生 JavaScript 中的 <code>innerHTML</code> 属性。</p><ol><li>text()</li></ol><p><code>.text()</code> 得到匹配元素集合中每个元素的文本内容结合，包括他们的后代，或设置匹配元素集合中每个元素的文本内容为指定的文本内容。类似于 JavaScript 中的 <code>innerText</code> 属性</p><p>3.val()</p><p><code>.val()</code> 获取匹配的元素集合中第一个元素的当前值或设置匹配的元素集合中每个元素的值。类似于 JavaScript 中的 <code>value</code> 属性。<code>.val()</code> 方法主要用于获取表单元素的值，比如 input, select 和 textarea。对于 <code>&lt;select multiple=&quot;multiple&quot;&gt;</code> 元素, <code>.val()</code> 方法返回一个包含每个选择项的数组，如果没有选择性被选中，它返回 null</p><h3 id="遍历节点"><a href="#遍历节点" class="headerlink" title="遍历节点"></a>遍历节点</h3><p>.children()</p><p>获得匹配元素集合中每个元素的每个子元素,选择器选择性筛选.</p><p>.next()</p><p>取得匹配的元素集合中每一个元素紧邻的后面同辈元素的元素集合。如果提供一个选择器，那么只有紧跟着的兄弟元素满足选择器时，才会返回此元素。</p><p>.prev()</p><p>取得一个包含匹配的元素集合中每一个元素紧邻的前一个同辈元素的元素集合。选择性筛选的选择器</p><p>.siblings()</p><p>获得匹配元素集合中每个元素的兄弟元素,可以提供一个可选的选择器。</p><p>.parents()</p><p>取得匹配元素集合中，每个元素的父元素，可以提供一个可选的选择器。</p><p>如果提供的 jQuery 代表了一组 DOM 元素，<code>.parent()</code> 方法允许我们能够在 DOM 树中搜索到这些元素的父级元素，从有序的向上匹配元素，并根据匹配的元素创建一个新的 jQuery 对象。</p><ul><li><code>closest()</code> 方法从元素本身开始，逐级向上级元素匹配，并返回最先匹配的祖先元素。也就是说首先检查当前元素是否匹配，如果匹配则直接返回元素本身，如果不匹配则向上查找父级元素，逐级向上直到找到匹配选择器的元素，如果什么都没找到则返回一个空的 jQuery 对象。</li><li><code>parents()</code> 获得集合中每个匹配元素的祖先元素。查找方式和 <code>parent()</code> 方法类似，不同点在于，当它找到第一个父节点时并没有停止查找，而是继续查找，最后返回多个父节点</li></ul><h3 id="css的dom操作"><a href="#css的dom操作" class="headerlink" title="css的dom操作"></a>css的dom操作</h3><ol><li>css()</li></ol><p>获取匹配元素集合中的第一个元素的样式属性的值或设置每个匹配元素的一个或多个 CSS 属性。</p><p>2.height() width()</p><ul><li><code>.height()</code> 获取匹配元素集合中的第一个元素的当前计算高度值 或 设置每一个匹配元素的高度值。</li><li><code>.width()</code> 为匹配的元素集合中获取第一个元素的当前计算宽度值 或 给每个匹配的元素设置宽度</li></ul><p>3.元素定位</p><p><code>offset()</code> 方法，在匹配的元素集合中，获取的第一个元素的当前坐标，或设置每一个元素的坐标，坐标相对于文档。这个方法不接受任何参数。<code>.offset()</code> 方法允许我们检索一个元素相对于文档（document）的当前位置。和 <code>.position()</code> 的差别在于：<code>.position()</code> 是相对于相对于父级元素的位移。当通过全局操作（特别是通过拖拽操作）将一个新的元素放置到另一个已经存在的元素的上面时，若要取得这个新的元素的位置，那么使用 <code>.offset()</code> 更合适。<code>.offset()</code> 返回一个包含 top 和 left 属性的对象</p><ul><li><code>position()</code> 方法，获取匹配元素中第一个元素的当前坐标，相对于 offset parent 的坐标。(offset parent 指离该元素最近的而且被定位过的祖先元素 ) <code>.position()</code> 方法可以取得元素相对于父元素的偏移位置。与 <code>.offset()</code> 不同, <code>.offset()</code> 是获得该元素相对于 documet 的当前坐标 当把一个新元素放在同一个容器里面另一个元素附近时，用 <code>.position()</code> 更好用。<code>.position()</code>返回一个包含 top 和 left 属性的对象。</li></ul><p>scrollTop与scrollLeft获取元素的滚动条距顶端及左侧的距离.</p><h2 id="动画"><a href="#动画" class="headerlink" title="动画"></a>动画</h2><ol><li><p>show()</p></li><li><p>hide()</p></li></ol><p>参数一般是speed,easing,callback</p><p>fadeIn和fadeOut</p><p>slideUp和slideDown</p><p>animate()方法  实现自定义动画</p><p><code>animate()</code> 方法，用来实现自定义动画。该方法通过 CSS 样式将元素从一个状态改变为另一个状态。CSS 属性值是逐渐改变的，这样就可以创建动画效果。只有数字值可创建动画（比如 <code>&quot;margin:30px&quot;</code>）。字符串值无法创建动画（比如 <code>&quot;background-color:red&quot;</code>）。</p><p>提示：请使用 “+=” 或 “-=” 来创建相对动画。</p><h3 id="停止动画"><a href="#停止动画" class="headerlink" title="停止动画"></a>停止动画</h3><p>jQuery <code>stop()</code> 方法用于在动画或效果完成前对它们进行停止。<code>stop()</code> 方法适用于所有 jQuery 效果函数，包括滑动、淡入淡出和自定义动画</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$(selector).stop([clearQueue] [,jumpToEnd])</span><br></pre></td></tr></table></figure><p>参数说明：</p><ul><li>clearQueue 参数，可选值，规定是否应该清除动画队列。默认是 false，即仅停止活动的动画，允许任何排入队列的动画向后执行。</li><li>jumpToEnd 参数，可选值，规定是否立即完成当前动画。默认是 false。</li></ul><p>判断元素是否处于动画状态</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!$(element).is(<span class="string">&#x27;:animated&#x27;</span>)) &#123;</span><br><span class="line">  <span class="comment">//判断元素是否处于动画状态</span></span><br><span class="line">  <span class="comment">//如果当前没有进行动画，则添加新动画</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>toggle()</code> 方法：<code>hide()</code> 和 <code>show()</code> 方法之间的切换。</li><li><code>slideToggle()</code> 方法：<code>slideUp()</code> 和 <code>slideDown()</code> 方法之间的切换。</li><li><code>fadeToggle()</code> 方法：在 <code>fadeIn()</code> 和 <code>fadeOut()</code> 方法之间进行切换。</li><li><code>fadeTo()</code> 方法：把被选元素逐渐改变至给定的不透明度</li></ul><p>参考资料</p><p><a href="https://zhuanlan.zhihu.com/p/40739079">再见 jQuery，我的老朋友 - 知乎 (zhihu.com)</a></p><p><a href="https://www.runoob.com/jquery">菜鸟教程</a></p><p><a href="https://www.jquery123.com/">jQuery API 中文文档 | jQuery 中文网 (jquery123.com)</a></p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      
        <tags>
            
            <tag> js </tag>
            
            <tag> jQuery </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用七牛云为网站提供服务</title>
      <link href="2021/12/29/%E4%BD%BF%E7%94%A8%E4%B8%83%E7%89%9B%E4%BA%91%E4%B8%BA%E7%BD%91%E7%AB%99%E6%8F%90%E4%BE%9B%E6%9C%8D%E5%8A%A1/"/>
      <url>2021/12/29/%E4%BD%BF%E7%94%A8%E4%B8%83%E7%89%9B%E4%BA%91%E4%B8%BA%E7%BD%91%E7%AB%99%E6%8F%90%E4%BE%9B%E6%9C%8D%E5%8A%A1/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>像使用hexo这种静态网站需要解决提供文件下载连接的问题.<br>可以直接使用百度网盘链接或者把文件放在本地文件夹下静态链接.<br>现在介绍一下用七牛云服务提供文件下载链接,当然,其实还有很多其他服务.<br><span id="more"></span></p><h2 id="七牛云介绍"><a href="#七牛云介绍" class="headerlink" title="七牛云介绍"></a>七牛云介绍</h2><p>国内知名的云计算及数据服务提供商，主要提供的是现在网络上占据百分之九十的非结构化数据，也就是图片、音频、视频的云存储服务，其计费方式是按使用量计费，大大降低了一个项目的前期投入成本.(搜的)</p><p>根据我的理解,可以提供存储空间,把文件上传到它提供的空间里并提供URL供用户下载.</p><h2 id="操作"><a href="#操作" class="headerlink" title="操作"></a>操作</h2><p>先进行注册,可以是实名一下有一些优惠.</p><p>进入页面 <a href="https://portal.qiniu.com/kodo/overview">七牛云 - 对象存储 </a></p><p><img data-src="http://cdn.sekyoro.top/imgs/093632.png" alt="image-20211229110505371"></p><p>新建空间,因为针对的是hexo部署的静态网站,并且有个域名.这个域名可以不用备案,当然备案了权力更多.</p><p>访问控制选公开,地区看个人选择了,如果未备案的域名可能智能选国外了.</p><p><img data-src="http://cdn.sekyoro.top/imgs/093633.png" alt="image-20211229110803898"></p><p>然后设置CDN加速域名,这里是重点. </p><p>e.g 本站域名sekyoro.com 如果设置sekyoro.com后面解析记录如果配@或者www,就会使得原本的内容解析出问题.</p><p><img data-src="http://cdn.sekyoro.top/imgs/093639.png" alt="image-20211229111003117"></p><p>可以参考一下解决方案,因为我们这里主要解决存储问题而不是CDN加速,所以参考方法1,绑定cdn.sekyoro.com(即使用二级域名)</p><p>cdn就这样配置</p><p><img data-src="http://cdn.sekyoro.top/imgs/093642.png" alt="image-20211229111100382"></p><p>然后得到cname,去域名购买商那配置,我在腾讯云买的,进入页面添加记录即可<a href="https://console.cloud.tencent.com/cns/detail/sekyoro.top/records/0">腾讯云-控制台 </a></p><p><img data-src="http://cdn.sekyoro.top/imgs/065637.png" alt="image-20211229111154247"></p><p>然后状态显示成功,大功告成.</p><p><img data-src="http://cdn.sekyoro.top/imgs/093646.png" alt="image-20211229111307792"></p><p>接着选择上传文件,上传文件后,获得url直接使用即可</p><p><img data-src="http://cdn.sekyoro.top/imgs/093650.png" alt="image-20211229111336410"></p><p>另外值得一提的是,如果要实现为网站上的访问者提供下载链接而又不想使用百度网盘(下载速度还是慢),除了直接静态链接,即把文件放本地,然后在markdown里写链接,也可以直接用其他的方法获取外链.详情见参考资料里的直链文件下载。</p><h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><p><a href="https://developer.qiniu.com/fusion/kb/1322/how-to-configure-cname-domain-name">如何配置域名的 CNAME - 七牛开发者中心 (qiniu.com)</a></p><p><a href="https://zhuanlan.zhihu.com/p/174869373">分享二十一个直链文件上传下载网站 - 知乎 (zhihu.com)</a></p><p><a href="https://zhuanlan.zhihu.com/p/120045153">一个神奇的储存空间 - 七牛云 - 知乎 (zhihu.com)</a></p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      
        <tags>
            
            <tag> 七牛云 </tag>
            
            <tag> 存储 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>为网站申请ssl证书</title>
      <link href="2021/12/25/%E4%B8%BA%E7%BD%91%E7%AB%99%E7%94%B3%E8%AF%B7ssl%E8%AF%81%E4%B9%A6/"/>
      <url>2021/12/25/%E4%B8%BA%E7%BD%91%E7%AB%99%E7%94%B3%E8%AF%B7ssl%E8%AF%81%E4%B9%A6/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>为了HTTPS！<br><span id="more"></span></p><p>之前买了阿里云的服务器,装上了宝塔面板,用了Let’s Encrypt,结果发现这个证书chrome以及Edge(虽然现在这俩货差别也不大了)都提示不安全,虽然不影响使用,作为略微的强迫症,这怎么行呢?</p><p><img data-src="http://cdn.sekyoro.top/imgs/065235.png" alt="image-20211225161439564"></p><p>所以既然买的是阿里云服务器,就要使用相关服务,用其他的免费的证书.</p><p>按照操作就行,官网也有相关操作步骤,这里排一下坑.</p><ol><li>首先直接进入证书页面,<a href="https://yundun.console.aliyun.com/?spm=a2c6h.12873639.0.0.6a3e45f8L2tMag&amp;&amp;p=cas#/overview/">证书页面</a></li></ol><p>点击SSL证书,申请<strong>免费</strong>证书</p><p><img data-src="http://cdn.sekyoro.top/imgs/093000.png" alt="image-20211225161934312"></p><ol><li><p>点击免费证书后,有立即购买和创建证书.先购买在创建.我搞不懂反正是免费的为啥叫购买..</p></li><li><p>因为我已经创建了,所以是19/20.我买的也是20(当然是免费的).</p><p><img data-src="http://cdn.sekyoro.top/imgs/093001.png" alt="image-20211225162033468"></p></li></ol><p>这个免费证书名字叫DigCert,点击申请,填写相关信息即可</p><p><img data-src="http://cdn.sekyoro.top/imgs/065237.png" alt="image-20211225162214803"></p><p>4.选择DNS验证,当然其他验证都行</p><p><img data-src="http://cdn.sekyoro.top/imgs/093003.png" alt="image-20211225162311254"></p><p>DNS验证需要到域名服务商那修改记录值,我在腾讯云买的域名,在那修改信息</p><p>按照它给的信息就行了,我就不细说.</p><p>然后就是重点了.</p><p>验证通过后就是部署,也就是部署到服务器上,点击部署,进入页面,选择自己的服务器</p><p><img data-src="http://cdn.sekyoro.top/imgs/065241.png" alt="image-20211225162534349"></p><p><img data-src="http://cdn.sekyoro.top/imgs/093004.png" alt="image-20211225162651376"></p><p>5.然后点击返回点击下载证书,根据服务器选择.</p><p><img data-src="http://cdn.sekyoro.top/imgs/093006.png" alt="image-20211225162739215"></p><p>下载后解压,上传到一个文件夹</p><p>接下来就按照教程,找到nginx修改文件,我安装了面板,通过面板安装的nginx所以路径可能不太一样</p><p><img data-src="http://cdn.sekyoro.top/imgs/065244.png" alt="image-20211225164126001"></p><p>修改这个文件,按照一定格式. 根据英文就知道 ssl_certificate是key,另一个是pem</p><p>为什么这里要用两对呢?因为一个是宝塔面板的那个免费但是不安全的ssl,我没有改,但也可以改,后面再说.</p><p>第二对的key和pem值就是刚才上传文件的路径,这里要强调一下,这里的相对路径并不是该conf文件所在的路径.</p><p>而是从<img data-src="http://cdn.sekyoro.top/imgs/065245.png" alt="image-20211225170821065">这里开始的.至少我是这样的.</p><p><img data-src="http://cdn.sekyoro.top/imgs/065246.png" alt="image-20211225165247561"></p><p>再重启nginx,这样事实上就行了</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nginx -s reload  #重新载入配置文件。</span><br></pre></td></tr></table></figure><p>这里再说一下另一种简单的,就是不用上传证书文件,利用面板修改key和pem.</p><p>打开面板,打开网站相应的设置,找到ssl项.其实有提示的,将之前那两个文件的内容复制到对应的框中.</p><p><img data-src="http://cdn.sekyoro.top/imgs/065248.png" alt="image-20211225171121320"></p><p>这里不细说了,粘贴到对应框里即可.</p><p><img data-src="http://cdn.sekyoro.top/imgs/065249.png" alt="image-20211225171555456"></p><p>注意,这样有可能页面还是显示不安全,很可能是网页本身URL的问题.</p><p>比如我用的wordpress,一开始在建站的时候用的http的url,就显示不安全,鉴于现在都是用的HTTPS,所以改为https即可.</p><p>在面板也可以勾选强制使用HTTPS.</p><p>解决问题.</p><p><img data-src="http://cdn.sekyoro.top/imgs/065250.png" alt="image-20211225171801016"></p><h3 id="References"><a href="#References" class="headerlink" title="References"></a>References</h3><p><a href="https://developer.aliyun.com/article/766913">2020阿里云免费SSL证书申请方法流程（图文教程）-阿里云开发者社区 (aliyun.com)</a></p><p><a href="https://help.aliyun.com/document_detail/98728.htm?spm=a2c4g.11186623.0.0.3588158ezGruBf#concept-n45-21x-yfb">在Nginx（或Tengine）服务器上安装证书 (aliyun.com)</a></p><p><a href="https://oneinstack.com/question/lets-encrypt-the-generated-certificate-chrome-tip-is-not-safe/">Let’s Encrypt 生成的证书，Chrome提示不安全。 - OneinStack</a></p><p><a href="https://blog.csdn.net/colorfulyan/article/details/108346890">(宝塔面板SSL证书显示不安全？这里我教你宝塔SSL证书如何配置及开启HTTPS访问的操作方法<em>colorfulyan的博客-CSDN博客</em>宝塔https不安全</a></p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      
        <tags>
            
            <tag> SSL </tag>
            
            <tag> 建站 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>js爬虫</title>
      <link href="2021/12/14/js%E7%88%AC%E8%99%AB/"/>
      <url>2021/12/14/js%E7%88%AC%E8%99%AB/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>之前都是用的python爬虫,现在想往web方向发展.<br>话不多说,nodejs的superagent+cheerio<br><span id="more"></span></p><p>nodejs是js的环境,除此之外还有浏览器,但我们肯定不在浏览器上嘛.</p><p>superagent拿来爬取,在这之前我也尝试过axios,request,事实证明superagent很好用.</p><p>cheerio拿来处理爬取到的数据,主要就是html.</p><p>目的是某末流二本的教务系统.</p><p>我最终目的是获得课程信息以及空闲教室信息.</p><h2 id="1-superagent爬取"><a href="#1-superagent爬取" class="headerlink" title="1.superagent爬取"></a>1.superagent爬取</h2><p>首先需要登录.</p><p>结合多次尝试,获得了的登录url <a href="http://us.nwpu.edu.cn/eams/login.action">http://us.nwpu.edu.cn/eams/login.action</a></p><p>根据末尾很容易知道需要往这个url发送post,话不多说直接构造post</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">uid = <span class="string">&#x27;&#x27;</span>; <span class="comment">//学号</span></span><br><span class="line">pwd = <span class="string">&#x27;&#x27;</span>; <span class="comment">//密码</span></span><br><span class="line">superagent</span><br><span class="line">.post(login_url)</span><br><span class="line">.type(<span class="string">&#x27;form&#x27;</span>) <span class="comment">//这个type表示是application/x-www-form-urlencoded  </span></span><br><span class="line">.send(&#123;<span class="attr">username</span>:uid,<span class="attr">password</span>:pwd&#125;) <span class="comment">//form的数据  post肯定需要的</span></span><br><span class="line">.end(<span class="function"><span class="keyword">function</span>(<span class="params">err,res</span>)</span>&#123;</span><br><span class="line">  <span class="comment">//do somesthing</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>至于为什么类型是application/x-www-form-urlencoded,当然是抓取到的,</p><p><img data-src="http://cdn.sekyoro.top/imgs/065254.png" alt="image-20211214220056824"></p><p>经典登录界面,我们猜到了点击登陆之后就会发送一个post.</p><p><img data-src="http://cdn.sekyoro.top/imgs/093024.png" alt="image-20211214220155928"></p><p><img data-src="http://cdn.sekyoro.top/imgs/093026.png" alt="image-20211214220250378"></p><p>然后就抓取到了报文,可以看到上面的content-type就是这个.</p><p>咳咳,暴露了一点个人信息.</p><p>接下来难点来了,这是个302重定向,重定向到了哪里呢?事实上可以看到有了location是home.action</p><p>我们就能找到了,其实无脑找找就能找到的,事实上我们使用superagent就能返回重定向的home.action的信息。</p><p>这下就登录了.其实并不难(一开始我使用的其他两个工具,重定向导致失败了,我就更换了第三方包)</p><p>然后就是重点,登录之后需要cookie,不然就没意义了.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>(<span class="params">err,res</span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(res);</span><br><span class="line">  <span class="keyword">var</span> cookieid = res.headers[<span class="string">&#x27;set-cookie&#x27;</span>][<span class="number">0</span>].split(<span class="string">&#x27;;&#x27;</span>)[<span class="number">0</span>].split(<span class="string">&#x27;=&#x27;</span>)[<span class="number">1</span>];</span><br><span class="line">  <span class="comment">// console.log(cookieid);</span></span><br><span class="line">  <span class="keyword">var</span> cookie = <span class="string">`semester.id=158; JSESSIONID=<span class="subst">$&#123;cookieid&#125;</span>; GSESSIONID=<span class="subst">$&#123;cookieid&#125;</span>`</span>;</span><br><span class="line">  superagent.post(info_url)</span><br><span class="line">  .type(<span class="string">&#x27;form&#x27;</span>)</span><br><span class="line">  .send(&#123;</span><br><span class="line">  <span class="attr">ignoreHead</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="string">&quot;setting.kind&quot;</span>: <span class="string">&quot;std&quot;</span>,</span><br><span class="line">  <span class="attr">startWeek</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="string">&quot;semester.id&quot;</span>: <span class="number">158</span>,</span><br><span class="line">  <span class="attr">ids</span>: <span class="number">248032</span></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>cookieid就是这个<img data-src="http://cdn.sekyoro.top/imgs/065259.png" alt="image-20211214220742435"></p><p>jsession与gsession是一样的,所以获得了一个之后,根据cookie设置就行了.注意格式就是上面这个图片的格式,我们可以直接复制下来,修改一下就行了.</p><p>为了获得课程信息,可以根据网页查看是哪个返回的请求,这里我查看的是coursetable.</p><p><img data-src="http://cdn.sekyoro.top/imgs/093027.png" alt="image-20211214220926672"></p><p>可以猜到参数的意思,后面两个是学期的信息,我们只需要修改startWeek就能修改周数查看那一周的课程了.</p><p>所以只要设置cookie,再send发送表单数据即可获取页面信息,然后还要进行处理,不然不太好看.处理我就不细说了,根据个人喜好,我就直接把课程名弄出来就行了,可以根据自己情况教室啥的都可以.</p><p>具体代码</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> superagent = <span class="built_in">require</span>(<span class="string">&quot;superagent&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> login_url = <span class="string">&quot;http://us.nwpu.edu.cn/eams/login.action&quot;</span>;</span><br><span class="line"><span class="keyword">var</span> info_url = <span class="string">&#x27;http://us.nwpu.edu.cn/eams/courseTableForStd!courseTable.action&#x27;</span>;</span><br><span class="line">uid = <span class="string">&quot;&quot;</span>;<span class="comment">//需要自己填写</span></span><br><span class="line">pwd = <span class="string">&quot;&quot;</span>;<span class="comment">//</span></span><br><span class="line">superagent</span><br><span class="line">.post(login_url)</span><br><span class="line">.type(<span class="string">&#x27;form&#x27;</span>)</span><br><span class="line">.send(&#123;<span class="attr">username</span>:uid,<span class="attr">password</span>:pwd&#125;)</span><br><span class="line">.end(<span class="function"><span class="keyword">function</span>(<span class="params">err,res</span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(res);</span><br><span class="line">  <span class="keyword">var</span> cookieid = res.headers[<span class="string">&#x27;set-cookie&#x27;</span>][<span class="number">0</span>].split(<span class="string">&#x27;;&#x27;</span>)[<span class="number">0</span>].split(<span class="string">&#x27;=&#x27;</span>)[<span class="number">1</span>];<span class="comment">//这一句写的并不好,我对于js的基础还是掌握不够.  这一句主要是想把cookie中的那段代码提取出来.</span></span><br><span class="line">  <span class="comment">// console.log(cookieid);</span></span><br><span class="line">  <span class="keyword">var</span> cookie = <span class="string">`semester.id=158; JSESSIONID=<span class="subst">$&#123;cookieid&#125;</span>; GSESSIONID=<span class="subst">$&#123;cookieid&#125;</span>`</span>;<span class="comment">//cookie</span></span><br><span class="line">  superagent.post(info_url)<span class="comment">//semester.id我不清楚是不是跟个人有关,可以自己抓一下看看.</span></span><br><span class="line">  .type(<span class="string">&#x27;form&#x27;</span>)</span><br><span class="line">  .send(&#123;</span><br><span class="line">  <span class="attr">ignoreHead</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="string">&quot;setting.kind&quot;</span>: <span class="string">&quot;std&quot;</span>,</span><br><span class="line">  <span class="attr">startWeek</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="string">&quot;semester.id&quot;</span>: <span class="number">158</span>,</span><br><span class="line">  <span class="attr">ids</span>: <span class="number">248032</span></span><br><span class="line">  &#125;)</span><br><span class="line">  .set(<span class="string">&quot;Cookie&quot;</span>,cookie)</span><br><span class="line">  .end(<span class="function"><span class="keyword">function</span>(<span class="params">err,res</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(res.statusCode == <span class="number">200</span>)</span><br><span class="line">      <span class="built_in">console</span>.log(res.text);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>最后就能得到页面的html</p><p>然后使用cheerio处理</p><h2 id="2-cheerio处理"><a href="#2-cheerio处理" class="headerlink" title="2.cheerio处理"></a>2.cheerio处理</h2><p>关于数据处理其实有很多方法,最后影响的是性能.</p><p>当你看了cheerio的文档,会感叹其的强大功能.</p><p>事实上我并没有太仔细地看相关用法,我直接使用了css选择器以及cheerio的一些简单用法.</p><p><img data-src="http://cdn.sekyoro.top/imgs/065300.png" alt="image-20211214225431353"></p><p>可以看到table id=”grid..”就是课程的信息,这里我直接使用css选择器基本可以解决问题(事实上很多时候我都在想选择的方法是不是太多了).</p><p>直接上代码.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> courses = [];</span><br><span class="line">          <span class="keyword">var</span> teachers = [];</span><br><span class="line">          <span class="keyword">var</span> weeks = [];</span><br><span class="line">          <span class="keyword">const</span> $ = cheerio.load(res.text);</span><br><span class="line">          $(<span class="string">&quot;tbody[id] tr td:nth-child(5)&quot;</span>).each(<span class="function"><span class="keyword">function</span> (<span class="params">i,elem</span>) </span>&#123;</span><br><span class="line">            teachers[i] = $(<span class="built_in">this</span>).text();</span><br><span class="line">          &#125;);</span><br><span class="line"></span><br><span class="line">          $(<span class="string">&quot;tbody[id] tr td:nth-child(9)&quot;</span>).each(<span class="function"><span class="keyword">function</span> (<span class="params">i,elem</span>) </span>&#123;</span><br><span class="line">            weeks[i] = $(<span class="built_in">this</span>).text().trim();</span><br><span class="line">          &#125;);</span><br><span class="line">          $(<span class="string">&quot;tbody[id] tr td:nth-child(4)&quot;</span>).each(<span class="function"><span class="keyword">function</span> (<span class="params">i, elem</span>) </span>&#123;</span><br><span class="line">            courses[i] = $(<span class="built_in">this</span>).text();</span><br><span class="line">          &#125;);</span><br><span class="line"></span><br><span class="line">          courses.forEach(<span class="function">(<span class="params">value,index</span>)=&gt;</span>&#123;</span><br><span class="line">            <span class="comment">// console.log(value);</span></span><br><span class="line">            value+=<span class="string">&quot; 老师:&quot;</span>+teachers[index]+<span class="string">&quot;上课时间:&quot;</span>+weeks[index]+<span class="string">&quot;周&quot;</span>;</span><br><span class="line">            <span class="built_in">console</span>.log(value);</span><br><span class="line">          &#125;);</span><br></pre></td></tr></table></figure><p>我将课程,老师以及上课的周挑选了出来,其实有很多方法,我相信我这种应该是比较傻的.</p><p>然后这样登陆以及课程信息都有了.</p><p>然后就是查询空闲教室,有了之前的学习,现在意外的轻松.</p><p>在那个网页试一下,抓取请求</p><p><img data-src="http://cdn.sekyoro.top/imgs/065303.png" alt="image-20211215101931605"></p><p><img data-src="http://cdn.sekyoro.top/imgs/065305.png" alt="image-20211215101854884"></p><p>所以是个post,数据也都能看到.构造就好了</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">superagent</span><br><span class="line">             .post(free_url)</span><br><span class="line">             .type(<span class="string">&quot;form&quot;</span>)</span><br><span class="line">             .set(<span class="string">&quot;Cookie&quot;</span>, cookie)</span><br><span class="line">             .send(&#123;</span><br><span class="line">               <span class="string">&quot;classroom.type.id&quot;</span>: <span class="string">&quot;&quot;</span>, <span class="comment">//教室类型</span></span><br><span class="line">               <span class="string">&quot;classroom.campus.id&quot;</span>: <span class="string">&quot;&quot;</span>, <span class="comment">//校区 </span></span><br><span class="line">               <span class="string">&quot;classroom.building.id&quot;</span>: <span class="string">&quot;&quot;</span>, <span class="comment">//教学楼id</span></span><br><span class="line">               <span class="attr">seats</span>: <span class="string">&quot;&quot;</span>, <span class="comment">//容量限制</span></span><br><span class="line">               <span class="string">&quot;classroom.name&quot;</span>: <span class="string">&quot;&quot;</span>, <span class="comment">//教室</span></span><br><span class="line">               <span class="string">&quot;cycleTime.cycleCount&quot;</span>: <span class="number">1</span>, <span class="comment">//时间周期</span></span><br><span class="line">               <span class="string">&quot;cycleTime.cycleType&quot;</span>: <span class="number">1</span>, <span class="comment">//天还是周</span></span><br><span class="line">               <span class="string">&quot;cycleTime.dateBegin&quot;</span>: <span class="string">&quot;2021-12-15&quot;</span>,<span class="comment">//起始时间</span></span><br><span class="line">               <span class="string">&quot;cycleTime.dateEnd&quot;</span>: <span class="string">&quot;2021-12-15&quot;</span>,<span class="comment">//结束时间</span></span><br><span class="line">               <span class="attr">roomApplyTimeType</span>: <span class="number">1</span>,</span><br><span class="line">               <span class="attr">timeBegin</span>: <span class="string">&quot;8:00&quot;</span>, <span class="comment">//开始时间</span></span><br><span class="line">               <span class="attr">timeEnd</span>: <span class="string">&quot;12:00&quot;</span>, <span class="comment">//结束时间</span></span><br><span class="line">             &#125;)</span><br></pre></td></tr></table></figure><p>主要是各个字段的含义,根据我尝试大概意思就是上面注释这样.</p><p>然后返回各个教室信息,数据处理就看个人了.</p><p>本人能力不足,直接莽了</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">.end(<span class="function"><span class="keyword">function</span> (<span class="params">err, res</span>) </span>&#123;</span><br><span class="line">               <span class="comment">// console.log(res);</span></span><br><span class="line">               <span class="keyword">var</span> free_classrooms = [];</span><br><span class="line">               <span class="keyword">const</span> $ = cheerio.load(res.text);</span><br><span class="line">               <span class="keyword">var</span> location;</span><br><span class="line">               <span class="keyword">var</span> building;</span><br><span class="line">               <span class="keyword">var</span> campus;</span><br><span class="line">               <span class="comment">/*</span></span><br><span class="line"><span class="comment">               教西A 130</span></span><br><span class="line"><span class="comment">               </span></span><br><span class="line"><span class="comment">               */</span></span><br><span class="line">               $(<span class="string">&#x27;tbody[id] tr&#x27;</span>).each(<span class="function"><span class="keyword">function</span> (<span class="params">i,elem</span>) </span>&#123;</span><br><span class="line">                   location = $(<span class="built_in">this</span>).find(<span class="string">&#x27;td:nth-child(2)&#x27;</span>).text();</span><br><span class="line">                   building =  $(<span class="built_in">this</span>).find(<span class="string">&#x27;td:nth-child(3)&#x27;</span>).text();</span><br><span class="line">                   campus =  $(<span class="built_in">this</span>).find(<span class="string">&#x27;td:nth-child(4)&#x27;</span>).text();</span><br><span class="line">                   free_classrooms[i] = &#123;</span><br><span class="line">                       <span class="string">&#x27;教室位置&#x27;</span>:location,</span><br><span class="line">                       <span class="string">&#x27;教学楼&#x27;</span>:building,</span><br><span class="line">                       <span class="string">&#x27;校区&#x27;</span>:campus,</span><br><span class="line">                   &#125;</span><br><span class="line"></span><br><span class="line">                 &#125;);</span><br><span class="line">                 free_classrooms.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">value,index</span>) </span>&#123;</span><br><span class="line">                     <span class="built_in">console</span>.log(value);</span><br><span class="line">                 &#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>可以看到处理结果</p><p><img data-src="http://cdn.sekyoro.top/imgs/093029.png" alt="image-20211215102207083"></p><p>继续开坑,之前遇到了一系列问题,把程序放在服务器上结果报错等等.</p><p>之前是登陆后获得cookie再去请求空教室,这样导致请求空教室就必须去登陆,所以需要进行分离.</p><p>首先登录获得cookie,这是一个函数.然后再拿cookie去获得空闲教室.这是另一个函数,名字分别为getnewcookie()与getfreeclassroom().</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getcookie</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> all_course_info = <span class="string">&quot;&quot;</span>;</span><br><span class="line">  superagent.get(login_url).end(<span class="function"><span class="keyword">function</span> (<span class="params">err, res</span>) </span>&#123;</span><br><span class="line">    superagent</span><br><span class="line">      .post(login_url)</span><br><span class="line">      .type(<span class="string">&quot;form&quot;</span>)</span><br><span class="line">      .set(&#123;</span><br><span class="line">        <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/x-www-form-urlencoded&quot;</span>,</span><br><span class="line">        <span class="attr">Host</span>: <span class="string">&quot;us.nwpu.edu.cn&quot;</span>,</span><br><span class="line">        <span class="attr">Origin</span>: <span class="string">&quot;http://us.nwpu.edu.cn&quot;</span>,</span><br><span class="line">        <span class="attr">Referer</span>: <span class="string">&quot;http://us.nwpu.edu.cn/eams/login.action&quot;</span>,</span><br><span class="line">      &#125;)</span><br><span class="line">      .send(&#123;</span><br><span class="line">        <span class="attr">username</span>: uid,</span><br><span class="line">        <span class="attr">password</span>: pwd,</span><br><span class="line">        <span class="attr">encodedPassword</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="attr">session_locale</span>: <span class="string">&quot;zh_CN&quot;</span>,</span><br><span class="line">      &#125;)</span><br><span class="line">      .end(<span class="function"><span class="keyword">function</span> (<span class="params">err, res</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> cookieid = res.headers[<span class="string">&quot;set-cookie&quot;</span>][<span class="number">0</span>].split(<span class="string">&quot;;&quot;</span>)[<span class="number">0</span>].split(<span class="string">&quot;=&quot;</span>)[<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">var</span> cookie = <span class="string">`semester.id=158; JSESSIONID=<span class="subst">$&#123;cookieid&#125;</span>; GSESSIONID=<span class="subst">$&#123;cookieid&#125;</span>`</span>;</span><br><span class="line">        superagent</span><br><span class="line">          .get(get_ids_url)</span><br><span class="line">          .set(&#123;</span><br><span class="line">            <span class="attr">Cookie</span>: cookie,</span><br><span class="line">          &#125;)</span><br><span class="line">          .end(<span class="function"><span class="keyword">function</span> (<span class="params">err, res</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> ids = res.text;</span><br><span class="line">            ids = ids.match(<span class="regexp">/form,&quot;ids&quot;,&quot;(\d*)&quot;/</span>);</span><br><span class="line">            <span class="comment">// console.log(ids);</span></span><br><span class="line">            superagent</span><br><span class="line">              .post(info_url)</span><br><span class="line">              .type(<span class="string">&quot;form&quot;</span>)</span><br><span class="line">              .send(&#123;</span><br><span class="line">                <span class="attr">ignoreHead</span>: <span class="number">1</span>,</span><br><span class="line">                <span class="string">&quot;setting.kind&quot;</span>: <span class="string">&quot;std&quot;</span>,</span><br><span class="line">                <span class="attr">startWeek</span>: <span class="number">1</span>,</span><br><span class="line">                <span class="string">&quot;semester.id&quot;</span>: <span class="number">158</span>,</span><br><span class="line">                <span class="attr">ids</span>: <span class="string">`<span class="subst">$&#123;ids&#125;</span>`</span>,</span><br><span class="line">              &#125;)</span><br><span class="line">              .set(<span class="string">&quot;Cookie&quot;</span>, cookie)</span><br><span class="line">              .end(<span class="function"><span class="keyword">function</span> (<span class="params">err, res</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (res.statusCode == <span class="number">200</span>) &#123;</span><br><span class="line">                  <span class="keyword">var</span> courses = [];</span><br><span class="line">                  <span class="keyword">var</span> teachers = [];</span><br><span class="line">                  <span class="keyword">var</span> weeks = [];</span><br><span class="line">                  <span class="keyword">const</span> $ = cheerio.load(res.text);</span><br><span class="line">                  $(<span class="string">&quot;tbody[id] tr td:nth-child(5)&quot;</span>).each(<span class="function"><span class="keyword">function</span> (<span class="params">i, elem</span>) </span>&#123;</span><br><span class="line">                    teachers[i] = $(<span class="built_in">this</span>).text();</span><br><span class="line">                  &#125;);</span><br><span class="line"></span><br><span class="line">                  $(<span class="string">&quot;tbody[id] tr td:nth-child(9)&quot;</span>).each(<span class="function"><span class="keyword">function</span> (<span class="params">i, elem</span>) </span>&#123;</span><br><span class="line">                    weeks[i] = $(<span class="built_in">this</span>).text().trim();</span><br><span class="line">                  &#125;);</span><br><span class="line">                  $(<span class="string">&quot;tbody[id] tr td:nth-child(4)&quot;</span>).each(<span class="function"><span class="keyword">function</span> (<span class="params">i, elem</span>) </span>&#123;</span><br><span class="line">                    courses[i] = $(<span class="built_in">this</span>).text();</span><br><span class="line">                  &#125;);</span><br><span class="line"></span><br><span class="line">                  courses.forEach(<span class="function">(<span class="params">value, index</span>) =&gt;</span> &#123;</span><br><span class="line">                    value +=</span><br><span class="line">                      <span class="string">&quot; 老师:&quot;</span> +</span><br><span class="line">                      teachers[index] +</span><br><span class="line">                      <span class="string">&quot;上课时间:&quot;</span> +</span><br><span class="line">                      weeks[index] +</span><br><span class="line">                      <span class="string">&quot;周&quot;</span>;</span><br><span class="line"></span><br><span class="line">                    all_course_info += value + <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">                  &#125;);</span><br><span class="line">                  <span class="comment">// console.log(all_course_info+`cookie是$&#123;cookie&#125;`);</span></span><br><span class="line">                  getfreeclassroom(<span class="string">&quot;133&quot;</span>,<span class="string">&quot;8:30&quot;</span>,cookie);</span><br><span class="line">            &#125;</span><br><span class="line">                </span><br><span class="line">      &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;)</span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>getfreeclassroom()</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getfreeclassroom</span>(<span class="params">building, timebegin,cookie</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> date = <span class="keyword">new</span> <span class="built_in">Date</span>().toLocaleString().split(<span class="string">&#x27;,&#x27;</span>)[<span class="number">0</span>].split(<span class="string">&#x27;/&#x27;</span>);</span><br><span class="line">  <span class="keyword">var</span> cycleTimebegin = date[<span class="number">2</span>]+<span class="string">&quot;-&quot;</span>+date[<span class="number">1</span>]+<span class="string">&quot;-&quot;</span>+date[<span class="number">0</span>];</span><br><span class="line">  <span class="comment">//注意 我放服务器上的时候这个tolocalestring日期顺序不对 这个也卡了很久</span></span><br><span class="line">  <span class="comment">//也可以通过其他方法生成日期</span></span><br><span class="line">  <span class="keyword">var</span> allinfo = [];</span><br><span class="line">  <span class="keyword">var</span> timeend = +timebegin.split(<span class="string">&quot;:&quot;</span>)[<span class="number">0</span>] + <span class="number">2</span> + <span class="string">&quot;:&quot;</span> + timebegin.split(<span class="string">&quot;:&quot;</span>)[<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">  superagent</span><br><span class="line">    .post(free_url)</span><br><span class="line">    .type(<span class="string">&quot;form&quot;</span>)</span><br><span class="line">    .set(&#123;</span><br><span class="line">      <span class="attr">Cookie</span>: cookie,</span><br><span class="line">      <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/x-www-form-urlencoded&quot;</span>,</span><br><span class="line">      <span class="attr">Host</span>: <span class="string">&quot;us.nwpu.edu.cn&quot;</span>,</span><br><span class="line">      <span class="attr">Origin</span>: <span class="string">&quot;http://us.nwpu.edu.cn&quot;</span>,</span><br><span class="line">      <span class="attr">Referer</span>: <span class="string">&quot;http://us.nwpu.edu.cn/eams/classroom/apply/free.action&quot;</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">    .send(&#123;</span><br><span class="line">      <span class="string">&quot;classroom.type.id&quot;</span>: <span class="string">&quot;&quot;</span>, <span class="comment">//教室类型</span></span><br><span class="line">      <span class="string">&quot;classroom.campus.id&quot;</span>: <span class="string">&quot;&quot;</span>, <span class="comment">//校区</span></span><br><span class="line">      <span class="string">&quot;classroom.building.id&quot;</span>: building, <span class="comment">//教学楼id</span></span><br><span class="line">      <span class="attr">seats</span>: <span class="string">&quot;&quot;</span>, <span class="comment">//容量限制</span></span><br><span class="line">      <span class="string">&quot;classroom.name&quot;</span>: <span class="string">&quot;&quot;</span>, <span class="comment">//教室</span></span><br><span class="line">      <span class="string">&quot;cycleTime.cycleCount&quot;</span>: <span class="number">1</span>, <span class="comment">//时间周期</span></span><br><span class="line">      <span class="string">&quot;cycleTime.cycleType&quot;</span>: <span class="number">1</span>, <span class="comment">//天还是周</span></span><br><span class="line">      <span class="string">&quot;cycleTime.dateBegin&quot;</span>: cycleTimebegin, <span class="comment">//起始时间</span></span><br><span class="line">      <span class="string">&quot;cycleTime.dateEnd&quot;</span>: cycleTimebegin, <span class="comment">//结束时间</span></span><br><span class="line">      <span class="attr">roomApplyTimeType</span>: <span class="number">1</span>,</span><br><span class="line">      <span class="attr">timeBegin</span>: timebegin,</span><br><span class="line">      <span class="attr">timeEnd</span>: timeend,</span><br><span class="line">      <span class="attr">pageNo</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">    .end(<span class="function"><span class="keyword">function</span> (<span class="params">err, res</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> free_classrooms = [];</span><br><span class="line">      <span class="keyword">const</span> $ = cheerio.load(res.text);</span><br><span class="line">      <span class="keyword">var</span> location;</span><br><span class="line">      <span class="keyword">var</span> building_;</span><br><span class="line">      <span class="keyword">var</span> campus;</span><br><span class="line">      <span class="comment">/*</span></span><br><span class="line"><span class="comment">                教西A 130</span></span><br><span class="line"><span class="comment">                </span></span><br><span class="line"><span class="comment">                */</span></span><br><span class="line">      $(<span class="string">&quot;tbody[id] tr&quot;</span>).each(<span class="function"><span class="keyword">function</span> (<span class="params">i, elem</span>) </span>&#123;</span><br><span class="line">        location = $(<span class="built_in">this</span>).find(<span class="string">&quot;td:nth-child(2)&quot;</span>).text();</span><br><span class="line">        building_ = $(<span class="built_in">this</span>).find(<span class="string">&quot;td:nth-child(3)&quot;</span>).text();</span><br><span class="line">        campus = $(<span class="built_in">this</span>).find(<span class="string">&quot;td:nth-child(4)&quot;</span>).text();</span><br><span class="line">        free_classrooms[i] = &#123;</span><br><span class="line">          教室位置: location,</span><br><span class="line">          教学楼: building_,</span><br><span class="line">          校区: campus,</span><br><span class="line">        &#125;;</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">      free_classrooms.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">value, index</span>) </span></span><br><span class="line"><span class="function">      </span>&#123;</span><br><span class="line">        allinfo.push(value);</span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="keyword">var</span> free_classrooms_info = <span class="string">&quot;&quot;</span>;</span><br><span class="line">      allinfo.forEach(<span class="function">(<span class="params">value, index</span>) =&gt;</span> &#123;</span><br><span class="line">        free_classrooms_info += <span class="built_in">JSON</span>.stringify(value).slice(<span class="number">1</span>, -<span class="number">1</span>) + <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">`空闲教室信息\n<span class="subst">$&#123;timebegin&#125;</span>-<span class="subst">$&#123;timeend&#125;</span>\n<span class="subst">$&#123;free_classrooms_info&#125;</span>`</span>);</span><br><span class="line">      </span><br><span class="line">    &#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>或者其他方法生成日期</p><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><p><a href="https://zhuanlan.zhihu.com/p/52235130">JS HTTP 请求库哪家强？Axios？Request？Superagent？</a></p><p><a href="https://www.npmjs.com/package/superagent">superagent - npm (npmjs.com)</a></p><p><a href="https://cnodejs.org/topic/5378720ed6e2d16149fa16bd">[译] SuperAgent中文使用文档</a></p><p><a href="https://cheerio.js.org/">cheerio</a></p><p><a href="https://github.com/cheeriojs/cheerio/wiki/Chinese-README">Chinese README · cheeriojs/cheerio Wiki (github.com)</a></p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      
        <tags>
            
            <tag> js </tag>
            
            <tag> spider </tag>
            
            <tag> nodejs </tag>
            
            <tag> cheerio </tag>
            
            <tag> superagent </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>python操作百度网盘</title>
      <link href="2021/12/08/python%E6%93%8D%E4%BD%9C%E7%99%BE%E5%BA%A6%E7%BD%91%E7%9B%98/"/>
      <url>2021/12/08/python%E6%93%8D%E4%BD%9C%E7%99%BE%E5%BA%A6%E7%BD%91%E7%9B%98/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>学习点:百度API 爬虫</p><span id="more"></span><p>最近想从某个发图片公众号那爬取</p><p>网盘链接,根据链接存文件.</p><p>当然这里的链接是百度网盘链接.</p><p>tips:我有两个百度云账号,但是手机利用手机账号只能登陆一个(两个账号都绑定了同一个手机),所以需要给登陆的那个号设置手机登录,如果是用户名登陆的话会跳出手机验证码,增加麻烦.</p><p>后来发现用了手机号登录还是有验证码,先输入了再说. </p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      
        <tags>
            
            <tag> python </tag>
            
            <tag> BaiduNetdisk </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>搭建wordpress</title>
      <link href="2021/12/01/%E6%90%AD%E5%BB%BAwordpress/"/>
      <url>2021/12/01/%E6%90%AD%E5%BB%BAwordpress/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>本来有一个博客了,但是搭一个动态博客方便我传文件等等<br><span id="more"></span><br>需要工具:<br>宝塔面板 :图形化管理服务器<br>xshell :远程连接  或者其他shell 有ssh就行<br>xftp :传本地文件,下载服务器的文件</p><p>下载流程就不细说了,需要注意的是下载宝塔面板需要连上服务器后使用相关命令下载软件(输入一个命令即可),记住它给的信息,同时为服务器创建安全规则(我的理解就是开放端口,不然很多服务都访问不了)<br>至于具体的安全规则,在宝塔面板上有<br><a href="https://www.bt.cn/bbs/thread-2897-1-1.html">https://www.bt.cn/bbs/thread-2897-1-1.html</a> 这是阿里云的</p><p><img data-src="http://cdn.sekyoro.top/imgs/094145.png" alt="image-20211201102511220"></p><p>除了8888端口还有上面端口需要开放</p><p>如果默认8888端口会有危险,修改一下或者忽略就行了</p><p>在面板创建站点,如果有域名的话配置域名,否则用ip地址</p><p><img data-src="http://cdn.sekyoro.top/imgs/070048.png" alt="image-20211201121437571"></p><p>然后安装wordpress,下载压缩包上传到文件,解压到网站站点目录</p><p><img data-src="http://cdn.sekyoro.top/imgs/070050.png" alt="image-20211201121518824"></p><p>将解压得到的内容放在根目录下,这点还是很重要的.</p><p>然后登录站点,一步一步按照提示填写,最后就长这样,</p><p><img data-src="http://cdn.sekyoro.top/imgs/070051.png" alt="image-20211201143454798"></p><p>下载wp主题,有两个主题推荐 Sakura和Kratos-pjax</p><p>github上有,不过我一开始是git clone下来发现wp需要zip,我自己压缩成zip发现不太行,后来又下载的zip.</p><p>更新一下下载链接</p><p><a href='http://cdn.sekyoro.top/Sakurairo-2.3.1.zip'>sakurairo</a></p><p>同时注意一下php版本,4.x多半是不行了,需要装一个更新的,同时phpadmin版本也要跟着更新一下.</p><p>然后是域名备案,众所周知,在cn需要域名备案.</p><p>我用的阿里云的服务器,在腾讯买的域名,因为阿里那没有我想买的域名.</p><p>一开始在网上搜索以为这样需要域名转入,所以以为很麻烦，事实上只用备案就行了.</p><p>在购买服务器的isp那备案.</p><p><strong>注意</strong>:备案的域名需要实名购买(现在是强制的了),同时需要购买后过2天左右(会有一段时间的)才能申请备案.</p><p>填写一堆信息后需要通过初审.</p><p><img data-src="http://cdn.sekyoro.top/imgs/070054.png" alt="image-20211202234623396"></p><p>吐槽一下,幸好这里可以吐槽… 阿里云这边需要强制安装一个阿里云app填写信息,填写的信息也是一大堆..</p><p>备案后会核实网站信息,注意的是网站信息不能有博客和免费这些信息…</p><p>后面过了管局应该就行了.</p><p>12/13更新</p><p>今天管局给我通过了,然后在ngnix上操作一下设置域名就行了</p><p>欢迎访问</p><p>proanimer.com</p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      
        <tags>
            
            <tag> wordpress </tag>
            
            <tag> tutorial </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux网络配置/路由器及防火墙设置</title>
      <link href="2021/11/21/%E5%91%BD%E4%BB%A4%E9%9B%86-7/"/>
      <url>2021/11/21/%E5%91%BD%E4%BB%A4%E9%9B%86-7/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="Linux网络配置-路由器及防火墙设置"><a href="#Linux网络配置-路由器及防火墙设置" class="headerlink" title="Linux网络配置/路由器及防火墙设置"></a>Linux网络配置/路由器及防火墙设置</h1><h2 id="网络配置"><a href="#网络配置" class="headerlink" title="网络配置"></a>网络配置</h2><span id="more"></span><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">route -n</span><br></pre></td></tr></table></figure><p><img data-src="http://cdn.sekyoro.top/imgs/065126.png" alt="image-20210921120013094"></p><div class="table-container"><table><thead><tr><th>输出</th><th>说明</th></tr></thead><tbody><tr><td>Destination</td><td>目标网段或者主机</td></tr><tr><td>Gateway</td><td>网关地址</td></tr><tr><td>Genmask</td><td>网络掩码</td></tr><tr><td>Flags</td><td>标记  U路由活动  G路由指向网关</td></tr><tr><td>Metric</td><td>路由距离,到达指定网络所需的中转数</td></tr><tr><td>Ref</td><td>路由项引用次数</td></tr><tr><td>Use</td><td>路由项由软件查找次数</td></tr><tr><td>Iface</td><td>该路由表项对应的输出接口</td></tr></tbody></table></div><p>add      添加一条路由规则<br>del       删除一条路由规则<br>-net      目的地址是一个网络<br>-host     目的地址是一个主机<br>target     目的网络或主机<br>netmask   目的地址的网络掩码<br>gw       路由数据包通过的网关<br>dev      为路由指定的网络接口</p><h2 id="防火墙设置"><a href="#防火墙设置" class="headerlink" title="防火墙设置"></a>防火墙设置</h2><p>启动： systemctl start firewalld</p><p>关闭： systemctl stop firewalld</p><p>查看状态： systemctl status firewalld </p><p>开机禁用 ： systemctl disable firewalld</p><p>开机启用 ： systemctl enable firewalld</p><p> 我在ubuntu上并没有这项服务</p><p><img data-src="http://cdn.sekyoro.top/imgs/065128.png" alt="image-20210921152228108"></p><p>于是我找到了 ufw</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ufw status</span><br></pre></td></tr></table></figure><p><img data-src="http://cdn.sekyoro.top/imgs/065130.png" alt="image-20210921152359776"></p><p>上面提示表示没有开启防火墙，并不是没有安装防火墙</p><p><img data-src="http://cdn.sekyoro.top/imgs/065133.png" alt="image-20210921152538889"></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo ufw reload <span class="comment">#重启</span></span><br><span class="line">sudo ufw <span class="built_in">disable</span> <span class="comment"># 关闭</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">udo ufw <span class="built_in">enable</span> </span><br><span class="line">sudo ufw default deny</span><br></pre></td></tr></table></figure><p>作用：开启了防火墙并随系统启动同时关闭所有外部对本机的访问(本机访问外部正常)。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">开启/禁用相应端口或服务举例sudo ufw allow 80 允许外部访问80端口</span><br><span class="line"></span><br><span class="line">sudo ufw allow 53 允许外部访问53端口</span><br><span class="line">sudo ufw delete allow 80 禁止外部访问80 端口</span><br><span class="line"></span><br><span class="line">sudo ufw allow from 192.168.1.1 允许此IP访问所有的本机端口</span><br><span class="line"></span><br><span class="line">sudo ufw deny smtp 禁止外部访问smtp服务</span><br><span class="line"></span><br><span class="line">sudo ufw delete allow smtp 删除上面建立的某条规则</span><br></pre></td></tr></table></figure><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> Linux_study </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux Shell及vi/vim使用</title>
      <link href="2021/11/21/%E5%91%BD%E4%BB%A4%E9%9B%86-6/"/>
      <url>2021/11/21/%E5%91%BD%E4%BB%A4%E9%9B%86-6/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="Linux-Shell及vi-vim使用"><a href="#Linux-Shell及vi-vim使用" class="headerlink" title="Linux Shell及vi/vim使用"></a>Linux Shell及vi/vim使用</h2><h3 id="vi-vim-简单使用"><a href="#vi-vim-简单使用" class="headerlink" title="vi/vim 简单使用"></a>vi/vim 简单使用</h3><span id="more"></span><p>概念</p><p>vi是unix下的编辑程序,vim由vi改编增强版。</p><p>现在一般用的是vim</p><p>vim有多种模式</p><ul><li>普通模式(Normal mode)</li></ul><p>在普通模式中，用的编辑器命令，比如移动光标，删除文本等等。这也是 Vim 启动后的默认模式。这正好和许多新用户期待的操作方式相反（大多数编辑器默认模式为插入模式）。</p><p>这种设置与其他文本编辑器不太一样,但这样的话可以更快移动光标</p><p>在普通模式中，有很多方法可以进入插入模式。比较普通的方式是按 <code>a</code>（append／追加）键或者 <code>i</code>（insert／插入）键。</p><ul><li>插入模式(Insert mode)</li></ul><p>在这个模式中，大多数按键都会向文本缓冲中插入文本。大多数新用户希望文本编辑器编辑过程中一直保持这个模式。</p><blockquote><p>在插入模式中，可以按 <code>ESC</code> 键回到普通模式。</p></blockquote><ul><li>可视模式(Visual mode)</li></ul><blockquote><p>这个模式与普通模式比较相似。但是移动命令会扩大高亮的文本区域。高亮区域可以是字符、行或者是一块文本。当执行一个非移动命令时，命令会被执行到这块高亮的区域上。Vim 的”文本对象”也能和移动命令一样用在这个模式中。</p></blockquote><ul><li>选择模式(Select mode)</li></ul><blockquote><p>这个模式和无模式编辑器的行为比较相似（Windows 标准文本控件的方式）。这个模式中，可以用鼠标或者光标键高亮选择文本，不过输入任何字符的话，Vim 会用这个字符替换选择的高亮文本块，并且自动进入插入模式。</p></blockquote><ul><li>命令行模式(Command line mode)</li></ul><blockquote><p>在命令行模式中可以输入会被解释成并执行的文本。例如执行命令（<code>:</code>键），搜索（<code>/</code>和<code>?</code>键）或者过滤命令（<code>!</code>键）。在命令执行之后，Vim 返回到命令行模式之前的模式，通常是普通模式。</p></blockquote><ul><li>Ex 模式(Ex mode)</li></ul><p>这和命令行模式比较相似，在使用 <code>:visual</code> 命令离开 Ex 模式前，可以一次执行多条命令。</p><h3 id="模式切换"><a href="#模式切换" class="headerlink" title="模式切换"></a>模式切换</h3><p>普通模式中按 <code>i</code>（插入）或 <code>a</code>（附加）键都可以进入插入模式，普通模式中按 <code>:</code> 进入命令行模式。命令行模式中输入 <code>wq</code> 回车后保存并退出 vim。</p><p>进入vim界面</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim practice_1.txt</span><br></pre></td></tr></table></figure><p>进入命令行模式后还可以使用 e:file  打开其他文件</p><h3 id="游标移动"><a href="#游标移动" class="headerlink" title="游标移动"></a>游标移动</h3><div class="table-container"><table><thead><tr><th>按键</th><th>说明</th></tr></thead><tbody><tr><td><code>h</code></td><td>左</td></tr><tr><td><code>l</code></td><td>右（小写 L）</td></tr><tr><td><code>j</code></td><td>下</td></tr><tr><td><code>k</code></td><td>上</td></tr><tr><td><code>w</code></td><td>移动到下一个单词</td></tr><tr><td><code>b</code></td><td>移动到上一个单词</td></tr><tr><td>0</td><td>光标到行首</td></tr><tr><td>$</td><td>光标到行末</td></tr><tr><td>numG</td><td>移动到num行</td></tr><tr><td>G</td><td>移动到最后一行</td></tr><tr><td>numj</td><td>向下移动num行</td></tr><tr><td>numgg</td><td>跳转至num行</td></tr></tbody></table></div><p>进入插入模式</p><div class="table-container"><table><thead><tr><th>按键</th><th>说明</th></tr></thead><tbody><tr><td><code>h</code></td><td>左</td></tr><tr><td><code>l</code></td><td>右（小写 L）</td></tr><tr><td><code>j</code></td><td>下</td></tr><tr><td><code>k</code></td><td>上</td></tr><tr><td><code>w</code></td><td>移动到下一个单词</td></tr><tr><td><code>b</code></td><td>移动到上一个单词</td></tr></tbody></table></div><h4 id="命令行模式下保存文档"><a href="#命令行模式下保存文档" class="headerlink" title="命令行模式下保存文档"></a>命令行模式下保存文档</h4><p>从普通模式输入 <code>:</code> 进入命令行模式，输入 <code>w</code> 回车，保存文档。输入 <code>:w &lt;filename&gt;</code> 可以将文档另存为其他文件名或存到其它路径下。</p><h4 id="命令行模式下退出-vim"><a href="#命令行模式下退出-vim" class="headerlink" title="命令行模式下退出 vim"></a>命令行模式下退出 vim</h4><p>从普通模式输入 <code>:</code> 进入命令行模式，输入 <code>wq</code> 回车，保存并退出编辑。</p><p>以下为其它几种退出方式：</p><div class="table-container"><table><thead><tr><th>命令</th><th>说明</th></tr></thead><tbody><tr><td><code>:q!</code></td><td>强制退出，不保存</td></tr><tr><td><code>:q</code></td><td>退出</td></tr><tr><td><code>:wq!</code></td><td>强制保存并退出</td></tr><tr><td><code>:w &lt;文件路径&gt;</code></td><td>另存为</td></tr><tr><td><code>:saveas 文件路径</code></td><td>另存为</td></tr><tr><td><code>:x</code></td><td>保存并退出</td></tr><tr><td><code>:wq</code></td><td>保存并退出</td></tr></tbody></table></div><h4 id="普通模式下退出-vim"><a href="#普通模式下退出-vim" class="headerlink" title="普通模式下退出 vim"></a>普通模式下退出 vim</h4><p>普通模式下按下 <code>Shift+zz</code> 即可保存退出 vim。</p><h4 id="普通模式下删除-vim-文本信息"><a href="#普通模式下删除-vim-文本信息" class="headerlink" title="普通模式下删除 vim 文本信息"></a>普通模式下删除 vim 文本信息</h4><p>进入普通模式，使用下列命令可以进行文本快速删除：</p><div class="table-container"><table><thead><tr><th>命令</th><th>说明</th></tr></thead><tbody><tr><td><code>x</code></td><td>删除游标所在的字符</td></tr><tr><td><code>X</code></td><td>删除游标所在前一个字符</td></tr><tr><td><code>Delete</code></td><td>同 <code>x</code></td></tr><tr><td><code>dd</code></td><td>删除整行</td></tr><tr><td><code>dw</code></td><td>删除一个单词（不适用中文）</td></tr><tr><td><code>d$</code>或<code>D</code></td><td>删除至行尾</td></tr><tr><td><code>d^</code></td><td>删除至行首</td></tr><tr><td><code>dG</code></td><td>删除到文档结尾处</td></tr><tr><td><code>d1G</code></td><td>删至文档首部</td></tr><tr><td>2dd</td><td>一次删除两行</td></tr></tbody></table></div><h3 id="行间跳转"><a href="#行间跳转" class="headerlink" title="行间跳转"></a>行间跳转</h3><div class="table-container"><table><thead><tr><th>命令</th><th>说明</th></tr></thead><tbody><tr><td><code>nG</code>(n Shift+g) / <code>ngg</code></td><td>游标移动到第 n 行 <strong>(如果默认没有显示行号，请先进入命令模式，输入 <code>:set nu</code> 以显示行号)</strong></td></tr><tr><td><code>gg</code></td><td>游标移动到到第一行</td></tr><tr><td><code>G</code>(Shift+g)</td><td>到最后一行</td></tr></tbody></table></div><p><strong><code>Ctrl+o</code> 快速回到上一次(跳转前)光标所在位置</strong></p><h4 id="行内跳转"><a href="#行内跳转" class="headerlink" title="行内跳转"></a>行内跳转</h4><p>普通模式下使用下列命令在行内按照单词为单位进行跳转：</p><div class="table-container"><table><thead><tr><th>命令</th><th>说明</th></tr></thead><tbody><tr><td><code>w</code></td><td>到下一个单词的开头</td></tr><tr><td><code>e</code></td><td>到当前单词的结尾</td></tr><tr><td><code>b</code></td><td>到前一个单词的开头</td></tr><tr><td><code>ge</code></td><td>到前一个单词的结尾</td></tr><tr><td><code>0</code>或<code>^</code></td><td>到行头</td></tr><tr><td><code>$</code></td><td>到行尾</td></tr><tr><td><code>f&lt;字母&gt;</code></td><td>向后搜索&lt;字母&gt;并跳转到第一个匹配的位置(非常实用)</td></tr><tr><td><code>F&lt;字母&gt;</code></td><td>向前搜索&lt;字母&gt;并跳转到第一个匹配的位置</td></tr><tr><td><code>t&lt;字母&gt;</code></td><td>向后搜索&lt;字母&gt;并跳转到第一个匹配位置之前的一个字母(不常用)</td></tr><tr><td><code>T&lt;字母&gt;</code></td><td>向前搜索&lt;字母&gt;并跳转到第一个匹配位置之后的一个字母(不常用)</td></tr></tbody></table></div><h4 id="复制及粘贴文本"><a href="#复制及粘贴文本" class="headerlink" title="复制及粘贴文本"></a>复制及粘贴文本</h4><ul><li><p>普通模式中使用 <code>y</code> 复制</p></li><li><p>普通模式中，<code>yy</code> 复制游标所在的整行（<code>3yy</code> 表示复制 3 行）</p></li><li><p>普通模式中，<code>y^</code> 复制至行首，或 <code>y0</code>。不含光标所在处字符。</p></li><li><p>普通模式中，<code>y$</code> 复制至行尾。含光标所在处字符。</p></li><li><p>普通模式中，<code>yw</code> 复制一个单词。</p></li><li><p>普通模式中，<code>y2w</code> 复制两个单词。</p></li><li><p>普通模式中，<code>yG</code> 复制至文本末。</p></li><li><p>普通模式中，<code>y1G</code> 复制至文本开头。</p></li><li><p>普通模式中使用 <code>p</code> 粘贴</p></li><li><p>普通模式中，<code>p</code>(小写)代表粘贴至光标后（下）</p></li><li><p>普通模式中，<code>P</code>(大写)代表粘贴至光标前（上）</p><h4 id="粘贴"><a href="#粘贴" class="headerlink" title="粘贴"></a>粘贴</h4></li><li><p>普通模式中使用 <code>p</code> 粘贴</p></li><li><p>普通模式中，<code>p</code>(小写)代表粘贴至光标后（下）</p></li><li><p>普通模式中，<code>P</code>(大写)代表粘贴至光标前（上）</p></li></ul><h4 id="剪切"><a href="#剪切" class="headerlink" title="剪切"></a>剪切</h4><p>dd命令就是剪切</p><p>ddp可以实现交换行</p><h3 id="字符串替换"><a href="#字符串替换" class="headerlink" title="字符串替换"></a>字符串替换</h3><div class="table-container"><table><thead><tr><th>命令</th><th>说明</th></tr></thead><tbody><tr><td><code>r</code>+&lt;待替换字母&gt;</td><td>将游标所在字母替换为指定字母</td></tr><tr><td><code>R</code></td><td>连续替换，直到按下 <code>Esc</code></td></tr><tr><td><code>cc</code></td><td>替换整行，即删除游标所在行，并进入插入模式</td></tr><tr><td><code>cw</code></td><td>替换一个单词，即删除一个单词，并进入插入模式</td></tr><tr><td><code>C</code>(大写)</td><td>替换游标以后至行末</td></tr><tr><td><code>~</code></td><td>反转游标所在字母大小写</td></tr><tr><td><code>&#123;n&#125;u</code></td><td>撤销一次或 n 次操作</td></tr><tr><td><code>U</code>(大写)</td><td>撤销当前行的所有修改</td></tr><tr><td><code>Ctrl+r</code></td><td>redo，即撤销 undo 的操作</td></tr></tbody></table></div><h3 id="快速缩进"><a href="#快速缩进" class="headerlink" title="快速缩进"></a>快速缩进</h3><ul><li>普通模式下输入 <code>&gt;&gt;</code> 整行将向右缩进</li><li>普通模式下输入 <code>&lt;&lt;</code> 整行向左回退</li><li>普通模式下输入 <code>:</code> 进入命令行模式下对 <code>shiftwidth</code> 值进行设置可以控制缩进和回退的字符数</li></ul><p>:set shiftwidth=10</p><h3 id="调整文本位置"><a href="#调整文本位置" class="headerlink" title="调整文本位置"></a>调整文本位置</h3><p>:ce</p><p>:ri</p><p>:le </p><p>分别将本行文本靠某个位置</p><h3 id="快速查找"><a href="#快速查找" class="headerlink" title="快速查找"></a>快速查找</h3><p>普通模式下输入 <code>/</code> 然后键入需要查找的字符串，按回车后就会进行查找。<code>?</code> 与<code>/</code>功能相同，只不过 <code>?</code> 是向上而 <code>/</code> 是向下查找。</p><p>进入查找之后，输入 <code>n</code> 和 <code>N</code> 可以继续查找。<code>n</code> 是查找下一个内容，<code>N</code> 查找上一个内容。</p><ul><li>命令行模式下输入 <code>noh</code> 然后回车即可取消搜索</li></ul><h4 id="使用-vim-编辑多个文件"><a href="#使用-vim-编辑多个文件" class="headerlink" title="使用 vim 编辑多个文件"></a>使用 vim 编辑多个文件</h4><p>编辑多个文件有两种形式，一种是在进入 vim 前使用的参数就是多个文件。另一种就是进入 vim 后再编辑其他的文件。 同时创建两个新文件并编辑</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim 1.txt 2.txt</span><br><span class="line"></span><br><span class="line">默认进入1.txt文件的编辑界面命令行模式下输入 :n 编辑 2.txt 文件，可以加 ! 即 :n! 强制切换，之前一个文件的输入没有保存，仅仅切换到另一个文件命令行模式下输入 :N 编辑 1.txt 文件，可以加 ! 即 :N! 强制切换，之前文件内的输入没有保存，仅仅是切换到另一个文件</span><br></pre></td></tr></table></figure><ul><li>命令行模式下输入:e 3.txt 打开新文件 3.txt</li><li>命令行模式下输入<code>:e#</code> 回到前一个文件</li><li>命令行模式下输入<code>:ls</code>可以列出以前编辑过的文档</li><li>命令行模式下输入<code>:b 2.txt</code>（或者编号）可以直接进入文件 2.txt 编辑</li><li>命令行模式下输入<code>:bd 2.txt</code>（或者编号）可以删除以前编辑过的列表中的文件项目</li><li>命令行模式下输入<code>:e! 4.txt</code>，新打开文件 4.txt，放弃正在编辑的文件</li><li>命令行模式下输入<code>:f</code> 显示正在编辑的文件名</li><li>命令行模式下输入<code>:f new.txt</code>，改变正在编辑的文件名字为 new.txt</li></ul><h3 id="恢复文件"><a href="#恢复文件" class="headerlink" title="恢复文件"></a>恢复文件</h3><p>如果因为断电，终端意外关闭等原因造成文档没有保存，可以采用恢复方式。</p><p>vim 在编辑的时候会自动在当前文件目录下生成一个交换文件，一般以 <code>&lt;filename&gt;.swp</code> 的格式保存，如果有多个版本的交换文件，还可能是 <code>.swn</code>，<code>.swm</code> 等字母。注意这个交换文件的更新不是实时的，因为实时的更新会占用磁盘，影响系统其他正常进程的速度。</p><p>在命令行模式中输入 <code>!</code> 可以执行外部的 shell 命令。</p><ul><li><code>:!ls</code> 用于显示当前目录的内容</li><li><code>:!rm FILENAME</code> 用于删除名为 FILENAME 的文件</li><li><code>:w FILENAME</code> 可将当前 VIM 中正在编辑的文件另存为 FILENAME 文件</li></ul><h2 id="Shell变量-运算符-分支-循环-传递参数-函数使用"><a href="#Shell变量-运算符-分支-循环-传递参数-函数使用" class="headerlink" title="Shell变量 运算符 分支 循环 传递参数 函数使用"></a>Shell变量 运算符 分支 循环 传递参数 函数使用</h2><p>行首以 <code>#</code> 开头(除#!之外)的是注释。<code>#!</code> 是用于指定当前脚本的解释器，我们这里为 bash，且应该指明完整路径，所以为 <code>/bin/bash</code></p><p><img data-src="http://cdn.sekyoro.top/imgs/065102.png" alt="image-20210917105258935"></p><h4 id="命令分隔符"><a href="#命令分隔符" class="headerlink" title="命令分隔符"></a>命令分隔符</h4><p>使用分号 <code>;</code> 可以在同一行上写两个或两个以上的命令。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim test2.sh</span><br></pre></td></tr></table></figure><p>输入如下代码，并保存：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">echo</span> hello; <span class="built_in">echo</span> there</span><br><span class="line">filename=ttt.sh</span><br><span class="line"><span class="keyword">if</span> [ -e <span class="string">&quot;<span class="variable">$filename</span>&quot;</span> ]; <span class="keyword">then</span>    <span class="comment"># 注意: &quot;if&quot;和&quot;then&quot;需要分隔，-e用于判断文件是否存在</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;File <span class="variable">$filename</span> exists.&quot;</span>; cp <span class="variable">$filename</span> <span class="variable">$filename</span>.bak</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;File <span class="variable">$filename</span> not found.&quot;</span>; touch <span class="variable">$filename</span></span><br><span class="line"><span class="keyword">fi</span>; <span class="built_in">echo</span> <span class="string">&quot;File test complete.&quot;</span></span><br></pre></td></tr></table></figure><h4 id="终止-case-选项（双分号）"><a href="#终止-case-选项（双分号）" class="headerlink" title="终止 case 选项（双分号）"></a>终止 case 选项（双分号）</h4><p>使用双分号 <code>;;</code> 可以终止 case 选项。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim test3.sh</span><br></pre></td></tr></table></figure><p>输入如下代码，并保存。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">varname=b</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;<span class="variable">$varname</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">    [a-z]) <span class="built_in">echo</span> <span class="string">&quot;abc&quot;</span>;;</span><br><span class="line">    [0-9]) <span class="built_in">echo</span> <span class="string">&quot;123&quot;</span>;;</span><br><span class="line"><span class="keyword">esac</span></span><br></pre></td></tr></table></figure><h4 id="双引号（”"><a href="#双引号（”" class="headerlink" title="双引号（”)"></a>双引号（”)</h4><p>“STRING” 将会阻止（解释）STRING 中大部分特殊的字符。</p><h4 id="单引号（’）"><a href="#单引号（’）" class="headerlink" title="单引号（’）"></a>单引号（’）</h4><p>‘STRING’ 将会阻止 STRING 中所有特殊字符的解释，这是一种比使用”更强烈的形式。</p><h4 id="斜线（-）"><a href="#斜线（-）" class="headerlink" title="斜线（/）"></a>斜线（<code>/</code>）</h4><p>文件名路径分隔符。分隔文件名不同的部分（如 <code>/home/bozo/projects/Makefile</code>）。也可以用来作为除法算术操作符。注意在 linux 中表示路径的时候，许多个 <code>/</code> 跟一个 <code>/</code> 是一样的。<code>/home/shiyanlou</code> 等同于 <code>////home///shiyanlou</code>。</p><h4 id="反斜线（-）"><a href="#反斜线（-）" class="headerlink" title="反斜线（\）"></a>反斜线（<code>\</code>）</h4><p>一种对单字符的引用机制。<code>\X</code> 将会“转义”字符 X。这等价于”X”，也等价于’X’。<code>\</code> 通常用来转义双引号（<code>&quot;</code>）和单引号（<code>&#39;</code>），这样双引号和单引号就不会被解释成特殊含义了。</p><ul><li>符号 说明</li><li><code>\n</code> 表示新的一行</li><li><code>\r</code> 表示回车</li><li><code>\t</code> 表示水平制表符</li><li><code>\v</code> 表示垂直制表符</li><li><code>\b</code> 表示后退符</li><li><code>\a</code> 表示”alert”(蜂鸣或者闪烁)</li><li><code>\0xx</code> 转换为八进制的 ASCII 码, 等价于 0xx</li><li><code>\&quot;</code> 表示引号字面的意思</li></ul><p>转义符也提供续行功能，也就是编写多行命令的功能</p><h4 id="命令替换"><a href="#命令替换" class="headerlink" title="命令替换"></a>命令替换</h4><p>反引号中的命令会优先执行，如：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cp `mkdir back` test.sh back</span><br><span class="line">ls</span><br></pre></td></tr></table></figure><p>先创建了 back 目录，然后复制 test.sh 到 back 目录。</p><h3 id="空命令"><a href="#空命令" class="headerlink" title="空命令"></a>空命令</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:</span><br></pre></td></tr></table></figure><p>等价于“NOP”（no op，一个什么也不干的命令）。也可以被认为与 shell 的内建命令 true 作用相同。“:”命令是一个 bash 的内建命令，它的退出码（exit status）是（0）</p><h4 id="命令组"><a href="#命令组" class="headerlink" title="命令组"></a>命令组</h4><p>在括号中的命令列表，将会作为一个子 shell 来运行。</p><p>在括号中的变量，由于是在子 shell 中，所以对于脚本剩下的部分是不可用的。父进程，也就是脚本本身，将不能够读取在子进程中创建的变量，也就是在子 shell 中创建的变量。如：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim test20.sh</span><br></pre></td></tr></table></figure><p>输入代码：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">a=123</span><br><span class="line">( a=321; )</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$a</span>&quot;</span> <span class="comment">#a的值为123而不是321，因为括号将判断为局部变量</span></span><br></pre></td></tr></table></figure><p>运行代码：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bash test20.sh</span><br><span class="line">a = 123</span><br></pre></td></tr></table></figure><p>在圆括号中 a 变量，更像是一个局部变量。</p><h4 id="2-初始化数组"><a href="#2-初始化数组" class="headerlink" title="2.初始化数组"></a>2.初始化数组</h4><p>创建数组</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim test21.sh</span><br></pre></td></tr></table></figure><p>输入代码：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">arr=(1 4 5 7 9 21)</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;arr[3]&#125;</span> <span class="comment"># get a value of arr</span></span><br></pre></td></tr></table></figure><p>运行代码：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bash test21.sh</span><br><span class="line">7</span><br></pre></td></tr></table></figure><h4 id="条件测试"><a href="#条件测试" class="headerlink" title="条件测试"></a>条件测试</h4><p>条件测试表达式放在 <code>[ ]</code> 中。下列练习中的 <code>-lt</code> (less than)表示小于号。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim test24.sh</span><br></pre></td></tr></table></figure><p>输入代码：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">a=5</span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$a</span> -lt 10 ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;a: <span class="variable">$a</span>&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&#x27;a&gt;=10&#x27;</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure><p>运行代码：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bash test24.sh</span><br><span class="line">a: 5</span><br></pre></td></tr></table></figure><p>双中括号（<code>[[ ]]</code>）也用作条件测试（判断）</p><h3 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h3><h4 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h4><p>变量的名字就是变量保存值的地方。引用变量的值就叫做变量替换。</p><p>如果 variable 是一个变量的名字，那么 <code>$variable</code> 就是引用这个变量的值，即这变量所包含的数据。</p><p><code>$variable</code> 事实上只是 <code>$&#123;variable&#125;</code> 的简写形式。在某些上下文中 <code>$variable</code> 可能会引起错误，这时候你就需要用 <code>$&#123;variable&#125;</code> 了</p><h4 id="局部变量"><a href="#局部变量" class="headerlink" title="局部变量"></a>局部变量</h4><p>这种变量只有在代码块或者函数中才可见。</p><h4 id="环境变量"><a href="#环境变量" class="headerlink" title="环境变量"></a>环境变量</h4><p>这种变量将影响用户接口和 shell 的行为。</p><p>在通常情况下，每个进程都有自己的“环境”，这个环境是由一组变量组成的，这些变量中存有进程可能需要引用的信息。在这种情况下，shell 与一个一般的进程没什么区别。</p><h4 id="位置参数"><a href="#位置参数" class="headerlink" title="位置参数"></a>位置参数</h4><p>从命令行传递到脚本的参数：<code>$0</code>，<code>$1</code>，<code>$2</code>，<code>$3</code>…</p><p><code>$0</code> 就是脚本文件自身的名字，<code>$1</code> 是第一个参数，<code>$2</code> 是第二个参数，<code>$3</code> 是第三个参数，然后是第四个。<code>$9</code> 之后的位置参数就必须用大括号括起来了，比如，<code>$&#123;10&#125;</code>，<code>$&#123;11&#125;</code>，<code>$&#123;12&#125;</code>。</p><ul><li><code>$#</code> ： 传递到脚本的参数个数</li><li><code>$*</code> ： 以一个单字符串显示所有向脚本传递的参数。与位置变量不同,此选项参数可超过 9 个</li><li>$$$$ ： 脚本运行的当前进程 ID 号</li><li><code>$!</code> ： 后台运行的最后一个进程的进程 ID 号</li><li><code>$@</code> ： 与 <code>$*</code> 相同,但是使用时加引号,并在引号中返回每个参数</li><li><code>$</code>： 显示 shell 使用的当前选项,与 set 命令功能相同</li><li><code>$?</code> ： 显示最后命令的退出状态。 0 表示没有错误,其他任何值表明有错误。</li></ul><h3 id="运算符"><a href="#运算符" class="headerlink" title="运算符"></a>运算符</h3><p><img data-src="http://cdn.sekyoro.top/imgs/065104.png" alt="5-1-1"></p><div class="table-container"><table><thead><tr><th>运算符</th><th>说明</th></tr></thead><tbody><tr><td>-eq</td><td>检测两个数是否相等</td></tr><tr><td>-ne</td><td>两个数是否不等</td></tr><tr><td>-gt</td><td>大于</td></tr><tr><td>-lt</td><td>小于</td></tr><tr><td>-ge</td><td>大于等于</td></tr><tr><td>-le</td><td>小于等于</td></tr></tbody></table></div><p>逻辑运算</p><div class="table-container"><table><thead><tr><th>运算符</th><th>说明</th></tr></thead><tbody><tr><td>&amp;&amp;</td><td>逻辑的AND</td></tr><tr><td>\</td><td>\</td><td></td><td>逻辑的OR</td></tr></tbody></table></div><h3 id="字符串运算符"><a href="#字符串运算符" class="headerlink" title="字符串运算符"></a>字符串运算符</h3><div class="table-container"><table><thead><tr><th>运算符</th><th>说明</th></tr></thead><tbody><tr><td>=</td><td>检测两个字符串是否相等</td></tr><tr><td>!=</td><td>检测两个字符串是否不相等</td></tr><tr><td>-z</td><td>检测字符串长度是否为0</td></tr><tr><td>-n</td><td>检测字符串长度是否不为0</td></tr><tr><td>str</td><td>检测字符串是否为空</td></tr></tbody></table></div><h3 id="文件测试运算符"><a href="#文件测试运算符" class="headerlink" title="文件测试运算符"></a>文件测试运算符</h3><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">-b file     检测文件是否是块设备文件，如果是，则返回 true。  [ -b <span class="built_in">$</span>file ] 返回 false。</span><br><span class="line"></span><br><span class="line">-c file     检测文件是否是字符设备文件，如果是，则返回 true。     [ -c <span class="built_in">$</span>file ] 返回 false。</span><br><span class="line"></span><br><span class="line">-d file     检测文件是否是目录，如果是，则返回 true。     [ -d <span class="built_in">$</span>file ] 返回 false。</span><br><span class="line"></span><br><span class="line">-f file     检测文件是否是普通文件（既不是目录，也不是设备文件），如果是，则返回 true。    [ -f <span class="built_in">$</span>file ] 返回 true。</span><br><span class="line"></span><br><span class="line">-g file     检测文件是否设置了 SGID 位，如果是，则返回 true。  [ -g <span class="built_in">$</span>file ] 返回 false。</span><br><span class="line"></span><br><span class="line">-k file     检测文件是否设置了粘着位(Sticky Bit)，如果是，则返回 true。  [ -k <span class="built_in">$</span>file ] 返回 false。</span><br><span class="line"></span><br><span class="line">-p file     检测文件是否是有名管道，如果是，则返回 true。   [ -p <span class="built_in">$</span>file ] 返回 false。</span><br><span class="line"></span><br><span class="line">-u file     检测文件是否设置了 SUID 位，如果是，则返回 true。  [ -u <span class="built_in">$</span>file ] 返回 false。</span><br><span class="line"></span><br><span class="line">-r file     检测文件是否可读，如果是，则返回 true。  [ -r <span class="built_in">$</span>file ] 返回 true。</span><br><span class="line"></span><br><span class="line">-w file     检测文件是否可写，如果是，则返回 true。  [ -w <span class="built_in">$</span>file ] 返回 true。</span><br><span class="line"></span><br><span class="line">-x file     检测文件是否可执行，如果是，则返回 true。     [ -x <span class="built_in">$</span>file ] 返回 true。</span><br><span class="line"></span><br><span class="line">-s file     检测文件是否为空（文件大小是否大于0），不为空返回 true。     [ -s <span class="built_in">$</span>file ] 返回 true。</span><br><span class="line"></span><br><span class="line">-e file     检测文件（包括目录）是否存在，如果是，则返回 true。    [ -e <span class="built_in">$</span>file ] 返回 true。</span><br></pre></td></tr></table></figure><h3 id="流程控制"><a href="#流程控制" class="headerlink" title="流程控制"></a>流程控制</h3><h4 id="if"><a href="#if" class="headerlink" title="if"></a>if</h4><p>if 语句语法格式：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> condition</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    command1</span><br><span class="line">    command2</span><br><span class="line">    ...</span><br><span class="line">    commandN</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure><h4 id="if-else"><a href="#if-else" class="headerlink" title="if else"></a>if else</h4><p>if else 语法格式：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> condition</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    command1</span><br><span class="line">    command2</span><br><span class="line">    ...</span><br><span class="line">    commandN</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">command</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure><p>if-elif-else 语法格式：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> condition1</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    command1</span><br><span class="line"><span class="keyword">elif</span> condition2</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    command2</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    commandN</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure><p><img data-src="http://cdn.sekyoro.top/imgs/065105.png" alt="删除该目录下处本文件的所有文件"></p><h4 id="for循环"><a href="#for循环" class="headerlink" title="for循环"></a>for循环</h4><p>for 循环一般格式为：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> var <span class="keyword">in</span> item1 item2 ... itemN</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    command1</span><br><span class="line">    command2</span><br><span class="line">    ...</span><br><span class="line">    commandN</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><p><img data-src="http://cdn.sekyoro.top/imgs/065107.png" alt="image-20210921145536540"></p><p><img data-src="http://cdn.sekyoro.top/imgs/065109.png" alt="image-20210921145551066"></p><p>创建文件</p><h4 id="while循环"><a href="#while循环" class="headerlink" title="while循环"></a>while循环</h4><p>while 循环用于不断执行一系列命令，也用于从输入文件中读取数据；命令通常为测试条件。其格式为：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> condition</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="built_in">command</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><p><img data-src="http://cdn.sekyoro.top/imgs/065110.png" alt="image-20210921145855535"></p><p>(()) 双括号用于增加算术值,双括号里数值不用带$ 扩展,且可以进行很多算术运算</p><p>Bash let 命令，它用于执行一个或多个表达式，变量计算中不需要加上 <code>$</code> 来表示变量</p><h4 id="case"><a href="#case" class="headerlink" title="case"></a>case</h4><p>Shell case 语句为多选择语句。可以用 case 语句匹配一个值与一个模式，如果匹配成功，执行相匹配的命令。case 语句格式如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> 值 <span class="keyword">in</span></span><br><span class="line">模式1)</span><br><span class="line">    command1</span><br><span class="line">    command2</span><br><span class="line">    ...</span><br><span class="line">    commandN</span><br><span class="line">    ;;</span><br><span class="line">模式2）</span><br><span class="line">    command1</span><br><span class="line">    command2</span><br><span class="line">    ...</span><br><span class="line">    commandN</span><br><span class="line">    ;;</span><br><span class="line"><span class="keyword">esac</span></span><br></pre></td></tr></table></figure><ul><li>取值后面必须为单词 in，每一模式必须以右括号结束。取值可以为变量或常数。匹配发现取值符合某一模式后，其间所有命令开始执行直至 <code>;;</code>。</li><li>取值将检测匹配的每一个模式。一旦模式匹配，则执行完匹配模式相应命令后不再继续其他模式。如果无一匹配模式，使用星号 <code>*</code> 捕获该值，再执行后面的命令。</li></ul><p><img data-src="http://cdn.sekyoro.top/imgs/065112.png" alt="image-20210921150725884"></p><p>在循环过程中，有时候需要在未达到循环结束条件时强制跳出循环，Shell 使用两个命令来实现该功能：<code>break</code> 和 <code>continue</code>。</p><p><code>break</code> 命令</p><p>break 命令允许跳出所有循环（终止执行后面的所有循环）。</p><p>continue 命令与 break 命令类似，只有一点差别，它不会跳出所有循环，仅仅跳出当前循环<br><strong>esac</strong></p><p>case 的语法和 C family 语言差别很大，它需要一个 esac（就是 case 反过来）作为结束标记，每个 case 分支用右圆括号，用两个分号表示 break。</p><p><img data-src="http://cdn.sekyoro.top/imgs/065113.png" alt="image-20210921151953147"></p><h3 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h3><p>shell 中函数的定义格式如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[ <span class="keyword">function</span> ] funname [()]</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    action;</span><br><span class="line"></span><br><span class="line">    [<span class="built_in">return</span> int;]</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>说明：</p><ul><li>可以带 <code>function fun()</code> 定义，也可以直接 <code>fun()</code> 定义,不带任何参数。</li><li><p>参数返回，可以显示加：return 返回，如果不加，将以最后一条命令运行结果，作为返回值。 return 后跟数值 n(0-255)</p></li><li><p>函数返回值在调用该函数后通过 <code>$?</code> 来获得</p></li><li>所有函数在使用前必须定义。</li></ul><h3 id="函数参数"><a href="#函数参数" class="headerlink" title="函数参数"></a>函数参数</h3><p>在 Shell 中，调用函数时可以向其传递参数。在函数体内部，通过 <code>$n</code> 的形式来获取参数的值，例如，<code>$1</code> 表示第一个参数，<code>$2</code> 表示第二个参数…</p><p>带参数的函数示例：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="function"><span class="title">funWithParam</span></span>()&#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;The first parameter is <span class="variable">$1</span> !&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;The second parameter is <span class="variable">$2</span> !&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;The tenth parameter is <span class="variable">$10</span> !&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;The tenth parameter is <span class="variable">$&#123;10&#125;</span> !&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;The eleventh parameter is <span class="variable">$&#123;11&#125;</span> !&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;The total number of parameters is <span class="variable">$#</span> !&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Outputs all parameters as a string $* !&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">funWithParam 1 2 3 4 5 6 7 8 9 34 73</span><br></pre></td></tr></table></figure><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> Linux_study </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux日常管理与备份</title>
      <link href="2021/11/21/%E5%91%BD%E4%BB%A4%E9%9B%86-5/"/>
      <url>2021/11/21/%E5%91%BD%E4%BB%A4%E9%9B%86-5/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h3 id="Linux日常管理与备份"><a href="#Linux日常管理与备份" class="headerlink" title="Linux日常管理与备份"></a>Linux日常管理与备份</h3><span id="more"></span><h3 id="查看内存"><a href="#查看内存" class="headerlink" title="查看内存"></a>查看内存</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">free</span><br></pre></td></tr></table></figure><p><img data-src="http://cdn.sekyoro.top/imgs/070012.png" alt="image-20210916110839246"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /proc/meminfo</span><br></pre></td></tr></table></figure><p><img data-src="http://cdn.sekyoro.top/imgs/070017.png" alt="image-20210916111003753"></p><p>查看内存硬件信息</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dmidecode -t memory</span><br></pre></td></tr></table></figure><blockquote><p>DMI（Desktop Management Interface,DMI）就是帮助收集电脑系统信息的管理系统，DMI信息的收集必须在严格遵照SMBIOS规范的前提下进行。SMBIOS（System Management BIOS）是主板或系统制造者以标准格式显示产品管理信息所需遵循的统一规范。SMBIOS和DMI是由行业指导机构Desktop Management Task Force(DMTF)起草的开放性的技术标准，其中DMI设计适用于任何的平台和操作系统。</p></blockquote><p>语法</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">dmidecode</span><span class="meta"> [选项]</span></span><br></pre></td></tr></table></figure><p>选项</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="deletion">-d：(default:/dev/mem)从设备文件读取信息，输出内容与不加参数标准输出相同。</span></span><br><span class="line"><span class="deletion">-h：显示帮助信息。</span></span><br><span class="line"><span class="deletion">-s：只显示指定DMI字符串的信息。(string)</span></span><br><span class="line"><span class="deletion">-t：只显示指定条目的信息。(type)</span></span><br><span class="line"><span class="deletion">-u：显示未解码的原始条目内容。</span></span><br><span class="line"><span class="deletion">--dump-bin file：将DMI数据转储到一个二进制文件中。</span></span><br><span class="line"><span class="deletion">--from-dump FILE：从一个二进制文件读取DMI数据。</span></span><br><span class="line"><span class="deletion">-V：显示版本信息。</span></span><br></pre></td></tr></table></figure><p><img data-src="http://cdn.sekyoro.top/imgs/070020.png" alt="image-20210923161747688"></p><p>可以看到 maximum toal memory size 是491520MB</p><h3 id="查看cpu"><a href="#查看cpu" class="headerlink" title="查看cpu"></a>查看cpu</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat  /proc/cpuinfo </span><br></pre></td></tr></table></figure><p><img data-src="http://cdn.sekyoro.top/imgs/070026.png" alt="image-20210916111139244"></p><p>physical id 为cpu个数</p><p>cores为pcu核数</p><p>processor为逻辑cpu个数</p><p>GHz为cpu主频</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lscpu也可以查看信息</span><br></pre></td></tr></table></figure><p><img data-src="http://cdn.sekyoro.top/imgs/070027.png" alt="image-20210916111353437"></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uname -a </span><br></pre></td></tr></table></figure><p>可以查看os详细信息</p><h3 id="查看网络网卡ip"><a href="#查看网络网卡ip" class="headerlink" title="查看网络网卡ip"></a>查看网络网卡ip</h3><p>查看网卡</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dmesg | grep eth</span><br></pre></td></tr></table></figure><p><img data-src="http://cdn.sekyoro.top/imgs/070032.png" alt="image-20210916113058417"></p><p>netstat 命令用于显示各种网络相关信息，如网络连接，路由表，接口状态 (Interface Statistics)，masquerade 连接，多播成员 (Multicast Memberships) 等等。</p><p>列出所有端口 (包括监听和未监听的):</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat -a</span><br></pre></td></tr></table></figure><p>列出所有 tcp 端口:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat -at</span><br></pre></td></tr></table></figure><p>列出所有有监听的服务状态:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat -l</span><br></pre></td></tr></table></figure><p>lsof（list open files）是一个列出当前系统打开文件的工具。在linux环境下，任何事物都以文件的形式存在，通过文件不仅仅可以访问常规数据，还可以访问网络连接和硬件。所以如传输控制协议 (TCP) 和用户数据报协议 (UDP) 套接字等； 在查询网络端口时，经常会用到这个工具。</p><p>DNS查询，寻找域名domain对应的IP:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$host</span> domain</span><br></pre></td></tr></table></figure><p>反向DNS查询:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$host</span> IP</span><br></pre></td></tr></table></figure><p>查看网卡硬件信息</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lspci</span><br></pre></td></tr></table></figure><p><img data-src="http://cdn.sekyoro.top/imgs/070033.png" alt="image-20210923162412326"></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ip link show  <span class="comment">#查看系统网络接口</span></span><br></pre></td></tr></table></figure><p><img data-src="http://cdn.sekyoro.top/imgs/070036.png" alt="image-20210923162312191"></p><p><strong>ifconfig：</strong> 最常用的配置和查看网络接口信息的命令，服务器上执行此命令会得</p><p>到类下文的内容，一下内容可看到多个设备和设备状态、信息</p><p><img data-src="http://cdn.sekyoro.top/imgs/070038.png" alt="image-20210916112144422"></p><p>查看到了本机IP 地址与掩码</p><p><strong>iwconfig  ：</strong>用于查看无线网络，如果你设备上有无线网卡此时可用此命令来查看，我的设备上并没有无线网卡设备，因此会会得到如下信息。</p><p><img data-src="http://cdn.sekyoro.top/imgs/070039.png" alt="image-20210916112759401"></p><p>route命令查看本机网关</p><p><img data-src="http://cdn.sekyoro.top/imgs/070044.png" alt="image-20210916112628510"></p><div class="table-container"><table><thead><tr><th>命令</th><th>功能</th></tr></thead><tbody><tr><td><code>ping</code></td><td><strong>查询</strong>某个机器是否在工作</td></tr><tr><td><code>netstat</code></td><td>查看<strong>网络的状况</strong></td></tr><tr><td><code>nslookup</code></td><td>nslookup 查询域名和IP地址的对应</td></tr><tr><td><code>last和lastlog</code></td><td>查询<strong>用户登录信息</strong></td></tr><tr><td><code>raceroutet</code></td><td>用来<strong>检测传输的路径</strong></td></tr></tbody></table></div><h3 id="时间管理"><a href="#时间管理" class="headerlink" title="时间管理"></a>时间管理</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">date</span><br></pre></td></tr></table></figure><p>查询时间</p><p><img data-src="http://cdn.sekyoro.top/imgs/070045.png" alt="image-20210916113457346"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">timedatectl <span class="comment">#查询统一时间</span></span><br></pre></td></tr></table></figure><p><img data-src="http://cdn.sekyoro.top/imgs/070047.png" alt="image-20210916113806432"></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">date -s <span class="string">&quot;时间&quot;</span></span><br></pre></td></tr></table></figure><p>修改时间</p><h3 id="备份系统"><a href="#备份系统" class="headerlink" title="备份系统"></a>备份系统</h3><p>成为root用户</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo su</span><br></pre></td></tr></table></figure><p>然后进入文件系统的根目录(当然，如果你不想备份整个文件系统，你也可以进入你想要备份的目录，包括远程目录或者移动硬盘上的目录)：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cd /</span></span><br></pre></td></tr></table></figure><p>下面是我用来备份系统的完整命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># tar cvpzf backup.tgz –exclude=/proc –exclude=/lost+found –exclude=/backup.tgz –exclude=/mnt –exclude=/sys/</span></span><br></pre></td></tr></table></figure><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> Linux_study </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>css 练习</title>
      <link href="2021/11/05/css-%E7%BB%83%E4%B9%A0/"/>
      <url>2021/11/05/css-%E7%BB%83%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>在github上找到一个项目<a href="https://github.com/paola9896/CSS-Layouts-Tutorial.git">css布局</a></p><p>应该是比较简单的</p><span id="more"></span><p><img data-src="http://cdn.sekyoro.top/imgs/065920.png" alt="image-20211105224031125"></p><p>很简要是吧.</p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      
        <tags>
            
            <tag> css </tag>
            
            <tag> exercise </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>css揭秘</title>
      <link href="2021/11/04/css%E6%8F%AD%E7%A7%98/"/>
      <url>2021/11/04/css%E6%8F%AD%E7%A7%98/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>最近学习前端,css太折磨了</p><span id="more"></span><p>我并不是要所谓揭秘CSS,这只是个读书笔记</p><p><img data-src="http://cdn.sekyoro.top/imgs/093015.png" alt="image-20211104224927600"></p><p>之前写过css一点小知识,后来有往后看了看,没过几天就忘了…</p><p>现在的经验就是 总之就是记住重点,写点小东西.</p><p>css secrets+<a href="https://github.com/bradtraversy/vanillawebprojects">vanillawebprojects</a>+Javascript30</p><p>github上还有很多小练习</p><p>学习了一会css感觉布局很重要,其他元素啥的反而直接查文档就行了</p><h2 id="结构与布局"><a href="#结构与布局" class="headerlink" title="结构与布局"></a>结构与布局</h2><h3 id="自适应内部元素"><a href="#自适应内部元素" class="headerlink" title="自适应内部元素"></a>自适应内部元素</h3><p>如果不给元素指定一个具体的height,它就会自动适应内容的高度</p><p><img data-src="http://cdn.sekyoro.top/imgs/065251.png" alt="image-20211105143737238"></p><p>可以知道没有显示任何东西,如果写了内容就会随之变化</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">p</span>&gt;</span>Lorem ipsum dolor sit amet consectetur adipisicing elit. Ducimus eius omnis eum accusantium delectus ipsum fuga sunt, facere quasi impedit voluptas dolorem accusamus natus error hic quod fugit deleniti perspiciatis?<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">figure</span>&gt;</span></span><br><span class="line"> ![不支持](https://cdn.pixabay.com/photo/2021/10/13/11/31/couple-6706278_960_720.jpg)</span><br><span class="line">        <span class="tag">&lt;<span class="name">figcaption</span>&gt;</span></span><br><span class="line">Lorem ipsum dolor sit amet consectetur adipisicing elit. Mollitia cumque perspiciatis maxime nulla animi saepe ipsum magni aspernatur nam ex natus nobis voluptatem tempora, molestias esse sed minima vero dignissimos?</span><br><span class="line">        <span class="tag">&lt;/<span class="name">figcaption</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">figure</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>Lorem ipsum dolor sit amet consectetur, adipisicing elit. Ut accusamus, repudiandae minus, placeat voluptatibus blanditiis explicabo expedita nobis distinctio velit deleniti, dignissimos totam nam debitis sit repellat officiis ratione atque?<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure><p>可以知道图片与文字并不一样宽.</p><p>我们希望文字与图片一样宽,而且居中.</p><p>需要解决的问题,元素宽度由内部因素而不是外部因素决定.</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;background-color: aqua;&quot;</span>&gt;</span></span><br><span class="line">        Lorem ipsum dolor sit amet consectetur adipisicing elit. Eaque qui reprehenderit recusandae omnis porro, illo itaque molestias exercitationem. Id ipsam delectus enim dolorum animi. Quibusdam optio ipsa culpa nulla veniam!</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>Lorem ipsum dolor sit amet consectetur adipisicing elit. Ducimus eius omnis eum accusantium delectus ipsum fuga sunt, facere quasi impedit voluptas dolorem accusamus natus error hic quod fugit deleniti perspiciatis?<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">figure</span> <span class="attr">style</span>=<span class="string">&quot;width: min-content;max-width: min-content; max-width: 300px; margin:  auto;&quot;</span>&gt;</span></span><br><span class="line"> ![不支持](https://cdn.pixabay.com/photo/2021/10/13/11/31/couple-6706278_960_720.jpg)</span><br><span class="line">        <span class="tag">&lt;<span class="name">figcaption</span>&gt;</span></span><br><span class="line">Lorem ipsum dolor sit amet consectetur adipisicing elit. Mollitia cumque perspiciatis maxime nulla animi saepe ipsum magni aspernatur nam ex natus nobis voluptatem tempora, molestias esse sed minima vero dignissimos?</span><br><span class="line">        <span class="tag">&lt;/<span class="name">figcaption</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">figure</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>Lorem ipsum dolor sit amet consectetur, adipisicing elit. Ut accusamus, repudiandae minus, placeat voluptatibus blanditiis explicabo expedita nobis distinctio velit deleniti, dignissimos totam nam debitis sit repellat officiis ratione atque?<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="精确控制表格列宽"><a href="#精确控制表格列宽" class="headerlink" title="精确控制表格列宽"></a>精确控制表格列宽</h3><p>表格对于不固定的内容来说显示不好</p><p>tableLayout 属性用来显示表格单元格、行、列的算法规则。</p><p>一般的表格display:table列宽不会相等,也就是说每行宽度分配不同.</p><p>如果用table-layout:fixed</p><p>```html<br>&lt;!DOCTYPE html&gt;</p><p><html lang="en"></p><p><head><br>    <meta charset="UTF-8"><br>    <meta http-equiv="X-UA-Compatible" content="IE=edge"><br>    <meta name="viewport" content="width=device-width, initial-scale=1.0"><br>    <title>Document</title><br>    <style><br>        /**</p><ul><li>Taming table column widths<br>*/</li></ul><p>body { background: #ddd }</p><p>section {<br>    width: 500px;<br>    margin: 2em;<br>    background: white;<br>}</p><p>table {<br>    border-collapse: collapse;<br>    margin-bottom: 1em;<br>    width: 100%;<br>}</p><p>section + section table { table-layout: fixed }</p><p>td {<br>    border: 1px solid #aaa;<br>}</p><p>td.preformatted {<br>    white-space: pre;<br>    font-family: Consolas, Monaco, monospace;<br>    text-overflow: ellipsis;<br>    overflow: hidden;<br>}<br>    &lt;/style&gt;<br>&lt;/head&gt;</p><p><body><br>    <section><br>    <h1>With table-layout: auto</h1><br>    <div><br>        <table>            <tr>                <td>If we don’t…</td>                <td>specify a cell width, they will be assigned one that depends on their contents. Notice how the cell with the more content here is much wider.</td>            </tr>        </table></p><pre><code>    &lt;table&gt;        &lt;tr&gt;            &lt;td&gt;If we don’t…&lt;/td&gt;            &lt;td&gt;specify a cell width, they will be assigned one that depends on their contents. Notice how the cell with the more content here is much wider.&lt;/td&gt;        &lt;/tr&gt;        &lt;tr&gt;            &lt;td&gt;All rows take part in calculating the widths, not just the first one.&lt;/td&gt;            &lt;td&gt;Notice how the dimensions here are different than the previous example.&lt;/td&gt;        &lt;/tr&gt;    &lt;/table&gt;    &lt;table&gt;        &lt;tr&gt;            &lt;td style=&quot;width: 1000px&quot;&gt;If we specify a width, it will not always be followed. I have a width of &lt;code&gt;1000px&lt;/code&gt;…&lt;/td&gt;            &lt;td style=&quot;width: 2000px&quot;&gt;…and I have a width of &lt;code&gt;2000px&lt;/code&gt;. Because there’s not enough space for &lt;code&gt;3000px&lt;/code&gt;, they are reduced proportionally, to 33.3% and 66.6% of the total width.&lt;/td&gt;        &lt;/tr&gt;    &lt;/table&gt;    &lt;table&gt;        &lt;tr&gt;            &lt;td&gt;If we prevent word wrapping, the table can become so wide it grows beyond its container.&lt;/td&gt;            &lt;td class=&quot;preformatted&quot;&gt;…and &lt;code&gt;text-overflow: ellipsis&lt;/code&gt; doesn’t help either.&lt;/td&gt;        &lt;/tr&gt;    &lt;/table&gt;    &lt;table&gt;        &lt;tr&gt;            &lt;td&gt;Large images and blocks of code can also cause the same issue.&lt;/td&gt;</code></pre><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      
        <tags>
            
            <tag> css </tag>
            
            <tag> reading </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>微信小程序学习</title>
      <link href="2021/11/03/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%AD%A6%E4%B9%A0/"/>
      <url>2021/11/03/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>之前学过一点基础的,现在调一下api<br><span id="more"></span></p><h2 id="网络部分"><a href="#网络部分" class="headerlink" title="网络部分"></a>网络部分</h2><h3 id="相关信息"><a href="#相关信息" class="headerlink" title="相关信息"></a>相关信息</h3><p>小程序/服务器架构是CS架构</p><p>小程序网络API在发起网络请求时使用JSON格式的文本进行数据交换</p><h3 id="服务器域名配置"><a href="#服务器域名配置" class="headerlink" title="服务器域名配置"></a>服务器域名配置</h3><p>这里的服务器可以是你自己的,也可以是wechat或者其他第三方的.</p><p>选择【设置】—【开发设置】—【服务器域名】进行添加或修改</p><p><img data-src="http://cdn.sekyoro.top/imgs/094011.png" alt="image-20211103193519336"></p><ul><li><p>域名只支持 https (request、uploadFile、downloadFile) 和 wss (connectSocket) 协议；</p></li><li><p>域名不能使用 IP 地址或 localhost；域名必须经过 ICP 备案；</p></li><li><p>出于安全考虑，api.weixin.qq.com 不能被配置为服务器域名，相关API也不能在小程序内调</p><p>用。开发者应将 appsecret 保存到后台服务器中，通过服务器使用 appsecret 获取 accesstoken，并调用相关 API；每类接口分别可以配置最多 20 个域名。</p></li></ul><p>且配置次数每个月有限制</p><p>自己的服务器还要有HTTP证书等,总之用这个最好还是用微信自己的或者第三方的</p><p>小程序对服务器端没有软件和语言的限制条件，用户可以根据自己实际情况选择Apache、Ngnix、Tomcat等任意一款服务器软件进行安装部署，以及选用PHP、Node.js、J2EE等任意一种语言进行后端开发。</p><h3 id="练习"><a href="#练习" class="headerlink" title="练习"></a>练习</h3><p>这里说一下临时部署,就是在本地电脑上部署,在服务器其实类似</p><p>可以用Apache,ngnix服务器软件搭配php,nodejs等进行开发</p><p>可以安装phpstudy学习,挺好的软件 </p><p>有php,Apache,ngnix,mysql数据库集成</p><p><img data-src="http://cdn.sekyoro.top/imgs/094012.png" alt="image-20211103194554124"></p><p>这样就可以本地测试了.</p><h3 id="发起请求"><a href="#发起请求" class="headerlink" title="发起请求"></a>发起请求</h3><p>小程序使用wx.request(OBJECT) 发起网络请求</p><div class="table-container"><table><thead><tr><th><strong>参数名</strong></th><th><strong>类型</strong></th><th><strong>必填</strong></th><th><strong>说明</strong></th></tr></thead><tbody><tr><td><strong>url</strong></td><td>String</td><td>是</td><td>开发者或第三方服务器接口地址</td></tr><tr><td><strong>data</strong></td><td>Object/String/ArrayBuffer</td><td>否</td><td>请求的参数</td></tr><tr><td><strong>header</strong></td><td>Object</td><td>否</td><td>设置请求的 header，header 中不能设置 Referer（其中content-type 默认为 ‘application/json’）</td></tr><tr><td><strong>method</strong></td><td>String</td><td>否</td><td>有效值：OPTIONS, GET, HEAD, POST, PUT, DELETE, TRACE, CONNECT（默认值是GET）</td></tr><tr><td><strong>dataType</strong></td><td>String</td><td>否</td><td>默认值为json。如果设为json，会尝试对返回的数据做一次 JSON.parse</td></tr><tr><td><strong>responseType</strong></td><td>String</td><td>否</td><td>设置响应的数据类型。合法值：text、arraybuffer。默认值为text。最低版本1.7.0</td></tr><tr><td><strong>success</strong></td><td>Function</td><td>否</td><td>收到服务器成功返回的回调函数</td></tr><tr><td><strong>fail</strong></td><td>Function</td><td>否</td><td>接口调用失败的回调函数</td></tr><tr><td><strong>complete</strong></td><td>Function</td><td>否</td><td>接口调用结束的回调函数（调用成功与否都会执行）</td></tr></tbody></table></div><p>success返回参数</p><div class="table-container"><table><thead><tr><th><strong>参数</strong></th><th><strong>类型</strong></th><th><strong>说明</strong></th></tr></thead><tbody><tr><td><strong>data</strong></td><td>Object/String/ArrayBuffer</td><td>开发者服务器返回的数据</td></tr><tr><td><strong>statusCode</strong></td><td>Number</td><td>开发者服务器返回的HTTP 状态码</td></tr><tr><td><strong>header</strong></td><td>Object</td><td>开发者服务器返回的HTTP Response Header，最低版本1.2.0</td></tr></tbody></table></div><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">wx.request(&#123;</span><br><span class="line">  <span class="attr">url</span>: <span class="string">&#x27;https://test.com/&#x27;</span>, <span class="comment">//仅为示例，并非真实的接口地址</span></span><br><span class="line">  <span class="attr">data</span>: &#123;</span><br><span class="line">     <span class="attr">x</span>: <span class="string">&#x27;123&#x27;</span> ,  <span class="comment">//数据的key和value由开发者自定义</span></span><br><span class="line">     <span class="attr">y</span>: <span class="string">&#x27;456&#x27;</span>   <span class="comment">//这里的数据仅为示例</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">success</span>: <span class="function"><span class="keyword">function</span>(<span class="params">res</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(res.data) <span class="comment">//返回的数据</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>最终发送给服务器的data数据是String类型，如果传入的data是其他类型也会被转换成String</p><ul><li>对于 GET 方法的数据，会将数据转换成 query string（key1=value1&amp;key2=value2…）；</li><li>对于 POST 方法且 header[‘content-type’] 为 application/json 的数据，会对数据进行 JSON 序列化；</li><li>对于 POST 方法且 header[‘content-type’] 为 application/x-www-form-urlencoded 的数据，会将数据转换成 query string （key1=value1&amp;key2=value2…）</li></ul><h3 id="中断请求"><a href="#中断请求" class="headerlink" title="中断请求"></a>中断请求</h3><p>wx.request(OBJECT)接口返回一个requestTask对象，通过该对象的abort方法可以中断请求任务。requestTask对象的方法如表所示。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> requestTask = wx.request(&#123;</span><br><span class="line">  <span class="attr">url</span>: <span class="string">&#x27;https://test.com/&#x27;</span>, <span class="comment">//仅为示例，并非真实的接口地址</span></span><br><span class="line">  <span class="attr">data</span>: &#123;</span><br><span class="line">     <span class="attr">x</span>: <span class="string">&#x27;123&#x27;</span> ,  <span class="comment">//数据的key和value由开发者自定义</span></span><br><span class="line">     <span class="attr">y</span>: <span class="string">&#x27;456&#x27;</span>   <span class="comment">//这里的数据仅为示例</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">success</span>: <span class="function"><span class="keyword">function</span>(<span class="params">res</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(res.data)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line">requestTask.abort() <span class="comment">// 取消请求任务</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h3><h4 id="上传请求"><a href="#上传请求" class="headerlink" title="上传请求"></a>上传请求</h4><p>小程序使用wx.uploadFile(OBJECT)可以将本地资源上传到开发者服务器，上传时将从客户端发起一个 HTTPS POST请求到服务器，其中content-type为multipart/form-data。<br>该接口的OBJECT参数说明如表所示。</p><div class="table-container"><table><thead><tr><th><strong>参数</strong></th><th><strong>类型</strong></th><th><strong>必填</strong></th><th><strong>说明</strong></th></tr></thead><tbody><tr><td><strong>url</strong></td><td>String</td><td>是</td><td>开发者服务器 url</td></tr><tr><td><strong>filePath</strong></td><td>String</td><td>是</td><td>要上传文件资源的路径</td></tr><tr><td><strong>name</strong></td><td>String</td><td>是</td><td>文件对应的 key , 开发者在服务器端通过这个 key 可以获取到文件二进制内容</td></tr><tr><td><strong>header</strong></td><td>Object</td><td>否</td><td>HTTP 请求 Header, header 中不能设置 Referer</td></tr><tr><td><strong>formData</strong></td><td>Object</td><td>否</td><td>HTTP 请求中其他额外的 form data</td></tr><tr><td><strong>success</strong></td><td>Function</td><td>否</td><td>接口调用成功的回调函数</td></tr><tr><td><strong>fail</strong></td><td>Function</td><td>否</td><td>接口调用失败的回调函数</td></tr><tr><td><strong>complete</strong></td><td>Function</td><td>否</td><td>接口调用结束的回调函数（调用成功与否都会执行）</td></tr></tbody></table></div><p>成功时返回的数据</p><div class="table-container"><table><thead><tr><th><strong>data</strong></th><th>String</th><th>开发者服务器返回的数据</th></tr></thead><tbody><tr><td><strong>statusCode</strong></td><td>Number</td><td>开发者服务器返回的 HTTP 状态码</td></tr></tbody></table></div><p>该接口与其他接口一起使用</p><p>页面通过wx.chooseImage接口获取到一个本地资源的临时文件路径后，可通过此接口将本地资源上传到指定服务器.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">wx.chooseImage(&#123;</span><br><span class="line">  <span class="attr">success</span>: <span class="function"><span class="keyword">function</span>(<span class="params">res</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> tempFilePaths = res.tempFilePaths</span><br><span class="line">    wx.uploadFile(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="string">&#x27;https://example.weixin.qq.com/upload&#x27;</span>, <span class="comment">//仅为示例，非真实的接口地址</span></span><br><span class="line">      <span class="attr">filePath</span>: tempFilePaths[<span class="number">0</span>],</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&#x27;file&#x27;</span>,</span><br><span class="line">      <span class="attr">formData</span>:&#123;</span><br><span class="line">        <span class="string">&#x27;user&#x27;</span>: <span class="string">&#x27;test&#x27;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">success</span>: <span class="function"><span class="keyword">function</span>(<span class="params">res</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> data = res.data</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="上传任务对象"><a href="#上传任务对象" class="headerlink" title="上传任务对象"></a>上传任务对象</h4><p>wx.uploadFile(OBJECT)接口返回一个uploadTask对象，通过该对象可监听文件上传进度变化事件.</p><div class="table-container"><table><thead><tr><th><strong>方法</strong></th><th><strong>参数</strong></th><th><strong>说明</strong></th><th><strong>最低版本</strong></th></tr></thead><tbody><tr><td><strong>onProgressUpdate</strong></td><td>callback</td><td>监听上传进度变化</td><td>1.4.0</td></tr><tr><td><strong>abort</strong></td><td></td><td>中断上传任务</td><td>1.4.0</td></tr></tbody></table></div><p>onProgressUpdate返回参数</p><div class="table-container"><table><thead><tr><th><strong>参数</strong></th><th><strong>类型</strong></th><th><strong>说明</strong></th></tr></thead><tbody><tr><td><strong>progress</strong></td><td>Number</td><td>上传进度百分比</td></tr><tr><td><strong>totalBytesSent</strong></td><td>Number</td><td>已经上传的数据长度，单位 Bytes</td></tr><tr><td><strong>totalBytesExpectedToSend</strong></td><td>Number</td><td>预期需要上传的数据总长度，单位 Bytes</td></tr></tbody></table></div><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> uploadTask = wx.uploadFile(&#123;</span><br><span class="line">    …</span><br><span class="line">&#125;)</span><br><span class="line">uploadTask.onProgressUpdate(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;上传进度&#x27;</span>, res.progress)</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;已经上传的数据长度&#x27;</span>, res.totalBytesSent)</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;预期需要上传的数据总长度&#x27;</span>, res.totalBytesExpectedToSend)</span><br><span class="line">&#125;)</span><br><span class="line">uploadTask.abort() <span class="comment">// 取消上传任务</span></span><br></pre></td></tr></table></figure><h4 id="文件下载"><a href="#文件下载" class="headerlink" title="文件下载"></a>文件下载</h4><p>使用wx.downloadFile(OBJECT)可以从服务器下载文件资源到本地，OBJECT参数说明如表所示。</p><div class="table-container"><table><thead><tr><th><strong>参数</strong></th><th><strong>类型</strong></th><th><strong>必填</strong></th><th><strong>说明</strong></th></tr></thead><tbody><tr><td><strong>url</strong></td><td>String</td><td>是</td><td>下载资源的 url</td></tr><tr><td><strong>header</strong></td><td>Object</td><td>否</td><td>HTTP 请求 Header，header 中不能设置 Referer</td></tr><tr><td><strong>success</strong></td><td>Function</td><td>否</td><td>下载成功后以 tempFilePath 的形式传给页面，res = {tempFilePath: ‘文件的临时路径’}</td></tr><tr><td><strong>fail</strong></td><td>Function</td><td>否</td><td>接口调用失败的回调函数</td></tr><tr><td><strong>complete</strong></td><td>Function</td><td>否</td><td>接口调用结束的回调函数（调用成功与否都执行）</td></tr></tbody></table></div><p>success返回参数</p><div class="table-container"><table><thead><tr><th><strong>参数</strong></th><th><strong>类型</strong></th><th><strong>说明</strong></th></tr></thead><tbody><tr><td><strong>tempFilePath</strong></td><td>String</td><td>临时文件路径，下载后的文件会存储到一个临时文件</td></tr><tr><td><strong>statusCode</strong></td><td>Number</td><td>开发者服务器返回的 HTTP 状态码</td></tr></tbody></table></div><p>下载文件的原理是客户端直接发起一个HTTP GET请求，返回文件的本地临时路径。需要注意的是，本地临时路径文件在小程序本次启动期间可以正常使用，如需持久保存，需在主动调用 wx.saveFile才能在小程序下次启动时访问得到。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">wx.downloadFile(&#123;</span><br><span class="line">  <span class="attr">url</span>: <span class="string">&#x27;https://example.com/audio/123&#x27;</span>, <span class="comment">//仅为示例，并非真实的资源</span></span><br><span class="line">  <span class="attr">success</span>: <span class="function"><span class="keyword">function</span>(<span class="params">res</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 只要服务器有响应数据，就会把响应内容写入文件并进入 success 回调</span></span><br><span class="line">    <span class="keyword">if</span> (res.statusCode === <span class="number">200</span>) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(res.tempFilePath) <span class="comment">//文件临时路径地址</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="下载任务对象"><a href="#下载任务对象" class="headerlink" title="下载任务对象"></a>下载任务对象</h4><p>wx.downloadFile(OBJECT)返回一个downloadTask对象，通过downloadTask，可监听下载进度变化事件，以及取消下载任务。该接口从基础库 1.4.0 开始支持，低版本需做兼容处理。downloadTask对象的方法列表如表所示</p><div class="table-container"><table><thead><tr><th><strong>方法</strong></th><th><strong>参数</strong></th><th><strong>说明</strong></th><th><strong>最低版本</strong></th></tr></thead><tbody><tr><td><strong>onProgressUpdate</strong></td><td>callback</td><td>监听下载进度变化</td><td>1.4.0</td></tr><tr><td><strong>abort</strong></td><td>无</td><td>中断下载任务</td><td>1.4.0</td></tr></tbody></table></div><p>onProgressUpdate返回参数说明</p><div class="table-container"><table><thead><tr><th><strong>progress</strong></th><th>Number</th><th>下载进度百分比</th></tr></thead><tbody><tr><td><strong>totalBytesWritten</strong></td><td>Number</td><td>已经下载的数据长度，单位 Bytes</td></tr><tr><td><strong>totalBytesExpectedToWrite</strong></td><td>Number</td><td>预期需要下载的数据总长度，单位 Bytes</td></tr></tbody></table></div><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> downloadTask = wx.downloadFile(&#123;</span><br><span class="line">    …</span><br><span class="line">&#125;)</span><br><span class="line">downloadTask.onProgressUpdate(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;下载进度&#x27;</span>, res.progress)</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;已经下载的数据长度&#x27;</span>, res.totalBytesWritten)</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;预期需要下载的数据总长度&#x27;</span>, res.totalBytesExpectedToWrite)</span><br><span class="line">&#125;)</span><br><span class="line">downloadTask.abort() <span class="comment">// 取消下载任务</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="图片管理"><a href="#图片管理" class="headerlink" title="图片管理"></a>图片管理</h2><p>小程序使用wx.chooseImage(OBJECT)从本地相册选择图片或使用相机拍照获得图片，图片将被存放在设备的临时路径，在小程序本次启动期间可以正常使用。</p><h3 id="选择图片"><a href="#选择图片" class="headerlink" title="选择图片"></a>选择图片</h3><div class="table-container"><table><thead><tr><th><strong>参数</strong></th><th><strong>类型</strong></th><th><strong>必填</strong></th><th><strong>说明</strong></th></tr></thead><tbody><tr><td><strong>count</strong></td><td>Number</td><td>否</td><td>最多可以选择的图片张数，默认9</td></tr><tr><td><strong>sizeType</strong></td><td>StringArray</td><td>否</td><td>original 原图，compressed 压缩图，默认二者都有</td></tr><tr><td><strong>sourceType</strong></td><td>StringArray</td><td>否</td><td>album 从相册选图，camera 使用相机，默认二者都有</td></tr><tr><td><strong>success</strong></td><td>Function</td><td>是</td><td>成功则返回图片的本地文件路径列表 tempFilePaths</td></tr><tr><td><strong>fail</strong></td><td>Function</td><td>否</td><td>接口调用失败的回调函数</td></tr><tr><td><strong>complete</strong></td><td>Function</td><td>否</td><td>接口调用结束的回调函数（调用成功与否都执行）</td></tr></tbody></table></div><p>success返回参数</p><p>tempFilePaths：StringArray类型，表示图片的本地文件路径列表；<br>tempFiles：ObjectArray类型，表示图片的本地文件列表，每项是一个File对象，最低版本1.2.0开始支持</p><p>File 对象结构说明如下：<br>path：String类型，表示本地文件路径；<br>size：Number类型，表示本地文件大小，单位：B。<br>需要注意是，wx.chooseImage获得的图片仅能在小程序启动期间临时使用。如需持久保存，需在主动调用 wx.saveFile进行保存，在小程序下次启动时才能访问得到。</p><h3 id="预览图片"><a href="#预览图片" class="headerlink" title="预览图片"></a>预览图片</h3><p>小程序使用wx.previewImage(OBJECT) 预览图片，OBJECT参数说明如表所示</p><div class="table-container"><table><thead><tr><th><strong>参数</strong></th><th><strong>类型</strong></th><th><strong>必填</strong></th><th><strong>说明</strong></th></tr></thead><tbody><tr><td><strong>current</strong></td><td>String</td><td>否</td><td>当前显示图片的链接，不填则默认为 urls 的第一张</td></tr><tr><td><strong>urls</strong></td><td>StringArray</td><td>是</td><td>需要预览的图片链接列表</td></tr><tr><td><strong>success</strong></td><td>Function</td><td>否</td><td>接口调用成功的回调函数</td></tr><tr><td><strong>fail</strong></td><td>Function</td><td>否</td><td>接口调用失败的回调函数</td></tr><tr><td><strong>complete</strong></td><td>Function</td><td>否</td><td>接口调用结束的回调函数（调用成功与否都执行）</td></tr></tbody></table></div><h3 id="获取图片信息"><a href="#获取图片信息" class="headerlink" title="获取图片信息"></a>获取图片信息</h3><p>wx.getImageInfo(OBJECT) 获取图片信息</p><div class="table-container"><table><thead><tr><th><strong>参数</strong></th><th><strong>类型</strong></th><th><strong>必填</strong></th><th><strong>说明</strong></th></tr></thead><tbody><tr><td><strong>src</strong></td><td>String</td><td>是</td><td>图片的路径，可以是相对路径，临时文件路径，存储文件路径，网络图片路径</td></tr><tr><td><strong>success</strong></td><td>Function</td><td>否</td><td>接口调用成功的回调函数</td></tr><tr><td><strong>fail</strong></td><td>Function</td><td>否</td><td>接口调用失败的回调函数</td></tr><tr><td><strong>complete</strong></td><td>Function</td><td>否</td><td>接口调用结束的回调函数（调用成功与否都执行）</td></tr></tbody></table></div><p>success返回参数</p><div class="table-container"><table><thead><tr><th><strong>参数</strong></th><th><strong>类型</strong></th><th><strong>说明</strong></th><th><strong>最低版本</strong></th></tr></thead><tbody><tr><td><strong>width</strong></td><td>Number</td><td>图片宽度，单位px</td><td></td></tr><tr><td><strong>height</strong></td><td>Number</td><td>图片高度，单位px</td><td></td></tr><tr><td><strong>path</strong></td><td>String</td><td>返回图片的本地路径</td><td></td></tr><tr><td><strong>orientation</strong></td><td>String</td><td>返回图片的方向</td><td>1.9.90</td></tr><tr><td><strong>type</strong></td><td>String</td><td>返回图片的格式</td><td>1.9.90</td></tr></tbody></table></div><p>orientation参数</p><div class="table-container"><table><thead><tr><th><strong>枚举值</strong></th><th><strong>说明</strong></th></tr></thead><tbody><tr><td><strong>up</strong></td><td>默认</td></tr><tr><td><strong>down</strong></td><td>180度旋转</td></tr><tr><td><strong>left</strong></td><td>逆时针旋转90度</td></tr><tr><td><strong>right</strong></td><td>顺时针旋转90度</td></tr><tr><td><strong>up-mirrored</strong></td><td>同up，但水平翻转</td></tr><tr><td><strong>down-mirrored</strong></td><td>同down，但水平翻转</td></tr><tr><td><strong>left-mirrored</strong></td><td>同left，但垂直翻转</td></tr><tr><td><strong>right-mirrored</strong></td><td>同right，但垂直翻转</td></tr></tbody></table></div><p>保存图像</p><p>小程序使用wx.saveImageToPhotosAlbum(OBJECT) 保存图片到系统相册</p><p>需要用户授权 scope.writePhotosAlbum</p><div class="table-container"><table><thead><tr><th><strong>参数名</strong></th><th><strong>类型</strong></th><th><strong>必填</strong></th><th><strong>说明</strong></th></tr></thead><tbody><tr><td><strong>filePath</strong></td><td>String</td><td>是</td><td>图片文件路径，可以是临时文件路径也可以是永久文件路径，不支持网络图片路径</td></tr><tr><td><strong>success</strong></td><td>Function</td><td>否</td><td>接口调用成功的回调函数，返回String类型参数errMsg，表示调用结果</td></tr><tr><td><strong>fail</strong></td><td>Function</td><td>否</td><td>接口调用失败的回调函数</td></tr><tr><td><strong>complete</strong></td><td>Function</td><td>否</td><td>接口调用结束的回调函数（调用成功与否都执行）</td></tr></tbody></table></div><h3 id="录音管理"><a href="#录音管理" class="headerlink" title="录音管理"></a>录音管理</h3><p>小程序使用wx.getRecorderManager()获取全局唯一的录音管理器 recorderManager</p><div class="table-container"><table><thead><tr><th><strong>方法</strong></th><th><strong>参数</strong></th><th><strong>说明</strong></th></tr></thead><tbody><tr><td><strong>start</strong></td><td>options</td><td>开始录音</td></tr><tr><td><strong>pause</strong></td><td></td><td>暂停录音</td></tr><tr><td><strong>resume</strong></td><td></td><td>继续录音</td></tr><tr><td><strong>stop</strong></td><td></td><td>停止录音</td></tr><tr><td><strong>onStart</strong></td><td>callback</td><td>录音开始事件</td></tr><tr><td><strong>onPause</strong></td><td>callback</td><td>录音暂停事件</td></tr><tr><td><strong>onStop</strong></td><td>callback</td><td>录音停止事件，返回String类型参数tempFilePath表示录音文件的临时路径</td></tr><tr><td><strong>onFrameRecorded</strong></td><td>callback</td><td>已录制完指定帧大小的文件，会回调录音分片结果数据。如果设置了frameSize，则会回调此事件。</td></tr><tr><td><strong>onError</strong></td><td>callback</td><td>录音错误事件，返回String类型参数errMsg表示错误信息</td></tr></tbody></table></div><p>start(options)方法参数</p><div class="table-container"><table><thead><tr><th><strong>duration</strong></th><th>Number</th><th>否</th><th>指定录音的时长，单位 ms ，如果传入了合法的 duration ，在到达指定的 duration 后会自动停止录音，最大值 600000（10 分钟）,默认值 60000（1 分钟）</th><th>1.6.0</th></tr></thead><tbody><tr><td><strong>sampleRate</strong></td><td>Number</td><td>否</td><td>采样率，有效值 8000/16000/44100</td><td>1.6.0</td></tr><tr><td><strong>numberOfChannels</strong></td><td>Number</td><td>否</td><td>录音通道数，有效值 1/2</td><td>1.6.0</td></tr><tr><td><strong>encodeBitRate</strong></td><td>Number</td><td>否</td><td>编码码率，有效值见下表格</td><td>1.6.0</td></tr><tr><td><strong>format</strong></td><td>String</td><td>否</td><td>音频格式，有效值 aac/mp3</td><td>1.6.0</td></tr><tr><td><strong>frameSize</strong></td><td>Number</td><td>否</td><td>指定帧大小，单位 KB。传入 frameSize 后，每录制指定帧大小的内容后，会回调录制的文件内容，不指定则不会回调。暂仅支持 mp3 格式</td><td>1.6.0</td></tr><tr><td><strong>audioSource</strong></td><td>String</td><td>否</td><td>指定音频输入源，默认值为 ‘auto’</td><td>2.1.0</td></tr></tbody></table></div><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      
        <tags>
            
            <tag> wechat </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>css学习</title>
      <link href="2021/10/20/css%E5%AD%A6%E4%B9%A0/"/>
      <url>2021/10/20/css%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>没有css,就没有前端!</p><span id="more"></span><p>CSS 用于定义网页的样式，包括针对不同设备和屏幕尺寸的设计和布局</p><p>样式定义通常保存在外部 .css 文件中。</p><p>通过使用外部样式表文件，您只需更改一个文件即可更改整个网站的外观！</p><h2 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h2><p><img data-src="http://cdn.sekyoro.top/imgs/093515.png" alt="image-20211020200204328"></p><p>可以将 CSS 选择器分为五类：</p><ul><li>简单选择器（根据名称、id、类来选取元素）</li><li><a href="https://www.w3school.com.cn/css/css_combinators.asp">组合器选择器</a>（根据它们之间的特定关系来选取元素）</li><li><a href="https://www.w3school.com.cn/css/css_pseudo_classes.asp">伪类选择器</a>（根据特定状态选取元素）</li><li><a href="https://www.w3school.com.cn/css/css_pseudo_elements.asp">伪元素选择器</a>（选取元素的一部分并设置其样式）</li><li><a href="https://www.w3school.com.cn/css/css_attribute_selectors.asp">属性选择器</a>（根据属性或属性值来选取元素）</li></ul><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">p</span> &#123;</span><br><span class="line">  <span class="attribute">text-align</span>: center;</span><br><span class="line">  <span class="attribute">color</span>: red;</span><br><span class="line">&#125;//通过元素名称</span><br><span class="line"><span class="selector-id">#para1</span> &#123;</span><br><span class="line">  <span class="attribute">text-align</span>: center;</span><br><span class="line">  <span class="attribute">color</span>: red;</span><br><span class="line">&#125;//通过id</span><br><span class="line"><span class="selector-class">.center</span> &#123;</span><br><span class="line">  <span class="attribute">text-align</span>: center;</span><br><span class="line">  <span class="attribute">color</span>: red;</span><br><span class="line">&#125;//通过类</span><br></pre></td></tr></table></figure><p>通用选择</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">* &#123;</span><br><span class="line">  <span class="attribute">text-align</span>: center;</span><br><span class="line">  <span class="attribute">color</span>: blue;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="插入方法"><a href="#插入方法" class="headerlink" title="插入方法"></a>插入方法</h3><p>有三种插入样式表的方法：</p><ul><li>外部 CSS</li><li>内部 CSS</li><li>行内 CSS</li></ul><p>外部</p><p>通过使用外部样式表，您只需修改一个文件即可改变整个网站的外观！</p><p>每张 HTML 页面必须在 head 部分的 link 元素内包含对外部样式表文件的引用</p><p>请勿在属性值和单位之间添加空格</p><p>内部</p><p>内部样式是在 head 部分的 style 元素中进行定义</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="css"></span></span><br><span class="line"><span class="css"><span class="selector-tag">body</span> &#123;</span></span><br><span class="line"><span class="css">  <span class="attribute">background-color</span>: linen;</span></span><br><span class="line"><span class="css">&#125;</span></span><br><span class="line"><span class="css"></span></span><br><span class="line"><span class="css"><span class="selector-tag">h1</span> &#123;</span></span><br><span class="line"><span class="css">  <span class="attribute">color</span>: maroon;</span></span><br><span class="line"><span class="css">  <span class="attribute">margin-left</span>: <span class="number">40px</span>;</span></span><br><span class="line"><span class="css">&#125; </span></span><br><span class="line"><span class="css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure><p>行内</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">style</span>=<span class="string">&quot;color:blue;text-align:center;&quot;</span>&gt;</span>This is a heading<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">style</span>=<span class="string">&quot;color:red;&quot;</span>&gt;</span>This is a paragraph.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure><p>慎用</p><p>层叠顺序</p><p>页面中的所有样式将按照以下规则“层叠”为新的“虚拟”样式表，其中第一优先级最高：</p><ol><li>行内样式（在 HTML 元素中）</li><li>外部和内部样式表（在 head 部分）</li><li>浏览器默认样式</li></ol><h2 id="颜色"><a href="#颜色" class="headerlink" title="颜色"></a>颜色</h2><p>CSS/HTML 支持 140 种标准颜色名</p><p>RGB</p><p>RGBA 颜色值是具有 alpha 通道的 RGB 颜色值的扩展 - 它指定了颜色的不透明度。</p><p>rgba(<em>red</em>, <em>green</em>, <em>blue</em>, <em>alpha</em>)</p><p>rgb(<em>red</em>, <em>green</em>, <em>blue</em>)</p><p>hex</p><h1 id="rrggbb"><a href="#rrggbb" class="headerlink" title="rrggbb"></a>rrggbb</h1><p>为所有 3 个光源使用相等的值来定义灰色阴影</p><p>hsl</p><p>在 CSS 中，可以使用色相、饱和度和明度（HSL）来指定颜色</p><p>色相（<em>hue</em>）是色轮上从 0 到 360 的度数。0 是红色，120 是绿色，240 是蓝色。</p><p>饱和度（<em>saturation</em>）是一个百分比值，0％ 表示灰色阴影，而 100％ 是全色。</p><p>亮度（<em>lightness</em>）也是百分比，0％ 是黑色，50％ 是既不明也不暗，100％是白色</p><p>通常通过将色调和饱和度设置为 0 来定义灰色阴影，并将亮度从 0％ 到 100％ 进行调整可以得到更深/更浅的阴影</p><p>HSLA 颜色值是带有 Alpha 通道的 HSL 颜色值的扩展 - 它指定了颜色的不透明度</p><h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><h3 id="背景颜色"><a href="#背景颜色" class="headerlink" title="背景颜色"></a>背景颜色</h3><p>background-color</p><p>设置元素的背景色</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: lightblue;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>有效的颜色名称 - 比如 “red”</li><li>十六进制值 - 比如 “#ff0000”</li><li>RGB 值 - 比如 “rgb(255,0,0)”</li></ul><p>透明度</p><p>opacity</p><p><strong>注意：</strong>使用 <strong>opacity</strong> 属性为元素的背景添加透明度时，其所有子元素都继承相同的透明度。这可能会使完全透明的元素内的文本难以阅读。</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">div</span> &#123;</span><br><span class="line"><span class="attribute">opacity</span>: <span class="number">0.8</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如果不希望对子元素应用不透明度，例如上面的例子，请使用 <em>RGBA</em> 颜色值</p><h3 id="背景图像"><a href="#背景图像" class="headerlink" title="背景图像"></a>背景图像</h3><p>background-image</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">  <span class="attribute">background-image</span>: <span class="built_in">url</span>(<span class="string">&quot;paper.gif&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>默认情况下，图像会重复，以覆盖整个元素</p><p>background-repeat</p><p>默认,图像属性在水平和垂直方向上都重复图像</p><p>水平方向重复</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">  <span class="attribute">background-image</span>: <span class="built_in">url</span>(<span class="string">&quot;gradient_bg.png&quot;</span>);</span><br><span class="line">  <span class="attribute">background-repeat</span>: repeat-x;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>no-repeat 还可指定只显示一次背景图像</p><p>background-position指定图像位置</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">  <span class="attribute">background-image</span>: <span class="built_in">url</span>(<span class="string">&quot;tree.png&quot;</span>);</span><br><span class="line">  <span class="attribute">background-repeat</span>: no-repeat;</span><br><span class="line">  <span class="attribute">background-position</span>: right top;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>background-attachment</p><p>指定背景图像是应该滚动还是固定的</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">  <span class="attribute">background-image</span>: <span class="built_in">url</span>(<span class="string">&quot;tree.png&quot;</span>);</span><br><span class="line">  <span class="attribute">background-repeat</span>: no-repeat;</span><br><span class="line">  <span class="attribute">background-position</span>: right top;</span><br><span class="line">  <span class="attribute">background-attachment</span>: fixed;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>scroll使图像随着页面其余部分一起滚动</p><p>background</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#ffffff</span> <span class="built_in">url</span>(<span class="string">&quot;tree.png&quot;</span>) no-repeat right top;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>简写属性</p><p><img data-src="http://cdn.sekyoro.top/imgs/093518.png" alt="image-20211020225021226"></p><p>border边框</p><p>允许您指定元素边框的样式、宽度和颜色</p><p>border-style</p><p>允许以下值：</p><ul><li>dotted - 定义点线边框</li><li>dashed - 定义虚线边框</li><li>solid - 定义实线边框</li><li>double - 定义双边框</li><li>groove - 定义 3D 坡口边框。效果取决于 border-color 值</li><li>ridge - 定义 3D 脊线边框。效果取决于 border-color 值</li><li>inset - 定义 3D inset 边框。效果取决于 border-color 值</li><li>outset - 定义 3D outset 边框。效果取决于 border-color 值</li><li>none - 定义无边框</li><li>hidden - 定义隐藏边框</li></ul><p>border-style 属性可以设置一到四个值（用于上边框、右边框、下边框和左边框）</p><p>除非设置了 <strong>border-style</strong> 属性，否则其他 CSS 边框属性</p><p>border-width</p><p>可以将宽度设置为特定大小（以 px、pt、cm、em 计），也可以使用以下三个预定义值之一：thin、medium 或 thick</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">p</span><span class="selector-class">.one</span> &#123;</span><br><span class="line">  <span class="attribute">border-style</span>: solid;</span><br><span class="line">  <span class="attribute">border-width</span>: <span class="number">5px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">p</span><span class="selector-class">.two</span> &#123;</span><br><span class="line">  <span class="attribute">border-style</span>: solid;</span><br><span class="line">  <span class="attribute">border-width</span>: medium;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">p</span><span class="selector-class">.three</span> &#123;</span><br><span class="line">  <span class="attribute">border-style</span>: dotted;</span><br><span class="line">  <span class="attribute">border-width</span>: <span class="number">2px</span>;</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="selector-tag">p</span><span class="selector-class">.four</span> &#123;</span><br><span class="line">  <span class="attribute">border-style</span>: dotted;</span><br><span class="line">  <span class="attribute">border-width</span>: thick;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>border-color</p><p>如果未设置 <code>border-color</code>，则它将继承元素的颜色</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">p</span><span class="selector-class">.one</span> &#123;</span><br><span class="line">  <span class="attribute">border-style</span>: solid;</span><br><span class="line">  <span class="attribute">border-color</span>: red;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">p</span><span class="selector-class">.two</span> &#123;</span><br><span class="line">  <span class="attribute">border-style</span>: solid;</span><br><span class="line">  <span class="attribute">border-color</span>: green;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">p</span><span class="selector-class">.three</span> &#123;</span><br><span class="line">  <span class="attribute">border-style</span>: dotted;</span><br><span class="line">  <span class="attribute">border-color</span>: blue;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>单独的边</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">p</span> &#123;</span><br><span class="line">  <span class="attribute">border-top-style</span>: dotted;</span><br><span class="line">  <span class="attribute">border-right-style</span>: solid;</span><br><span class="line">  <span class="attribute">border-bottom-style</span>: dotted;</span><br><span class="line">  <span class="attribute">border-left-style</span>: solid;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 四个值 */</span></span><br><span class="line"><span class="selector-tag">p</span> &#123;</span><br><span class="line">  <span class="attribute">border-style</span>: dotted solid double dashed; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 三个值 */</span></span><br><span class="line"><span class="selector-tag">p</span> &#123;</span><br><span class="line">  <span class="attribute">border-style</span>: dotted solid double; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 两个值 */</span></span><br><span class="line"><span class="selector-tag">p</span> &#123;</span><br><span class="line">  <span class="attribute">border-style</span>: dotted solid; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 一个值 */</span></span><br><span class="line"><span class="selector-tag">p</span> &#123;</span><br><span class="line">  <span class="attribute">border-style</span>: dotted; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>border简写属性</p><p><code>border</code> 属性是以下各个边框属性的简写属性：</p><ul><li><code>border-width</code></li><li><code>border-style</code>（必需）</li><li><code>border-color</code></li></ul><p>左边框</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">p</span> &#123;</span><br><span class="line">  <span class="attribute">border-left</span>: <span class="number">6px</span> solid red;</span><br><span class="line">  <span class="attribute">background-color</span>: lightgrey;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>border-radius</p><p>用于向元素添加圆角边框</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">p</span> &#123;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">2px</span> solid red;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">5px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>外边距</p><p>margin</p><p>margin 属性用于在任何定义的边框之外，为元素周围创建空间。</p><p>通过 CSS，您可以完全控制外边距。有一些属性可用于设置元素每侧（上、右、下和左）的外边距.</p><p>所有外边距属性都可以设置以下值：</p><ul><li>auto - 浏览器来计算外边距</li><li><em>length</em> - 以 px、pt、cm 等单位指定外边距</li><li>% - 指定以包含元素宽度的百分比计的外边距</li><li>inherit - 指定应从父元素继承外边距</li></ul><p><strong>提示：</strong>允许负值。</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">p</span> &#123;</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">100px</span>;</span><br><span class="line">  <span class="attribute">margin-bottom</span>: <span class="number">100px</span>;</span><br><span class="line">  <span class="attribute">margin-right</span>: <span class="number">150px</span>;</span><br><span class="line">  <span class="attribute">margin-left</span>: <span class="number">80px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>margin</code> 属性是以下各外边距属性的简写属性：</p><ul><li>margin-top</li><li>margin-right</li><li>margin-bottom</li><li>margin-left</li></ul><p>auto 值</p><p>您可以将 margin 属性设置为 auto，以使元素在其容器中水平居中。</p><p>然后，该元素将占据指定的宽度，并且剩余空间将在左右边界之间平均分配</p><p>inherit</p><p>继承自父元素</p><p>外边距合并</p><p>外边距合并指的是，当两个垂直外边距相遇时，它们将形成一个外边距。</p><p>合并后的外边距的高度等于两个发生合并的外边距的高度中的较大者</p><p>内边距</p><p>CSS 拥有用于为元素的每一侧指定内边距的属性：</p><ul><li>padding-top</li><li>padding-right</li><li>padding-bottom</li><li>padding-left</li></ul><p>所有内边距属性都可以设置以下值：</p><ul><li><em>length</em> - 以 px、pt、cm 等单位指定内边距</li><li>% - 指定以包含元素宽度的百分比计的内边距</li><li>inherit - 指定应从父元素继承内边距</li></ul><p><strong>提示：</strong>不允许负值。</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">div</span> &#123;</span><br><span class="line">  <span class="attribute">padding-top</span>: <span class="number">50px</span>;</span><br><span class="line">  <span class="attribute">padding-right</span>: <span class="number">30px</span>;</span><br><span class="line">  <span class="attribute">padding-bottom</span>: <span class="number">50px</span>;</span><br><span class="line">  <span class="attribute">padding-left</span>: <span class="number">80px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>CSS width 属性指定元素内容区域的宽度。内容区域是元素（盒模型）的内边距、边框和外边距内的部分。</p><p>因此，如果元素拥有指定的宽度，则添加到该元素的内边距会添加到元素的总宽度中。这通常是不希望的结果。</p><p><strong>实例</strong></p><p>在这里，<code>&lt;div&gt;</code> 元素的宽度为 300px。但是，<code>&lt;div&gt;</code> 元素的实际宽度将是 350px（300px + 左内边距 25px + 右内边距 25px）：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">div</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">300px</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">25px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>若要将宽度保持为 300px，无论填充量如何</p><p>那么可以使用 box-sizing 属性。这将导致元素保持其宽度。如果增加内边距，则可用的内容空间会减少。</p><p>设置高度和宽度</p><p>height 和 width 属性用于设置元素的高度和宽度。</p><p>height 和 width 属性不包括内边距、边框或外边距。它设置的是元素内边距、边框以及外边距内的区域的高度或宽度。</p><p>height 和 width 属性可设置如下值：</p><ul><li>auto - 默认。浏览器计算高度和宽度。</li><li><em>length</em> - 以 px、cm 等定义高度/宽度。</li><li>% - 以包含块的百分比定义高度/宽度。</li><li>initial - 将高度/宽度设置为默认值。</li><li>inherit - 从其父值继承高度/宽度。</li></ul><p>max-width 属性用于设置元素的最大宽度。</p><p>可以用长度值（例如 px、cm 等）或包含块的百分比（％）来指定 max-width（最大宽度），也可以将其设置为 none（默认值。意味着没有最大宽度）。</p><p>当浏览器窗口小于元素的宽度（500px）时，会发生之前那个 <code>&lt;div&gt;</code> 的问题。然后，浏览器会将水平滚动条添加到页面。</p><p>在这种情况下，使用 max-width 能够改善浏览器对小窗口的处理。</p><p><strong>提示：</strong>将浏览器窗口拖动到小于500px的宽度，以查看两个 div 之间的区别！</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">div</span> &#123;</span><br><span class="line">  <span class="attribute">max-width</span>: <span class="number">500px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: powderblue;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>当浏览器窗口小于元素的宽度（500px）时，会发生之前那个 <code>&lt;div&gt;</code> 的问题。</p><p>然后，浏览器会将水平滚动条添加到页面。</p><p><img data-src="http://cdn.sekyoro.top/imgs/093519.png" alt="image-20211020235533020"></p><p>框模型</p><p>所有 HTML 元素都可以视为方框。在 CSS 中，在谈论设计和布局时，会使用术语“盒模型”或“框模型”。</p><p>CSS 框模型实质上是一个包围每个 HTML 元素的框。它包括：外边距、边框、内边距以及实际的内容。</p><ul><li><em>内容</em> - 框的内容，其中显示文本和图像。</li><li><em>内边距</em> - 清除内容周围的区域。内边距是透明的。</li><li><em>边框</em> - 围绕内边距和内容的边框。</li><li><em>外边距</em> - 清除边界外的区域。外边距是透明的</li></ul><p>背景应用于由内容和内边距、边框组成的区域</p><p>内边距、边框和外边距都是可选的，默认值是零。但是，许多元素将由用户代理样式表设置外边距和内边距。可以通过将元素的 margin 和 padding 设置为零来覆盖这些浏览器样式。</p><p>width 和 height 指的是内容区域的宽度和高度。增加内边距、边框和外边距不会影响内容区域的尺寸，但是会增加元素框的总尺寸</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-id">#box</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">70px</span>;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">10px</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">5px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>提示：</strong>内边距、边框和外边距可以应用于一个元素的所有边，也可以应用于单独的边。</p><p><strong>提示：</strong>外边距可以是负值，而且在很多情况下都要使用负值的外边距</p><p><strong>重要提示：</strong>使用 CSS 设置元素的 width 和 height 属性时，只需设置内容区域的宽度和高度。要计算元素的完整大小，还必须把内边距、边框和外边距加起来。</p><p>实例</p><p><div> 元素的总宽度将是 350px：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">div</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">320px</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">10px</span>;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">5px</span> solid gray;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0</span>; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>轮廓</p><p>CSS 拥有如下轮廓属性：</p><ul><li>outline-style</li><li>outline-color</li><li>outline-width</li><li>outline-offset</li><li>outline</li></ul><p>轮廓与<a href="https://www.w3school.com.cn/css/css_border.asp">边框</a>不同！不同之处在于：轮廓是在元素边框之外绘制的，并且可能与其他内容重叠。同样，轮廓也不是元素尺寸的一部分；元素的总宽度和高度不受轮廓线宽度的影响</p><p><img data-src="http://cdn.sekyoro.top/imgs/093521.png" alt="image-20211021002834084"></p><p>outline-width 属性指定轮廓的宽度，并可设置如下值之一：</p><ul><li>thin（通常为 1px）</li><li>medium（通常为 3px）</li><li>thick （通常为 5px）</li><li>特定尺寸（以 px、pt、cm、em 计）</li></ul><p>outline-color 属性用于设置轮廓的颜色。</p><p>可以通过以下方式设置颜色：</p><ul><li><em>name</em> - 指定颜色名，比如 “red”</li><li>HEX - 指定十六进制值，比如 “#ff0000”</li><li>RGB - 指定 RGB 值，比如 “rgb(255,0,0)”</li><li>HSL - 指定 HSL 值，比如 “hsl(0, 100%, 50%)”</li><li>invert - 执行颜色反转（确保轮廓可见，无论是什么颜色背景）</li></ul><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">p</span><span class="selector-class">.ex1</span> &#123;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">1px</span> solid yellow;</span><br><span class="line">  <span class="attribute">outline-style</span>: solid;</span><br><span class="line">  <span class="attribute">outline-color</span>: invert;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>简写属性</p><p>outline 属性是用于设置以下各个轮廓属性的简写属性：</p><ul><li>outline-width</li><li>outline-style（必需）</li><li>outline-color</li></ul><p>从上面的列表中，outline 属性可指定一个、两个或三个值。值的顺序无关紧要</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">p</span><span class="selector-class">.ex1</span> &#123;<span class="attribute">outline</span>: dashed;&#125;</span><br><span class="line"><span class="selector-tag">p</span><span class="selector-class">.ex2</span> &#123;<span class="attribute">outline</span>: dotted red;&#125;</span><br><span class="line"><span class="selector-tag">p</span><span class="selector-class">.ex3</span> &#123;<span class="attribute">outline</span>: <span class="number">5px</span> solid yellow;&#125;</span><br><span class="line"><span class="selector-tag">p</span><span class="selector-class">.ex4</span> &#123;<span class="attribute">outline</span>: thick ridge pink;&#125;</span><br></pre></td></tr></table></figure><p>outline-offset</p><p>outline-offset 属性在元素的轮廓与边框之间添加空间。元素及其轮廓之间的空间是透明的</p><h2 id="文本"><a href="#文本" class="headerlink" title="文本"></a>文本</h2><p>color设置文本颜色</p><p>background-color设置背景颜色</p><p>color 属性用于设置文本的颜色。颜色由以下值指定：</p><ul><li>颜色名 - 比如 “red”</li><li>十六进制值 - 比如 “#ff0000”</li><li>RGB 值 - 比如 “rgb(255,0,0)”</li></ul><p>页面的默认文本颜色是在 body 选择器中定义的。</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: lightgrey;</span><br><span class="line">  <span class="attribute">color</span>: blue;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">h1</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: black;</span><br><span class="line">  <span class="attribute">color</span>: white;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>text-align设置文本的水平对齐方式</p><p>文本可以左对齐或右对齐，或居中对齐。</p><p>当 text-align 属性设置为 “justify” 后，将拉伸每一行，以使每一行具有相等的宽度，并且左右边距是直的</p><p>direction和unicode-bidi</p><p>direction 和 unicode-bidi 属性可用于更改元素的文本方向</p><p>垂直对齐</p><p>vertical-align</p><p>设置元素的垂直对齐方式</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">img</span><span class="selector-class">.top</span> &#123;</span><br><span class="line">  <span class="attribute">vertical-align</span>: top;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">img</span><span class="selector-class">.middle</span> &#123;</span><br><span class="line">  <span class="attribute">vertical-align</span>: middle;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">img</span><span class="selector-class">.bottom</span> &#123;</span><br><span class="line">  <span class="attribute">vertical-align</span>: bottom;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>文字装饰</p><p>text-decoration设置或删除文本装饰</p><p>text-decoration:删除下划线</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">h1</span> &#123;</span><br><span class="line">  <span class="attribute">text-decoration</span>: overline;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">h2</span> &#123;</span><br><span class="line">  <span class="attribute">text-decoration</span>: line-through;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">h3</span> &#123;</span><br><span class="line">  <span class="attribute">text-decoration</span>: underline;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>text-transform</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">p</span><span class="selector-class">.uppercase</span> &#123;</span><br><span class="line">  <span class="attribute">text-transform</span>: uppercase;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">p</span><span class="selector-class">.lowercase</span> &#123;</span><br><span class="line">  <span class="attribute">text-transform</span>: lowercase;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">p</span><span class="selector-class">.capitalize</span> &#123;</span><br><span class="line">  <span class="attribute">text-transform</span>: capitalize;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>它可用于将所有内容转换为大写或小写字母，或将每个单词的首字母大写</p><p>text-indent</p><p>文字缩进,用于指定文本第一行的缩进</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">p</span> &#123;</span><br><span class="line">  <span class="attribute">text-indent</span>: <span class="number">50px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>letter-spacing</p><p>用于指定文本中字符之间的间距</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">h1</span> &#123;</span><br><span class="line">  <span class="attribute">letter-spacing</span>: <span class="number">3px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">h2</span> &#123;</span><br><span class="line">  <span class="attribute">letter-spacing</span>: -<span class="number">3px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>line-height</p><p>用于指定行之间的间距</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">p</span><span class="selector-class">.small</span> &#123;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">0.8</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">p</span><span class="selector-class">.big</span> &#123;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">1.8</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>字间距</p><p>word-spacing 属性用于指定文本中单词之间的间距</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">h1</span> &#123;</span><br><span class="line">  <span class="attribute">word-spacing</span>: <span class="number">10px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">h2</span> &#123;</span><br><span class="line">  <span class="attribute">word-spacing</span>: -<span class="number">5px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>空白</p><p>white-space指定元素内部空白处理方式</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">p</span> &#123;</span><br><span class="line">  <span class="attribute">white-space</span>: nowrap;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>文本阴影<br>text-shadow 属性为文本添加阴影</p><p>最简单的用法是只指定水平阴影（2px）和垂直阴影（2px）</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">h1</span> &#123;</span><br><span class="line">  <span class="attribute">text-shadow</span>: <span class="number">2px</span> <span class="number">2px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>阴影添加颜色</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">h1</span> &#123;</span><br><span class="line">  <span class="attribute">text-shadow</span>: <span class="number">2px</span> <span class="number">2px</span> red;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>添加模糊效果</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">h1</span> &#123;</span><br><span class="line">  <span class="attribute">text-shadow</span>: <span class="number">2px</span> <span class="number">2px</span> <span class="number">5px</span> red;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img data-src="http://cdn.sekyoro.top/imgs/093522.png" alt="image-20211021211922519"></p><h2 id="字体"><a href="#字体" class="headerlink" title="字体"></a>字体</h2><p>在 CSS 中，有五个通用字体族：</p><ul><li>衬线字体（Serif）- 在每个字母的边缘都有一个小的笔触。它们营造出一种形式感和优雅感。</li><li>无衬线字体（Sans-serif）- 字体线条简洁（没有小笔画）。它们营造出现代而简约的外观。</li><li>等宽字体（Monospace）- 这里所有字母都有相同的固定宽度。它们创造出机械式的外观。</li><li>草书字体（Cursive）- 模仿了人类的笔迹。</li><li>幻想字体（Fantasy）- 是装饰性/俏皮的字体</li></ul><p><img data-src="http://cdn.sekyoro.top/imgs/093527.png" alt="image-20211021212057317"></p><p>font-family属性</p><p>font-family 属性应包含多个字体名称作为“后备”系统，以确保浏览器/操作系统之间的最大兼容性。请以您需要的字体开始，并以通用系列结束（如果没有其他可用字体，则让浏览器选择通用系列中的相似字体）。字体名称应以逗号分隔</p><p><strong>注释：</strong>如果字体名称不止一个单词，则必须用引号引起来，例如：”Times New Roman”</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.p1</span> &#123;</span><br><span class="line">  <span class="attribute">font-family</span>: <span class="string">&quot;Times New Roman&quot;</span>, Times, serif;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.p2</span> &#123;</span><br><span class="line">  <span class="attribute">font-family</span>: Arial, Helvetica, sans-serif;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.p3</span> &#123;</span><br><span class="line">  <span class="attribute">font-family</span>: <span class="string">&quot;Lucida Console&quot;</span>, <span class="string">&quot;Courier New&quot;</span>, monospace;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>font-style</p><p>font-style 属性主要用于指定斜体文本。</p><p>此属性可设置三个值：</p><ul><li>normal - 文字正常显示</li><li>italic - 文本以斜体显示</li><li>oblique - 文本为“倾斜”（倾斜与斜体非常相似，但支持较少）</li></ul><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">p</span><span class="selector-class">.normal</span> &#123;</span><br><span class="line">  <span class="attribute">font-style</span>: normal;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">p</span><span class="selector-class">.italic</span> &#123;</span><br><span class="line">  <span class="attribute">font-style</span>: italic;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">p</span><span class="selector-class">.oblique</span> &#123;</span><br><span class="line">  <span class="attribute">font-style</span>: oblique;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>font-weight</p><p>指定字体粗细</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">p</span><span class="selector-class">.normal</span> &#123;</span><br><span class="line">  <span class="attribute">font-weight</span>: normal;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">p</span><span class="selector-class">.thick</span> &#123;</span><br><span class="line">  <span class="attribute">font-weight</span>: bold;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>字体变体</p><p>font-variant 属性指定是否以 small-caps 字体（小型大写字母）显示文本</p><p>字体大小</p><p>font-size</p><p>设置文本大小</p><p>font-size 值可以是绝对或相对大小。</p><p>绝对尺寸：</p><ul><li>将文本设置为指定大小</li><li>不允许用户在所有浏览器中更改文本大小（可访问性不佳）</li><li>当输出的物理尺寸已知时，绝对尺寸很有用</li></ul><p>相对尺寸：</p><ul><li>设置相对于周围元素的大小</li><li>允许用户在浏览器中更改文本大小</li></ul><p><strong>注释：</strong>如果您没有指定字体大小，则普通文本（如段落）的默认大小为 16px（16px = 1em）。</p><p>像素设置</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">h1</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">40px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">h2</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">30px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">p</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">14px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>em设置</p><p>为了允许用户调整文本大小（在浏览器菜单中），许多开发人员使用 em 而不是像素。</p><p>W3C 建议使用 em 尺寸单位。</p><p>1em 等于当前字体大小。浏览器中的默认文本大小为 16px。因此，默认大小 1em 为 16px。</p><p>可以使用这个公式从像素到 em 来计算大小：pixels/16=em。</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">h1</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">2.5em</span>; <span class="comment">/* 40px/16=2.5em */</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">h2</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">1.875em</span>; <span class="comment">/* 30px/16=1.875em */</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">p</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">0.875em</span>; <span class="comment">/* 14px/16=0.875em */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>使用百分比</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">h1</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">2.5em</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">h2</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">1.875em</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">p</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">0.875em</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>响应式字体大小</p><p>可以使用 vw 单位设置文本大小，它的意思是“视口宽度”（”viewport width”）。</p><p>这样，文本大小将遵循浏览器窗口的大小，请调整浏览器窗口的大小，以查看字体大小如何缩放：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">style</span>=<span class="string">&quot;font-size:10vw&quot;</span>&gt;</span>Hello World<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br></pre></td></tr></table></figure><p>视口（Viewport）是浏览器窗口的大小。 1vw = 视口宽度的 1％。如果视口为 50 厘米宽，则 1vw 为 0.5 厘米。</p><p>为了缩短代码，也可以在一个属性中指定所有单个字体属性。</p><p>font 属性是以下属性的简写属性：</p><ul><li>font-style</li><li>font-variant</li><li>font-weight</li><li>font-size/line-height</li><li>font-family</li></ul><p>图标</p><p>向 HTML 页面添加图标的最简单方法是使用图标库，比如 Font Awesome。</p><p>将指定的图标类的名称添加到任何行内 HTML 元素（如 &lt;\i&gt; 或 &lt;\span&gt;）。</p><p>下面的图标库中的所有图标都是可缩放矢量，可以使用 CSS进行自定义（大小、颜色、阴影等）</p><p>文本链接</p><h2 id="设置链接样式"><a href="#设置链接样式" class="headerlink" title="设置链接样式"></a>设置链接样式</h2><p>链接可以使用任何 CSS 属性（例如 color、font-family、background 等）来设置样式。</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">a</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: hotpink;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>此外，可以根据链接处于什么状态来设置链接的不同样式。</p><p>四种链接状态分别是：</p><ul><li>a:link - 正常的，未访问的链接</li><li>a:visited - 用户访问过的链接</li><li>a:hover - 用户将鼠标悬停在链接上时</li><li>a:active - 链接被点击时</li></ul><p>如果为多个链接状态设置样式，请遵循如下顺序规则：</p><ul><li>a:hover 必须 a:link 和 a:visited 之后</li><li>a:active 必须在 a:hover 之后</li></ul><p>css列表属性</p><p>CSS 列表属性使您可以：</p><ul><li>为有序列表设置不同的列表项标记</li><li>为无序列表设置不同的列表项标记</li><li>将图像设置为列表项标记</li><li>为列表和列表项添加背景色</li></ul><p>list-style-type 属性指定列表项标记的类型</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">ul</span><span class="selector-class">.a</span> &#123;</span><br><span class="line">  <span class="attribute">list-style-type</span>: circle;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">ul</span><span class="selector-class">.b</span> &#123;</span><br><span class="line">  <span class="attribute">list-style-type</span>: square;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">ol</span><span class="selector-class">.c</span> &#123;</span><br><span class="line">  <span class="attribute">list-style-type</span>: upper-roman;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">ol</span><span class="selector-class">.d</span> &#123;</span><br><span class="line">  <span class="attribute">list-style-type</span>: lower-alpha;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>图像作为列表标记</p><p>list-style-image 属性将图像指定为列表项标记：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">ul</span> &#123;</span><br><span class="line">  <span class="attribute">list-style-image</span>: <span class="built_in">url</span>(<span class="string">&#x27;sqpurple.gif&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>定位列表项标记</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">ul</span><span class="selector-class">.a</span> &#123;</span><br><span class="line">  <span class="attribute">list-style-position</span>: outside;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">ul</span><span class="selector-class">.b</span> &#123;</span><br><span class="line">  <span class="attribute">list-style-position</span>: inside;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>删除默认设置</p><p>list-style-type:none 属性也可以用于删除标记/项目符号。请注意，列表还拥有默认的外边距和内边距。要删除此内容，请在 <ul\> 或 <ol\> 中添加 margin:0 和 padding:0</p><p><img data-src="http://cdn.sekyoro.top/imgs/093529.png" alt="image-20211021222020189"></p><p>设置列表样式</p><p>表格属性</p><p>border</p><p>width</p><p>在某些情况下，上表似乎很小。如果您需要一个可以覆盖整个屏幕表格使用width:100%</p><p>border-collapse 属性设置是否将表格边框折叠为单一边框</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">table</span> &#123;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">1px</span> solid black;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>表格宽度和高度</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">table</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">th</span> &#123;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">50px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>水平对齐</p><p>text-align</p><p>text-align 属性设置 <th\> 或 <td\> 中内容的水平对齐方式（左、右或居中）。</p><p>默认情况下，<th\> 元素的内容居中对齐，而 <td\> 元素的内容左对齐。</p><p>vertical-align</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">td</span> &#123;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">50px</span>;</span><br><span class="line">  <span class="attribute">vertical-align</span>: bottom;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>表格内边距</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">th</span>, <span class="selector-tag">td</span> &#123;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">15px</span>;</span><br><span class="line">  <span class="attribute">text-align</span>: left;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>水平分割线</p><p>向 <th\> 和 <td\> 添加 border-bottom 属性，以实现水平分隔线</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">th</span>, <span class="selector-tag">td</span> &#123;</span><br><span class="line">  <span class="attribute">border-bottom</span>: <span class="number">1px</span> solid <span class="number">#ddd</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可悬停表格</p><p>在 <tr\> 元素上使用 :hover 选择器</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">tr</span><span class="selector-pseudo">:hover</span> &#123;<span class="attribute">background-color</span>: <span class="number">#f5f5f5</span>;&#125;</span><br></pre></td></tr></table></figure><p>条纹表格</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">tr</span><span class="selector-pseudo">:nth-child</span>(even) &#123;<span class="attribute">background-color</span>: <span class="number">#f2f2f2</span>;&#125;</span><br></pre></td></tr></table></figure><p>响应式表格</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="selector-tag">div</span> style=&quot;<span class="attribute">overflow-x</span>:auto;&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;<span class="selector-tag">table</span>&gt;</span><br><span class="line">... <span class="selector-tag">table</span> <span class="attribute">content</span> ...</span><br><span class="line">&lt;/<span class="selector-tag">table</span>&gt;</span><br><span class="line"></span><br><span class="line">&lt;/<span class="selector-tag">div</span>&gt;</span><br></pre></td></tr></table></figure><h2 id="布局"><a href="#布局" class="headerlink" title="布局"></a>布局</h2><p>重点</p><p>display属性用于控制布局</p><p>HTML 元素都有一个默认的 display 值，具体取决于它的元素类型。大多数元素的默认 display 值为 block 或 inline.</p><p>block</p><p>块级元素总是从新行开始，<strong>并占据可用的全部宽度</strong>（尽可能向左和向右伸展）。</p><p>这个 &lt;\div&gt; 元素属于块级元素。</p><p>块级元素的一些例子：</p><ul><li>&lt;\div&gt;</li><li>&lt;\h1&gt; - &lt;\h6&gt;</li><li>&lt;\p&gt;</li><li>&lt;\form&gt;</li><li>&lt;\header&gt;</li><li>&lt;\footer&gt;</li><li>\<section></li></ul><p>inline </p><h2 id="行内元素（inline-element）"><a href="#行内元素（inline-element）" class="headerlink" title="行内元素（inline element）"></a>行内元素（inline element）</h2><p>内联元素不从新行开始，仅占用所需的宽度。</p><p>这是段落中的行内 &lt;\span&gt; 元素。</p><p>行内元素的一些例子：</p><ul><li>&lt;\pan&gt;</li><li>&lt;\a&gt;</li><li>&lt;\img&gt;</li></ul><p>display: none; 通常与 JavaScript 一起使用，以隐藏和显示元素，而无需删除和重新创建它们。如果您想知道如何实现此目标，请查看本页面上的最后一个实例。</p><p>默认情况下，&lt;\script&gt; 元素使用 display: none;</p><p>将行内元素更改为块元素，反之亦然，对于使页面以特定方式显示同时仍遵循 Web 标准很有用。</p><p>一个常见的例子是为实现水平菜单而生成行内的 <li\> 元素：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">li</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: inline;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>注意：</strong>设置元素的 display 属性仅会更改<em>元素的显示方式</em>，而不会更改元素的种类。因此，带有 <strong>display: block;</strong> 的行内元素不允许在其中包含其他块元素。</p><p>将span元素显示为块元素</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">span</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: block;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>下例将 \<a> 元素显示为块元素：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">a</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: block;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">h1</span><span class="selector-class">.hidden</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: none;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>visibility:hidden; 也可以隐藏元素。</p><p>但是，该元素仍将占用与之前相同的空间。元素将被隐藏，但仍会影响布局：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">h1</span><span class="selector-class">.hidden</span> &#123;</span><br><span class="line">  <span class="attribute">visibility</span>: hidden;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>width和max-width</p><p>margin:auto</p><p><strong>注意：</strong>当浏览器窗口小于元素的宽度时，上面这个 <strong><div></strong> 会发生问题。浏览器会将水平滚动条添加到页面。</p><p>在这种情况下，使用 max-width 可以改善浏览器对小窗口的处理。为了使网站在小型设备上可用</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">div</span><span class="selector-class">.ex1</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">500px</span>;</span><br><span class="line">  <span class="attribute">margin</span>: auto;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">3px</span> solid <span class="number">#73AD21</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">div</span><span class="selector-class">.ex2</span> &#123;</span><br><span class="line">  <span class="attribute">max-width</span>: <span class="number">500px</span>;</span><br><span class="line">  <span class="attribute">margin</span>: auto;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">3px</span> solid <span class="number">#73AD21</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>position属性</p><p>属性规定应用于元素的定位方法的类型（static、relative、fixed、absolute 或 sticky）</p><p>position 属性规定应用于元素的定位方法的类型。</p><p>有五个不同的位置值：</p><ul><li>static</li><li>relative</li><li>fixed</li><li>absolute</li><li>sticky</li></ul><p>元素其实是使用 top、bottom、left 和 right 属性定位的。但是，除非首先设置了 position 属性，否则这些属性将不起作用。根据不同的 position 值，它们的工作方式也不同</p><p>position: static</p><p>HTML 元素默认情况下的定位方式为 static（静态）。</p><p>静态定位的元素不受 top、bottom、left 和 right 属性的影响。</p><p>position: static; 的元素不会以任何特殊方式定位；它始终根据页面的正常流进行定位</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">div</span><span class="selector-class">.static</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: static;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">3px</span> solid <span class="number">#73AD21</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>relative</p><p>元素相对于其正常位置进行定位。</p><p>设置相对定位的元素的 top、right、bottom 和 left 属性将导致其偏离其正常位置进行调整。不会对其余内容进行调整来适应元素留下的任何空间。</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">div</span><span class="selector-class">.relative</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">30px</span>;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">3px</span> solid <span class="number">#73AD21</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>fixed</p><p>元素是相对于视口定位的，这意味着即使滚动页面，它也始终位于同一位置。 top、right、bottom 和 left 属性用于定位此元素。</p><p>固定定位的元素不会在页面中通常应放置的位置上留出空隙</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">div</span><span class="selector-class">.fixed</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: fixed;</span><br><span class="line">  <span class="attribute">bottom</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">right</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">300px</span>;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">3px</span> solid <span class="number">#73AD21</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>absolute</p><p>相对于最近的定位祖先元素进行定位（而不是相对于视口定位，如 fixed）。</p><p>然而，如果绝对定位的元素没有祖先，它将使用文档主体（body），并随页面滚动一起移动</p><p>stick粘性定位</p><p>粘性元素根据滚动位置在相对（relative）和固定（fixed）之间切换。它会被相对定位，直到在视口中遇到给定的偏移位置为止 - 然后将其“粘贴”在适当的位置（比如 position:fixed）</p><p>重叠元素</p><p>z-index 属性指定元素的堆栈顺序（哪个元素应放置在其他元素的前面或后面）。</p><p>元素可以设置正或负的堆叠顺序</p><p>如果两个定位的元素重叠而未指定 <strong>z-index</strong>，则位于 HTML 代码中最后的元素将显示在顶部</p><p><img data-src="http://cdn.sekyoro.top/imgs/093530.png" alt="image-20211021232711981"></p><p>溢出</p><p>overflow</p><p>overflow 属性可设置以下值：</p><ul><li>visible - 默认。溢出没有被剪裁。内容在元素框外渲染</li><li>hidden - 溢出被剪裁，其余内容将不可见</li><li>scroll - 溢出被剪裁，同时添加滚动条以查看其余内容</li><li>auto - 与 scroll 类似，但仅在必要时添加滚动条</li></ul><p>overflow:visible</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">div</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">200px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">50px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#eee</span>;</span><br><span class="line">  <span class="attribute">overflow</span>: visible;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>hidden移除值被裁减,裁剪内容隐藏</p><p>scroll，溢出将被裁剪，并添加滚动条以便在框内滚动。请注意，这将在水平和垂直方向上添加一个滚动条（即使您不需要它）</p><p>auto 值类似于 scroll，但是它仅在必要时添加滚动条</p><p>overflow-x 和 overflow-y 属性规定是仅水平还是垂直地（或同时）更改内容的溢出</p><p>float浮动属性</p><p>float 规定元素如何浮动</p><p>clear 规定元素可以在清楚的元素旁边以及在哪一侧浮动</p><p>float</p><p>float 属性用于定位和格式化内容，例如让图像向左浮动到容器中的文本那里。</p><p>float 属性可以设置以下值之一：</p><ul><li>left - 元素浮动到其容器的左侧</li><li>right - 元素浮动在其容器的右侧</li><li>none - 元素不会浮动（将显示在文本中刚出现的位置）。默认值。</li><li>inherit - 元素继承其父级的 float 值</li></ul><p>clear属性指定哪些元素可以浮动于被清除元素的旁边以及哪一侧</p><p>在清除浮动时，应该对清除与浮动进行匹配：如果某个元素浮动到左侧，则应清除左侧。您的浮动元素会继续浮动，但是被清除的元素将显示在其下方</p><p>如果一个元素比包含它的元素高，并且它是浮动的，它将“溢出”到其容器之外</p><p>还可以使用伪元素</p><p><img data-src="http://cdn.sekyoro.top/imgs/093532.png" alt="image-20211022102527673"></p><p>display:inline-block</p><p>与 display: inline 相比，主要区别在于 display: inline-block 允许在元素上设置宽度和高度。</p><p>同样，如果设置了 display: inline-block，将保留上下外边距/内边距，而 display: inline 则不会</p><p>display: inline、display: inline-block 以及 display: block</p><p>对齐</p><p>居中对齐</p><p>要使块元素（例如 <div> ）水平居中，请使用 margin: auto;。</p><p>设置元素的宽度将防止其延伸到容器的边缘</p><p>如果未设置 <strong>width</strong> 属性（或将其设置为 100％），则居中对齐无效</p><p>margin:auto</p><p>居中对齐文本</p><p>text-align:center</p><p>居中对齐图像</p><p>display:block</p><p>margin-left:auto</p><p>margin-right:auto</p><p>左右对齐</p><p>position:absolute</p><p>width</p><p>right</p><p><strong>注意：</strong>绝对定位的元素将从正常流中删除，并可能出现元素重叠</p><p>垂直对齐</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.center</span> &#123;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">70px</span> <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">3px</span> solid green;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如需同时垂直和水平对齐，请使用 padding 和 text-align: center;</p><p>使用line-height</p><p>使用<em>其值</em>等于 height 属性值的 line-height 属性</p><p>position transform</p><p>flexbox</p><p>css 组合器</p><p>CSS 选择器可以包含多个简单选择器。在简单选择器之间，我们可以包含一个组合器。</p><p>CSS 中有四种不同的组合器：</p><ul><li>后代选择器 (空格)</li><li>子选择器 (&gt;)</li><li>相邻兄弟选择器 (+)</li><li>通用兄弟选择器 (~)</li></ul><p>后代选择属于指定元素后代的所有元素</p><p>子选择器匹配属于指定元素子元素的所有元素</p><p>相邻兄弟选择器匹配所有作为指定元素的相邻同级的元素。</p><p>兄弟（同级）元素必须具有相同的父元素，“相邻”的意思是“紧随其后”</p><p>通用兄弟选择器匹配属于指定元素的同级元素的所有元素。</p><p>下面的例子选择属于 &lt;\div&gt; 元素的同级元素的所有 &lt;\p&gt; 元素</p><p>空格是选择所有子元素</p><p>>是一级子元素</p><p>+是同级的临近元素</p><p><img data-src="http://cdn.sekyoro.top/imgs/065525.png" alt="image-20211022112841898"></p><p>所有相同的父元素中位于 p 元素之后的所有 ul 元素</p><p>伪类</p><p>伪类用于定义元素的特殊状态.</p><p>它可以用于：</p><ul><li>设置鼠标悬停在元素上时的样式</li><li>为已访问和未访问链接设置不同的样式</li><li>设置元素获得焦点时的样式</li></ul><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">selector:pseudo-class &#123;</span><br><span class="line">  property: value;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>锚伪类</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 未访问的链接 */</span></span><br><span class="line"><span class="selector-tag">a</span><span class="selector-pseudo">:link</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#FF0000</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 已访问的链接 */</span></span><br><span class="line"><span class="selector-tag">a</span><span class="selector-pseudo">:visited</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#00FF00</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 鼠标悬停链接 */</span></span><br><span class="line"><span class="selector-tag">a</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#FF00FF</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 已选择的链接 */</span></span><br><span class="line"><span class="selector-tag">a</span><span class="selector-pseudo">:active</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#0000FF</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>伪类和css类</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">a</span><span class="selector-class">.highlight</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#ff0000</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>简单的工具提示悬停</p><p>把鼠标悬停到 &lt;\div&gt; 元素以显示 &lt;\p&gt; 元素（类似工具提示的效果</p><p>:first-child伪类</p><p>:first-child 伪类与指定的元素匹配：该元素是另一个元素的第一个子元素</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">p</span><span class="selector-pseudo">:first</span>-child &#123;</span><br><span class="line">  <span class="attribute">color</span>: blue;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>:lang伪类</p><p>:lang 伪类允许您为不同的语言定义特殊的规则</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="css"></span></span><br><span class="line"><span class="css"><span class="selector-tag">q</span><span class="selector-pseudo">:lang</span>(en) &#123;</span></span><br><span class="line"><span class="css">  <span class="attribute">quotes</span>: <span class="string">&quot;~&quot;</span> <span class="string">&quot;~&quot;</span>;</span></span><br><span class="line"><span class="css">&#125;</span></span><br><span class="line"><span class="css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Some text <span class="tag">&lt;<span class="name">q</span> <span class="attr">lang</span>=<span class="string">&quot;no&quot;</span>&gt;</span>A quote in a paragraph<span class="tag">&lt;/<span class="name">q</span>&gt;</span> Some text.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>伪元素</p><p><strong>::first-letter</strong> 伪元素只适用于块级元素</p><p><code>::first-line</code> 伪元素只能应用于块级元素</p><p><img data-src="http://cdn.sekyoro.top/imgs/093535.png" alt="image-20211022120348771"></p><p>透明度</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">img</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">0.5</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>使用 opacity 属性为元素的背景添加透明度时，其所有子元素都继承相同的透明度。这可能会使完全透明的元素内的文本难以阅读</p><p>不希望对子元素应用不透明度，如上面的例子，请使用 RGBA 颜色值</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">div</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="built_in">rgba</span>(<span class="number">76</span>, <span class="number">175</span>, <span class="number">80</span>, <span class="number">0.3</span>) /* Green background with <span class="number">30%</span> opacity */</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>固定定位在移动设备上可能无法正常工作。</p><p><img data-src="http://cdn.sekyoro.top/imgs/065532.png" alt="image-20211022142033095"></p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      
        <tags>
            
            <tag> front </tag>
            
            <tag> CSS </tag>
            
            <tag> CSS3 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>wm入坑</title>
      <link href="2021/10/20/wm%E5%85%A5%E5%9D%91/"/>
      <url>2021/10/20/wm%E5%85%A5%E5%9D%91/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>WM入门</p><h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>wm，window manager</p><p>相当于是美化了</p><span id="more"></span><h2 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h2><p>安装个好看的终端模拟器,这里我装alacritty</p><p>装一个i3wm或者dwm或者其他的wm</p><p>alacritty是用Rust写的,安装官方文档的一步一步来就行,需要装Rust编译器,<strong>注意</strong>我用的Ubuntu,本身带了rustc,需要先卸载</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get remove rustc</span><br></pre></td></tr></table></figure><p>下面是下载Rust页面，default就行</p><p><img data-src="http://cdn.sekyoro.top/imgs/094206.png" alt="image-20211011190048735"></p><p>i3wm我是按照别人配置好了的文件直接下载的</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install i3</span><br></pre></td></tr></table></figure><p><strong>注意</strong>,事实上不止要装i3,还有很多其他有用的包以及依赖.可以看看下面的参考资料,都很有用</p><p>参考</p><p><a href="https://www.youtube.com/watch?v=omhky9FgViU&amp;t=771s">Installing I3 Window Manager in Ubuntu 19.04 - YouTube</a></p><p>这个老哥挺好的,照着做就行</p><p><a href="https://www.youtube.com/watch?v=S5ra0DUDZww">Alacritty - A Fast Terminal Emulator with GPU Acceleration - YouTube</a></p><p><a href="https://github.com/alacritty/alacritty/blob/master/INSTALL.md">alacritty/INSTALL.md at master · alacritty/alacritty (github.com)</a></p><p>关于alacritty终端配置以及官方文档</p><p><a href="https://www.bilibili.com/video/BV11J411t7RY">【高效神器】dwm安装与配置（1） —— 极简的窗口管理器 【Suckless的极简主义02】_哔哩哔哩_bilibili</a></p><p>这是关于dwm的</p><p><a href="https://cxybb.com/article/weixin_43372529/106712115">i3wm美化与配置之使用feh进行随机壁纸的配置并透明化终端_大黄很黄的博客-程序员宝宝_i3wm 壁纸 - 程序员宝宝 (cxybb.com)</a></p><p>美化壁纸</p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      
        <tags>
            
            <tag> wm </tag>
            
            <tag> i3wm </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>dwm入门</title>
      <link href="2021/10/10/dwm%E5%85%A5%E9%97%A8/"/>
      <url>2021/10/10/dwm%E5%85%A5%E9%97%A8/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="DWM入门"><a href="#DWM入门" class="headerlink" title="DWM入门"></a>DWM入门</h1><h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>桌面环境:KDE GNOME XFCE等</p><p>泛指桌面的背景图片，桌面的应用程序软件，桌面的快捷方式，桌面的DIY小部件等组成的一个直观的视觉环境。桌面环境可能仅仅是一个简单的<a href="https://baike.baidu.com/item/窗口管理器/8902451">窗口管理器</a>， 也可能是一个像 KDE 或者 GNOME这样的完整<a href="https://baike.baidu.com/item/桌面应用程序/2331979">桌面应用程序</a>套件。</p><span id="more"></span><p>窗口管理器 wm </p><p>显示管理器(Display Manager，DM)又叫做“登陆管理器”，如sddm、lightdm等</p><p>dynamic window manager</p><p><a href="https://dwm.suckless.org/">dwm</a>是<a href="https://wiki.archlinux.org/title/X">X</a>下的一个动态窗口管理器。它用平铺的、栈式的和全屏的布局方式，借助一些可选的补丁还可以实现其他的布局。布局可以动态得改变，为程序提供最优的环境和性能。dwm特别轻量快速，用C语言编写，被设计的目标是控制在2000行以下的代码。在xrandr和Xinerama支持下可实现multi-head。</p><p>dwm是目前平铺式桌面中的佼佼者，自己本身就是一个窗口管理器WM.占用资源低</p><p>是suckless组织开发,archLinux下的东西</p><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>直接开装  dwm</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">git clone git://http://git.suckless.org/dwm</span><br><span class="line"></span><br><span class="line">cd dwm</span><br><span class="line"></span><br><span class="line">make</span><br><span class="line"></span><br><span class="line">sudo make install</span><br></pre></td></tr></table></figure><p>不过我建议,有别人写好补丁的,或者自己打上补丁.</p><p>装好后,由于我是Ubuntu,de是gnome,登陆管理器是gdm  需要在/usr/share/xsessions/下创建类似一个引导的东西,引导到dwm  de  </p><p>下面是ubuntu的de,可以参照这个写</p><p><img data-src="http://cdn.sekyoro.top/imgs/065536.png" alt="image-20211010201156141"></p><p>写好后注销,进入登陆界面</p><p><img data-src="http://cdn.sekyoro.top/imgs/093601.png" alt="image-20211010201857620"></p><p>可以看到有dwm</p><p>参考</p><p><a href="https://zhuanlan.zhihu.com/p/183861786">入坑dwm——原来窗口管理器还可以这样用？！ - 知乎 (zhihu.com)</a></p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      
        <tags>
            
            <tag> dwm </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>安装ohmyzsh并配置</title>
      <link href="2021/10/10/%E5%AE%89%E8%A3%85ohmyzsh%E5%B9%B6%E9%85%8D%E7%BD%AE/"/>
      <url>2021/10/10/%E5%AE%89%E8%A3%85ohmyzsh%E5%B9%B6%E9%85%8D%E7%BD%AE/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="shell介绍"><a href="#shell介绍" class="headerlink" title="shell介绍"></a>shell介绍</h2><p>真正能够控制计算机硬件（CPU、内存、显示器等）的只有操作系统内核（Kernel），图形界面和命令行只是架设在用户和内核之间的一座桥梁。</p><span id="more"></span><p>由于安全、复杂、繁琐等原因，用户不能直接接触内核（也没有必要），需要另外再开发一个程序，让用户直接使用这个程序；该程序的作用就是接收用户的操作（点击图标、输入命令），并进行简单的处理，然后再传递给内核。如此一来，用户和内核之间就多了一层“代理”，这层“代理”既简化了用户的操作，也保护了内核。</p><p>用户界面和命令行就是这个另外开发的程序，就是这层“代理”。在Linux下，这个命令行程序叫做 <strong>Shell</strong>。</p><p>Shell 除了能解释用户输入的命令，将它传递给内核，还可以：</p><ul><li>调用其他程序，给其他程序传递数据或参数，并获取程序的处理结果；</li><li>在多个程序之间传递数据，把一个程序的输出作为另一个程序的输入；</li><li>Shell 本身也可以被其他程序调用。</li></ul><p>由此可见，Shell 是将内核、程序和用户连接了起来。</p><p>Shell 本身支持的命令并不多，但是它可以调用其他的程序，每个程序就是一个命令，这使得 Shell 命令的数量可以无限扩展，其结果就是 Shell 的功能非常强大，完全能够胜任 Linux 的日常管理工作，如文本或字符串检索、文件的查找或创建、大规模软件的自动部署、更改系统设置、监控服务器性能、发送报警邮件、抓取网页内容、压缩文件等。</p><p>Shell 并不是简单的堆砌命令，我们还可以在 Shell 中编程，这和使用 C/C++、Java、Python 等常见的编程语言并没有什么两样。</p><h2 id="为什么用zsh"><a href="#为什么用zsh" class="headerlink" title="为什么用zsh"></a>为什么用zsh</h2><p>一般Linux下有bash,sh等,zsh功能较多,但配置麻烦.</p><p>因为有oh-my-zsh工具可以方便配置zsh,所以使用了zsh</p><p>我使用的Ubuntu,没有zsh</p><p>先下载</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install zsh;</span><br></pre></td></tr></table></figure><p><img data-src="http://cdn.sekyoro.top/imgs/070056.png" alt="image-20211010162840129"></p><p>接下来安装所说的工具</p><p><img data-src="http://cdn.sekyoro.top/imgs/094207.png" alt="image-20211010164449180"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> curl</span></span><br><span class="line">sh -c &quot;$(curl -fsSL https://raw.githubusercontent.com/robbyrussell/oh-my-zsh/master/tools/install.sh)&quot;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> wegt</span> </span><br><span class="line">sh -c &quot;$(wget https://raw.githubusercontent.com/robbyrussell/oh-my-zsh/master/tools/install.sh -O -)&quot;</span><br></pre></td></tr></table></figure><p>多半会出现网络问题…</p><p>可以翻墙</p><p>也可以使用git</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/robbyrussell/oh-my-zsh.git ~/.oh-my-zsh</span><br><span class="line">cp ~/.oh-my-zsh/templates/zshrc.zsh-template ~/.zshrc</span><br><span class="line">chsh -s /bin/zsh</span><br></pre></td></tr></table></figure><p>我用虚拟机时出现一个问题,chsh -s /bin/zsh 没有反应…</p><p>重启之后就好了,应该是小bug</p><p><img data-src="http://cdn.sekyoro.top/imgs/070059.png" alt="image-20211010170942581"></p><p>我们可以发现有两个zsh</p><p>一个/bin/zsh 另一个 /usr/bin/zsh</p><p>貌似都可以用</p><p>在~目录下可以看见.ohmyzsh与.zshrc文件</p><p>可以在.zshrc更改插件主题</p><p>可以在.oh-my-zsh查看直接可以用的主题和插件</p><p><img data-src="http://cdn.sekyoro.top/imgs/094212.png" alt="image-20211010171620642"></p><p>当然,一些第三方插件也是需要的,可以从网上下载</p><h2 id="安装插件-主题"><a href="#安装插件-主题" class="headerlink" title="安装插件,主题"></a>安装插件,主题</h2><p>安装第三方插件,可以安装到刚在所说的plugins目录，也可以安装到一个custom下的plugin目录</p><p>在相关github主页直接clone到该目录下</p><p>1.incr  自动提示</p><p>2.auto-suggestions</p><p>3.zsh-syntax-hightlighting</p><p>4.autojump</p><p>安装autojump时注意提示,需要在相关文件更改</p><p><img data-src="http://cdn.sekyoro.top/imgs/070100.png" alt="image-20211010173204014"></p><p>然后在.zshrc文件中修改</p><p><img data-src="http://cdn.sekyoro.top/imgs/070102.png" alt="image-20211010175003689"></p><p>增加插件即可</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source .zshrc</span><br></pre></td></tr></table></figure><p>再source一下更新</p><p>更改主题类似</p><p><img data-src="http://cdn.sekyoro.top/imgs/070103.png" alt="image-20211010175117138"></p><p>如果使用某些主题会有字体缺失,比如agnoster</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install fonts-powerline</span><br></pre></td></tr></table></figure><p>下载相关字体即可</p><h2 id="展示"><a href="#展示" class="headerlink" title="展示"></a>展示</h2><p><img data-src="http://cdn.sekyoro.top/imgs/094214.png" alt="image-20211010175430975"></p><p><img data-src="http://cdn.sekyoro.top/imgs/094215.png" alt="image-20211010175510860"></p><p><img data-src="http://cdn.sekyoro.top/imgs/094221.png" alt="image-20211010180652754"></p><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://cloud.tencent.com/developer/article/1495395">修改 Linux 默认 Shell 用 chsh -s /bin/zsh 命令不生效，提示 chsh: Shell not changed. 怎么办？ - 云+社区 - 腾讯云 (tencent.com)</a></p><p><a href="https://www.cnblogs.com/monsterdev/p/11166720.html">Oh-My-Zsh的配置与使用 - 再见理想_ - 博客园 (cnblogs.com)</a></p><p><a href="https://jyzhangchn.github.io/oh-my-zsh-diy.html">oh-my-zsh 插件介绍 | Jennifer’s Blog (jyzhangchn.github.io)</a></p><p><a href="https://www.mintimate.cn/2021/02/05/configZsh/">Linux/Mac如何配置zsh并使用Oh-my-zsh？让你的终端更加好用 - Mintimate’s Blog</a></p><p><a href="https://www.cnblogs.com/misfit/p/10694397.html#:~:text=Oh-My-Zsh及主题、插件安装与配置 1 打开终端，编辑&gt;&gt;&gt;&gt;首选项&gt;&gt;&gt;&gt;命令 2,勾选“运行自定义命令而不是shell”选项 3 在下面的“自定义命令”中填写" title="zsh">Oh-My-Zsh及主题、插件安装与配置 - 自命不凡的海浪 - 博客园 (cnblogs.com)</a></p><p><a href="https://blog.csdn.net/qq_41550190/article/details/119804102">(15条消息) 解决：/usr/bin/env: ‘python’: No such file or directory_skr？-CSDN博客</a></p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      
        <tags>
            
            <tag> zsh </tag>
            
            <tag> shell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>socket学习</title>
      <link href="2021/10/03/socket%E5%AD%A6%E4%B9%A0/"/>
      <url>2021/10/03/socket%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="socket学习"><a href="#socket学习" class="headerlink" title="socket学习"></a>socket学习</h1><p>起因是老师的作业</p><span id="more"></span><h2 id="什么是-socket？"><a href="#什么是-socket？" class="headerlink" title="什么是 socket？"></a>什么是 socket？</h2><p>socket 的原意是“插座”，在计算机通信领域，socket 被翻译为“套接字”，它是计算机之间进行通信的一种约定或一种方式。通过 socket 这种约定，一台计算机可以接收其他计算机的数据，也可以向其他计算机发送数据。</p><p>socket 的典型应用就是 Web 服务器和浏览器：浏览器获取用户输入的 URL，向服务器发起请求，服务器分析接收到的 URL，将对应的网页内容返回给浏览器，浏览器再经过解析和渲染，就将文字、图片、视频等元素呈现给用户。</p><p>学习 socket，也就是学习计算机之间如何通信，并编写出实用的程序</p><h2 id="一个开始"><a href="#一个开始" class="headerlink" title="一个开始"></a>一个开始</h2><p>通过 socket() 函数来创建一个网络连接，或者说打开一个网络文件，socket() 的返回值就是文件描述符。有了文件描述符，我们就可以使用普通的文件操作函数来传输数据了，例如：</p><ul><li>用 read() 读取从远程计算机传来的数据；</li><li>用 write() 向远程计算机写入数据。</li></ul><p>Windows 也有类似“文件描述符”的概念，但通常被称为“文件句柄”。</p><p>与 UNIX/Linux 不同的是，Windows 会区分 socket 和文件，Windows 就把 socket 当做一个网络连接来对待，因此需要调用专门针对 socket 而设计的数据传输函数，针对普通文件的输入输出函数就无效了。</p><h3 id="套接字"><a href="#套接字" class="headerlink" title="套接字"></a>套接字</h3><h4 id="流格式套接字（SOCK-STREAM）"><a href="#流格式套接字（SOCK-STREAM）" class="headerlink" title="流格式套接字（SOCK_STREAM）"></a>流格式套接字（SOCK_STREAM）</h4><p>流格式套接字（Stream Sockets）也叫“面向连接的套接字”，在代码中使用 SOCK_STREAM 表示。</p><p>SOCK_STREAM 是一种可靠的、双向的通信数据流，数据可以准确无误地到达另一台计算机，如果损坏或丢失，可以重新发送。</p><blockquote><p>流格式套接字有自己的纠错机制，在此我们就不讨论了。</p></blockquote><p>SOCK_STREAM 有以下几个特征：</p><ul><li>数据在传输过程中不会消失；</li><li>数据是按照顺序传输的；</li><li>数据的发送和接收不是同步的（有的教程也称“不存在数据边界”）。</li></ul><p>可以将 SOCK_STREAM 比喻成一条传送带，只要传送带本身没有问题（不会断网），就能保证数据不丢失；同时，较晚传送的数据不会先到达，较早传送的数据不会晚到达，这就保证了数据是按照顺序传递的。</p><h4 id="数据报格式套接字（SOCK-DGRAM）"><a href="#数据报格式套接字（SOCK-DGRAM）" class="headerlink" title="数据报格式套接字（SOCK_DGRAM）"></a>数据报格式套接字（SOCK_DGRAM）</h4><p>数据报格式套接字（Datagram Sockets）也叫“无连接的套接字”，在代码中使用 SOCK_DGRAM 表示。</p><p>计算机只管传输数据，不作数据校验，如果数据在传输中损坏，或者没有到达另一台计算机，是没有办法补救的。也就是说，数据错了就错了，无法重传。</p><p>因为数据报套接字所做的校验工作少，所以在传输效率方面比流格式套接字要高。</p><p>可以将 SOCK_DGRAM 比喻成高速移动的摩托车快递，它有以下特征：</p><ul><li>强调快速传输而非传输顺序；</li><li>传输的数据可能丢失也可能损毁；</li><li>限制每次传输的数据大小；</li><li>数据的发送和接收是同步的（有的教程也称“存在数据边界”）</li></ul><h2 id="TCP"><a href="#TCP" class="headerlink" title="TCP"></a>TCP</h2><h2 id="服务端"><a href="#服务端" class="headerlink" title="服务端"></a>服务端</h2><h3 id="WSAStartup"><a href="#WSAStartup" class="headerlink" title="WSAStartup()"></a>WSAStartup()</h3><p>调用 WSAStartup() 函数进行初始化，以指明 WinSock 规范的版本，它的原型为：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">WSAStartup</span><span class="params">(WORD wVersionRequested, LPWSADATA lpWSAData)</span></span>;</span><br></pre></td></tr></table></figure><p>wVersionRequested 为 WinSock 规范的版本号，低字节为主版本号，高字节为副版本号（修正版本号）；lpWSAData 为指向 WSAData 结构体的指针。</p><p><img data-src="http://cdn.sekyoro.top/imgs/065839.png" alt="image-20211003220519393"></p><p>makeword是将两个byte型合并成一个word型，一个在高8位(b)，一个在低8位(a)</p><p> 如果成功，WSAStartup函数返回0。否则，返回下面列表显示的错误码之一</p><div class="table-container"><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td>错误码</td><td>解释</td></tr><tr><td>WSASYSNOTREADY</td><td>网络通信中下层的网络子系统没准备好</td></tr><tr><td>WSAVERNOTSUPPORTED</td><td>Socket实现提供版本和socket需要的版本不符</td></tr><tr><td>WSAEINPROGRESS</td><td>一个阻塞的Socket操作正在进行</td></tr><tr><td>WSAEPROCLIM</td><td>Socket的实现超过Socket支持的任务数限制</td></tr><tr><td>WSAEFAULT</td><td>lpWSAData参数不是一个合法的指针</td></tr></tbody></table></div><h3 id="WSADATA与SOCKET"><a href="#WSADATA与SOCKET" class="headerlink" title="WSADATA与SOCKET"></a>WSADATA与SOCKET</h3><p>WSAStartup() 函数执行成功后，会将与 ws2_32.dll 有关的信息写入 WSAData 结构体变量</p><p><img data-src="http://cdn.sekyoro.top/imgs/094003.png" alt="image-20211003221025248"></p><p>WinSock 编程的第一步就是加载 ws2_32.dll，然后调用 WSAStartup() 函数进行初始化，并指明要使用的版本号。</p><h3 id="socket"><a href="#socket" class="headerlink" title="socket()"></a>socket()</h3><p>Windows 下使用 socket() 函数来创建套接字，原型为：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">SOCKET <span class="title">socket</span><span class="params">(<span class="keyword">int</span> af, <span class="keyword">int</span> type, <span class="keyword">int</span> protocol)</span></span>;</span><br></pre></td></tr></table></figure><p>af 为地址族（Address Family），也就是 IP 地址类型，常用的有 AF_INET 和 AF_INET6。AF 是“Address Family”的简写，INET是“Inetnet”的简写。AF_INET 表示 IPv4 地址，例如 127.0.0.1；AF_INET6 表示 IPv6 地址，例如 1030::C9B4:FF12:48AA:1A2B。</p><p>记住<code>127.0.0.1</code>，它是一个特殊IP地址，表示本机地址</p><p>type 为数据传输方式，常用的有 SOCK_STREAM 和 SOCK_DGRAM</p><p> protocol 表示传输协议，常用的有 IPPROTO_TCP 和 IPPTOTO_UDP，分别表示 TCP 传输协议和 UDP 传输协议</p><p>Windows 不把套接字作为普通文件对待，而是返回 SOCKET 类型的句柄</p><p><img data-src="http://cdn.sekyoro.top/imgs/065840.png" alt="image-20211003222457345"></p><p>可以看到,这里是SOCK_STREAM面向连接的,说明是TCP协议</p><h3 id="bind-函数"><a href="#bind-函数" class="headerlink" title="bind() 函数"></a>bind() 函数</h3><p>bind() 函数的原型为：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">bind</span><span class="params">(<span class="keyword">int</span> sock, struct sockaddr *addr, <span class="keyword">socklen_t</span> addrlen)</span></span>;  <span class="comment">//Linux</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">bind</span><span class="params">(SOCKET sock, <span class="keyword">const</span> struct sockaddr *addr, <span class="keyword">int</span> addrlen)</span></span>;  <span class="comment">//Windows</span></span><br></pre></td></tr></table></figure><p>sock 为 socket 文件描述符，addr 为 sockaddr 结构体变量的指针，addrlen 为 addr 变量的大小，可由 sizeof() 计算得出.</p><p><img data-src="http://cdn.sekyoro.top/imgs/065841.png" alt="image-20211003222759995"></p><p>oldSocket是刚才socket()函数返回的socket</p><p>sockaddr_in 结构体</p><p>先看一下 sockaddr_in 结构体，它的成员变量如下：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">sockaddr_in</span>&#123;</span>    <span class="keyword">sa_family_t</span>     sin_family;   <span class="comment">//地址族（Address Family），也就是地址类型    </span></span><br><span class="line">                   <span class="keyword">uint16_t</span>        sin_port;     <span class="comment">//16位的端口号    </span></span><br><span class="line">                   <span class="class"><span class="keyword">struct</span> <span class="title">in_addr</span>  <span class="title">sin_addr</span>;</span>     <span class="comment">//32位IP地址    </span></span><br><span class="line">                   <span class="keyword">char</span>            sin_zero[<span class="number">8</span>];  <span class="comment">//不使用，一般用0填充</span></span><br><span class="line">                  &#125;;</span><br></pre></td></tr></table></figure><p> sin_family 和 socket() 的第一个参数的含义相同，取值也要保持一致</p><p>sin_prot 为端口号。uint16_t 的长度为两个字节，理论上端口号的取值范围为 0~65536，但 0~1023 的端口一般由系统分配给特定的服务程序，例如 Web 服务的端口号为 80，FTP 服务的端口号为 21，所以我们的程序要尽量在 1024~65536 之间分配端口号。</p><p>端口号需要用 htons() 函数转换</p><p>sin_addr 是 struct in_addr 结构体类型的变量</p><p>sin_zero[8] 是多余的8个字节，没有用，一般使用 memset() 函数填充为 0</p><h4 id="in-addr-结构体"><a href="#in-addr-结构体" class="headerlink" title="in_addr 结构体"></a>in_addr 结构体</h4><p>sockaddr_in 的第3个成员是 in_addr 类型的结构体，该结构体只包含一个成员，如下所示：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">in_addr</span>&#123;</span>    <span class="keyword">in_addr_t</span>  s_addr;  <span class="comment">//32位的IP地址&#125;;</span></span><br></pre></td></tr></table></figure><p>in_addr_t 在头文件 <netinet/in.h> 中定义，等价于 unsigned long，长度为4个字节。也就是说，s_addr 是一个整数，而IP地址是一个字符串，所以需要 inet_addr() 函数进行转换，例如：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">unsigned</span> <span class="keyword">long</span> ip = inet_addr(<span class="string">&quot;127.0.0.1&quot;</span>);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%ld\n&quot;</span>, ip);</span><br></pre></td></tr></table></figure><p><img data-src="http://cdn.sekyoro.top/imgs/065843.png" alt="image-20211003223419184"></p><p>设置sockaddr_in  注意,又将其强制转换为了一个通用的socket_addr</p><p><img data-src="http://cdn.sekyoro.top/imgs/065845.png" alt="image-20211003224306508"></p><p><img data-src="http://cdn.sekyoro.top/imgs/065846.png" alt="image-20211003224327739"></p><p>sockaddr 和 sockaddr_in 的长度相同，都是16字节，只是将IP地址和端口号合并到一起，用一个成员 sa_data 表示。要想给 sa_data 赋值，必须同时指明IP地址和端口号，例如”127.0.0.1:80“，遗憾的是，没有相关函数将这个字符串转换成需要的形式，也就很难给 sockaddr 类型的变量赋值，所以使用 sockaddr_in 来代替。这两个结构体的长度相同，强制转换类型时不会丢失字节，也没有多余的字节。</p><p><img data-src="http://cdn.sekyoro.top/imgs/065847.png" alt="image-20211004102955888"></p><p><strong>htons</strong>的功能：将一个无符号短整型的主机数值转换为网络 <a href="http://baike.baidu.com/view/567601.htm">字节顺序</a>，即大尾顺序(big-endian)</p><p>参数u_short hostshort：16位 <a href="http://baike.baidu.com/view/6052699.htm">无符号整数</a></p><p>返回值：TCP/IP网络 <a href="http://baike.baidu.com/view/567601.htm">字节顺序</a>.</p><p>The Windows <strong>Sockets</strong> <strong>inet</strong>_<strong>addr</strong> function converts a string containing an (Ipv4) Internet Protocol dotted address into a proper address for the IN_ADDR structure. </p><p>sockaddr 是一种通用的结构体，可以用来保存多种类型的IP地址和端口号，而 sockaddr_in 是专门用来保存 IPv4 地址的结构体</p><p>使用 bind() 绑定套接字后，还需要使用 listen() 函数让套接字进入被动监听状态，再调用 accept() 函数，就可以随时响应客户端的请求了。</p><h3 id="listen-函数"><a href="#listen-函数" class="headerlink" title="listen() 函数"></a>listen() 函数</h3><p>通过 listen() 函数可以让套接字进入被动监听状态，它的原型为：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">listen</span><span class="params">(<span class="keyword">int</span> sock, <span class="keyword">int</span> backlog)</span></span>;  <span class="comment">//Linux</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">listen</span><span class="params">(SOCKET sock, <span class="keyword">int</span> backlog)</span></span>;  <span class="comment">//Windows</span></span><br></pre></td></tr></table></figure><p>sock 为需要进入监听状态的套接字，backlog 为请求队列的最大长度。</p><p>所谓被动监听，是指当没有客户端请求时，套接字处于“睡眠”状态，只有当接收到客户端请求时，套接字才会被“唤醒”来响应请求。</p><p><img data-src="http://cdn.sekyoro.top/imgs/065850.png" alt="image-20211003224816157"></p><h4 id="请求队列"><a href="#请求队列" class="headerlink" title="请求队列"></a>请求队列</h4><p>当套接字正在处理客户端请求时，如果有新的请求进来，套接字是没法处理的，只能把它放进缓冲区，待当前请求处理完毕后，再从缓冲区中读取出来处理。如果不断有新的请求进来，它们就按照先后顺序在缓冲区中排队，直到缓冲区满。这个缓冲区，就称为请求队列（Request Queue）。</p><p>缓冲区的长度（能存放多少个客户端请求）可以通过 listen() 函数的 backlog 参数指定，但究竟为多少并没有什么标准，可以根据你的需求来定，并发量小的话可以是10或者20。</p><p>如果将 backlog 的值设置为 SOMAXCONN，就由系统来决定请求队列长度，这个值一般比较大，可能是几百，或者更多。</p><h3 id="accept-函数"><a href="#accept-函数" class="headerlink" title="accept() 函数"></a>accept() 函数</h3><p>当套接字处于监听状态时，可以通过 accept() 函数来接收客户端请求。它的原型为：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">accept</span><span class="params">(<span class="keyword">int</span> sock, struct sockaddr *addr, <span class="keyword">socklen_t</span> *addrlen)</span></span>;  <span class="comment">//Linux</span></span><br><span class="line"><span class="function">SOCKET <span class="title">accept</span><span class="params">(SOCKET sock, struct sockaddr *addr, <span class="keyword">int</span> *addrlen)</span></span>;  <span class="comment">//Windows</span></span><br></pre></td></tr></table></figure><p>它的参数与 listen() 和 connect() 是相同的：sock 为服务器端套接字，addr 为 sockaddr_in 结构体变量，addrlen 为参数 addr 的长度，可由 sizeof() 求得。</p><p>accept() 返回一个新的套接字来和客户端通信，addr 保存了客户端的IP地址和端口号，而 sock 是服务器端的套接字，大家注意区分。后面和客户端通信时，要使用这个新生成的套接字，而不是原来服务器端的套接字。</p><p><img data-src="http://cdn.sekyoro.top/imgs/065851.png" alt="image-20211003225553648"></p><p>accept() 返回一个新的套接字来和客户端通信，addr 保存了客户端的IP地址和端口号，而 oldSocket 是服务器端的套接字，</p><p>注意区分。后面和客户端通信时，要使用这个新生成的套接字，而不是原来服务器端的套接字。</p><p>listen() 只是让套接字进入监听状态，并没有真正接收客户端请求，listen() 后面的代码会继续执行，直到遇到 accept()。accept() 会阻塞程序执行（后面代码不能被执行），直到有新的请求到来</p><h3 id="Windows下数据的接收和发送"><a href="#Windows下数据的接收和发送" class="headerlink" title="Windows下数据的接收和发送"></a>Windows下数据的接收和发送</h3><p>要在一个循环中监听事件</p><p><img data-src="http://cdn.sekyoro.top/imgs/065853.png" alt="image-20211003230747958"></p><p>Windows 区分普通文件和套接字，并定义了专门的接收和发送的函数。</p><p>从服务器端发送数据使用 send() 函数，它的原型为：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">send</span><span class="params">(SOCKET sock, <span class="keyword">const</span> <span class="keyword">char</span> *buf, <span class="keyword">int</span> len, <span class="keyword">int</span> flags)</span></span>;</span><br></pre></td></tr></table></figure><p>sock 为要发送数据的套接字，buf 为要发送的数据的缓冲区地址，len 为要发送的数据的字节数，flags 为发送数据时的选项。</p><p>返回值和前三个参数不再赘述，最后的 flags 参数一般设置为 0 或 NULL。</p><p>在客户端接收数据使用 recv() 函数，它的原型为：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">recv</span><span class="params">(SOCKET sock, <span class="keyword">char</span> *buf, <span class="keyword">int</span> len, <span class="keyword">int</span> flags)</span></span>;</span><br></pre></td></tr></table></figure><p>客户端下线，返回0,释放客户端socket</p><p>执行失败，返回<code>SOCKET_ERROR</code></p><p><img data-src="http://cdn.sekyoro.top/imgs/065855.png" alt="image-20211003230553718"></p><p>这里设置了客户端输入quit即退出循环</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">closesocket</span>(newSocket);</span><br><span class="line"><span class="built_in">closesocket</span>(oldSocket);</span><br><span class="line"><span class="built_in">WSACleanup</span>();</span><br></pre></td></tr></table></figure><p>关闭两个句柄</p><p>终止Winsock 2 DLL (Ws2_32.dll) 的使用.</p><h2 id="客户端"><a href="#客户端" class="headerlink" title="客户端"></a>客户端</h2><p>socket() 函数用来创建套接字，确定套接字的各种属性，然后服务器端要用 bind() 函数将套接字与特定的IP地址和端口绑定起来，只有这样，流经该IP地址和端口的数据才能交给套接字处理；而客户端要用 connect() 函数建立连接。</p><h3 id="connect-函数"><a href="#connect-函数" class="headerlink" title="connect() 函数"></a>connect() 函数</h3><p>connect() 函数用来建立连接，它的原型为：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">connect</span><span class="params">(<span class="keyword">int</span> sock, struct sockaddr *serv_addr, <span class="keyword">socklen_t</span> addrlen)</span></span>;  <span class="comment">//Linux</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">connect</span><span class="params">(SOCKET sock, <span class="keyword">const</span> struct sockaddr *serv_addr, <span class="keyword">int</span> addrlen)</span></span>;  <span class="comment">//Windows</span></span><br></pre></td></tr></table></figure><p>参数类型与上述相同</p><p><img data-src="http://cdn.sekyoro.top/imgs/065856.png" alt="image-20211003231620650"></p><p>之前同理也要用WSAStartup先初始化,然后使用sock()建立客户端套接字</p><p><img data-src="http://cdn.sekyoro.top/imgs/094004.png" alt="image-20211003232120611"></p><p>注意,客户端的代码只创建了客户端的套接字且与服务端连接</p><p>然后发送消息</p><h3 id="send"><a href="#send" class="headerlink" title="send()"></a>send()</h3><p><img data-src="http://cdn.sekyoro.top/imgs/065858.png" alt="image-20211004100255294"></p><p>从客户端发送数据使用 send() 函数，它的原型为：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">send</span><span class="params">(SOCKET sock, <span class="keyword">const</span> <span class="keyword">char</span> *buf, <span class="keyword">int</span> len, <span class="keyword">int</span> flags)</span></span>;</span><br></pre></td></tr></table></figure><p>sock 为要发送数据的套接字，buf 为要发送的数据的缓冲区地址，len 为要发送的数据的字节数，flags 为发送数据时的选项。</p><h2 id="UDP"><a href="#UDP" class="headerlink" title="UDP"></a>UDP</h2><p>TCP 是面向连接的传输协议，建立连接时要经过三次握手，断开连接时要经过四次握手，中间传输数据时也要回复ACK包确认，多种机制保证了数据能够正确到达，不会丢失或出错。</p><p>UDP 是非连接的传输协议，没有建立连接和断开连接的过程，它只是简单地把数据丢到网络中，也不需要ACK包确认。</p><h3 id="UDP中的服务器端和客户端没有连接"><a href="#UDP中的服务器端和客户端没有连接" class="headerlink" title="UDP中的服务器端和客户端没有连接"></a>UDP中的服务器端和客户端没有连接</h3><p>UDP不像TCP，无需在连接状态下交换数据，因此基于UDP的服务器端和客户端也无需经过连接过程。也就是说，不必调用 listen() 和 accept() 函数。UDP中只有创建套接字的过程和数据交换的过程。</p><h3 id="UDP服务器端和客户端均只需1个套接字"><a href="#UDP服务器端和客户端均只需1个套接字" class="headerlink" title="UDP服务器端和客户端均只需1个套接字"></a>UDP服务器端和客户端均只需1个套接字</h3><p>TCP中，套接字是一对一的关系。如要向10个客户端提供服务，那么除了负责监听的套接字外，还需要创建10套接字。但在UDP中，不管是服务器端还是客户端都只需要1个套接字。之前解释UDP原理的时候举了邮寄包裹的例子，负责邮寄包裹的快递公司可以比喻为UDP套接字，只要有1个快递公司，就可以通过它向任意地址邮寄包裹。同样，只需1个UDP套接字就可以向任意主机传送数据。</p><h2 id="基于UDP的接收和发送函数"><a href="#基于UDP的接收和发送函数" class="headerlink" title="基于UDP的接收和发送函数"></a>基于UDP的接收和发送函数</h2><p>创建好TCP套接字后，传输数据时无需再添加地址信息，因为TCP套接字将保持与对方套接字的连接。换言之，TCP套接字知道目标地址信息。但UDP套接字不会保持连接状态，每次传输数据都要添加目标地址信息，这相当于在邮寄包裹前填写收件人地址。</p><p>udp与tcp协议不同,但创建套接字与绑定连接ip流程类似.</p><p>先初始化WSAStartup()</p><p><img data-src="http://cdn.sekyoro.top/imgs/065901.png" alt="image-20211004094535914"></p><p>再创建套接字,不过这里面向的是数据报连接</p><p><img data-src="http://cdn.sekyoro.top/imgs/065903.png" alt="image-20211004094604239"></p><p>再初始化sockadd_in,填入ipv4地址与端口,进行绑定</p><p><img data-src="http://cdn.sekyoro.top/imgs/094006.png" alt="image-20211004094721033"></p><p>绑定之后进行接收数据即可.</p><p><img data-src="http://cdn.sekyoro.top/imgs/065905.png" alt="image-20211004100014595"></p><p>接收数据使用 recvfrom() 函数：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">recvfrom</span><span class="params">(SOCKET sock, <span class="keyword">char</span> *buf, <span class="keyword">int</span> nbytes, <span class="keyword">int</span> flags, <span class="keyword">const</span> struct sockaddr *from, <span class="keyword">int</span> *addrlen)</span></span>;  <span class="comment">//Windows</span></span><br></pre></td></tr></table></figure><h3 id="recvfrom"><a href="#recvfrom" class="headerlink" title="recvfrom()"></a>recvfrom()</h3><p>由于UDP数据的发送端不不定，所以 recvfrom() 函数定义为可接收发送端信息的形式，具体参数如下：</p><ul><li>sock：用于接收UDP数据的套接字；</li><li>buf：保存接收数据的缓冲区地址；</li><li>nbytes：可接收的最大字节数（不能超过buf缓冲区的大小）；</li><li>flags：可选项参数，若没有可传递0；</li><li>from：存有发送端地址信息的sockaddr结构体变量的地址；</li><li>addrlen：保存参数 from 的结构体变量长度的变量地址值。</li></ul><h3 id="sendto"><a href="#sendto" class="headerlink" title="sendto()"></a>sendto()</h3><p>发送数据使用 sendto() 函数：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">sendto</span><span class="params">(SOCKET sock, <span class="keyword">const</span> <span class="keyword">char</span> *buf, <span class="keyword">int</span> nbytes, <span class="keyword">int</span> flags, <span class="keyword">const</span> struct sockadr *to, <span class="keyword">int</span> addrlen)</span></span>;  <span class="comment">//Windows</span></span><br></pre></td></tr></table></figure><p>Linux和Windows下的 sendto() 函数类似，下面是详细参数说明：</p><ul><li>sock：用于传输UDP数据的套接字；</li><li>buf：保存待传输数据的缓冲区地址；</li><li>nbytes：带传输数据的长度（以字节计）；</li><li>flags：可选项参数，若没有可传递0；</li><li>to：存有目标地址信息的 sockaddr 结构体变量的地址；</li><li>addrlen：传递给参数 to 的地址值结构体变量的长度。</li></ul><p><img data-src="http://cdn.sekyoro.top/imgs/065905.png" alt="image-20211004100619357"></p><p>使用inet_ntoa与ntohs可以将数据转为字符串,整数</p><p><img data-src="http://cdn.sekyoro.top/imgs/065908.png" alt="image-20211004102623675"></p><h2 id="实验结果"><a href="#实验结果" class="headerlink" title="实验结果"></a>实验结果</h2><h4 id="tcp通信"><a href="#tcp通信" class="headerlink" title="tcp通信"></a>tcp通信</h4><p><img data-src="http://cdn.sekyoro.top/imgs/065910.png" alt="image-20211004100907639"></p><p><img data-src="http://cdn.sekyoro.top/imgs/065912.png" alt="image-20211004100913307"></p><h4 id="udp通信"><a href="#udp通信" class="headerlink" title="udp通信"></a>udp通信</h4><p><img data-src="http://cdn.sekyoro.top/imgs/065913.png" alt="image-20211004101456204"></p><p><img data-src="http://cdn.sekyoro.top/imgs/065914.png" alt="image-20211004101508985"></p><p>下面是我跟其他ip地址交互的</p><p>客户端</p><p><img data-src="http://cdn.sekyoro.top/imgs/065917.png" alt="img"></p><p>服务端</p><p><img data-src="http://cdn.sekyoro.top/imgs/094009.png" alt="image-20211004102014108"></p><p>可以看到客户端的ip与端口</p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      
        <tags>
            
            <tag> c </tag>
            
            <tag> socket </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux进程与磁盘管理</title>
      <link href="2021/09/21/%E5%91%BD%E4%BB%A4%E9%9B%86-4/"/>
      <url>2021/09/21/%E5%91%BD%E4%BB%A4%E9%9B%86-4/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="Linux进程与磁盘管理"><a href="#Linux进程与磁盘管理" class="headerlink" title="Linux进程与磁盘管理"></a>Linux进程与磁盘管理</h2><p><strong>进程</strong>（process）：进程是程序在一个数据集合上的一次执行过程，在早期的 UNIX、Linux 2.4 及更早的版本中，它是系统进行资源分配和调度的独立基本单位。</p><span id="more"></span><ul><li>动态性：进程的实质是一次程序执行的过程，有创建、撤销等状态的变化。而程序是一个静态的实体。</li><li>并发性：进程可以做到在一个时间段内，有多个程序在运行中。程序只是静态的实体，所以不存在并发性。</li><li>独立性：进程可以独立分配资源，独立接受调度，独立地运行。</li><li>异步性：进程以不可预知的速度向前推进。</li><li>结构性：进程拥有代码段、数据段、PCB（进程控制块，进程存在的唯一标志）。也正是因为有结构性，进程才可以做到独立地运行。</li></ul><blockquote><p><strong>并发：</strong>在一个时间段内，宏观来看有多个程序都在活动，有条不紊的执行（每一瞬间只有一个在执行，只是在一段时间有多个程序都执行过）</p><p><strong>并行：</strong>在每一个瞬间，都有多个程序都在同时执行，这个必须有多个 CPU 才行</p></blockquote><p><strong>线程</strong>（thread）是操作系统能够进行运算调度的最小单位。它被包含在进程之中，是进程中的实际运作单位。一条线程指的是进程中一个单一顺序的控制流，一个进程中可以并发多个线程，每条线程并行执行不同的任务。因为线程中几乎不包含系统资源，所以执行更快、更有效率。</p><h3 id="进程分类"><a href="#进程分类" class="headerlink" title="进程分类"></a>进程分类</h3><ul><li>用户进程：通过执行用户程序、应用程序或称之为内核之外的系统程序而产生的进程，此类进程可以在用户的控制下运行或关闭。</li><li>系统进程：通过执行系统内核程序而产生的进程，比如可以执行内存资源分配和进程切换等相对底层的工作；而且该进程的运行不受用户的干预，即使是 root 用户也不能干预系统进程的运行</li></ul><ul><li>交互进程：由一个 shell 终端启动的进程，在执行过程中，需要与用户进行交互操作，可以运行于前台，也可以运行在后台。</li><li>批处理进程：该进程是一个进程集合，负责按顺序启动其他的进程。</li><li>守护进程：守护进程是一直运行的一种进程，在 Linux 系统启动时启动，在系统关闭时终止。它们独立于控制终端并且周期性的执行某种任务或等待处理某些发生的事件。例如 httpd 进程，一直处于运行状态，等待用户的访问。还有经常用的 cron（在 centOS 系列为 crond）进程，这个进程为 crontab 的守护进程，可以周期性的执行用户设定的某些任务。</li></ul><p>我们启动了终端，就是启动了一个 bash 进程，我们可以在 bash 中再输入 bash 则会再启动一个 bash 的进程，此时第二个 bash 进程就是由第一个 bash 进程创建出来的，他们之间关系是父进程与子进程</p><p><img data-src="http://cdn.sekyoro.top/imgs/065730.png" alt="image-20210915105254288"></p><h3 id="进程查看"><a href="#进程查看" class="headerlink" title="进程查看"></a>进程查看</h3><p>我们可以通过 <code>top</code> 实时的查看进程的状态，以及系统的一些信息（如 CPU、内存信息等），我们还可以通过 <code>ps</code> 来静态查看当前的进程信息，同时我们还可以使用 <code>pstree</code> 来查看当前活跃进程的树形结构。</p><h4 id="top"><a href="#top" class="headerlink" title="top"></a>top</h4><p>查看系统中使用CPU、使用内存最多的进程；</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">top</span><br></pre></td></tr></table></figure><p>对于进程，平时我们最常想知道的就是哪些进程占用CPU最多，占用内存最多。以下两个命令就可以满足要求:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">P：根据CPU使用百分比大小进行排序。</span><br><span class="line">M：根据驻留内存大小进行排序。</span><br><span class="line">i：使top不显示任何闲置或者僵死进程。</span><br></pre></td></tr></table></figure><p>可以说 top就是linux下的任务管理器</p><p><img data-src="http://cdn.sekyoro.top/imgs/065733.png" alt="image-20210915110542055"></p><p><strong>关于进程情况</strong></p><div class="table-container"><table><thead><tr><th>列名</th><th>解释</th></tr></thead><tbody><tr><td>PID</td><td>进程 id</td></tr><tr><td>USER</td><td>该进程的所属用户</td></tr><tr><td>PR</td><td>该进程执行的优先级 priority 值  越小越高</td></tr><tr><td>NI</td><td>该进程的 nice 值</td></tr><tr><td>VIRT</td><td>该进程任务所使用的虚拟内存的总数</td></tr><tr><td>RES</td><td>该进程所使用的物理内存数，也称之为驻留内存数</td></tr><tr><td>SHR</td><td>该进程共享内存的大小</td></tr><tr><td>S</td><td>该进程进程的状态: S=sleep R=running Z=zombie</td></tr><tr><td>%CPU</td><td>该进程 CPU 的利用率</td></tr><tr><td>%MEM</td><td>该进程内存的利用率</td></tr><tr><td>TIME+</td><td>该进程活跃的总时间</td></tr><tr><td>COMMAND</td><td>该进程运行的名字</td></tr></tbody></table></div><p><strong>NICE 值</strong>叫做静态优先级，是用户空间的一个优先级值，其取值范围是 -20 至 19。这个值越小，表示进程”优先级”越高，而值越大“优先级”越低。nice 值中的 -20 到 19，中 -20 优先级最高， 0 是默认的值，而 19 优先级最低。</p><p><strong>PR 值</strong>表示 Priority 值叫动态优先级，是进程在内核中实际的优先级值，进程优先级的取值范围是通过一个宏定义的，这个宏的名称是 <code>MAX_PRIO</code>，它的值为 140。Linux 实际上实现了 140 个优先级范围，取值范围是从 <code>0-139</code>，这个值越小，优先级越高。而这其中的 <code>0-99</code> 是实时进程的值，而 <code>100-139</code> 是给用户的。</p><p>其中 PR 中的 <code>100 to 139</code> 值部分有这么一个对应 <code>PR = 20 + (-20 to +19)</code>，这里的 <code>-20 to +19</code> 便是 nice 值，所以说两个虽然都是优先级，而且有千丝万缕的关系，但是他们的值，他们的作用范围并不相同。</p><p><strong>VIRT</strong> 任务所使用的虚拟内存的总数，其中包含所有的代码，数据，共享库和被换出 swap 空间的页面等所占据空间的总数。</p><p>下面来解析一下</p><p><img data-src="http://cdn.sekyoro.top/imgs/065733.png" alt="image-20210915110618881"></p><ul><li>第一行</li></ul><p>11:05:55 ： 系统当前时间 </p><p>up 219min ： 系统开机到现在经过了多少时间</p><p>1 user ： 当前1用户在线</p><p>load average: 0.14, 0.09, 0.11： 系统1分钟、5分钟、15分钟的CPU负载信息</p><ul><li>第二行</li></ul><p>Tasks：任务;296total：当前有87个任务，也就是87个进程。</p><p>running：2个进程正在运行</p><p>294sleeping：294个进程睡眠</p><p>0 stopped：停止的进程数</p><p>0 zombie：僵死的进程数</p><p><img data-src="http://cdn.sekyoro.top/imgs/065735-1.png" alt="image-20210915111128522"></p><ul><li><p>第三行</p><p>Cpu(s)：表示这一行显示CPU总体信息</p><p>2.7%us：用户态进程占用CPU时间百分比，不包含renice值为负的任务占用的CPU的时间。</p><p>0.7%sy：内核占用CPU时间百分比</p><p>ni：改变过优先级的进程占用CPU的百分比</p><p>96.6%id：空闲CPU时间百分比</p><p>wa：等待I/O的CPU时间百分比</p><p>hi：CPU硬中断时间百分比</p><p>si：CPU软中断时间百分比</p><p>注：这里显示数据是所有cpu的平均值，如果想看每一个cpu的处理情况，按1即可；折叠，再次按1；</p></li></ul><p><img data-src="http://cdn.sekyoro.top/imgs/065739.png" alt="image-20210915112109665"></p><div class="table-container"><table><thead><tr><th>内容</th><th>解释</th></tr></thead><tbody><tr><td>1952.9 total</td><td>物理内存总量</td></tr><tr><td>409.0 used</td><td>使用的物理内存总量</td></tr><tr><td>409.0 free</td><td>空闲内存总量</td></tr><tr><td>681.1 buffers</td><td>用作内核缓存的内存量</td></tr></tbody></table></div><p><strong>注意：</strong></p><blockquote><p>系统中可用的物理内存最大值并不是 free 这个单一的值，而是 free + buffers + swap 中的 cached 的和。</p></blockquote><p><img data-src="http://cdn.sekyoro.top/imgs/065741.png" alt="image-20210915112325499"></p><div class="table-container"><table><thead><tr><th>内容</th><th>解释</th></tr></thead><tbody><tr><td>total</td><td>交换区总量</td></tr><tr><td>used</td><td>使用的交换区总量</td></tr><tr><td>free</td><td>空闲交换区总量</td></tr><tr><td>cached</td><td>缓冲的交换区总量，内存中的内容被换出到交换区，而后又被换入到内存，但使用过的交换区尚未被覆盖</td></tr></tbody></table></div><p><strong>交互命令</strong></p><div class="table-container"><table><thead><tr><th>常用交互命令</th><th>解释</th></tr></thead><tbody><tr><td>q</td><td>退出程序</td></tr><tr><td>I</td><td>切换显示平均负载和启动时间的信息</td></tr><tr><td>P</td><td>根据 CPU 使用百分比大小进行排序</td></tr><tr><td>M</td><td>根据驻留内存大小进行排序</td></tr><tr><td>i</td><td>忽略闲置和僵死的进程，这是一个开关式命令</td></tr><tr><td>k</td><td>终止一个进程，系统提示输入 PID 及发送的信号值。一般终止进程用 15 信号，不能正常结束则使用 9 信号。安全模式下该命令被屏蔽。</td></tr></tbody></table></div><h4 id="ps"><a href="#ps" class="headerlink" title="ps"></a>ps</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps aux</span><br></pre></td></tr></table></figure><p><img data-src="http://cdn.sekyoro.top/imgs/065742.png" alt="image-20210915112813151"></p><ul><li><p>l 长格式输出；</p></li><li><p>u 按用户名和启动时间的顺序来显示进程；</p></li><li><p>j 用任务格式来显示进程；</p></li><li><p>f 用树形格式来显示进程；</p></li><li><p>a 显示所有用户的所有进程（包括其它用户）；</p></li><li><p>x 显示无控制终端的进程；</p></li><li><p>r 显示运行中的进程；</p></li><li><p>-e 显示所有进程,环境变量</p></li></ul><p><img data-src="http://cdn.sekyoro.top/imgs/065745.png" alt="image-20210915113103961"></p><div class="table-container"><table><thead><tr><th>内容</th><th>解释</th></tr></thead><tbody><tr><td><code>F</code></td><td>进程的标志（process flags），当 flags 值为 1 则表示此子程序只是 fork 但没有执行 exec，为 4 表示此程序使用超级管理员 root 权限</td></tr><tr><td><code>USER</code></td><td>进程的拥有用户</td></tr><tr><td><code>PID</code></td><td>进程的 ID</td></tr><tr><td><code>PPID</code></td><td>其父进程的 PID</td></tr><tr><td><code>SID</code></td><td>session 的 ID</td></tr><tr><td><code>TPGID</code></td><td>前台进程组的 ID</td></tr><tr><td><code>%CPU</code></td><td>进程占用的 CPU 百分比</td></tr><tr><td><code>%MEM</code></td><td>占用内存的百分比</td></tr><tr><td><code>NI</code></td><td>进程的 NICE 值</td></tr><tr><td><code>VSZ</code></td><td>进程使用虚拟内存大小</td></tr><tr><td><code>RSS</code></td><td>驻留内存中页的大小</td></tr><tr><td><code>TTY</code></td><td>终端 ID</td></tr><tr><td><code>S or STAT</code></td><td>进程状态</td></tr><tr><td><code>WCHAN</code></td><td>正在等待的进程资源</td></tr><tr><td><code>START</code></td><td>启动进程的时间</td></tr><tr><td><code>TIME</code></td><td>进程消耗 CPU 的时间</td></tr><tr><td><code>COMMAND</code></td><td>命令的名称和参数</td></tr></tbody></table></div><p>查询正在运行的进程信息</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ps</span> -rf</span><br></pre></td></tr></table></figure><h4 id="pstree"><a href="#pstree" class="headerlink" title="pstree"></a>pstree</h4><p><img data-src="http://cdn.sekyoro.top/imgs/065747.png" alt="image-20210915113749274"></p><p>可以很直接的看到相同的进程数量，最主要的还是我们可以看到所有进程之间的相关性</p><h3 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h3><p>内存管理</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">free</span><br></pre></td></tr></table></figure><p>查看内存使用情况</p><p><img data-src="http://cdn.sekyoro.top/imgs/065748.png" alt="image-20210915114130103"></p><p>进程组与Sessions</p><p>每一个进程都会是一个进程组的成员，而且这个进程组是唯一存在的，他们是依靠 PGID（process group ID）来区别的，而每当一个进程被创建的时候，它便会成为其父进程所在组中的一员。</p><p>一般情况，进程组的 PGID 等同于进程组的第一个成员的 PID，并且这样的进程称为该进程组的领导者，也就是领导进程，进程一般通过使用 <code>getpgrp()</code> 系统调用来寻找其所在组的 PGID，领导进程可以先终结，此时进程组依然存在，并持有相同的 PGID，直到进程组中最后一个进程终结。</p><p>与进程组类似，每当一个进程被创建的时候，它便会成为其父进程所在 Session 中的一员，每一个进程组都会在一个 Session 中，并且这个 Session 是唯一存在的，</p><p>Session 主要是针对一个 tty 建立，Session 中的每个进程都称为一个工作(job)。每个会话可以连接一个终端(control terminal)。当控制终端有输入输出时，都传递给该会话的前台进程组。Session 意义在于将多个 jobs 囊括在一个终端，并取其中的一个 job 作为前台，来直接接收该终端的输入输出以及终端信号。 其他 jobs 在后台运行。</p><blockquote><p><strong>前台</strong>（foreground）就是在终端中运行，能与你有交互的</p><p><strong>后台</strong>（background）就是在终端中运行，但是你并不能与其任何的交互，也不会显示其执行的过程</p></blockquote><p>被停止并放置在后台的工作我们可以使用这个命令来查看：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">jobs</span></span><br></pre></td></tr></table></figure><p>通过这样的一个命令将后台的工作拿到前台来：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 后面不加参数提取预设工作，加参数提取指定工作的编号</span></span><br><span class="line"><span class="comment"># ubuntu 在 zsh 中需要 %，在 bash 中不需要 %</span></span><br><span class="line"><span class="built_in">fg</span> [%jobnumber]</span><br></pre></td></tr></table></figure><h4 id="创建进程"><a href="#创建进程" class="headerlink" title="创建进程"></a>创建进程</h4><p>​    在Linux系统中，除了系统启动之后的第一个进程由系统来创建，其余的进程都必须由已存在的进程来创建，新创建的进程叫做子进程，而创建子进程的进程叫做父进程。那个在系统启动及完成初始化之后，Linux自动创建的进程叫做根进程。根进程是Linux中所有进程的祖宗，其余进程都是根进程的子孙。具有同一个父进程的进程叫做兄弟进程<br>​    关于父进程与子进程便会提及这两个系统调用 <code>fork()</code> 与 <code>exec()</code></p><p>子进程就是父进程通过系统调用 <code>fork()</code> 而产生的复制品，<code>fork()</code> 就是把父进程的 PCB 等进程的数据结构信息直接复制过来，只是修改了 PID，所以一模一样，只有在执行 <code>exec()</code> 之后才会不同。</p><p>为了在一个进程中分裂出子进程，Linux提供了一个系统调用fork()。这里所说的分裂，实际上是一种复制。因为在系统中表示一个进程的实体是进程控制块，创建新进程的主要工作就是要创建一个新控制块，而创建一个新控制块最简单的方法就是复制。</p><p>​    当然，这里的复制并不是完全复制，因为父进程控制块中某些项的内容必须按照子进程的特性来修改，例如进程的标识、状态等。另外，子进程控制块还必须要有表示自己父进程的域和私有空间，例如数据空间、用户堆栈等。</p><p>函数fork()分裂出了两个进程：因为自函数fork()之后执行了两遍之后的代码（先子进程一次，后父进程一次）。同时，这也证明了父进程和子进程运行的是同一个程序，也正是这个理由，系统并未在内存中给子进程配置独立的程序运行空间，而只是简单地将程序指针指向父进程的代码；<br>    两个进程具有各自的数据区和用户堆栈，在函数fork()生成子进程时，将父进程数据区和用户堆栈的内容分别复制给了子进程。同时，接下来的内容，父进程和子进程都是对自己的数据区和堆栈中的内容进行修改运算了。<br>父进程中调用fork()之后会产生两种结果：一种为分裂子进程失败，另一种就是分裂子进程成功。<strong>如果fork()失败，则返回-1,；否则会出现父进程和子进程两个进程，在子进程中fork()返回0，在父进程中fork()返回子进程的ID。</strong></p><p>​    <strong>在代码中获得当前进程pid的函数为：getpid()；</strong></p><p><strong>在代码中获得当前进程父进程pid的函数为：getppid()。</strong></p><p><strong>这里需要注明一点：</strong>父子进程的调度的顺序是由调度器决定的，与进程的创建顺序无关。</p><p>​    当一个子进程要正常的终止运行时，或者该进程结束时它的主函数 <code>main()</code> 会执行 <code>exit(n);</code> 或者 <code>return n</code>，这里的返回值 n 是一个信号，系统会把这个 SIGCHLD 信号传给其父进程，当然若是异常终止也往往是因为这个信号。</p><p>​    在将要结束时的子进程代码执行部分已经结束执行了，系统的资源也基本归还给系统了，但若是其进程的进程控制块（PCB）仍驻留在内存中，而它的 PCB 还在，代表这个进程还存在（因为 PCB 就是进程存在的唯一标志，里面有 PID 等消息），并没有消亡，这样的进程称之为僵尸进程（Zombie）</p><p>​    正常情况下，父进程会收到两个返回值：exit code（SIGCHLD 信号）与 <code>reason for termination</code> 。之后，父进程会使用 <code>wait(&amp;status)</code> 系统调用以获取子进程的退出状态，然后内核就可以从内存中释放已结束的子进程的 PCB；而如若父进程没有这么做的话，子进程的 PCB 就会一直驻留在内存中，一直留在系统中成为僵尸进程（Zombie）。</p><p>虽然僵尸进程是已经放弃了几乎所有内存空间，没有任何可执行代码，也不能被调度，在进程列表中保留一个位置，记载该进程的退出状态等信息供其父进程收集，从而释放它。但是 Linux 系统中能使用的 PID 是有限的，如果系统中存在有大量的僵尸进程，系统将会因为没有可用的 PID 从而导致不能产生新的进程。</p><p>​    进程 0 是系统引导时创建的一个特殊进程，也称之为内核初始化，其最后一个动作就是调用 <code>fork()</code> 创建出一个子进程运行 <code>/sbin/init</code> 可执行文件，而该进程就是 PID=1 的进程 1，而进程 0 就转为交换进程（也被称为空闲进程），进程 1 （init 进程）是第一个用户态的进程，再由它不断调用 fork() 来创建系统里其他的进程，所以它是所有进程的父进程或者祖先进程。同时它是一个守护程序，直到计算机关机才会停止。</p><h4 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h4><p><img data-src="http://cdn.sekyoro.top/imgs/065751.png" alt="image-20210915121843368"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"> <span class="keyword">int</span> id = getpid();</span><br><span class="line"> <span class="built_in">printf</span>(<span class="string">&quot;my id is %d\n&quot;</span>,id);</span><br><span class="line"> <span class="keyword">int</span> num = fork();</span><br><span class="line"> <span class="keyword">if</span>(num==<span class="number">0</span>)</span><br><span class="line"> &#123;<span class="comment">//child</span></span><br><span class="line">         <span class="keyword">int</span> n = getpid();</span><br><span class="line">         <span class="keyword">int</span> pn = getppid();</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;I am child\nmy id is %d and my parent&#x27;s id is %d\n&quot;</span>,n,pn);</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="keyword">else</span> <span class="keyword">if</span>(num&gt;<span class="number">0</span>)</span><br><span class="line"> &#123;</span><br><span class="line">        <span class="comment">//parent</span></span><br><span class="line">        <span class="keyword">int</span> n = getpid();</span><br><span class="line">        <span class="keyword">int</span> pn = getppid();</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;I am parent\nmy id is %d\nmy parent&#x27;s id is %d\n&quot;</span>,n,pn);</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>fork函数调用一次，会返回两个函数值，对于父进程而言，返回的是子进程的PID（因为一个父进程可能有多个子进程，并且没有一个函数可以使父进程获取其所有的子进程ID），对于子进程返回值是0（这样就能区分父子进程，子进程是可以通过getppid来获取父进程的ID，如果进程创建失败，那么返回给父进程-1）。</p><p><img data-src="http://cdn.sekyoro.top/imgs/065754.png" alt="image-20210915125351563"></p><h4 id="杀死进程"><a href="#杀死进程" class="headerlink" title="杀死进程"></a>杀死进程</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">kill</span></span><br></pre></td></tr></table></figure><p>杀死指定PID的进程 (PID为Process ID)</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$kill</span> PID</span><br></pre></td></tr></table></figure><p>杀死相关进程</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">kill</span> -9 3434</span><br></pre></td></tr></table></figure><p>杀死job工作 (job为job number)</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$kill</span> %job</span><br></pre></td></tr></table></figure><p>可以先用 ps -aux查看进程</p><p>然后通过kill pid 杀死进程</p><h3 id="磁盘管理"><a href="#磁盘管理" class="headerlink" title="磁盘管理"></a>磁盘管理</h3><h4 id="查看磁盘和目录的容量"><a href="#查看磁盘和目录的容量" class="headerlink" title="查看磁盘和目录的容量"></a>查看磁盘和目录的容量</h4><ul><li>使用 <code>df</code> 命令查看磁盘的容量</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df</span><br></pre></td></tr></table></figure><p>-h: human缩写，以易读的方式显示结果（即带单位：比如M/G，如果不加这个参数，显示的数字以B为单位）</p><p><img data-src="http://cdn.sekyoro.top/imgs/065755.png" alt="image-20210915221319880"></p><p>物理主机上的 <code>/dev/sda2</code> 是对应着主机硬盘的分区，后面的数字表示分区号，数字前面的字母 a 表示第几块硬盘（也可能是可移动磁盘），你如果主机上有多块硬盘则可能还会出现 <code>/dev/sdb</code>，<code>/dev/sdc</code> 这些磁盘设备都会在 <code>/dev</code> 目录下以文件的存在形式</p><p>使用 <code>du</code> 命令查看目录的容量</p><p>-s 递归整个目录的大小</p><p>-h 对人可读 即显示M/GB</p><h3 id="磁盘挂载"><a href="#磁盘挂载" class="headerlink" title="磁盘挂载"></a>磁盘挂载</h3><p><img data-src="/images/70.png" alt="img"></p><p>lsblk</p><p>查看磁盘挂载情况</p><p><img data-src="http://cdn.sekyoro.top/imgs/065758.png" alt="image-20210915221448745"></p><p>fdisk -l 查看系统所有识别到的磁盘</p><p><img data-src="http://cdn.sekyoro.top/imgs/065801.png" alt="image-20210915221545182"></p><h4 id="mkfs-命令格式化磁盘"><a href="#mkfs-命令格式化磁盘" class="headerlink" title="mkfs 命令格式化磁盘"></a>mkfs 命令格式化磁盘</h4><p><img data-src="http://cdn.sekyoro.top/imgs/065803.png" alt="image-20210915200330145"></p><p>sudo mkfs.ext4 磁盘(也可以是虚拟软盘)</p><h4 id="mount-命令挂载磁盘到目录树"><a href="#mount-命令挂载磁盘到目录树" class="headerlink" title="mount 命令挂载磁盘到目录树"></a>mount 命令挂载磁盘到目录树</h4><p>用户要对该文件系统执行 <code>mount</code> 的指令以进行挂载。该指令通常是使用在 USB 或其他可移除存储设备上，而根目录则需要始终保持挂载的状态。又因为 Linux/UNIX 文件系统可以对应一个文件而不一定要是硬件设备，所以可以挂载一个包含文件系统的文件到目录树。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mount [options] [<span class="built_in">source</span>] [directory]</span><br></pre></td></tr></table></figure><h5 id="实例-1"><a href="#实例-1" class="headerlink" title="实例"></a>实例</h5><p>1.增加一块硬盘</p><p>可以在虚拟机下添加一个硬块</p><p>或者使用 dd命令制作软盘</p><p>dd if=/dev/zero of=virtual.img bs=1M count=256</p><p><img data-src="http://cdn.sekyoro.top/imgs/093942.png" alt="image-20210915222919566"></p><p>我这里添加了一个新硬盘</p><p>使用df -h 查看已挂载的磁盘</p><p><img data-src="http://cdn.sekyoro.top/imgs/065804.png" alt="image-20210915224037960"></p><p>然后使用 fdisk -l 查看系统分区情况</p><p><img data-src="http://cdn.sekyoro.top/imgs/065806.png" alt="image-20210915224258674"></p><p>发现 sda,也就是刚刚添加的5G硬盘没有挂载</p><p>继续使用lsblk还可以查看一些情况</p><p><img data-src="http://cdn.sekyoro.top/imgs/065809.png" alt="image-20210915224357414"></p><p>发现  sda确实没有挂载点</p><p>就决定挂载它了!</p><p>如果是自己创建的软盘再使用mkfs格式化</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo mkfs.ext4 virtual.img</span><br></pre></td></tr></table></figure><p>2.分区</p><p>sudo fdisk virtual.img(软盘)</p><p>sudo fdisk /dev/sdb (添加的硬盘)</p><p>按照指示完成分区</p><p><img data-src="http://cdn.sekyoro.top/imgs/093944.png" alt="image-20210915224757951"></p><p><img data-src="http://cdn.sekyoro.top/imgs/065810.png" alt="image-20210915224847528"></p><p>这样就分好区了,分了一个主区</p><p><img data-src="http://cdn.sekyoro.top/imgs/065816.png" alt="image-20210915225032272"></p><p>使用fdisk -l 发现有了标识符</p><p>3.格式化</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkfs -t ext4 /dev/sda1</span><br></pre></td></tr></table></figure><p><img data-src="http://cdn.sekyoro.top/imgs/065817.png" alt="image-20210915225208889"></p><p>4.挂载 </p><p>先创建一个目录,使用</p><p>mount 设备名 目录名</p><p><strong>目录最好建立在/mnt下，这个目录是专门挂载的。</strong></p><p><img data-src="http://cdn.sekyoro.top/imgs/065823.png" alt="image-20210915225335936"></p><p>如果重启这种挂载关系就会消失</p><p>这是临时挂载</p><p><img data-src="http://cdn.sekyoro.top/imgs/065825.png" alt="image-20210915225425145"></p><p>df -h 发现挂载成功了</p><h4 id="设置开机挂载"><a href="#设置开机挂载" class="headerlink" title="设置开机挂载"></a>设置开机挂载</h4><ol><li>查看开机挂载fstab文件<br>系统开机时会主动读取/etc/fstab这个文件中的内容，根据文件里面的配置挂载磁盘。<br><code># cat /etc/fstab</code></li></ol><blockquote><p>每一列代表的含义：<br>第一列：磁盘的编号或者UUID //挂载点需要使用UUID来进行挂载<br>第二列：需要挂载到的目录<br>第三列：文件系统格式<br>第四列：系统的默认参数，一般填defaults<br>第五列：是否做dump备份，0表示不备份，1表示每天备份，2表示不定期备份<br>第六列：是否开机检查扇区：0表示不检查，1表示最早检验，2表示在1之后开始检验</p></blockquote><h4 id="解除挂载"><a href="#解除挂载" class="headerlink" title="解除挂载"></a>解除挂载</h4><p>umount 设备名</p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> Linux_study </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux用户与用户组管理</title>
      <link href="2021/09/21/%E5%91%BD%E4%BB%A4%E9%9B%86-3/"/>
      <url>2021/09/21/%E5%91%BD%E4%BB%A4%E9%9B%86-3/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="Linux用户与用户组管理"><a href="#Linux用户与用户组管理" class="headerlink" title="Linux用户与用户组管理"></a>Linux用户与用户组管理</h2><p>上一节已经提到了一些Linux用户的知识</p><p>大部分 Linux 系统在安装时都会建议用户新建一个用户而不是直接使用 root 用户进行登录，当然也有直接使用 root 登录的例如 Kali（基于 Debian 的 Linux 发行版，集成大量工具软件，主要用于数字取证的操作系统）。一般我们登录系统时都是以普通账户的身份登录的，要创建用户需要 root 权限，要用到 <code>sudo</code> 命令。</p><span id="more"></span><h3 id="切换用户"><a href="#切换用户" class="headerlink" title="切换用户"></a>切换用户</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">su &lt;user\&gt;</span><br></pre></td></tr></table></figure><p>使用户切换到user,需要输入目标用户的密码</p><p>sudo <cmd\>可以以特权级别运行 cmd 命令，需要当前用户属于 sudo 组，且需要输入当前用户的密码</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">su - &lt;user\&gt;</span><br></pre></td></tr></table></figure><p>切换用户，但是同时用户的环境变量和工作目录也会跟着改变成目标用户所对应的</p><h3 id="创建用户"><a href="#创建用户" class="headerlink" title="创建用户"></a>创建用户</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo adduser \&lt;user&gt;</span><br></pre></td></tr></table></figure><p>默认情况下，添加用户操作也会相应的增加一个同名的组，用户属于同名组</p><p><img data-src="http://cdn.sekyoro.top/imgs/092949.png" alt="image-20210914162057186"></p><p>这个命令不但可以添加用户到系统，同时也会默认为新用户在 /home 目录下创建一个工作目录</p><p><img data-src="http://cdn.sekyoro.top/imgs/092951.png" alt="image-20210914162257824"></p><h3 id="用户组"><a href="#用户组" class="headerlink" title="用户组"></a>用户组</h3><p>在 Linux 里面每个用户都有一个归属（用户组），用户组简单地理解就是一组用户的集合，它们共享一些资源和权限，同时拥有私有资源</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">groups</span><br></pre></td></tr></table></figure><p>查看用户所属用户组</p><p>新建的用户 所属用户组即自身</p><p><img data-src="http://cdn.sekyoro.top/imgs/065134.png" alt="image-20210914162603936"></p><p>一个用户可以属于多个组，将用户加入到组:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$usermod</span> -G groupName username</span><br></pre></td></tr></table></figure><p><img data-src="http://cdn.sekyoro.top/imgs/065135.png" alt="image-20210914163504552"></p><p>这样stu就拥有sudo权限了</p><p><img data-src="http://cdn.sekyoro.top/imgs/065140.png" alt="image-20210914164017539"></p><p>变更用户所属的根组(将用户加入到新的组，并从原有的组中除去）:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$usermod</span> -g groupName username</span><br></pre></td></tr></table></figure><h3 id="删除用户"><a href="#删除用户" class="headerlink" title="删除用户"></a>删除用户</h3><p><code>sudo deluser lilei --remove-home</code></p><p><img data-src="http://cdn.sekyoro.top/imgs/065145.png" alt="image-20210914164438751"></p><p>系统的所有用户及所有组信息分别记录在两个文件中：/etc/passwd , /etc/group 默认情况下这两个文件对所有用户可读：</p><p>查看所有用户及权限:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$more</span> /etc/passwd</span><br></pre></td></tr></table></figure><p>查看所有的用户组及权限:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$more</span> /etc/group</span><br></pre></td></tr></table></figure><p>当然 less is better than more</p><h5 id="etc-group-文件格式说明"><a href="#etc-group-文件格式说明" class="headerlink" title="etc/group 文件格式说明"></a><code>etc/group</code> 文件格式说明</h5><p>/etc/group 的内容包括用户组（Group）、用户组口令、GID（组 ID） 及该用户组所包含的用户（User），每个用户组一条记录。格式如下：</p><blockquote><p>group_name:password:GID:user_list</p></blockquote><p>如果用户的 GID 等于用户组的 GID，那么最后一个字段 <code>user_list</code> 就是空的</p><p><img data-src="http://cdn.sekyoro.top/imgs/065147.png" alt="image-20210914171348580"></p><p>x表示密码 不可见</p><p>利用查看文件命令可以知道有没有该用户</p><p>grep可以用于搜索</p><p><img data-src="http://cdn.sekyoro.top/imgs/065148.png" alt="image-20210914164726095"></p><h3 id="添加用户组"><a href="#添加用户组" class="headerlink" title="添加用户组"></a>添加用户组</h3><p><code>groupadd</code>命令<br>功能：添加用户组<br>用法：groupadd [-g gid][-o][-r][-f] groupname<br>参数<br>-g gid：除非使用-o参数不然该值必须是唯一，不可相同。数值不可为负。<br>-o：允许设置相同组id的群组<br>-r：建立系统组<br>-f：强制执行，默认是不允许创建相同id的组的，使用此参数就可以，而且不用-o选项。</p><p><img data-src="http://cdn.sekyoro.top/imgs/065149.png" alt="image-20210914165619148"></p><h3 id="修改用户组"><a href="#修改用户组" class="headerlink" title="修改用户组"></a>修改用户组</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">groupmod</span><br></pre></td></tr></table></figure><p>命令<br>功能：修改用户组<br>用法：groupmod [-g gid [-o]] [-n group_name] group<br>参数：<br>-g gid：指定id<br>-o：与groupadd相同<br>-n group_name：修改用户组名为group_name</p><p><img data-src="http://cdn.sekyoro.top/imgs/065152.png" alt="image-20210914165717338"></p><h3 id="删除用户组"><a href="#删除用户组" class="headerlink" title="删除用户组"></a>删除用户组</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">delgroup  &lt;groupname\&gt;</span><br></pre></td></tr></table></figure><p><img data-src="http://cdn.sekyoro.top/imgs/065154.png" alt="image-20210914165056709"></p><p>删除用户组可以使用 <code>groupdel</code> 命令，倘若该群组中仍包括某些用户，则必须先删除这些用户后，才能删除群组。</p><p>注意 adduser 与useradd都有,但是有差别</p><p><code>useradd</code> 只创建用户，不会创建用户密码和工作目录，创建完了需要使用 <code>passwd &lt;username&gt;</code> 去设置新用户的密码。<code>adduser</code> 在创建用户的同时，会创建工作目录和密码（提示你设置），做这一系列的操作</p><p>若使用useradd 则需要使用$passwd username修改密码</p><h3 id="批量添加-删除用户"><a href="#批量添加-删除用户" class="headerlink" title="批量添加(删除用户)"></a>批量添加(删除用户)</h3><p>我在网上搜到的办法基本都是用脚本执行,貌似没有这方面直接的命令</p><p>如果用脚本批量处理的话,这个问题也就不算问题了</p><p>前提是要会写shell脚本</p><p>关于vim以及shell脚本学习内容还是不少的</p><p>我后面会写一点</p><p><img data-src="http://cdn.sekyoro.top/imgs/065157.png" alt="image-20210914172622881"></p><p><img data-src="http://cdn.sekyoro.top/imgs/065200.png" alt="image-20210914172610914"></p><p><img data-src="http://cdn.sekyoro.top/imgs/065217.png" alt="image-20210914172252606"></p><p>我在ubuntu上试了一下,发现会报错  stdin识别不了</p><p>这种方法只能在其他发行版用</p><p>所以换了一个方法</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> username:newpasswd | chpasswd</span><br></pre></td></tr></table></figure><p><img data-src="http://cdn.sekyoro.top/imgs/065220.png" alt="image-20210914190012781"></p><p><strong>注意</strong>  useradd并不会添加主目录,需要加上参数</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$useradd</span> -m username</span><br></pre></td></tr></table></figure><p>该命令为用户创建相应的帐号和用户目录/home/username；</p><p>我加上-m参数后</p><p><img data-src="http://cdn.sekyoro.top/imgs/065221.png" alt="image-20210914190234095"></p><p>但是!!!</p><p>我发现没有办法登录,输入原本的密码不行</p><p>于是查看了 shadow文件(存储用户密码的)</p><p><img data-src="http://cdn.sekyoro.top/imgs/065224.png" alt="image-20210914192729556"></p><p>密码是 ！表示被锁了,然后我发现如果用 |就会报错</p><p><img data-src="http://cdn.sekyoro.top/imgs/065226.png" alt="image-20210914192816986"></p><p><img data-src="http://cdn.sekyoro.top/imgs/092953.png" alt="image-20210914192907922"></p><p>说是认证令牌错误,然后我将chpasswd提升到sudo,即</p><p><img data-src="http://cdn.sekyoro.top/imgs/065227.png" alt="image-20210914192959814"></p><p><img data-src="http://cdn.sekyoro.top/imgs/065229.png" alt="image-20210914193038777"></p><p>修改成功了..所以说是权限不够…</p><p>并且我不清楚 | 与 &gt;的差别..</p><p>后面我再写一些重定向与管道..</p><p>批量删除用户  且删除用户目录 -r</p><p><img data-src="http://cdn.sekyoro.top/imgs/065232.png" alt="image-20210914191430644"></p><p><img data-src="http://cdn.sekyoro.top/imgs/065233.png" alt="image-20210914191500303"></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chpasswd &lt; user.txt</span><br></pre></td></tr></table></figure><h4 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h4><p>也可以利用newusers与chpasswd批量新建用户</p><p>一个user.txt内容如下：</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">user001:x600: 100:user:/home/user001:/bin/bashwin00: x:520:520::/home/win00:/sbin/nologin  通过这个属性让用户无法登录</span><br></pre></td></tr></table></figure><blockquote><p>字段含义：</p><p>Account：用户的名称，如例子中的root；</p><p>Password：用户密码，我们看到这里只显示x，不是指密码就为x，而是表示该密码已经被移动到shadow中去了。</p><p>UID：用户ID。</p><p>GID：组ID。指明用户所属组。</p><p>GECOS：一般说明用户信息的</p><p>Directory：即常说的家目录</p><p>Shell：用来指明用户登录时预设使用的bash</p></blockquote><p>（2）newusers &lt; user.txt</p><p>然后可以执行cat /etc/passwd检查/etc/passwd文件是否已经出现这些用户的数据，并且用户的宿主目录是否已经创建。此时就会在/etc/shadow中对新增的用户产生密码</p><p>（3）编辑每个用户的密码对照文件，</p><p>范例文件passwd.txt内容如下:</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">user001:密码user002:密码....</span><br></pre></td></tr></table></figure><p>（4）chpasswd &lt; passwd.txt</p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> Linux_study </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux 文件管理及目录与权限控制</title>
      <link href="2021/09/21/%E5%91%BD%E4%BB%A4%E9%9B%86-2/"/>
      <url>2021/09/21/%E5%91%BD%E4%BB%A4%E9%9B%86-2/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="Linux-文件管理及目录与权限控制"><a href="#Linux-文件管理及目录与权限控制" class="headerlink" title="Linux 文件管理及目录与权限控制"></a>Linux 文件管理及目录与权限控制</h2><p><strong>前言</strong></p><p>事实上提到对文件及目录管理时,我认为无法避免会说到用户及用户组.所以在这个主题下先提及一下.</p><p>Linux可以实现多用户登陆,这些用户可以共享一些文件,但他们也都有自己的空间.实际上他们的文件都是放在同一个物理磁盘甚至同一个目录的.这就是因为<strong>用户管理</strong>与<strong>权限机制</strong>。<br><span id="more"></span><br>所以有些文件,我们可能无法进行更改,后面会提到.</p><p>输入</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">who am i </span><br></pre></td></tr></table></figure><p>可以查看当前用户</p><p><img data-src="http://cdn.sekyoro.top/imgs/065407.png" alt="image-20210913235127244"></p><p>root账户权限最高,可以对其他用户文件进行删改</p><p>sudo 命令提升权限,否则一些命令可能无法执行</p><p>这个命令会常用</p><p>sudo  #使用这个命令需要知道当前登陆用户密码且该用户在sudo用户组内.</p><p>用户组就是若干个用户在一起的组合,其他用户就是既不是本身用户也不是这个用户组里的用户.</p><h3 id="文件及目录的管理"><a href="#文件及目录的管理" class="headerlink" title="文件及目录的管理"></a>文件及目录的管理</h3><p>有了些基本知识就可以对文件进行操作了</p><p>Linux目录结构与Windows不同,以目录为主.可以理解为树形目录是一个用户可操作系统的骨架。虽然本质上无论是目录结构还是操作系统内核都是存储在磁盘上的，但从逻辑上来说 Linux 的磁盘是挂载在目录上的，每一个目录不仅能使用本地磁盘分区的文件系统，也可以使用网络上的文件系统。</p><p>Linux目录配置依据 FHS。根据这个标准,Linux的目录该放那些文件是有规定的</p><p><img data-src="https://doc.shiyanlou.com/linux_base/4-1.png" alt="img"></p><p><img data-src="http://cdn.sekyoro.top/imgs/065409.png" alt="img"></p><p><strong>关于目录树</strong></p><p>绝对路径: 由根目录/开始写起的文件名或目录名称</p><p>相对路径:相对于目前路径的文件名写法</p><p># 绝对路径 </p><p>cd /usr/local/bin </p><h1 id="相对路径"><a href="#相对路径" class="headerlink" title="相对路径"></a>相对路径</h1><p>cd ../../usr/local/bin</p><p>cd    改变当前目录</p><ul><li>找到文件/目录位置：cd</li><li>切换到上一个工作目录： cd -</li><li>切换到home目录： cd or cd ~</li></ul><p><img data-src="http://cdn.sekyoro.top/imgs/093329.png" alt="image-20210913192130268"></p><ul><li>显示当前路径: pwd</li></ul><p><img data-src="http://cdn.sekyoro.top/imgs/093331.png" alt="image-20210913192046022"></p><ul><li><p>更改当前工作路径为</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">path: <span class="variable">$cd</span> path</span><br></pre></td></tr></table></figure></li></ul><p><img data-src="http://cdn.sekyoro.top/imgs/093333.png" alt="image-20210913192304748"></p><p>.. 表示上一级目录</p><p>.  表示当前目录</p><p>现在可以开始对文件的查看了</p><p>命令</p><ul><li>创建目录：mkdir</li><li>删除：rm</li><li>删除非空目录：rm -rf file目录</li><li>删除日志 rm <em>log (等价: $find ./ -name “</em>log” -exec rm {} ;)</li><li>移动：mv</li><li>复制：cp (复制目录：cp -r )</li><li>创建文件:touch</li></ul><h4 id="新建"><a href="#新建" class="headerlink" title="新建"></a>新建</h4><h5 id="touch-创建空白文件"><a href="#touch-创建空白文件" class="headerlink" title="touch 创建空白文件"></a>touch 创建空白文件</h5><p><img data-src="http://cdn.sekyoro.top/imgs/093335.png" alt="image-20210913192915649"></p><h5 id="mkdir-新建目录"><a href="#mkdir-新建目录" class="headerlink" title="mkdir 新建目录"></a>mkdir 新建目录</h5><p><img data-src="http://cdn.sekyoro.top/imgs/093336.png" alt="image-20210913193233984"></p><p>我们发现如果想创建多层的目录直接使用mkdir不行,需要 mkdir -p</p><p><img data-src="http://cdn.sekyoro.top/imgs/093338.png" alt="image-20210913193350560"></p><p>同时一个目录下文件不能与文件夹同名</p><h4 id="复制"><a href="#复制" class="headerlink" title="复制"></a>复制</h4><p>使用 cp命令（copy）复制一个文件到指定目录</p><p><img data-src="http://cdn.sekyoro.top/imgs/093339.png" alt="image-20210913193711075"></p><p>文件的复制。默认复制文件的数据</p><p><img data-src="http://cdn.sekyoro.top/imgs/065411.png" alt="image-20210913200119663"></p><h5 id="复制目录"><a href="#复制目录" class="headerlink" title="复制目录"></a>复制目录</h5><p>直接使用cp复制目录会出错</p><p>加上参数 -r 递归复制</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$cp</span> -r source_dir  dest_dir</span><br></pre></td></tr></table></figure><p>常用参数</p><p>-f ：为强制 (force) 的意思，若有重复或其它疑问时，不会询问使用者，而强制复制；<br>-i ：若目的文件(destination)已经存在时，在覆盖时会先询问是否真的动作！<br>-l ：进行硬链接 (hard link) 建立，而非复制档案本身；<br>-p ：连同档案的属性(权限,时间,用户)一起复制过去，而非使用预设属性；<br>-r ：递归持续复制，用于目录的复制行为；</p><p>-d:复制成为符号连接</p><p>默认情况下,cp后目标文件拥有者是命令执行者.如果想要连着这个属性更改需要加上-p</p><p>复制时需要考虑:</p><p>保留源文件完整信息?</p><p>源文件是否是符号链接</p><p>源文件是否是mulu</p><h4 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h4><p>使用 <code>rm</code>（remove files or directories）命令删除一个文件</p><p><img data-src="http://cdn.sekyoro.top/imgs/093341.png" alt="image-20210913195612391"></p><p>当然 不能删除本身不存在的文件</p><p>有时候你会遇到想要删除一些为只读权限的文件，直接使用 <code>rm</code> 删除会显示一个提示,加上 -f参数直接强制删除</p><p>-i  在删除前会询问</p><p><img data-src="http://cdn.sekyoro.top/imgs/093342.png" alt="image-20210913195758530"></p><h5 id="删除目录"><a href="#删除目录" class="headerlink" title="删除目录"></a>删除目录</h5><p>同样的,需要加上-r参数才能删除目录</p><p><img data-src="http://cdn.sekyoro.top/imgs/093344.png" alt="image-20210913200839956"></p><p>其实也可以使用rmdir,但只能删除空目录</p><p><img data-src="http://cdn.sekyoro.top/imgs/093345.png" alt="image-20210913201913643"></p><p><img data-src="http://cdn.sekyoro.top/imgs/093347.png" alt="image-20210913201926192"></p><h4 id="移动"><a href="#移动" class="headerlink" title="移动"></a>移动</h4><p>使用mv命令移动文件</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv <span class="built_in">source</span> destination </span><br></pre></td></tr></table></figure><p><img data-src="http://cdn.sekyoro.top/imgs/093351.png" alt="image-20210913201207839"></p><h5 id="重命名文件"><a href="#重命名文件" class="headerlink" title="重命名文件"></a>重命名文件</h5><p><code>mv</code> 命令除了能移动文件外，还能给文件重命名。命令格式为 <code>mv 旧的文件名 新的文件名</code>。</p><p><img data-src="http://cdn.sekyoro.top/imgs/093354.png" alt="image-20210913201430489"></p><h3 id="文件权限"><a href="#文件权限" class="headerlink" title="文件权限"></a>文件权限</h3><p>Unix/Linux 系统是一个典型的多用户系统，不同的用户处于不同的地位，对文件和目录有不同的访问权限。为了保护系统的安全性，Unix/Linux 系统除了对用户权限作了严格的界定外，还在用户身份认证、访问控制、传输安全、文件读写权限等方面作了周密的控制。</p><p>在 Unix/Linux 中的每一个文件或目录都包含有访问权限，这些访问权限决定了谁能访问和如何访问这些文件和目录。</p><h4 id="查看文件与目录"><a href="#查看文件与目录" class="headerlink" title="查看文件与目录"></a>查看文件与目录</h4><p>之前也用到很多次  ls命令</p><p><img data-src="http://cdn.sekyoro.top/imgs/093356.png" alt="image-20210913202256597"></p><p>ls列出目录下的文件</p><p>-a  显示所有文件及目录（包含以“.”开头的隐藏文件）<br><img data-src="http://cdn.sekyoro.top/imgs/093401.png" alt="image-20210913202947310">-l  显示详细文件内容,长格式</p><p>-h  与-l一起使用，输出易于阅读的文件大小。 Human-readable</p><p><img data-src="http://cdn.sekyoro.top/imgs/093403.png" alt="image-20210913202919245"></p><p>-r  将文件以相反次序显示(原定以英文字母次序)</p><p>-d 若不加参数指定目录,ls会列出目录中的内容,若与-l结合则可以查看目录信息</p><p><img data-src="http://cdn.sekyoro.top/imgs/093405.png" alt="image-20210913202837994"></p><p>-t 安修改日期排序输出</p><p>-S 按文件大小排序输出</p><p>我们会发现 在长格式下,文件前面会有一些东西</p><p><img data-src="http://cdn.sekyoro.top/imgs/093407.png" alt="image-20210913203233587"></p><p>分别是 文件类型权限  链接数  文件所属用户组 文件大小Byte  文件最后修改时间  文件名 (当然后面可能会有软链接) </p><p><img data-src="http://cdn.sekyoro.top/imgs/065412.png" alt="pic"></p><h4 id="关于权限"><a href="#关于权限" class="headerlink" title="关于权限"></a>关于权限</h4><p><img data-src="https://doc.shiyanlou.com/linux_base/3-10.png" alt="pic"></p><p>读权限，表示你可以使用 <code>cat &lt;file name&gt;</code> 命令来读取某个文件的内容；写权限，表示你可以编辑和修改某个文件的内容；</p><p>执行权限，通常指可以运行的二进制程序文件或者脚本文件，如同 Windows 上的 <code>exe</code> 后缀的文件，不过 Linux 上不是通过文件后缀名来区分文件的类型。你需要注意的一点是，<strong>一个目录同时具有读权限和执行权限才可以打开并查看内部文件，而一个目录要有写权限才允许在其中创建其它文件</strong>，这是因为目录文件实际保存着该目录里面的文件的列表等信息。</p><p><img data-src="http://cdn.sekyoro.top/imgs/093409.png" alt="image-20210913203914866"></p><p>可以分析一下,这是个目录(d) 拥有者与用户组权限都是rwx,即可读可写可执行. 但其他用户不能写,说明其他用户不能改写该目录.所有者与所属用户组为shiyanlou</p><h4 id="更改权限"><a href="#更改权限" class="headerlink" title="更改权限"></a>更改权限</h4><p>chgrp:修改文件所属用户组</p><p>chown:修改文件拥有者</p><p>-R 参数递归修改连通目录下的所有文件</p><p>chomd:修改文件的权限</p><ul><li>改变文件的拥有者 chown</li><li>改变文件读、写、执行等属性 chmod</li><li>递归子目录修改： chown -R tuxapp source/</li><li>增加脚本可执行权限： chmod a+x myscript</li></ul><p>注意 用户组在 etc/group里。用户在etc/passwd里</p><h5 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h5><p><img data-src="http://cdn.sekyoro.top/imgs/093412.png" alt="image-20210913205052643"></p><p>创建用户,在该用户目录下创建ipone文件。发现该文件所有者是lilei</p><p>现在切回root</p><p><img data-src="http://cdn.sekyoro.top/imgs/093414.png" alt="image-20210913205812323"></p><p>发现该文件所有者变为shiyanlou</p><p><img data-src="http://cdn.sekyoro.top/imgs/065414.png" alt="image-20210913205912499"></p><p>现在是更改了文件的所有者,下面继续更改所属用户组</p><p><img data-src="http://cdn.sekyoro.top/imgs/065417.png" alt="image-20210913212151973"></p><p>这样的话lilei就只有rx的权限了,也就是说无法更改文件.我们试一试</p><p><img data-src="http://cdn.sekyoro.top/imgs/093417.png" alt="image-20210913212322183"></p><p>会发现无法修改…</p><p>接下来进行修改权限</p><ol><li><p>二进制数字表示</p><p><img data-src="http://cdn.sekyoro.top/imgs/065421.png" alt="pic"></p></li></ol><p>第一位指定属主的权限，第二位指定组权限，第三位指定其他用户的权限，每位通过4(读)、2(写)、1(执行)三种数值的和来确定权限。如6(4+2)代表有读写权，7(4+2+1)有读、写和执行的权限。</p><p>例如<img data-src="http://cdn.sekyoro.top/imgs/065426.png" alt="image-20210913211810594"></p><p>可以发现改为了拥有者可读可写</p><ol><li><p>符号操作</p><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"><span class="meta-keyword">$chmod</span> userMark(+|-)PermissionsMark</span></span><br></pre></td></tr></table></figure><p>userMark取值：</p><ul><li>u：用户</li><li>g：组</li><li>o：其它用户</li><li>a：所有用户</li></ul><p>PermissionsMark取值：</p><ul><li>r:读</li><li>w：写</li><li>x：执行</li></ul></li></ol><p><img data-src="http://cdn.sekyoro.top/imgs/093418.png" alt="image-20210913212537141"></p><p><code>+</code> 和 <code>-</code> 分别表示增加和去掉相应的权限。</p><p>在shell中，要修改文件当前的用户必须具有管理员root的权限。可以通过su命令切换到root用户，也可以通过sudo获得root的权限</p><p><strong>注意</strong>:对于文件和文件夹来说。 rwx权限不太一样</p><p>文件:r 读取文件内容  w修改文件内容  x执行文件内容</p><p>目录:r 读到文件名  w修改文件名  x进入目录权限</p><p>也就是说若没有x权限,无法进入目录(不代表不能知道目录下的东西)</p><h5 id="实例-1"><a href="#实例-1" class="headerlink" title="实例"></a>实例</h5><p><img data-src="http://cdn.sekyoro.top/imgs/093420.png" alt="image-20210913213443471"></p><p>创建一个目录 然后更改权限 使得用户组与其他用户只有r权限</p><p><img data-src="http://cdn.sekyoro.top/imgs/093422.png" alt="image-20210913213634417"></p><p>使用groups查看当前用户的用户组。发现他加入了多个用户组</p><p><img data-src="http://cdn.sekyoro.top/imgs/065429.png" alt="image-20210913213536038"></p><p>然后想要进入该目录权限不够,因为只有r</p><p>sudo大法  更改权限进入文件</p><p><img data-src="http://cdn.sekyoro.top/imgs/065431.png" alt="image-20210913214229305"></p><p>添加一个文件</p><p><img data-src="http://cdn.sekyoro.top/imgs/093424.png" alt="image-20210913214622660"></p><p>发现可以查询目录下的文件名列表但无法切换到目录内。甚至无法读取文件内容</p><h4 id="file确定文件类型"><a href="#file确定文件类型" class="headerlink" title="file确定文件类型"></a>file确定文件类型</h4><p>Linux下不要求文件名反应文件类型,使用file命令可以查看类型</p><p><img data-src="http://cdn.sekyoro.top/imgs/093427.png" alt="image-20210913215723013"></p><p><img data-src="http://cdn.sekyoro.top/imgs/065433.png" alt="image-20210913225537180"></p><h4 id="less查看文本文件"><a href="#less查看文本文件" class="headerlink" title="less查看文本文件"></a>less查看文本文件</h4><p><img data-src="http://cdn.sekyoro.top/imgs/065434.png" alt="image-20210913215804478"></p><p>我们可以上下翻页。q退出</p><h4 id="cat"><a href="#cat" class="headerlink" title="cat"></a>cat</h4><p>cat命令用于连接文件并打印到标准输出设备上。</p><p>我写在这里是因为这些命令用的挺多的</p><p>把 textfile1 的文档内容加上行号后输入 textfile2 这个文档里：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat -n textfile1 &gt; textfile2</span><br></pre></td></tr></table></figure><p>把 textfile1 和 textfile2 的文档内容加上行号（空白行不加）之后将内容附加到 textfile3 文档里：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat -b textfile1 textfile2 &gt;&gt; textfile3</span><br></pre></td></tr></table></figure><h4 id="查看文件：cat-vi-head-tail-more"><a href="#查看文件：cat-vi-head-tail-more" class="headerlink" title="查看文件：cat vi head tail more"></a>查看文件：cat vi head tail more</h4><p>显示时同时显示行号:</p><figure class="highlight sh"><figcaption><span>l</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$cat</span> -n</span><br></pre></td></tr></table></figure><p>按页显示列表内容:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">ls -al | more</span></span><br></pre></td></tr></table></figure><p>只看前10行:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">head - 10 **</span></span><br></pre></td></tr></table></figure><p>显示文件第一行:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">head -1 filename</span></span><br></pre></td></tr></table></figure><p>显示文件倒数第五行:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">tail -5 filename</span></span><br></pre></td></tr></table></figure><p>查看两个文件间的差别:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">diff file1 file2</span></span><br></pre></td></tr></table></figure><p>动态显示文本最新信息:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">tail -f crawler.log</span></span><br></pre></td></tr></table></figure><h3 id="链接"><a href="#链接" class="headerlink" title="链接"></a>链接</h3><p>Linux链接分两种，一种被称为硬链接（Hard Link），另一种被称为符号链接（Symbolic Link）。默认情况下，ln命令产生硬链接</p><p>在Linux的文件系统中，保存在磁盘分区中的文件不管是什么类型都给它分配一个编号，称为索引节点号(Inode Index)。在Linux中，多个文件名指向同一索引节点是存在的</p><h4 id="软链接"><a href="#软链接" class="headerlink" title="软链接"></a>软链接</h4><p>也叫符号链接</p><p>与Windows的快捷方式类似</p><p>在符号连接中，文件实际上是一个文本文件，其中包含的有另一文件的位置信息。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ln -s cc ccTo :符号链接(软链接)；删除源，另一个无法使用；（后面一个ccTo 为新建的文件）</span><br></pre></td></tr></table></figure><p><img data-src="http://cdn.sekyoro.top/imgs/065436.png" alt="image-20210913220642505"></p><p>ls -li   -i可以显示inode节点。通过这个判断链接。当然,符号链接inode不同且有箭头指向被链接的文件.</p><p>若源文件被删,则符号链接的文件也失效</p><p><img data-src="http://cdn.sekyoro.top/imgs/065439.png" alt="image-20210913221115358"></p><p><img data-src="http://cdn.sekyoro.top/imgs/065444.png" alt="image-20210913221136588"></p><h4 id="硬链接"><a href="#硬链接" class="headerlink" title="硬链接"></a>硬链接</h4><p>它与软链接实现方式不同</p><p>硬链接指通过索引节点来进行连接。硬连接的作用是允许一个文件拥有多个有效路径名，这样用户就可以建立硬连接到重要文件，以防止“误删”的功能。其原因如上所述，因为对应该目录的索引节点有一个以上的链接。只删除一个连接并不影响索引节点本身和其它的连接，只有当最后一个连接被删除后，文件的数据块及目录的连接才会被释放。也就是说，文件真正删除的条件是与之相关的所有硬连接文件均被删除。</p><p><img data-src="http://cdn.sekyoro.top/imgs/065446.png" alt="image-20210913221552058"></p><p>硬链接f2到f1，将f1删掉.因为节点相同,发现原本软链接到f1的f3硬链接到了f2</p><p><img data-src="http://cdn.sekyoro.top/imgs/065448.png" alt="image-20210913221853123"></p><p>删除被软链接的文件,在创建同名文件,发现软链接的文件更新了</p><p><img data-src="http://cdn.sekyoro.top/imgs/065452.png" alt="image-20210913222100169"></p><h3 id="文件压缩与解压"><a href="#文件压缩与解压" class="headerlink" title="文件压缩与解压"></a>文件压缩与解压</h3><p>在 Windows 上最常见的不外乎这两种 <code>*.zip</code>，<code>*.7z</code> 后缀的压缩文件。而在 Linux 上面常见的格式除了以上两种外，还有 <code>.rar</code>，<code>*.gz</code>，<code>*.xz</code>，<code>*.bz2</code>，<code>*.tar</code>，<code>*.tar.gz</code>，<code>*.tar.xz</code>，<code>*.tar.bz2</code>，</p><p>Linux 常用的压缩与解压缩命令有：tar、gzip、gunzip、bzip2、bunzip2、compress 、uncompress、 zip、 unzip、rar、unrar 等</p><div class="table-container"><table><thead><tr><th>文件后缀名</th><th>说明</th></tr></thead><tbody><tr><td><code>*.zip</code></td><td>zip 程序打包压缩的文件</td></tr><tr><td><code>*.rar</code></td><td>rar 程序压缩的文件</td></tr><tr><td><code>*.7z</code></td><td>7zip 程序压缩的文件</td></tr><tr><td><code>*.tar</code></td><td>tar 程序打包，未压缩的文件</td></tr><tr><td><code>*.gz</code></td><td>gzip 程序（GNU zip）压缩的文件</td></tr><tr><td><code>*.xz</code></td><td>xz 程序压缩的文件</td></tr><tr><td><code>*.bz2</code></td><td>bzip2 程序压缩的文件</td></tr><tr><td><code>*.tar.gz</code></td><td>tar 打包，gzip 程序压缩的文件</td></tr><tr><td><code>*.tar.xz</code></td><td>tar 打包，xz 程序压缩的文件</td></tr><tr><td><code>*tar.bz2</code></td><td>tar 打包，bzip2 程序压缩的文件</td></tr><tr><td><code>*.tar.7z</code></td><td>tar 打包，7z 程序压缩的文件</td></tr></tbody></table></div><p>简单来说,就是打包,压缩</p><h4 id="tar"><a href="#tar" class="headerlink" title="tar"></a>tar</h4><h5 id="打包"><a href="#打包" class="headerlink" title="打包"></a>打包</h5><p>最常用的打包命令是 tar，使用 tar 程序打出来的包我们常称为 tar 包，tar 包文件的命令通常都是以 .tar 结尾的。生成 tar 包后，就可以用其它的程序来进行压缩了</p><p>​    tar实现了对 7z、gzip、xz、bzip2 等工具的支持，这些压缩工具本身只能实现对文件或目录（单独压缩目录中的文件）的压缩，没有实现对文件的打包压缩.</p><p>下来来介绍参数</p><p>-c 创建一个tar包   -f指定文件名</p><p>-r 增加文件</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo tar -cf mytar.tar file</span><br></pre></td></tr></table></figure><p><img data-src="http://cdn.sekyoro.top/imgs/065458.png" alt="image-20210913223434051"></p><p>创建了一个tar包</p><p>还可以加上 <code>-v</code> 参数以可视的的方式输出打包的文件。</p><p><img data-src="http://cdn.sekyoro.top/imgs/093429.png" alt="image-20210913223923573"></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -uf all.tar logo.gif</span><br></pre></td></tr></table></figure><p>更新原来 tar 包 all.tar 中 logo.gif 文件，-u 是表示更新文件的意思</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -tf all.tar</span><br></pre></td></tr></table></figure><p>列出 all.tar 包中所有文件，-t 是列出文件的意思</p><ul><li>保留文件属性和跟随链接（符号链接或软链接），有时候我们使用 tar 备份文件当你在其他主机还原时希望保留文件的属性（<code>-p</code> 参数）和备份链接指向的源文件而不是链接本身（<code>-h</code> 参数）：</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -cphf etc.tar /etc</span><br></pre></td></tr></table></figure><h5 id="解包"><a href="#解包" class="headerlink" title="解包"></a>解包</h5><p>解包一个文件（<code>-x</code> 参数）到指定路径的<strong>已存在</strong>目录（<code>-C</code> 参数）</p><p><img data-src="http://cdn.sekyoro.top/imgs/065459.png" alt="image-20210913225018181"></p><p><img data-src="http://cdn.sekyoro.top/imgs/065501.png" alt="image-20210913224507056"></p><p>只查看不解包文件 <code>-t</code> 参数</p><h5 id="压缩与解压"><a href="#压缩与解压" class="headerlink" title="压缩与解压"></a>压缩与解压</h5><p>对于创建不同的压缩格式的文件，对于 tar 来说是相当简单的，需要的只是换一个参数</p><p>在创建 tar 文件的基础上添加 <code>-z</code> 参数</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo tar -czf mytar.tar.gz file</span><br></pre></td></tr></table></figure><p><img data-src="http://cdn.sekyoro.top/imgs/065503.png" alt="image-20210913225228029"></p><p>解压文件使用 -xzf (对于gzip)</p><p><img data-src="http://cdn.sekyoro.top/imgs/065506.png" alt="image-20210913225338711"></p><div class="table-container"><table><thead><tr><th>压缩文件格式</th><th>参数</th></tr></thead><tbody><tr><td><code>*.tar.gz</code></td><td><code>-z</code></td></tr><tr><td><code>*.tar.xz</code></td><td><code>-J</code></td></tr><tr><td><code>*tar.bz2</code></td><td><code>-j</code></td></tr></tbody></table></div><h4 id="zip"><a href="#zip" class="headerlink" title="zip"></a>zip</h4><p>其实光tar已经够了,这里稍微写一下zip</p><p><code>-r</code> 参数表示递归打包包含子目录的全部内容</p><p><code>-q</code> 参数表示为安静模式，即不向屏幕输出信息</p><p><code>-o</code>，表示输出文件</p><p>还可以设置压缩等级</p><p>zip -r -o myzip.zip file</p><p><img data-src="http://cdn.sekyoro.top/imgs/065511.png" alt="image-20210913225914594"></p><p>du用于查看文件大小</p><p>-e设置密码</p><p><img data-src="http://cdn.sekyoro.top/imgs/065514.png" alt="image-20210913230218420"></p><p>-l 用于使LF转化为CR+LF. 也就是linux换行符为LF在windows上无法显示</p><p><strong>unzip用于解压</strong></p><p>-q 安静模式</p><p>-d  指定输出到的目录</p><p>-l  不解压只查看内容</p><p>中文压缩包 -O GBK 指定编码类型</p><p><strong>小结</strong></p><ul><li>zip：</li><li>打包 ：zip something.zip something （目录请加 -r 参数）</li><li>解包：unzip something.zip</li><li>指定路径：-d 参数</li><li>tar：</li><li>打包：tar -cf something.tar something</li><li>解包：tar -xf something.tar</li><li>指定路径：-C 参数</li></ul><h2 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h2><h3 id="find"><a href="#find" class="headerlink" title="find"></a>find</h3><p>实时查找</p><p>搜寻文件或目录:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$find</span> ./ -name <span class="string">&quot;core*&quot;</span> | xargs file</span><br></pre></td></tr></table></figure><p>查找目标文件夹中是否有obj文件:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$find</span> ./ -name <span class="string">&#x27;*.o&#x27;</span></span><br></pre></td></tr></table></figure><p>指定目录  与 -name查找关键字(可用正则)</p><p>递归当前目录及子目录删除所有.o文件:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$find</span> ./ -name <span class="string">&quot;*.o&quot;</span> -<span class="built_in">exec</span> rm &#123;&#125; \;</span><br></pre></td></tr></table></figure><h3 id="locate"><a href="#locate" class="headerlink" title="locate"></a>locate</h3><p>locate会为文件系统建立索引数据库，如果有文件更新，需要定期执行更新命令来更新索引库。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$locate</span> string</span><br></pre></td></tr></table></figure><p>寻找包含有string的路径:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$updatedb</span></span><br></pre></td></tr></table></figure><p>与find不同，locate并不是实时查找。你需要更新数据库，以获得最新的文件索引信息。</p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> Linux_study </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux软件部署及应用</title>
      <link href="2021/09/21/%E5%91%BD%E4%BB%A4%E9%9B%86-1/"/>
      <url>2021/09/21/%E5%91%BD%E4%BB%A4%E9%9B%86-1/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>玩玩linux<br><span id="more"></span></p><h2 id="1-Linux软件部署及应用"><a href="#1-Linux软件部署及应用" class="headerlink" title="1.Linux软件部署及应用"></a>1.Linux软件部署及应用</h2><p>在Linux中,软件包分为</p><ul><li>源码包安装  提供了该软件所有程序源代码的发布形式，需要用户自己<strong>编译成可执行的二进制代码并进行安装</strong>，优点是<strong>配置灵活</strong>，可以随意去掉或保留某些功能或者模块，适应多种硬件/操作系统平台及编译环境，缺点就是<strong>难度比较大</strong>，一般不适合初学者使用。</li><li>二进制包安装  事先已经编译好的<strong>二进制</strong>形式的软件包，有点事<strong>安装方便</strong>，缺点是灵活性差，如果该软件包是为特定的硬件/操作系统平台编译的，那它就不能再另外的平台或者环境下正确执行</li></ul><p>注意,在不同linux发行版上软件安装机制不同</p><ul><li>DPKG Debian(ubuntu)   命令rpm   在线升级 yum </li><li>RPM  (Centos Fedora)   命令dpkg    在线apt(apt-get)</li></ul><h3 id="源码包安装"><a href="#源码包安装" class="headerlink" title="源码包安装"></a>源码包安装</h3><p>软件发布者将源代码先以tar打包,再进行压缩(如gzip,bzip2,xz)得到所谓<a href="https://baike.baidu.com/item/tarball/6505617">Tarball </a>文件.</p><p>解压该文件可以得到</p><ul><li>源代码文件</li><li>检测程序文件(configure或config文件)</li><li>本软件的建议安装说明(install或readme)</li></ul><p>通常的安装流程</p><ol><li>在厂商网站下载一个Tarball文件</li><li>将Tarball文件解开,产生很多源代码文件</li><li>利用gcc或make(与makefile)结合,产生目标文件</li><li>以gcc进行函数库与主,子程序进行链接,形成主要的二进制文件</li><li>将上述文件以及相关配置文件安装在主机上(install)</li></ol><h4 id="大概步骤"><a href="#大概步骤" class="headerlink" title="大概步骤"></a>大概步骤</h4><p>下载源代码软件包</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget url</span><br></pre></td></tr></table></figure><p>或者直接在一些网站上下载得到一个压缩包 wget功能下载url上的文件</p><p>解压缩</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tar -jxvf xx.tar.bz2</span><br><span class="line">tar -zxvf xx.tar.gz</span><br></pre></td></tr></table></figure><p>进入压缩目录</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./configure.   <span class="comment">#编译环境检查以及安装配置</span></span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">--prefix == 安装路径</span><br></pre></td></tr></table></figure><p>编译源代码</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make   <span class="comment">#再修改configure后会有一个makefile。 make利用该文件(文件中有相关的配置条件)进行编译</span></span><br></pre></td></tr></table></figure><p>当然之前也可以make clean一下,目的是清除.o目标文件 </p><p>安装到本机器</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make install</span><br></pre></td></tr></table></figure><p><strong>注意</strong>：查看安装说明,提前处理软件包依赖</p><h4 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h4><p>之前我在虚拟机上装了一个bochs(开源IA-32(x86)电脑模拟器) 符合源代码安装,把这个过程记录下</p><ol><li><p>在官网下载软件包,会得到一个压缩包. tar.gz或类似后缀文件</p></li><li><p>解压该文件。tar -zxvf nasm.tar.gz</p><p>得到一个文件夹</p></li></ol><p><img data-src="http://cdn.sekyoro.top/imgs/065551.png" alt="image-20210912223547434"></p><ol><li><p>前两步其实很简单,现在是源码安装的重点:配置</p><p>在得到的文件中有许多程序文件,通常有configure,我们可以通过 ./configure -参数 来进行相关配置</p><p><img data-src="http://cdn.sekyoro.top/imgs/065553.png" alt="image-20210912223807497"></p><p>进行编译设置</p><p>当然,我门很可能根本不知道有哪些参数,可以在解压得到文件中找到相关配置说明(一定会有的,不过是英文)</p><p><img data-src="http://cdn.sekyoro.top/imgs/065555.png" alt="image-20210912223955416"></p></li></ol><p>   配置好后会有makefile(或类似的东西),然后直接make根据这个配置文件进行配置,配置好后就能直接安装了</p><p> <img data-src="http://cdn.sekyoro.top/imgs/093630.png" alt="image-20210912224149809"></p><p>   因为我已经装好的,这里显示就会不一样</p><ol><li>安装。make install</li></ol><p><img data-src="http://cdn.sekyoro.top/imgs/065557.png" alt="image-20210912224240669"></p><h3 id="二进制安装"><a href="#二进制安装" class="headerlink" title="二进制安装"></a>二进制安装</h3><p>我们需要做的只是将从网络上下载的二进制包解压后放到合适的目录，然后将包含可执行的主程序文件的目录添加进<code>PATH</code>环境变量即可</p><p>优点：安装过程简单快速</p><p>缺点：无法查看源代码、选择功能不灵活、有依赖性（需要提前一些前置依赖包）</p><p>这就设计到刚才说的rpm与dpkg了.     <strong>注意srpm里面是源码,rpm与dpkg下载的是经过编译的二进制文件,不可修改参数</strong></p><p>我认为二进制安装难点是安装的路径以及相关的东西,它都给你默认了,灵活性小,但安装简单.</p><p>dpkg与rpm只是用在不同linux发行平台,因为我用的ubuntu,只写一下dpkg就行了.道理类似.</p><p>dpkg本身是一个底层工具,上层的工具如apt,用于远程获取安装包</p><div class="table-container"><table><thead><tr><th>参数</th><th>说明</th><th></th></tr></thead><tbody><tr><td>-i</td><td>安装指定deb包</td><td></td></tr><tr><td>-R</td><td>加上目录,安装目录下的所有deb包</td><td></td></tr><tr><td>-r</td><td>remove 移除安装的软件包</td><td></td></tr><tr><td>-s</td><td>显示已安装包的信息</td><td></td></tr><tr><td>-L</td><td>显示已安装的软件包的目录信息</td><td></td></tr><tr><td>-l</td><td>列出已安装的所有软件包</td></tr></tbody></table></div><h3 id="大概步骤-1"><a href="#大概步骤-1" class="headerlink" title="大概步骤"></a>大概步骤</h3><ol><li>下载(不安装)一个二进制文件(如何知道是否是一个二进制文件呢,要么自己甄别,要么利用apt或yum)一般 .rpm .deb 是二进制</li><li>利用dpkg(ubuntu)或rpm(Centos)安装,参数见上,列举不全,自行搜索</li><li>这样文件就在对应的目录</li></ol><p>过程确实比源码包安装简单</p><p>注意: apt-get install安装目录是包的维护者确定的，不是用户</p><h4 id="实例-1"><a href="#实例-1" class="headerlink" title="实例"></a>实例</h4><p>我安装一个Emacs试一试</p><p>涉及到apt  后面会说</p><ol><li><p>利用apt在线下载一个软件</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update  <span class="comment">#更新软件列表</span></span><br><span class="line">sudo apt -d install -y emacs <span class="comment">#只下载不安装 且回应安装选项时一律yes.</span></span><br></pre></td></tr></table></figure><p><img data-src="http://cdn.sekyoro.top/imgs/065600.png" alt="image-20210912231853997"></p></li><li><p>利用dpkg安装</p><p>可以把安装包移动到一个路径下安装在那</p><p>我们发现不止下载了一个包,说有依赖关系,要一起安装</p><p><img data-src="http://cdn.sekyoro.top/imgs/065604.png" alt="image-20210912232149245"></p></li></ol><p>​                    如果出现一些依赖关系,安装时就要提前或一起安装</p><p>​                    这是可以利用apt的 -f参数修复依赖关系,相当于将没安装的都装上了</p><p><img data-src="http://cdn.sekyoro.top/imgs/065612.png" alt="image-20210912232408925"></p><h3 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h3><p>在线下载</p><p>apt与yum</p><p>我们用到了apt下载,这个东西其实很常用.yum是其他发行版的,同理</p><p>一般有人常用apt-get,事实上apt更常用,也更好(至少我认为)</p><p><img data-src="http://cdn.sekyoro.top/imgs/065617.png" alt="image-20210912232716641"></p><p>apt可以自动下载,配置安装二进制<strong>或源代码</strong>格式的软件包.</p><p>当执行安装时,会在本地的数据库中搜索关于软件的相关信息,根据信息在相关服务器上下载(你也许最好要换源).需要执行sudo apt update 使本地软件包列表与服务器保持一致.</p><p>好消息：apt可以很好的处理依赖关系</p><div class="table-container"><table><thead><tr><th>工具</th><th>说明</th><th></th></tr></thead><tbody><tr><td>install</td><td>安装软件包</td><td></td></tr><tr><td>update</td><td>从服务器上更新用于更新本地软件的列表</td><td></td></tr><tr><td>upgrade</td><td>升级本地软件</td><td></td></tr><tr><td>remove</td><td>移除已安装的软件包与与其有关系的软件包(株连)</td><td></td></tr><tr><td>clean</td><td>移除下载到本地的软件包  路径 /var/cache/apt/archives/</td></tr></tbody></table></div><div class="table-container"><table><thead><tr><th>参数</th><th>说明</th><th></th></tr></thead><tbody><tr><td>-d</td><td>只下载不安装</td><td></td></tr><tr><td>-y</td><td>自动回应是否安装软件包的选项  yes</td><td></td></tr><tr><td>-f</td><td>修复依赖关系</td></tr></tbody></table></div><p>可以使用sudo-cache search搜索本地有没有该软件</p><p><img data-src="http://cdn.sekyoro.top/imgs/065621.png" alt="image-20210912233857067"></p><h3 id="软件卸载-更新"><a href="#软件卸载-更新" class="headerlink" title="软件卸载 更新"></a>软件卸载 更新</h3><p>根据不同的安装方式进行</p><h4 id="源码卸载-更新"><a href="#源码卸载-更新" class="headerlink" title="源码卸载 更新"></a>源码卸载 更新</h4><p>我们已经知道源码安装比较麻烦了,卸载的话也有点小麻烦</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make uninstall <span class="comment">#可以卸载</span></span><br></pre></td></tr></table></figure><p>事实上有些源码包并未提供这样的卸载方式</p><p>可以在安装时指定安装路径   —prefix==路径</p><p>卸载时把那个目录删除就行 </p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm  -rf 目录</span><br></pre></td></tr></table></figure><p>更新的话,如果是从网站上下载编译的只有重新下载再走一遍流程</p><h4 id="二进制卸载-更新"><a href="#二进制卸载-更新" class="headerlink" title="二进制卸载 更新"></a>二进制卸载 更新</h4><p>二进制代码如果在一个目录(比如是解压到一个目录的情况),直接</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm -rf 目录</span><br></pre></td></tr></table></figure><p>我试一下,卸载源码安装的bochs,试一试 make uninstall</p><p><img data-src="http://cdn.sekyoro.top/imgs/065623.png" alt="image-20210912234855213"></p><p>成功了,我好不容易安装的软件没了</p><p>可以看出,安装的软件的路径不太好确定</p><p>更新的话同理,事实上如果从网站上下载的,不管是源码还是二进制,只能重新走一遍开始的流程了</p><p><strong>但是</strong></p><p>如果用apt或类似的软件管理就不一样了</p><p>更新软件包</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt update         <span class="comment"># 更新安装源(Source)apt upgrade         # 更新已安装的软件包apt dist-upgrade      # 更新已安装的软件包(识别并处理依赖关系的改变)</span></span><br></pre></td></tr></table></figure><p>卸载软件包</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt remove PackageName       <span class="comment"># 删除软件包, 保留配置文件apt purge PackageName        # 删除软件包, 同时删除配置文件apt autoremove PackageName     # 移除之前被其他软件依赖但不再被使用的软件</span></span><br></pre></td></tr></table></figure><p> 安装软件包</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt install PackageName         <span class="comment"># 普通安装apt install PackageName=VersionName   # 安装指定包的指定版本apt --reinstall install PackageName   #重新安装apt build-dep PackageName        # 安装源码包所需要的编译环境apt -f install             # 修复依赖关系</span></span><br></pre></td></tr></table></figure><p><strong>注意</strong> 如果出现一些问题需要重新安装软件, —reinstall install很有用，</p><p>同时dpkg也可以处理软件的卸载</p><ol><li>dpkg -r package-name删除软件包（保留配置信息）</li><li>dpkg —configure package-name 配置软件包，如果加上<code>-a</code>表示配置所有未配置的软件包</li></ol><h4 id="实例-2"><a href="#实例-2" class="headerlink" title="实例"></a>实例</h4><p>1.更新软件列表</p><p><img data-src="http://cdn.sekyoro.top/imgs/065628.png" alt="image-20210913000617325"></p><p>2.更新本地软件</p><p><img data-src="http://cdn.sekyoro.top/imgs/065630.png" alt="image-20210913000704670"></p><p>这样就更新了</p><p>卸载的话 </p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt remove</span><br></pre></td></tr></table></figure><p>就不示范了,懒得再装</p><h3 id="帮助命令"><a href="#帮助命令" class="headerlink" title="帮助命令"></a>帮助命令</h3><p>因为Linux命令太多了,学会使用帮助很重要</p><ul><li>在只记得部分命令关键字的场合，我们可通过man -k来搜索；</li><li>需要知道某个命令的简要说明，可以使用whatis；而更详细的介绍，则可用info命令；</li></ul><p><img data-src="http://cdn.sekyoro.top/imgs/065632.png" alt="image-20210913231211364"></p><ul><li>查看命令在哪个位置，我们需要使用which；</li><li>而对于命令的具体参数及使用方法，我们需要用到强大的man</li><li>help也可以查看内置命令(help不在zsh中,且ls不是内置命令）</li></ul><p>简要说明命令的作用（显示命令所处的man分类页面）:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$whatis</span> <span class="built_in">command</span></span><br></pre></td></tr></table></figure><p>查看程序的binary文件所在路径:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$which</span> <span class="built_in">command</span></span><br></pre></td></tr></table></figure><p>详细的说明文档:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$info</span> <span class="built_in">command</span></span><br></pre></td></tr></table></figure><p>eg:查找make程序安装路径:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$which</span> make/opt/app/openav/soft/bin/make install</span><br></pre></td></tr></table></figure><p>查看程序的搜索路径:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$whereis</span> <span class="built_in">command</span></span><br></pre></td></tr></table></figure><p>当系统中安装了同一软件的多个版本时，不确定使用的是哪个版本时，这个命令就能派上用场</p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> Linux_study </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>微信小程序开发</title>
      <link href="2021/09/06/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%BC%80%E5%8F%91/"/>
      <url>2021/09/06/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%BC%80%E5%8F%91/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="微信小程序开发"><a href="#微信小程序开发" class="headerlink" title="微信小程序开发"></a>微信小程序开发</h1><p>开发文档挺齐全的,也是借着微信这个平台.</p><p>开发模式也挺好.</p><p>不过缺点也是只能局限在这个平台,要开发手机软件还要看其他的而且现在web比较好.</p><span id="more"></span><p><strong>开发文档</strong></p><p><a href="https://developers.weixin.qq.com/miniprogram/dev/framework/quickstart/">小程序简介 | 微信开放文档 (qq.com)</a></p><h2 id="目录结构"><a href="#目录结构" class="headerlink" title="目录结构"></a>目录结构</h2><p><img data-src="http://cdn.sekyoro.top/imgs/094148.png" alt="image-20210831185320318"></p><p><img data-src="http://cdn.sekyoro.top/imgs/image-20210831185251774.png" alt="image-20210831185251774" style="zoom:67%;" /></p><h3 id="项目配置文件"><a href="#项目配置文件" class="headerlink" title="项目配置文件"></a>项目配置文件</h3><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">project.config.json</span><br></pre></td></tr></table></figure><p><img data-src="http://cdn.sekyoro.top/imgs/094149.png" alt="image-20210831185432310"></p><p>当你重新安装工具或者换电脑工作时，你只要载入同一个项目的代码包，开发者工具就自动会帮你恢复到当时你开发项目时的个性化配置，其中会包括编辑器的颜色、代码上传时自动压缩等等一系列选项。</p><h3 id="主体文件"><a href="#主体文件" class="headerlink" title="主体文件"></a>主体文件</h3><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">app.json</span><br><span class="line"></span><br><span class="line">app.js</span><br><span class="line"></span><br><span class="line">app.wxss（可选文件）</span><br></pre></td></tr></table></figure><h4 id="app-json"><a href="#app-json" class="headerlink" title="app.json"></a>app.json</h4><p>小程序的全局配置文件.包含</p><ol><li>小程序所有页面的路径地址</li><li>导航栏样式</li><li><p>…</p></li><li><p><code>pages</code>字段 —— 用于描述当前小程序所有页面路径，这是为了让微信客户端知道当前你的小程序页面定义在哪个目录。</p></li><li><code>window</code>字段 —— 定义小程序所有页面的顶部背景颜色，文字颜色定义等</li></ol><p>还可以配置tabBar,networkTimeout,debug等属性</p><p>注意:pages记录小程序所有页面的路径地址.其中如果有多个页面地址,<strong>第一个默认为小程序初始页面</strong></p><p>tabBar设置页面底部tab工具条表现</p><p><img data-src="http://cdn.sekyoro.top/imgs/094151.png" alt="image-20210831192321856"></p><p>window属性对应的值是对象形式</p><p>还有networkTimeout和debug</p><p><img data-src="http://cdn.sekyoro.top/imgs/094153.png" alt="image-20210831192927512"></p><h4 id="app-js"><a href="#app-js" class="headerlink" title="app.js"></a>app.js</h4><p>全局逻辑文件</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">App(</span><br><span class="line"></span><br><span class="line">&#123;<span class="function"><span class="title">onLaunch</span>(<span class="params"></span>)</span>&#123;&#125;,</span><br><span class="line"></span><br><span class="line"><span class="attr">globalData</span>:&#123;&#125;</span><br><span class="line"></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="app-wxss"><a href="#app-wxss" class="headerlink" title="app.wxss"></a>app.wxss</h4><p>可以不写,类似于css.规定所有页面都可用的样式效果</p><h3 id="页面配置文件"><a href="#页面配置文件" class="headerlink" title="页面配置文件"></a>页面配置文件</h3><p>在根目录下的pages文件夹中保存所有页面文件</p><p>每一个独立的页面基本都由四种文件构成</p><p>wxml wxss js和json</p><p>由于页面的json只能写与window相关的配置无须像app.json那样复杂</p><h3 id="sitemap-js"><a href="#sitemap-js" class="headerlink" title="sitemap.js"></a>sitemap.js</h3><p>开发者可以通过 <code>sitemap.json</code> 配置，或者管理后台页面收录开关来配置其小程序页面是否允许微信索引。当开发者允许微信索引时，微信会通过爬虫的形式，为小程序的页面内容建立索引。当用户的搜索词条触发该索引时，小程序的页面将可能展示在搜索结果中。 爬虫访问小程序内页面时，会携带特定的 user-agent：<code>mpcrawler</code> 及<a href="https://developers.weixin.qq.com/miniprogram/dev/reference/scene-list.html">场景值</a>：<code>1129</code>。需要注意的是，若小程序爬虫发现的页面数据和真实用户的呈现不一致，那么该页面将不会进入索引中。</p><p>具体配置说明</p><ol><li>页面收录设置：可对整个小程序的索引进行关闭，小程序管理后台-功能-页面内容接入-页面收录开关；<a href="https://mp.weixin.qq.com/wxopen/readtemplate?t=config/collection_agreement_tmpl">详情</a></li><li>sitemap 配置：可对特定页面的索引进行关闭</li></ol><p>在写网站时也会有sitemap相当于微信内对你的小程序的索引,可以设置哪些能索引到哪些不能</p><p>感觉不用改</p><h3 id="其他文件"><a href="#其他文件" class="headerlink" title="其他文件"></a>其他文件</h3><p><img data-src="http://cdn.sekyoro.top/imgs/094154.png" alt="image-20210831193616831"></p><p>utils文件夹用于存放公共js文件可以被其他文件引用</p><p>还可以自定义资源文件夹存放其他文件,如图片等</p><h2 id="IDE使用"><a href="#IDE使用" class="headerlink" title="IDE使用"></a>IDE使用</h2><p>感觉跟vscode类似,功能还是挺多的</p><p>我就不多介绍了</p><p><img data-src="http://cdn.sekyoro.top/imgs/094155.png" alt="图片"></p><h2 id="小程序框架"><a href="#小程序框架" class="headerlink" title="小程序框架"></a>小程序框架</h2><h3 id="逻辑层"><a href="#逻辑层" class="headerlink" title="逻辑层"></a>逻辑层</h3><p>App Services</p><p>逻辑层主要作用是处理数据后发送给视图层渲染以及接受视图层的反馈.（一般解释）</p><p>个人认为就是后台的处理.MVVM结构</p><p>在 <code>JavaScript</code> 的基础上，增加了一些功能，以方便小程序的开发：</p><ul><li>增加 <code>App</code> 和 <code>Page</code> 方法，进行<a href="https://developers.weixin.qq.com/miniprogram/dev/framework/app-service/app.html">程序注册</a>和<a href="https://developers.weixin.qq.com/miniprogram/dev/framework/app-service/page.html">页面注册</a>。</li><li>增加 <code>getApp</code> 和 <code>getCurrentPages</code> 方法，分别用来获取 <code>App</code> 实例和当前页面栈。</li><li>提供丰富的 <a href="https://developers.weixin.qq.com/miniprogram/dev/framework/app-service/api.html">API</a>，如微信用户数据，扫一扫，支付等微信特有能力。</li><li>提供<a href="https://developers.weixin.qq.com/miniprogram/dev/framework/app-service/module.html#模块化">模块化</a>能力，每个页面有独立的<a href="https://developers.weixin.qq.com/miniprogram/dev/framework/app-service/module.html#文件作用域">作用域</a>。</li></ul><p><strong>注意：小程序框架的逻辑层并非运行在浏览器中，因此 <code>JavaScript</code> 在 web 中一些能力都无法使用，如 <code>window</code>，<code>document</code> 等。</strong></p><h3 id="注册程序"><a href="#注册程序" class="headerlink" title="注册程序"></a>注册程序</h3><h4 id="App"><a href="#App" class="headerlink" title="App()"></a>App()</h4><p>只能写在app.js内且只能注册一个</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">App(&#123;</span><br><span class="line">  onLaunch (options) &#123;</span><br><span class="line">    <span class="comment">// Do something initial when launch.</span></span><br><span class="line">  &#125;,</span><br><span class="line">  onShow (options) &#123;</span><br><span class="line">    <span class="comment">// Do something when show.</span></span><br><span class="line">  &#125;,</span><br><span class="line">  onHide () &#123;</span><br><span class="line">    <span class="comment">// Do something when hide.</span></span><br><span class="line">  &#125;,</span><br><span class="line">  onError (msg) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(msg)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">globalData</span>: <span class="string">&#x27;I am global data&#x27;</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">App(&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 当小程序初始化完成时，会触发 onLaunch（全局只触发一次）</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="attr">onLaunch</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    </span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 当小程序启动，或从后台进入前台显示，会触发 onShow</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="attr">onShow</span>: <span class="function"><span class="keyword">function</span> (<span class="params">options</span>) </span>&#123;</span><br><span class="line">    </span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 当小程序从前台进入后台，会触发 onHide</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="attr">onHide</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    </span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 当小程序发生脚本错误，或者 api 调用失败时，会触发 onError 并带上错误信息</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="attr">onError</span>: <span class="function"><span class="keyword">function</span> (<span class="params">msg</span>) </span>&#123;</span><br><span class="line">    </span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>小程序后台就是按Home键或某些按钮将小程序退到后台</p><p>onLaunch()和onShow()方法在触发时会返回参数</p><p>globalData可以自由定义</p><h4 id="onpageNotFound"><a href="#onpageNotFound" class="headerlink" title="onpageNotFound()"></a>onpageNotFound()</h4><p>当需要打开的页面不催在时,微信客户端会有一个原生模板页面提示.如果想更改可以用这个方法</p><h4 id="getApp"><a href="#getApp" class="headerlink" title="getApp()"></a>getApp()</h4><p>获取小程序实例</p><p>整个小程序只有一个 App 实例，是全部页面共享的。开发者可以通过 <code>getApp</code> 方法获取到全局唯一的 App 实例，获取App上的数据或调用开发者注册在 <code>App</code> 上的函数。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// xxx.js</span></span><br><span class="line"><span class="keyword">const</span> appInstance = getApp()</span><br><span class="line"><span class="built_in">console</span>.log(appInstance.globalData) <span class="comment">// I am global data</span></span><br></pre></td></tr></table></figure><h3 id="注册页面"><a href="#注册页面" class="headerlink" title="注册页面"></a>注册页面</h3><p>对于小程序中的每个页面，都需要在页面对应的 <code>js</code> 文件中进行注册，指定页面的初始数据、生命周期回调、事件处理函数等。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//index.js</span></span><br><span class="line">Page(&#123;</span><br><span class="line">  <span class="attr">data</span>: &#123;</span><br><span class="line">    <span class="attr">text</span>: <span class="string">&quot;This is page data.&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">onLoad</span>: <span class="function"><span class="keyword">function</span>(<span class="params">options</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 页面创建时执行</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">onShow</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 页面出现在前台时执行</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">onReady</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 页面首次渲染完毕时执行</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">onHide</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 页面从前台变为后台时执行</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">onUnload</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 页面销毁时执行</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">onPullDownRefresh</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 触发下拉刷新时执行</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">onReachBottom</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 页面触底时执行</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">onShareAppMessage</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 页面被用户分享时执行</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">onPageScroll</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 页面滚动时执行</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">onResize</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 页面尺寸变化时执行</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="title">onTabItemTap</span>(<span class="params">item</span>)</span> &#123;</span><br><span class="line">    <span class="comment">// tab 点击时执行</span></span><br><span class="line">    <span class="built_in">console</span>.log(item.index)</span><br><span class="line">    <span class="built_in">console</span>.log(item.pagePath)</span><br><span class="line">    <span class="built_in">console</span>.log(item.text)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 事件响应函数</span></span><br><span class="line">  <span class="attr">viewTap</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">      <span class="attr">text</span>: <span class="string">&#x27;Set some data for updating view.&#x27;</span></span><br><span class="line">    &#125;, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="comment">// this is setData callback</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 自由数据</span></span><br><span class="line">  <span class="attr">customData</span>: &#123;</span><br><span class="line">    <span class="attr">hi</span>: <span class="string">&#x27;MINA&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="初始数据"><a href="#初始数据" class="headerlink" title="初始数据"></a>初始数据</h4><p>data属性  当页面加载时由逻辑层到渲染层因此data数据必须是可以转化成json的类型  </p><p>wxml可以进行数据绑定</p><p>WXML 通过 { {变量名}} 来绑定 WXML 文件和对应的 JavaScript 文件中的 data 对象属性。</p><h4 id="生命周期回调函数"><a href="#生命周期回调函数" class="headerlink" title="生命周期回调函数"></a><a id="test">生命周期回调函数</a></h4><p>Page()函数中会生成onLoad(),onShow()等</p><p><img data-src="http://cdn.sekyoro.top/imgs/094157.png" alt="image-20210831204052874"></p><p><img data-src="http://cdn.sekyoro.top/imgs/094158.png" alt="image-20210831204116813"></p><ul><li><code>navigateTo</code>, <code>redirectTo</code> 只能打开非 tabBar 页面。</li><li><code>switchTab</code> 只能打开 tabBar 页面。</li><li><code>reLaunch</code> 可以打开任意页面。</li><li>页面底部的 tabBar 由页面决定，即只要是定义为 tabBar 的页面，底部都有 tabBar。</li><li>调用页面路由带的参数可以在目标页面的<code>onLoad</code>中获取。</li></ul><h4 id="页面事件处理函数"><a href="#页面事件处理函数" class="headerlink" title="页面事件处理函数"></a>页面事件处理函数</h4><p>Pages中的 onPullDownRefresh(),onReachBottom()等</p><h4 id="组件事件处理函数"><a href="#组件事件处理函数" class="headerlink" title="组件事件处理函数"></a>组件事件处理函数</h4><p>在wxml上定义事件绑定,事件触发时调用Page()中对应的事件处理函数</p><h4 id="rout"><a href="#rout" class="headerlink" title="rout"></a>rout</h4><p>利用this.route查看当前页面路径地址</p><h4 id="setData"><a href="#setData" class="headerlink" title="setData()"></a>setData()</h4><p>在Pages()中同步更新data属性中的数据值也异步更新相关数据到wxml页面。</p><p>也可以在pages中利用this.data调用数据</p><h3 id="生命周期"><a href="#生命周期" class="headerlink" title="生命周期"></a>生命周期</h3><p><a href="https://res.wx.qq.com/wxdoc/dist/assets/img/page-lifecycle.2e646c86.png">https://res.wx.qq.com/wxdoc/dist/assets/img/page-lifecycle.2e646c86.png</a></p><p>页面路由见<a href="#test">路由</a></p><p>小程序应用打开时首先onLaunch()</p><p>页面打开时首先onLoad(),初次渲染onReady()</p><h2 id="模块化"><a href="#模块化" class="headerlink" title="模块化"></a>模块化</h2><p>可以将一些公共的代码抽离成为一个单独的 js 文件，作为一个模块。模块只有通过 <a href="https://developers.weixin.qq.com/miniprogram/dev/reference/api/module.html"><code>module.exports</code></a> 或者 <code>exports</code> 才能对外暴露接口。</p><p>注意：</p><ul><li><code>exports</code> 是 <a href="https://developers.weixin.qq.com/miniprogram/dev/reference/api/module.html"><code>module.exports</code></a> 的一个引用，因此在模块里边随意更改 <code>exports</code> 的指向会造成未知的错误。所以更推荐开发者采用 <code>module.exports</code> 来暴露模块接口，除非你已经清晰知道这两者的关系。</li><li>小程序目前不支持直接引入 <code>node_modules</code> , 开发者需要使用到 <code>node_modules</code> 时候建议拷贝出相关的代码到小程序的目录中，或者使用小程序支持的 <a href="https://developers.weixin.qq.com/miniprogram/dev/devtools/npm.html">npm</a> 功能。</li></ul><h3 id="文件作用域"><a href="#文件作用域" class="headerlink" title="文件作用域"></a>文件作用域</h3><p>在小程序的任意js文件声明的变量和函数只在该文件有效</p><p>不同js文件声明相同名字的变量和函数不会相互影响</p><p>通过全局函数 <code>getApp</code> 可以获取全局的应用实例，如果需要全局的数据可以在 <code>App()</code> 中设置</p><h3 id="模块调用"><a href="#模块调用" class="headerlink" title="模块调用"></a>模块调用</h3><p>可以将公共的js放在一个文件中</p><p>只能通过module.exports或exports对外提供接口</p><h2 id="API"><a href="#API" class="headerlink" title="API"></a>API</h2><p>为了让开发者可以很方便的调起微信提供的能力，例如获取用户信息、微信支付等等，小程序提供了很多 API 给开发者去使用。</p><p>需要注意的是：多数 API 的回调都是异步，你需要处理好代码逻辑的异步问题。</p><ul><li>网络</li><li>媒体</li><li>文件</li><li>数据</li><li>位置</li><li>设备</li><li>界面</li></ul><h2 id="视图层"><a href="#视图层" class="headerlink" title="视图层"></a>视图层</h2><h3 id="WXML"><a href="#WXML" class="headerlink" title="WXML"></a>WXML</h3><p>类似HTML</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 在此处写注释 --&gt;</span></span><br><span class="line"></span><br><span class="line">&lt;标签名 属性名1=&quot;属性值1&quot; 属性名2=&quot;属性值2&quot; ...&gt; ...&lt;/标签名&gt;</span><br></pre></td></tr></table></figure><h3 id="1-数据绑定"><a href="#1-数据绑定" class="headerlink" title="1.数据绑定"></a>1.数据绑定</h3><p>1.简单绑定</p><p>利用{ {}}形式表示动态数据,这个数据在js文件data中定义</p><p>如果需要在用户输入的同时改变 <code>this.data.value</code> ，需要借助简易双向绑定机制。此时，可以在对应项目之前加入 <code>model:</code> 前缀：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">model:value</span>=<span class="string">&quot;&#123; &#123;value&#125;&#125;&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure><p>这样，如果输入框的值被改变了， <code>this.data.value</code> 也会同时改变。同时， WXML 中所有绑定了 <code>value</code> 的位置也会被一同更新， <a href="https://developers.weixin.qq.com/miniprogram/dev/framework/custom-component/observer.html">数据监听器</a> 也会被正常触发。</p><p>注意:只能单一字段绑定且不能data路径</p><p>2.组件属性</p><p>绑定属性值也可以动态的去改变，有所不同的是，属性值必须被包裹在双引号中</p><p>‘{ {}}’  加个引号</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">text</span> <span class="attr">data-test</span>=<span class="string">&quot;&#123; &#123;test&#125;&#125;&quot;</span>&gt;</span> hello world<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br></pre></td></tr></table></figure><p>3.控制属性绑定</p><p>控制属性也可以使用动态数据</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">wx:if</span>=<span class="string">&#x27;&#123; &#123;condition&#125;&#125;&#x27;</span>&gt;</span>测试<span class="tag">&lt;/<span class="name">view</span>&gt;</span>&lt;------------&gt;Page(    &#123;    data:    &#123;    condition:false;    &#125;    &#125;)</span><br></pre></td></tr></table></figure><p>4.关键字绑定</p><p>直接在引号内写布尔值也必须用双括号括起来</p><p>5.运算绑定</p><p>6.组合绑定</p><p>上面这几个挺好理解的</p><p>注意组合绑定不仅可以绑定数组也可以绑定其他对象</p><h3 id="2-逻辑语法"><a href="#2-逻辑语法" class="headerlink" title="2.逻辑语法"></a>2.逻辑语法</h3><p>可以在{ {}}中进行简单逻辑计算</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">text</span>&gt;</span>&#123; &#123; a === 10? &quot;变量 a 等于10&quot;: &quot;变量 a 不等于10&quot;&#125;&#125;<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br></pre></td></tr></table></figure><p>{ { }}中还可以直接放置数字、字符串或者是数组</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">text</span>&gt;</span>&#123; &#123;[1,2,3]&#125;&#125;<span class="tag">&lt;/<span class="name">text</span>&gt;</span><span class="comment">&lt;!-- 输出 1,2,3 --&gt;</span><span class="tag">&lt;<span class="name">text</span>&gt;</span>&#123; &#123;&quot;hello world&quot;&#125;&#125;<span class="tag">&lt;/<span class="name">text</span>&gt;</span><span class="comment">&lt;!-- 输出 hello world --&gt;</span></span><br></pre></td></tr></table></figure><h4 id="条件逻辑"><a href="#条件逻辑" class="headerlink" title="条件逻辑"></a>条件逻辑</h4><p>WXML 中，使用 wx:if=”{ {condition}}” 来判断是否需要渲染该代码块：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">wx:if</span>=<span class="string">&quot;&#123; &#123;condition&#125;&#125;&quot;</span>&gt;</span> True <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure><p>使用 wx:elif 和 wx:else 来添加一个 else 块：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">wx:if</span>=<span class="string">&quot;&#123; &#123;length &gt; 5&#125;&#125;&quot;</span>&gt;</span> 1 <span class="tag">&lt;/<span class="name">view</span>&gt;</span><span class="tag">&lt;<span class="name">view</span> <span class="attr">wx:elif</span>=<span class="string">&quot;&#123; &#123;length &gt; 2&#125;&#125;&quot;</span>&gt;</span> 2 <span class="tag">&lt;/<span class="name">view</span>&gt;</span><span class="tag">&lt;<span class="name">view</span> <span class="attr">wx:else</span>&gt;</span> 3 <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure><p>因为 wx:if 是一个控制属性，需要将它添加到一个标签上。如果要一次性判断多个组件标签，可以使用一个 <code>&lt;block/&gt;</code> 标签将多个组件包装起来，并在上边使用 wx:if 控制属性。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">block</span> <span class="attr">wx:if</span>=<span class="string">&quot;&#123; &#123;true&#125;&#125;&quot;</span>&gt;</span>  <span class="tag">&lt;<span class="name">view</span>&gt;</span> view1 <span class="tag">&lt;/<span class="name">view</span>&gt;</span>  <span class="tag">&lt;<span class="name">view</span>&gt;</span> view2 <span class="tag">&lt;/<span class="name">view</span>&gt;</span><span class="tag">&lt;/<span class="name">block</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="模板"><a href="#模板" class="headerlink" title="模板"></a>模板</h3><p>WXML提供模板（template），可以在模板中定义代码片段，然后在不同的地方调用。使用 name 属性，作为模板的名字。然后在 <code>&lt;template/&gt;</code> 内定义代码片段</p><p>定义模板</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span> <span class="attr">name</span>=<span class="string">&quot;msgItem&quot;</span>&gt;</span>  <span class="tag">&lt;<span class="name">view</span>&gt;</span>    <span class="tag">&lt;<span class="name">text</span>&gt;</span> &#123; &#123;index&#125;&#125;: &#123; &#123;msg&#125;&#125; <span class="tag">&lt;/<span class="name">text</span>&gt;</span>    <span class="tag">&lt;<span class="name">text</span>&gt;</span> Time: &#123; &#123;time&#125;&#125; <span class="tag">&lt;/<span class="name">text</span>&gt;</span>  <span class="tag">&lt;/<span class="name">view</span>&gt;</span><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>使用 is 属性，声明需要的使用的模板，然后将模板所需要的 data 传入</strong></p><p>模板使用示例</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--item: &#123;  index: 0,  msg: &#x27;this is a template&#x27;,  time: &#x27;2016-06-18&#x27;&#125;--&gt;</span><span class="tag">&lt;<span class="name">template</span> <span class="attr">name</span>=<span class="string">&quot;msgItem&quot;</span>&gt;</span>  <span class="tag">&lt;<span class="name">view</span>&gt;</span>    <span class="tag">&lt;<span class="name">text</span>&gt;</span> &#123; &#123;index&#125;&#125;: &#123; &#123;msg&#125;&#125; <span class="tag">&lt;/<span class="name">text</span>&gt;</span>    <span class="tag">&lt;<span class="name">text</span>&gt;</span> Time: &#123; &#123;time&#125;&#125; <span class="tag">&lt;/<span class="name">text</span>&gt;</span>  <span class="tag">&lt;/<span class="name">view</span>&gt;</span><span class="tag">&lt;/<span class="name">template</span>&gt;</span><span class="tag">&lt;<span class="name">template</span> <span class="attr">is</span>=<span class="string">&quot;msgItem&quot;</span> <span class="attr">data</span>=<span class="string">&quot;&#123; &#123;...item&#125;&#125;&quot;</span>/&gt;</span><span class="comment">&lt;!-- 输出0: this is a template Time: 2016-06-18--&gt;</span></span><br></pre></td></tr></table></figure><p>可以使用…符号将对象内容展开显示</p><p>如果对象中元素key和value相同可以省略表达</p><p>如果有相同的key则后者覆盖前者</p><h3 id="列表渲染"><a href="#列表渲染" class="headerlink" title="列表渲染"></a>列表渲染</h3><h4 id="1-简单渲染"><a href="#1-简单渲染" class="headerlink" title="1.简单渲染"></a>1.简单渲染</h4><p>在组件上使用 wx:for 控制属性绑定一个数组，即可使用数组中各项的数据重复渲染该组件。默认数组的当前项的下标变量名默认为 index，数组当前项的变量名默认为 item</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">wx:for</span>=<span class="string">&#x27;&#123; &#123;array&#125; &#125;&#x27;</span>&gt;</span>&#123; &#123;index&#125; &#125;:&#123; &#123;item&#125; &#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Page(    data:&#123;    <span class="attr">array</span>:[<span class="string">&#x27;张三&#x27;</span>,<span class="string">&#x27;李四&#x27;</span>]    &#125;)</span><br></pre></td></tr></table></figure><p>使用 wx:for-item 指定数组当前元素的变量名，使用 wx:for-index 指定数组当前下标的变量名,即自定义当前元素和下表的变量名</p><p>注意,如果没有双括号,会直接将字符串当作数组拆开</p><h4 id="2-嵌套列表"><a href="#2-嵌套列表" class="headerlink" title="2.嵌套列表"></a>2.嵌套列表</h4><p>即使用</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">wx:for</span>=<span class="string">&quot;&#123; &#123;array&#125;&#125;&quot;</span> <span class="attr">wx:for-item</span>=<span class="string">&#x27;i&#x27;</span>&gt;</span>    <span class="tag">&lt;<span class="name">view</span> <span class="attr">wx:for</span>=<span class="string">&#x27;&#123; &#123;arrray&#125;&#125;&#x27;</span> <span class="attr">wx:for-item</span>=<span class="string">&#x27;j&#x27;</span>&gt;</span>        <span class="tag">&lt;<span class="name">view</span> <span class="attr">wx:if</span>=<span class="string">&#x27;&#123; &#123;&#125;&#125;&#x27;</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="3-多节点列表"><a href="#3-多节点列表" class="headerlink" title="3.多节点列表"></a>3.多节点列表</h4><p>类似 <code>block wx:if</code> ，也可以将 <code>wx:for</code> 用在 <code>&lt;block/&gt;</code> 标签上，以渲染一个包含多节点的结构块。例如：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">block</span> <span class="attr">wx:for</span>=<span class="string">&quot;&#123; &#123;[1, 2, 3]&#125;&#125;&quot;</span>&gt;</span>  <span class="tag">&lt;<span class="name">view</span>&gt;</span> &#123; &#123;index&#125;&#125;: <span class="tag">&lt;/<span class="name">view</span>&gt;</span>  <span class="tag">&lt;<span class="name">view</span>&gt;</span> &#123; &#123;item&#125;&#125; <span class="tag">&lt;/<span class="name">view</span>&gt;</span><span class="tag">&lt;/<span class="name">block</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="4-wx-key属性"><a href="#4-wx-key属性" class="headerlink" title="4.wx:key属性"></a>4.wx:key属性</h4><p>如果列表中项目的位置会动态改变或者有新的项目添加到列表中，并且希望列表中的项目保持自己的特征和状态（如 <code>&lt;input/&gt;</code> 中的输入内容， <code>&lt;switch/&gt;</code> 的选中状态），需要使用 <code>wx:key</code> 来指定列表中项目的唯一的标识符。</p><p><code>wx:key</code> 的值以两种形式提供：</p><ol><li>字符串，代表在 for 循环的 array 中 item 的某个 property，该 property 的值需要是列表中唯一的字符串或数字，且不能动态改变。</li><li>保留关键字 this 代表在 for 循环中的 item 本身，这种表示需要 item 本身是一个唯一的字符串或者数字，如：</li></ol><p>当数据改变触发渲染层重新渲染的时候，会校正带有 key 的组件，框架会确保他们被重新排序，而不是重新创建，以确保使组件保持自身的状态，并且提高列表渲染时的效率。</p><h3 id="条件渲染"><a href="#条件渲染" class="headerlink" title="条件渲染"></a>条件渲染</h3><p>1.简单条件</p><p>使用wx:if=”{ {condition}}”判断是否需要渲染</p><p>2.多节点条件</p><p>同理</p><p>在\<block\>中嵌入组件</p><p>3.wx:if hidden</p><p>如果是wx:if只有当真时才会开始渲染</p><p>hidden初始就会渲染,只是简单地控制显示和隐藏</p><h3 id="事件"><a href="#事件" class="headerlink" title="事件"></a>事件</h3><p>UI界面的程序需要和用户互动，例如用户可能会点击你界面上某个按钮，又或者长按某个区域，这类反馈应该通知给开发者的逻辑层，需要将对应的处理状态呈现给用户。<br>有些时候程序上的“行为反馈”不一定是用户主动触发的，例如我们在视频video播放的过程中，播放进度是会一直变化的，这种反馈也应该通知给开发者做相应的逻辑处理。</p><p>视图层到逻辑层的通信方式</p><ol><li>将用户行为反馈到逻辑层进行处理</li><li>可以绑定在组件中,当触发事件时就会执行逻辑层中对应的事件处理函数</li><li>对象可以携带额外的信息</li></ol><h4 id="1-事件的使用"><a href="#1-事件的使用" class="headerlink" title="1.事件的使用"></a>1.事件的使用</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;mybtn&quot;</span> <span class="attr">bindtap</span>=<span class="string">&quot;myTap&quot;</span> <span class="attr">data-my</span>=<span class="string">&quot;hello&quot;</span> <span class="attr">data-i</span>=<span class="string">&quot;fuck&quot;</span>&gt;</span>按钮<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure><p>bind与catch</p><h4 id="2-事件的分类"><a href="#2-事件的分类" class="headerlink" title="2.事件的分类"></a>2.事件的分类</h4><p>冒泡事件与非冒泡事件</p><p>冒泡事件被触发后会向父节点传递</p><h4 id="3-事件绑定和冒泡"><a href="#3-事件绑定和冒泡" class="headerlink" title="3.事件绑定和冒泡"></a>3.事件绑定和冒泡</h4><p>key=value</p><p>事件绑定的写法类似于组件的属性，如：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">bindtap</span>=<span class="string">&quot;handleTap&quot;</span>&gt;</span>    Click here!<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure><p>如果用户点击这个 view ，则页面的 <code>handleTap</code> 会被调用。</p><p>事件绑定函数可以是一个数据绑定，如：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">bindtap</span>=<span class="string">&quot;&#123; &#123; handlerName &#125;&#125;&quot;</span>&gt;</span>    Click here!<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure><p>catch事件可以阻止冒泡事件向上冒泡</p><h4 id="4-事件的捕获阶段"><a href="#4-事件的捕获阶段" class="headerlink" title="4.事件的捕获阶段"></a>4.事件的捕获阶段</h4><p>自基础库版本 <a href="https://developers.weixin.qq.com/miniprogram/dev/framework/compatibility.html">1.5.0</a> 起，触摸类事件支持捕获阶段。捕获阶段位于冒泡阶段之前，且在捕获阶段中，事件到达节点的顺序与冒泡阶段恰好相反。需要在捕获阶段监听事件时，可以采用<code>capture-bind</code>、<code>capture-catch</code>关键字，后者将中断捕获阶段和取消冒泡阶段</p><h4 id="5-事件对象"><a href="#5-事件对象" class="headerlink" title="5.事件对象"></a>5.事件对象</h4><p><img data-src="http://cdn.sekyoro.top/imgs/094200.png" alt="image-20210901105757525"></p><p><img data-src="http://cdn.sekyoro.top/imgs/094200-1.png" alt="image-20210901105827504"></p><h3 id="type"><a href="#type" class="headerlink" title="type"></a>type</h3><p>代表事件的类型。</p><h3 id="timeStamp"><a href="#timeStamp" class="headerlink" title="timeStamp"></a>timeStamp</h3><p>页面打开到触发事件所经过的毫秒数。</p><h3 id="target"><a href="#target" class="headerlink" title="target"></a>target</h3><p>触发事件的源组件。</p><div class="table-container"><table><thead><tr><th style="text-align:left">属性</th><th style="text-align:left">类型</th><th style="text-align:left">说明</th></tr></thead><tbody><tr><td style="text-align:left">id</td><td style="text-align:left">String</td><td style="text-align:left">事件源组件的id</td></tr><tr><td style="text-align:left"><a href="https://developers.weixin.qq.com/miniprogram/dev/framework/view/wxml/event.html#dataset">dataset</a></td><td style="text-align:left">Object</td><td style="text-align:left">事件源组件上由<code>data-</code>开头的自定义属性组成的集合</td></tr></tbody></table></div><h3 id="currentTarget"><a href="#currentTarget" class="headerlink" title="currentTarget"></a>currentTarget</h3><p>事件绑定的当前组件。</p><div class="table-container"><table><thead><tr><th style="text-align:left">属性</th><th style="text-align:left">类型</th><th style="text-align:left">说明</th></tr></thead><tbody><tr><td style="text-align:left">id</td><td style="text-align:left">String</td><td style="text-align:left">当前组件的id</td></tr><tr><td style="text-align:left"><a href="https://developers.weixin.qq.com/miniprogram/dev/framework/view/wxml/event.html#dataset">dataset</a></td><td style="text-align:left">Object</td><td style="text-align:left">当前组件上由<code>data-</code>开头的自定义属性组成的集合</td></tr></tbody></table></div><h5 id="dataset"><a href="#dataset" class="headerlink" title="dataset"></a>dataset</h5><p>在组件节点中可以附加一些自定义数据。这样，在事件中可以获取这些自定义的节点数据，用于事件的逻辑处理。</p><p>在 WXML 中，这些自定义数据以 <code>data-</code> 开头，多个单词由连字符 <code>-</code> 连接。这种写法中，连字符写法会转换成驼峰写法，而大写字符会自动转成小写字符。如：</p><ul><li><code>data-element-type</code> ，最终会呈现为 <code>event.currentTarget.dataset.elementType</code> ；</li><li><code>data-elementType</code> ，最终会呈现为 <code>event.currentTarget.dataset.elementtype</code> 。</li></ul><h4 id="6-引用"><a href="#6-引用" class="headerlink" title="6.引用"></a>6.引用</h4><h5 id="1-import"><a href="#1-import" class="headerlink" title="1.import"></a>1.import</h5><p>在 index.wxml 中引用了 item.wxml，就可以使用 item模板：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">import</span> <span class="attr">src</span>=<span class="string">&quot;item.wxml&quot;</span>/&gt;</span><span class="tag">&lt;<span class="name">template</span> <span class="attr">is</span>=<span class="string">&quot;item&quot;</span> <span class="attr">data</span>=<span class="string">&quot;&#123; &#123;text: &#x27;forbar&#x27;&#125;&#125;&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><p>需要注意的是 import 有作用域的概念，即只会 import 目标文件中定义的 template，而不会 import 目标文件中 import 的 template，简言之就是 import 不具有递归的特性。</p><h5 id="2-include"><a href="#2-include" class="headerlink" title="2.include"></a>2.include</h5><p>include 可以将目标文件中除了 <code>&lt;template/&gt; &lt;wxs/&gt;</code> 外的整个代码引入，相当于是拷贝到 include 位置</p><h3 id="WXSS"><a href="#WXSS" class="headerlink" title="WXSS"></a>WXSS</h3><h4 id="1-尺寸单位"><a href="#1-尺寸单位" class="headerlink" title="1.尺寸单位"></a>1.尺寸单位</h4><p>rpx  规定屏幕为750rpx</p><h4 id="2-样式导入"><a href="#2-样式导入" class="headerlink" title="2.样式导入"></a>2.样式导入</h4><p>使用<code>@import</code>语句可以导入外联样式表，<code>@import</code>后跟需要导入的外联样式表的相对路径，用<code>;</code>表示语句结束。</p><h4 id="3-内联样式"><a href="#3-内联样式" class="headerlink" title="3.内联样式"></a>3.内联样式</h4><p>框架组件上支持使用 style、class 属性来控制组件的样式。</p><ul><li>style：静态的样式统一写到 class 中。style 接收动态的样式，在运行时会进行解析，请尽量避免将静态的样式写进 style 中，以免影响渲染速度。</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">style</span>=<span class="string">&quot;color:&#123; &#123;color&#125;&#125;;&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure><ul><li>class：用于指定样式规则，其属性值是样式规则中类选择器名(样式类名)的集合，样式类名不需要带上<code>.</code>，样式类名之间用空格分隔。</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;normal_view&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure><h2 id="4-选择器"><a href="#4-选择器" class="headerlink" title="4.选择器"></a>4.选择器</h2><div class="table-container"><table><thead><tr><th style="text-align:left">选择器</th><th style="text-align:left">样例</th><th style="text-align:left">样例描述</th></tr></thead><tbody><tr><td style="text-align:left">.class</td><td style="text-align:left"><code>.intro</code></td><td style="text-align:left">选择所有拥有 class=”intro” 的组件</td></tr><tr><td style="text-align:left">#id</td><td style="text-align:left"><code>#firstname</code></td><td style="text-align:left">选择拥有 id=”firstname” 的组件</td></tr><tr><td style="text-align:left">element</td><td style="text-align:left"><code>view</code></td><td style="text-align:left">选择所有 view 组件</td></tr><tr><td style="text-align:left">element, element</td><td style="text-align:left"><code>view, checkbox</code></td><td style="text-align:left">选择所有文档的 view 组件和所有的 checkbox 组件</td></tr><tr><td style="text-align:left">::after</td><td style="text-align:left"><code>view::after</code></td><td style="text-align:left">在 view 组件后边插入内容</td></tr><tr><td style="text-align:left">::before</td><td style="text-align:left"><code>view::before</code></td><td style="text-align:left">在 view 组件前边插入内容</td></tr></tbody></table></div><h4 id="5-全局样式与局部样式"><a href="#5-全局样式与局部样式" class="headerlink" title="5.全局样式与局部样式"></a>5.全局样式与局部样式</h4><p>定义在 app.wxss 中的样式为全局样式，作用于每一个页面。在 page 的 wxss 文件中定义的样式为局部样式，只作用在对应的页面，并会覆盖 app.wxss 中相同的选择器。</p><h2 id="Flex布局"><a href="#Flex布局" class="headerlink" title="Flex布局"></a>Flex布局</h2><p>包含内容的组件称为容器,容器内部的组件成为项目</p><p>我们只需要在容器中设置以下两个属性即可实现内容不确定下的垂直居中。</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.container</span>&#123;  <span class="attribute">display</span>: flex;  <span class="attribute">flex-direction</span>: column;  <span class="attribute">justify-content</span>: center;&#125;</span><br></pre></td></tr></table></figure><p>flex不单是一个属性，它包含了一套新的属性集。属性集包括用于设置容器，和用于设置项目两部分。</p><p>设置容器的属性有：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">display</span>:flex;<span class="attribute">flex-direction</span>:row（默认值） | row-reverse | column |column-reverseflex-wrap:nowrap（默认值） | wrap | wrap-reversejustify-content:flex-start（默认值） | flex-end | center |space-between | space-around | space-evenlyalign-items:stretch（默认值） | center  | flex-end | baseline | flex-startalign-content:stretch（默认值） | flex-start | center |flex-end | space-between | space-around | space-evenly</span><br></pre></td></tr></table></figure><p>项目是在主轴上排列，排满后在交叉轴方向换行。需要注意的是，交叉轴垂直于主轴，它的方向取决于主轴方向。</p><p><strong>flex-direction 属性</strong></p><p>通过设置坐标轴，来设置项目排列方向。</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.container</span>&#123;  <span class="attribute">flex-direction</span>: row（默认值） | row-reverse | column | column-reverse&#125;</span><br></pre></td></tr></table></figure><p>row（默认值）：主轴横向，方向为从左指向右。项目沿主轴排列，从左到右排列。</p><p>row-reverse：row的反方向。主轴横向，方向为从右指向左。项目沿主轴排列，从右到左排列。</p><p>column：主轴纵向，方向从上指向下。项目沿主轴排列，从上到下排列。</p><p>column-reverse：column的反方向。主轴纵向，方向从下指向上。项目沿主轴排列，从下到上排列。</p><h4 id="flex-wrap-属性"><a href="#flex-wrap-属性" class="headerlink" title="flex-wrap 属性"></a>flex-wrap 属性</h4><p>设置是否允许项目多行排列，以及多行排列时换行的方向。</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.container</span>&#123;  <span class="attribute">flex-wrap</span>: nowrap（默认值） | wrap | wrap-reverse&#125;</span><br></pre></td></tr></table></figure><p>nowrap（默认值）：不换行。如果单行内容过多，则溢出容器。<br>wrap：容器单行容不下所有项目时，换行排列。<br>wrap-reverse：容器单行容不下所有项目时，换行排列。换行方向为wrap时的反方向。</p><p><strong>justify-content 属性</strong></p><p>设置项目在主轴方向上对齐方式，以及分配项目之间及其周围多余的空间。</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.container</span>&#123;  <span class="attribute">justify-content</span>: flex-start（默认值） | flex-end | center | space-between | space-around| space-evenly&#125;</span><br></pre></td></tr></table></figure><p>flex-start（默认值）：项目对齐主轴起点，项目间不留空隙。</p><p>center：项目在主轴上居中排列，项目间不留空隙。主轴上第一个项目离主轴起点距离等于最后一个项目离主轴终点距离。</p><p>flex-end：项目对齐主轴终点，项目间不留空隙。<br>space-between：项目间间距相等，第一个项目离主轴起点和最后一个项目离主轴终点距离为0。<br>space-around：与space-between相似。不同点为，第一个项目离主轴起点和最后一个项目离主轴终点距离为中间项目间间距的一半。</p><p>space-evenly：项目间间距、第一个项目离主轴起点和最后一个项目离主轴终点距离等于项目间间距。</p><p><strong>align-items 属性</strong></p><p>设置项目在行中的对齐方式。</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.container</span>&#123;  <span class="attribute">align-items</span>:stretch（默认值） | flex-start | center | flex-end | baseline&#125;</span><br></pre></td></tr></table></figure><p>stretch（默认值）：项目拉伸至填满行高。<br>flex-start：项目顶部与行起点对齐。<br>center：项目在行中居中对齐。<br>flex-end：项目底部与行终点对齐。<br>baseline：项目的第一行文字的基线对齐。</p><p><strong>align-content 属性</strong></p><p>多行排列时，设置行在交叉轴方向上的对齐方式，以及分配行之间及其周围多余的空间。</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.container</span>&#123;  <span class="attribute">align-content</span>: stretch（默认值） | flex-start | center | flex-end | space-between |space-around | space-evenly&#125;</span><br></pre></td></tr></table></figure><p>stretch（默认值）：当未设置项目尺寸，将各行中的项目拉伸至填满交叉轴。当设置了项目尺寸，项目尺寸不变，项目行拉伸至填满交叉轴。</p><p>flex-start：首行在交叉轴起点开始排列，行间不留间距。</p><p>center：行在交叉轴中点排列，行间不留间距，首行离交叉轴起点和尾行离交叉轴终点距离相等。</p><p>flex-end：尾行在交叉轴终点开始排列，行间不留间距。<br>space-between：行与行间距相等，首行离交叉轴起点和尾行离交叉轴终点距离为0。<br>space-around：行与行间距相等，首行离交叉轴起点和尾行离交叉轴终点距离为行与行间间距的一半。</p><p>space-evenly：行间间距、以及首行离交叉轴起点和尾行离交叉轴终点距离相等。</p><h3 id="项目属性"><a href="#项目属性" class="headerlink" title="项目属性"></a>项目属性</h3><p>设置项目，用于设置项目的尺寸、位置，以及对项目的对齐方式做特殊设置。</p><p><strong>order 属性</strong></p><p>设置项目沿主轴方向上的排列顺序，数值越小，排列越靠前。属性值为整数。</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.item</span>&#123;  <span class="attribute">order</span>: <span class="number">0</span>（默认值） | &lt;integer&gt;&#125;</span><br></pre></td></tr></table></figure><p><strong>flex-shrink 属性</strong></p><p>当项目在主轴方向上溢出时，通过设置项目收缩因子来压缩项目适应容器。属性值为项目的收缩因子，属性值取非负数。</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.item</span>&#123;  <span class="attribute">flex-shrink</span>: <span class="number">1</span>（默认值） | &lt;number&gt;&#125;<span class="selector-class">.item1</span>&#123;  <span class="attribute">width</span>: <span class="number">120px</span>;  <span class="attribute">flex-shrink</span>: <span class="number">2</span>;&#125;<span class="selector-class">.item2</span>&#123;  <span class="attribute">width</span>: <span class="number">150px</span>;  <span class="attribute">flex-shrink</span>: <span class="number">3</span>;&#125;<span class="selector-class">.item3</span>&#123;// 项目<span class="number">3</span>未设置<span class="attribute">flex-shrink</span>，默认<span class="attribute">flex-shrink</span>值为<span class="number">1</span>  <span class="attribute">width</span>: <span class="number">180px</span>;&#125;</span><br></pre></td></tr></table></figure><p><strong>flex-grow 属性</strong></p><p>当项目在主轴方向上还有剩余空间时，通过设置项目扩张因子进行剩余空间的分配。属性值为项目的扩张因子，属性值取非负数。</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.item</span>&#123;  <span class="attribute">flex-grow</span>: <span class="number">0</span>（默认值） | &lt;number&gt;&#125;</span><br></pre></td></tr></table></figure><p><strong>flex-basis 属性</strong></p><p>当容器设置flex-direction为row或row-reverse时，flex-basis和width同时存在，flex-basis优先级高于width，也就是此时flex-basis代替项目的width属性。</p><p>当容器设置flex-direction为column或column-reverse时，flex-basis和height同时存在，flex-basis优先级高于height，也就是此时flex-basis代替项目的height属性。</p><p>需要注意的是，当flex-basis和width（或height），其中一个属性值为auto时，非auto的优先级更高。</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.item</span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="attribute">flex-basis</span>: auto（默认值） | &lt;number&gt;px</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>flex 属性</strong></p><p>是flex-grow，flex-shrink，flex-basis的简写方式。值设置为none，等价于00 auto。值设置为auto，等价于1 1 auto。</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.item</span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="attribute">flex</span>: none | auto | @flex-grow @flex-shrink@flex-basis</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>align-self 属性</strong></p><p>设置项目在行中交叉轴方向上的对齐方式，用于覆盖容器的align-items，这么做可以对项目的对齐方式做特殊处理。默认属性值为auto，继承容器的align-items值，当容器没有设置align-items时，属性值为stretch。</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.item</span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="attribute">align-self</span>: auto（默认值） | flex-start | center | flex-end | baseline |stretch</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      
        <tags>
            
            <tag> wechat </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>pygame实践_1</title>
      <link href="2021/08/15/pygame%E5%AE%9E%E8%B7%B5-1/"/>
      <url>2021/08/15/pygame%E5%AE%9E%E8%B7%B5-1/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="利用python做游戏——pygame-1"><a href="#利用python做游戏——pygame-1" class="headerlink" title="利用python做游戏——pygame_1"></a>利用python做游戏——pygame_1</h1><p>之前碰了Qt,winforms,wpf. 主要是想接触一下GUI</p><p>我都不知道该干啥了</p><span id="more"></span><p>这个项目是在《Python编程从入门到实践》上摘写的  个人推荐这本书还有同系列的蟒蛇书</p><p>后面想写写matplotlib和其他的python库,不过Python这个语言是真的舒服.</p><h2 id="pygame介绍"><a href="#pygame介绍" class="headerlink" title="pygame介绍"></a>pygame介绍</h2><p><img data-src="http://cdn.sekyoro.top/imgs/065639.jpg" alt="Pygame游戏结构框架"></p><h2 id="1-创建界面"><a href="#1-创建界面" class="headerlink" title="1.创建界面"></a>1.创建界面</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> pygame</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AlienInvasions</span>:</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;&#x27;管理游戏资源和行为的类&#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;初始化游戏并创建游戏资源&#x27;&#x27;&#x27;</span></span><br><span class="line">        pygame.init()</span><br><span class="line">        self.screen = pygame.display.set_mode((<span class="number">1200</span>,<span class="number">800</span>))</span><br><span class="line">        pygame.display.set_caption(<span class="string">&quot;Alien Invasion&quot;</span>)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run_game</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;开始游戏的主循环&#x27;&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="comment"># 监视键盘和鼠标事件</span></span><br><span class="line">            <span class="keyword">for</span> event <span class="keyword">in</span> pygame.event.get():</span><br><span class="line">                <span class="keyword">if</span> event.<span class="built_in">type</span> == pygame.QUIT:</span><br><span class="line">                    sys.exit()</span><br><span class="line">            <span class="comment">#让最近绘制的屏幕可见</span></span><br><span class="line">            pygame.display.flip()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment">#创建游戏实例并运行</span></span><br><span class="line">    ai = AlienInvasions()</span><br><span class="line">    ai.run_game()</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img data-src="http://cdn.sekyoro.top/imgs/093652.png" alt="image-20210815132045490"></p><p>pygame.init() 初始化背景设置 让pygame正常工作</p><p>pygame.display.set_mode() 创建一个显示窗口,游戏的所有图形元素都将在其中绘制  (1200,800)是一个元组 宽1200像素 高800像素</p><p>赋给self.screen的对象是一个Surface.是屏幕的一部分,用于显示游戏元素 </p><p>激活游戏的动画循环后,每经过一次循环都将自动重绘这个Surface 将用户输入触发的所有变化都反映出来</p><p>run_game()包含一个while循环 监视事件</p><p>pygame.event.get()返回一个列表 包含它在上一次被调用发生的所有事件</p><p>所有键盘和鼠标事件都将倒是这个for循环进行  如果检查到pygame.QUIT则退出pygame.display.flip()将不断更新屏幕,以显示元素的新位置,并且在原来的位置隐藏元素,从而营造平滑的移动效果</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#设置屏幕背景颜色</span></span><br><span class="line">self.bg_color = (<span class="number">230</span>,<span class="number">230</span>,<span class="number">230</span>)  <span class="comment">#rgb三元组</span></span><br><span class="line">self.screen.fill(self.bg_color)</span><br></pre></td></tr></table></figure><p><img data-src="http://cdn.sekyoro.top/imgs/093657.png" alt="image-20210815134354356"></p><p>fill处理Surface,填充颜色</p><h2 id="2-创建设置类"><a href="#2-创建设置类" class="headerlink" title="2.创建设置类"></a>2.创建设置类</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Settings</span>:</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;存储游戏中所设置的类&#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;初始化游戏的设置&#x27;&#x27;&#x27;</span></span><br><span class="line">        <span class="comment"># 屏幕的设置</span></span><br><span class="line">        self.screen_width = <span class="number">1200</span></span><br><span class="line">        self.screen_height = <span class="number">800</span></span><br><span class="line">        self.bg_color = (<span class="number">230</span>,<span class="number">230</span>,<span class="number">230</span>)</span><br></pre></td></tr></table></figure><p>创建setting.py文件   这些变量可用于其他文件访问</p><p>这样写从代码上便于分离</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> settings <span class="keyword">import</span> Settings</span><br><span class="line">self.settings = Settings()</span><br><span class="line">        self.screen = pygame.display.set_mode(</span><br><span class="line">            (self.settings.screen_width,self.settings.screen_height)</span><br><span class="line">        )</span><br><span class="line">self.screen.fill(self.settings.bg_color)</span><br></pre></td></tr></table></figure><h2 id="3-创建飞船类"><a href="#3-创建飞船类" class="headerlink" title="3.创建飞船类"></a>3.创建飞船类</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pygame</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Ship</span>:</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;管理飞船的类&#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,ai_game</span>):</span></span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;初始化飞船并设置其初始位置&#x27;&#x27;&#x27;</span></span><br><span class="line">        self.screen = ai_game.screen()</span><br><span class="line">        self.screen_rect = ai_game.screen.get_rect()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 加载飞船图像并获取其外接矩形</span></span><br><span class="line">        self.image = pygame.image.load(<span class="string">&#x27;images/rocket.bmp&#x27;</span>)</span><br><span class="line">        self.rect = self.image.get_rect()</span><br><span class="line">        <span class="comment">#对于每艘新飞船 初始化位置  放在屏幕底部中央</span></span><br><span class="line">        self.rect.midbottom = self.screen_rect.midbottom</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">blitme</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;在指定位置绘制飞船&#x27;&#x27;&#x27;</span></span><br><span class="line">        self.screen.blit(self.image,self.rect)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>我们将屏幕和飞船都当作矩形,因为这样处理比较简单</p><p>参数有self,ai_game  后者指向当前AlienInvasion实例引用  访问定义中的游戏资源</p><p>rect对象有属性x,y,center,centerx,centery,top,bottom等</p><p>blit方法将图像self.rect绘制到指定位置</p><h3 id="飞船的移动"><a href="#飞船的移动" class="headerlink" title="飞船的移动"></a>飞船的移动</h3><p>主要是利用self.ship.rect.x等属性</p><p>将run_game()分为两个部分</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run_game</span>(<span class="params">self</span>):</span></span><br><span class="line">       <span class="string">&#x27;&#x27;&#x27;开始游戏的主循环&#x27;&#x27;&#x27;</span></span><br><span class="line">       <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">           <span class="comment"># 监视键盘和鼠标事件</span></span><br><span class="line">           self._check_events()</span><br><span class="line">           <span class="comment"># 更新屏幕</span></span><br><span class="line">           self.ship.update()</span><br><span class="line">           self._update_screen()</span><br><span class="line"></span><br><span class="line">       <span class="string">&#x27;&#x27;&#x27;辅助方法&#x27;&#x27;&#x27;</span></span><br><span class="line">   <span class="function"><span class="keyword">def</span> <span class="title">_check_events</span>(<span class="params">self</span>):</span></span><br><span class="line">       <span class="string">&#x27;&#x27;&#x27;响应鼠标和键盘事件&#x27;&#x27;&#x27;</span></span><br><span class="line">       <span class="keyword">for</span> event <span class="keyword">in</span> pygame.event.get():</span><br><span class="line">           <span class="keyword">if</span> event.<span class="built_in">type</span> == pygame.QUIT:</span><br><span class="line">               sys.exit()</span><br><span class="line">           <span class="keyword">elif</span> event.<span class="built_in">type</span> == pygame.KEYDOWN:</span><br><span class="line">               <span class="keyword">if</span> event.key == pygame.K_RIGHT:</span><br><span class="line">                   <span class="comment"># 向右移动飞船</span></span><br><span class="line">                   <span class="comment"># self.ship.rect.x += 10</span></span><br><span class="line">                   self.ship.moving_right = <span class="literal">True</span></span><br><span class="line">               <span class="comment"># if event.type == pygame.K_LEFT:</span></span><br><span class="line">               <span class="comment">#     self.ship.rect.x -=10</span></span><br><span class="line">           <span class="keyword">elif</span> event.<span class="built_in">type</span> == pygame.KEYUP:</span><br><span class="line">               <span class="keyword">if</span> event.key == pygame.K_RIGHT:</span><br><span class="line">                   self.ship.moving_right = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">def</span> <span class="title">_update_screen</span>(<span class="params">self</span>):</span></span><br><span class="line">       self.screen.fill(self.settings.bg_color)</span><br><span class="line">       <span class="comment"># self.screen.fill(self.bg_color)</span></span><br><span class="line">       self.ship.blitme()</span><br><span class="line">       <span class="comment"># 让最近绘制的屏幕可见</span></span><br><span class="line">       pygame.display.flip()</span><br></pre></td></tr></table></figure><p><img data-src="http://cdn.sekyoro.top/imgs/093659.png" alt="image-20210815150339152"></p><p>注意event.key这个东西,用来控制飞船的移动</p><p>要实现连续移动可以给一个moving_right的flag控制</p><p>只要按下就能连续移动</p><p><img data-src="http://cdn.sekyoro.top/imgs/093704.png" alt="image-20210815150504599"></p><p>当然,要将这个东西加入while循环监视</p><p><img data-src="http://cdn.sekyoro.top/imgs/093705.png" alt="image-20210815150714799"></p><h3 id="加快飞船速度"><a href="#加快飞船速度" class="headerlink" title="加快飞船速度"></a>加快飞船速度</h3><p><img data-src="http://cdn.sekyoro.top/imgs/065641.png" alt="image-20210815152117260"></p><p><img data-src="http://cdn.sekyoro.top/imgs/093708.png" alt="image-20210815152142591"></p><p>将速度改为1.5像素  由于rect.x为int值</p><p>将改变后的值赋给self.x 再赋值给self.rect.x  只存储整数部分</p><p>但问题不大</p><h3 id="限制飞船活动范围"><a href="#限制飞船活动范围" class="headerlink" title="限制飞船活动范围"></a>限制飞船活动范围</h3><p>主要利用rect.right等限制</p><p>rect.right返回距离飞船外接矩形右边缘的x坐标</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">update</span>(<span class="params">self</span>):</span></span><br><span class="line">       <span class="string">&#x27;&#x27;&#x27;根据移动标志调整飞船位置&#x27;&#x27;&#x27;</span></span><br><span class="line">       <span class="keyword">if</span> self.moving_right <span class="keyword">and</span> self.rect.right&lt;self.screen_rect.right:</span><br><span class="line">           self.x += self.settings.ship_speed</span><br><span class="line">       <span class="keyword">if</span> self.moving_left <span class="keyword">and</span> self.rect.left&gt;<span class="number">0</span>:</span><br><span class="line">           self.x -= self.settings.ship_speed</span><br><span class="line"></span><br><span class="line">       <span class="comment"># 根据self.x更新rect对象</span></span><br><span class="line">       self.rect.x = self.x</span><br></pre></td></tr></table></figure><h3 id="重构事件"><a href="#重构事件" class="headerlink" title="重构事件"></a>重构事件</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_check_keydown_events</span>(<span class="params">self, event</span>):</span></span><br><span class="line">       <span class="string">&#x27;&#x27;&#x27;响应按键&#x27;&#x27;&#x27;</span></span><br><span class="line">       <span class="keyword">if</span> event.key == pygame.K_RIGHT:</span><br><span class="line">           self.ship.moving_right = <span class="literal">True</span></span><br><span class="line">       <span class="keyword">elif</span> event.key == pygame.K_LEFT:</span><br><span class="line">           self.ship.moving_left = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">def</span> <span class="title">_check_keyup_events</span>(<span class="params">self, event</span>):</span></span><br><span class="line">       <span class="string">&#x27;&#x27;&#x27;相应松开&#x27;&#x27;&#x27;</span></span><br><span class="line">       <span class="keyword">if</span> event.key == pygame.K_RIGHT:</span><br><span class="line">           self.ship.moving_right = <span class="literal">False</span></span><br><span class="line">       <span class="keyword">elif</span> event.key == pygame.K_LEFT:</span><br><span class="line">           self.ship.moving_left = <span class="literal">False</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> event.<span class="built_in">type</span> == pygame.QUIT:</span><br><span class="line">    sys.exit()</span><br><span class="line"><span class="keyword">elif</span> event.<span class="built_in">type</span> == pygame.KEYDOWN:</span><br><span class="line">        self._check_keydown_events(event)</span><br><span class="line"><span class="keyword">elif</span> event.<span class="built_in">type</span> == pygame.KEYUP:</span><br><span class="line">    self._check_keyup_events(event)</span><br></pre></td></tr></table></figure><h3 id="按Q键退出"><a href="#按Q键退出" class="headerlink" title="按Q键退出"></a>按Q键退出</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_check_keydown_events</span>(<span class="params">self, event</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;响应按键&#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> event.key == pygame.K_RIGHT:</span><br><span class="line">        self.ship.moving_right = <span class="literal">True</span></span><br><span class="line">    <span class="keyword">elif</span> event.key == pygame.K_LEFT:</span><br><span class="line">        self.ship.moving_left = <span class="literal">True</span></span><br><span class="line">    <span class="keyword">elif</span> event.key == pygame.K_q:</span><br><span class="line">        sys.exit()</span><br></pre></td></tr></table></figure><h3 id="全屏"><a href="#全屏" class="headerlink" title="全屏"></a>全屏</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">self.screen = pygame.display.set_mode((<span class="number">0</span>, <span class="number">0</span>), pygame.FULLSCREEN)</span><br><span class="line">        <span class="comment"># self.settings.screen_width = self.screen.get_rect().width</span></span><br><span class="line">        <span class="comment"># self.settings.screen_height = self.screen.get_rect().height</span></span><br></pre></td></tr></table></figure><h2 id="创建子弹类"><a href="#创建子弹类" class="headerlink" title="创建子弹类"></a>创建子弹类</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pygame</span><br><span class="line"><span class="keyword">from</span> pygame.sprite <span class="keyword">import</span> Sprite</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Bullet</span>(<span class="params">Sprite</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;管理飞船所发射子弹的类&#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,ai_game</span>):</span></span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;在飞船当前位置创建一个子弹对象&#x27;&#x27;&#x27;</span></span><br><span class="line">        <span class="built_in">super</span>.__init__()</span><br><span class="line">        self.screen = ai_game.screen</span><br><span class="line">        self.settings = ai_game.settings</span><br><span class="line">        self.color = self.settings.bullet_color</span><br><span class="line"></span><br><span class="line">        <span class="comment">#在(0,0)处创建一个表示子弹的矩形,再设置正确的位置</span></span><br><span class="line">        self.rect = pygame.Rect(<span class="number">0</span>,<span class="number">0</span>,self.settings.bullet_width,</span><br><span class="line">                                self.settings.bullet_height)</span><br><span class="line">        self.rect.midtop = ai_game.ship.rect.midtop</span><br><span class="line"></span><br><span class="line">        <span class="comment">#存储用小数表示的子弹位置</span></span><br><span class="line">        self.y = <span class="built_in">float</span>(self.rect.y)    <span class="function"><span class="keyword">def</span> <span class="title">update</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;向上移动子弹&#x27;&#x27;&#x27;</span></span><br><span class="line">        <span class="comment"># 更新表示子弹位置的小数值</span></span><br><span class="line">        self.y -= self.settings.bullet_speed</span><br><span class="line">        <span class="comment"># 更新表示子弹的rect位置</span></span><br><span class="line">        self.rect.y = self.y</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">draw_bullet</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;在屏幕上绘制子弹&#x27;&#x27;&#x27;</span></span><br><span class="line">        pygame.draw.rect(self.screen, self.color, self.rect)</span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">update</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;向上移动子弹&#x27;&#x27;&#x27;</span></span><br><span class="line">        <span class="comment"># 更新表示子弹位置的小数值</span></span><br><span class="line">        self.y -= self.settings.bullet_speed</span><br><span class="line">        <span class="comment"># 更新表示子弹的rect位置</span></span><br><span class="line">        self.rect.y = self.y</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">_fire_bullet</span>(<span class="params">self</span>):</span></span><br><span class="line">      <span class="string">&#x27;&#x27;&#x27;创建一颗子弹 将其加入编组中&#x27;&#x27;&#x27;</span></span><br><span class="line">      new_bullet = Bullet(self)</span><br><span class="line">      self.bullets.add(new_bullet)</span><br><span class="line">          <span class="function"><span class="keyword">def</span> <span class="title">_update_screen</span>(<span class="params">self</span>):</span></span><br><span class="line">      <span class="comment"># self.screen.fill(self.settings.bg_color)</span></span><br><span class="line">      self.screen.fill(self.settings.bg_color)</span><br><span class="line">      self.ship.blitme()</span><br><span class="line">      <span class="keyword">for</span> bullet <span class="keyword">in</span> self.bullets.sprites():</span><br><span class="line">          bullet.draw_bullet()</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_check_keydown_events</span>(<span class="params">self, event</span>):</span></span><br><span class="line">      <span class="string">&#x27;&#x27;&#x27;响应按键&#x27;&#x27;&#x27;</span></span><br><span class="line">      <span class="keyword">if</span> event.key == pygame.K_RIGHT:</span><br><span class="line">          self.ship.moving_right = <span class="literal">True</span></span><br><span class="line">      <span class="keyword">elif</span> event.key == pygame.K_LEFT:</span><br><span class="line">          self.ship.moving_left = <span class="literal">True</span></span><br><span class="line">      <span class="keyword">elif</span> event.key == pygame.K_q:</span><br><span class="line">          sys.exit()</span><br><span class="line">      <span class="keyword">elif</span> event.key == pygame.K_SPACE:</span><br><span class="line">          self._fire_bullet() <span class="comment">#发射子弹</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run_game</span>(<span class="params">self</span>):</span></span><br><span class="line">      <span class="string">&#x27;&#x27;&#x27;开始游戏的主循环&#x27;&#x27;&#x27;</span></span><br><span class="line">      <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">          <span class="comment"># 监视键盘和鼠标事件</span></span><br><span class="line">          self._check_events()</span><br><span class="line">          <span class="comment"># 更新屏幕</span></span><br><span class="line">          self.ship.update()</span><br><span class="line">          self.bullets.update()<span class="comment">#更新位置</span></span><br><span class="line">          self._update_screen()</span><br></pre></td></tr></table></figure><h3 id="删除消失的子弹"><a href="#删除消失的子弹" class="headerlink" title="删除消失的子弹"></a>删除消失的子弹</h3><p>子弹没有消除,所以会消耗内存</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> bullet <span class="keyword">in</span> self.bullets.copy():</span><br><span class="line">    <span class="keyword">if</span> bullet.rect.bottom &lt;=<span class="number">0</span>:</span><br><span class="line">        self.bullets.remove(bullet)</span><br></pre></td></tr></table></figure><p>使用copy是因为遍历的数组不能变化</p><h3 id="限制子弹数量"><a href="#限制子弹数量" class="headerlink" title="限制子弹数量"></a>限制子弹数量</h3><p>settings.py设置</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">self.bullet_allowed = <span class="number">3</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_fire_bullet</span>(<span class="params">self</span>):</span></span><br><span class="line">       <span class="string">&#x27;&#x27;&#x27;创建一颗子弹 将其加入编组中&#x27;&#x27;&#x27;</span></span><br><span class="line">       <span class="comment">#限制数量 当子弹数量小于限制数量时</span></span><br><span class="line">       <span class="keyword">if</span> <span class="built_in">len</span>(self.bullets)&lt;self.settings.bullet_allowed:</span><br><span class="line">           new_bullet = Bullet(self)</span><br><span class="line">           self.bullets.add(new_bullet)</span><br></pre></td></tr></table></figure><h3 id="重构代码"><a href="#重构代码" class="headerlink" title="重构代码"></a>重构代码</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_updata_bullets</span>(<span class="params">self</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;更新子弹位置并删除消失子弹&#x27;&#x27;&#x27;</span></span><br><span class="line">    self.bullets.update()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 删除消失的子弹</span></span><br><span class="line">    <span class="keyword">for</span> bullet <span class="keyword">in</span> self.bullets.copy():</span><br><span class="line">        <span class="keyword">if</span> bullet.rect.bottom &lt;= <span class="number">0</span>:</span><br><span class="line">            self.bullets.remove(bullet)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run_game</span>(<span class="params">self</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;开始游戏的主循环&#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="comment"># 监视键盘和鼠标事件</span></span><br><span class="line">        self._check_events()</span><br><span class="line">        <span class="comment"># 更新屏幕</span></span><br><span class="line">        self.ship.update()</span><br><span class="line">        self._updata_bullets()</span><br><span class="line">        self._update_screen()</span><br></pre></td></tr></table></figure><h2 id="创建外星人"><a href="#创建外星人" class="headerlink" title="创建外星人"></a>创建外星人</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pygame</span><br><span class="line"><span class="keyword">from</span>  pygame.sprite <span class="keyword">import</span> Sprite</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Alien</span>(<span class="params">Sprite</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;表示单个外星人&#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,ai_game</span>):</span></span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;初始化外星人&#x27;&#x27;&#x27;</span></span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        self.screen = ai_game.screen</span><br><span class="line"></span><br><span class="line">        <span class="comment">#加载外星人图像并设置大小位置</span></span><br><span class="line">        self.image = pygame.image.load(<span class="string">&#x27;./images/ufo.bmp&#x27;</span>)</span><br><span class="line">        self.rect = self.image.get_rect()</span><br><span class="line"></span><br><span class="line">        <span class="comment">#每个外星人都从左上角产生出</span></span><br><span class="line">        self.rect.x = self.rect.width</span><br><span class="line">        self.rect.y = self.rect.height</span><br><span class="line"></span><br><span class="line">        self.x = <span class="built_in">float</span>(self.rect.x)</span><br></pre></td></tr></table></figure><p>设置其图像与大小,位置</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_create_fleet</span>(<span class="params">self</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;创建外星人群&#x27;&#x27;&#x27;</span></span><br><span class="line">    alien = Alien(self)</span><br><span class="line">    alien_width = alien.rect.width</span><br><span class="line">    available_space_x = self.settings.screen_width - (<span class="number">2</span> * alien_width)</span><br><span class="line">    number_aliens_x = available_space_x // (<span class="number">2</span> * alien_width)</span><br><span class="line">    <span class="comment"># 创建一行外星人</span></span><br><span class="line">    <span class="keyword">for</span> alien_number <span class="keyword">in</span> <span class="built_in">range</span>(number_aliens_x):</span><br><span class="line">        self._create_alien(alien_number)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_create_alien</span>(<span class="params">self, alien_number</span>):</span></span><br><span class="line">    <span class="comment"># 创建一个外星人</span></span><br><span class="line">    alien = Alien(self)</span><br><span class="line">    alien_width = alien.rect.width</span><br><span class="line">    alien.x = alien_width + <span class="number">2</span> * alien_width * alien_number</span><br><span class="line">    alien.rect.x = alien.x</span><br><span class="line">    self.aliens.add(alien)</span><br></pre></td></tr></table></figure><p>在__init__中加入</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">self.aliens = pygame.sprite.Group()</span><br><span class="line">self._create_fleet()</span><br></pre></td></tr></table></figure><p>同时</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_update_screen</span>(<span class="params">self</span>):</span></span><br><span class="line">    <span class="comment"># self.screen.fill(self.settings.bg_color)</span></span><br><span class="line">    self.screen.fill(self.settings.bg_color)</span><br><span class="line">    self.ship.blitme()</span><br><span class="line">    <span class="keyword">for</span> bullet <span class="keyword">in</span> self.bullets.sprites():</span><br><span class="line">        bullet.draw_bullet()</span><br><span class="line">    self.aliens.draw(self.screen)</span><br><span class="line">    <span class="comment"># 让最近绘制的屏幕可见</span></span><br><span class="line">    pygame.display.flip()</span><br></pre></td></tr></table></figure><p>使用sprits.draw方法</p><h3 id="重构"><a href="#重构" class="headerlink" title="重构"></a>重构</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_create_fleet</span>(<span class="params">self</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;创建外星人群&#x27;&#x27;&#x27;</span></span><br><span class="line">    alien = Alien(self)</span><br><span class="line">    alien_width,alien_height = alien.rect.size</span><br><span class="line">    available_space_x = self.settings.screen_width - (<span class="number">2</span> * alien_width)</span><br><span class="line">    number_aliens_x = available_space_x // (<span class="number">2</span> * alien_width)</span><br><span class="line"></span><br><span class="line">    ship_hight = self.ship.rect.height</span><br><span class="line">    available_space_y = (self.settings.screen_height-(<span class="number">3</span>*alien_height)-ship_hight)</span><br><span class="line">    number_rows = available_space_y//(<span class="number">2</span>*alien_height)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 创建外星人群</span></span><br><span class="line">    <span class="keyword">for</span> row_number <span class="keyword">in</span> <span class="built_in">range</span>(number_rows):</span><br><span class="line">        <span class="keyword">for</span> alien_number <span class="keyword">in</span> <span class="built_in">range</span>(number_aliens_x):</span><br><span class="line">            self._create_alien(alien_number,row_number)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_create_alien</span>(<span class="params">self, alien_number,row_number</span>):</span></span><br><span class="line">    <span class="comment"># 创建一个外星人</span></span><br><span class="line">    alien = Alien(self)</span><br><span class="line">    alien_width = alien.rect.width</span><br><span class="line">    alien.x = alien_width + <span class="number">2</span> * alien_width * alien_number</span><br><span class="line">    alien.rect.x = alien.x</span><br><span class="line">    alien.rect.y = alien.rect.height+<span class="number">2</span>*alien.rect.height*row_number</span><br><span class="line">    self.aliens.add(alien)</span><br></pre></td></tr></table></figure><h3 id="让外星人移动"><a href="#让外星人移动" class="headerlink" title="让外星人移动"></a>让外星人移动</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">update</span>(<span class="params">self</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;向右移动外星人&#x27;&#x27;&#x27;</span></span><br><span class="line">    self.x += self.settings.alien_speed</span><br><span class="line">    self.rect.x = self.x</span><br></pre></td></tr></table></figure><h3 id="检查边界-到达边界后向另一个方向走并向下走"><a href="#检查边界-到达边界后向另一个方向走并向下走" class="headerlink" title="检查边界 到达边界后向另一个方向走并向下走"></a>检查边界 到达边界后向另一个方向走并向下走</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_update_alien</span>(<span class="params">self</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;更新外星人群中所有外星人的位置&#x27;&#x27;&#x27;</span></span><br><span class="line">    self._check_fleet_edges()</span><br><span class="line">    self.aliens.update()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_check_fleet_edges</span>(<span class="params">self</span>):</span></span><br><span class="line">    <span class="keyword">for</span> alien <span class="keyword">in</span> self.aliens.sprites():</span><br><span class="line">        <span class="keyword">if</span> alien.check_edges():</span><br><span class="line">            self._change_fleet_direction()</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_change_fleet_direction</span>(<span class="params">self</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;将整群外星人下移动  并换左右方向&#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> alien <span class="keyword">in</span> self.aliens.sprites():</span><br><span class="line">        alien.rect.y += self.settings.fleet_drop_speed</span><br><span class="line">    self.settings.fleet_direction *= -<span class="number">1</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">update</span>(<span class="params">self</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;向右移动外星人&#x27;&#x27;&#x27;</span></span><br><span class="line">    self.x += (self.settings.alien_speed * self.settings.fleet_direction)</span><br><span class="line">    self.rect.x = self.x</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">check_edges</span>(<span class="params">self</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;如果外星人在边缘返回true&#x27;&#x27;&#x27;</span></span><br><span class="line">    screen_rect = self.screen.get_rect()</span><br><span class="line">    <span class="keyword">if</span> self.rect.right &gt;= screen_rect.right <span class="keyword">or</span> self.rect.left &lt;= <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br></pre></td></tr></table></figure><h3 id="射击外星人"><a href="#射击外星人" class="headerlink" title="射击外星人"></a>射击外星人</h3><p>设计碰撞</p><p>sprits.groupcollide()</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_updata_bullets</span>(<span class="params">self</span>):</span></span><br><span class="line">      <span class="string">&#x27;&#x27;&#x27;更新子弹位置并删除消失子弹&#x27;&#x27;&#x27;</span></span><br><span class="line">      self.bullets.update()</span><br><span class="line"></span><br><span class="line">      <span class="comment"># 删除消失的子弹</span></span><br><span class="line">      <span class="keyword">for</span> bullet <span class="keyword">in</span> self.bullets.copy():</span><br><span class="line">          <span class="keyword">if</span> bullet.rect.bottom &lt;= <span class="number">0</span>:</span><br><span class="line">              self.bullets.remove(bullet)</span><br><span class="line">      self._check_bullet_alien_collisions()</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_check_bullet_alien_collisions</span>(<span class="params">self</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;相应子弹和外星人碰撞&#x27;&#x27;&#x27;</span></span><br><span class="line">    collisions = pygame.sprite.groupcollide(self.bullets, self.aliens, <span class="literal">True</span>, <span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> self.aliens:</span><br><span class="line">        <span class="comment"># 删除现有的所有子弹 并创建外星人</span></span><br><span class="line">        self.bullets.empty()</span><br><span class="line">        self._create_fleet()</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="飞船与ufo相碰撞"><a href="#飞船与ufo相碰撞" class="headerlink" title="飞船与ufo相碰撞"></a>飞船与ufo相碰撞</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">   <span class="function"><span class="keyword">def</span> <span class="title">_update_aliens</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;更新外星人群中所有外星人的位置&#x27;&#x27;&#x27;</span></span><br><span class="line">        self._check_fleet_edges()</span><br><span class="line">        self.aliens.update()</span><br><span class="line">        <span class="keyword">if</span> pygame.sprite.spritecollideany(self.ship,self.aliens):</span><br><span class="line">            self._ship_hit()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_ship_hit</span>(<span class="params">self</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;响应飞船被外星人碰撞&#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="comment"># 将left-1</span></span><br><span class="line">    self.stats.ships_left -= <span class="number">1</span></span><br><span class="line">    <span class="comment"># 清空余下的外星人和子弹</span></span><br><span class="line">    self.aliens.empty()</span><br><span class="line">    self.bullets.empty()</span><br><span class="line">    <span class="comment"># 创建一群新的外星人 并将飞船放到屏幕的底端</span></span><br><span class="line">    self._create_fleet()</span><br><span class="line">    self.ship.center_ship()</span><br><span class="line">    <span class="comment"># 暂停</span></span><br><span class="line">    sleep(<span class="number">0.5</span>)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GameStats</span>:</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;跟踪游戏统计信息&#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,ai_game</span>):</span></span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;初始化统计信息&#x27;&#x27;&#x27;</span></span><br><span class="line">        self.settings = ai_game.settings</span><br><span class="line">        self.reset_stats()</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">reset_stats</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;初始化在游戏运行期间可能变化的统计信息&#x27;&#x27;&#x27;</span></span><br><span class="line">        self.ships_left = self.settings.ship_limit</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">center_ship</span>(<span class="params">self</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;让飞船在底端中央&quot;&quot;&quot;</span></span><br><span class="line">    self.rect.midbottom = self.screen_rect.midbottom</span><br><span class="line">    self.x = <span class="built_in">float</span>(self.rect.x)</span><br></pre></td></tr></table></figure><p>碰撞后飞船消失</p><h3 id="检查外星人到屏幕底端"><a href="#检查外星人到屏幕底端" class="headerlink" title="检查外星人到屏幕底端"></a>检查外星人到屏幕底端</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_check_aliens_bottom</span>(<span class="params">self</span>):</span></span><br><span class="line">    <span class="comment"># 检查外星人是否到达底端</span></span><br><span class="line">    screen_rect = self.screen.get_rect()</span><br><span class="line">    <span class="keyword">for</span> alien <span class="keyword">in</span> self.aliens.sprites():</span><br><span class="line">        <span class="keyword">if</span> alien.rect.bottom &gt;= screen_rect.bottom:</span><br><span class="line">            <span class="comment"># 像飞船被撞到一样处理</span></span><br><span class="line">            self._ship_hit()</span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_update_aliens</span>(<span class="params">self</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;更新外星人群中所有外星人的位置&#x27;&#x27;&#x27;</span></span><br><span class="line">    self._check_fleet_edges()</span><br><span class="line">    self.aliens.update()</span><br><span class="line">    <span class="keyword">if</span> pygame.sprite.spritecollideany(self.ship, self.aliens):</span><br><span class="line">        self._ship_hit()</span><br><span class="line">    self._check_aliens_bottom()</span><br></pre></td></tr></table></figure><h3 id="游戏结束"><a href="#游戏结束" class="headerlink" title="游戏结束"></a>游戏结束</h3><p>添加一个标志</p><p>当数量小于0时设为False</p><p><img data-src="http://cdn.sekyoro.top/imgs/093709.png" alt="image-20210815201215794"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_ship_hit</span>(<span class="params">self</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;响应飞船被外星人碰撞&#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="comment"># 将left-1</span></span><br><span class="line">    <span class="keyword">if</span> self.stats.ships_left&gt;<span class="number">0</span>:</span><br><span class="line">        self.stats.ships_left -= <span class="number">1</span></span><br><span class="line">        <span class="comment"># 清空余下的外星人和子弹</span></span><br><span class="line">        self.aliens.empty()</span><br><span class="line">        self.bullets.empty()</span><br><span class="line">        <span class="comment"># 创建一群新的外星人 并将飞船放到屏幕的底端</span></span><br><span class="line">        self._create_fleet()</span><br><span class="line">        self.ship.center_ship()</span><br><span class="line">        <span class="comment"># 暂停</span></span><br><span class="line">        sleep(<span class="number">0.5</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        self.stats.game_active = <span class="literal">False</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run_game</span>(<span class="params">self</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;开始游戏的主循环&#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="comment"># 监视键盘和鼠标事件</span></span><br><span class="line">        self._check_events()</span><br><span class="line">        <span class="comment"># 更新屏幕</span></span><br><span class="line">        <span class="keyword">if</span> self.stats.game_active:</span><br><span class="line">            self.ship.update()</span><br><span class="line">            <span class="comment"># self.bullets.update()</span></span><br><span class="line">            self._updata_bullets()</span><br><span class="line">            self._update_screen()</span><br><span class="line">            self._update_aliens()</span><br><span class="line">            <span class="comment"># for bullet in self.bullets.copy():</span></span><br><span class="line">            <span class="comment">#     if bullet.rect.bottom &lt;= 0:</span></span><br><span class="line">            <span class="comment">#         self.bullets.remove(bullet)</span></span><br></pre></td></tr></table></figure><p>先写到这里,后面再补</p><p><a href="https://github.com/drowning-in-codes/pygame.git">https://github.com/drowning-in-codes/pygame.git</a></p><p>github地址</p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      
        <tags>
            
            <tag> python </tag>
            
            <tag> pygame </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Git学习</title>
      <link href="2021/08/10/Git%E5%AD%A6%E4%B9%A0/"/>
      <url>2021/08/10/Git%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="Git学习"><a href="#Git学习" class="headerlink" title="Git学习"></a>Git学习</h1><p>我的感觉就是可以把代码保存到一个地方,供自己和团队修改</p><span id="more"></span><p>Git 是一个开源的分布式版本控制系统，用于敏捷高效地处理任何或小或大的项目。</p><p>Git 是 Linus Torvalds 为了帮助管理 Linux 内核开发而开发的一个开放源码的版本控制软件。</p><p>Git 与常用的版本控制工具 CVS, Subversion 等不同，它采用了分布式版本库的方式，不必服务器端软件支持。</p><p>一般工作流程如下：</p><ul><li>克隆 Git 资源作为工作目录。</li><li>在克隆的资源上添加或修改文件。</li><li>如果其他人修改了，你可以更新资源。</li><li>在提交前查看修改。</li><li>提交修改。</li><li>在修改完成后，如果发现错误，可以撤回提交并再次修改并提交。</li></ul><h2 id="1-基本概念"><a href="#1-基本概念" class="headerlink" title="1.基本概念"></a>1.基本概念</h2><ul><li><strong>工作区：</strong>就是你在电脑里能看到的目录。</li><li><strong>暂存区：</strong>英文叫 stage 或 index。一般存放在 <strong>.git</strong> 目录下的 index 文件（.git/index）中，所以我们把暂存区有时也叫作索引（index）。</li><li><strong>版本库：</strong>工作区有一个隐藏目录 <strong>.git</strong>，这个不算工作区，而是 Git 的版本库。</li></ul><p><img data-src="http://cdn.sekyoro.top/imgs/093538.png" alt="image-20210720214140606"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">git init</span><br><span class="line"><span class="meta">#</span><span class="bash">使用当前目录,初始化一个Git仓库</span></span><br><span class="line">git init newrepo</span><br><span class="line"><span class="meta">#</span><span class="bash">指定目录</span></span><br><span class="line">git clone &lt;repo&gt;#克隆一个仓库</span><br><span class="line">git clone &lt;repo&gt; &lt;directory&gt;#将仓库克隆到一个指定目录</span><br><span class="line">git config#git设置信息</span><br><span class="line">git config--global user.name &quot;runoob&quot;</span><br><span class="line">git config --global user.email test@run</span><br></pre></td></tr></table></figure><p>HEAD 总是指向当前分支上最近一次提交记录。大多数修改提交树的 Git 命令都是从改变 HEAD 的指向开始的。</p><p><img data-src="http://cdn.sekyoro.top/imgs/093539.png" alt="image-20210801131105094"></p><p>git status查看仓库状态,查看工作区有无更新与未被追踪的文件</p><p><img data-src="http://cdn.sekyoro.top/imgs/093543.png" alt="image-20210801135729377"></p><p>修改后还未git add更新到暂存区(stage)以及还未track的文件使用git add添加</p><p>git log 查看提交日志 查看提交的信息 message与提交人以及时间 在后面加上指定的文件或目录可以只显示所要求的信息</p><p><img data-src="http://cdn.sekyoro.top/imgs/093545.png" alt="image-20210801131231033"></p><p>commit旁是一串哈希值</p><p>git log -p 查看提交带来的变动,文件前后的差别</p><p>git diff 查看工作树,暂存区,最新提交之间的差别</p><p><img data-src="http://cdn.sekyoro.top/imgs/093552.png" alt="image-20210801132603359"></p><p>+表示增加一行  -表示减少一行</p><p>提交后,输入git diff没有输出 因为工作区和暂存区无差别</p><p>若要查看与最新提交的差别,需要git diff HEAD</p><p><img data-src="http://cdn.sekyoro.top/imgs/093554.png" alt="image-20210801134601328"></p><p>可以在git commit之前先执行git diff HEAD查看工作区与最新提交的差别,等确认玩别再进行提交</p><p>HEAD指向当前分支中最新一次提交的指针</p><h2 id="分支操作"><a href="#分支操作" class="headerlink" title="分支操作"></a>分支操作</h2><p>master分支是Git默认创建的分支,所有分支都是以这个分支为中心进行</p><p>git branch显示分支</p><p><img data-src="http://cdn.sekyoro.top/imgs/093555.png" alt="image-20210801140430235"></p><p>*号表示当前分支</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout -b A 创建,切换分支  #-b表示创建</span><br></pre></td></tr></table></figure><p>实际上与者两条指令作用相同</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git branch A#chuangjian</span><br><span class="line"></span><br><span class="line">git checkout A #转到A</span><br><span class="line"></span><br><span class="line">git checkout -  #切换到上次的分支</span><br></pre></td></tr></table></figure><p>以当前的master分支为基础创建新的分支</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git commit -m  <span class="string">&quot;feature-A&quot;</span> <span class="comment">#提交</span></span><br></pre></td></tr></table></figure><p>执行git add就会将代码提交到A分支,而master分支不会受影响.这样可以在不互相影响的情况下同时进行多个功能的开发</p><p><img data-src="http://cdn.sekyoro.top/imgs/093556.png" alt="image-20210801142740455"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git merge #    合并分支 </span><br></pre></td></tr></table></figure><p>将分支合并到主干分支master中,首先切换到master分支.为了在历史记录中明确记录下本次分支合并,我们需要创建合并提交.在合并时加上—no-ff参数随后录入合并提交的信息</p><p>默认信息中已经包含了是从feature-A分支合并过来的相关内容,所以可不做任何更改</p><p>fast-forward</p><p>Git 合并两个分支时，如果顺着一个分支走下去可以到达另一个分支的话，那么 Git 在合并两者时，只会简单地把指针右移，叫做“快进”（fast-forward）不过这种情况如果删除分支，则会丢失merge分支信息。</p><p>–squash</p><p>把一些不必要commit进行压缩，比如说，你的feature在开发的时候写的commit很乱，那么我们合并的时候不希望把这些历史commit带过来，于是使用–squash进行合并，此时文件已经同合并后一样了，但不移动HEAD，不提交。需要进行一次额外的commit来“总结”一下，然后完成最终的合并。</p><p>–no-ff</p><p>关闭fast-forward模式，在提交的时候，会创建一个merge的commit信息，然后合并的和master分支<br> merge的不同行为，向后看，其实最终都会将代码合并到master分支，而区别仅仅只是分支上的简洁清晰的问题，然后，向前看，也就是我们使用<code>reset</code> 的时候，就会发现，不同的行为就带来了不同的影响</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">log</span> --graph  <span class="comment">#以图表形式查看提交</span></span><br></pre></td></tr></table></figure><p><img data-src="http://cdn.sekyoro.top/imgs/093557.png" alt="image-20210801150741989"></p><h2 id="更改提交"><a href="#更改提交" class="headerlink" title="更改提交"></a>更改提交</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git reset #回溯历史版本</span><br></pre></td></tr></table></figure><p>要让仓库的head，暂存区与当前工作树回溯到之前状态,需要用到git reset —hard 提供目标时间点的哈希值就可以完全恢复至改时间点的状态</p><p>回溯至之前状态后,利用git reflog可以前推</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git commit --amend <span class="comment">#可以修改上一条提交信息</span></span><br><span class="line">git commit -am <span class="string">&quot;&quot;</span> <span class="comment">#不用add直接提交</span></span><br><span class="line">git rebase -i HEAD~2 <span class="comment">#合并历史  选定当前分支包含HEAD在内的两个最新历史记录</span></span><br></pre></td></tr></table></figure><p><a href="https://learngitbranching.js.org/?locale=zh_CN">Learn Git Branching</a></p><p>1)、在本地创建一个版本库（即文件夹），通过<code>git init</code>把它变成Git仓库；</p><p>2)、把项目复制到这个文件夹里面，再通过<code>git add .</code>把项目添加到仓库；</p><p>3)、再通过<code>git commit -m &quot;注释内容&quot;</code>把项目提交到仓库；</p><p>4)、在Github上设置好SSH密钥后，新建一个远程仓库，通过<code>git remote add origin 远程仓库地址</code>将本地仓库和远程仓库进行关联；</p><p>5)、最后通过<code>git push -u origin master</code>把本地仓库的项目推送到远程仓库（也就是Github）上。</p><h2 id="更新"><a href="#更新" class="headerlink" title="更新"></a>更新</h2><h3 id="工作流"><a href="#工作流" class="headerlink" title="工作流"></a>工作流</h3><p>1.git clone // 到本地<br>2.git checkout -b xxx 切换至新分支xxx<br>（相当于复制了remote的仓库到本地的xxx分支上<br>3.修改或者添加本地代码（部署在硬盘的源文件上）<br>4.git diff 查看自己对代码做出的改变<br>5.git add 上传更新后的代码至暂存区<br>6.git commit 可以将暂存区里更新后的代码更新到本地git<br>7.git push origin xxx 将本地的xxxgit分支上传至github上的git<br>（如果在写自己的代码过程中发现远端GitHub上代码出现改变）<br>1.git checkout main 切换回main分支<br>2.git pull origin master(main) 将远端修改过的代码再更新到本地<br>3.git checkout xxx 回到xxx分支<br>4.git rebase main 我在xxx分支上，先把main移过来，然后根据我的commit来修改成新的内容<br>（中途可能会出现，rebase conflict 手动选择保留哪段代码）<br>5.git push -f origin xxx 把rebase后并且更新过的代码再push到远端github上<br>（-f  强行）<br>6.原项目主人采用pull request 中的 squash and merge 合并所有不同的commit<br>远端完成更新后<br>1.git branch -d xxx 删除本地的git分支<br>2.git pull origin master 再把远端的最新代码拉至本地</p><h3 id="git的撤销操作"><a href="#git的撤销操作" class="headerlink" title="git的撤销操作"></a>git的撤销操作</h3><p>git分为Disk,staging,local,remote.</p><p>git restore(git checkout),git reset(git restore —staged),git revert HEAD.</p><p>在磁盘上文件修改后,git diff查看差别,git status查看状态.要撤销磁盘上的改动,git restore <file_name>撤销.</p><p>git add提交到暂存区,git status状态改变,要撤销git reset <file_name>或git restore —staged <file_name>.</p><p>若还要撤销磁盘上的修改以及暂存区,git checkout HEAD <file_name>.</p><p>git commit提交到本地git,git reset —soft HEAD~1 回退一个commit. git reset HEAD~1回退一个commit以及暂存区回退,只保留磁盘修改,git reset —hard HEAD~1磁盘修改也会退. git revert HEAD增加一个commit与之前的commit相反,用于主分支.</p><p>git push推送到远程</p><p><a href="http://www.ruanyifeng.com/blog/2015/08/git-use-process.html">Git 使用规范流程 - 阮一峰的网络日志 (ruanyifeng.com)</a></p><p><a href="http://www.ruanyifeng.com/blog/2015/12/git-workflow.html">Git 工作流程 - 阮一峰的网络日志 (ruanyifeng.com)</a></p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      
        <tags>
            
            <tag> Git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python多线程学习</title>
      <link href="2021/07/31/Python%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%AD%A6%E4%B9%A0/"/>
      <url>2021/07/31/Python%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="Python多线程学习"><a href="#Python多线程学习" class="headerlink" title="Python多线程学习"></a>Python多线程学习</h1><p>在使用tkinter过程中,调用一个函数发现主界面长时间未响应,原因是这个函数占用太长时间.界面卡死,这里应该要用多线程解决</p><span id="more"></span><ul><li>使用线程可以把占据长时间的程序中的任务放到后台去处理。</li><li>用户界面可以更加吸引人，比如用户点击了一个按钮去触发某些事件的处理，可以弹出一个进度条来显示处理的进度。</li><li>程序的运行速度可能加快。</li><li>在一些等待的任务实现上如用户输入、文件读写和网络收发数据等，线程就比较有用了。在这种情况下我们可以释放一些珍贵的资源如内存占用等等。</li></ul><p><img data-src="http://cdn.sekyoro.top/imgs/093007.png" alt="image-20210730190703000"></p><p>这里使用threading模块解决</p><p><img data-src="http://cdn.sekyoro.top/imgs/093009.png" alt="image-20210730191254448"></p><p>创建子线程,需要两个要素</p><p>1.线程对象:线程对象是threading模块的线程类Thread或子类</p><p>2.线程体:线程体是子线程要执行的代码,这些代码会被封装到一个函数.子线程在启动后会执行线程体.实现线程体主要有:</p><ol><li>自定义函数实现线程体</li><li>自定义线程类实现线程体</li></ol><h2 id="自定义函数实现线程体"><a href="#自定义函数实现线程体" class="headerlink" title="自定义函数实现线程体"></a>自定义函数实现线程体</h2><p>创建线程对象的构造方法</p><p>Thread(target=None,name=None,args=())</p><p><img data-src="http://cdn.sekyoro.top/imgs/093010.png" alt="image-20210730193033951"></p><p>注意  Thread还有daemon属性,守护进程,默认为False</p><p>即主线程若运行完后子线程还未运行完,则子线程将继续运行</p><p>设置为True后主线程运行完,子线程也将被kill</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">thread = threading.Thread(target=test,name=<span class="string">&#x27;TestThread&#x27;</span>,daemon=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><h2 id="自定义线程类实现线程体"><a href="#自定义线程类实现线程体" class="headerlink" title="自定义线程类实现线程体"></a>自定义线程类实现线程体</h2><p>继承threading.Thread,实现run方法</p><p><img data-src="http://cdn.sekyoro.top/imgs/093012.png" alt="image-20210730194648097"></p><h2 id="线程管理"><a href="#线程管理" class="headerlink" title="线程管理"></a>线程管理</h2><h3 id="1-等待线程结束"><a href="#1-等待线程结束" class="headerlink" title="1.等待线程结束"></a>1.等待线程结束</h3><p><strong>join([time]):</strong> 等待至线程中止。这阻塞调用线程直至线程的join() 方法被调用中止-正常退出或者抛出未处理的异常-或者是可选的超时发生</p><p>有时一个线程需要等待另外一个线程执行结束才能继续执行</p><p>join()</p><p><img data-src="http://cdn.sekyoro.top/imgs/093014.png" alt="image-20210730195311797"></p><h2 id="线程间还有通信"><a href="#线程间还有通信" class="headerlink" title="线程间还有通信"></a>线程间还有通信</h2><p>线程可以利用全局变量,因此容易造成混乱</p><p>互斥锁</p><p>threading模块有Lock类可以方便处理锁定</p><p>Lock类有acquire()锁定和release()释放锁</p><p>同时还有Queue队列</p><p>这里就不细说了</p><p>相关资料:<a href="https://www.runoob.com/python3/python3-multithreading.html">Python3 多线程</a></p><p>​    <a href="https://guo-pu.blog.csdn.net/article/details/86707216?utm_medium=distribute.pc_relevant_bbs_down.none-task-blog-baidujs-2.nonecase&amp;depth_1-utm_source=distribute.pc_relevant_bbs_down.none-task-blog-baidujs-2.nonecase">python tkinter界面卡死的解决办法</a></p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> threading </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>tkinter+requests练习</title>
      <link href="2021/07/31/tkinter-requests%E7%BB%83%E4%B9%A0/"/>
      <url>2021/07/31/tkinter-requests%E7%BB%83%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>想用tkinter写个桌面程序</p><span id="more"></span><p>tkinter参考资料主要有官方文档,还有一本台湾人写的书tkinter菜鸟编程.此外还有一堆抄来抄去的书.我觉得只要多练就行了,看看官方写的代码</p><p>主要解决问题:</p><ol><li>tkinter的控件布局.整洁好看,不过这并不是最重要的</li><li>调用程序,触发一个选项后要有调用的函数</li><li>多线程.不然界面会出现未响应</li></ol><p>一些小问题  控件的大小,字体颜色与大小   利用python打开资源管理器<a href="https://my.oschina.net/famiover/blog/783289">Python调Windows的资源管理器打开指定目录 - famiover - OSCHINA - 中文开源技术交流社区</a></p><h2 id="1-布局问题"><a href="#1-布局问题" class="headerlink" title="1.布局问题"></a>1.布局问题</h2><p>tkinter布局一般,不像PyQt拖拽式那样简单.</p><p>一般用到的控件Label,Entry,Button,messagebox,menu,text,toplevel(打开新窗口)</p><p>像按钮啥的暂时用不上</p><p>同时还有添加图像时有时图片太大,可以利用</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line">photo = Image.<span class="built_in">open</span>(<span class="string">&quot;小猫.jpg&quot;</span>)  <span class="comment">#括号里为需要显示在图形化界面里的图片</span></span><br><span class="line">   </span><br><span class="line">photo = photo.resize((<span class="number">400</span>,<span class="number">400</span>))  <span class="comment">#规定图片大小</span></span><br></pre></td></tr></table></figure><p><a href="https://blog.csdn.net/qq_45687410/article/details/109103338">python 使用图形化界面tkinter显示图片 规定大小！_地中海的博客-CSDN博客_tkinter设置图片大小</a></p><h2 id="2-调用程序"><a href="#2-调用程序" class="headerlink" title="2.调用程序"></a>2.调用程序</h2><p>tkinter两种方法</p><p>command调用与bind绑定</p><p>不过我发现</p><p>控件command=callback传参不方便,只能利用     </p><ol><li><p>lambda函数 </p></li><li><p>IntVar() StringVar()等这种变量设置</p></li></ol><p>而bind会传一个参数event</p><p>可以得到相关参数(例如鼠标点击位置啥的)</p><p>建议一个空间不要同时用这两个调用</p><h2 id="3-多线程"><a href="#3-多线程" class="headerlink" title="3.多线程"></a>3.多线程</h2><p>主要是要将桌面主程序与爬虫等程序分开</p><p>上次讲了python多线程利用threading模块的两种写法</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> thread</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Mythread</span>(<span class="params">threading.Thread</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,name=<span class="literal">None</span></span>):</span></span><br><span class="line">        <span class="built_in">super</span>().__init__(name=name)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">            n = threading.currentThread()</span><br><span class="line">            time.sleep(<span class="number">1</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;现在是&#123;0&#125;的第&#123;1&#125;次&quot;</span>.<span class="built_in">format</span>(n.name,i))</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;子线程执行完了&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    mythread = Mythread(<span class="string">&quot;张三&quot;</span>)</span><br><span class="line">    mythread.setDaemon(<span class="literal">True</span>) <span class="comment">#守护线程,当主线程执行完后,子线程强制关闭</span></span><br><span class="line">    mythread.start()</span><br><span class="line">    mythread.join() <span class="comment">#必须当这个子线程执行完,主线程才开始执行</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">        time.sleep(<span class="number">1</span>)</span><br><span class="line">        n = threading.currentThread()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;现在是&#123;0&#125;的第&#123;1&#125;次&quot;</span>.<span class="built_in">format</span>(n.name, i))</span><br><span class="line">    </span><br></pre></td></tr></table></figure><p><img data-src="http://cdn.sekyoro.top/imgs/093017.png" alt="image-20210731230339270"></p><p>可以看出join之后子线程先执行完,若去掉join</p><p><img data-src="http://cdn.sekyoro.top/imgs/093019.png" alt="image-20210731230516420"></p><p>注意主线程与子线程同时执行并且当主线程执行完,子线程关闭</p><h2 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h2><p>特别注意的是,我添加图片时,如果在函数里添加,那么图片就没了(程序没有报错,但图片显示空白)</p><p>我把那段代码改在主函数里就行了,猜测可能是因为GC机制回收了</p><h2 id="完整代码"><a href="#完整代码" class="headerlink" title="完整代码"></a>完整代码</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> tkinter.ttk <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> tkinter <span class="keyword">as</span> tk</span><br><span class="line"><span class="keyword">from</span> tkinter <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> tkinter <span class="keyword">import</span> messagebox</span><br><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> os.path</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image, ImageTk</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Application</span>(<span class="params">tk.Frame</span>):</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, master=<span class="literal">None</span></span>):</span></span><br><span class="line">        <span class="built_in">super</span>().__init__(master)</span><br><span class="line">        self.button = tk.Button(self, text=<span class="string">&quot;确定&quot;</span>, )  <span class="comment"># command=self.get_info)</span></span><br><span class="line">        self.entry = tk.Entry(self, font=<span class="string">&quot;times 15&quot;</span>)</span><br><span class="line">        self.endbtn = Button(self, text=<span class="string">&quot;结束&quot;</span>, command=stop)</span><br><span class="line">        self.label1 = tk.Label(self, text=<span class="string">&quot;请输入爬取的页数范围:\n例子:1,2&quot;</span>, font=<span class="string">&quot;times 15&quot;</span>, relief=<span class="string">&quot;raised&quot;</span>)</span><br><span class="line">        self.create_widget()</span><br><span class="line">        self.pack()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">create_widget</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.entry.insert(<span class="number">0</span>, <span class="string">&quot;1,2&quot;</span>)</span><br><span class="line">        self.label1.pack(side=LEFT, fill=BOTH)</span><br><span class="line">        self.entry.pack(fill=X)</span><br><span class="line">        self.button.pack(fill=BOTH)</span><br><span class="line">        self.button.bind(<span class="string">&quot;&lt;Button-1&gt;&quot;</span>, self.get_info)</span><br><span class="line">        self.entry.bind(<span class="string">&quot;&lt;Return&gt;&quot;</span>, self.get_info)</span><br><span class="line"></span><br><span class="line">        self.endbtn.pack(fill=X)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_info</span>(<span class="params">self, event</span>):</span></span><br><span class="line">        entry_info = self.entry.get()</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            fir_page = <span class="built_in">int</span>(entry_info.split(<span class="string">&quot;,&quot;</span>)[<span class="number">0</span>])</span><br><span class="line">            sec_page = <span class="built_in">int</span>(entry_info.split(<span class="string">&quot;,&quot;</span>)[<span class="number">1</span>])</span><br><span class="line">        <span class="keyword">except</span> IndexError <span class="keyword">as</span> e:</span><br><span class="line">            messagebox.showwarning(<span class="string">&quot;提示&quot;</span>, <span class="string">&quot;输入格式错误\n%s&quot;</span> % e)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">except</span> ValueError <span class="keyword">as</span> e:</span><br><span class="line">            messagebox.showwarning(<span class="string">&quot;提示&quot;</span>, <span class="string">&quot;输入格式错误\n%s&quot;</span> % e)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            messagebox.showwarning(<span class="string">&quot;提示&quot;</span>, <span class="string">&quot;输入格式错误\n%s&quot;</span> % e)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        spider = Spider(fir_page, sec_page)</span><br><span class="line">        spider.setDaemon(<span class="literal">True</span>)</span><br><span class="line">        var.<span class="built_in">set</span>(<span class="string">&quot;正在爬取...&quot;</span>)</span><br><span class="line">        spider.start()</span><br><span class="line">        <span class="comment"># spider.join()   这里如果join了运行爬虫桌面程序多半会卡</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Spider</span>(<span class="params">threading.Thread</span>):</span></span><br><span class="line">    <span class="comment"># global info</span></span><br><span class="line">    <span class="comment"># location = os.getcwd() + &#x27;/fake_useragent.json&#x27;</span></span><br><span class="line">    <span class="comment"># ua = UserAgent(path=location)</span></span><br><span class="line">    __headers = &#123;<span class="string">&#x27;user_agent&#x27;</span>: <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) &quot;</span></span><br><span class="line">                               <span class="string">&quot;Chrome/92.0.4515.107 Safari/537.36 Edg/92.0.902.55&quot;</span>, <span class="string">&quot;Connection&quot;</span>: <span class="string">&quot;close&quot;</span>&#125;</span><br><span class="line">    <span class="comment"># __base_url = &quot;https://konachan.net/&quot;</span></span><br><span class="line">    <span class="comment"># __url = &quot;https://konachan.net/post?page=&#123;&#125;&quot;</span></span><br><span class="line">    __url = <span class="string">&quot;https://gelbooru.com/index.php?page=post&amp;s=list&amp;tags=all&amp;pid=&#123;&#125;&quot;</span></span><br><span class="line">    flag = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, fir_page, sec_page</span>):</span></span><br><span class="line">        Spider.flag = <span class="literal">False</span></span><br><span class="line">        <span class="built_in">super</span>().__init__(<span class="literal">None</span>)</span><br><span class="line">        <span class="comment"># self.fir_page = fir_page</span></span><br><span class="line">        <span class="comment"># self.sec_page = sec_page</span></span><br><span class="line">        self.fir_page = (fir_page - <span class="number">1</span>) * <span class="number">42</span></span><br><span class="line">        self.sec_page = sec_page * <span class="number">42</span></span><br><span class="line">        self.tag = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span>(<span class="params">self</span>):</span></span><br><span class="line">        pb.start()</span><br><span class="line">        self.parse()</span><br><span class="line">        pb.stop()</span><br><span class="line">        var.<span class="built_in">set</span>(<span class="string">&quot;爬取完毕&quot;</span>)</span><br><span class="line">        messagebox.showinfo(<span class="string">&quot;提示消息&quot;</span>, <span class="string">&quot;爬取结束了&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">parse</span>(<span class="params">self</span>):</span></span><br><span class="line">        text.delete(<span class="string">&quot;1.0&quot;</span>, END)</span><br><span class="line">        requests.adapters.DEFAULT_RETRIES = <span class="number">5</span></span><br><span class="line">        text.insert(END, <span class="string">&quot;下载至&#123;&#125;\n&quot;</span>.<span class="built_in">format</span>(os.getcwd() + <span class="string">r&#x27;\images或\videos&#x27;</span>))</span><br><span class="line">        <span class="comment"># info += &quot;下载至&#123;&#125;\n&quot;.format(os.getcwd() + r&#x27;\images或\videos&#x27;)</span></span><br><span class="line">        <span class="comment"># msg_var.set(info)</span></span><br><span class="line">        <span class="keyword">for</span> n <span class="keyword">in</span> <span class="built_in">range</span>(self.fir_page, self.sec_page + <span class="number">1</span>):</span><br><span class="line">            <span class="keyword">if</span> Spider.flag:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            time.sleep(<span class="number">1.5</span>)</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                res = requests.get(self.__url.<span class="built_in">format</span>(n), headers=self.__headers)</span><br><span class="line">            <span class="keyword">except</span> requests.exceptions.ConnectionError <span class="keyword">as</span> e:</span><br><span class="line">                messagebox.showinfo(<span class="string">&quot;出现问题&quot;</span>, <span class="string">&quot;爬取频繁,请连接代理\n%s&quot;</span> % e)</span><br><span class="line">                pb.stop()</span><br><span class="line">                var.<span class="built_in">set</span>(<span class="string">&quot;爬取完毕&quot;</span>)</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            selector = etree.HTML(res.text)</span><br><span class="line">            <span class="comment"># images_urls = selector.xpath(&quot;//ul[@id=&#x27;post-list-posts&#x27;]/li//a[@class=&#x27;thumb&#x27;]/@href&quot;)</span></span><br><span class="line">            images_urls = selector.xpath(<span class="string">&quot;//article//a/@href&quot;</span>)</span><br><span class="line">            <span class="keyword">for</span> image_url <span class="keyword">in</span> images_urls:</span><br><span class="line">                <span class="keyword">if</span> Spider.flag:</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                self.parse_next(image_url)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">parse_next</span>(<span class="params">self, image_url</span>):</span></span><br><span class="line">        <span class="comment"># image_id = image_url.split(&quot;/&quot;)[3]</span></span><br><span class="line">        <span class="comment"># next_url = self.__base_url + image_url</span></span><br><span class="line">        image_id = image_url.split(<span class="string">&quot;=&quot;</span>)[-<span class="number">1</span>]</span><br><span class="line">        next_url = image_url</span><br><span class="line">        time.sleep(<span class="number">1.5</span>)</span><br><span class="line">        res = requests.get(next_url, headers=self.__headers)</span><br><span class="line">        selector = etree.HTML(res.text)</span><br><span class="line">        <span class="comment"># img = selector.xpath(&quot;//img[@id=&#x27;image&#x27;]/@src&quot;)[0]</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            img = selector.xpath(<span class="string">&quot;//img[@id=&#x27;image&#x27;]/@src&quot;</span>)[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">except</span> IndexError:</span><br><span class="line">            img = selector.xpath(<span class="string">&quot;//video/source[1]/@src&quot;</span>)[<span class="number">0</span>]  <span class="comment"># 这是图片</span></span><br><span class="line">            self.tag = <span class="literal">False</span></span><br><span class="line">        self.download(img, image_id)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">download</span>(<span class="params">self, img, image_id</span>):</span></span><br><span class="line">        <span class="keyword">if</span> Spider.flag:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        time.sleep(<span class="number">0.5</span>)</span><br><span class="line">        suffix = img.split(<span class="string">&quot;.&quot;</span>)[-<span class="number">1</span>]</span><br><span class="line">        res = requests.get(img, headers=self.__headers)</span><br><span class="line">        text.insert(END, <span class="string">&quot;正在下载:%s\n&quot;</span> % img)</span><br><span class="line">        <span class="comment"># info += &quot;正在下载:%s\n&quot; % img</span></span><br><span class="line">        <span class="comment"># msg_var.set(info)</span></span><br><span class="line">        <span class="keyword">if</span> self.tag:</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(<span class="string">&quot;./images&quot;</span>):</span><br><span class="line">                os.mkdir(<span class="string">&quot;./images&quot;</span>)</span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;images/&#123;0&#125;.&#123;1&#125;&#x27;</span>.<span class="built_in">format</span>(image_id, suffix), <span class="string">&#x27;wb+&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                f.write(res.content)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(<span class="string">&quot;./videos&quot;</span>):</span><br><span class="line">                os.mkdir(<span class="string">&quot;./videos&quot;</span>)</span><br><span class="line">                <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;videos/&#123;0&#125;.&#123;1&#125;&#x27;</span>.<span class="built_in">format</span>(image_id, suffix), <span class="string">&#x27;wb+&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                    f.write(res.content)</span><br><span class="line">        text.insert(END, <span class="string">&quot;下载成功:%s\n&quot;</span> % img)</span><br><span class="line">        <span class="comment"># info += &quot;下载成功:%s\n&quot; % img</span></span><br><span class="line">        <span class="comment"># msg_var.set(info)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">stop</span>():</span></span><br><span class="line">    Spider.flag = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">open_current</span>():</span></span><br><span class="line">    base_path = os.getcwd()</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(<span class="string">&quot;./images&quot;</span>):</span><br><span class="line">        is_cre = messagebox.askyesno(<span class="string">&quot;提示&quot;</span>, <span class="string">&quot;不存在图片文件夹，是否创建?&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> is_cre:</span><br><span class="line">            os.mkdir(<span class="string">&quot;./images&quot;</span>)</span><br><span class="line">            path = base_path + <span class="string">r&quot;\images&quot;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            path = base_path</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        path = base_path + <span class="string">r&quot;\images&quot;</span></span><br><span class="line">    os.system(<span class="string">&quot;explorer.exe %s&quot;</span> % path)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show_myinfo</span>():</span></span><br><span class="line">    my_info = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        website:http://sekyoro.top/</span></span><br><span class="line"><span class="string">        github:https://github.com/drowning-in-codes</span></span><br><span class="line"><span class="string">        一起学习</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    toplevel = Toplevel()</span><br><span class="line">    toplevel.title(<span class="string">&quot;关于我&quot;</span>)</span><br><span class="line">    toplevel.iconbitmap(<span class="string">&quot;th.ico&quot;</span>)</span><br><span class="line">    toplevel.geometry(<span class="string">&quot;400x350&quot;</span>)</span><br><span class="line">    info_label = Label(toplevel, font=<span class="string">&quot;times 15&quot;</span>, text=my_info, image=info_tk_image, compound=<span class="string">&quot;top&quot;</span>, justify=<span class="string">&quot;left&quot;</span>)</span><br><span class="line">    info_label.pack()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">set_window</span>():</span></span><br><span class="line">    root.title(<span class="string">&quot;桌面爬虫&quot;</span>)</span><br><span class="line">    root.geometry(<span class="string">&quot;400x450&quot;</span>)</span><br><span class="line">    root.iconbitmap(<span class="string">&quot;th.ico&quot;</span>)</span><br><span class="line">    label.pack()</span><br><span class="line">    menubar = Menu(root)</span><br><span class="line">    filemenu = Menu(menubar, tearoff=<span class="number">0</span>)</span><br><span class="line">    menubar.add_cascade(label=<span class="string">&quot;File&quot;</span>, menu=filemenu)</span><br><span class="line">    filemenu.add_command(label=<span class="string">&quot;Open&quot;</span>, command=open_current)</span><br><span class="line">    filemenu.add_separator()</span><br><span class="line">    filemenu.add_command(label=<span class="string">&quot;Exit&quot;</span>, command=root.destroy)</span><br><span class="line">    helpmenu = Menu(menubar, tearoff=<span class="number">0</span>)</span><br><span class="line">    helpmenu.add_command(label=<span class="string">&quot;About me&quot;</span>, command=show_myinfo)</span><br><span class="line">    menubar.add_cascade(label=<span class="string">&quot;Help&quot;</span>, menu=helpmenu)</span><br><span class="line">    root.config(menu=menubar)</span><br><span class="line">    text_label = Label(root, textvariable=var).pack()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    root = tk.Tk()</span><br><span class="line">    image = Image.<span class="built_in">open</span>(<span class="string">&quot;OIP-C.gif&quot;</span>)</span><br><span class="line">    image = image.resize((<span class="number">200</span>, <span class="number">200</span>))</span><br><span class="line">    <span class="comment"># info = &quot;爬取信息\n&quot;</span></span><br><span class="line">    image_tk = ImageTk.PhotoImage(image)</span><br><span class="line">    label = tk.Label(root, font=<span class="string">&quot;20&quot;</span>, fg=<span class="string">&quot;blue&quot;</span>, text=<span class="string">&quot;欢迎使用&quot;</span>, image=image_tk, compound=<span class="string">&quot;top&quot;</span>)</span><br><span class="line">    var = StringVar()</span><br><span class="line">    set_window()</span><br><span class="line">    pb = Progressbar(root, mode=<span class="string">&quot;indeterminate&quot;</span>, length=<span class="number">200</span>, name=<span class="string">&quot;进度&quot;</span>)</span><br><span class="line">    pb[<span class="string">&quot;value&quot;</span>] = <span class="number">0</span></span><br><span class="line">    pb[<span class="string">&quot;maximum&quot;</span>] = <span class="number">100</span></span><br><span class="line">    pb.pack()</span><br><span class="line">    app = Application(root)</span><br><span class="line">    info_image = Image.<span class="built_in">open</span>(<span class="string">&quot;info.png&quot;</span>)</span><br><span class="line">    info_image = info_image.resize((<span class="number">200</span>, <span class="number">200</span>))</span><br><span class="line">    info_tk_image = ImageTk.PhotoImage(info_image)</span><br><span class="line">    <span class="comment"># msg_var = StringVar()</span></span><br><span class="line">    <span class="comment"># msg = Message(root, textvariable=msg_var, relief=&quot;raised&quot;)</span></span><br><span class="line">    <span class="comment"># msg.pack(padx=10, pady=10)</span></span><br><span class="line">    <span class="comment"># msg_var.set(info)</span></span><br><span class="line">    <span class="comment">#  待滚轮的text</span></span><br><span class="line">    yscrollbar = Scrollbar(root)</span><br><span class="line">    text = Text(root)</span><br><span class="line">    yscrollbar.pack(side=RIGHT, fill=Y)</span><br><span class="line">    text.pack()</span><br><span class="line">    yscrollbar.config(command=text.yview)</span><br><span class="line">    text.config(yscrollcommand=yscrollbar.<span class="built_in">set</span>)</span><br><span class="line">    app.mainloop()</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img data-src="http://cdn.sekyoro.top/imgs/093022.png" alt="image-20210731231013251"></p><p>最后pyinstaller  -w  -F name.py打包就行了</p><p>大概长这样,看来要多多尝试</p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> spider </tag>
            
            <tag> tkinter </tag>
            
            <tag> GUI </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>数据库认识</title>
      <link href="2021/07/29/%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%A4%E8%AF%86/"/>
      <url>2021/07/29/%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%A4%E8%AF%86/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="数据库认识"><a href="#数据库认识" class="headerlink" title="数据库认识"></a>数据库认识</h1><p>在学习计算机课程时,数据库是必修课.在写软件时数据库也是重要的一环</p><span id="more"></span><h2 id="1-定义"><a href="#1-定义" class="headerlink" title="1.定义"></a>1.定义</h2><p>数据库是“按照数据结构来组织、存储和管理数据的仓库”。是一个长期存储在计算机内的、有组织的、可共享的、统一管理的大量数据的集合。</p><h2 id="RDBMS"><a href="#RDBMS" class="headerlink" title="RDBMS"></a>RDBMS</h2><p>RDBMS 指关系型数据库管理系统，全称 Relational Database Management System。</p><p>RDBMS 是 SQL 的基础，同样也是所有现代数据库系统的基础，比如 MS SQL Server、IBM DB2、Oracle、MySQL 以及 Microsoft Access。</p><p>RDBMS 中的数据存储在被称为表的数据库对象中。</p><p>表是相关的数据项的集合，它由列和行组成。</p><p>SQL（Structured Query Language） 是用于访问和处理数据库的标准的计算机语言。</p><p>SQL 让您可以访问和处理数据库，包括数据插入、查询、更新和删除。</p><p>一个数据库通常包含一个或多个表(TABLE)。每个表有一个名字标识（例如:”Websites”）,表包含带有数据的记录（行）</p><p>数据表（<code>table</code>）简称表，它是数据库最重要的组成部分之一。数据库只是一个框架，表才是实质内容。</p><p>而一个数据库中一般会有多张表，这些各自独立的表通过建立关系被联接起来，才成为可以交叉查阅、一目了然的数据库。</p><p><strong>注意</strong></p><p>虽然 SQL 是一门 ANSI（American National Standards Institute 美国国家标准化组织）标准的计算机语言，但是仍然存在着多种不同版本的 SQL 语言。</p><p>然而，为了与 ANSI 标准相兼容，它们必须以相似的方式共同地来支持一些主要的命令（比如 SELECT、UPDATE、DELETE、INSERT、WHERE 等等）。</p><h2 id="2-直接上手"><a href="#2-直接上手" class="headerlink" title="2.直接上手"></a>2.直接上手</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> databases;<span class="operator">/</span><span class="operator">/</span>查看数据库</span><br><span class="line"><span class="keyword">CREATE</span> DATABASE name;  <span class="operator">/</span><span class="operator">/</span>创建一个数据库</span><br><span class="line">use name;<span class="operator">/</span><span class="operator">/</span>使用一个数据库</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> name</span><br><span class="line">(</span><br><span class="line">    项名 数据类型(数据长度)</span><br><span class="line">)；<span class="operator">/</span><span class="operator">/</span>创建一个表</span><br><span class="line"><span class="keyword">show</span> tables;<span class="operator">/</span><span class="operator">/</span>查看表</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> name;<span class="operator">/</span><span class="operator">/</span>查看表的内容</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> name(项名,...)  <span class="keyword">VALUES</span>(值,...) <span class="operator">/</span><span class="operator">/</span>向表中插入数据</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>在大多数系统中，SQL 语句都是不区分大小写的</p><p>但是由于有保留字,使用大写可以表明保留字</p><p>注意分号,有些可能不需要</p><div class="table-container"><table><thead><tr><th></th><th></th><th></th><th></th></tr></thead><tbody><tr><td>数据类型</td><td>大小(字节)</td><td>用途</td><td>格式</td></tr><tr><td>INT</td><td>4</td><td>整数</td><td></td></tr><tr><td>FLOAT</td><td>4</td><td>单精度浮点数</td><td></td></tr><tr><td>DOUBLE</td><td>8</td><td>双精度浮点数</td><td></td></tr><tr><td>ENUM</td><td>—</td><td>单选,比如性别</td><td>ENUM(‘a’,’b’,’c’)</td></tr><tr><td>SET</td><td>—</td><td>多选</td><td>SET(‘1’,’2’,’3’)</td></tr><tr><td>DATE</td><td>3</td><td>日期</td><td>YYYY-MM-DD</td></tr><tr><td>TIME</td><td>3</td><td>时间点或持续时间</td><td>HH:MM:SS</td></tr><tr><td>YEAR</td><td>1</td><td>年份值</td><td>YYYY</td></tr><tr><td>CHAR</td><td>0~255</td><td>定长字符串</td><td></td></tr><tr><td>VARCHAR</td><td>0~255</td><td>变长字符串</td><td></td></tr><tr><td>TEXT</td><td>0~65535</td><td>长文本数据</td></tr></tbody></table></div><h2 id="2-MySQL的约束"><a href="#2-MySQL的约束" class="headerlink" title="2.MySQL的约束"></a>2.MySQL的约束</h2><p>约束是一种限制，它通过对表的行或列的数据做出限制，来确保表的数据的完整性、唯一性。</p><div class="table-container"><table><thead><tr><th>约束类型：</th><th>主键</th><th>默认值</th><th>唯一</th><th>外键</th><th>非空</th></tr></thead><tbody><tr><td>关键字：</td><td>PRIMARY KEY</td><td>DEFAULT</td><td>UNIQUE</td><td>FOREIGN KEY</td><td>NOT NULL</td></tr></tbody></table></div><p>主键（PRIMARY KEY）作为数据表中一行数据的唯一标识符，在一张表中通过主键就能准确定位到某一行数据，因此主键十分重要，它不能有重复记录且不能为空</p><p>默认值约束 (DEFAULT) 规定，当有 DEFAULT 约束的列，插入数据为空时，将使用默认值。</p><p>唯一约束 (UNIQUE) 比较简单，它规定一张表中指定的一列的值必须不能有重复值，即这一列每个值都是唯一的。</p><p>外键 (FOREIGN KEY) 既能确保数据完整性，也能表现表之间的关系。</p><p>一个表可以有多个外键，每个外键必须 REFERENCES (参考) 另一个表的主键，被外键约束的列，取值必须在它参考的列中有对应值。</p><p>非空约束 (NOT NULL),听名字就能理解，被非空约束的列，在插入值时必须非空。</p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      
        <tags>
            
            <tag> database </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Scrapy代理设置</title>
      <link href="2021/07/29/Scrapy%E4%BB%A3%E7%90%86%E8%AE%BE%E7%BD%AE/"/>
      <url>2021/07/29/Scrapy%E4%BB%A3%E7%90%86%E8%AE%BE%E7%BD%AE/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="Scapy代理设置-爬取代理实战"><a href="#Scapy代理设置-爬取代理实战" class="headerlink" title="Scapy代理设置__爬取代理实战"></a>Scapy代理设置__爬取代理实战</h1><p>设置代理可以避免爬虫频繁爬取被封</p><p>付费代理就不用说了,我这里爬取免费代理</p><span id="more"></span><p>Scrapy代理使用HttpProxyMiddlewar中间件（默认开启）</p><p><strong>在Scrapy中设置代理本质是将代理服务器的url写入request.meta[‘proxy’]</strong></p><p>如果代理需要身份验证,需要通过HTTP头部的Proxy-Authorization字段传递用户账号和密码的身份验证信息</p><h2 id="实战"><a href="#实战" class="headerlink" title="实战"></a>实战</h2><p>接下来进行实战</p><p>xicidaili貌似没了</p><p>我用的 <a href="https://www.kuaidaili.com/free/">国内高匿免费HTTP代理IP - 快代理 (kuaidaili.com)</a></p><p>一上来三连鞭</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">scrapy startproject proxy;</span><br><span class="line">cd proxy;</span><br><span class="line">scrapy genspider kuaidaili kuaidaili.com;</span><br></pre></td></tr></table></figure><p>然后直接开爬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> scrapy</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">KuaidailiSpider</span>(<span class="params">scrapy.Spider</span>):</span></span><br><span class="line">    name = <span class="string">&#x27;kuaidaili&#x27;</span></span><br><span class="line">    allowed_domains = [<span class="string">&#x27;kuaidaili.com&#x27;</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># start_urls = [&#x27;http://kuaidaili.com/free/inha&#x27;]</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">start_requests</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">4</span>):</span><br><span class="line">            <span class="keyword">yield</span> scrapy.Request(<span class="string">&quot;https://www.kuaidaili.com/free/inha/%s/&quot;</span> % i)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">parse</span>(<span class="params">self, response</span>):</span></span><br><span class="line">        <span class="keyword">for</span> sel <span class="keyword">in</span> response.xpath(<span class="string">&quot;//tbody//tr&quot;</span>):</span><br><span class="line">            ip = sel.xpath(<span class="string">&quot;.//td[1]/text()&quot;</span>).extract_first()</span><br><span class="line">            port = sel.xpath(<span class="string">&quot;.//td[2]/text()&quot;</span>).extract_first()</span><br><span class="line">            scheme = sel.xpath(<span class="string">&quot;.//td[4]/text()&quot;</span>).extract_first().lower()</span><br><span class="line">            <span class="comment"># 使用爬取的代理验证</span></span><br><span class="line">            url = <span class="string">&quot;%s://httpbin.org/ip&quot;</span> % scheme</span><br><span class="line">            proxy = <span class="string">&quot;%s://%s:%s&quot;</span> % (scheme, ip, port)</span><br><span class="line">            meta = &#123;</span><br><span class="line">                <span class="string">&#x27;proxy&#x27;</span>: proxy,</span><br><span class="line">                <span class="string">&#x27;dont_retry&#x27;</span>: <span class="literal">True</span>,</span><br><span class="line">                <span class="string">&#x27;download_timeout&#x27;</span>: <span class="number">10</span>,</span><br><span class="line">                <span class="comment"># 以下两个字段用于检验</span></span><br><span class="line">                <span class="string">&#x27;_proxy_scheme&#x27;</span>: scheme,</span><br><span class="line">                <span class="string">&#x27;_proxy_ip&#x27;</span>: ip</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">yield</span> scrapy.Request(url, callback=self.check_available, meta=meta, dont_filter=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">check_available</span>(<span class="params">self, response</span>):</span></span><br><span class="line">        proxy_ip = response.meta[<span class="string">&#x27;_proxy_ip_&#x27;</span>]</span><br><span class="line">        <span class="keyword">if</span> proxy_ip == json.loads(response.text)[<span class="string">&#x27;origin&#x27;</span>]:</span><br><span class="line">            <span class="keyword">yield</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&#x27;proxy_scheme&#x27;</span>: response.meta[<span class="string">&#x27;_proxy_scheme&#x27;</span>],</span><br><span class="line">                <span class="string">&#x27;proxy&#x27;</span>: response.meta[<span class="string">&#x27;proxy&#x27;</span>]</span><br><span class="line">            &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>settings.py改一下设置</p><p>我尝试后发现直接503</p><p>还没有得到解决…</p><h2 id="再次尝试"><a href="#再次尝试" class="headerlink" title="再次尝试"></a>再次尝试</h2><p>于是我更换了网站,换了个墙外的</p><p><a href="http://proxy-list.org/english/index.php?p=1">1 minute ago checked proxy servers - Free proxy list service since 2004 year! Almost 10 years of proxy service (proxy-list.org)</a></p><p>这个尝试了一下  貌似是动态网站 我懒</p><p>所以又换了一个</p><p><a href="https://free-proxy-list.net/">Free Proxy List - Just Checked Proxy List (free-proxy-list.net)</a></p><p>这个可以</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> scrapy</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FreeScrapySpider</span>(<span class="params">scrapy.Spider</span>):</span></span><br><span class="line">    name = <span class="string">&#x27;free_proxy&#x27;</span></span><br><span class="line">    allowed_domains = [<span class="string">&#x27;free-proxy-list.net&#x27;</span>]</span><br><span class="line"></span><br><span class="line">    start_urls = [<span class="string">&quot;https://free-proxy-list.net/&quot;</span>]</span><br><span class="line">    <span class="comment"># def start_requests(self):</span></span><br><span class="line">    <span class="comment">#     for i in range(1, 4):</span></span><br><span class="line">    <span class="comment">#         yield scrapy.Request(&quot;http://proxy-list.org/english/index.php?p=%s&quot; % i)</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">parse</span>(<span class="params">self, response</span>):</span></span><br><span class="line">        <span class="keyword">for</span> sel <span class="keyword">in</span> response.xpath(<span class="string">&quot;//tbody//tr&quot;</span>):</span><br><span class="line">            ip = sel.xpath(<span class="string">&quot;./td[1]/text()&quot;</span>).extract_first()</span><br><span class="line">            port = sel.xpath(<span class="string">&quot;./td[2]/text()&quot;</span>).extract_first()</span><br><span class="line">            scheme = sel.xpath(<span class="string">&quot;./td[7]/text()&quot;</span>).extract_first()</span><br><span class="line">            <span class="keyword">if</span> scheme == <span class="string">&#x27;yes&#x27;</span>:</span><br><span class="line">                scheme = <span class="string">&#x27;https&#x27;</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                scheme = <span class="string">&#x27;http&#x27;</span></span><br><span class="line">            url = <span class="string">&quot;%s://httpbin.org/ip&quot;</span> % scheme</span><br><span class="line">            proxy = <span class="string">&quot;%s://%s:%s&quot;</span> % (scheme, ip,port)</span><br><span class="line">        <span class="comment"># ip = ip_port.split(&quot;:&quot;)[0]</span></span><br><span class="line">            meta = &#123;</span><br><span class="line">                <span class="string">&#x27;proxy&#x27;</span>: proxy,</span><br><span class="line">                <span class="string">&#x27;download_timeout&#x27;</span>: <span class="number">10</span>,</span><br><span class="line">                <span class="string">&#x27;dont_retry&#x27;</span>: <span class="literal">True</span>,</span><br><span class="line"></span><br><span class="line">                <span class="string">&#x27;_proxy_scheme&#x27;</span>: scheme,</span><br><span class="line">                <span class="string">&#x27;_proxy_ip&#x27;</span>: ip</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">yield</span> scrapy.Request(url, callback=self.check_available, meta=meta, dont_filter=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">check_available</span>(<span class="params">self, response</span>):</span></span><br><span class="line">        proxy_ip = response.meta[<span class="string">&#x27;_proxy_ip&#x27;</span>]</span><br><span class="line">        <span class="keyword">if</span> proxy_ip == json.loads(response.text)[<span class="string">&#x27;origin&#x27;</span>]:</span><br><span class="line">            <span class="keyword">yield</span> &#123;</span><br><span class="line">                <span class="string">&#x27;proxy_scheme&#x27;</span>: response.meta[<span class="string">&#x27;_proxy_scheme&#x27;</span>],</span><br><span class="line">                <span class="string">&#x27;proxy&#x27;</span>: response.meta[<span class="string">&#x27;proxy&#x27;</span>]</span><br><span class="line">            &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>然后实现随机代理</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RandomHttpProxyMiddleware</span>(<span class="params">HttpProxyMiddleware</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,auth_encoding=<span class="string">&#x27;latin-1&#x27;</span>,proxy_list_file=<span class="literal">None</span></span>):</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> proxy_list_file:</span><br><span class="line">            <span class="keyword">raise</span> scrapy.exceptions.NotConfigured</span><br><span class="line">        self.auth_encoding = auth_encoding</span><br><span class="line">        self.proxies = defaultdict(<span class="built_in">list</span>)</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(proxy_list_file) <span class="keyword">as</span> f:</span><br><span class="line">            proxy_list = json.load(f)</span><br><span class="line">            <span class="keyword">for</span> proxy <span class="keyword">in</span> proxy_list:</span><br><span class="line">                scheme = proxy[<span class="string">&#x27;proxy_scheme&#x27;</span>]</span><br><span class="line">                url = proxy[<span class="string">&#x27;proxy&#x27;</span>]</span><br><span class="line">                self.proxies[scheme].append(self._get_proxy(url,scheme))</span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">from_crawler</span>(<span class="params">cls, crawler</span>):</span></span><br><span class="line">        auth_encoding = crawler.settings.get(<span class="string">&#x27;HTTPPROXY_AUTH_ENCODING&#x27;</span>,<span class="string">&#x27;latin-1&#x27;</span>)</span><br><span class="line">        proxy_list_file = crawler.settings.get(<span class="string">&quot;HTTPPROXY_PROXY_LIST_FILE&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> cls(auth_encoding,proxy_list_file)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_set_proxy</span>(<span class="params">self, request, scheme</span>):</span></span><br><span class="line">        creds,proxy = random.choice(self.proxies[scheme])</span><br><span class="line">        request.meta[<span class="string">&#x27;proxy&#x27;</span>] = proxy</span><br><span class="line">        <span class="keyword">if</span> creds:</span><br><span class="line">            request.headers[<span class="string">&quot;Proxy-Authorization&quot;</span>]=<span class="string">b&#x27;Basic&#x27;</span>+creds</span><br></pre></td></tr></table></figure><p>并在settings.py里更改</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">DOWNLOADER_MIDDLEWARES = &#123;</span><br><span class="line"><span class="comment">#    &#x27;free_proxy.middlewares.FreeProxyDownloaderMiddleware&#x27;: 543,</span></span><br><span class="line">    <span class="string">&#x27;free_proxy.middlewares.RandomHttpProxyMiddleware&#x27;</span>:<span class="number">745</span></span><br><span class="line">&#125;</span><br><span class="line">HTTPPROXY_PROXY_LIST_FILE = <span class="string">&#x27;proxy_list_json&#x27;</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> scrapy</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HubSpider</span>(<span class="params">scrapy.Spider</span>):</span></span><br><span class="line">    name = <span class="string">&#x27;test&#x27;</span></span><br><span class="line">    allowed_domains = [<span class="string">&#x27;httpbin.org&#x27;</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># start_urls = [&#x27;http://httpbin.org/ip&#x27;]</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">start_requests</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">            <span class="keyword">yield</span> scrapy.Request(<span class="string">&#x27;http://httpbin.org/ip&#x27;</span>, dont_filter=<span class="literal">True</span>)</span><br><span class="line">            <span class="keyword">yield</span> scrapy.Request(<span class="string">&#x27;https://httpbin.org/ip&#x27;</span>, dont_filter=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">parse</span>(<span class="params">self, response</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(json.loads(response.text))</span><br><span class="line">        <span class="keyword">yield</span> &#123;</span><br><span class="line">            <span class="string">&#x27;proxy&#x27;</span>:json.loads(response.text)[<span class="string">&#x27;origin&#x27;</span>]</span><br><span class="line">        &#125;</span><br><span class="line">       <span class="comment"># 写一个测试程序</span></span><br></pre></td></tr></table></figure><p>可以看到得到的代理是设置的代理</p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> spider </tag>
            
            <tag> Scrapy </tag>
            
            <tag> proxy </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Scapy_动态网页爬取</title>
      <link href="2021/07/21/Scrapy-%E5%8A%A8%E6%80%81%E7%BD%91%E9%A1%B5%E7%88%AC%E5%8F%96/"/>
      <url>2021/07/21/Scrapy-%E5%8A%A8%E6%80%81%E7%BD%91%E9%A1%B5%E7%88%AC%E5%8F%96/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="Scrapy之动态网页爬取"><a href="#Scrapy之动态网页爬取" class="headerlink" title="Scrapy之动态网页爬取"></a>Scrapy之动态网页爬取</h1><p>动态网页通过JavaScript与html交互</p><p>可以通过Splash渲染引擎爬取</p><span id="more"></span><h2 id="1-下载Splash"><a href="#1-下载Splash" class="headerlink" title="1.下载Splash"></a>1.下载Splash</h2><p>使用Docker安装</p><p>注意,如果你是windows家庭版则安装方式不同</p><p>可以参考<a href="https://blog.csdn.net/cherish152/article/details/103824034">Scrapy-Splash的安装(windows篇)</a></p><p>由于我是教育版，直接安装docker for desktop 就行</p><p><a href="https://www.docker.com/products/docker-desktop">Docker Desktop for Mac and Windows | Docker</a></p><p><img data-src="http://cdn.sekyoro.top/imgs/065642.png" alt="image-20210721143756897"></p><p><a href="https://www.runoob.com/docker/docker-tutorial.html">Docker 教程 | 菜鸟教程 (runoob.com)</a></p><p>网上教程有点乱,我看这个还挺好的</p><p>下载Desktop重启后可能会提示WSL2更新,直接在相关网站更新就行了</p><p><a href="https://docs.microsoft.com/zh-cn/windows/wsl/install-win10">在 Windows 10 上安装 WSL | Microsoft Docs</a></p><p>安装好后可以在power shell里运行</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p <span class="number">8050</span>:<span class="number">8050</span> scrapinghub/splash</span><br></pre></td></tr></table></figure><p>应该会跳出一个页面(可能时间比较长)</p><p><a href="https://www.cnblogs.com/pzk7788/p/10551338.html#:~:text=Splash 说白了就是一个轻量级的浏览器，利用它，我们同样可以实现跟其他浏览器一样的操作，我们使用 Docker 来安装 Splash：. [root%40localhost ~]%23 docker,安装好之后，可以通过 http%3A%2F%2Flocalhost%3A8050 访问其 Web 界面，如下，我们可以通过输入 https%3A%2F%2Fwww.baidu.com%2F，然后点击 Render me！.">Splash 简介与安装 - 孔雀东南飞 - 博客园 (cnblogs.com)</a></p><p>可以看看这篇博客</p><p>然后 下载scrapy-splash 一个python库操作splash的</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install scrapy-splash</span><br></pre></td></tr></table></figure><p><a href="https://splash.readthedocs.io/en/stable/">Splash - A javascript rendering service — Splash 3.5 documentation</a></p><p>splash的文档</p><p>服务端点</p><p>render.html 提供JavaScript页面渲染服务</p><p>url参数为要渲染的网址</p><p>execute  执行用户自定义的渲染脚本(lua),在页面中执行JavaScript代码</p><p>请求方式post lua_source 用户自定义的脚本</p><h2 id="实战"><a href="#实战" class="headerlink" title="实战"></a>实战</h2><p>下载了scrapy-splash后配置settings.py文件</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> scrapy.downloadermiddlewares.httpcompression</span><br><span class="line"><span class="keyword">import</span> scrapy_splash</span><br><span class="line">BOT_NAME = <span class="string">&#x27;splash_example&#x27;</span></span><br><span class="line"></span><br><span class="line">SPIDER_MODULES = [<span class="string">&#x27;splash_example.spiders&#x27;</span>]</span><br><span class="line">NEWSPIDER_MODULE = <span class="string">&#x27;splash_example.spiders&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Crawl responsibly by identifying yourself (and your website) on the user-agent</span></span><br><span class="line">USER_AGENT = <span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/92.0.4515.107 Safari/537.36 Edg/92.0.902.55&#x27;</span></span><br><span class="line">ROBOTSTXT_OBEY = <span class="literal">False</span></span><br><span class="line">DOWNLOAD_DELAY = <span class="number">0.5</span></span><br><span class="line">SPIDER_MIDDLEWARES = &#123;</span><br><span class="line"><span class="comment">#    &#x27;splash_example.middlewares.SplashExampleSpiderMiddleware&#x27;: 543,</span></span><br><span class="line">   <span class="string">&#x27;scrapy_splash.SplashDeduplicateArgsMiddleware&#x27;</span>:<span class="number">100</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">DOWNLOADER_MIDDLEWARES = &#123;</span><br><span class="line"><span class="comment">#    &#x27;splash_example.middlewares.SplashExampleDownloaderMiddleware&#x27;: 543,</span></span><br><span class="line">    <span class="string">&#x27;scrapy_splash.SplashCookiesMiddleware&#x27;</span>:<span class="number">732</span>,</span><br><span class="line">    <span class="string">&#x27;scrapy_splash.SplashMiddleware&#x27;</span>:<span class="number">725</span>,</span><br><span class="line">    <span class="string">&#x27;scrapy.downloadermiddlewares.httpcompression.HttpCompressionMiddleware&#x27;</span>:<span class="number">810</span></span><br><span class="line">    &#125;</span><br><span class="line">DUPEFILTER_CLASS = <span class="string">&#x27;scrapy_splash.SplashAwareDupeFilter&#x27;</span></span><br><span class="line"></span><br><span class="line">SPLASH_URL = <span class="string">&quot;http://localhost:8050&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>使用splashRequest()请求即可</p><p>url,args,cache_args</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> scrapy</span><br><span class="line"><span class="keyword">import</span> scrapy_splash</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">QuotesSpider</span>(<span class="params">scrapy.Spider</span>):</span></span><br><span class="line">    name = <span class="string">&#x27;quotes&#x27;</span></span><br><span class="line">    allowed_domains = [<span class="string">&#x27;quotes.toscrape.com&#x27;</span>]</span><br><span class="line">    start_urls = [<span class="string">&#x27;http://quotes.toscrape.com/js/&#x27;</span>]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">start_requests</span>(<span class="params">self</span>):</span></span><br><span class="line">        args = &#123;&#125;</span><br><span class="line">        <span class="keyword">for</span> url <span class="keyword">in</span> self.start_urls:</span><br><span class="line">            <span class="keyword">yield</span> scrapy_splash.SplashRequest(url)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">parse</span>(<span class="params">self, response</span>):</span></span><br><span class="line">        <span class="keyword">for</span> sel <span class="keyword">in</span> response.xpath(<span class="string">&quot;//div[@class=&#x27;quote&#x27;]&quot;</span>):</span><br><span class="line">            quote = sel.xpath(<span class="string">&quot;./span[1]/text()&quot;</span>).extract_first()</span><br><span class="line">            author = sel.xpath(<span class="string">&quot;string(./span[2])&quot;</span>).extract_first()</span><br><span class="line">            <span class="keyword">yield</span> &#123;</span><br><span class="line">                <span class="string">&#x27;quote&#x27;</span>:quote,</span><br><span class="line">                <span class="string">&#x27;author&#x27;</span>:author</span><br><span class="line">            &#125;</span><br><span class="line">        href = response.xpath(<span class="string">&quot;//li[@class=&#x27;next&#x27;]/a/@href&quot;</span>).extract_first()</span><br><span class="line">        <span class="keyword">if</span> href:</span><br><span class="line">            url = response.urljoin(href)</span><br><span class="line">            <span class="keyword">yield</span> scrapy_splash.SplashRequest(url)</span><br></pre></td></tr></table></figure><p>当然要打开docker的splash</p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> spider </tag>
            
            <tag> Scrapy </tag>
            
            <tag> splash </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>疫情打卡</title>
      <link href="2021/07/21/%E7%96%AB%E6%83%85%E6%89%93%E5%8D%A1/"/>
      <url>2021/07/21/%E7%96%AB%E6%83%85%E6%89%93%E5%8D%A1/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="Python爬虫实战-疫情打卡"><a href="#Python爬虫实战-疫情打卡" class="headerlink" title="Python爬虫实战_疫情打卡"></a>Python爬虫实战_疫情打卡</h1><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>python这个语言易学简单,也可以利用其丰富的库写点东西.</p><p>所以我打算写个爬虫打卡(其实之前早就写过,不过已经忘干净了)</p><p>大概流程是 requests+selenium再加个图形界面tkinter或者pyqt</p><p>本来打算只使用requests get和post直接打卡的,试了很久都卡在原页面.</p><p>希望会的朋友留言帮帮忙.另外我试了试selenium的getcookie也未能成功</p><span id="more"></span><h2 id="1-html解析"><a href="#1-html解析" class="headerlink" title="1.html解析"></a>1.html解析</h2><p>使用requests</p><p><a href="https://docs.python-requests.org/zh_CN/latest/index.html">Requests介绍</a></p><h2 id="2-selenium"><a href="#2-selenium" class="headerlink" title="2.selenium"></a>2.selenium</h2><p><a href="https://python-selenium-zh.readthedocs.io/zh_CN/latest/">selenium-python中文文档 (python-selenium-zh.readthedocs.io)</a></p><p>使用selenium自动化</p><p>例子</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.keys <span class="keyword">import</span> Keys</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.chrome.options <span class="keyword">import</span> Options</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># option = Options()</span></span><br><span class="line"><span class="comment"># option.add_argument(&quot;--headless&quot;)</span></span><br><span class="line">driver = webdriver.Chrome()</span><br><span class="line"></span><br><span class="line">login_url = <span class="string">&quot;http://yqtb.nwpu.edu.cn/wx/xg/yz-mobile/index.jsp&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 读取cookie</span></span><br><span class="line">driver.get(login_url)</span><br><span class="line"><span class="comment"># print(driver.get_cookies())</span></span><br><span class="line"><span class="comment"># print(driver.get_cookie(&#x27;domain&#x27;))</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;campus_Cookie.txt&#x27;</span>, <span class="string">&#x27;r+&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        listCookies = json.loads(f.read())</span><br><span class="line">        <span class="keyword">for</span> cookie <span class="keyword">in</span> listCookies:</span><br><span class="line">            driver.add_cookie(&#123;</span><br><span class="line">               <span class="comment"># &quot;domain&quot;: cookie[&#x27;domain&#x27;],</span></span><br><span class="line">                <span class="string">&quot;httpOnly&quot;</span>: cookie[<span class="string">&quot;httpOnly&quot;</span>],</span><br><span class="line">                <span class="string">&quot;name&quot;</span>: cookie[<span class="string">&quot;name&quot;</span>],</span><br><span class="line">                <span class="string">&quot;path&quot;</span>: cookie[<span class="string">&#x27;path&#x27;</span>],</span><br><span class="line">                <span class="string">&quot;secure&quot;</span>: cookie[<span class="string">&#x27;secure&#x27;</span>],</span><br><span class="line">                <span class="string">&quot;value&quot;</span>: cookie[<span class="string">&quot;value&quot;</span>]</span><br><span class="line">            &#125;</span><br><span class="line">            )</span><br><span class="line">    <span class="keyword">except</span> json.decoder.JSONDecodeError:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;空的cookie文件&#x27;</span>)</span><br><span class="line">driver.get(login_url)</span><br><span class="line">driver.refresh()</span><br><span class="line"><span class="comment"># 登陆</span></span><br><span class="line"></span><br><span class="line">time.sleep(<span class="number">2</span>)</span><br><span class="line">name = driver.find_element_by_id(<span class="string">&#x27;username&#x27;</span>)</span><br><span class="line">name.send_keys(<span class="built_in">input</span>(<span class="string">&quot;输入学号:\n&quot;</span>))</span><br><span class="line">password = driver.find_element_by_id(<span class="string">&#x27;password&#x27;</span>)</span><br><span class="line">password.send_keys(<span class="built_in">input</span>(<span class="string">&quot;输入密码:\n&quot;</span>))</span><br><span class="line">password.send_keys(Keys.RETURN)</span><br><span class="line"><span class="keyword">while</span> <span class="string">&#x27;西北工业大学 | 统一身份认证 | 登录&#x27;</span> <span class="keyword">in</span> driver.page_source:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;密码错误\n请再次输入\n&quot;</span>)</span><br><span class="line">    name = driver.find_element_by_id(<span class="string">&#x27;username&#x27;</span>)</span><br><span class="line">    name.clear()</span><br><span class="line">    name.send_keys(<span class="built_in">input</span>(<span class="string">&quot;输入学号:\n&quot;</span>))</span><br><span class="line">    password = driver.find_element_by_id(<span class="string">&#x27;password&#x27;</span>)</span><br><span class="line">    password.clear()</span><br><span class="line">    password.send_keys(<span class="built_in">input</span>(<span class="string">&quot;输入密码:\n&quot;</span>))</span><br><span class="line">    password.send_keys(Keys.RETURN)</span><br><span class="line"><span class="comment"># 保存cookie</span></span><br><span class="line">cookie = driver.get_cookies()</span><br><span class="line">jsonCookies = json.dumps(cookie)</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;campus_Cookie.txt&#x27;</span>, <span class="string">&#x27;w+&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(jsonCookies)</span><br><span class="line"></span><br><span class="line"><span class="comment">#填报</span></span><br><span class="line">fill_form = driver.find_element_by_class_name(<span class="string">&#x27;icon-shangbao1&#x27;</span>).click()</span><br><span class="line"></span><br><span class="line"><span class="comment">#提交</span></span><br><span class="line"></span><br><span class="line">submit = driver.find_element_by_link_text(<span class="string">&#x27;提交填报信息&#x27;</span>).click()</span><br><span class="line"></span><br><span class="line">submit = driver.find_element_by_xpath(<span class="string">&#x27;//*[@id=&quot;qrxx_div&quot;]/div[2]/div[25]/label/div[1]/i&#x27;</span>).click()</span><br><span class="line"></span><br><span class="line"><span class="comment">#保存</span></span><br><span class="line">save = driver.find_element_by_id(<span class="string">&#x27;save_div&#x27;</span>).click()</span><br><span class="line"></span><br><span class="line"><span class="comment">#保存cookie</span></span><br><span class="line">driver.close()</span><br><span class="line"></span><br><span class="line"><span class="comment"># driver.window_handles()</span></span><br><span class="line"><span class="comment"># def log_in():</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>cookie功能没法用,有知道的朋友麻烦留言告诉我一下</p><p>这个cookie怎么添加之后进入打卡页面</p><h2 id="3-图形界面-其实这并不重要"><a href="#3-图形界面-其实这并不重要" class="headerlink" title="3.图形界面(其实这并不重要)"></a>3.图形界面(其实这并不重要)</h2><p>鉴于PyQt的上手难度,我用的tkinter(python自带的)</p><p>推荐一本学tkinter的书,《Python GUI设计:tkinter菜鸟编程》台湾人写的,大概一周能好好看完(有基础两三天就行)</p><h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><p>之前写过一个打卡的程序 </p><p>但是用的chromedriver版本低了(主要是浏览器升级得太快),我以为就没法用了</p><p>但是只要新下载一个版本得driver就行了</p><p>网上还有自动下载的代码。不过我懒得在这上面花时间了</p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      
        <tags>
            
            <tag> spider </tag>
            
            <tag> python </tag>
            
            <tag> sign in </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Scrapy 下载图片 文件</title>
      <link href="2021/07/20/Scrapy-%E4%B8%8B%E8%BD%BD%E5%9B%BE%E7%89%87-%E6%96%87%E4%BB%B6/"/>
      <url>2021/07/20/Scrapy-%E4%B8%8B%E8%BD%BD%E5%9B%BE%E7%89%87-%E6%96%87%E4%BB%B6/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="Scrapy-下载图片-文件"><a href="#Scrapy-下载图片-文件" class="headerlink" title="Scrapy 下载图片 文件"></a>Scrapy 下载图片 文件</h1><h2 id="1-前言"><a href="#1-前言" class="headerlink" title="1.前言"></a>1.前言</h2><p>Scrapy可以说是一辆大车,我们并不需要注重个别的零件(代码),而是注重部件之间的联系。学会使用这个框架,可以说方便又快捷</p><span id="more"></span><p><img data-src="http://cdn.sekyoro.top/imgs/092919.png" alt="image-20210719172051258"></p><p><a href="https://www.runoob.com/w3cnote/scrapy-detail.html">Scrapy 入门教程 </a></p><p>入门可以看看,也有相关书籍和官方文档(不过貌似中文文档很久没更新了)</p><p>知道了基本的操作,就可以直接上手了</p><p>如果有爬虫经验的话,一天上手完全没问题</p><p><strong>一个范例项目</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> scrapy</span><br><span class="line"><span class="keyword">from</span> scrapy.linkextractors <span class="keyword">import</span> LinkExtractor</span><br><span class="line"><span class="keyword">from</span> ..items <span class="keyword">import</span> ToscrapeBookItem</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BooksSpider</span>(<span class="params">scrapy.Spider</span>):</span></span><br><span class="line">    name = <span class="string">&#x27;books&#x27;</span></span><br><span class="line">    allowed_domains = [<span class="string">&#x27;books.toscrape.com&#x27;</span>]</span><br><span class="line">    start_urls = [<span class="string">&#x27;http://books.toscrape.com/&#x27;</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 书籍列表页面解析</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">parse</span>(<span class="params">self, response</span>):</span></span><br><span class="line">        <span class="comment"># 提取书籍列表页面中每本书的链接</span></span><br><span class="line">        le = LinkExtractor(restrict_xpaths=<span class="string">&#x27;//div[@class=&quot;image_container&quot;]&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> link <span class="keyword">in</span> le.extract_links(response):</span><br><span class="line">            <span class="keyword">yield</span> scrapy.Request(link.url, callback=self.book_parse)</span><br><span class="line">        <span class="comment"># 提取下一页的链接</span></span><br><span class="line">        <span class="comment"># le = LinkExtractor(restrict_xpaths=&#x27;//li[@class=&quot;next&quot;]&#x27;)</span></span><br><span class="line">        <span class="comment"># links = le.extract_links(response)</span></span><br><span class="line">        <span class="comment"># if links:</span></span><br><span class="line">        <span class="comment">#     next_url = links[0].url</span></span><br><span class="line">        <span class="comment">#     yield scrapy.Request(next_url, callback=self.parse)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 书籍页面信息的解析函数</span></span><br><span class="line">    <span class="comment"># review_rating = scrapy.Field()</span></span><br><span class="line">    <span class="comment"># review_num = scrapy.Field()</span></span><br><span class="line">    <span class="comment"># upc = scrapy.Field()  # 编码</span></span><br><span class="line">    <span class="comment"># stock = scrapy.Field()  # 库存</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">book_parse</span>(<span class="params">self, response</span>):</span></span><br><span class="line">        book = ToscrapeBookItem()</span><br><span class="line">        book[<span class="string">&#x27;name&#x27;</span>] = response.xpath(<span class="string">&quot;//div[contains(@class,&#x27;product_main&#x27;)]//h1/text()&quot;</span>).extract_first()</span><br><span class="line">        book[<span class="string">&#x27;price&#x27;</span>] = response.xpath(<span class="string">&quot;//div[contains(@class,&#x27;product_main&#x27;)]//p/text()&quot;</span>).extract_first()</span><br><span class="line">        book[<span class="string">&#x27;review_rating&#x27;</span>] = response.xpath(<span class="string">&quot;//p[contains(@class,&#x27;star-rating&#x27;)]/@class&quot;</span>).re_first(</span><br><span class="line">            <span class="string">&#x27;star-rating ([a-zA-Z]+)&#x27;</span>)</span><br><span class="line">        book[<span class="string">&#x27;review_num&#x27;</span>] = response.xpath(<span class="string">&quot;//table[contains(@class,&#x27;table&#x27;)]//tr[7]/td/text()&quot;</span>).extract_first()</span><br><span class="line">        book[<span class="string">&#x27;upc&#x27;</span>] = response.xpath(<span class="string">&quot;//table[contains(@class,&#x27;table&#x27;)]//tr[1]/td/text()&quot;</span>).extract_first()</span><br><span class="line">        book[<span class="string">&#x27;stock&#x27;</span>] = response.xpath(<span class="string">&quot;//table[contains(@class,&#x27;table&#x27;)]//tr[6]/td/text()&quot;</span>).re_first(</span><br><span class="line">            <span class="string">&#x27;\((\d+) available\)&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(book)</span><br><span class="line">        <span class="keyword">yield</span> book</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Define your item pipelines here</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Don&#x27;t forget to add your pipeline to the ITEM_PIPELINES setting</span></span><br><span class="line"><span class="comment"># See: https://docs.scrapy.org/en/latest/topics/item-pipeline.html</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># useful for handling different item types with a single interface</span></span><br><span class="line"><span class="keyword">import</span> itemadapter</span><br><span class="line"><span class="keyword">from</span> itemadapter <span class="keyword">import</span> ItemAdapter</span><br><span class="line"><span class="keyword">import</span> openpyxl</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ToscrapeBookPipeline</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.wb = openpyxl.Workbook()</span><br><span class="line">        self.ws = self.wb.active</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_item</span>(<span class="params">self, item, spider</span>):</span></span><br><span class="line">        line = [item[<span class="string">&#x27;name&#x27;</span>], item[<span class="string">&#x27;price&#x27;</span>], item[<span class="string">&#x27;review_rating&#x27;</span>], item[<span class="string">&#x27;review_num&#x27;</span>], item[<span class="string">&#x27;upc&#x27;</span>], item[<span class="string">&#x27;stock&#x27;</span>]]</span><br><span class="line">        self.ws.append(line)</span><br><span class="line">        <span class="keyword">return</span> item</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">close_spider</span>(<span class="params">self, spider</span>):</span></span><br><span class="line">        self.wb.save(<span class="string">&#x27;&#123;&#125;.csv&#x27;</span>.<span class="built_in">format</span>(spider.name))</span><br><span class="line">        self.wb.close()</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Define here the models for your scraped items</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># See documentation in:</span></span><br><span class="line"><span class="comment"># https://docs.scrapy.org/en/latest/topics/items.html</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> scrapy</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ToscrapeBookItem</span>(<span class="params">scrapy.Item</span>):</span></span><br><span class="line">    <span class="comment"># define the fields for your item here like:</span></span><br><span class="line">    <span class="comment"># name = scrapy.Field()</span></span><br><span class="line">    name = scrapy.Field()</span><br><span class="line">    price = scrapy.Field()</span><br><span class="line">    review_rating = scrapy.Field()</span><br><span class="line">    review_num = scrapy.Field()</span><br><span class="line">    upc = scrapy.Field()  <span class="comment">#编码</span></span><br><span class="line">    stock = scrapy.Field()  <span class="comment">#库存</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>注意在setting.py中打开管道以及最好把user-agent写一下</p><p>并改一下延迟</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ITEM_PIPELINES = &#123;</span><br><span class="line">   <span class="string">&#x27;toscrape_book.pipelines.ToscrapeBookPipeline&#x27;</span>: <span class="number">300</span>,</span><br><span class="line">&#125;</span><br><span class="line">DOWNLOAD_DELAY = <span class="number">1</span></span><br><span class="line">ROBOTSTXT_OBEY = <span class="literal">False</span> <span class="comment">#这个要改为False</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="2-下载图片和图片"><a href="#2-下载图片和图片" class="headerlink" title="2.下载图片和图片"></a>2.下载图片和图片</h2><p>接下来就是文件和图片了</p><ol><li>FilePipeline</li><li>ImagePipeline</li></ol><p>利用这两个专门的下载器,我们只用传参就行了,文件会自动下载到本地,并将下载信息存入item的一个字段</p><p>步骤</p><ul><li><p>在配置文件(settings.py)中打开管道并设置下载目录</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ITEM_PIPELINES = &#123;</span><br><span class="line">   <span class="string">&#x27;scrapy.pipelines.files.FilesPipeline&#x27;</span>: <span class="number">1</span>,<span class="comment">#优先度最高</span></span><br><span class="line">&#125;</span><br><span class="line">FILES_STORE<span class="string">&#x27;./project&#x27;</span></span><br></pre></td></tr></table></figure></li><li><p>在Scrapy解析页面时将文件下载链接收集到一个列表</p><p>赋给item的file_urls字段。FilesPipeline在处理item时会读取该项字段并进行下载</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">spider</span>(<span class="params">scrapy.spider</span>):</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">parse</span>(<span class="params">response</span>):</span></span><br><span class="line">        item =&#123;&#125;</span><br><span class="line">        item[<span class="string">&#x27;file_urls&#x27;</span>]=[]</span><br><span class="line">        <span class="keyword">for</span> url <span class="keyword">in</span> response.xpath(<span class="string">&#x27;&#x27;</span>).extract():</span><br><span class="line">            download_url = response.urljoin(url)</span><br><span class="line">            item[<span class="string">&#x27;file_urls&#x27;</span>].append(download_url)</span><br><span class="line">       <span class="keyword">yield</span> item</span><br></pre></td></tr></table></figure><p>当下载完文件后,会将信息收集到item[‘files’],信息包含：1. path(下载到本地路径)2.Checksum(文件校验和)3.url(文件的url)</p><p>以上是FilePipeline的使用</p><p>图片类似</p><p>导入路径 scrapy.pipelines.images.ImagesPipeline</p><p>Item 字段  image_urls images</p><p>下载目录 IMAGES_STORE  </p></li></ul><p>ImagePipeline在File上增加了对图片的处理</p><ul><li>生成缩略图  在settings.py中设置IMAGES_THUMBS(dict)  设置字典的每一项值(缩略图的尺寸)</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">IMAGES_THUMBS = &#123;</span><br><span class="line">   <span class="string">&#x27;small&#x27;</span>:(<span class="number">50</span>,<span class="number">50</span>),</span><br><span class="line">   <span class="string">&#x27;big&#x27;</span>:(<span class="number">270</span>,<span class="number">270</span>),</span><br><span class="line">&#125;<span class="comment">#增加缩略图</span></span><br></pre></td></tr></table></figure><p>开启该功能,下载一张图片会有三张图片</p><ul><li><p>过滤掉尺寸过小的图片</p><p>在配置文件中设置IMAGES_MIN_WIDTH  IMAGES_MIN_HEIGHT </p><p>分别指定图片最小的宽和高</p><p>开启该功能后小于这个尺寸的会忽略</p></li></ul><p>以上资料来源于《精通Scrapy网络爬虫》(刘硕)</p><h2 id="实验"><a href="#实验" class="headerlink" title="实验"></a>实验</h2><p>写一波实战 爬取图片</p><p>网址 <a href="https://gelbooru.com/index.php?page=post&amp;s=list&amp;tags=all">| Gelbooru </a></p><p>(感觉有点危险)</p><h3 id="第一步"><a href="#第一步" class="headerlink" title="第一步"></a>第一步</h3><p>创建项目</p><p><img data-src="http://cdn.sekyoro.top/imgs/092922.png" alt="image-20210720224648989"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">scrapy startprojct name</span><br><span class="line"></span><br><span class="line">cd name</span><br><span class="line"></span><br><span class="line">scrapy genspider name name.com</span><br></pre></td></tr></table></figure><h3 id="第二步"><a href="#第二步" class="headerlink" title="第二步"></a>第二步</h3><p>明确任务   </p><p>爬取每一页的图片所在地址以及下一页地址(使用LinkExtractor) a href</p><p>爬取图片,使用自带的ImagePipiline</p><p>根据之前说的</p><p>开启Image.Pipeline管道   不遵守robot协议  设置下载路径 </p><p><img data-src="http://cdn.sekyoro.top/imgs/092925.png" alt="image-20210720225237812"></p><p>并设置一下user-agent与下载延时</p><p>大概这样</p><p>然后开写</p><p><img data-src="http://cdn.sekyoro.top/imgs/092928.png" alt="image-20210720225423059"></p><p>查看元素(最好 Scrapy shell),可以看到每张图片的链接在<div class='thumbnail-container'>下  很好爬取</p><p><img data-src="http://cdn.sekyoro.top/imgs/092929.png" alt="image-20210720225737447"></p><p>写好item,第一项是要传递的参数,图像的链接供下载</p><p>第二项会返回相关信息</p><p>根据观察发现,其实pid参数与页数相关,每一页42(其实就是图片数)</p><p>所以可以通过改变这个参数发送请求爬取每一页</p><p>如果通过获取每一页的下一页链接,我发现它是这样的,通过LinkExtractor后,因为下一页的href总会与存在的某一页的href相同,貌似会覆盖掉.也就是无法通过le.extract_links(response)[-1]得到最后一项</p><p>所以我最后没有用LinkExtractor(如果哪位朋友知道如何处理麻烦告知)</p><p>直接使用response.xpath获取链接,麻烦的地方就是要将相对地址变为绝对地址</p><p><img data-src="http://cdn.sekyoro.top/imgs/092931.png" alt="image-20210720231310444"></p><p><img data-src="http://cdn.sekyoro.top/imgs/092934.png" alt="image-20210720231944580"></p><p>一个是parse ,用于爬取每一张图片的二级链接(首页链接的图片明显偏小)与下一页链接</p><p>另一个是pic_parse,用与获取图片链接</p><p><img data-src="http://cdn.sekyoro.top/imgs/065121.png" alt="image-20210720232401831"></p><p>观察可知,图片链接在<picture>的src下,可以使用xpath</p><p><img data-src="http://cdn.sekyoro.top/imgs/092937.png" alt="image-20210720233928786"></p><p>这里直接获取链接,注意一定要是列表形式</p><p>我有定了两个字段想用来重命名图片名  可以复写ImagesPipeline使图片名字自定义.但我这里没写。类似下面这样</p><p><img data-src="http://cdn.sekyoro.top/imgs/092940.png" alt="image-20210720233546829"></p><p>最后 scrapy crawl name 运行即可</p><p>注意 我这里没有写停止条件,即会一直爬到最后</p><p>只要写一个控制就行了</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">51</span>):            url = <span class="string">&quot;https://gelbooru.com/index.php?page=post&amp;s=list&amp;tags=all&amp;pid=&#123;&#125;&quot;</span>.<span class="built_in">format</span>(i)            <span class="keyword">yield</span> scrapy.Request(url,callback=self.parse())        <span class="comment">#控制爬取的页数</span></span><br></pre></td></tr></table></figure><p>最后 如果有问题请回复</p><p>我也是才学</p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> spider </tag>
            
            <tag> Scrapy </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>C++与Qt开发入门_1.安装与下载</title>
      <link href="2021/07/08/C++%E4%B8%8EQt%E5%BC%80%E5%8F%91%E5%85%A5%E9%97%A8_1.%E5%AE%89%E8%A3%85%E4%B8%8E%E4%B8%8B%E8%BD%BD/"/>
      <url>2021/07/08/C++%E4%B8%8EQt%E5%BC%80%E5%8F%91%E5%85%A5%E9%97%A8_1.%E5%AE%89%E8%A3%85%E4%B8%8E%E4%B8%8B%E8%BD%BD/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>闲来无事,我玩玩Qt.不过我看网上说这东西有点过时,还提到了Flutter</p><p>不过我已经无所谓了</p><span id="more"></span><p>下载镜像网址</p><p><a href="https://links.jianshu.com/go?to=http%3A%2F%2Fdownload.qt.io%2Farchive%2Fqt%2F">http://download.qt.io/archive/qt/</a></p><p>安装可以参照<a href="https://links.jianshu.com/go?to=http%3A%2F%2Fdownload.qt.io%2Farchive%2Fqt%2F">http://download.qt.io/archive/qt/</a></p><p>我是vs2019+qt5.14</p><p>不过我在下载时遇到几个问题,在这里提出来</p><ol><li>我用了visual studio搭配Qt,所以需要vsaddin这个插件.既可以在那个镜像网址里下载(速度较快),也可以在vs里下载(我试了试,翻墙速度快很多)</li><li>如果用vs的话需要msvc,一般情况用MinGW.UWP是windows平台,这些据情况安装</li><li>如果vscode是2018或以上,qt5.14只有msvc2017,如果没有装msvc2017的话,套件会出现警告,不过影响不大</li></ol><p><img data-src="http://cdn.sekyoro.top/imgs/065124.png" alt="image-20210708205605907"></p><ol><li>关于Qt for desktop,我之前记得应该有这个东西的,现在这版本没找到了。</li></ol><p>当我想打包程序时需要用到windeployqt(<a href="https://blog.csdn.net/my1324/article/details/103270782">Qt5程序打包发布（Windows版）（一）_my1324的博客-CSDN博客_qt打包发布windows</a>),照这个教程不太行</p><p>不过只要把相应编译器下包含windeployqt的文件夹bin设为环境变量path就行</p><p><img data-src="http://cdn.sekyoro.top/imgs/092944.png" alt="image-20210708210707199"></p><p>这样就方便以后打包可执行程序了.</p><p>先入门大概写到这,后面慢慢琢磨</p><p><img data-src="https://i.loli.net/2021/07/08/ClI3Pztemyaxq9H.jpg" alt="5.jpg"></p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> fun </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Qt </tag>
            
            <tag> C++ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>课程资源分享</title>
      <link href="2021/07/08/%E8%AF%BE%E7%A8%8B%E8%B5%84%E6%BA%90%E5%88%86%E4%BA%AB/"/>
      <url>2021/07/08/%E8%AF%BE%E7%A8%8B%E8%B5%84%E6%BA%90%E5%88%86%E4%BA%AB/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>一些课程资料<br>当然,要看具体学校了<br><span id="more"></span></p><p>链接：<a href="https://pan.baidu.com/s/1Ex0OYxdR8Xd_RXza3UAzQA">https://pan.baidu.com/s/1Ex0OYxdR8Xd_RXza3UAzQA</a><br>提取码：0jdd </p><p><img data-src="http://cdn.sekyoro.top/imgs/092946.jpg" alt="图片"></p><p><img data-src="https://i.loli.net/2021/07/08/XZ36z4pGWadBr7k.jpg" alt="Konachan.com - 326372 aqua_eyes bell blue_hair blush breasts flowers ganyu__genshin_impact_ genshin_impact gloves horns leotard long_hair pantyhose piukute062 signed.jpg"></p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> study </category>
          
      </categories>
      
      
        <tags>
            
            <tag> material </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>数据结构noj_3</title>
      <link href="2021/06/12/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84noj-3/"/>
      <url>2021/06/12/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84noj-3/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="数据结构noj-3"><a href="#数据结构noj-3" class="headerlink" title="数据结构noj_3"></a>数据结构noj_3</h1><p>差不多看看就行了</p><span id="more"></span><h2 id="21"><a href="#21" class="headerlink" title="21."></a>21.</h2><p><img data-src="http://cdn.sekyoro.top/imgs/093903.png" alt="image-20210612110800240"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> max 2000</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">Snode</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> tag;   <span class="comment">//标签</span></span><br><span class="line">    <span class="keyword">char</span> elem;</span><br><span class="line">    <span class="keyword">int</span> prio;  <span class="comment">//优先级</span></span><br><span class="line">&#125; Snode; <span class="comment">//字符节点</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">MyString</span>&#123;</span></span><br><span class="line">    Snode data[max];</span><br><span class="line">    <span class="keyword">int</span> length;</span><br><span class="line">&#125;MyString;  <span class="comment">//存储字符串</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">TNode</span>&#123;</span></span><br><span class="line">    Snode data;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">TNode</span> *<span class="title">lchild</span>,*<span class="title">rchild</span>;</span></span><br><span class="line">&#125;TNode,BiTree,*PTNode;   <span class="comment">//二叉树</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Clear</span><span class="params">(MyString *S)</span><span class="comment">//去除外层多余的括号</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> level = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(S-&gt;data[<span class="number">0</span>].elem == <span class="string">&#x27;(&#x27;</span> &amp;&amp; S-&gt;data[S-&gt;length - <span class="number">1</span>].elem == <span class="string">&#x27;)&#x27;</span>)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; S-&gt;length<span class="number">-1</span>;i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(S-&gt;data[i].elem == <span class="string">&#x27;(&#x27;</span>)</span><br><span class="line">            level++;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(S-&gt;data[i].elem == <span class="string">&#x27;)&#x27;</span>)</span><br><span class="line">            level--;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(level == <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; S-&gt;length<span class="number">-1</span>;i++)</span><br><span class="line">        &#123;</span><br><span class="line">            S-&gt;data[i<span class="number">-1</span>] = S-&gt;data[i];</span><br><span class="line">        &#125;</span><br><span class="line">        S-&gt;length = S-&gt;length - <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">InitString</span><span class="params">(MyString *S)</span></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> c[max];</span><br><span class="line">    <span class="keyword">int</span> len,baselevel = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>,c);</span><br><span class="line">    len = <span class="built_in">strlen</span>(c);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; len;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        S-&gt;data[i].elem = c[i];</span><br><span class="line"><span class="keyword">if</span> (c[i] == <span class="string">&#x27;+&#x27;</span> || c[i] == <span class="string">&#x27;-&#x27;</span>)</span><br><span class="line">&#123;</span><br><span class="line">S-&gt;data[i].tag = <span class="number">1</span>;</span><br><span class="line">S-&gt;data[i].prio = baselevel + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (c[i] == <span class="string">&#x27;*&#x27;</span> || c[i] == <span class="string">&#x27;/&#x27;</span>)</span><br><span class="line">&#123;</span><br><span class="line">S-&gt;data[i].tag = <span class="number">1</span>;</span><br><span class="line">S-&gt;data[i].prio = baselevel + <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (c[i] == <span class="string">&#x27;(&#x27;</span>)</span><br><span class="line">&#123;</span><br><span class="line">S-&gt;data[i].tag = <span class="number">0</span>;</span><br><span class="line">baselevel = baselevel + <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (c[i] == <span class="string">&#x27;)&#x27;</span>)</span><br><span class="line">&#123;</span><br><span class="line">S-&gt;data[i].tag = <span class="number">0</span>;</span><br><span class="line">baselevel = baselevel - <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">S-&gt;data[i].tag = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    S-&gt;length = len;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">FindMid</span><span class="params">(MyString *S)</span></span>&#123; <span class="comment">//返回level最小符号的下标</span></span><br><span class="line">    <span class="keyword">int</span> pos = <span class="number">0</span>,min = max;<span class="comment">//min 当前最小的level，pos记录下标</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; S-&gt;length;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(S-&gt;data[i].prio &lt;= min &amp;&amp; S-&gt;data[i].tag == <span class="number">1</span>)<span class="comment">// 优先级相同时，先算前面的，所以将后面的作为中间值划分。</span></span><br><span class="line">        &#123;</span><br><span class="line">            min = S-&gt;data[i].prio;</span><br><span class="line">            pos = i;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> pos;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">PTNode <span class="title">CreatTree</span><span class="params">(MyString *S)</span></span>&#123;</span><br><span class="line">    MyString left,right;</span><br><span class="line">    PTNode T;</span><br><span class="line">    T = (PTNode)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(TNode));</span><br><span class="line">    <span class="keyword">int</span> midpos,len;</span><br><span class="line">    len = S-&gt;length;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(len == <span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        T-&gt;data = S-&gt;data[len<span class="number">-1</span>];</span><br><span class="line">        T-&gt;lchild = <span class="literal">NULL</span>;</span><br><span class="line">        T-&gt;rchild = <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(len &gt; <span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        midpos = FindMid(S);</span><br><span class="line">        left.length = midpos;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; midpos;i++)</span><br><span class="line">        &#123;</span><br><span class="line">            left.data[i] = S-&gt;data[i];</span><br><span class="line">        &#125;</span><br><span class="line">        right.length = S-&gt;length - midpos - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; right.length;i++)</span><br><span class="line">        &#123;</span><br><span class="line">            right.data[i] = S-&gt;data[i+midpos+<span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        Clear(&amp;left);</span><br><span class="line">        Clear(&amp;right);</span><br><span class="line">        T-&gt;data = S-&gt;data[midpos];</span><br><span class="line">        T-&gt;lchild = (TNode*)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(TNode));</span><br><span class="line">        T-&gt;rchild = (TNode*)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(TNode));</span><br><span class="line"></span><br><span class="line">        T-&gt;lchild = CreatTree(&amp;left);</span><br><span class="line">        T-&gt;rchild = CreatTree(&amp;right);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> T;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Last</span><span class="params">(BiTree* T)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(T-&gt;lchild == <span class="literal">NULL</span> &amp;&amp; T-&gt;rchild == <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%c&quot;</span>,T-&gt;data.elem);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        Last(T-&gt;lchild);</span><br><span class="line">        Last(T-&gt;rchild);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%c&quot;</span>,T-&gt;data.elem);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    MyString s;</span><br><span class="line">    s.length = <span class="number">0</span>;</span><br><span class="line">    PTNode T;</span><br><span class="line"></span><br><span class="line">    InitString(&amp;s);</span><br><span class="line">    Clear(&amp;s);</span><br><span class="line">    T = CreatTree(&amp;s);</span><br><span class="line">    Last(T);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="22"><a href="#22" class="headerlink" title="22."></a>22.</h2><p><img data-src="http://cdn.sekyoro.top/imgs/093906.png" alt="image-20210612110908312"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;limits.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> YES 1</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> NO 0</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_VERTEX_NUM 100</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">Seqlist</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">int</span> value;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Seqlist</span> *<span class="title">next</span>;</span></span><br><span class="line">&#125; Seqlist, *pList;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">ArcNode</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">int</span> adj; <span class="comment">//权值数据</span></span><br><span class="line"></span><br><span class="line">&#125; ArcNode;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">AdjMatrix</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">int</span> vertex[MAX_VERTEX_NUM];                   <span class="comment">//顶点向量</span></span><br><span class="line">    ArcNode arcs[MAX_VERTEX_NUM][MAX_VERTEX_NUM]; <span class="comment">//邻接矩阵,权值</span></span><br><span class="line">    <span class="keyword">int</span> vexnum, arcnum;                           <span class="comment">//顶点数与弧数</span></span><br><span class="line">&#125; AdjMatrix;</span><br><span class="line"></span><br><span class="line"><span class="comment">//初始化有向图权值</span></span><br><span class="line"><span class="function">AdjMatrix <span class="title">initial</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dijkstra</span><span class="params">(AdjMatrix, <span class="keyword">int</span>, <span class="keyword">int</span>[], pList *)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//初始化路径 从v0开始到vi的最短路径序列</span></span><br><span class="line"><span class="comment">//初值为 若v0到vi有弧,则为v0,vi</span></span><br><span class="line"><span class="function">pList <span class="title">initial_path</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">member</span><span class="params">(<span class="keyword">int</span>, pList)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">addtail</span><span class="params">(pList, <span class="keyword">int</span>)</span></span>;</span><br><span class="line"><span class="comment">// pList addtail(pList,int);</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">output</span><span class="params">(<span class="keyword">int</span>[], AdjMatrix)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    AdjMatrix adj;</span><br><span class="line">    pList s;</span><br><span class="line">    <span class="comment">//dist存储目前已经找到的v0到vi当前最短路径长度</span></span><br><span class="line">    <span class="keyword">int</span> dist[MAX_VERTEX_NUM];</span><br><span class="line">    <span class="comment">//path,若v0到vi有路径则存储,否则为空</span></span><br><span class="line">    pList *path = (pList *)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(pList));</span><br><span class="line">    adj = initial();</span><br><span class="line">    dijkstra(adj, <span class="number">0</span>, dist, path);</span><br><span class="line">    output(dist,adj);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">AdjMatrix <span class="title">initial</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    AdjMatrix adj;</span><br><span class="line">    <span class="keyword">int</span> vexnum, arcnum;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;vexnum, &amp;arcnum);</span><br><span class="line">    adj.vexnum = vexnum;</span><br><span class="line">    adj.arcnum = arcnum;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// for (int i = 0; i &lt; vexnum; i++)</span></span><br><span class="line">    <span class="comment">//     scanf(&quot;%d&quot;, &amp;adj.vertex[i]); //输入每个节点信息</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; vexnum; i++)</span><br><span class="line">        adj.vertex[i] = i + <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> i, j, weight;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> ix = <span class="number">0</span>; ix &lt; vexnum; ix++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> jx = <span class="number">0</span>; jx &lt; vexnum; jx++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (ix != jx)</span><br><span class="line">                adj.arcs[ix][jx].adj = INT_MAX;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                adj.arcs[ix][jx].adj = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (arcnum--)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d %d %d&quot;</span>, &amp;i, &amp;j, &amp;weight);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> ix = <span class="number">0</span>; ix &lt; vexnum; ix++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (adj.vertex[ix] == i)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> jx = <span class="number">0</span>; jx &lt; vexnum; jx++)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">if</span> (adj.vertex[jx] == j)</span><br><span class="line">                    &#123;</span><br><span class="line">                        adj.arcs[ix][jx].adj = weight;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> adj;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dijkstra</span><span class="params">(AdjMatrix adj, <span class="keyword">int</span> v0, <span class="keyword">int</span> dist[], pList path[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    pList s;</span><br><span class="line">    <span class="comment">//初始化 dist 为长度最短的一条的最短路径</span></span><br><span class="line">    <span class="comment">//path为存在路径的序列</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; adj.vexnum; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        path[i] = initial_path();</span><br><span class="line">        dist[i] = adj.arcs[v0][i].adj;</span><br><span class="line">        <span class="keyword">if</span> (dist[i] &lt; INT_MAX)</span><br><span class="line">        &#123;</span><br><span class="line"></span><br><span class="line">            addtail(path[i], adj.vertex[i]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    s = initial_path();</span><br><span class="line">    <span class="comment">// addtail(s, adj.vertex[v0]);</span></span><br><span class="line">    <span class="keyword">int</span> k ;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> t = <span class="number">1</span>; t &lt;= adj.vexnum - <span class="number">1</span>; t++) <span class="comment">//计算v0从第二个到最后一个结点最短路径</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">int</span> min = INT_MAX;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt; adj.vexnum; j++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (!member(adj.vertex[j], s) &amp;&amp; dist[j] &lt; min) <span class="comment">//j不在s中且存在路径</span></span><br><span class="line">            &#123;</span><br><span class="line">                k = j;</span><br><span class="line">                min = dist[j];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// if(min == INT_MAX)</span></span><br><span class="line">        <span class="comment">// continue;</span></span><br><span class="line">        addtail(s, adj.vertex[k]);</span><br><span class="line">        <span class="comment">// if(dist[])</span></span><br><span class="line">        <span class="comment">// if ()</span></span><br><span class="line">        <span class="comment">//     printf(&quot;1 %d %d\n&quot;, k + 1, (dist[k] == INT_MAX) ? -1 : dist[k]);</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; adj.vexnum; i++) <span class="comment">//修正dist[i]</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (!member(adj.vertex[i], s) &amp;&amp; adj.arcs[k][i].adj &lt; INT_MAX &amp;&amp; (dist[k] + adj.arcs[k][i].adj &lt; dist[i]))</span><br><span class="line"></span><br><span class="line">            &#123;</span><br><span class="line">                dist[i] = dist[k] + adj.arcs[k][i].adj;</span><br><span class="line">                path[i] = path[k];</span><br><span class="line">                addtail(path[i], adj.vertex[i]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">pList <span class="title">initial_path</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    pList l = (pList)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(Seqlist));</span><br><span class="line">    l-&gt;value = <span class="number">0</span>;</span><br><span class="line">    l-&gt;next = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">return</span> l;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">addtail</span><span class="params">(pList path, <span class="keyword">int</span> vertex)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// if(path-&gt;value == 0)</span></span><br><span class="line">    <span class="comment">// &#123;</span></span><br><span class="line">    <span class="comment">//     path-&gt;value = vertex;</span></span><br><span class="line">    <span class="comment">//     path-&gt;next = NULL;</span></span><br><span class="line">    <span class="comment">//     return;</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">    pList c = (pList)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(Seqlist));</span><br><span class="line">    c-&gt;value = vertex;</span><br><span class="line">    c-&gt;next = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">while</span> (path-&gt;next != <span class="literal">NULL</span>)</span><br><span class="line">        path = path-&gt;next;</span><br><span class="line">    path-&gt;next = c;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// pList addtail(pList path,int vertex)</span></span><br><span class="line"><span class="comment">// &#123;</span></span><br><span class="line"><span class="comment">//     pList c = (pList)malloc(sizeof(Seqlist));</span></span><br><span class="line"><span class="comment">//     pList l = path;</span></span><br><span class="line"><span class="comment">//     c-&gt;value = vertex;</span></span><br><span class="line"><span class="comment">//     c-&gt;next = NULL;</span></span><br><span class="line"><span class="comment">//     while(l)</span></span><br><span class="line"><span class="comment">//     l = l-&gt;next;</span></span><br><span class="line"><span class="comment">//     l = c;</span></span><br><span class="line"><span class="comment">//     return path;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">member</span><span class="params">(<span class="keyword">int</span> vertex, pList path)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (path)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (vertex == path-&gt;value)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> YES;</span><br><span class="line">        &#125;</span><br><span class="line">        path = path-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> NO;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">output</span><span class="params">(<span class="keyword">int</span> dist[], AdjMatrix adj)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// int temp;</span></span><br><span class="line">    <span class="comment">// for(int i = 1;i&lt;adj.vexnum-1;i++)</span></span><br><span class="line">    <span class="comment">// &#123;</span></span><br><span class="line">    <span class="comment">//     for(int j = 1;j&lt;adj.vexnum - i -1;j++)</span></span><br><span class="line">    <span class="comment">//     &#123;</span></span><br><span class="line">    <span class="comment">//         if(dist[j]&gt;dist[j+1])</span></span><br><span class="line">    <span class="comment">//             &#123;</span></span><br><span class="line">    <span class="comment">//                     temp = dist[j];</span></span><br><span class="line">    <span class="comment">//                     dist[j] = dist[j+1];</span></span><br><span class="line">    <span class="comment">//                     dist[j+1] = temp;</span></span><br><span class="line">    <span class="comment">//             &#125;</span></span><br><span class="line">    <span class="comment">//     &#125;</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">    <span class="comment">// for(int i = 1;i&lt;adj.vexnum;i++)</span></span><br><span class="line">    <span class="comment">// &#123;</span></span><br><span class="line">    <span class="comment">//     printf(&quot;1 %d %d\n&quot;,i+1,(dist[i]==INT_MAX)?(-1):dist[i]);</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">    <span class="comment">// int min = INT_MAX;</span></span><br><span class="line">    <span class="comment">// int max = INT_MAX;</span></span><br><span class="line">    <span class="comment">// int mark = 1;</span></span><br><span class="line">    <span class="comment">// for(int t = 1;t&lt;=adj.vexnum;t++)</span></span><br><span class="line">    <span class="comment">// &#123;</span></span><br><span class="line">    <span class="comment">// for(int i = 1;i&lt;adj.vexnum;i++)</span></span><br><span class="line">    <span class="comment">// &#123;</span></span><br><span class="line">    <span class="comment">//     min = INT_MAX;</span></span><br><span class="line">    <span class="comment">//     if(dist[i]&lt;min&amp;&amp;dist[i]!=0&amp;&amp;dist[i]&gt;=dist[mark])</span></span><br><span class="line">    <span class="comment">//     &#123;</span></span><br><span class="line">    <span class="comment">//         min = dist[i];</span></span><br><span class="line">    <span class="comment">//         mark = i;</span></span><br><span class="line">    <span class="comment">//     &#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">    <span class="comment">// if(min!=INT_MAX)</span></span><br><span class="line">    <span class="comment">// &#123;</span></span><br><span class="line">    <span class="comment">// printf(&quot;1 %d %d\n&quot;,adj.vertex[mark],min);</span></span><br><span class="line">    <span class="comment">// dist[mark] = 0;</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">    <span class="comment">// else</span></span><br><span class="line">    <span class="comment">// printf(&quot;1 %d %d\n&quot;,adj.vertex[mark],-1);</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">    <span class="keyword">int</span> min;</span><br><span class="line">    <span class="keyword">int</span> flag;</span><br><span class="line">    <span class="keyword">int</span> i;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> t = <span class="number">1</span>; t &lt; adj.vexnum; t++)</span><br><span class="line">    &#123;</span><br><span class="line">        min = INT_MAX;</span><br><span class="line">        <span class="keyword">for</span> ( i = <span class="number">1</span>; i &lt; adj.vexnum; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (dist[i] &lt; min &amp;&amp; dist[i] != <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                flag = i;</span><br><span class="line">                min = dist[i];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// if (dist[i] == INT_MAX)</span></span><br><span class="line">            <span class="comment">// &#123;</span></span><br><span class="line">            <span class="comment">//     flag = i;</span></span><br><span class="line">            <span class="comment">// &#125;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (min != INT_MAX)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;1 %d %d\n&quot;</span>, adj.vertex[flag], min);</span><br><span class="line">            dist[flag] = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;1 %d %d\n&quot;</span>, adj.vertex[i<span class="number">-1</span>], <span class="number">-1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="23"><a href="#23" class="headerlink" title="23."></a>23.</h2><p><img data-src="http://cdn.sekyoro.top/imgs/093908.png" alt="image-20210612110943431"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> N 11</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> </span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">int</span> key;</span><br><span class="line">    <span class="keyword">int</span> flag;</span><br><span class="line">    <span class="comment">/* data */</span></span><br><span class="line">&#125;Recordtype;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> Recordtype hashtable[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">hash</span><span class="params">(<span class="keyword">int</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">create</span><span class="params">(hashtable,<span class="keyword">int</span>[],<span class="keyword">int</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> data[<span class="number">8</span>] = &#123;<span class="number">22</span>,<span class="number">41</span>,<span class="number">53</span>,<span class="number">46</span>,<span class="number">30</span>,<span class="number">13</span>,<span class="number">1</span>,<span class="number">67</span>&#125;;</span><br><span class="line">    <span class="keyword">int</span> s = <span class="number">0</span>;</span><br><span class="line">    hashtable ht;</span><br><span class="line">    create(ht,data,<span class="number">8</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i&lt;N;i++)</span><br><span class="line">        s+=ht[i].flag;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,s/<span class="number">8</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">hash</span><span class="params">(<span class="keyword">int</span> k)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="number">3</span>*k)%<span class="number">11</span>;<span class="comment">//返回位置</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">create</span><span class="params">(hashtable ht,<span class="keyword">int</span> data[],<span class="keyword">int</span> len)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i&lt;N;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        ht[i].key = <span class="number">0</span>;</span><br><span class="line">        ht[i].flag = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> flag = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> h;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i&lt;len;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        h = hash(data[i]);</span><br><span class="line">        <span class="keyword">if</span>(ht[h].key==<span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            ht[h].key = data[i];</span><br><span class="line">            ht[h].flag = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">while</span>(ht[h].key!=<span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                h++;</span><br><span class="line">                h = h%<span class="number">11</span>;</span><br><span class="line">                flag++;</span><br><span class="line">            &#125;</span><br><span class="line">            ht[h].key = data[i];</span><br><span class="line">            ht[h].flag = flag;</span><br><span class="line">            flag = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="24"><a href="#24" class="headerlink" title="24."></a>24.</h2><p><img data-src="http://cdn.sekyoro.top/imgs/093912.png" alt="image-20210612111013055"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//24.c</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">node</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">node</span> *<span class="title">lchild</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">node</span> *<span class="title">rchild</span>;</span></span><br><span class="line">    <span class="keyword">int</span> val;</span><br><span class="line">&#125;Bstnode,*Bstree;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">is_bstree</span><span class="params">(Bstree)</span></span>;</span><br><span class="line"><span class="function">Bstree <span class="title">create</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Bstree t = (Bstree)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(Bstnode));</span><br><span class="line">    t = create();    </span><br><span class="line">    <span class="keyword">if</span>(is_bstree(t))</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;yes\n&quot;</span>);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;no\n&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">Bstree <span class="title">create</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> elem;</span><br><span class="line">    Bstree p;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;elem);</span><br><span class="line">    <span class="keyword">if</span>(elem!=<span class="number">-1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">       p = (Bstree)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(Bstnode));</span><br><span class="line">       p-&gt;val = elem;</span><br><span class="line">        p-&gt;lchild = create();</span><br><span class="line">        p-&gt;rchild = create();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> p;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">is_bstree</span><span class="params">(Bstree t)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(t==<span class="literal">NULL</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(t-&gt;lchild&amp;&amp;t-&gt;rchild)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(t-&gt;val&lt;t-&gt;lchild-&gt;val||t-&gt;val&gt;t-&gt;rchild-&gt;val)</span><br><span class="line">                <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                <span class="keyword">return</span> is_bstree(t-&gt;lchild)&amp;&amp;is_bstree(t-&gt;rchild);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">if</span>(t-&gt;lchild)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span>(t-&gt;val&lt;t-&gt;lchild-&gt;val)</span><br><span class="line">                    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    <span class="keyword">return</span> is_bstree(t-&gt;lchild);</span><br><span class="line">            &#125;</span><br><span class="line">         <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">if</span>(t-&gt;rchild)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span>(t-&gt;val&gt;t-&gt;rchild-&gt;val)</span><br><span class="line">                    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    <span class="keyword">return</span> is_bstree(t-&gt;rchild);</span><br><span class="line">            &#125; </span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// #include &lt;stdio.h&gt;</span></span><br><span class="line"><span class="comment">// #include &lt;stdlib.h&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// #define FALSE 0</span></span><br><span class="line"><span class="comment">// #define TRUE 1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// typedef struct BinTreeNode&#123;</span></span><br><span class="line"><span class="comment">//     int data;</span></span><br><span class="line"><span class="comment">//     struct BinTreeNode *left;</span></span><br><span class="line"><span class="comment">//     struct BinTreeNode *right;</span></span><br><span class="line"><span class="comment">// &#125;BinTreeNode;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// BinTreeNode *CreatBinTree()&#123;//先序递归输入</span></span><br><span class="line"><span class="comment">// int elem;</span></span><br><span class="line"><span class="comment">// BinTreeNode *p;</span></span><br><span class="line"><span class="comment">// scanf(&quot;%d&quot;,&amp;elem);</span></span><br><span class="line"><span class="comment">// if(elem==-1)&#123;</span></span><br><span class="line"><span class="comment">//         return NULL;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// else&#123;</span></span><br><span class="line"><span class="comment">// p = (BinTreeNode*)malloc(sizeof(BinTreeNode));</span></span><br><span class="line"><span class="comment">// p-&gt;data = elem;</span></span><br><span class="line"><span class="comment">// p-&gt;left = CreatBinTree();</span></span><br><span class="line"><span class="comment">// p-&gt;right = CreatBinTree();</span></span><br><span class="line"><span class="comment">// return p;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// int IsBinarySortTree(BinTreeNode *T)&#123;//判断是否为排序树，即(T-&gt;left-&gt;data)&lt;(T-&gt;data)&lt;(T-&gt;right-&gt;data)</span></span><br><span class="line"><span class="comment">//     if(!T)&#123;</span></span><br><span class="line"><span class="comment">//         return TRUE;</span></span><br><span class="line"><span class="comment">//     &#125;</span></span><br><span class="line"><span class="comment">//     else if(T-&gt;left&amp;&amp;T-&gt;right)&#123;</span></span><br><span class="line"><span class="comment">//         if(T-&gt;data&lt;T-&gt;left-&gt;data||T-&gt;data&gt;T-&gt;right-&gt;data)&#123;</span></span><br><span class="line"><span class="comment">//             return FALSE;</span></span><br><span class="line"><span class="comment">//         &#125;</span></span><br><span class="line"><span class="comment">//         else&#123;</span></span><br><span class="line"><span class="comment">//             return (IsBinarySortTree(T-&gt;left)&amp;&amp;IsBinarySortTree(T-&gt;right));</span></span><br><span class="line"><span class="comment">//         &#125;</span></span><br><span class="line"><span class="comment">//     &#125;</span></span><br><span class="line"><span class="comment">//     else if(T-&gt;left)&#123;</span></span><br><span class="line"><span class="comment">//         if(T-&gt;data&gt;T-&gt;left-&gt;data)&#123;</span></span><br><span class="line"><span class="comment">//             return FALSE;</span></span><br><span class="line"><span class="comment">//         &#125;</span></span><br><span class="line"><span class="comment">//         else&#123;</span></span><br><span class="line"><span class="comment">//             return (IsBinarySortTree(T-&gt;left));</span></span><br><span class="line"><span class="comment">//         &#125;</span></span><br><span class="line"><span class="comment">//     &#125;</span></span><br><span class="line"><span class="comment">//     else if(T-&gt;right)&#123;</span></span><br><span class="line"><span class="comment">//         if(T-&gt;data&lt;T-&gt;right-&gt;data)&#123;</span></span><br><span class="line"><span class="comment">//             return FALSE;</span></span><br><span class="line"><span class="comment">//         &#125;</span></span><br><span class="line"><span class="comment">//         else&#123;</span></span><br><span class="line"><span class="comment">//             return (IsBinarySortTree(T-&gt;right));</span></span><br><span class="line"><span class="comment">//         &#125;</span></span><br><span class="line"><span class="comment">//     &#125;</span></span><br><span class="line"><span class="comment">//     return TRUE;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// void Output(BinTreeNode *T)&#123;//中递归输出</span></span><br><span class="line"><span class="comment">//     if(T!=NULL)&#123;</span></span><br><span class="line"><span class="comment">//         Output(T-&gt;left);</span></span><br><span class="line"><span class="comment">//         printf(&quot;%d &quot;,T-&gt;data);</span></span><br><span class="line"><span class="comment">//         Output(T-&gt;right);</span></span><br><span class="line"><span class="comment">//     &#125;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// int main()&#123;</span></span><br><span class="line"><span class="comment">//     //其实我一般习惯是先给存储结构申请空间，用void函数对存储结构进行操作的，但是这个题在读取输入字符前无法确定是否需要申请空间，于是我选择在函数内申请空间</span></span><br><span class="line"><span class="comment">//     //因为我们无法将指针变量的本身传入函数，因此直接将指针传入函数可能会造成无效的处理</span></span><br><span class="line"><span class="comment">//     //因为在C语言中，所有非数组形式的数据实参均以传值形式调用（对实参做一备份并传递给调用的函数，函数不能修改作为实参实际变量的值，而只能修改传递给它的那份备份）</span></span><br><span class="line"><span class="comment">//     //此时我们通常有如下两种办法：</span></span><br><span class="line"><span class="comment">//     //1.通过return返回，例如 BT *T; T = creat(); ( BT *creat() )</span></span><br><span class="line"><span class="comment">//     //2.使用二级指针，例如 BT *T; creat(&amp;T); ( void creat(BT **T) )</span></span><br><span class="line"><span class="comment">//     BinTreeNode *T;</span></span><br><span class="line"><span class="comment">//     T = CreatBinTree();</span></span><br><span class="line"><span class="comment">//     if(IsBinarySortTree(T))&#123;</span></span><br><span class="line"><span class="comment">//         printf(&quot;yes&quot;);</span></span><br><span class="line"><span class="comment">//     &#125;</span></span><br><span class="line"><span class="comment">//     else&#123;</span></span><br><span class="line"><span class="comment">//         printf(&quot;no&quot;);</span></span><br><span class="line"><span class="comment">//     &#125;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br></pre></td></tr></table></figure><h2 id="25"><a href="#25" class="headerlink" title="25."></a>25.</h2><p><img data-src="http://cdn.sekyoro.top/imgs/093915.png" alt="image-20210612111120529"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">node</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">node</span> *<span class="title">lchild</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">node</span> *<span class="title">rchild</span>;</span></span><br><span class="line">    <span class="keyword">int</span> val;</span><br><span class="line">&#125;Bstnode,*Bstree;</span><br><span class="line"></span><br><span class="line"><span class="function">Bstree <span class="title">create</span><span class="params">()</span></span>;<span class="comment">//创建  可以利用插入创建 也可以直接创建  </span></span><br><span class="line"><span class="comment">//这里说是先序输入，所以直接创建</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">search</span><span class="params">(Bstree,<span class="keyword">int</span>,<span class="keyword">int</span>)</span></span>;<span class="comment">//查找</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(Bstree*,<span class="keyword">int</span>)</span></span>;<span class="comment">//插入</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">delBst</span><span class="params">(Bstree*,<span class="keyword">int</span>)</span></span>;<span class="comment">//删除</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">output</span><span class="params">(Bstree)</span></span>;<span class="comment">//输出  中序</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Bstree t = (Bstree)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(Bstnode));</span><br><span class="line">    t = create();</span><br><span class="line">    <span class="keyword">int</span> min,max;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>,&amp;min,&amp;max);</span><br><span class="line">    search(t,min,max);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    <span class="keyword">int</span> insert_val;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;insert_val);</span><br><span class="line">    insert(&amp;t,insert_val);</span><br><span class="line">    output(t);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    <span class="keyword">int</span> del_val;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;del_val);</span><br><span class="line">    delBst(&amp;t,del_val);</span><br><span class="line">    output(t);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">Bstree <span class="title">create</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Bstree p;</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;n);</span><br><span class="line">    <span class="keyword">if</span>(n!=<span class="number">-1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        p = (Bstree)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(Bstnode));</span><br><span class="line">        p-&gt;val = n;</span><br><span class="line">        p-&gt;lchild = create();</span><br><span class="line">        p-&gt;rchild = create();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> p;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">search</span><span class="params">(Bstree t,<span class="keyword">int</span> min,<span class="keyword">int</span> max)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(t==<span class="literal">NULL</span>) </span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    search(t-&gt;lchild,min,max);</span><br><span class="line">    <span class="keyword">if</span>(t-&gt;val&gt;=min&amp;&amp;t-&gt;val&lt;=max)</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,t-&gt;val);</span><br><span class="line">   search(t-&gt;rchild,min,max);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(Bstree *t,<span class="keyword">int</span> num)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Bstree s;</span><br><span class="line">    <span class="keyword">if</span>(!t)</span><br><span class="line">    &#123;</span><br><span class="line">        s = <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(Bstnode));</span><br><span class="line">        s-&gt;val = num;</span><br><span class="line">        s-&gt;lchild = s-&gt;rchild = <span class="literal">NULL</span>;</span><br><span class="line">        *t = s;<span class="comment">//注意这里要改变值,所以用了指针</span></span><br><span class="line">        <span class="comment">//通过地址改变值</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    <span class="keyword">if</span>(num&lt;(*t)-&gt;val)</span><br><span class="line">    &#123;</span><br><span class="line">        insert(&amp;(*t)-&gt;lchild,num);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        insert(&amp;(*t)-&gt;rchild,num);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">delBst</span><span class="params">(Bstree *t,<span class="keyword">int</span> val)</span><span class="comment">//删除</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">                <span class="comment">//找到节点</span></span><br><span class="line">    <span class="keyword">if</span>((*t)-&gt;val==val)</span><br><span class="line">        &#123;</span><br><span class="line">                <span class="keyword">if</span>((*t)-&gt;lchild==<span class="literal">NULL</span>&amp;&amp;(*t)-&gt;rchild==<span class="literal">NULL</span>)<span class="comment">//叶子结点</span></span><br><span class="line">                &#123;</span><br><span class="line">                    (*t) = <span class="literal">NULL</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">               <span class="keyword">else</span></span><br><span class="line">                <span class="keyword">if</span>((*t)-&gt;rchild==<span class="literal">NULL</span>)<span class="comment">//只有左子树,将左子树置为父节点的左子树</span></span><br><span class="line">                &#123;</span><br><span class="line">                    (*t) = (*t)-&gt;lchild;</span><br><span class="line">                &#125;</span><br><span class="line">               <span class="keyword">else</span></span><br><span class="line">                 <span class="keyword">if</span>((*t)-&gt;lchild==<span class="literal">NULL</span>)<span class="comment">//只有右子树,将右子树置为父节点的右子树</span></span><br><span class="line">                &#123;</span><br><span class="line">                    (*t) = (*t)-&gt;rchild;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span><span class="comment">//待删除节点 左右子树都有</span></span><br><span class="line">                <span class="comment">//找到中序遍历下的上一个点,右子树置为其右子树</span></span><br><span class="line">                <span class="comment">//左子树依旧为父节点左子树</span></span><br><span class="line">                &#123;</span><br><span class="line">                    Bstree s;</span><br><span class="line">                    s = (*t)-&gt;lchild;</span><br><span class="line">                    <span class="keyword">while</span>(s-&gt;rchild)</span><br><span class="line">                    &#123;</span><br><span class="line">                        s = s-&gt;rchild;<span class="comment">//找到左子树的最右分支叶子节点，将其右节点子树置为右子树</span></span><br><span class="line">                    &#125;</span><br><span class="line">                    s-&gt;rchild = (*t)-&gt;rchild;</span><br><span class="line">                    (*t) = (*t)-&gt;lchild;</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    <span class="keyword">if</span>(val&lt;(*t)-&gt;val)</span><br><span class="line">    &#123;</span><br><span class="line">        delBst(&amp;(*t)-&gt;lchild,val);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        delBst(&amp;(*t)-&gt;lchild,val);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">output</span><span class="params">(Bstree t)</span><span class="comment">//输出  中序</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(t==<span class="literal">NULL</span>)</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">    <span class="comment">// if(t-&gt;lchild)</span></span><br><span class="line">        output(t-&gt;lchild);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,t-&gt;val);</span><br><span class="line">        output(t-&gt;rchild);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// #include&lt;stdio.h&gt;</span></span><br><span class="line"><span class="comment">// #include&lt;stdlib.h&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// typedef struct BiTNode &#123;</span></span><br><span class="line"><span class="comment">// int data;</span></span><br><span class="line"><span class="comment">// struct BiTNode* left;</span></span><br><span class="line"><span class="comment">// struct BiTNode* right;</span></span><br><span class="line"><span class="comment">// &#125;BiTNode, * BiTree;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// BiTree CreateBiTree();   //创建二叉树</span></span><br><span class="line"><span class="comment">// void SearchAndPrint(BiTree T, int a, int b);//要求1：输出大于a、小于b的关键字</span></span><br><span class="line"><span class="comment">// void InsertBi(BiTree* T, int insert);//插入一个关键字并输出</span></span><br><span class="line"><span class="comment">// void DeleteBi(BiTree* T, int dele);  //删除结点</span></span><br><span class="line"><span class="comment">// void MidPrint(BiTree T); //中序输出</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// int main()</span></span><br><span class="line"><span class="comment">// &#123;</span></span><br><span class="line"><span class="comment">// BiTree T;</span></span><br><span class="line"><span class="comment">// T = CreateBiTree();</span></span><br><span class="line"><span class="comment">// int a, b, insert, dele;</span></span><br><span class="line"><span class="comment">// scanf(&quot;%d%d%d%d&quot;, &amp;a, &amp;b, &amp;insert, &amp;dele);</span></span><br><span class="line"><span class="comment">// SearchAndPrint(T, a, b);//要求1</span></span><br><span class="line"><span class="comment">// printf(&quot;\n&quot;);</span></span><br><span class="line"><span class="comment">// InsertBi(&amp;T, insert);//插入</span></span><br><span class="line"><span class="comment">// MidPrint(T);//中序输出</span></span><br><span class="line"><span class="comment">// printf(&quot;\n&quot;);</span></span><br><span class="line"><span class="comment">// DeleteBi(&amp;T, insert);//删除insert</span></span><br><span class="line"><span class="comment">// DeleteBi(&amp;T, dele);//删除dele</span></span><br><span class="line"><span class="comment">// MidPrint(T);//中序输出</span></span><br><span class="line"><span class="comment">// return 0;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// BiTree CreateBiTree()</span></span><br><span class="line"><span class="comment">// &#123;   //创建二叉树</span></span><br><span class="line"><span class="comment">// int data;</span></span><br><span class="line"><span class="comment">// scanf(&quot;%d&quot;, &amp;data);</span></span><br><span class="line"><span class="comment">// if (data == -1) &#123;</span></span><br><span class="line"><span class="comment">// return NULL;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// BiTree tmp;</span></span><br><span class="line"><span class="comment">// tmp = (BiTree)malloc(sizeof(BiTNode));</span></span><br><span class="line"><span class="comment">// if (!tmp) &#123;</span></span><br><span class="line"><span class="comment">// return NULL;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// tmp-&gt;data = data;</span></span><br><span class="line"><span class="comment">// tmp-&gt;left = CreateBiTree();</span></span><br><span class="line"><span class="comment">// tmp-&gt;right = CreateBiTree();</span></span><br><span class="line"><span class="comment">// return tmp;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// void SearchAndPrint(BiTree T, int a, int b)</span></span><br><span class="line"><span class="comment">// &#123;   //要求1：输出大于a、小于b的关键字</span></span><br><span class="line"><span class="comment">// //用中序输出</span></span><br><span class="line"><span class="comment">// if (!T) &#123;</span></span><br><span class="line"><span class="comment">// return;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// SearchAndPrint(T-&gt;left, a, b);</span></span><br><span class="line"><span class="comment">// if (T-&gt;data &gt; a &amp;&amp; T-&gt;data &lt; b) &#123;</span></span><br><span class="line"><span class="comment">// printf(&quot;%d &quot;, T-&gt;data);</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// SearchAndPrint(T-&gt;right, a, b);</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// void InsertBi(BiTree* T, int insert)</span></span><br><span class="line"><span class="comment">// &#123;   //插入结点</span></span><br><span class="line"><span class="comment">// if (!(*T)) &#123;</span></span><br><span class="line"><span class="comment">// BiTree tmp;</span></span><br><span class="line"><span class="comment">// tmp = (BiTree)malloc(sizeof(BiTNode));</span></span><br><span class="line"><span class="comment">// tmp-&gt;data = insert;</span></span><br><span class="line"><span class="comment">// tmp-&gt;left = NULL;</span></span><br><span class="line"><span class="comment">// tmp-&gt;right = NULL;</span></span><br><span class="line"><span class="comment">// *T = tmp;</span></span><br><span class="line"><span class="comment">// return;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// if (insert &lt; (*T)-&gt;data) &#123;</span></span><br><span class="line"><span class="comment">// InsertBi(&amp;(*T)-&gt;left, insert);</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// if (insert &gt; (*T)-&gt;data) &#123;</span></span><br><span class="line"><span class="comment">// InsertBi(&amp;(*T)-&gt;right, insert);</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// void DeleteBi(BiTree* T, int dele)</span></span><br><span class="line"><span class="comment">// &#123;   //删除结点</span></span><br><span class="line"><span class="comment">// if (!(*T)) &#123;</span></span><br><span class="line"><span class="comment">// return;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// DeleteBi(&amp;(*T)-&gt;left, dele);</span></span><br><span class="line"><span class="comment">// if ((*T)-&gt;data == dele) &#123;</span></span><br><span class="line"><span class="comment">// if (!(*T)-&gt;left) &#123;</span></span><br><span class="line"><span class="comment">// //左子树为空</span></span><br><span class="line"><span class="comment">// (*T) = (*T)-&gt;right;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// else &#123;//左子树非空</span></span><br><span class="line"><span class="comment">// BiTree tmp = (*T)-&gt;left;</span></span><br><span class="line"><span class="comment">// while (tmp-&gt;right) &#123;</span></span><br><span class="line"><span class="comment">// tmp = tmp-&gt;right;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// tmp-&gt;right = (*T)-&gt;right;</span></span><br><span class="line"><span class="comment">// (*T) = (*T)-&gt;left;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// return;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// DeleteBi(&amp;(*T)-&gt;right, dele);</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// void MidPrint(BiTree T)</span></span><br><span class="line"><span class="comment">// &#123;   //中序输出</span></span><br><span class="line"><span class="comment">// if (!T) &#123;</span></span><br><span class="line"><span class="comment">// return;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// MidPrint(T-&gt;left);</span></span><br><span class="line"><span class="comment">// printf(&quot;%d &quot;, T-&gt;data);</span></span><br><span class="line"><span class="comment">// MidPrint(T-&gt;right);</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="26"><a href="#26" class="headerlink" title="26."></a>26.</h2><p><img data-src="http://cdn.sekyoro.top/imgs/093916.png" alt="image-20210612111201004"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//二叉树的合并</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">node</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">node</span> *<span class="title">lchild</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">node</span> *<span class="title">rchild</span>;</span></span><br><span class="line">    <span class="keyword">int</span> key;</span><br><span class="line">&#125;Bstnode,*Bstree;</span><br><span class="line"></span><br><span class="line"><span class="function">Bstree <span class="title">create</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">combine_tree</span><span class="params">(Bstree*,Bstree*)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(Bstree*,<span class="keyword">int</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">output</span><span class="params">(Bstree)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Bstree t1,t2;</span><br><span class="line">    t1 = create();</span><br><span class="line">    t2 = create();</span><br><span class="line">    combine_tree(&amp;t1,&amp;t2);</span><br><span class="line">    output(t1);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="function">Bstree <span class="title">create</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Bstree p;</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;n);</span><br><span class="line">    <span class="keyword">if</span>(n!=<span class="number">-1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        p = (Bstree)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(Bstnode));</span><br><span class="line">        p-&gt;key = n;</span><br><span class="line">        p-&gt;lchild = create();</span><br><span class="line">        p-&gt;rchild = create();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> p;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//中序遍历T2，将T2各个元素插入T1中</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">combine_tree</span><span class="params">(Bstree* m,Bstree* n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(*n)</span><br><span class="line">    &#123;</span><br><span class="line">        combine_tree(&amp;(*m),&amp;(*n)-&gt;lchild);</span><br><span class="line">        insert(&amp;(*m),(*n)-&gt;key);</span><br><span class="line">        combine_tree(&amp;(*m),&amp;(*n)-&gt;rchild);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(Bstree *t,<span class="keyword">int</span> num)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Bstree s;</span><br><span class="line">    <span class="keyword">if</span>(!t)</span><br><span class="line">    &#123;</span><br><span class="line">        s = <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(Bstnode));</span><br><span class="line">        s-&gt;key = num;</span><br><span class="line">        s-&gt;lchild = s-&gt;rchild = <span class="literal">NULL</span>;</span><br><span class="line">        *t = s;<span class="comment">//注意这里要改变值,所以用了指针</span></span><br><span class="line">        <span class="comment">//通过地址改变值</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    <span class="keyword">if</span>(num&lt;(*t)-&gt;key)</span><br><span class="line">    &#123;</span><br><span class="line">        insert(&amp;(*t)-&gt;lchild,num);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        insert(&amp;(*t)-&gt;rchild,num);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">output</span><span class="params">(Bstree t)</span><span class="comment">//输出  中序</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(t==<span class="literal">NULL</span>)</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">    <span class="comment">// if(t-&gt;lchild)</span></span><br><span class="line">        output(t-&gt;lchild);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,t-&gt;key);</span><br><span class="line">        output(t-&gt;rchild);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// #include&lt;stdio.h&gt;</span></span><br><span class="line"><span class="comment">// #include&lt;stdlib.h&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// typedef struct BiTNode &#123;</span></span><br><span class="line"><span class="comment">// int data;</span></span><br><span class="line"><span class="comment">// struct BiTNode* left;</span></span><br><span class="line"><span class="comment">// struct BiTNode* right;</span></span><br><span class="line"><span class="comment">// &#125;BiTNode, * BiTree;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// BiTree CreateBiTree();   //创建二叉树</span></span><br><span class="line"><span class="comment">// void InsertBi(BiTree* T, int insert);//插入节点</span></span><br><span class="line"><span class="comment">// void CombineBi(BiTree T1, BiTree T2);//合并二叉树T1，T2</span></span><br><span class="line"><span class="comment">// void MidPrint(BiTree T); //中序输出</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// int main()</span></span><br><span class="line"><span class="comment">// &#123;</span></span><br><span class="line"><span class="comment">// BiTree T1, T2;</span></span><br><span class="line"><span class="comment">// T1 = CreateBiTree();</span></span><br><span class="line"><span class="comment">// T2 = CreateBiTree();</span></span><br><span class="line"><span class="comment">// CombineBi(T1, T2);</span></span><br><span class="line"><span class="comment">// MidPrint(T1);</span></span><br><span class="line"><span class="comment">// return 0;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// BiTree CreateBiTree()</span></span><br><span class="line"><span class="comment">// &#123;   //创建二叉树</span></span><br><span class="line"><span class="comment">// int data;</span></span><br><span class="line"><span class="comment">// scanf(&quot;%d&quot;, &amp;data);</span></span><br><span class="line"><span class="comment">// if (data == -1) &#123;</span></span><br><span class="line"><span class="comment">// return NULL;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// BiTree tmp;</span></span><br><span class="line"><span class="comment">// tmp = (BiTree)malloc(sizeof(BiTNode));</span></span><br><span class="line"><span class="comment">// if (!tmp) &#123;</span></span><br><span class="line"><span class="comment">// return NULL;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// tmp-&gt;data = data;</span></span><br><span class="line"><span class="comment">// tmp-&gt;left = CreateBiTree();</span></span><br><span class="line"><span class="comment">// tmp-&gt;right = CreateBiTree();</span></span><br><span class="line"><span class="comment">// return tmp;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// void InsertBi(BiTree* T, int insert)</span></span><br><span class="line"><span class="comment">// &#123;   //插入结点</span></span><br><span class="line"><span class="comment">// if (!(*T)) &#123;</span></span><br><span class="line"><span class="comment">// BiTree tmp;</span></span><br><span class="line"><span class="comment">// tmp = (BiTree)malloc(sizeof(BiTNode));</span></span><br><span class="line"><span class="comment">// tmp-&gt;data = insert;</span></span><br><span class="line"><span class="comment">// tmp-&gt;left = NULL;</span></span><br><span class="line"><span class="comment">// tmp-&gt;right = NULL;</span></span><br><span class="line"><span class="comment">// *T = tmp;</span></span><br><span class="line"><span class="comment">// return;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// if (insert &lt; (*T)-&gt;data) &#123;</span></span><br><span class="line"><span class="comment">// InsertBi(&amp;(*T)-&gt;left, insert);</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// if (insert &gt; (*T)-&gt;data) &#123;</span></span><br><span class="line"><span class="comment">// InsertBi(&amp;(*T)-&gt;right, insert);</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// void CombineBi(BiTree T1, BiTree T2)</span></span><br><span class="line"><span class="comment">// &#123;   //合并二叉树T1，T2</span></span><br><span class="line"><span class="comment">// if (!T2) &#123;</span></span><br><span class="line"><span class="comment">// return;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// CombineBi(T1, T2-&gt;left);</span></span><br><span class="line"><span class="comment">// InsertBi(&amp;T1, T2-&gt;data);</span></span><br><span class="line"><span class="comment">// CombineBi(T1, T2-&gt;right);</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// void MidPrint(BiTree T)</span></span><br><span class="line"><span class="comment">// &#123;   //中序输出</span></span><br><span class="line"><span class="comment">// if (!T) &#123;</span></span><br><span class="line"><span class="comment">// return;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// MidPrint(T-&gt;left);</span></span><br><span class="line"><span class="comment">// printf(&quot;%d &quot;, T-&gt;data);</span></span><br><span class="line"><span class="comment">// MidPrint(T-&gt;right);</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br></pre></td></tr></table></figure><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> study </category>
          
      </categories>
      
      
        <tags>
            
            <tag> data_structure </tag>
            
            <tag> c </tag>
            
            <tag> noj </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>数据结构试验</title>
      <link href="2021/05/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E8%AF%95%E9%AA%8C/"/>
      <url>2021/05/30/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E8%AF%95%E9%AA%8C/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="数据结构实验"><a href="#数据结构实验" class="headerlink" title="数据结构实验"></a>数据结构实验</h1><p>数据实验写了</p><p>不过也忘得差不多了</p><p>人生艰难啊..</p><span id="more"></span><h2 id="1"><a href="#1" class="headerlink" title="1."></a>1.</h2><p><img data-src="http://cdn.sekyoro.top/imgs/093433.png" alt="image-20210530155126345"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">**合并有序数组</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">LinkedList</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">int</span> data;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">LinkedList</span> *<span class="title">next</span>;</span></span><br><span class="line">&#125; LinkedList, *pLinkedList;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">CreateLinkedList</span><span class="params">(pLinkedList, <span class="keyword">int</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MergeList</span><span class="params">(pLinkedList, pLinkedList)</span></span>;</span><br><span class="line"><span class="function">pLinkedList <span class="title">Initial</span><span class="params">(<span class="keyword">void</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> size;</span><br><span class="line">    pLinkedList pa, pb;</span><br><span class="line">    pa = Initial();</span><br><span class="line">    pb = Initial();</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Enter the size of first LinkedList:\n&quot;</span>);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;size);</span><br><span class="line">    CreateLinkedList(pa, size);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Enter the size of second LinkedList:\n&quot;</span>);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;size);</span><br><span class="line">    CreateLinkedList(pb, size);</span><br><span class="line">    MergeList(pa, pb);</span><br><span class="line">    pa = pa-&gt;next;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;the result is:\n&quot;</span>);</span><br><span class="line">    <span class="keyword">while</span> (pa)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, pa-&gt;data);</span><br><span class="line">        pa = pa-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">free</span>(pa);</span><br><span class="line">    <span class="built_in">free</span>(pb);</span><br><span class="line">    system(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">pLinkedList <span class="title">Initial</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    pLinkedList p = (pLinkedList)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(LinkedList));</span><br><span class="line">    p-&gt;next = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">return</span> p;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">CreateLinkedList</span><span class="params">(pLinkedList p, <span class="keyword">int</span> size)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    pLinkedList s, r;</span><br><span class="line">    r = p;</span><br><span class="line">    <span class="keyword">int</span> num;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Enter the %d numbers:\n&quot;</span>,size);</span><br><span class="line">    <span class="keyword">while</span> (size--)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;num);</span><br><span class="line">        s = (pLinkedList)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(LinkedList));</span><br><span class="line">        s-&gt;data = num;</span><br><span class="line">        r-&gt;next = s;</span><br><span class="line">        r = s;</span><br><span class="line">    &#125;</span><br><span class="line">    r-&gt;next = <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MergeList</span><span class="params">(pLinkedList p, pLinkedList q)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    pLinkedList s, r;</span><br><span class="line">    s = p;<span class="comment">//s指针是作为整个归并的核心，它使得元素从小到大排序</span></span><br><span class="line">    r = s-&gt;next;<span class="comment">//q与r指针分别指向两个链表，随着排序的进行，后移</span></span><br><span class="line">    q = q-&gt;next;</span><br><span class="line">    <span class="keyword">while</span> (r &amp;&amp; q)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">/**当一个链表中数据大于另一个链表</span></span><br><span class="line"><span class="comment">        **则指针s指向小元素值的节点，并使其后移，</span></span><br><span class="line"><span class="comment">        **然后指向较小元素值的指针后移*/</span></span><br><span class="line">        <span class="keyword">if</span> (r-&gt;data &gt; q-&gt;data)</span><br><span class="line">        &#123;</span><br><span class="line">            s-&gt;next = q;</span><br><span class="line">            s = s-&gt;next;</span><br><span class="line">            q = q-&gt;next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">/**当一个链表中数据小于另一个链表</span></span><br><span class="line"><span class="comment">        **道理类似，s指针指向小元素节点，并后移</span></span><br><span class="line"><span class="comment">        **然后指向较小元素的指针后移</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line"></span><br><span class="line">            s-&gt;next = r;</span><br><span class="line">            s = s-&gt;next;</span><br><span class="line">            r = r-&gt;next;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/*链表p元素已取完，表明q还有未取元素</span></span><br><span class="line"><span class="comment">    **使s指针指向q</span></span><br><span class="line"><span class="comment">    */</span><span class="keyword">if</span> (!r)</span><br><span class="line">    &#123;</span><br><span class="line">        s-&gt;next = q;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//如果链表q元素取完,同理，使s指针指向还未取完元素的指针</span></span><br><span class="line">    <span class="keyword">if</span> (!q)</span><br><span class="line">    &#123;</span><br><span class="line">        s-&gt;next = r;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="2"><a href="#2" class="headerlink" title="2."></a>2.</h2><p><img data-src="http://cdn.sekyoro.top/imgs/093436.png" alt="image-20210530155212444"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;math.h&gt;</span></span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">DoubleNode</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">int</span> data;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">DoubleNode</span> *<span class="title">next</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">DoubleNode</span> *<span class="title">pre</span>;</span></span><br><span class="line">&#125; DoubleNode, *pDoubleNode;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">DLinkList</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    pDoubleNode head;</span><br><span class="line">    pDoubleNode tail;</span><br><span class="line">&#125; DLinkList, *pDLinkList;</span><br><span class="line"><span class="function">pDLinkList <span class="title">initial_node</span><span class="params">(<span class="keyword">void</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Multi</span><span class="params">(pDLinkList, <span class="keyword">int</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Div</span><span class="params">(pDLinkList, <span class="keyword">int</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Add</span><span class="params">(pDLinkList, pDLinkList)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">terms</span><span class="params">(<span class="keyword">double</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">double</span> prec;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%lf&quot;</span>, &amp;prec);</span><br><span class="line">    pDLinkList num ;</span><br><span class="line">    pDLinkList sum ;</span><br><span class="line">    num = initial_node();</span><br><span class="line">    sum = initial_node();</span><br><span class="line">    num-&gt;head-&gt;next-&gt;data = <span class="number">2</span>; <span class="comment">//根据计算公式，第一项是2</span></span><br><span class="line">    sum-&gt;head-&gt;next-&gt;data = <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">int</span> t = terms(prec);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; t; i++)</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        Multi(num, i);</span><br><span class="line">        Div(num, i);</span><br><span class="line">        Add(num, sum);</span><br><span class="line">    &#125;</span><br><span class="line">    pDoubleNode temp = sum-&gt;head-&gt;next-&gt;next;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;3.&quot;</span>);</span><br><span class="line">    <span class="keyword">while</span> (prec--)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>, temp-&gt;data);</span><br><span class="line">        temp = temp-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Multi</span><span class="params">(pDLinkList L, <span class="keyword">int</span> i)</span> <span class="comment">//乘法从尾部开始</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    pDoubleNode tail = L-&gt;tail;</span><br><span class="line">    <span class="keyword">int</span> temp = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (L-&gt;head != tail)</span><br><span class="line">    &#123;</span><br><span class="line">        temp = tail-&gt;data * i + ret;</span><br><span class="line">        tail-&gt;data = temp % <span class="number">10</span>;</span><br><span class="line">        ret = temp / <span class="number">10</span>;</span><br><span class="line">        tail = tail-&gt;pre;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Div</span><span class="params">(pDLinkList L, <span class="keyword">int</span> i)</span> <span class="comment">//除法从头部开始</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    pDoubleNode head = L-&gt;head-&gt;next;<span class="comment">//指向第一个有值的节点</span></span><br><span class="line">    <span class="keyword">int</span> temp = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (head != L-&gt;tail)</span><br><span class="line">    &#123;</span><br><span class="line">        temp = head-&gt;data + ret * <span class="number">10</span>;</span><br><span class="line">        head-&gt;data = temp / (<span class="number">2</span> * i + <span class="number">1</span>);</span><br><span class="line">        ret = temp % (<span class="number">2</span> * i + <span class="number">1</span>);</span><br><span class="line">        head = head-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Add</span><span class="params">(pDLinkList num, pDLinkList sum)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> temp = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line">    pDoubleNode p = num-&gt;tail;</span><br><span class="line">    pDoubleNode q = sum-&gt;tail;</span><br><span class="line">    <span class="keyword">while</span> (p != num-&gt;head)</span><br><span class="line">    &#123;</span><br><span class="line">        temp = p-&gt;data + q-&gt;data + ret;</span><br><span class="line">        q-&gt;data = temp % <span class="number">10</span>;</span><br><span class="line">        ret = temp / <span class="number">10</span>;</span><br><span class="line">        p = p-&gt;pre;</span><br><span class="line">        q = q-&gt;pre;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">terms</span><span class="params">(<span class="keyword">double</span> n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">double</span> temp = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">double</span> sum = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">1</span>; sum &lt; n + <span class="number">1</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        temp = (<span class="number">2</span> * i + <span class="number">1</span>) / i;</span><br><span class="line">        temp = <span class="built_in">log10</span>(temp);</span><br><span class="line">        sum += temp;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> i;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">pDLinkList <span class="title">initial_node</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> num = <span class="number">1000</span>;</span><br><span class="line">    pDLinkList L = (pDLinkList)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(DLinkList));</span><br><span class="line">    pDoubleNode s,r;</span><br><span class="line">    L-&gt;head = (pDoubleNode)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(DoubleNode));</span><br><span class="line">    r = L-&gt;head;</span><br><span class="line">    <span class="keyword">while</span> (num--)</span><br><span class="line">    &#123;</span><br><span class="line">        s = (pDoubleNode)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(DoubleNode));</span><br><span class="line">        s-&gt;data = <span class="number">0</span>;</span><br><span class="line">        r-&gt;next = s;</span><br><span class="line">        s-&gt;pre = r;</span><br><span class="line">        L-&gt;head-&gt;pre = s;</span><br><span class="line">        s-&gt;next = L-&gt;head;</span><br><span class="line">        r = s; <span class="comment">//r为尾指针    </span></span><br><span class="line">    &#125;</span><br><span class="line">    L-&gt;tail = r;</span><br><span class="line">    <span class="keyword">return</span> L;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3"><a href="#3" class="headerlink" title="3."></a>3.</h2><p><img data-src="http://cdn.sekyoro.top/imgs/093445.png" alt="image-20210530155312387"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//快速转置</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> maxsize 1000</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">Triple</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">int</span> elem;</span><br><span class="line">    <span class="keyword">int</span> i, j;</span><br><span class="line">&#125; Triple;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    Triple data[maxsize];</span><br><span class="line">    <span class="keyword">int</span> row, col, len;</span><br><span class="line">&#125; TSMatrix;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">initial</span><span class="params">(TSMatrix *)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Transpose</span><span class="params">(TSMatrix *, TSMatrix *)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">(TSMatrix *)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">    TSMatrix *M = (TSMatrix *)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(TSMatrix));</span><br><span class="line">    TSMatrix *N = (TSMatrix *)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(TSMatrix));</span><br><span class="line">    initial(M);</span><br><span class="line">    Transpose(M, N);</span><br><span class="line">    print(N);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">(TSMatrix *result)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; result-&gt;len; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d %d %d\n&quot;</span>, result-&gt;data[i].i, result-&gt;data[i].j, result-&gt;data[i].elem);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Transpose</span><span class="params">(TSMatrix *M, TSMatrix *N)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    N-&gt;row = M-&gt;col;</span><br><span class="line">    N-&gt;col = M-&gt;row;</span><br><span class="line">    N-&gt;len = M-&gt;len;</span><br><span class="line">    <span class="keyword">if</span> (N-&gt;len)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">int</span> num[maxsize], cpos[maxsize];</span><br><span class="line">        <span class="comment">//num[col]表示col列非零元个数,</span></span><br><span class="line">        <span class="comment">//cpos[col]表示col列第一个非零元在转置后三元组表位置</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;M-&gt;col; i++)</span><br><span class="line">            num[i] = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; M-&gt;len; i++)</span><br><span class="line">            num[M-&gt;data[i].j]++;</span><br><span class="line"></span><br><span class="line">        cpos[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; M-&gt;col; i++)</span><br><span class="line">            cpos[i] = cpos[i - <span class="number">1</span>] + num[i - <span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> col, q;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; M-&gt;len; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            col = M-&gt;data[i].j; <span class="comment">//M的三元组表第i个元素对应的列,即为转置后的行</span></span><br><span class="line">            q = cpos[col];      <span class="comment">//M第col列第一个非零元在转置后三元组表位置</span></span><br><span class="line">            N-&gt;data[q].i = M-&gt;data[i].j;</span><br><span class="line">            N-&gt;data[q].j = M-&gt;data[i].i;</span><br><span class="line">            N-&gt;data[q].elem = M-&gt;data[i].elem;</span><br><span class="line">            ++cpos[col]; <span class="comment">//指向下个非零元</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">initial</span><span class="params">(TSMatrix *M)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> m, n;</span><br><span class="line">    <span class="keyword">int</span> r, c, element;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;m, &amp;n);</span><br><span class="line">    M-&gt;row = m;</span><br><span class="line">    M-&gt;col = n;</span><br><span class="line">    M-&gt;len = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (<span class="built_in">scanf</span>(<span class="string">&quot;%d %d %d&quot;</span>,&amp;r,&amp;c,&amp;element)&amp;&amp;(r!=<span class="number">0</span>||c!=<span class="number">0</span>||element!=<span class="number">0</span>))</span><br><span class="line">    &#123;    </span><br><span class="line">        M-&gt;data[M-&gt;len].i = r;</span><br><span class="line">        M-&gt;data[M-&gt;len].j = c;</span><br><span class="line">        M-&gt;data[M-&gt;len].elem = element;</span><br><span class="line">        M-&gt;len++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="4"><a href="#4" class="headerlink" title="4."></a>4.</h2><p><img data-src="http://cdn.sekyoro.top/imgs/093448.png" alt="image-20210530155806685"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> maxsize 101</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">Tripe</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">int</span> data;</span><br><span class="line">    <span class="keyword">int</span> row;</span><br><span class="line">    <span class="keyword">int</span> col;</span><br><span class="line">&#125; Tripe;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">TSmatrix</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">int</span> num;</span><br><span class="line">    <span class="keyword">int</span> row,col;</span><br><span class="line">    Tripe Element[maxsize];</span><br><span class="line">&#125; TSmatrix, *pTsmatrix;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">initial</span><span class="params">(pTsmatrix)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(pTsmatrix, pTsmatrix, pTsmatrix)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">(pTsmatrix)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    pTsmatrix a = (pTsmatrix)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(TSmatrix));</span><br><span class="line">    pTsmatrix b = (pTsmatrix)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(TSmatrix));</span><br><span class="line">    pTsmatrix c = (pTsmatrix)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(TSmatrix));</span><br><span class="line">    <span class="keyword">int</span> r,col;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>,&amp;r,&amp;col);</span><br><span class="line">    a-&gt;row = b-&gt;row = c-&gt;row = r;</span><br><span class="line">    a-&gt;col = b-&gt;col = c-&gt;col = col;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;a-&gt;num, &amp;b-&gt;num);</span><br><span class="line">    initial(a);</span><br><span class="line">    initial(b);</span><br><span class="line">    add(a, b, c);</span><br><span class="line">    print(c);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">(pTsmatrix result)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= result-&gt;num; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d %d %d\n&quot;</span>, result-&gt;Element[i].row, result-&gt;Element[i].col, result-&gt;Element[i].data);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(pTsmatrix a, pTsmatrix b, pTsmatrix c)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">1</span>, j = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> k = <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span> ((i &lt;= a-&gt;num) &amp;&amp; (j &lt;= b-&gt;num))</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> ((a-&gt;Element[i].row == b-&gt;Element[j].row) &amp;&amp; (a-&gt;Element[i].col == b-&gt;Element[j].col))</span><br><span class="line">        &#123;<span class="comment">//两个非零元行相同列相同，则进行相加并判断值是否为0</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> ((a-&gt;Element[i].data + b-&gt;Element[j].data) == <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                i++;</span><br><span class="line">                j++;<span class="comment">//值为0则不管，i,j递增</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                k++;</span><br><span class="line">                c-&gt;Element[k].data = a-&gt;Element[i].data + b-&gt;Element[j].data;</span><br><span class="line">                c-&gt;Element[k].row = a-&gt;Element[i].row;</span><br><span class="line">                c-&gt;Element[k].col = a-&gt;Element[i].col;</span><br><span class="line">                i++;</span><br><span class="line">                j++;<span class="comment">//值不为0,则赋值并递增i,j,k</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> ((a-&gt;Element[i].row &lt; b-&gt;Element[j].row) || (a-&gt;Element[i].row == b-&gt;Element[j].row &amp;&amp; (a-&gt;Element[i].col &lt; b-&gt;Element[j].col)))</span><br><span class="line">        &#123;<span class="comment">//若a的非零元行数小于b的非零元,意味着c = a+0 则直接将a的值赋给c</span></span><br><span class="line">        <span class="comment">//后面同理，因为a元素对应在b矩阵处值为0</span></span><br><span class="line">        <span class="comment">//i,k递增</span></span><br><span class="line">            k++;</span><br><span class="line">            c-&gt;Element[k].row = a-&gt;Element[i].row;</span><br><span class="line">            c-&gt;Element[k].col = a-&gt;Element[i].col;</span><br><span class="line">            c-&gt;Element[k].data = a-&gt;Element[i].data;</span><br><span class="line">            i++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;<span class="comment">//剩下的情况就是b矩阵的值的位置对应在a矩阵中的值为0</span></span><br><span class="line">        <span class="comment">//即 c = 0+b</span></span><br><span class="line">        <span class="comment">//j,k递增</span></span><br><span class="line">            k++;</span><br><span class="line">            c-&gt;Element[k].row = b-&gt;Element[j].row;</span><br><span class="line">            c-&gt;Element[k].col = b-&gt;Element[j].col;</span><br><span class="line">            c-&gt;Element[k].data = b-&gt;Element[j].data;</span><br><span class="line">            j++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> (i &lt;= a-&gt;num)</span><br><span class="line">    &#123;<span class="comment">//若a矩阵中还有未处理完的非零元，则直接加上</span></span><br><span class="line">        k++;</span><br><span class="line">        c-&gt;Element[k].row = a-&gt;Element[i].row;</span><br><span class="line">        c-&gt;Element[k].col = a-&gt;Element[i].col;</span><br><span class="line">        c-&gt;Element[k].data = a-&gt;Element[i].data;</span><br><span class="line">        i++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> (j &lt;= b-&gt;num)</span><br><span class="line">    &#123;<span class="comment">//道理同上,b矩阵的值直接赋给c</span></span><br><span class="line">        k++;</span><br><span class="line">        c-&gt;Element[k].row = b-&gt;Element[j].row;</span><br><span class="line">        c-&gt;Element[k].col = b-&gt;Element[j].col;</span><br><span class="line">        c-&gt;Element[k].data = b-&gt;Element[j].data;</span><br><span class="line">        j++;</span><br><span class="line">    &#125;</span><br><span class="line">    c-&gt;num = k;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">initial</span><span class="params">(pTsmatrix p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= p-&gt;num; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d %d %d&quot;</span>, &amp;p-&gt;Element[i].row, &amp;p-&gt;Element[i].col, &amp;p-&gt;Element[i].data);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="5"><a href="#5" class="headerlink" title="5."></a>5.</h2><p><img data-src="http://cdn.sekyoro.top/imgs/065516.png" alt="image-20210530155750904"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">OLNode</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">int</span> i, j, e;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">OLNode</span> *<span class="title">down</span>, *<span class="title">right</span>;</span></span><br><span class="line">&#125; OLNode, *OLlink;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    OLlink *rhead, *chead; <span class="comment">//指向行或列第一个非零元(指向结构体的指针),可以用数组rhead[row]表示第row行的数据</span></span><br><span class="line">    <span class="keyword">int</span> m, n, len;         <span class="comment">//行列数,非零元个数</span></span><br><span class="line">&#125; CrossList;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">initial</span><span class="params">(CrossList *)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">plus</span><span class="params">(CrossList *, CrossList *)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">(CrossList *)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Insert</span><span class="params">(CrossList *, OLlink, OLlink, OLlink *, OLlink *)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(CrossList *, OLlink, OLlink, OLlink *, OLlink *)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    CrossList *M = (CrossList *)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(CrossList));</span><br><span class="line">    CrossList *N = (CrossList *)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(CrossList));</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;M-&gt;m, &amp;M-&gt;n);</span><br><span class="line">    N-&gt;m = M-&gt;m;</span><br><span class="line">    N-&gt;n = M-&gt;n;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;M-&gt;len, &amp;N-&gt;len);</span><br><span class="line">    initial(M);</span><br><span class="line">    initial(N);</span><br><span class="line">    plus(M, N);</span><br><span class="line">    print(M);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">(CrossList *M)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> row = <span class="number">1</span>; row &lt;= M-&gt;m; row++)</span><br><span class="line">    &#123;</span><br><span class="line">        OLlink pa = M-&gt;rhead[row];</span><br><span class="line">        <span class="keyword">while</span> (pa)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d %d %d\n&quot;</span>, pa-&gt;i, pa-&gt;j, pa-&gt;e);</span><br><span class="line">            pa = pa-&gt;right;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">plus</span><span class="params">(CrossList *M, CrossList *N)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    OLlink pa, pb;</span><br><span class="line">    OLlink pre; <span class="comment">//指向前面一个节点,方便插入</span></span><br><span class="line">    OLlink *hl = (OLlink *)<span class="built_in">malloc</span>((M-&gt;n + <span class="number">1</span>) * <span class="keyword">sizeof</span>(OLlink));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= M-&gt;n; j++)</span><br><span class="line">        hl[j] = M-&gt;chead[j]; <span class="comment">//hl[]表示的是每列非零元的pre指向元素，与pre类似</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> row = <span class="number">1</span>; row &lt;= M-&gt;m; row++) <span class="comment">//行遍历</span></span><br><span class="line">    &#123;</span><br><span class="line">        pa = M-&gt;rhead[row];</span><br><span class="line">        pb = N-&gt;rhead[row];</span><br><span class="line">        pre = <span class="literal">NULL</span>;</span><br><span class="line">        <span class="keyword">while</span> (pb) <span class="comment">//当pb有非零元素时进行处理</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (pa == <span class="literal">NULL</span> || pa-&gt;j &gt; pb-&gt;j)</span><br><span class="line">            &#123;</span><br><span class="line"></span><br><span class="line">                Insert(M, pa, pb, &amp;pre, hl);</span><br><span class="line">                pb = pb-&gt;right;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (pa != <span class="literal">NULL</span> &amp;&amp; pa-&gt;j &lt; pb-&gt;j)</span><br><span class="line">            &#123;</span><br><span class="line">                pre = pa;</span><br><span class="line">                pa = pa-&gt;right;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (pa-&gt;j == pb-&gt;j)</span><br><span class="line">            &#123;</span><br><span class="line">                add(M, pa, pb, &amp;pre, hl);</span><br><span class="line">                pb = pb-&gt;right;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(CrossList *M, OLlink pa, OLlink pb, OLlink *pre, OLlink *hl)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> data = pa-&gt;e + pb-&gt;e;</span><br><span class="line">    <span class="keyword">if</span> (data)</span><br><span class="line">    &#123;</span><br><span class="line">        pa-&gt;e = data;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        OLlink temp = (OLlink)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(OLNode));</span><br><span class="line">        <span class="keyword">if</span> ((*pre) == <span class="literal">NULL</span>)</span><br><span class="line">            M-&gt;rhead[pa-&gt;i] = pa-&gt;right;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            (*pre)-&gt;right = pa-&gt;right;</span><br><span class="line">        &#125;</span><br><span class="line">        temp = pa;</span><br><span class="line">        pa = pa-&gt;right;</span><br><span class="line">        <span class="keyword">if</span> (M-&gt;chead[temp-&gt;j] == temp)</span><br><span class="line">            M-&gt;chead[temp-&gt;j] = hl[temp-&gt;j] = temp-&gt;down;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            hl[temp-&gt;j]-&gt;down = temp-&gt;down;</span><br><span class="line">        <span class="built_in">free</span>(temp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Insert</span><span class="params">(CrossList *M, OLlink pa, OLlink pb, OLlink *pre, OLlink *hl)</span> <span class="comment">//插入有两种情况，一种是pa该行无非零元素，另一种pb所在列小于pa所在列</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    OLlink p = (OLlink)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(OLNode));</span><br><span class="line">    p-&gt;i = pb-&gt;i;</span><br><span class="line">    p-&gt;j = pb-&gt;j;</span><br><span class="line">    p-&gt;e = pb-&gt;e;</span><br><span class="line">    p-&gt;down = p-&gt;right = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">if</span> ((*pre) == <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        M-&gt;rhead[p-&gt;i] = p;</span><br><span class="line">      </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        (*pre)-&gt;right = p;</span><br><span class="line">      </span><br><span class="line">    &#125;</span><br><span class="line">    p-&gt;right = pa;</span><br><span class="line">    </span><br><span class="line">    (*pre) = p;</span><br><span class="line">   <span class="comment">// pa = (*pre)-&gt;right;//这一句可以不要</span></span><br><span class="line">    <span class="keyword">if</span> (!M-&gt;chead[p-&gt;j] || M-&gt;chead[p-&gt;j]-&gt;i &gt; p-&gt;i)</span><br><span class="line">    &#123;</span><br><span class="line">        p-&gt;down = M-&gt;chead[p-&gt;j];</span><br><span class="line">        M-&gt;chead[p-&gt;j] = p;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        p-&gt;down = hl[p-&gt;j]-&gt;down;</span><br><span class="line">        hl[p-&gt;j]-&gt;down = p;</span><br><span class="line">    &#125;</span><br><span class="line">    hl[p-&gt;j] = p;</span><br><span class="line">   </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">initial</span><span class="params">(CrossList *Clist)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i, j, e;</span><br><span class="line">    Clist-&gt;rhead = (OLlink *)<span class="built_in">malloc</span>((Clist-&gt;m + <span class="number">1</span>) * <span class="keyword">sizeof</span>(OLlink));</span><br><span class="line">    Clist-&gt;chead = (OLlink *)<span class="built_in">malloc</span>((Clist-&gt;n + <span class="number">1</span>) * <span class="keyword">sizeof</span>(OLlink));</span><br><span class="line">    <span class="comment">// if(rhead||chead)</span></span><br><span class="line">    <span class="comment">// exit(1);</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= Clist-&gt;m; i++)</span><br><span class="line">        Clist-&gt;rhead[i] = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= Clist-&gt;n; i++)</span><br><span class="line">        Clist-&gt;chead[i] = <span class="literal">NULL</span>;</span><br><span class="line">    OLlink s = (OLlink)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(OLNode));</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> count = <span class="number">0</span>; count &lt; Clist-&gt;len; count++)</span><br><span class="line">    &#123;</span><br><span class="line">        OLlink cur = (OLlink)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(OLNode));</span><br><span class="line">        cur-&gt;down = <span class="literal">NULL</span>;</span><br><span class="line">        cur-&gt;right = <span class="literal">NULL</span>;</span><br><span class="line">        <span class="comment">// if(cur==NULL)</span></span><br><span class="line">        <span class="comment">// exit(1);</span></span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d %d %d&quot;</span>, &amp;i, &amp;j, &amp;e);</span><br><span class="line">        cur-&gt;i = i;</span><br><span class="line">        cur-&gt;j = j;</span><br><span class="line">        cur-&gt;e = e;</span><br><span class="line">        <span class="keyword">if</span> (Clist-&gt;rhead[i] == <span class="literal">NULL</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            Clist-&gt;rhead[i] = cur;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            s = Clist-&gt;rhead[i];</span><br><span class="line">            <span class="keyword">while</span> (s-&gt;right != <span class="literal">NULL</span> &amp;&amp; s-&gt;right-&gt;j &lt; j)</span><br><span class="line">                s = s-&gt;right;</span><br><span class="line">            cur-&gt;right = s-&gt;right;</span><br><span class="line">            s-&gt;right = cur;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (Clist-&gt;chead[j] == <span class="literal">NULL</span>)</span><br><span class="line">            Clist-&gt;chead[j] = cur;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            s = Clist-&gt;chead[j];</span><br><span class="line">            <span class="keyword">while</span> (s-&gt;down != <span class="literal">NULL</span> &amp;&amp; s-&gt;down-&gt;i &lt; i)</span><br><span class="line">                s = s-&gt;down;</span><br><span class="line">            cur-&gt;down = s-&gt;down;</span><br><span class="line">            s-&gt;down = cur;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="6"><a href="#6" class="headerlink" title="6."></a>6.</h2><p><img data-src="http://cdn.sekyoro.top/imgs/093450.png" alt="image-20210530155731455"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAXSIZE 1000 <span class="comment">//非零元个数</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAXRs 500    <span class="comment">//矩阵最大行数</span></span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">Triple</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">int</span> row, col;</span><br><span class="line">    <span class="keyword">int</span> elem;</span><br><span class="line">&#125; Triple;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">RLSMatrix</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    Triple data[MAXSIZE];</span><br><span class="line">    <span class="keyword">int</span> rpos[MAXRs]; <span class="comment">//第row行第一个非零元在结果三元组中的位置</span></span><br><span class="line">    <span class="keyword">int</span> mu, nu, tu;  <span class="comment">//分别表示行数,列数非零元个数</span></span><br><span class="line">&#125; RLSMatrix;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Multi</span><span class="params">(RLSMatrix *, RLSMatrix *, RLSMatrix *)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">initial</span><span class="params">(RLSMatrix *)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">(RLSMatrix *)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    RLSMatrix *M = (RLSMatrix *)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(RLSMatrix));</span><br><span class="line">    RLSMatrix *N = (RLSMatrix *)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(RLSMatrix));</span><br><span class="line">    RLSMatrix *result = (RLSMatrix *)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(RLSMatrix));</span><br><span class="line">    initial(M);</span><br><span class="line">    initial(N);</span><br><span class="line">    Multi(M, N, result);</span><br><span class="line">    print(result);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">(RLSMatrix* result)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i&lt;=result-&gt;tu;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d %d %d\n&quot;</span>,result-&gt;data[i].row,result-&gt;data[i].col,result-&gt;data[i].elem);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Multi</span><span class="params">(RLSMatrix *M, RLSMatrix *N, RLSMatrix *Q)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> arow, brow; <span class="comment">//M,N矩阵的row</span></span><br><span class="line">    <span class="keyword">int</span> ccol;       <span class="comment">//Q结果矩阵的col</span></span><br><span class="line">    <span class="keyword">int</span> ctemp[MAXSIZE] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="comment">// if(M-&gt;mu!=N-&gt;nu)</span></span><br><span class="line">    <span class="comment">// exit(1);</span></span><br><span class="line">    Q-&gt;mu = M-&gt;mu;</span><br><span class="line">    Q-&gt;nu = N-&gt;nu;</span><br><span class="line">    Q-&gt;tu = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (M-&gt;tu &amp;&amp; N-&gt;tu)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (arow = <span class="number">1</span>; arow &lt;= M-&gt;mu; arow++)<span class="comment">//对于M的每一行,根据行数确定三元组表取值范围(p)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">memset</span>(ctemp,<span class="number">0</span>,(N-&gt;nu+<span class="number">1</span>)*(<span class="keyword">sizeof</span>(<span class="keyword">int</span>)));</span><br><span class="line">            Q-&gt;rpos[arow] = Q-&gt;tu+<span class="number">1</span>;<span class="comment">//每一行第一个非零元在三元组的位置是此时的非零元个数+1</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> p = M-&gt;rpos[arow]; p &lt; M-&gt;rpos[arow + <span class="number">1</span>]; p++)<span class="comment">//对于每一行的各个元素,取其列</span></span><br><span class="line">            &#123;</span><br><span class="line">                brow = M-&gt;data[p].col;<span class="comment">//列为N所对应的行数</span></span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> q = N-&gt;rpos[brow]; q &lt; N-&gt;rpos[brow + <span class="number">1</span>]; q++)</span><br><span class="line">                &#123;</span><br><span class="line">                    ccol = N-&gt;data[q].col;<span class="comment">//取得ccol为结果矩阵元素对应的列数</span></span><br><span class="line">                    ctemp[ccol] += M-&gt;data[p].elem * N-&gt;data[q].elem;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span> (ccol = <span class="number">1</span>; ccol &lt;= Q-&gt;nu; ++ccol)<span class="comment">//对于每一列</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (ctemp[ccol])</span><br><span class="line">                &#123;</span><br><span class="line">                    Q-&gt;tu++;</span><br><span class="line">                    Q-&gt;data[Q-&gt;tu].row = arow;</span><br><span class="line">                    Q-&gt;data[Q-&gt;tu].col = ccol;</span><br><span class="line">                    Q-&gt;data[Q-&gt;tu].elem = ctemp[ccol];</span><br><span class="line">                    </span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">initial</span><span class="params">(RLSMatrix *M)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;M-&gt;mu, &amp;M-&gt;nu);</span><br><span class="line">    <span class="keyword">int</span> i, j, e;</span><br><span class="line">    <span class="keyword">int</span> count = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (<span class="built_in">scanf</span>(<span class="string">&quot;%d %d %d&quot;</span>, &amp;i, &amp;j, &amp;e) &amp;&amp; (i != <span class="number">0</span> || j != <span class="number">0</span> || e != <span class="number">0</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        M-&gt;data[count].row = i;</span><br><span class="line">        M-&gt;data[count].col = j;</span><br><span class="line">        M-&gt;data[count].elem = e;</span><br><span class="line">        count++;</span><br><span class="line">    &#125;</span><br><span class="line">    M-&gt;tu = count<span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">int</span> num[MAXSIZE] = &#123;<span class="number">0</span>&#125;; </span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i&lt;=M-&gt;tu;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        num[M-&gt;data[i].row]++;</span><br><span class="line">    &#125;</span><br><span class="line">    M-&gt;rpos[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">2</span>;i&lt;=M-&gt;mu;i++)</span><br><span class="line">    M-&gt;rpos[i] = M-&gt;rpos[i<span class="number">-1</span>]+num[i<span class="number">-1</span>];</span><br><span class="line">    M-&gt;rpos[M-&gt;mu+<span class="number">1</span>] = M-&gt;tu+<span class="number">1</span>; </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="7"><a href="#7" class="headerlink" title="7."></a>7.</h2><p><img data-src="http://cdn.sekyoro.top/imgs/093454.png" alt="image-20210530155715476"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> N 100</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> M (2 * N - 1)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">char</span> *HuffmanCode[N + <span class="number">1</span>];</span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">int</span> weight; <span class="comment">//权值</span></span><br><span class="line">    <span class="keyword">int</span> parent; <span class="comment">//父节点在ht数组中的位置</span></span><br><span class="line">    <span class="keyword">int</span> Lchild; <span class="comment">//左孩子在ht数组中的位置</span></span><br><span class="line">    <span class="keyword">int</span> Rchild; <span class="comment">//右孩子在ht数组中的位置</span></span><br><span class="line">    <span class="keyword">char</span> c;     <span class="comment">//字符</span></span><br><span class="line">&#125; HTNode, HuffmanTree[M + <span class="number">1</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">CrtHuffmanTree</span><span class="params">(HuffmanTree, <span class="keyword">int</span>)</span></span>;       <span class="comment">//构造哈夫曼树</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">select</span><span class="params">(HuffmanTree, <span class="keyword">int</span>, <span class="keyword">int</span> *, <span class="keyword">int</span> *)</span></span>; <span class="comment">//用于寻找最小的两个值</span></span><br><span class="line"><span class="comment">//hc[N+1]为相应节点的编码</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">CrtHuffmanCode</span><span class="params">(HuffmanTree, HuffmanCode, <span class="keyword">int</span>)</span></span>; <span class="comment">//根据哈夫曼树得到相应编码</span></span><br><span class="line"><span class="comment">//解码得到明文</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">decode</span><span class="params">(HuffmanTree, HuffmanCode, <span class="keyword">int</span>, <span class="keyword">char</span> *)</span></span>;</span><br><span class="line"><span class="comment">//编码得到二进制串</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">encode</span><span class="params">(HuffmanTree, HuffmanCode, <span class="keyword">int</span>, <span class="keyword">char</span> *)</span></span>;</span><br><span class="line"><span class="comment">//根据HuffmanTree得到HuffmanCode</span></span><br><span class="line"><span class="comment">//HuffmanCode储存的是每个字符对应的编码</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">test</span><span class="params">(HuffmanTree ht, <span class="keyword">int</span> n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> weight_[N + <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;weight_[i]); <span class="comment">//输入n个叶子节点的权值</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        ht[i].weight = weight_[i];</span><br><span class="line">        ht[i].parent = ht[i].Rchild = ht[i].Lchild = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, ht[i].weight);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> size;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;size);</span><br><span class="line">    getchar();</span><br><span class="line">    HuffmanTree ht;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= size; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%c&quot;</span>, &amp;ht[i].c); <span class="comment">//输入n个叶子节点的字符</span></span><br><span class="line">        getchar();</span><br><span class="line">    &#125;</span><br><span class="line">    CrtHuffmanTree(ht, size);</span><br><span class="line">    HuffmanCode hc;</span><br><span class="line">    CrtHuffmanCode(ht, hc, size);</span><br><span class="line">    <span class="comment">//  test(ht,size);</span></span><br><span class="line">    <span class="keyword">char</span> encoding_text[<span class="number">100</span>] = &#123;<span class="string">&#x27;\0&#x27;</span>&#125;;</span><br><span class="line">    encode(ht, hc, size, encoding_text);</span><br><span class="line">    decode(ht, hc, size, encoding_text);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">CrtHuffmanTree</span><span class="params">(HuffmanTree ht, <span class="keyword">int</span> n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// int w[N + 1];</span></span><br><span class="line">    <span class="comment">// for (int i = 1; i &lt;= n; i++)</span></span><br><span class="line">    <span class="comment">//     scanf(&quot;%d&quot;, &amp;w[i]); //输入n个叶子节点的权值</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;ht[i].weight); <span class="comment">//输入n个叶子节点的权值</span></span><br><span class="line">        ht[i].parent = ht[i].Rchild = ht[i].Lchild = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> m = <span class="number">2</span> * n - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = n + <span class="number">1</span>; i &lt;= m; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        ht[i].weight = <span class="number">0</span>;</span><br><span class="line">        ht[i].parent = ht[i].Rchild = ht[i].Lchild = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> s1, s2; <span class="comment">//s1,s2为两个值最小的无父结点</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = n + <span class="number">1</span>; i &lt;= m; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        select(ht, i - <span class="number">1</span>, &amp;s1, &amp;s2);</span><br><span class="line">        ht[i].weight = ht[s1].weight + ht[s2].weight;</span><br><span class="line">        ht[s1].parent = ht[s2].parent = i;</span><br><span class="line">        ht[i].Lchild = s1;</span><br><span class="line">        ht[i].Rchild = s2;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">select</span><span class="params">(HuffmanTree ht, <span class="keyword">int</span> n, <span class="keyword">int</span> *s1, <span class="keyword">int</span> *s2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> min_1_w = <span class="number">10000</span>; <span class="comment">//用来找最小值</span></span><br><span class="line">    <span class="keyword">int</span> min_2_w = <span class="number">10000</span>; <span class="comment">//用来找最小值</span></span><br><span class="line">    <span class="keyword">int</span> min;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (ht[i].parent == <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (ht[i].weight &lt; min_1_w)</span><br><span class="line">            &#123;</span><br><span class="line">                min_1_w = ht[i].weight;</span><br><span class="line">                min = i;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="comment">//找到第一个最小值</span></span><br><span class="line">    *s1 = min;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= n; j++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (ht[j].parent == <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (j != *s1 &amp;&amp; ht[j].weight &lt; min_2_w) <span class="comment">//倒数第二小的值大于等于最小的值,小于其余值</span></span><br><span class="line">            &#123;</span><br><span class="line">                min_2_w = ht[j].weight;</span><br><span class="line">                min = j;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="comment">//最小的第二个值</span></span><br><span class="line">    *s2 = min;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">CrtHuffmanCode</span><span class="params">(HuffmanTree ht, HuffmanCode hc, <span class="keyword">int</span> n)</span> <span class="comment">//建立好哈夫曼树后,得到哈夫曼编码</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> *cd;                              <span class="comment">//cd是指向字符的指针,用来存储字符串</span></span><br><span class="line">    cd = (<span class="keyword">char</span> *)<span class="built_in">malloc</span>(n * <span class="keyword">sizeof</span>(<span class="keyword">char</span>)); <span class="comment">//开辟n个单元,因为共有n个结点,最多只有n-1个编码位</span></span><br><span class="line">    cd[n - <span class="number">1</span>] = <span class="string">&#x27;\0&#x27;</span>;                      <span class="comment">//因为存储字符串,最后一位为空字符</span></span><br><span class="line">    <span class="keyword">int</span> start, c;                          <span class="comment">//start为cd数组开始存储的起点,c用来标记每次往上找到的双亲的位置</span></span><br><span class="line">    <span class="keyword">int</span> p;                                 <span class="comment">//p为双亲的位置</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        start = n - <span class="number">1</span>;    <span class="comment">//这是cd数组的最后一位,是&#x27;/0&#x27;，因为储存字符串</span></span><br><span class="line">        c = i;            <span class="comment">//c为第一个结点,得到第一个结点的编码</span></span><br><span class="line">        p = ht[i].parent; <span class="comment">//寻找结点父亲</span></span><br><span class="line">        <span class="keyword">while</span> (p)         <span class="comment">//若有父亲结点</span></span><br><span class="line">        &#123;</span><br><span class="line">            --start;               <span class="comment">//每次递减,从后向前得到编码</span></span><br><span class="line">            <span class="keyword">if</span> (ht[p].Lchild == c) <span class="comment">//若子节点为左孩子,则为0</span></span><br><span class="line">                cd[start] = <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                cd[start] = <span class="string">&#x27;1&#x27;</span>;</span><br><span class="line">            c = p;</span><br><span class="line">            p = ht[p].parent;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        while循环可改为</span></span><br><span class="line"><span class="comment">        for(c=i,p=ht[i].parent;p!=0;c=p,p=ht[p].parent)</span></span><br><span class="line"><span class="comment">        &#123;</span></span><br><span class="line"><span class="comment">             --start;</span></span><br><span class="line"><span class="comment">            if (ht[p].Lchild == c)</span></span><br><span class="line"><span class="comment">                cd[start] = &#x27;0&#x27;;</span></span><br><span class="line"><span class="comment">            else</span></span><br><span class="line"><span class="comment">                cd[start] = &#x27;1&#x27;;</span></span><br><span class="line"><span class="comment">            c = p;</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        hc[i] = (<span class="keyword">char</span> *)<span class="built_in">malloc</span>((n - start) * <span class="keyword">sizeof</span>(<span class="keyword">char</span>)); <span class="comment">//为hc[i]分配空间,空间大小为编码的位数+1,最后一位为&#x27;\0&#x27;</span></span><br><span class="line">        <span class="built_in">strcpy</span>(hc[i], &amp;cd[start]);                          <span class="comment">//注意这里取地址符不可以去掉,因为本身cd是一个数组(指针),但复制时应该从start开始,所以取数组start位的元素地址</span></span><br><span class="line">                                                            <span class="comment">//   printf(&quot;%d:%s\n&quot;,i,hc[i]);//hc 存储的是n个字符分别的编码</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">free</span>(cd);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">decode</span><span class="params">(HuffmanTree ht, HuffmanCode hc, <span class="keyword">int</span> n, <span class="keyword">char</span> *encoding_text)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> *text = (<span class="keyword">char</span> *)<span class="built_in">malloc</span>(n * <span class="keyword">sizeof</span>(<span class="keyword">char</span>));</span><br><span class="line">    <span class="built_in">memset</span>(text, <span class="string">&#x27;\0&#x27;</span>, <span class="keyword">sizeof</span>(text));</span><br><span class="line">    <span class="keyword">int</span> pos = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> t_pos = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (encoding_text[pos] != <span class="string">&#x27;\0&#x27;</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        text[t_pos++] = encoding_text[pos++];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">strcmp</span>(text, hc[i])==<span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;%c&quot;</span>, ht[i].c);</span><br><span class="line">                <span class="built_in">memset</span>(text, <span class="string">&#x27;\0&#x27;</span>, n * <span class="keyword">sizeof</span>(<span class="keyword">char</span>));</span><br><span class="line">                t_pos = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// else</span></span><br><span class="line">            <span class="comment">// &#123;</span></span><br><span class="line">            <span class="comment">//     text[t_pos++] = encoding_text[pos++];</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// &#125;</span></span><br><span class="line">        &#125;</span><br><span class="line">       <span class="comment">// text[t_pos++] = encoding_text[pos++];</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">encode</span><span class="params">(HuffmanTree ht, HuffmanCode hc, <span class="keyword">int</span> n, <span class="keyword">char</span> *encoding_text)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//得到了哈夫曼编码,因为知道了每个字符相应的编码,解码就很简单了</span></span><br><span class="line">    <span class="comment">//进行编码</span></span><br><span class="line">    getchar();</span><br><span class="line">    <span class="keyword">char</span> text[<span class="number">1000</span>]; <span class="comment">//进行编码的文本</span></span><br><span class="line">    fgets(text, <span class="number">1000</span>, <span class="built_in">stdin</span>);</span><br><span class="line">    <span class="keyword">char</span> c;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; text[i] != <span class="string">&#x27;\0&#x27;</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        c = text[i];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= n; j++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (ht[j].c == c)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;%s&quot;</span>, hc[j]);</span><br><span class="line">                <span class="built_in">strcat</span>(encoding_text, hc[j]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="8"><a href="#8" class="headerlink" title="8."></a>8.</h2><p><img data-src="http://cdn.sekyoro.top/imgs/093500.png" alt="image-20210530155656921"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_Node 100</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">int</span> vex[MAX_Node];            <span class="comment">//顶点信息</span></span><br><span class="line">    <span class="keyword">int</span> arcs[MAX_Node][MAX_Node]; <span class="comment">//权值  邻接矩阵信息</span></span><br><span class="line">    <span class="keyword">int</span> arccount, vexcount;       <span class="comment">//顶点个数,边的个数</span></span><br><span class="line">&#125; Graph, *PGraph;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">initial</span><span class="params">(PGraph)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">find_minpath</span><span class="params">(PGraph)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">output</span><span class="params">(PGraph)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">    PGraph g = (PGraph)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(Graph));</span><br><span class="line">    initial(g);</span><br><span class="line">    find_minpath(g);</span><br><span class="line">    output(g);</span><br><span class="line">    <span class="built_in">free</span>(g);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">output</span><span class="params">(PGraph g)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i&lt;g-&gt;vexcount;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,g-&gt;arcs[<span class="number">0</span>][i]);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">find_minpath</span><span class="params">(PGraph g)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//记录节点是否已经判断过</span></span><br><span class="line">    <span class="comment">//1表示判断过</span></span><br><span class="line">    <span class="keyword">int</span> visited[MAX_Node];</span><br><span class="line">    <span class="comment">//记录0到各节点的最短路径</span></span><br><span class="line">    <span class="keyword">int</span> dist[MAX_Node];</span><br><span class="line">    <span class="keyword">int</span> min;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> flag;<span class="comment">//标记</span></span><br><span class="line">    <span class="comment">//初始化</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; g-&gt;vexcount; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        visited[i] = <span class="number">0</span>;          <span class="comment">//初始化,未判断</span></span><br><span class="line">        dist[i] = g-&gt;arcs[<span class="number">0</span>][i]; <span class="comment">//初始化距离</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    visited[<span class="number">0</span>] = <span class="number">1</span>; <span class="comment">//初始节点置为判断</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; g-&gt;vexcount; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        min = <span class="number">10000</span>;<span class="comment">//最大值</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; g-&gt;vexcount; j++)<span class="comment">//遍历每个节点</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (visited[j] == <span class="number">0</span>)<span class="comment">//未判断,即没有在集合中，尚未处理</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (dist[j] &lt; min)<span class="comment">//不是最大值min</span></span><br><span class="line">                &#123;</span><br><span class="line">                    flag = j; <span class="comment">//如果距离比MIN小,则j为中间路径,更新</span></span><br><span class="line">                    min = dist[j];</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">            visited[flag] = <span class="number">1</span>;<span class="comment">//置为判断</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">//更新路径</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; g-&gt;vexcount; j++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (visited[j] == <span class="number">0</span> &amp;&amp; (min + g-&gt;arcs[flag][j] &lt; dist[j]))</span><br><span class="line">                &#123;</span><br><span class="line">                    dist[j] = min + g-&gt;arcs[flag][j];</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i&lt;g-&gt;vexcount;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        g-&gt;arcs[<span class="number">0</span>][i] = dist[i];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">initial</span><span class="params">(PGraph g)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;g-&gt;vexcount);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; g-&gt;vexcount; i++)</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; g-&gt;vexcount; j++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;g-&gt;arcs[i][j]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="9"><a href="#9" class="headerlink" title="9."></a>9.</h2><p><img data-src="http://cdn.sekyoro.top/imgs/093501.png" alt="image-20210530155639357"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_Node 100</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">int</span> vex[MAX_Node];            <span class="comment">//顶点信息</span></span><br><span class="line">    <span class="keyword">int</span> arcs[MAX_Node][MAX_Node]; <span class="comment">//权值  邻接矩阵信息</span></span><br><span class="line">    <span class="keyword">int</span> arccount, vexcount;       <span class="comment">//顶点个数,边的个数</span></span><br><span class="line">&#125; Graph, *PGraph;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">initial</span><span class="params">(PGraph)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">find_minpath</span><span class="params">(PGraph,<span class="keyword">int</span>[])</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">output</span><span class="params">(PGraph, <span class="keyword">int</span>[])</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> x, y;<span class="comment">//从x到y的最短路径</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> way[MAX_Node];</span><br><span class="line">    PGraph g = (PGraph)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(Graph));</span><br><span class="line">    initial(g);</span><br><span class="line">    find_minpath(g,way);</span><br><span class="line">    output(g,way);</span><br><span class="line">    <span class="built_in">free</span>(g);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">output</span><span class="params">(PGraph g, <span class="keyword">int</span> way[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> tmp, ans[MAX_Node], k = <span class="number">0</span>;</span><br><span class="line">    tmp = y;</span><br><span class="line">    <span class="keyword">while</span> (tmp != x)</span><br><span class="line">    &#123;</span><br><span class="line">        ans[k++] = tmp;</span><br><span class="line">        tmp = way[tmp];<span class="comment">//逆推,到达y点需要经过哪个点</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//当tmp==x时跳出,到达x点需要经过x</span></span><br><span class="line">    ans[k] = way[x];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = k; i &gt;= <span class="number">0</span>; i--)</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, ans[i]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">find_minpath</span><span class="params">(PGraph g,<span class="keyword">int</span> way[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//记录节点是否已经判断过</span></span><br><span class="line">    <span class="comment">//1表示判断过</span></span><br><span class="line">    <span class="keyword">int</span> visited[MAX_Node];</span><br><span class="line">    <span class="comment">//记录0到各节点的最短路径</span></span><br><span class="line">    <span class="keyword">int</span> dist[MAX_Node];</span><br><span class="line">    <span class="keyword">int</span> min;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> flag; <span class="comment">//标记</span></span><br><span class="line">    <span class="comment">//初始化</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>, &amp;x, &amp;y); <span class="comment">//输入要求路径的两个点</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; g-&gt;vexcount; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        visited[i] = <span class="number">0</span>;          <span class="comment">//初始化,未判断</span></span><br><span class="line">        dist[i] = g-&gt;arcs[x][i]; <span class="comment">//初始化距离,从x到各点的距离</span></span><br><span class="line">        way[i] = x;<span class="comment">//初始化,到达第i点经过x 即 经过x到达i</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    visited[x] = <span class="number">1</span>; <span class="comment">//初始节点置为判断</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; g-&gt;vexcount; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        min = <span class="number">10000</span>; <span class="comment">//最大值</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; g-&gt;vexcount; j++) <span class="comment">//遍历每个节点</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (visited[j] == <span class="number">0</span>) <span class="comment">//未判断,即没有在集合中，尚未处理</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (dist[j] &lt; min) <span class="comment">//不是最大值min</span></span><br><span class="line">                &#123;</span><br><span class="line">                    flag = j; <span class="comment">//如果距离比MIN小,则j为中间路径,更新</span></span><br><span class="line">                    min = dist[j];</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        visited[flag] = <span class="number">1</span>; <span class="comment">//置为判断</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//更新路径</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; g-&gt;vexcount; j++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (visited[j] == <span class="number">0</span> &amp;&amp; (min + g-&gt;arcs[flag][j] &lt; dist[j]))</span><br><span class="line">            &#123;</span><br><span class="line">                dist[j] = min + g-&gt;arcs[flag][j];</span><br><span class="line">                way[j] = flag;<span class="comment">//到达j点经过flag</span></span><br><span class="line">                <span class="comment">//这里加上路径</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">initial</span><span class="params">(PGraph g)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;g-&gt;vexcount);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; g-&gt;vexcount; i++)</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; g-&gt;vexcount; j++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;g-&gt;arcs[i][j]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="10"><a href="#10" class="headerlink" title="10."></a>10.</h2><p><img data-src="http://cdn.sekyoro.top/imgs/093503.png" alt="image-20210530155622500"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_Node 100</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX 10000</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">int</span> vex[MAX_Node];            <span class="comment">//顶点信息</span></span><br><span class="line">    <span class="keyword">int</span> arcs[MAX_Node][MAX_Node]; <span class="comment">//权值  邻接矩阵信息</span></span><br><span class="line">    <span class="keyword">int</span> arccount, vexcount;       <span class="comment">//顶点个数,边的个数</span></span><br><span class="line">&#125; Graph, *PGraph;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">ShortPath</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="comment">/* 矩阵A，存放每对顶点间最短路径长度 */</span></span><br><span class="line">    <span class="keyword">int</span> a[MAX_Node][MAX_Node];</span><br><span class="line">    <span class="comment">/* nextvex[i][j]存放vi到vj最短路径上vi的后继顶点的下标值 */</span></span><br><span class="line">    <span class="keyword">int</span> nextvex[MAX_Node][MAX_Node];</span><br><span class="line">&#125; ShortPath, *path;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">initial</span><span class="params">(PGraph)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">find_minpath</span><span class="params">(PGraph, path)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">output</span><span class="params">(path,<span class="keyword">int</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> count; </span><br><span class="line">    PGraph g = (PGraph)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(Graph));</span><br><span class="line">    path p = (path)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(ShortPath));</span><br><span class="line">    initial(g);  </span><br><span class="line">    find_minpath(g, p);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;count);</span><br><span class="line">    output(p,count);</span><br><span class="line">    <span class="built_in">free</span>(g);</span><br><span class="line">    <span class="built_in">free</span>(p);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">output</span><span class="params">(path p,<span class="keyword">int</span> count)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> x,y;</span><br><span class="line">    <span class="keyword">while</span>(count--)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>,&amp;x,&amp;y);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,p-&gt;a[x][y]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">find_minpath</span><span class="params">(PGraph g, path p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i, j, k;</span><br><span class="line">    <span class="comment">//初始化</span></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; g-&gt;vexcount; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; g-&gt;vexcount; j++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (g-&gt;arcs[i][j] &lt; MAX)  <span class="comment">//如果两点存在路径</span></span><br><span class="line">                p-&gt;nextvex[i][j] = j; <span class="comment">//先把j初始化为i的下一个结点</span></span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                p-&gt;nextvex[i][j] = <span class="number">-1</span>; <span class="comment">//如果不存在该路径,则没有,置为-1</span></span><br><span class="line">            &#125;</span><br><span class="line">            p-&gt;a[i][j] = g-&gt;arcs[i][j]; <span class="comment">//距离初始化</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (k = <span class="number">0</span>; k &lt; g-&gt;vexcount; k++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; g-&gt;vexcount; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; g-&gt;vexcount; j++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">//k作为插入点,遍历 i,j</span></span><br><span class="line">                <span class="comment">//如果路径不存在,则继续</span></span><br><span class="line">                <span class="keyword">if</span> ((p-&gt;a[i][k] &gt;= MAX) || (p-&gt;a[k][j] &gt;= MAX))</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//如果路径存在且比直接路径短</span></span><br><span class="line">                <span class="keyword">if</span>(p-&gt;a[i][j]&gt;(p-&gt;a[i][k]+p-&gt;a[k][j]))</span><br><span class="line">                &#123;</span><br><span class="line">                       p-&gt;a[i][j]=p-&gt;a[i][k]+p-&gt;a[k][j];</span><br><span class="line">                       p-&gt;nextvex[i][j] = p-&gt;nextvex[k][j];<span class="comment">//将插入的点作为i的下一个点</span></span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">initial</span><span class="params">(PGraph g)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;g-&gt;vexcount);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; g-&gt;vexcount; i++)</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; g-&gt;vexcount; j++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;g-&gt;arcs[i][j]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="11"><a href="#11" class="headerlink" title="11."></a>11.</h2><p><img data-src="http://cdn.sekyoro.top/imgs/093504.png" alt="image-20210530155607489"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_Node 100</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX 10000</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">int</span> vex[MAX_Node];            <span class="comment">//顶点信息</span></span><br><span class="line">    <span class="keyword">int</span> arcs[MAX_Node][MAX_Node]; <span class="comment">//权值  邻接矩阵信息</span></span><br><span class="line">    <span class="keyword">int</span> arccount, vexcount;       <span class="comment">//顶点个数,边的个数</span></span><br><span class="line">&#125; Graph, *PGraph;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">ShortPath</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="comment">/* 矩阵A，存放每对顶点间最短路径长度 */</span></span><br><span class="line">    <span class="keyword">int</span> a[MAX_Node][MAX_Node];</span><br><span class="line">    <span class="comment">/* nextvex[i][j]存放vi到vj最短路径上vi的后继顶点的下标值 */</span></span><br><span class="line">    <span class="keyword">int</span> nextvex[MAX_Node][MAX_Node];</span><br><span class="line">&#125; ShortPath, *path;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">initial</span><span class="params">(PGraph)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">find_minpath</span><span class="params">(PGraph, path)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">output</span><span class="params">(path, <span class="keyword">int</span>, <span class="keyword">int</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> count;</span><br><span class="line">    <span class="keyword">int</span> x, y;</span><br><span class="line"></span><br><span class="line">    PGraph g = (PGraph)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(Graph));</span><br><span class="line">    path p = (path)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(ShortPath));</span><br><span class="line">    initial(g);</span><br><span class="line">    find_minpath(g, p);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;count);</span><br><span class="line">    <span class="keyword">while</span> (count--)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>, &amp;x, &amp;y);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, x); <span class="comment">//先输出首节点</span></span><br><span class="line">        output(p, x, y);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, y); <span class="comment">//若不存在中间节点,则输出尾结点</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">free</span>(g);</span><br><span class="line">    <span class="built_in">free</span>(p);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">output</span><span class="params">(path p, <span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> mid; <span class="comment">//中间节点</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (p-&gt;nextvex[x][y] != y) <span class="comment">//如果存在中间节点</span></span><br><span class="line">    &#123;</span><br><span class="line">        mid = p-&gt;nextvex[x][y];</span><br><span class="line">        <span class="keyword">if</span> (mid != <span class="number">-1</span>) <span class="comment">//存在弧</span></span><br><span class="line">        &#123;</span><br><span class="line">            output(p, x, mid);</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, p-&gt;nextvex[x][y]);</span><br><span class="line">            output(p, mid, y);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">find_minpath</span><span class="params">(PGraph g, path p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i, j, k;</span><br><span class="line">    <span class="comment">//初始化</span></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; g-&gt;vexcount; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; g-&gt;vexcount; j++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (g-&gt;arcs[i][j] &lt; MAX)  <span class="comment">//如果两点存在路径</span></span><br><span class="line">                p-&gt;nextvex[i][j] = j; <span class="comment">//先把j初始化为i的下一个结点</span></span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                p-&gt;nextvex[i][j] = <span class="number">-1</span>; <span class="comment">//如果不存在该路径,则没有,置为-1</span></span><br><span class="line">            &#125;</span><br><span class="line">            p-&gt;a[i][j] = g-&gt;arcs[i][j]; <span class="comment">//距离初始化</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (k = <span class="number">0</span>; k &lt; g-&gt;vexcount; k++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; g-&gt;vexcount; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; g-&gt;vexcount; j++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">//k作为插入点,遍历 i,j</span></span><br><span class="line">                <span class="comment">//如果路径不存在,则继续</span></span><br><span class="line">                <span class="keyword">if</span> ((p-&gt;a[i][k] &gt;= MAX) || (p-&gt;a[k][j] &gt;= MAX))</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//如果路径存在且比直接路径短</span></span><br><span class="line">                <span class="keyword">if</span> (p-&gt;a[i][j] &gt; (p-&gt;a[i][k] + p-&gt;a[k][j]))</span><br><span class="line">                &#123;</span><br><span class="line">                    p-&gt;a[i][j] = p-&gt;a[i][k] + p-&gt;a[k][j];</span><br><span class="line">                    p-&gt;nextvex[i][j] = p-&gt;nextvex[i][k]; <span class="comment">//将插入的点作为i的下一个点</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">initial</span><span class="params">(PGraph g)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;g-&gt;vexcount);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; g-&gt;vexcount; i++)</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; g-&gt;vexcount; j++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;g-&gt;arcs[i][j]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id=""><a href="#" class="headerlink" title=" "></a> </h2><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> study </category>
          
      </categories>
      
      
        <tags>
            
            <tag> data_structure </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>数据结构noj_2</title>
      <link href="2021/05/17/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84noj_2/"/>
      <url>2021/05/17/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84noj_2/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="数据结构noj-2"><a href="#数据结构noj-2" class="headerlink" title="数据结构noj_2"></a>数据结构noj_2</h1><p>数据结构10-20</p><p>我太菜了,有几道题只是能勉强过一下,但没按照要求做</p><p><del>后面有时间看能不能改一下</del></p><span id="more"></span><h2 id="11"><a href="#11" class="headerlink" title="11"></a>11</h2><p><img data-src="http://cdn.sekyoro.top/imgs/065706.png" alt="QQ截图20210517220735"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> maxsize 101</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">queue</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">int</span> data[maxsize];</span><br><span class="line">    <span class="comment">//int head;</span></span><br><span class="line">    <span class="keyword">int</span> rear;</span><br><span class="line">&#125;<span class="built_in">queue</span>,*pqueue;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">move</span><span class="params">(pqueue)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">(pqueue)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">initial</span><span class="params">(pqueue,<span class="keyword">int</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n,k;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>,&amp;n,&amp;k);</span><br><span class="line">    pqueue q = (pqueue)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="built_in">queue</span>));</span><br><span class="line">    <span class="keyword">if</span>(q==<span class="literal">NULL</span>) <span class="built_in">printf</span>(<span class="string">&quot;error&quot;</span>);</span><br><span class="line">    initial(q,n);</span><br><span class="line">    <span class="keyword">while</span>(k--)</span><br><span class="line">    move(q);</span><br><span class="line">    print(q);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">initial</span><span class="params">(pqueue q,<span class="keyword">int</span> n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;q-&gt;data[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    q-&gt;rear = n;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">move</span><span class="params">(pqueue q)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> temp;</span><br><span class="line">    temp = q-&gt;data[q-&gt;rear];</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = q-&gt;rear;i&gt;=<span class="number">2</span>;i--)</span><br><span class="line">    &#123;</span><br><span class="line">        q-&gt;data[i] = q-&gt;data[i<span class="number">-1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    q-&gt;data[<span class="number">1</span>] = temp;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">(pqueue q)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i&lt;=q-&gt;rear;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d%c&quot;</span>,q-&gt;data[i],(i==q-&gt;rear)?<span class="string">&#x27;\n&#x27;</span>:<span class="string">&#x27; &#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="12"><a href="#12" class="headerlink" title="12"></a>12</h2><p><img data-src="http://cdn.sekyoro.top/imgs/065709.png" alt="image-20210517221211318"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> maxsize 101</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">Tripe</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">int</span> data;</span><br><span class="line">    <span class="keyword">int</span> row;</span><br><span class="line">    <span class="keyword">int</span> col;</span><br><span class="line">&#125; Tripe;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">TSmatrix</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">int</span> num;</span><br><span class="line">    Tripe Element[maxsize];</span><br><span class="line">&#125; TSmatrix, *pTsmatrix;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">initial</span><span class="params">(pTsmatrix)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(pTsmatrix, pTsmatrix, pTsmatrix)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">(pTsmatrix)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    pTsmatrix a = (pTsmatrix)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(TSmatrix));</span><br><span class="line">    pTsmatrix b = (pTsmatrix)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(TSmatrix));</span><br><span class="line">    pTsmatrix c = (pTsmatrix)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(TSmatrix));</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;a-&gt;num, &amp;b-&gt;num);</span><br><span class="line">    initial(a);</span><br><span class="line">    initial(b);</span><br><span class="line">    add(a, b, c);</span><br><span class="line">    print(c);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">(pTsmatrix result)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= result-&gt;num; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d %d %d\n&quot;</span>, result-&gt;Element[i].row, result-&gt;Element[i].col, result-&gt;Element[i].data);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(pTsmatrix a, pTsmatrix b, pTsmatrix c)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">1</span>, j = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> k = <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span> ((i &lt;= a-&gt;num) &amp;&amp; (j &lt;= b-&gt;num))</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> ((a-&gt;Element[i].row == b-&gt;Element[j].row) &amp;&amp; (a-&gt;Element[i].col == b-&gt;Element[j].col))</span><br><span class="line">        &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> ((a-&gt;Element[i].data + b-&gt;Element[j].data) == <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                i++;</span><br><span class="line">                j++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                k++;</span><br><span class="line">                c-&gt;Element[k].data = a-&gt;Element[i].data + b-&gt;Element[j].data;</span><br><span class="line">                c-&gt;Element[k].row = a-&gt;Element[i].row;</span><br><span class="line">                c-&gt;Element[k].col = a-&gt;Element[i].col;</span><br><span class="line">                i++;</span><br><span class="line">                j++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> ((a-&gt;Element[i].row &lt; b-&gt;Element[j].row) || (a-&gt;Element[i].row == b-&gt;Element[j].row &amp;&amp; (a-&gt;Element[i].col &lt; b-&gt;Element[j].col)))</span><br><span class="line">        &#123;</span><br><span class="line">            k++;</span><br><span class="line">            c-&gt;Element[k].row = a-&gt;Element[i].row;</span><br><span class="line">            c-&gt;Element[k].col = a-&gt;Element[i].col;</span><br><span class="line">            c-&gt;Element[k].data = a-&gt;Element[i].data;</span><br><span class="line">            i++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            k++;</span><br><span class="line">            c-&gt;Element[k].row = b-&gt;Element[j].row;</span><br><span class="line">            c-&gt;Element[k].col = b-&gt;Element[j].col;</span><br><span class="line">            c-&gt;Element[k].data = b-&gt;Element[j].data;</span><br><span class="line">            j++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> (i &lt;= a-&gt;num)</span><br><span class="line">    &#123;</span><br><span class="line">        k++;</span><br><span class="line">        c-&gt;Element[k].row = a-&gt;Element[i].row;</span><br><span class="line">        c-&gt;Element[k].col = a-&gt;Element[i].col;</span><br><span class="line">        c-&gt;Element[k].data = a-&gt;Element[i].data;</span><br><span class="line">        i++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> (j &lt;= b-&gt;num)</span><br><span class="line">    &#123;</span><br><span class="line">        k++;</span><br><span class="line">        c-&gt;Element[k].row = b-&gt;Element[j].row;</span><br><span class="line">        c-&gt;Element[k].col = b-&gt;Element[j].col;</span><br><span class="line">        c-&gt;Element[k].data = b-&gt;Element[j].data;</span><br><span class="line">        j++;</span><br><span class="line">    &#125;</span><br><span class="line">    c-&gt;num = k;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">initial</span><span class="params">(pTsmatrix p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= p-&gt;num; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d %d %d&quot;</span>, &amp;p-&gt;Element[i].row, &amp;p-&gt;Element[i].col, &amp;p-&gt;Element[i].data);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="13"><a href="#13" class="headerlink" title="13"></a>13</h2><p><img data-src="http://cdn.sekyoro.top/imgs/065711.png" alt="image-20210517221236404"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">OLNode</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">int</span> i, j, e;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">OLNode</span> *<span class="title">down</span>, *<span class="title">right</span>;</span></span><br><span class="line">&#125; OLNode, *OLlink;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    OLlink *rhead, *chead; <span class="comment">//指向行或列第一个非零元(指向结构体的指针),可以用数组rhead[row]表示第row行的数据</span></span><br><span class="line">    <span class="keyword">int</span> m, n, len;         <span class="comment">//行列数,非零元个数</span></span><br><span class="line">&#125; CrossList;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">initial</span><span class="params">(CrossList *)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">plus</span><span class="params">(CrossList *, CrossList *)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">(CrossList *)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Insert</span><span class="params">(CrossList *, OLlink, OLlink, OLlink *, OLlink *)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(CrossList *, OLlink, OLlink, OLlink *, OLlink *)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    CrossList *M = (CrossList *)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(CrossList));</span><br><span class="line">    CrossList *N = (CrossList *)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(CrossList));</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;M-&gt;m, &amp;M-&gt;n);</span><br><span class="line">    N-&gt;m = M-&gt;m;</span><br><span class="line">    N-&gt;n = M-&gt;n;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;M-&gt;len, &amp;N-&gt;len);</span><br><span class="line">    initial(M);</span><br><span class="line">    initial(N);</span><br><span class="line">    plus(M, N);</span><br><span class="line">    print(M);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">(CrossList *M)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> row = <span class="number">1</span>; row &lt;= M-&gt;m; row++)</span><br><span class="line">    &#123;</span><br><span class="line">        OLlink pa = M-&gt;rhead[row];</span><br><span class="line">        <span class="keyword">while</span> (pa)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d %d %d\n&quot;</span>, pa-&gt;i, pa-&gt;j, pa-&gt;e);</span><br><span class="line">            pa = pa-&gt;right;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">plus</span><span class="params">(CrossList *M, CrossList *N)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    OLlink pa, pb;</span><br><span class="line">    OLlink pre; <span class="comment">//指向前面一个节点,方便插入</span></span><br><span class="line">    OLlink *hl = (OLlink *)<span class="built_in">malloc</span>((M-&gt;n + <span class="number">1</span>) * <span class="keyword">sizeof</span>(OLlink));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= M-&gt;n; j++)</span><br><span class="line">        hl[j] = M-&gt;chead[j]; <span class="comment">//hl[]表示的是每列非零元的pre指向元素，与pre类似</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> row = <span class="number">1</span>; row &lt;= M-&gt;m; row++) <span class="comment">//行遍历</span></span><br><span class="line">    &#123;</span><br><span class="line">        pa = M-&gt;rhead[row];</span><br><span class="line">        pb = N-&gt;rhead[row];</span><br><span class="line">        pre = <span class="literal">NULL</span>;</span><br><span class="line">        <span class="keyword">while</span> (pb) <span class="comment">//当pb有非零元素时进行处理</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (pa == <span class="literal">NULL</span> || pa-&gt;j &gt; pb-&gt;j)</span><br><span class="line">            &#123;</span><br><span class="line"></span><br><span class="line">                Insert(M, pa, pb, &amp;pre, hl);</span><br><span class="line">                pb = pb-&gt;right;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (pa != <span class="literal">NULL</span> &amp;&amp; pa-&gt;j &lt; pb-&gt;j)</span><br><span class="line">            &#123;</span><br><span class="line">                pre = pa;</span><br><span class="line">                pa = pa-&gt;right;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (pa-&gt;j == pb-&gt;j)</span><br><span class="line">            &#123;</span><br><span class="line">                add(M, pa, pb, &amp;pre, hl);</span><br><span class="line">                pb = pb-&gt;right;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(CrossList *M, OLlink pa, OLlink pb, OLlink *pre, OLlink *hl)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> data = pa-&gt;e + pb-&gt;e;</span><br><span class="line">    <span class="keyword">if</span> (data)</span><br><span class="line">    &#123;</span><br><span class="line">        pa-&gt;e = data;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        OLlink temp = (OLlink)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(OLNode));</span><br><span class="line">        <span class="keyword">if</span> ((*pre) == <span class="literal">NULL</span>)</span><br><span class="line">            M-&gt;rhead[pa-&gt;i] = pa-&gt;right;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            (*pre)-&gt;right = pa-&gt;right;</span><br><span class="line">        &#125;</span><br><span class="line">        temp = pa;</span><br><span class="line">        pa = pa-&gt;right;</span><br><span class="line">        <span class="keyword">if</span> (M-&gt;chead[temp-&gt;j] == temp)</span><br><span class="line">            M-&gt;chead[temp-&gt;j] = hl[temp-&gt;j] = temp-&gt;down;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            hl[temp-&gt;j]-&gt;down = temp-&gt;down;</span><br><span class="line">        <span class="built_in">free</span>(temp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Insert</span><span class="params">(CrossList *M, OLlink pa, OLlink pb, OLlink *pre, OLlink *hl)</span> <span class="comment">//插入有两种情况，一种是pa该行无非零元素，另一种pb所在列小于pa所在列</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    OLlink p = (OLlink)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(OLNode));</span><br><span class="line">    p-&gt;i = pb-&gt;i;</span><br><span class="line">    p-&gt;j = pb-&gt;j;</span><br><span class="line">    p-&gt;e = pb-&gt;e;</span><br><span class="line">    p-&gt;down = p-&gt;right = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">if</span> ((*pre) == <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        M-&gt;rhead[p-&gt;i] = p;</span><br><span class="line">      </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        (*pre)-&gt;right = p;</span><br><span class="line">      </span><br><span class="line">    &#125;</span><br><span class="line">    p-&gt;right = pa;</span><br><span class="line">    </span><br><span class="line">    (*pre) = p;</span><br><span class="line">    pa = (*pre)-&gt;right;<span class="comment">//这一句可以不要</span></span><br><span class="line">    <span class="keyword">if</span> (!M-&gt;chead[p-&gt;j] || M-&gt;chead[p-&gt;j]-&gt;i &gt; p-&gt;i)</span><br><span class="line">    &#123;</span><br><span class="line">        p-&gt;down = M-&gt;chead[p-&gt;j];</span><br><span class="line">        M-&gt;chead[p-&gt;j] = p;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        p-&gt;down = hl[p-&gt;j]-&gt;down;</span><br><span class="line">        hl[p-&gt;j]-&gt;down = p;</span><br><span class="line">    &#125;</span><br><span class="line">    hl[p-&gt;j] = p;</span><br><span class="line">   </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">initial</span><span class="params">(CrossList *Clist)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i, j, e;</span><br><span class="line">    Clist-&gt;rhead = (OLlink *)<span class="built_in">malloc</span>((Clist-&gt;m + <span class="number">1</span>) * <span class="keyword">sizeof</span>(OLlink));</span><br><span class="line">    Clist-&gt;chead = (OLlink *)<span class="built_in">malloc</span>((Clist-&gt;n + <span class="number">1</span>) * <span class="keyword">sizeof</span>(OLlink));</span><br><span class="line">    <span class="comment">// if(rhead||chead)</span></span><br><span class="line">    <span class="comment">// exit(1);</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= Clist-&gt;m; i++)</span><br><span class="line">        Clist-&gt;rhead[i] = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= Clist-&gt;n; i++)</span><br><span class="line">        Clist-&gt;chead[i] = <span class="literal">NULL</span>;</span><br><span class="line">    OLlink s = (OLlink)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(OLNode));</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> count = <span class="number">0</span>; count &lt; Clist-&gt;len; count++)</span><br><span class="line">    &#123;</span><br><span class="line">        OLlink cur = (OLlink)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(OLNode));</span><br><span class="line">        cur-&gt;down = <span class="literal">NULL</span>;</span><br><span class="line">        cur-&gt;right = <span class="literal">NULL</span>;</span><br><span class="line">        <span class="comment">// if(cur==NULL)</span></span><br><span class="line">        <span class="comment">// exit(1);</span></span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d %d %d&quot;</span>, &amp;i, &amp;j, &amp;e);</span><br><span class="line">        cur-&gt;i = i;</span><br><span class="line">        cur-&gt;j = j;</span><br><span class="line">        cur-&gt;e = e;</span><br><span class="line">        <span class="keyword">if</span> (Clist-&gt;rhead[i] == <span class="literal">NULL</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            Clist-&gt;rhead[i] = cur;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            s = Clist-&gt;rhead[i];</span><br><span class="line">            <span class="keyword">while</span> (s-&gt;right != <span class="literal">NULL</span> &amp;&amp; s-&gt;right-&gt;j &lt; j)</span><br><span class="line">                s = s-&gt;right;</span><br><span class="line">            cur-&gt;right = s-&gt;right;</span><br><span class="line">            s-&gt;right = cur;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (Clist-&gt;chead[j] == <span class="literal">NULL</span>)</span><br><span class="line">            Clist-&gt;chead[j] = cur;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            s = Clist-&gt;chead[j];</span><br><span class="line">            <span class="keyword">while</span> (s-&gt;down != <span class="literal">NULL</span> &amp;&amp; s-&gt;down-&gt;i &lt; i)</span><br><span class="line">                s = s-&gt;down;</span><br><span class="line">            cur-&gt;down = s-&gt;down;</span><br><span class="line">            s-&gt;down = cur;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="14"><a href="#14" class="headerlink" title="14"></a>14</h2><p><img data-src="http://cdn.sekyoro.top/imgs/065713.png" alt="image-20210517221259788"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAXSIZE 100</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">enum</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    ATOM,</span><br><span class="line">    LIST</span><br><span class="line">&#125; ElemTag;</span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">GLNode_1</span> //同层节点</span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    ElemTag tag;</span><br><span class="line">    <span class="class"><span class="keyword">union</span></span></span><br><span class="line"><span class="class">    &#123;</span></span><br><span class="line">        <span class="class"><span class="keyword">struct</span> <span class="title">GLNode_1</span> *<span class="title">hp</span>;</span></span><br><span class="line">        <span class="keyword">char</span> data;</span><br><span class="line">    &#125; atom_hp;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">GLNode_1</span> *<span class="title">tp</span>;</span></span><br><span class="line">&#125; GLNode_1, *GList_1;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">GLNode_2</span> //头尾节点</span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    ElemTag tag;</span><br><span class="line">    <span class="class"><span class="keyword">union</span></span></span><br><span class="line"><span class="class">    &#123;</span></span><br><span class="line">        <span class="class"><span class="keyword">struct</span> <span class="title">GLNode_2</span> *<span class="title">hp</span>, *<span class="title">tp</span>;</span></span><br><span class="line">        <span class="keyword">char</span> data;</span><br><span class="line">    &#125; atom_htp;</span><br><span class="line">&#125; GLNode_2, *GList_2;</span><br><span class="line"></span><br><span class="line"><span class="function">GList_1 <span class="title">create_1</span><span class="params">(<span class="keyword">char</span> *)</span></span>;</span><br><span class="line"><span class="function">GList_2 <span class="title">create_2</span><span class="params">(<span class="keyword">char</span> *)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">Depth_1</span><span class="params">(GList_1)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">Depth_2</span><span class="params">(GList_2)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> GList[MAXSIZE];</span><br><span class="line">    fgets(GList,<span class="keyword">sizeof</span>(GList),<span class="built_in">stdin</span>);</span><br><span class="line">    <span class="keyword">char</span> *p = GList;</span><br><span class="line">    <span class="keyword">int</span> depth;</span><br><span class="line">    GList_1 s = create_1(p);</span><br><span class="line">    depth = Depth_1(s);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n%d\n&quot;</span>,depth,depth);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// GList_2 create_2(char *s)</span></span><br><span class="line"><span class="comment">// &#123;</span></span><br><span class="line"><span class="comment">//     char ch = *s++;</span></span><br><span class="line"><span class="comment">//     GList_2 cur;</span></span><br><span class="line"><span class="comment">//     if(ch!=&#x27;\n&#x27;)</span></span><br><span class="line"><span class="comment">//     &#123;</span></span><br><span class="line"><span class="comment">//         cur = (GList_2)malloc(sizeof(GLNode_2));</span></span><br><span class="line"><span class="comment">//         if(ch == &#x27;(&#x27;)</span></span><br><span class="line"><span class="comment">//         &#123;</span></span><br><span class="line"><span class="comment">//             cur-&gt;tag = LIST;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//         &#125;</span></span><br><span class="line"><span class="comment">//     &#125;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">Depth_1</span><span class="params">(GList_1 L)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> d, max = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (L-&gt;tag == ATOM)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    GList_1 s;</span><br><span class="line">    s = L-&gt;atom_hp.hp;</span><br><span class="line">    <span class="keyword">if</span> (s == <span class="literal">NULL</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (s != <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (s-&gt;tag == LIST)</span><br><span class="line">        &#123;</span><br><span class="line">            d = Depth_1(s);</span><br><span class="line">            <span class="keyword">if</span> (d &gt; max)</span><br><span class="line">                max = d;</span><br><span class="line">        &#125;</span><br><span class="line">        s = s-&gt;tp;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (max + <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">GList_1 <span class="title">create_1</span><span class="params">(<span class="keyword">char</span> *s)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> ch = *s++;</span><br><span class="line">    GList_1 cur;</span><br><span class="line">    <span class="keyword">if</span> (ch != <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        cur = (GList_1)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(GLNode_1));</span><br><span class="line">        <span class="keyword">if</span> (ch == <span class="string">&#x27;(&#x27;</span>) <span class="comment">//字符为(时,创建表头</span></span><br><span class="line">        &#123;</span><br><span class="line">            cur-&gt;tag = LIST;</span><br><span class="line">            cur-&gt;atom_hp.hp = create_1(s);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (ch == <span class="string">&#x27;)&#x27;</span>) <span class="comment">//字符尾)时,子表结束</span></span><br><span class="line">            cur = <span class="literal">NULL</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            cur-&gt;tag = ATOM;</span><br><span class="line">            cur-&gt;atom_hp.data = ch;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        cur = <span class="literal">NULL</span>;</span><br><span class="line">    ch = *s++;</span><br><span class="line">    <span class="keyword">if</span> (cur != <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (ch == <span class="string">&#x27;,&#x27;</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            cur-&gt;tp = create_1(s);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            cur-&gt;tp = <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> cur;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="15"><a href="#15" class="headerlink" title="15"></a>15</h2><p><img data-src="http://cdn.sekyoro.top/imgs/065719.png" alt="image-20210517221509727"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAXSIZE 100</span></span><br><span class="line"><span class="comment">//在栈中分配堆（heap）空间时</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">Node</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">int</span> data;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Node</span> *<span class="title">lchild</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Node</span> *<span class="title">rchild</span>;</span></span><br><span class="line">&#125; BiNode, *Bitree;</span><br><span class="line"></span><br><span class="line"><span class="function">Bitree <span class="title">create</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">preNode</span><span class="params">(Bitree)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// char data[MAXSIZE];</span></span><br><span class="line">    <span class="comment">// fgets(data, sizeof(data), stdin);</span></span><br><span class="line">    Bitree r;</span><br><span class="line">    r = create();</span><br><span class="line">    preNode(r);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">Bitree <span class="title">create</span><span class="params">()</span> <span class="comment">//字符数组,参数是指向字符的指针</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   </span><br><span class="line">    <span class="keyword">char</span> fir_data,sec_data;</span><br><span class="line">    Bitree root = (Bitree)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(BiNode));</span><br><span class="line">    fir_data = getchar();</span><br><span class="line">    sec_data = getchar();</span><br><span class="line">    root-&gt;rchild = root-&gt;lchild = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">if</span>(fir_data == <span class="string">&#x27;,&#x27;</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        root-&gt;data = sec_data;</span><br><span class="line">        fir_data = getchar();</span><br><span class="line">        <span class="keyword">if</span>(fir_data == <span class="string">&#x27;(&#x27;</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            root-&gt;lchild = create();</span><br><span class="line">            root-&gt;rchild = create();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        root-&gt;data = fir_data;</span><br><span class="line">        <span class="keyword">if</span>(sec_data == <span class="string">&#x27;(&#x27;</span>)</span><br><span class="line">        &#123;</span><br><span class="line">             root-&gt;lchild = create();</span><br><span class="line">            root-&gt;rchild = create();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> root;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">preNode</span><span class="params">(Bitree root)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(root)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%c&quot;</span>,root-&gt;data);</span><br><span class="line">        preNode(root-&gt;lchild);</span><br><span class="line">        preNode(root-&gt;rchild);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="16"><a href="#16" class="headerlink" title="16"></a>16</h2><p><img data-src="http://cdn.sekyoro.top/imgs/065721.png" alt="image-20210517221532633"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">Node</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">char</span> data;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Node</span> *<span class="title">lchild</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Node</span> *<span class="title">rchild</span>;</span></span><br><span class="line">&#125;BiNode,*BiTree;</span><br><span class="line"></span><br><span class="line"><span class="function">BiTree <span class="title">create</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">cal_node</span><span class="params">(BiTree)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    BiTree r;</span><br><span class="line">    r = create();</span><br><span class="line">    <span class="keyword">int</span> num = cal_node(r);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,num);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">BiTree <span class="title">create</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> s;</span><br><span class="line">    s = getchar();</span><br><span class="line">    <span class="keyword">if</span>(s==<span class="string">&#x27;#&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    BiTree root = (BiTree)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(BiNode));</span><br><span class="line">    root-&gt;data = s;</span><br><span class="line">    root-&gt;lchild = root-&gt;rchild = <span class="literal">NULL</span>;</span><br><span class="line">    root-&gt;lchild = create();</span><br><span class="line">    root-&gt;rchild = create();</span><br><span class="line">    <span class="keyword">return</span> root;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">cal_node</span><span class="params">(BiTree root)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n1 = <span class="number">0</span>,n2 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(root-&gt;lchild==<span class="literal">NULL</span>&amp;&amp;root-&gt;rchild==<span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(root-&gt;lchild)</span><br><span class="line">    n1 = cal_node(root-&gt;lchild);</span><br><span class="line">    <span class="keyword">if</span>(root-&gt;rchild)</span><br><span class="line">    n2 = cal_node(root-&gt;rchild);</span><br><span class="line">    <span class="keyword">return</span> (n1+n2);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="17"><a href="#17" class="headerlink" title="17"></a>17</h2><p><img data-src="http://cdn.sekyoro.top/imgs/065723.png" alt="image-20210517221555933"></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">Node</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Node</span> *<span class="title">lchild</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Node</span> *<span class="title">rchild</span>;</span></span><br><span class="line">    <span class="keyword">int</span> data;</span><br><span class="line">&#125; BiNode, *Bitree;</span><br><span class="line"></span><br><span class="line"><span class="function">Bitree <span class="title">initial</span><span class="params">(<span class="keyword">void</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">midtree</span><span class="params">(Bitree)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Bitree root = <span class="built_in">initial</span>();</span><br><span class="line">    <span class="built_in">midtree</span>(root);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">Bitree <span class="title">initial</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> data;</span><br><span class="line">    data = <span class="built_in">getchar</span>();</span><br><span class="line">    Bitree root;</span><br><span class="line">    <span class="keyword">if</span> (data == <span class="string">&#x27;#&#x27;</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    <span class="comment">//if(data != &#x27;\n&#x27;)</span></span><br><span class="line">    &#123;</span><br><span class="line">        Bitree root = (Bitree)<span class="built_in">malloc</span>(<span class="built_in"><span class="keyword">sizeof</span></span>(BiNode));</span><br><span class="line">        root-&gt;data = data;</span><br><span class="line">        root-&gt;lchild = <span class="built_in">initial</span>();</span><br><span class="line">        root-&gt;rchild = <span class="built_in">initial</span>();</span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">midtree</span><span class="params">(Bitree root)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (root == <span class="literal">NULL</span>)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">if</span> (root-&gt;lchild)</span><br><span class="line">        <span class="built_in">midtree</span>(root-&gt;lchild);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%c&quot;</span>, root-&gt;data);</span><br><span class="line">    <span class="keyword">if</span> (root-&gt;rchild)</span><br><span class="line">        <span class="built_in">midtree</span>(root-&gt;rchild);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="18"><a href="#18" class="headerlink" title="18"></a>18</h2><p><img data-src="http://cdn.sekyoro.top/imgs/065725.png" alt="image-20210517221619298"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">BiNode</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span>  <span class="title">BiNode</span>* <span class="title">lchild</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">BiNode</span>* <span class="title">rchild</span>;</span></span><br><span class="line">    <span class="keyword">int</span> data; </span><br><span class="line">&#125;BiNode,*BiTree;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">postNode</span><span class="params">(BiTree)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">PreFindMid</span><span class="params">(<span class="keyword">char</span>*,<span class="keyword">char</span>*,<span class="keyword">int</span>,<span class="keyword">int</span>,<span class="keyword">int</span>)</span></span>;</span><br><span class="line"><span class="function">BiTree <span class="title">Create</span><span class="params">(<span class="keyword">char</span>*,<span class="keyword">char</span>*,<span class="keyword">int</span>*,<span class="keyword">int</span>,<span class="keyword">int</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> len;</span><br><span class="line">    <span class="keyword">char</span> pre[<span class="number">100</span>],mid[<span class="number">100</span>];</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%s%s&quot;</span>,pre,mid);</span><br><span class="line">    len = <span class="built_in">strlen</span>(pre);</span><br><span class="line">    BiTree root;</span><br><span class="line">    <span class="keyword">int</span> pos_p = <span class="number">0</span>;</span><br><span class="line">    root = Create(pre,mid,&amp;pos_p,<span class="number">0</span>,len<span class="number">-1</span>);</span><br><span class="line">    postNode(root);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">BiTree <span class="title">Create</span><span class="params">(<span class="keyword">char</span> *pre,<span class="keyword">char</span>* mid,<span class="keyword">int</span> *pos_p,<span class="keyword">int</span> pos_le,<span class="keyword">int</span> pos_ri)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    BiTree temp;</span><br><span class="line">    temp = (BiTree)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(BiNode));</span><br><span class="line">    temp-&gt;data = pre[*pos_p];</span><br><span class="line">    temp-&gt;lchild = temp-&gt;rchild = <span class="literal">NULL</span>;</span><br><span class="line">    (*pos_p)++;</span><br><span class="line">    <span class="keyword">int</span> pos_m;</span><br><span class="line">    pos_m = PreFindMid(pre,mid,*pos_p<span class="number">-1</span>,pos_le,pos_ri);</span><br><span class="line">    <span class="keyword">if</span>(pos_m&gt;pos_le)</span><br><span class="line">    temp-&gt;lchild = Create(pre,mid,pos_p,pos_le,pos_m<span class="number">-1</span>);</span><br><span class="line">    <span class="keyword">if</span>(pos_m&lt;pos_ri)</span><br><span class="line">    temp-&gt;rchild = Create(pre,mid,pos_p,pos_m+<span class="number">1</span>,pos_ri);</span><br><span class="line">    <span class="keyword">return</span> temp;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">PreFindMid</span><span class="params">(<span class="keyword">char</span>* pre,<span class="keyword">char</span>* mid,<span class="keyword">int</span> pos_p,<span class="keyword">int</span> pos_le,<span class="keyword">int</span> pos_ri)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = pos_le;i&lt;=pos_ri;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(pre[pos_p] == mid[i])</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> i;</span><br><span class="line">        </span><br><span class="line">        &#125; </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">postNode</span><span class="params">(BiTree root)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(root==<span class="literal">NULL</span>)</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">    postNode(root-&gt;lchild);</span><br><span class="line">    postNode(root-&gt;rchild);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%c&quot;</span>,root-&gt;data);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="19"><a href="#19" class="headerlink" title="19"></a>19</h2><p><img data-src="http://cdn.sekyoro.top/imgs/065727.png" alt="image-20210517221728217"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_NUM 100</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">ArcNode</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">int</span> adjvex;              <span class="comment">//邻接点的位置</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">ArcNode</span> *<span class="title">nextarc</span>;</span> <span class="comment">//指向与顶点相邻的其他邻接点</span></span><br><span class="line">&#125; ArcNode;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">VertexNode</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">int</span> adjvex;        <span class="comment">//储存顶点的位置值</span></span><br><span class="line">    ArcNode *firstarc; <span class="comment">//用于指向链表的第一个顶点</span></span><br><span class="line">&#125; VertexNode;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    VertexNode vertex[MAX_NUM]; <span class="comment">//头接点表</span></span><br><span class="line">    <span class="keyword">int</span> vexnum, arcnum;         <span class="comment">//节点个数，连线个数</span></span><br><span class="line">&#125; AdjList;</span><br><span class="line"></span><br><span class="line"><span class="function">AdjList <span class="title">initial_adjList</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">test</span><span class="params">(AdjList)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    AdjList al;</span><br><span class="line">    al = initial_adjList();</span><br><span class="line">    test(al);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">AdjList <span class="title">initial_adjList</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    AdjList adj_list;</span><br><span class="line">    ArcNode *node = (ArcNode*)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(ArcNode));</span><br><span class="line">    ArcNode *node_2 = (ArcNode*)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(ArcNode));</span><br><span class="line">    <span class="keyword">int</span> vex, arc;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>, &amp;vex, &amp;arc);</span><br><span class="line">    adj_list.vexnum = vex;</span><br><span class="line">    adj_list.arcnum = arc;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= vex; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;adj_list.vertex[i].adjvex);</span><br><span class="line">        adj_list.vertex[i].firstarc = <span class="literal">NULL</span>;</span><br><span class="line">    &#125;<span class="comment">//进行初始化，将每个头接点赋值，并置firstarcNULL</span></span><br><span class="line">    <span class="keyword">int</span> i, j;</span><br><span class="line">    <span class="keyword">while</span> (arc--)<span class="comment">//为每条边给信息</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>, &amp;i, &amp;j);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> ix = <span class="number">1</span>; ix &lt;= vex; ix++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (i == adj_list.vertex[ix].adjvex)<span class="comment">//找到头接点</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (adj_list.vertex[ix].firstarc == <span class="literal">NULL</span>)<span class="comment">//如果为空,即没有连接点</span></span><br><span class="line">                &#123;</span><br><span class="line">                    node-&gt;adjvex = j;</span><br><span class="line">                    node-&gt;nextarc = <span class="literal">NULL</span>;</span><br><span class="line">                    adj_list.vertex[ix].firstarc = node;</span><br><span class="line">                    <span class="comment">// adj_list.vertex[ix].firstarc-&gt;adjvex = j;</span></span><br><span class="line">                    <span class="comment">// adj_list.vertex[ix].firstarc-&gt;nextarc = NULL;</span></span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// else</span></span><br><span class="line">                <span class="comment">// &#123;</span></span><br><span class="line">                <span class="comment">//     node.adjvex = j;</span></span><br><span class="line">                <span class="comment">//     node.nextarc = NULL;</span></span><br><span class="line">                <span class="comment">//     adj_list.vertex[ix].firstarc-&gt;nextarc = &amp;node;</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">// &#125;</span></span><br><span class="line">                node_2-&gt;adjvex = j;</span><br><span class="line">                node_2-&gt;nextarc = <span class="literal">NULL</span>;</span><br><span class="line">                node = adj_list.vertex[ix].firstarc;</span><br><span class="line">                <span class="keyword">while</span> (node-&gt;nextarc)</span><br><span class="line">                &#123;</span><br><span class="line">                    node = node-&gt;nextarc;</span><br><span class="line">                &#125;</span><br><span class="line">                node-&gt;nextarc = node_2;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> adj_list;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">test</span><span class="params">(AdjList adj_list)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> ix, jx;</span><br><span class="line">    ArcNode *node;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>, &amp;ix, &amp;jx);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= adj_list.arcnum; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (ix == adj_list.vertex[i].adjvex)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">for</span> (node = adj_list.vertex[i].firstarc; node != <span class="literal">NULL</span>; node = node-&gt;nextarc)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (jx == node-&gt;adjvex)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="built_in">printf</span>(<span class="string">&quot;yes\n&quot;</span>);</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;no\n&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="20"><a href="#20" class="headerlink" title="20"></a>20</h2><p><img data-src="http://cdn.sekyoro.top/imgs/065728.png" alt="image-20210517221747666"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_SIZE 100</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">ArcNode</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="comment">//数据</span></span><br><span class="line">    <span class="keyword">int</span> data;</span><br><span class="line">    <span class="comment">///邻节点 </span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">ArcNode</span> *<span class="title">nextarc</span>;</span></span><br><span class="line">&#125; ArcNode;</span><br><span class="line"></span><br><span class="line"><span class="comment">//头接点</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">VertexNode</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">int</span> data;</span><br><span class="line">    <span class="comment">//头接点的第一个节点域</span></span><br><span class="line">    ArcNode *firstarc;</span><br><span class="line">&#125; VertexNode;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="comment">/* data */</span></span><br><span class="line">    VertexNode vertex[<span class="number">100</span>];</span><br><span class="line">    <span class="keyword">int</span> vexnum, arcnum; <span class="comment">//节点数与弧数</span></span><br><span class="line">&#125; AdjList;</span><br><span class="line"></span><br><span class="line"><span class="comment">//初始化</span></span><br><span class="line"><span class="function">AdjList <span class="title">initial</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//查找有无邻接点</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">search</span><span class="params">(AdjList)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    AdjList al;</span><br><span class="line">    al = initial();</span><br><span class="line">    search(al);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">AdjList <span class="title">initial</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    AdjList adj_list;</span><br><span class="line">    <span class="keyword">int</span> vex, arc;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;vex, &amp;arc);</span><br><span class="line">    adj_list.vexnum = vex; <span class="comment">//输入顶点数与边数</span></span><br><span class="line">    adj_list.arcnum = arc;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//初始化节点的值</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; vex; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;adj_list.vertex[i].data);</span><br><span class="line">        adj_list.vertex[i].firstarc = <span class="literal">NULL</span>;<span class="comment">//头节点第一个连接点初始化为NULL</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> i, j;</span><br><span class="line">    ArcNode *node = (ArcNode *)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(ArcNode));</span><br><span class="line">    ArcNode *node_2 = (ArcNode *)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(ArcNode));</span><br><span class="line">    <span class="keyword">while</span> (arc--)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>, &amp;i, &amp;j);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> ix = <span class="number">0</span>; ix &lt; vex; ix++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (adj_list.vertex[ix].data == i)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (adj_list.vertex[ix].firstarc == <span class="literal">NULL</span>)<span class="comment">//检查头节点第一个是否为空</span></span><br><span class="line">                <span class="comment">//若为空,意味着第一个节点为空,则加入</span></span><br><span class="line">                &#123;</span><br><span class="line">                    node-&gt;data = j;</span><br><span class="line">                    node-&gt;nextarc = <span class="literal">NULL</span>;</span><br><span class="line">                    adj_list.vertex[ix].firstarc = node;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span><span class="comment">//否则加到最后面</span></span><br><span class="line">                &#123;</span><br><span class="line">                    node = adj_list.vertex[ix].firstarc;</span><br><span class="line">                    <span class="keyword">while</span> (node-&gt;nextarc)<span class="comment">//遍历走到最后</span></span><br><span class="line">                    &#123;</span><br><span class="line">                        node = node-&gt;nextarc;</span><br><span class="line">                    &#125;</span><br><span class="line">                    node_2-&gt;data = j;</span><br><span class="line">                    node_2-&gt;nextarc = <span class="literal">NULL</span>;</span><br><span class="line">                    node-&gt;nextarc = node_2;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> adj_list;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">search</span><span class="params">(AdjList adj_list)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> src, dst;</span><br><span class="line">    ArcNode *node = (ArcNode *)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(ArcNode));</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>, &amp;src, &amp;dst);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> ix = <span class="number">0</span>; ix &lt; adj_list.vexnum; ix++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (src == adj_list.vertex[ix].data)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">for</span> (node = adj_list.vertex[ix].firstarc;node!=<span class="literal">NULL</span>;node = node-&gt;nextarc)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span>(node-&gt;data == dst)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="built_in">printf</span>(<span class="string">&quot;yes\n&quot;</span>);</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;no\n&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> study </category>
          
      </categories>
      
      
        <tags>
            
            <tag> data_structure </tag>
            
            <tag> c </tag>
            
            <tag> noj </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>哈夫曼编/译码</title>
      <link href="2021/05/10/%E5%93%88%E5%A4%AB%E6%9B%BC%E7%BC%96-%E8%AF%91%E7%A0%81/"/>
      <url>2021/05/10/%E5%93%88%E5%A4%AB%E6%9B%BC%E7%BC%96-%E8%AF%91%E7%A0%81/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="哈夫曼树"><a href="#哈夫曼树" class="headerlink" title="哈夫曼树"></a>哈夫曼树</h1><p>预备知识</p><p><strong>1、路径和路径长度</strong></p><p>从树中一个结点到另一个结点之间的分支构成两个结点的路径，路径上的分支数目叫做路径长度。树的路径长度是从树根到每一个结点的路径长度之和。<br><span id="more"></span><br><strong>2、带权路径长度</strong></p><p>结点的带权路径长度为从该结点到树根之间的路径长度与结点上权的乘积。树的带权路径长度为树中所有<strong>叶子结点</strong>的带权路径长度之和，通常记作WPL。</p><p>若有n个权值为w1,w2,…,wn的结点构成一棵有n个叶子结点的二叉树，则树的带权路径最小的二叉树叫做哈夫曼树或最优二叉树。</p><p>哈夫曼树是由n个带权叶子节点构成的所有二叉树中带权路径长度最短的二叉树.</p><p>树的带权路径长度</p><script type="math/tex; mode=display">WPL = \sum_{i=1}^{n}w_i*l_i</script><p>哈夫曼树，又称最优树，是一类带权路径长度最短的树。首先有几个概念需要清楚：</p><h2 id="存储结构"><a href="#存储结构" class="headerlink" title="存储结构"></a>存储结构</h2><p>一颗有n个叶子的哈夫曼树共有2n-1个结点，每个结点包含其双亲信息和孩子结点的信息,构成一个静态三链表</p><p><img data-src="http://cdn.sekyoro.top/imgs/065115.png" alt="2021-5-8"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> N 20</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> M (2*(N)-1)</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">int</span> weight;<span class="comment">//权值</span></span><br><span class="line"><span class="keyword">int</span> parent;<span class="comment">//双亲结点</span></span><br><span class="line"><span class="keyword">int</span> Lchild;<span class="comment">//左孩子结点</span></span><br><span class="line"><span class="keyword">int</span> rchild;<span class="comment">//右孩子结点</span></span><br><span class="line">&#125;HTNode,HuffmanTree[M+<span class="number">1</span>];</span><br></pre></td></tr></table></figure><p>哈夫曼树的存储结构</p><h2 id="创建哈夫曼树"><a href="#创建哈夫曼树" class="headerlink" title="创建哈夫曼树"></a>创建哈夫曼树</h2><p>1.根据给定的n个权值{w1,w2,…,wn}构成二叉树集合F={T1,T2,…,Tn},其中每棵二叉树Ti中只有一个带权为wi的根结点,其左右子树为空.</p><p>2.在F中选取两棵根结点权值最小的树作为左右子树构造一棵新的二叉树,且置新的二叉树的根结点的权值为左右子树根结点的权值之和.</p><p>3.在F中删除这两棵树,同时将新的二叉树加入F中.</p><p>4.重复2、3,直到F只含有一棵树为止.(得到哈夫曼树)</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">CrtHuffmanTree</span><span class="params">(HufmanTree ht,<span class="keyword">int</span> w[],<span class="keyword">int</span> n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> = <span class="number">1</span>;i&lt;=n;i++)</span><br><span class="line">ht[i] = &#123;w[i],<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>&#125;;</span><br><span class="line"><span class="comment">//叶子节点n个</span></span><br><span class="line"><span class="comment">//初始化每个叶子结点</span></span><br><span class="line">m = <span class="number">2</span>*n<span class="number">-1</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = n+<span class="number">1</span>;i&lt;=m;i++)</span><br><span class="line">ht[i] = &#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>&#125;;</span><br><span class="line"><span class="comment">//初始化n-1个非叶子节点</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = n+<span class="number">1</span>;i&lt;=m;i++)</span><br><span class="line">&#123;</span><br><span class="line">select(ht,i<span class="number">-1</span>,&amp;s1,&amp;s2);</span><br><span class="line"><span class="comment">//在叶子节点中选取两个parent=0且weight最小的两个结点</span></span><br><span class="line">ht[i].weight = ht[s1].weight+ht[s2].weight;</span><br><span class="line">ht[s1].parent = ht[s2].parent = i;</span><br><span class="line">ht[i].lchild = s1;</span><br><span class="line">ht[i].rchild = s2;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>1、满二叉树不一定是哈夫曼树 </p><p>2、哈夫曼树中权越大的叶子离根越近  （很好理解，WPL最小的二叉树）</p><p>3、具有相同带权结点的哈夫曼树不惟一</p><p>4、哈夫曼树的结点的度数为 0 或 2， 没有度为 1 的结点。</p><p>5、包含 n 个叶子结点的哈夫曼树中共有 2n – 1 个结点。</p><p>6、包含 n 棵树的森林要经过 n–1 次合并才能形成哈夫曼树，共产生 n–1 个新结点</p><h2 id="哈夫曼编码"><a href="#哈夫曼编码" class="headerlink" title="哈夫曼编码"></a>哈夫曼编码</h2><p>对一颗具有n个叶子的哈夫曼树,若对树中的每个左分支赋予0,右分支赋予1,从根到每个叶子的通路上,各分支的赋值分别构成一个二进制串,该二进制串就称为哈夫曼编码.</p><p><img data-src="http://cdn.sekyoro.top/imgs/065116.png" alt="QQ截图20210508155705"></p><p>哈夫曼编码是前缀编码,以使用频度作为权值构造哈夫曼树,这样编码得到的二进制串平均值最短.</p><p>（1）创建长度为2n-1的哈夫曼树数组，含有n个叶子节点</p><p>（2）<strong>创建长度为n的string数组，用于存放n个叶子节点的哈夫曼码</strong></p><p>（3）从某叶子节点开始，不断寻找其父节点，直到寻找到根节点，并对此路径上每个分支进行编码，左孩子为0，右孩子为1</p><p><strong>算法实现</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">char</span>* HuffmanCode[N+<span class="number">1</span>];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">CrtHuffmanCode</span><span class="params">(HuffmanTree ht,HuffmanCode hc,<span class="keyword">int</span> n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">char</span> *cd;</span><br><span class="line">cd = (<span class="keyword">char</span>*)<span class="built_in">malloc</span>(n*<span class="keyword">sizeof</span>(<span class="keyword">char</span>));</span><br><span class="line">cd[n<span class="number">-1</span>] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i&lt;=n;i++)</span><br><span class="line">&#123;</span><br><span class="line">start = n<span class="number">-1</span>;</span><br><span class="line">c = i;</span><br><span class="line">p = ht[i].parent;<span class="comment">//找到叶子结点的父亲节点</span></span><br><span class="line"><span class="keyword">while</span>(p)<span class="comment">//如果存在父亲节点.即parent不为0</span></span><br><span class="line">&#123;</span><br><span class="line">--start;</span><br><span class="line"><span class="keyword">if</span>(ht[p].lchild==c)</span><br><span class="line">cd[start] = <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line"><span class="keyword">else</span> cd[start] = <span class="string">&#x27;1&#x27;</span>;</span><br><span class="line">c = p;</span><br><span class="line">p = ht[p].parent;<span class="comment">//继续搜索父亲节点</span></span><br><span class="line">&#125;</span><br><span class="line">hc[i] = (<span class="keyword">char</span>*)<span class="built_in">malloc</span>((n-start)*<span class="keyword">sizeof</span>(<span class="keyword">char</span>));</span><br><span class="line"><span class="built_in">strcpy</span>(hc[i],&amp;cd[start]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">free</span>(cd);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>从任意叶子X节点（数组前n项中的某一项）开始，根据X的parent值（即X的父节点在数组中的位置）找到其父节点。</p><p><strong>找到X的父节点后，根据父节点的left和right值判断X和父节点的关系。如果X是父节点的左子树，则编码为1；如果X是父节点的右子树，则编码为0</strong>。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> N 100</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> M (2 * N - 1)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">char</span> *HuffmanCode[N + <span class="number">1</span>];</span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">int</span> weight; <span class="comment">//权值</span></span><br><span class="line">    <span class="keyword">int</span> parent; <span class="comment">//父节点在ht数组中的位置</span></span><br><span class="line">    <span class="keyword">int</span> Lchild; <span class="comment">//左孩子在ht数组中的位置</span></span><br><span class="line">    <span class="keyword">int</span> Rchild; <span class="comment">//右孩子在ht数组中的位置</span></span><br><span class="line">    <span class="keyword">char</span> c;     <span class="comment">//字符</span></span><br><span class="line">&#125; HTNode, HuffmanTree[M + <span class="number">1</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">CrtHuffmanTree</span><span class="params">(HuffmanTree, <span class="keyword">int</span>)</span></span>;       <span class="comment">//构造哈夫曼树</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">select</span><span class="params">(HuffmanTree, <span class="keyword">int</span>, <span class="keyword">int</span> *, <span class="keyword">int</span> *)</span></span>; <span class="comment">//用于寻找最小的两个值</span></span><br><span class="line"><span class="comment">//hc[N+1]为相应节点的编码</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">CrtHuffmanCode</span><span class="params">(HuffmanTree, HuffmanCode, <span class="keyword">int</span>)</span></span>; <span class="comment">//根据哈夫曼树得到相应编码</span></span><br><span class="line"><span class="comment">//解码得到明文</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">decode</span><span class="params">(HuffmanTree, HuffmanCode, <span class="keyword">int</span>, <span class="keyword">char</span> *)</span></span>;</span><br><span class="line"><span class="comment">//编码得到二进制串</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">encode</span><span class="params">(HuffmanTree, HuffmanCode, <span class="keyword">int</span>, <span class="keyword">char</span> *)</span></span>;</span><br><span class="line"><span class="comment">//根据HuffmanTree得到HuffmanCode</span></span><br><span class="line"><span class="comment">//HuffmanCode储存的是每个字符对应的编码</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> size;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;size);</span><br><span class="line">    getchar();</span><br><span class="line">    HuffmanTree ht;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= size; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%c&quot;</span>, &amp;ht[i].c); <span class="comment">//输入n个叶子节点的字符</span></span><br><span class="line">        getchar();</span><br><span class="line">    &#125;</span><br><span class="line">    CrtHuffmanTree(ht, size);</span><br><span class="line">    HuffmanCode hc;</span><br><span class="line">    CrtHuffmanCode(ht, hc, size);</span><br><span class="line">    <span class="keyword">char</span> encoding_text[<span class="number">100</span>] = &#123;<span class="string">&#x27;\0&#x27;</span>&#125;;</span><br><span class="line">    encode(ht, hc, size, encoding_text);</span><br><span class="line">    decode(ht, hc, size, encoding_text);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">CrtHuffmanTree</span><span class="params">(HuffmanTree ht, <span class="keyword">int</span> n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// int w[N + 1];</span></span><br><span class="line">    <span class="comment">// for (int i = 1; i &lt;= n; i++)</span></span><br><span class="line">    <span class="comment">//     scanf(&quot;%d&quot;, &amp;w[i]); //输入n个叶子节点的权值</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;ht[i].weight); <span class="comment">//输入n个叶子节点的权值</span></span><br><span class="line">        ht[i].parent = ht[i].Rchild = ht[i].Lchild = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> m = <span class="number">2</span> * n - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = n + <span class="number">1</span>; i &lt;= m; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        ht[i].weight = <span class="number">0</span>;</span><br><span class="line">        ht[i].parent = ht[i].Rchild = ht[i].Lchild = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> s1, s2; <span class="comment">//s1,s2为两个值最小的无父结点</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = n + <span class="number">1</span>; i &lt;= m; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        select(ht, i - <span class="number">1</span>, &amp;s1, &amp;s2);</span><br><span class="line">        ht[i].weight = ht[s1].weight + ht[s2].weight;</span><br><span class="line">        ht[s1].parent = ht[s2].parent = i;</span><br><span class="line">        ht[i].Lchild = s1;</span><br><span class="line">        ht[i].Rchild = s2;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">select</span><span class="params">(HuffmanTree ht, <span class="keyword">int</span> n, <span class="keyword">int</span> *s1, <span class="keyword">int</span> *s2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> min_1_w = <span class="number">10000</span>; <span class="comment">//用来找最小值</span></span><br><span class="line">    <span class="keyword">int</span> min_2_w = <span class="number">10000</span>; <span class="comment">//用来找最小值</span></span><br><span class="line">    <span class="keyword">int</span> min;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (ht[i].parent == <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (ht[i].weight &lt; min_1_w)</span><br><span class="line">            &#123;</span><br><span class="line">                min_1_w = ht[i].weight;</span><br><span class="line">                min = i;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="comment">//找到第一个最小值</span></span><br><span class="line">    *s1 = min;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= n; j++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (ht[j].parent == <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (j != *s1 &amp;&amp; ht[j].weight &lt; min_2_w) <span class="comment">//倒数第二小的值大于等于最小的值,小于其余值</span></span><br><span class="line">            &#123;</span><br><span class="line">                min_2_w = ht[j].weight;</span><br><span class="line">                min = j;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="comment">//最小的第二个值</span></span><br><span class="line">    *s2 = min;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">CrtHuffmanCode</span><span class="params">(HuffmanTree ht, HuffmanCode hc, <span class="keyword">int</span> n)</span> <span class="comment">//建立好哈夫曼树后,得到哈夫曼编码</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> *cd;                              <span class="comment">//cd是指向字符的指针,用来存储字符串</span></span><br><span class="line">    cd = (<span class="keyword">char</span> *)<span class="built_in">malloc</span>(n * <span class="keyword">sizeof</span>(<span class="keyword">char</span>)); <span class="comment">//开辟n个单元,因为共有n个结点,最多只有n-1个编码位</span></span><br><span class="line">    cd[n - <span class="number">1</span>] = <span class="string">&#x27;\0&#x27;</span>;                      <span class="comment">//因为存储字符串,最后一位为空字符</span></span><br><span class="line">    <span class="keyword">int</span> start, c;                          <span class="comment">//start为cd数组开始存储的起点,c用来标记每次往上找到的双亲的位置</span></span><br><span class="line">    <span class="keyword">int</span> p;                                 <span class="comment">//p为双亲的位置</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        start = n - <span class="number">1</span>;    <span class="comment">//这是cd数组的最后一位,是&#x27;/0&#x27;，因为储存字符串</span></span><br><span class="line">        c = i;            <span class="comment">//c为第一个结点,得到第一个结点的编码</span></span><br><span class="line">        p = ht[i].parent; <span class="comment">//寻找结点父亲</span></span><br><span class="line">        <span class="keyword">while</span> (p)         <span class="comment">//若有父亲结点</span></span><br><span class="line">        &#123;</span><br><span class="line">            --start;               <span class="comment">//每次递减,从后向前得到编码</span></span><br><span class="line">            <span class="keyword">if</span> (ht[p].Lchild == c) <span class="comment">//若子节点为左孩子,则为0</span></span><br><span class="line">                cd[start] = <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                cd[start] = <span class="string">&#x27;1&#x27;</span>;</span><br><span class="line">            c = p;</span><br><span class="line">            p = ht[p].parent;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        while循环可改为</span></span><br><span class="line"><span class="comment">        for(c=i,p=ht[i].parent;p!=0;c=p,p=ht[p].parent)</span></span><br><span class="line"><span class="comment">        &#123;</span></span><br><span class="line"><span class="comment">             --start;</span></span><br><span class="line"><span class="comment">            if (ht[p].Lchild == c)</span></span><br><span class="line"><span class="comment">                cd[start] = &#x27;0&#x27;;</span></span><br><span class="line"><span class="comment">            else</span></span><br><span class="line"><span class="comment">                cd[start] = &#x27;1&#x27;;</span></span><br><span class="line"><span class="comment">            c = p;</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        hc[i] = (<span class="keyword">char</span> *)<span class="built_in">malloc</span>((n - start) * <span class="keyword">sizeof</span>(<span class="keyword">char</span>)); <span class="comment">//为hc[i]分配空间,空间大小为编码的位数+1,最后一位为&#x27;\0&#x27;</span></span><br><span class="line">        <span class="built_in">strcpy</span>(hc[i], &amp;cd[start]);                          <span class="comment">//注意这里取地址符不可以去掉,因为本身cd是一个数组(指针),但复制时应该从start开始,所以取数组start位的元素地址</span></span><br><span class="line">                                                            <span class="comment">//   printf(&quot;%d:%s\n&quot;,i,hc[i]);//hc 存储的是n个字符分别的编码</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">free</span>(cd);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">decode</span><span class="params">(HuffmanTree ht, HuffmanCode hc, <span class="keyword">int</span> n, <span class="keyword">char</span> *encoding_text)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> *text = (<span class="keyword">char</span> *)<span class="built_in">malloc</span>(n * <span class="keyword">sizeof</span>(<span class="keyword">char</span>));</span><br><span class="line">    <span class="built_in">memset</span>(text, <span class="string">&#x27;\0&#x27;</span>, <span class="keyword">sizeof</span>(text));</span><br><span class="line">    <span class="keyword">int</span> pos = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> t_pos = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (encoding_text[pos] != <span class="string">&#x27;\0&#x27;</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        text[t_pos++] = encoding_text[pos++];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">strcmp</span>(text, hc[i])==<span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;%c&quot;</span>, ht[i].c);</span><br><span class="line">                <span class="built_in">memset</span>(text, <span class="string">&#x27;\0&#x27;</span>, n * <span class="keyword">sizeof</span>(<span class="keyword">char</span>));</span><br><span class="line">                t_pos = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// else</span></span><br><span class="line">            <span class="comment">// &#123;</span></span><br><span class="line">            <span class="comment">//     text[t_pos++] = encoding_text[pos++];</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// &#125;</span></span><br><span class="line">        &#125;</span><br><span class="line">       <span class="comment">// text[t_pos++] = encoding_text[pos++];</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">encode</span><span class="params">(HuffmanTree ht, HuffmanCode hc, <span class="keyword">int</span> n, <span class="keyword">char</span> *encoding_text)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//得到了哈夫曼编码,因为知道了每个字符相应的编码,解码就很简单了</span></span><br><span class="line">    <span class="comment">//进行编码</span></span><br><span class="line">    getchar();<span class="comment">//这里接受一个空格,避免下面fgets直接接受一个空格了</span></span><br><span class="line">    <span class="keyword">char</span> text[<span class="number">1000</span>]; <span class="comment">//进行编码的文本</span></span><br><span class="line">    fgets(text, <span class="number">1000</span>, <span class="built_in">stdin</span>);</span><br><span class="line">    <span class="keyword">char</span> c;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; text[i] != <span class="string">&#x27;\0&#x27;</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        c = text[i];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= n; j++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (ht[j].c == c)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;%s&quot;</span>, hc[j]);</span><br><span class="line">                <span class="built_in">strcat</span>(encoding_text, hc[j]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="https://blog.csdn.net/Young_IT/article/details/106730343">哈夫曼编码详解——图解真能看了秒懂_Young_IT的博客-CSDN博客</a></p><p><a href="http://data.biancheng.net/view/101.html">哈夫曼（赫夫曼，哈弗曼）编码算法（带源码+解析） (biancheng.net)</a></p><p><a href="https://www.cnblogs.com/kubixuesheng/p/4397798.html">哈夫曼（huffman）树和哈夫曼编码 - dashuai的博客 - 博客园 (cnblogs.com)</a></p><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> study </category>
          
      </categories>
      
      
        <tags>
            
            <tag> data_structure </tag>
            
            <tag> c </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>关于指针和函数</title>
      <link href="2021/04/29/%E5%85%B3%E4%BA%8E%E6%8C%87%E9%92%88%E5%92%8C%E5%87%BD%E6%95%B0/"/>
      <url>2021/04/29/%E5%85%B3%E4%BA%8E%E6%8C%87%E9%92%88%E5%92%8C%E5%87%BD%E6%95%B0/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="关于函数和指针"><a href="#关于函数和指针" class="headerlink" title="关于函数和指针"></a>关于函数和指针</h1><p>这几天瞎写的时候关于指针以及malloc产生了一些问题。</p><span id="more"></span><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span>* <span class="title">initial</span><span class="params">(<span class="keyword">int</span>*)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">initial</span><span class="params">(<span class="keyword">int</span>*)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   <span class="keyword">int</span> *p = (<span class="keyword">int</span>*)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="keyword">int</span>));</span><br><span class="line">    p = <span class="literal">NULL</span>;</span><br><span class="line">   <span class="built_in">printf</span>(<span class="string">&quot;%p %p\n&quot;</span>,p,&amp;p);</span><br><span class="line">    p = initial(p);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%p %p\n&quot;</span>,p,&amp;p);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span>* <span class="title">initial</span><span class="params">(<span class="keyword">int</span>* p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    p = (<span class="keyword">int</span>*)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="keyword">int</span>));<span class="comment">//在函数中，指针p的地址变了</span></span><br><span class="line">    *p = <span class="number">5</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%p %p\n&quot;</span>,p,&amp;p);</span><br><span class="line">    <span class="keyword">return</span> p;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">void initial(int* p)</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">      p = (int*)malloc(sizeof(int));//在函数中，指针p的地址变了</span></span><br><span class="line"><span class="comment">    //为p分配地址,但退栈后p的地址没了（找不到了）</span></span><br><span class="line"><span class="comment">    *p = 5;</span></span><br><span class="line"><span class="comment">    printf(&quot;%p %p\n&quot;,p,&amp;p);</span></span><br><span class="line"><span class="comment">&#125;*/</span></span><br></pre></td></tr></table></figure><p>运行截图</p><p>如果用return返回在函数中用malloc分配得到的指针</p><p><img data-src="http://cdn.sekyoro.top/imgs/094134.png" alt="QQ截图20210429195130"></p><p>p是一个指向int类型的指针,其值一开始设置为NULL,指针的地址是61fe18,但在函数中利用malloc分配后得到的新值为6b1640,并且指针本身的地址也不一样。</p><p>这是因为调用函数时,生成栈,参数只是一层浅拷贝,值相同,但地址不同，这就是函数的机制吧.</p><p>再举个例子,比如说</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">int</span>  num = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%p&quot;</span>,&amp;n);</span><br><span class="line">func(num);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">func</span><span class="params">(<span class="keyword">int</span> n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%p&quot;</span>,&amp;n);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img data-src="http://cdn.sekyoro.top/imgs/094136.png" alt="QQ截图20210429200528"></p><p>可以发现地址并不同,这也说明了地址的变化.</p><p>如果不用return返回,运行截图所示,根据刚才函数机制可知,指针的值(即所指向值的地址)并不会变化。</p><p><img data-src="http://cdn.sekyoro.top/imgs/094139.png" alt="QQ截图20210429195214"></p><p>所以可以得到第一个结论了。</p><p><strong>指针也是一个变量，我们如果要改变它，必须找到它在内存中的地址，也就是指针的地址。也就是说，对于函数中，如果对指针的地址进行赋值，事实上是改变不了原指针的！</strong></p><p>所以解决方法主要两个,在c中利用二级指针改变指针的地址.</p><p>如果在cpp中即可利用引用类型&amp;比较方便</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">Node</span> </span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">int</span> data;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Node</span>* <span class="title">lchild</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Node</span>* <span class="title">rchild</span>;</span></span><br><span class="line">&#125;BiNode,*Bitree;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">initial</span><span class="params">(Bitree)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   Bitree t = (Bitree)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(BiNode));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%p\n&quot;</span>,t);</span><br><span class="line">    initial(t);</span><br><span class="line">    <span class="keyword">if</span>(t-&gt;lchild==<span class="literal">NULL</span>)</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;子孩子结点为空k\n&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%p\n&quot;</span>,t-&gt;lchild);   </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%c\n&quot;</span>,t-&gt;data);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,t-&gt;lchild-&gt;data);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">initial</span><span class="params">(Bitree root)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%p\n&quot;</span>,root);</span><br><span class="line">    <span class="comment">// scanf(&quot;%c&quot;,&amp;root-&gt;data);</span></span><br><span class="line">    root-&gt;lchild = (Bitree)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(BiNode));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%p\n&quot;</span>,root-&gt;lchild);   <span class="comment">//this pointer&#x27;s value ,means pointed object addres</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img data-src="http://cdn.sekyoro.top/imgs/094141.jpg" alt="20214291"></p><p>可知,指针传入函数后,其值(即指向值的地址)未变,在函数中为子节点申请了空间,在函数外也能通过其访问。</p><p><img data-src="http://cdn.sekyoro.top/imgs/094144.png" alt="QQ截图20210429204704"></p><p>内存分配的知识：</p><p>1、参数、局部变量分配在栈区中。编译器自动回收<br>2、malloc申请的内存分配在堆上，由程序结束OS回收3、全局（静态区），全局变量和静态变量，由程序结束OS回收</p><p>在函数中利用malloc分配空间或为指针赋值需要注意：</p><ol><li>函数的参数是浅拷贝,地址与实参不同,如果要相同,在cpp中用&amp;引用参数</li><li>在函数内为指针分配地址时,栈退后会使得这个分配得到的地址无法引用,指针的地址依然是调用前,值没有改变</li></ol><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> 误区 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> c </tag>
            
            <tag> 指针 </tag>
            
            <tag> 函数 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>广义表简介</title>
      <link href="2021/04/23/%E5%B9%BF%E4%B9%89%E8%A1%A8%E7%AE%80%E4%BB%8B/"/>
      <url>2021/04/23/%E5%B9%BF%E4%B9%89%E8%A1%A8%E7%AE%80%E4%BB%8B/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="广义表简介"><a href="#广义表简介" class="headerlink" title="广义表简介"></a>广义表简介</h1><h2 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h2><p>广义表是n个数据元素组成的有限序列</p><script type="math/tex; mode=display">GL =  (d_1,d_2,d_3,...,d_n)</script><p>GL是广义表的名字,n是广义表的长度.</p><span id="more"></span><p>广义表中的元素既可以是单个元素,也可以是广义表.</p><p>若d<sub>i</sub>为广义表,则可称为是GL的子表.<br>广义表的表头:d<sub>1</sub>是广义表的表头,即广义表的第一个元素</p><p>通常，广义表中存储的单个元素称为 “原子”，而存储的广义表称为 “子表”。</p><p>广义表的表尾:广义表的GL其余部分组成的表,即(d<sub>2</sub>,d<sub>3</sub>,…,d<sub>n</sub>)为表尾</p><p><strong>除非广义表为空表，否则广义表一定具有表头和表尾，且广义表的表尾一定是一个广义表。</strong></p><p>广义表是递归定义的.</p><ul><li>A = ()：A 表示一个广义表，只不过表是空的。</li><li>B = (e)：广义表 B 中只有一个原子 e。</li><li>C = (a,(b,c,d)) ：广义表 C 中有两个元素，原子 a 和子表 (b,c,d)。</li><li>D = (A,B,C)：广义表 D 中存有 3 个子表，分别是A、B和C。这种表示方式等同于 D = ((),(e),(b,c,d)) 。</li><li>E = (a,E)：广义表 E 中有两个元素，原子 a 和它本身。这是一个递归广义表，等同于：E = (a,(a,(a,…)))。</li></ul><h2 id="存储结构"><a href="#存储结构" class="headerlink" title="存储结构"></a>存储结构</h2><p>由于<a href="http://data.biancheng.net/view/189.html">广义表</a>中既可存储原子（不可再分的数据元素），也可以存储子表，因此很难使用顺序存储结构表示，通常情况下广义表结构采用<a href="http://data.biancheng.net/view/160.html">链表</a>实现.</p><h3 id="头尾链表存储结构"><a href="#头尾链表存储结构" class="headerlink" title="头尾链表存储结构"></a>头尾链表存储结构</h3><p>表中每个元素用一个结点表示,表中有两类结点:</p><ol><li>单个元素结点 </li><li>子表节点</li></ol><p>任何非空的子表都可以分成表头和表尾两部分</p><p>元素节点需要值域和标志域,表结点由标志域和指向表头,表尾的指针组成</p><p><img data-src="http://cdn.sekyoro.top/imgs/065955.png" alt="4_23_广义表"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">enum</span>&#123;</span>ATOM,LIST&#125; ElemTag;</span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">GLNode</span>&#123;</span></span><br><span class="line">    ElemTag tag;<span class="comment">//标志域</span></span><br><span class="line">    <span class="class"><span class="keyword">union</span>&#123;</span></span><br><span class="line">        AtomType atom;<span class="comment">//原子结点的值域</span></span><br><span class="line">        <span class="class"><span class="keyword">struct</span>&#123;</span></span><br><span class="line">            <span class="class"><span class="keyword">struct</span> <span class="title">GLNode</span> * <span class="title">hp</span>,*<span class="title">tp</span>;</span><span class="comment">//表头结点指针与表尾结点</span></span><br><span class="line">        &#125;htp;<span class="comment">//子表结点的指针域，hp指向表头；tp指向表尾</span></span><br><span class="line">    &#125;atom_htp;<span class="comment">//原子值域与表结点指针域的联合体</span></span><br><span class="line">&#125;GLNode,*Glist;</span><br></pre></td></tr></table></figure><h3 id="广义表同层节点链存储结构"><a href="#广义表同层节点链存储结构" class="headerlink" title="广义表同层节点链存储结构"></a>广义表同层节点链存储结构</h3><p>在这种结构中,无论是原子结点还是表结点都由三个域构成</p><p><img data-src="https://gitee.com/the-helpless-beggar/mypics/raw/master/4_12_%E5%B9%BF%E4%B9%89%E8%A1%A8(2" alt="4_12_广义表(2)">.png)</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">enum</span>&#123;</span>ATOM,LIST&#125; ElemTag;</span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">GLNode</span>&#123;</span></span><br><span class="line">    ElemTag tag;<span class="comment">//标志域</span></span><br><span class="line">    <span class="class"><span class="keyword">union</span>&#123;</span></span><br><span class="line">        AtomType atom;<span class="comment">//原子结点的值域</span></span><br><span class="line">        <span class="class"><span class="keyword">struct</span> <span class="title">GLNode</span> *<span class="title">hp</span>;</span><span class="comment">//子表结点的指针域，hp指向表头</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">GLNode</span> * <span class="title">tp</span>;</span><span class="comment">//同层下一个结点的指针域</span></span><br><span class="line">    <span class="comment">//这里的tp相当于链表的next指针，用于指向下一个数据元素</span></span><br><span class="line">&#125;GLNode,*Glist;</span><br></pre></td></tr></table></figure><h2 id="相关操作"><a href="#相关操作" class="headerlink" title="相关操作"></a>相关操作</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">GLNode</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">int</span> tag;</span><br><span class="line">    <span class="comment">//tag = 0为原子</span></span><br><span class="line">    <span class="comment">//tag =1 为子表</span></span><br><span class="line">    <span class="class"><span class="keyword">union</span></span></span><br><span class="line"><span class="class">    &#123;</span></span><br><span class="line">        <span class="class"><span class="keyword">struct</span></span></span><br><span class="line"><span class="class">        &#123;</span></span><br><span class="line">        <span class="class"><span class="keyword">struct</span> <span class="title">Node</span> *<span class="title">hp</span>,*<span class="title">tp</span>;</span></span><br><span class="line">        &#125;htp;</span><br><span class="line">        <span class="keyword">int</span> data;</span><br><span class="line">    &#125;atom_htp;</span><br><span class="line">&#125;GLNode,*GList;</span><br><span class="line"></span><br><span class="line"><span class="function">GList <span class="title">Head</span><span class="params">(GList L)</span></span>;</span><br><span class="line"><span class="function">GList <span class="title">Tail</span><span class="params">(GList L)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">Length</span><span class="params">(GList L)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">Depth</span><span class="params">(GList L)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">CountAtom</span><span class="params">(GList L)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">CopyGList</span><span class="params">(GList,GList*)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">GList <span class="title">Head</span><span class="params">(GList L)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!L)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">if</span>(L-&gt;tag == <span class="number">0</span>)</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    <span class="keyword">return</span> Head(L-&gt;atom_htp.htp.hp);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">GList <span class="title">Tail</span><span class="params">(GList L)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!L)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">if</span>(L-&gt;tag == <span class="number">0</span>)</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    <span class="keyword">return</span> Tail(L-&gt;atom_htp.htp.tp);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">Length</span><span class="params">(GList L)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> k = <span class="number">0</span>;</span><br><span class="line">    GList s;</span><br><span class="line">    <span class="keyword">if</span>(L==<span class="literal">NULL</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(L-&gt;tag == <span class="number">0</span>)</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    s = L;</span><br><span class="line">    <span class="keyword">while</span>(s!=<span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        k++;</span><br><span class="line">        s = s-&gt;atom_htp.htp.tp;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> k;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">Depth</span><span class="params">(GList L)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> d,max;</span><br><span class="line">    GList s;</span><br><span class="line">    <span class="keyword">if</span>(L==<span class="literal">NULL</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(L-&gt;tag ==<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    s = L;</span><br><span class="line">    <span class="keyword">while</span>(s!=<span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        d = Depth(s-&gt;atom_htp.htp.hp);</span><br><span class="line">        <span class="keyword">if</span>(d&gt;max)</span><br><span class="line">        max =d;</span><br><span class="line">        s = s-&gt;atom_htp.htp.tp;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> max+<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">CountAtom</span><span class="params">(GList L)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n1,n2;</span><br><span class="line">    <span class="keyword">if</span>(L==<span class="literal">NULL</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(L-&gt;tag == <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    n1 = CountAtom(L-&gt;atom_htp.htp.hp);</span><br><span class="line">    n2 = CountAtom(L-&gt;atom_htp.htp.tp);</span><br><span class="line">    <span class="keyword">return</span> (n1+n2);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">CopyGList</span><span class="params">(GList S,GList *T)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(S==<span class="literal">NULL</span>)</span><br><span class="line">    &#123;*T == <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;&#125;</span><br><span class="line">    <span class="keyword">if</span>(S-&gt;tag == <span class="number">0</span>)</span><br><span class="line">    (*T)-&gt;atom_htp.data = S-&gt;atom_htp.data;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        CopyGList(S-&gt;atom_htp.htp.hp,&amp;((*T)-&gt;atom_htp.htp.hp));</span><br><span class="line">        CopyGList(S-&gt;atom_htp.htp.tp,&amp;((*T)-&gt;atom_htp.htp.tp));</span><br><span class="line">    &#125; </span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> study </category>
          
      </categories>
      
      
        <tags>
            
            <tag> data_structure </tag>
            
            <tag> c </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>稀疏矩阵</title>
      <link href="2021/04/20/%E7%A8%80%E7%96%8F%E7%9F%A9%E9%98%B5/"/>
      <url>2021/04/20/%E7%A8%80%E7%96%8F%E7%9F%A9%E9%98%B5/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="稀疏矩阵"><a href="#稀疏矩阵" class="headerlink" title="稀疏矩阵"></a>稀疏矩阵</h1><h2 id="1-介绍"><a href="#1-介绍" class="headerlink" title="1.介绍"></a>1.介绍</h2><p>概念：矩阵中大多数元素为0。</p><p>直观上讲非零元素低于5%。</p><p>零元素代表着没有意义的值，所以零元素较多情况下，用链表代替存储比二维数组要好很多。</p><p>下面介绍三种表示方法</p><span id="more"></span><h2 id="2-三元组表示"><a href="#2-三元组表示" class="headerlink" title="2.三元组表示"></a>2.三元组表示</h2><p>只存储非零元素，由于非零元素位置不存在概率，则利用行，列，值的信息进行存储，这是容易想到的。</p><script type="math/tex; mode=display">\left\{\begin{matrix}0 & 4 & 0 \\1 & 2 & 0 \\0 & 0 & 6 \end{matrix}\right\}\tag{1}</script><p>随便写个例子(虽然不满足稀疏矩阵定义)</p><p>三元组表示法可以写为（假设起始行与列为1）一维数组。</p><p>TSMatrix[0],TSMatrix[1],TSMatrix[2]</p><p>数组元素为结构体Triple,结构体包含行列与值的信息</p><p>三元组表中的元素是有序排列的。(按照行优先、行相同列大小方式)</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MaxSize 20000</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">        <span class="keyword">int</span>  i, j;<span class="comment">/* 行号和列号 */</span></span><br><span class="line">        ElemType  elem;<span class="comment">/* 元素值 */</span></span><br><span class="line">&#125;Triple;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">        Triple  data[MaxSize];</span><br><span class="line">        <span class="keyword">int</span>  mu, nu, tu;<span class="comment">/* 行数、列数和非零元个数*/</span></span><br><span class="line">&#125;TSMatrix;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>这种表示法节省了空间</p><h3 id="1-三元组表示法转置"><a href="#1-三元组表示法转置" class="headerlink" title="1.三元组表示法转置"></a>1.三元组表示法转置</h3><p>矩阵转置是将行(列)上的元素换到列(行)上</p><p>不用三元组表示的话，利用两层for循环，效率O(m*n)</p><p><strong>列序递增转置法</strong></p><p>采用被转置矩阵三元组表A的列序递增进行转置，这样转置后的矩阵三元组表是以行序递增的。</p><p>所以，先以被转置矩阵A的列为主序,内层为每个A矩阵的非零元素</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Status <span class="title">TransposeSMatrix</span> <span class="params">(TSMatrix M, TSMatrix *T)</span></span></span><br><span class="line"><span class="function"></span>&#123;<span class="comment">//M为被转置矩阵，T为转置后的矩阵</span></span><br><span class="line">    <span class="keyword">int</span>  p, q, col;</span><br><span class="line">    T-&gt;mu = M.nu;  T-&gt;nu = M.mu;  T-&gt;tu = M.tu;<span class="comment">//T的行数为M的列数</span></span><br><span class="line">    <span class="keyword">if</span> (T-&gt;tu)&#123;</span><br><span class="line">        q = <span class="number">0</span>;<span class="comment">//q可以计数,当转置一个后q+1</span></span><br><span class="line">        <span class="keyword">for</span> (col = <span class="number">0</span>; col&lt; M.nu; ++col)</span><br><span class="line">            <span class="keyword">for</span> (p = <span class="number">0</span>; p&lt; M.tu; ++p)<span class="comment">//p为三元组表元素的位置，for循环不断扫描三元组表,查看是否有元素的列数为col，若有则转置</span></span><br><span class="line">                <span class="keyword">if</span> (M.data[p].j == col) &#123;</span><br><span class="line">                    T-&gt;data[q].i = M.data[p].j;</span><br><span class="line">                    T-&gt;data[q].j = M.data[p].i;</span><br><span class="line">                    T-&gt;data[q].elem = M.data[p].elem;</span><br><span class="line">                    q++;</span><br><span class="line">                &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> OK;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>算法时间效率O(M.nu×M.tu),for两层循环</p><p>当矩阵中非零元个数tu和mu<em>nu同数量级时，则该算法的时间复杂度为O(M.mu</em>M.nu2）。因此该算法只适用于M.tu &lt;&lt; M.mu*M.nu的情况。</p><p><strong>一次定位快速转置法</strong></p><p>刚才的算法效率并不是很高，想要提高可以通过减少for循环</p><p>如果能预先确定矩阵M中每一列（即T中的每一行）的第一个非零元素在T中的合适位置，那么在对M进行转置时就可以直接放到T中的恰当位置上去。为了确定这些位置，应先求得M的每一列中非零元的个数，进而求得每一列的第一个非零元在T中的位置。(M为被转置矩阵，T为转置后的矩阵)</p><p>为了”一次定位”，需要知道</p><ol><li>待转置矩阵A中的每一列非零元素总数</li><li>A中的每一列第一个非零元素在三元组表中位置</li></ol><p>对于第一个,就是转制后矩阵B每一行的非零元个数，设数组num[],则num[col]表示A的第col列非零元素个数;对于第二点,设pos[]，pos[col]表示A的第col列第一个非零元在<strong>B三元组表</strong>的位置。</p><p>num[]比较好算，扫一遍三元组表，遇到col值便+1(数组下标法)</p><p>pos[]要麻烦一点，它是三元组表中元素的位置,可以通过迭加计算</p><p>pos[1] = 1（假设,这里也可以是0，随意了）</p><p>pos[col] = pos[col-1] + num[col-1]</p><p>具体做法是pos[col]是第col列第一个非零元在三元组表的顺序，当有一个元素加入到B时，则pos[col] = pos[col]+1,使pos[col]始终指向A中第col列中下一个非零元在B的正确存放位置。</p><p><img data-src="http://cdn.sekyoro.top/imgs/092912.png" alt="image-20210418161823660"></p><p><img data-src="http://cdn.sekyoro.top/imgs/092913.png" alt="image-20210418161944713"></p><p>如上图</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Status <span class="title">FastTransposeSMatrix</span> <span class="params">(TSMatrix M, TSMatrix *T)</span></span></span><br><span class="line"><span class="function"></span>&#123;    <span class="keyword">int</span>   col, p, q, t;</span><br><span class="line">      T-&gt;mu = M.nu; T-&gt;nu = M.mu; T-&gt;tu = M.tu;</span><br><span class="line">      <span class="keyword">if</span> (T-&gt;tu) &#123;</span><br><span class="line">            <span class="keyword">for</span> (col=<span class="number">0</span>; col&lt; M.nu; ++col)  num[col] = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (t = <span class="number">0</span>; t &lt; M.tu; ++t) <span class="comment">/*统计每列的非零元个数*/</span></span><br><span class="line">                  ++num[M.data[t].j];</span><br><span class="line">            cpot[<span class="number">0</span>] = <span class="number">0</span>; <span class="comment">/*计算每列第一个非零元转置后的位置*/</span></span><br><span class="line">          <span class="keyword">for</span> (col = <span class="number">1</span>; col &lt; M.nu; ++col)</span><br><span class="line">     cpot[col] = cpot[col<span class="number">-1</span>] +num[col<span class="number">-1</span>];</span><br><span class="line">            <span class="keyword">for</span> (p = <span class="number">0</span>; p &lt; M.tu; ++p)&#123;</span><br><span class="line">                  col = M.data[p].j; q = cpot[col];</span><br><span class="line">           T-&gt;data[q].i =M.data[p].j; </span><br><span class="line">          T-&gt;data[q].j = M.data[p].i;</span><br><span class="line">          T-&gt;data[q].elem =M.data[p].elem;</span><br><span class="line">              ++cpot[col];<span class="comment">//当一列有一个元素转置后，位置+1指向下一个该列非零元素</span></span><br><span class="line">            &#125;  <span class="comment">/* for */</span></span><br><span class="line">      &#125;  <span class="comment">/* if */</span></span><br><span class="line">      <span class="keyword">return</span> OK;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>O(M.nu+M.tu)。<br>即使非零元个数与mu<em>nu同数量级，其时间复杂度为O(M.mu </em> M.nu)，与经典算法时间复杂度相同</p><p><strong>总结</strong></p><p>三元组顺序表（有序的双下标法）的特点：<br>（1）便于进行以行顺序处理的矩阵运算。<br>（2）若需按行号存取某一行的非零元，需从开始进行查找。</p><h3 id="2-三元组表示法加法"><a href="#2-三元组表示法加法" class="headerlink" title="2.三元组表示法加法"></a>2.三元组表示法加法</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> maxsize 101</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">Tripe</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">int</span> data;</span><br><span class="line">    <span class="keyword">int</span> row;</span><br><span class="line">    <span class="keyword">int</span> col;</span><br><span class="line">&#125; Tripe;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">TSmatrix</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">int</span> num;</span><br><span class="line">    <span class="keyword">int</span> row,col;</span><br><span class="line">    Tripe Element[maxsize];</span><br><span class="line">&#125; TSmatrix, *pTsmatrix;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">initial</span><span class="params">(pTsmatrix)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(pTsmatrix, pTsmatrix, pTsmatrix)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">(pTsmatrix)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    pTsmatrix a = (pTsmatrix)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(TSmatrix));</span><br><span class="line">    pTsmatrix b = (pTsmatrix)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(TSmatrix));</span><br><span class="line">    pTsmatrix c = (pTsmatrix)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(TSmatrix));</span><br><span class="line">    <span class="keyword">int</span> r,col;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>,&amp;r,&amp;col);</span><br><span class="line">    a-&gt;row = b-&gt;row = c-&gt;row = r;</span><br><span class="line">    a-&gt;col = b-&gt;col = c-&gt;col = col;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;a-&gt;num, &amp;b-&gt;num);</span><br><span class="line">    initial(a);</span><br><span class="line">    initial(b);</span><br><span class="line">    add(a, b, c);</span><br><span class="line">    print(c);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">(pTsmatrix result)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= result-&gt;num; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d %d %d\n&quot;</span>, result-&gt;Element[i].row, result-&gt;Element[i].col, result-&gt;Element[i].data);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(pTsmatrix a, pTsmatrix b, pTsmatrix c)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">1</span>, j = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> k = <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span> ((i &lt;= a-&gt;num) &amp;&amp; (j &lt;= b-&gt;num))</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> ((a-&gt;Element[i].row == b-&gt;Element[j].row) &amp;&amp; (a-&gt;Element[i].col == b-&gt;Element[j].col))</span><br><span class="line">        &#123;<span class="comment">//两个非零元行相同列相同，则进行相加并判断值是否为0</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> ((a-&gt;Element[i].data + b-&gt;Element[j].data) == <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                i++;</span><br><span class="line">                j++;<span class="comment">//值为0则不管，i,j递增</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                k++;</span><br><span class="line">                c-&gt;Element[k].data = a-&gt;Element[i].data + b-&gt;Element[j].data;</span><br><span class="line">                c-&gt;Element[k].row = a-&gt;Element[i].row;</span><br><span class="line">                c-&gt;Element[k].col = a-&gt;Element[i].col;</span><br><span class="line">                i++;</span><br><span class="line">                j++;<span class="comment">//值不为0,则赋值并递增i,j,k</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> ((a-&gt;Element[i].row &lt; b-&gt;Element[j].row) || (a-&gt;Element[i].row == b-&gt;Element[j].row &amp;&amp; (a-&gt;Element[i].col &lt; b-&gt;Element[j].col)))</span><br><span class="line">        &#123;<span class="comment">//若a的非零元行数小于b的非零元,意味着c = a+0 则直接将a的值赋给c</span></span><br><span class="line">        <span class="comment">//后面同理，因为a元素对应在b矩阵处值为0</span></span><br><span class="line">        <span class="comment">//i,k递增</span></span><br><span class="line">            k++;</span><br><span class="line">            c-&gt;Element[k].row = a-&gt;Element[i].row;</span><br><span class="line">            c-&gt;Element[k].col = a-&gt;Element[i].col;</span><br><span class="line">            c-&gt;Element[k].data = a-&gt;Element[i].data;</span><br><span class="line">            i++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;<span class="comment">//剩下的情况就是b矩阵的值的位置对应在a矩阵中的值为0</span></span><br><span class="line">        <span class="comment">//即 c = 0+b</span></span><br><span class="line">        <span class="comment">//j,k递增</span></span><br><span class="line">            k++;</span><br><span class="line">            c-&gt;Element[k].row = b-&gt;Element[j].row;</span><br><span class="line">            c-&gt;Element[k].col = b-&gt;Element[j].col;</span><br><span class="line">            c-&gt;Element[k].data = b-&gt;Element[j].data;</span><br><span class="line">            j++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> (i &lt;= a-&gt;num)</span><br><span class="line">    &#123;<span class="comment">//若a矩阵中还有未处理完的非零元，则直接加上</span></span><br><span class="line">        k++;</span><br><span class="line">        c-&gt;Element[k].row = a-&gt;Element[i].row;</span><br><span class="line">        c-&gt;Element[k].col = a-&gt;Element[i].col;</span><br><span class="line">        c-&gt;Element[k].data = a-&gt;Element[i].data;</span><br><span class="line">        i++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> (j &lt;= b-&gt;num)</span><br><span class="line">    &#123;<span class="comment">//道理同上,b矩阵的值直接赋给c</span></span><br><span class="line">        k++;</span><br><span class="line">        c-&gt;Element[k].row = b-&gt;Element[j].row;</span><br><span class="line">        c-&gt;Element[k].col = b-&gt;Element[j].col;</span><br><span class="line">        c-&gt;Element[k].data = b-&gt;Element[j].data;</span><br><span class="line">        j++;</span><br><span class="line">    &#125;</span><br><span class="line">    c-&gt;num = k;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">initial</span><span class="params">(pTsmatrix p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= p-&gt;num; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d %d %d&quot;</span>, &amp;p-&gt;Element[i].row, &amp;p-&gt;Element[i].col, &amp;p-&gt;Element[i].data);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="3-行逻辑连接的顺序表"><a href="#3-行逻辑连接的顺序表" class="headerlink" title="3.行逻辑连接的顺序表"></a>3.行逻辑连接的顺序表</h2><p>由上题快速转置，我们可以想到将pos[]数组放在结构体里，得到行逻辑连接顺序表</p><p>概念:为了便于随机存取任意一行的非零元，则需知道每一行的第一个非零元在三元组表中的位置。为此，可将快速转置矩阵的算法中创建的辅助数组cpot，rpos固定在稀疏矩阵的存储结构中。这种带“行链接信息”的三元组表称为行逻辑链接的顺序表。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span>&#123;</span></span><br><span class="line">        Triple  data[MaxSize];</span><br><span class="line">        <span class="keyword">int</span>  rpos[MaxRC+<span class="number">1</span>];<span class="comment">//数组起始下标为1</span></span><br><span class="line">        <span class="keyword">int</span>  mu, nu, tu;<span class="comment">//分别为行数，列数，非零元个数</span></span><br><span class="line">&#125;RLSMatrix;</span><br></pre></td></tr></table></figure><h4 id="矩阵乘法"><a href="#矩阵乘法" class="headerlink" title="矩阵乘法"></a>矩阵乘法</h4><p>以上述结构进行矩阵乘法，可以体现出其优越性</p><p><img data-src="http://cdn.sekyoro.top/imgs/065117.png" alt="image-20210418163820144"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">C=AxB</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (i=<span class="number">0</span>; i&lt;m; i++) </span><br><span class="line">    <span class="keyword">for</span> (j=<span class="number">0</span>; j&lt;l; j++)</span><br><span class="line">    &#123;</span><br><span class="line">        C[i][j]=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (k=<span class="number">0</span>; k&lt;n; k++)</span><br><span class="line">            C[i][j] += A[i][k]*B[k][j]</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>矩阵的乘法，当两个值其中一个为0，则乘积为0，因此，应免去这种无效操作。</p><p>例如矩阵元素(1,2,4)与(2,3,6)则可以算出(1,3,24)</p><p>但是若没有相对应的元素(即左乘数的列==右乘数的行),则乘积为0.</p><p>因此,只需在右乘数中寻找符合的非零值，利用上述数据结构特点。</p><p>rpos[row]为第row行第一个非零元素在三元组表中的位置</p><p><strong>基本操作</strong></p><p>M×N</p><p>对于M中每个元素，找到N中满足条件的值，求的乘积。</p><p>矩阵相应位置的值为几个乘积的和，所以设置一个累计和的变量，初值为0.</p><p><strong>易忽略点</strong></p><p>两个稀疏矩阵相乘的值不一定是稀疏矩阵。</p><p>因为几个乘积的和不一定非零，所以算出值后需要检验。</p><p>若为0则跳过</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Status <span class="title">MultiSMatrix</span><span class="params">(RLSMatrix M, RLSMatrix N, RLSMatrix *Q)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> arow, brow, ccol, p, q, t;</span><br><span class="line">    <span class="keyword">float</span> ctemp[];</span><br><span class="line">    <span class="keyword">if</span> (M.mu != N.nu)</span><br><span class="line">        <span class="keyword">return</span> ERROR;</span><br><span class="line">    Q-&gt;mu = M.mu;</span><br><span class="line">    Q-&gt;nu = N.nu;</span><br><span class="line">    Q-&gt;tu = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (M.tu * N.tu != <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (arow = <span class="number">0</span>; arow &lt; M.mu; ++arow)</span><br><span class="line">        &#123;</span><br><span class="line">            ctemp[] = <span class="number">0</span>; <span class="comment">//memset(ctemp,0,n*sizeof(float));</span></span><br><span class="line">            Q-&gt;rpos[arow] = Q-&gt;tu;</span><br><span class="line">            <span class="keyword">for</span> (p = M.rpos[arow]; p &lt; M.rpos[arow + <span class="number">1</span>]; ++p)</span><br><span class="line">            &#123;</span><br><span class="line">                brow = M.data[p].j;</span><br><span class="line">                <span class="keyword">for</span> (q = N.rpos[brow]; q &lt; N.rpos[brow + <span class="number">1</span>]; ++q)</span><br><span class="line">                &#123;</span><br><span class="line">                    ccol = N.data[q].j;</span><br><span class="line">                    ctemp[ccol] += M.data[p].elem * N.data[q].elem;</span><br><span class="line">                &#125; <span class="comment">//for q</span></span><br><span class="line">            &#125;     <span class="comment">// for p</span></span><br><span class="line"> <span class="keyword">for</span> (ccol = <span class="number">0</span>; ccol &lt; Q.nu; ++ccol)</span><br><span class="line">            &#123;</span><br><span class="line">       <span class="keyword">if</span> (ctemp[ccol] &#123;</span><br><span class="line">          <span class="keyword">if</span> (++Q-&gt;tu &gt; MAXSIZE)</span><br><span class="line">                     <span class="keyword">return</span> ERROR;</span><br><span class="line">              <span class="keyword">else</span></span><br><span class="line">                  &#123;</span><br><span class="line">                 Q-&gt;data[Q-&gt;tu].i = arow;</span><br><span class="line">                 Q-&gt;data[Q-&gt;tu].j =ccol;</span><br><span class="line">          Q-&gt;data[Q-&gt;tu].elem=ctemp[ccol];</span><br><span class="line">                    &#125; <span class="comment">//else</span></span><br><span class="line">                   &#125; <span class="comment">//if</span></span><br><span class="line">            &#125;  <span class="comment">//for ccol</span></span><br><span class="line">      &#125; <span class="comment">//for arrow</span></span><br><span class="line">   &#125;  <span class="comment">//if</span></span><br><span class="line">    <span class="keyword">return</span> OK;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>时间复杂度    O(M.mu×N.nu+M.tu×N.tu/N.mu)</p><p><img data-src="http://cdn.sekyoro.top/imgs/092914.png" alt="image-20210418181608401"></p><h2 id="4-十字链表"><a href="#4-十字链表" class="headerlink" title="4.十字链表"></a>4.十字链表</h2><p>当需要进行矩阵加法,减法,乘法时，矩阵中非零元素个数和位置会发生变化，若用三元组表表示会移动大量元素,相对较麻烦.</p><p>十字链表能够灵活插入因运算产生的新的非零元素,删除因运算产生的新的零元素.</p><p>由于矩阵有行和列，所以一个结点除了数据域(i, j, elem)之外，还应该用两个方向的指针(right, down)，分别指向行和列。这样整个矩阵构成了一个十字交叉的链表，因此称十字链表。每一行或每一列的头指针，可以用两个一维指针数组来存放。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">OLNode</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">        <span class="keyword">int</span>  i, j;</span><br><span class="line">        ElemType  elem;</span><br><span class="line">        <span class="class"><span class="keyword">struct</span> <span class="title">OLNode</span> *<span class="title">right</span>, *<span class="title">down</span>;</span></span><br><span class="line">&#125;OLNode, *OLink;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">        OLink  *rHead, *cHead;</span><br><span class="line">        <span class="keyword">int</span>  mu, nu, tu;<span class="comment">//行数，列数，非零元个数</span></span><br><span class="line">&#125;CrossList;</span><br></pre></td></tr></table></figure><p>初始化十字链表</p><p><strong>算法实现</strong></p><ol><li>读入稀疏矩阵行数列数，非零元个数</li><li>动态申请行链表,列链表头指针向量</li><li>逐个读入非零元，分别插入行链表,列链表</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Status <span class="title">CreateOLSMatrix</span> <span class="params">(CrossList *M)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (M) <span class="built_in">free</span>(M); <span class="built_in">scanf</span>(&amp;m, &amp;n, &amp;t);</span><br><span class="line">    M.mu=m; M.nu=n; M.tu=t;</span><br><span class="line">    <span class="keyword">if</span> (!(M.rhead=(OLink *) <span class="built_in">malloc</span> ((m+<span class="number">1</span>)*<span class="keyword">sizeof</span>(OLink)))) </span><br><span class="line">        <span class="built_in">exit</span> (OVERFLOW);</span><br><span class="line">    <span class="keyword">if</span> (!(M.chead=(OLink *) <span class="built_in">malloc</span> ((n+<span class="number">1</span>)*<span class="keyword">sizeof</span>(OLink)))) </span><br><span class="line">        <span class="built_in">exit</span> (OVERFLOW);</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">scanf</span>(&amp;i, &amp;j, &amp;e); i!=<span class="number">0</span>; <span class="built_in">scanf</span>(&amp;i, &amp;j, &amp;e))  &#123;</span><br><span class="line">        <span class="keyword">if</span> (!(p=(OLink*) <span class="built_in">malloc</span> (<span class="keyword">sizeof</span>(OLNode))) <span class="built_in">exit</span> (OVERFLOW);</span><br><span class="line">        p-&gt;i=i; p-&gt;j=j; p-&gt;elem=e;</span><br><span class="line">        <span class="keyword">if</span> (M.rhead[i]==<span class="literal">NULL</span> || M.rhead[i]-&gt;j &gt; j)  &#123;</span><br><span class="line">            p-&gt;right=M.rhead[i]; M.rhead[i]=p; </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (q=M.rhead[i]; (q-&gt;right) &amp;&amp; q-&gt;right-&gt;j &lt; j; q=q-&gt;right);</span><br><span class="line">            p-&gt;right=q-&gt;right; q-&gt;right=p;</span><br><span class="line">        &#125;  <span class="comment">//完成行插入</span></span><br><span class="line"><span class="keyword">if</span> (M.chead[j]==<span class="literal">NULL</span> || M.chead[j]-&gt;i &gt; i)  &#123;</span><br><span class="line">            p-&gt;down=M.chead[j]; M.chead[j]=p; </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (q=M.chead[j]; (q-&gt;down) &amp;&amp; q-&gt;down-&gt;i &lt; i; q=q-&gt;down);</span><br><span class="line">            p-&gt;down=q-&gt;down; q-&gt;down=p;</span><br><span class="line">        &#125;  <span class="comment">//完成列插入</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> OK;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="矩阵加法"><a href="#矩阵加法" class="headerlink" title="矩阵加法"></a>矩阵加法</h3><p><strong>算法原理</strong></p><p>​       对每一行都用行表头出发分别找到A和B在该行中的第一个非零元，假设非空指针pa和pb分别指向矩阵A和B中行值相同的两个结点，</p><p>将B加到A上去时，对A矩阵的十字链表来说,要么改变值(!=0),或者不变(b=0),或者插入一个节点(a=0),或者相加和为0，操作时删除这个节点.</p><p>整个运算从从矩阵第一行逐行进行,对每一行都从行表头出发分别找到A和B在该行的第一个非零元节点后开始比较</p><p>（1）若pa==NULL或pa-&gt;j&gt;pb-&gt;j，则需要在A中插入B结点；<br>（2）若pa-&gt;j==pb-&gt;j，且pa-&gt;elem+pb-&gt;elem!=0，则A结点改值；<br>（3）若pa-&gt;j==pb-&gt;j，且pa-&gt;elem+pb-&gt;elem==0，则需要删除A结点；<br>（4）若pa-&gt;j<pb->j，则只要将pa指针往右推进。<br>        为了便于插入和删除结点，需要设立一些辅助指针，比如pre指针指示pa所指结点的前驱结点，每一列也要设立一个指针hl[j]，初始值和列链表的头指针相同chead[j]。</p><ol><li>若pa ==NULL或pa-&gt;j&gt;pb-&gt;j,表明当前行元素已处理完,需要在A矩阵的链表中插入一个B的节点，也就是要改变pa前一个节点的right域同时改变添加节点所在列上一节点的down域</li><li>若pa-&gt;j<pb->j,使pa节点后移即可，注意改变pre</li><li>若pa-&gt;j == pb-&gt;j，两值相加，注意值是否为0，若为0删除该节点，不为0改变值即可</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">OLNode</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">int</span> i, j, e;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">OLNode</span> *<span class="title">down</span>, *<span class="title">right</span>;</span></span><br><span class="line">&#125; OLNode, *OLlink;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    OLlink *rhead, *chead; <span class="comment">//指向行或列第一个非零元(指向结构体的指针),可以用数组rhead[row]表示第row行的数据</span></span><br><span class="line">    <span class="keyword">int</span> m, n, len;         <span class="comment">//行列数,非零元个数</span></span><br><span class="line">&#125; CrossList;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">initial</span><span class="params">(CrossList *)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">plus</span><span class="params">(CrossList *, CrossList *)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">(CrossList *)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Insert</span><span class="params">(CrossList *, OLlink, OLlink, OLlink *, OLlink *)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(CrossList *, OLlink, OLlink, OLlink *, OLlink *)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    CrossList *M = (CrossList *)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(CrossList));</span><br><span class="line">    CrossList *N = (CrossList *)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(CrossList));</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;M-&gt;m, &amp;M-&gt;n);</span><br><span class="line">    N-&gt;m = M-&gt;m;</span><br><span class="line">    N-&gt;n = M-&gt;n;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;M-&gt;len, &amp;N-&gt;len);</span><br><span class="line">    initial(M);</span><br><span class="line">    initial(N);</span><br><span class="line">    plus(M, N);</span><br><span class="line">    print(M);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">(CrossList *M)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> row = <span class="number">1</span>; row &lt;= M-&gt;m; row++)</span><br><span class="line">    &#123;</span><br><span class="line">        OLlink pa = M-&gt;rhead[row];</span><br><span class="line">        <span class="keyword">while</span> (pa)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d %d %d\n&quot;</span>, pa-&gt;i, pa-&gt;j, pa-&gt;e);</span><br><span class="line">            pa = pa-&gt;right;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">plus</span><span class="params">(CrossList *M, CrossList *N)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    OLlink pa, pb;</span><br><span class="line">    OLlink pre; <span class="comment">//指向前面一个节点,方便插入</span></span><br><span class="line">    OLlink *hl = (OLlink *)<span class="built_in">malloc</span>((M-&gt;n + <span class="number">1</span>) * <span class="keyword">sizeof</span>(OLlink));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= M-&gt;n; j++)</span><br><span class="line">        hl[j] = M-&gt;chead[j]; <span class="comment">//hl[]表示的是每列非零元的pre指向元素，与pre类似</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> row = <span class="number">1</span>; row &lt;= M-&gt;m; row++) <span class="comment">//行遍历</span></span><br><span class="line">    &#123;</span><br><span class="line">        pa = M-&gt;rhead[row];</span><br><span class="line">        pb = N-&gt;rhead[row];</span><br><span class="line">        pre = <span class="literal">NULL</span>;</span><br><span class="line">        <span class="keyword">while</span> (pb) <span class="comment">//当pb有非零元素时进行处理</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (pa == <span class="literal">NULL</span> || pa-&gt;j &gt; pb-&gt;j)</span><br><span class="line">            &#123;</span><br><span class="line"></span><br><span class="line">                Insert(M, pa, pb, &amp;pre, hl);</span><br><span class="line">                pb = pb-&gt;right;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (pa != <span class="literal">NULL</span> &amp;&amp; pa-&gt;j &lt; pb-&gt;j)</span><br><span class="line">            &#123;</span><br><span class="line">                pre = pa;</span><br><span class="line">                pa = pa-&gt;right;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (pa-&gt;j == pb-&gt;j)</span><br><span class="line">            &#123;</span><br><span class="line">                add(M, pa, pb, &amp;pre, hl);</span><br><span class="line">                pb = pb-&gt;right;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(CrossList *M, OLlink pa, OLlink pb, OLlink *pre, OLlink *hl)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> data = pa-&gt;e + pb-&gt;e;</span><br><span class="line">    <span class="keyword">if</span> (data)</span><br><span class="line">    &#123;</span><br><span class="line">        pa-&gt;e = data;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        OLlink temp = (OLlink)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(OLNode));</span><br><span class="line">        <span class="keyword">if</span> ((*pre) == <span class="literal">NULL</span>)</span><br><span class="line">            M-&gt;rhead[pa-&gt;i] = pa-&gt;right;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            (*pre)-&gt;right = pa-&gt;right;</span><br><span class="line">        &#125;</span><br><span class="line">        temp = pa;</span><br><span class="line">        pa = pa-&gt;right;</span><br><span class="line">        <span class="keyword">if</span> (M-&gt;chead[temp-&gt;j] == temp)</span><br><span class="line">            M-&gt;chead[temp-&gt;j] = hl[temp-&gt;j] = temp-&gt;down;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            hl[temp-&gt;j]-&gt;down = temp-&gt;down;</span><br><span class="line">        <span class="built_in">free</span>(temp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Insert</span><span class="params">(CrossList *M, OLlink pa, OLlink pb, OLlink *pre, OLlink *hl)</span> <span class="comment">//插入有两种情况，一种是pa该行无非零元素，另一种pb所在列小于pa所在列</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    OLlink p = (OLlink)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(OLNode));</span><br><span class="line">    p-&gt;i = pb-&gt;i;</span><br><span class="line">    p-&gt;j = pb-&gt;j;</span><br><span class="line">    p-&gt;e = pb-&gt;e;</span><br><span class="line">    p-&gt;down = p-&gt;right = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">if</span> ((*pre) == <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        M-&gt;rhead[p-&gt;i] = p;</span><br><span class="line">      </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        (*pre)-&gt;right = p;</span><br><span class="line">      </span><br><span class="line">    &#125;</span><br><span class="line">    p-&gt;right = pa;</span><br><span class="line">    </span><br><span class="line">    (*pre) = p;</span><br><span class="line">    pa = (*pre)-&gt;right;<span class="comment">//这一句可以不要</span></span><br><span class="line">    <span class="keyword">if</span> (!M-&gt;chead[p-&gt;j] || M-&gt;chead[p-&gt;j]-&gt;i &gt; p-&gt;i)</span><br><span class="line">    &#123;</span><br><span class="line">        p-&gt;down = M-&gt;chead[p-&gt;j];</span><br><span class="line">        M-&gt;chead[p-&gt;j] = p;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        p-&gt;down = hl[p-&gt;j]-&gt;down;</span><br><span class="line">        hl[p-&gt;j]-&gt;down = p;</span><br><span class="line">    &#125;</span><br><span class="line">    hl[p-&gt;j] = p;</span><br><span class="line">   </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">initial</span><span class="params">(CrossList *Clist)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i, j, e;</span><br><span class="line">    Clist-&gt;rhead = (OLlink *)<span class="built_in">malloc</span>((Clist-&gt;m + <span class="number">1</span>) * <span class="keyword">sizeof</span>(OLlink));</span><br><span class="line">    Clist-&gt;chead = (OLlink *)<span class="built_in">malloc</span>((Clist-&gt;n + <span class="number">1</span>) * <span class="keyword">sizeof</span>(OLlink));</span><br><span class="line">    <span class="comment">// if(rhead||chead)</span></span><br><span class="line">    <span class="comment">// exit(1);</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= Clist-&gt;m; i++)</span><br><span class="line">        Clist-&gt;rhead[i] = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= Clist-&gt;n; i++)</span><br><span class="line">        Clist-&gt;chead[i] = <span class="literal">NULL</span>;</span><br><span class="line">    OLlink s = (OLlink)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(OLNode));</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> count = <span class="number">0</span>; count &lt; Clist-&gt;len; count++)</span><br><span class="line">    &#123;</span><br><span class="line">        OLlink cur = (OLlink)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(OLNode));</span><br><span class="line">        cur-&gt;down = <span class="literal">NULL</span>;</span><br><span class="line">        cur-&gt;right = <span class="literal">NULL</span>;</span><br><span class="line">        <span class="comment">// if(cur==NULL)</span></span><br><span class="line">        <span class="comment">// exit(1);</span></span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d %d %d&quot;</span>, &amp;i, &amp;j, &amp;e);</span><br><span class="line">        cur-&gt;i = i;</span><br><span class="line">        cur-&gt;j = j;</span><br><span class="line">        cur-&gt;e = e;</span><br><span class="line">        <span class="keyword">if</span> (Clist-&gt;rhead[i] == <span class="literal">NULL</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            Clist-&gt;rhead[i] = cur;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            s = Clist-&gt;rhead[i];</span><br><span class="line">            <span class="keyword">while</span> (s-&gt;right != <span class="literal">NULL</span> &amp;&amp; s-&gt;right-&gt;j &lt; j)</span><br><span class="line">                s = s-&gt;right;</span><br><span class="line">            cur-&gt;right = s-&gt;right;</span><br><span class="line">            s-&gt;right = cur;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (Clist-&gt;chead[j] == <span class="literal">NULL</span>)</span><br><span class="line">            Clist-&gt;chead[j] = cur;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            s = Clist-&gt;chead[j];</span><br><span class="line">            <span class="keyword">while</span> (s-&gt;down != <span class="literal">NULL</span> &amp;&amp; s-&gt;down-&gt;i &lt; i)</span><br><span class="line">                s = s-&gt;down;</span><br><span class="line">            cur-&gt;down = s-&gt;down;</span><br><span class="line">            s-&gt;down = cur;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> study </category>
          
      </categories>
      
      
        <tags>
            
            <tag> data_structure </tag>
            
            <tag> c </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>数据结构noj_1</title>
      <link href="2021/04/15/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84noj_1/"/>
      <url>2021/04/15/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84noj_1/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="数据结构noj-1"><a href="#数据结构noj-1" class="headerlink" title="数据结构noj_1"></a>数据结构noj_1</h1><p>个人做的，不当之处欢迎提出，希望一起改进。</p><p>先发前10题  <del>因为后面我也没做</del></p><span id="more"></span><h2 id="1"><a href="#1" class="headerlink" title="1."></a>1.</h2><p><img data-src="http://cdn.sekyoro.top/imgs/094027.png" alt="image-20210416000331032"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> maxsize 1000</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">list</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">int</span> elenum;</span><br><span class="line">    <span class="keyword">int</span> element[maxsize];</span><br><span class="line">&#125;<span class="built_in">list</span>,* plist;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> size;</span><br><span class="line">    <span class="keyword">int</span> num;</span><br><span class="line">    <span class="keyword">int</span> insert_num;</span><br><span class="line">    <span class="keyword">int</span> i,j;  </span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;size);</span><br><span class="line">    plist l = (plist)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="built_in">list</span>));</span><br><span class="line"> </span><br><span class="line">        l-&gt;elenum=size;</span><br><span class="line">        <span class="keyword">for</span>(i = <span class="number">0</span>; i&lt;l-&gt;elenum ;i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;num);</span><br><span class="line">            l-&gt;element[i] = num;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;insert_num);      </span><br><span class="line">        <span class="keyword">for</span>(i = <span class="number">0</span>;i&lt;l-&gt;elenum;i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(l-&gt;element[i]&gt;=insert_num)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">for</span>( j = size;j&gt;i;j--)</span><br><span class="line">                &#123;</span><br><span class="line">                l-&gt;element[j] = l-&gt;element[j<span class="number">-1</span>];      </span><br><span class="line">                &#125;</span><br><span class="line">                l-&gt;element[j] = insert_num;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(i==l-&gt;elenum)</span><br><span class="line">        l-&gt;element[i] = insert_num;</span><br><span class="line">        l-&gt;elenum++;   </span><br><span class="line">    </span><br><span class="line"> </span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;l-&gt;elenum;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d%c&quot;</span>,l-&gt;element[i],(i==l-&gt;elenum<span class="number">-1</span>)?<span class="string">&#x27;\n&#x27;</span>:<span class="string">&#x27; &#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2"><a href="#2" class="headerlink" title="2."></a>2.</h2><p><img data-src="http://cdn.sekyoro.top/imgs/094034.png" alt="image-20210416000434268"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> maxsize 1000</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">Sequence_List</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">int</span> element[maxsize];</span><br><span class="line">    <span class="keyword">int</span> elenum;</span><br><span class="line">&#125; List, *pList;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">LinkList</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">int</span> num;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">LinkList</span> *<span class="title">next</span>;</span></span><br><span class="line">&#125; Node, *pLinkList;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    pList pa = (pList)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(List));</span><br><span class="line">    pLinkList pb, s, r;</span><br><span class="line">    <span class="keyword">int</span> size, i, num;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;size);</span><br><span class="line">    pa-&gt;elenum = size;</span><br><span class="line">    pb = (pLinkList)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(Node));</span><br><span class="line">    pb-&gt;next = <span class="literal">NULL</span>;</span><br><span class="line">    s = pb;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; size; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;num);</span><br><span class="line">        pa-&gt;element[i] = num;</span><br><span class="line">        r = (pLinkList)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(Node));</span><br><span class="line">        r-&gt;num = num;</span><br><span class="line">        s-&gt;next = r;</span><br><span class="line">        s = r;</span><br><span class="line">    &#125;</span><br><span class="line">    s-&gt;next = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">int</span> temp;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt;= (size - <span class="number">1</span>) / <span class="number">2</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        temp = pa-&gt;element[i];</span><br><span class="line">        pa-&gt;element[i] = pa-&gt;element[size - <span class="number">1</span> - i];</span><br><span class="line">        pa-&gt;element[size - i - <span class="number">1</span>] = temp;</span><br><span class="line">    &#125; <span class="comment">//顺序表逆序</span></span><br><span class="line">    s = pb-&gt;next;</span><br><span class="line">    pb-&gt;next = <span class="literal">NULL</span>;</span><br><span class="line">    Node *p;</span><br><span class="line">    <span class="keyword">while</span> (s)</span><br><span class="line">    &#123;</span><br><span class="line">        p = s;</span><br><span class="line">        s = s-&gt;next;</span><br><span class="line">        p-&gt;next = pb-&gt;next;</span><br><span class="line">        pb-&gt;next = p;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; size; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d%c&quot;</span>, pa-&gt;element[i], (i == size - <span class="number">1</span>) ? <span class="string">&#x27;\n&#x27;</span> : <span class="string">&#x27; &#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> (p)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d%c&quot;</span>, p-&gt;num, (p-&gt;next == <span class="literal">NULL</span>) ? <span class="string">&#x27;\n&#x27;</span> : <span class="string">&#x27; &#x27;</span>);</span><br><span class="line">        p = p-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">free</span>(pa);</span><br><span class="line">    <span class="built_in">free</span>(pb);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="3"><a href="#3" class="headerlink" title="3."></a>3.</h2><p><img data-src="http://cdn.sekyoro.top/imgs/094045.png" alt="image-20210416000510643"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> maxsize 1000</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">List</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">int</span> length;</span><br><span class="line">    <span class="keyword">int</span> data[maxsize];</span><br><span class="line">&#125; List, *pList;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">give_value</span><span class="params">(pList)</span></span>;</span><br><span class="line"><span class="function">pList <span class="title">cross_list</span><span class="params">(pList, pList)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">delete_list</span><span class="params">(pList, <span class="keyword">int</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">delete_num</span><span class="params">(pList, pList)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i ;</span><br><span class="line">    pList pa ;</span><br><span class="line">    pa = (pList)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(List));</span><br><span class="line">    pList pb = (pList)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(List));</span><br><span class="line">    pList pc = (pList)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(List));</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d %d %d&quot;</span>, &amp;pa-&gt;length, &amp;pb-&gt;length, &amp;pc-&gt;length);</span><br><span class="line">    give_value(pa);</span><br><span class="line">    give_value(pb);</span><br><span class="line">    give_value(pc);</span><br><span class="line">    pb = cross_list(pb, pc);</span><br><span class="line">    delete_num(pa, pb);</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; pa-&gt;length; i++)</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d%c&quot;</span>, pa-&gt;data[i], (i == pa-&gt;length - <span class="number">1</span>) ? <span class="string">&#x27;\n&#x27;</span> : <span class="string">&#x27; &#x27;</span>);</span><br><span class="line">    <span class="built_in">free</span>(pa);</span><br><span class="line">    <span class="built_in">free</span>(pb);</span><br><span class="line">    <span class="built_in">free</span>(pc);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">give_value</span><span class="params">(pList p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> num ;</span><br><span class="line">    <span class="keyword">int</span> i ;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; p-&gt;length; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;num);</span><br><span class="line">        p-&gt;data[i] = num;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">pList <span class="title">cross_list</span><span class="params">(pList p, pList q)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    pList result = (pList)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(List));</span><br><span class="line">    <span class="keyword">int</span> i, j;</span><br><span class="line">    <span class="keyword">int</span> t ;</span><br><span class="line">    i = <span class="number">0</span>;</span><br><span class="line">    j = <span class="number">0</span>;</span><br><span class="line">    t =<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (i &lt; p-&gt;length &amp;&amp; j &lt; q-&gt;length)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (p-&gt;data[i] &gt; q-&gt;data[j])</span><br><span class="line">        &#123;</span><br><span class="line">            j++;   </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">if</span>(p-&gt;data[i] &lt; q-&gt;data[j])</span><br><span class="line">        &#123;</span><br><span class="line">            i++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            result-&gt;data[t] = p-&gt;data[i];</span><br><span class="line">            i++;</span><br><span class="line">            j++;</span><br><span class="line">            t++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    result-&gt;length = t+<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">delete_num</span><span class="params">(pList pa, pList pb)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i ;</span><br><span class="line">    <span class="keyword">int</span> j ;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; pb-&gt;length; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; pa-&gt;length;)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (pb-&gt;data[i] &lt; pa-&gt;data[j])</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (pb-&gt;data[i] &gt; pa-&gt;data[j])</span><br><span class="line">            &#123;</span><br><span class="line">                j++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                delete_list (pa, j);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">delete_list</span><span class="params">(pList p, <span class="keyword">int</span> n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i ;</span><br><span class="line">    <span class="keyword">for</span> (i = n; i &lt; p-&gt;length - <span class="number">1</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        p-&gt;data[i] = p-&gt;data[i + <span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    p-&gt;length--;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="4"><a href="#4" class="headerlink" title="4."></a>4.</h2><p><img data-src="http://cdn.sekyoro.top/imgs/094053.png" alt="image-20210416000602232"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">Node</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">int</span> data;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Node</span>* <span class="title">next</span>;</span></span><br><span class="line">&#125;Node,*Linklist;</span><br><span class="line"><span class="function">Linklist <span class="title">initial_list</span><span class="params">(Linklist,<span class="keyword">int</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">merge</span><span class="params">(Linklist,Linklist)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Linklist L,M;</span><br><span class="line">    <span class="keyword">int</span> n = <span class="number">0</span>,m=<span class="number">0</span>;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>,&amp;n,&amp;m);</span><br><span class="line">    L = initial_list(L,n);</span><br><span class="line">    M = initial_list(M,m);</span><br><span class="line">    merge(L,M);</span><br><span class="line">    L = L-&gt;next;</span><br><span class="line">    <span class="keyword">while</span>(L)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d%c&quot;</span>,L-&gt;data,(L-&gt;next==<span class="literal">NULL</span>)?<span class="string">&#x27;\n&#x27;</span>:<span class="string">&#x27; &#x27;</span>);</span><br><span class="line">        L = L-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">merge</span><span class="params">(Linklist pa,Linklist pb)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Linklist p=pa-&gt;next,q=pb-&gt;next;</span><br><span class="line">    pb-&gt;next = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">while</span>(p&amp;&amp;q)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(p-&gt;data&gt;q-&gt;data)</span><br><span class="line">        &#123;</span><br><span class="line">            pa-&gt;next = p;</span><br><span class="line">            p = p-&gt;next;</span><br><span class="line">            pa = pa-&gt;next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                pa-&gt;next = q;</span><br><span class="line">                q = q-&gt;next;</span><br><span class="line">                pa = pa-&gt;next;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> (p<span class="comment">/* condition */</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        pa-&gt;next = p;</span><br><span class="line">        pa = p;</span><br><span class="line">        p = p-&gt;next;</span><br><span class="line">        <span class="comment">/* code */</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span>(q)</span><br><span class="line">    &#123;</span><br><span class="line">        pa-&gt;next = q;</span><br><span class="line">        pa = q;</span><br><span class="line">        q = q-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">    pa-&gt;next = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="function">Linklist <span class="title">initial_list</span><span class="params">(Linklist L,<span class="keyword">int</span> n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    L = (Linklist)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(Node));</span><br><span class="line">    L-&gt;next = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">int</span> num=<span class="number">0</span>;</span><br><span class="line">    Linklist s = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">while</span>(n--)</span><br><span class="line">    &#123;</span><br><span class="line">        s = (Linklist)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(Node));</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;num);</span><br><span class="line">        s-&gt;data = num;</span><br><span class="line">        s-&gt;next = L-&gt;next;</span><br><span class="line">        L-&gt;next = s;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> L;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="5"><a href="#5" class="headerlink" title="5."></a>5.</h2><p><img data-src="http://cdn.sekyoro.top/imgs/094100.png" alt="image-20210416000639344"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">Node</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">int</span> data;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Node</span> *<span class="title">next</span>;</span></span><br><span class="line">&#125; Node, *Linklist;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">give_value</span><span class="params">(Linklist, <span class="keyword">int</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">cross_list</span><span class="params">(Linklist, Linklist)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">delete_list</span><span class="params">(Linklist, Linklist)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Linklist pa = (Linklist)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(Node));</span><br><span class="line">    Linklist pb = (Linklist)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(Node));</span><br><span class="line">    Linklist pc = (Linklist)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(Node));</span><br><span class="line">    <span class="keyword">int</span> num_1, num_2, num_3;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d %d %d&quot;</span>, &amp;num_1, &amp;num_2, &amp;num_3);</span><br><span class="line">    give_value(pa, num_1);</span><br><span class="line">    give_value(pb, num_2);</span><br><span class="line">    give_value(pc, num_3);</span><br><span class="line">    cross_list(pb, pc);</span><br><span class="line">    delete_list(pa, pb);</span><br><span class="line">    <span class="keyword">while</span> (pa-&gt;next)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d%c&quot;</span>, pa-&gt;next-&gt;data,(pa-&gt;next==<span class="literal">NULL</span>)?<span class="string">&#x27;\n&#x27;</span>:<span class="string">&#x27; &#x27;</span>);</span><br><span class="line">        pa = pa-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">delete_list</span><span class="params">(Linklist pa, Linklist pb)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Linklist tail = pa;</span><br><span class="line">    Linklist p = tail-&gt;next;</span><br><span class="line">    Linklist q;</span><br><span class="line">    <span class="keyword">while</span> (p)</span><br><span class="line">    &#123;</span><br><span class="line">        q = pb-&gt;next;</span><br><span class="line">        <span class="keyword">while</span> (q)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (p-&gt;data == q-&gt;data)</span><br><span class="line">            &#123;</span><br><span class="line">                p = p-&gt;next;</span><br><span class="line">                <span class="built_in">free</span>(tail-&gt;next);</span><br><span class="line">                tail-&gt;next = p;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                q = q-&gt;next;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (q == <span class="literal">NULL</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            tail = tail-&gt;next;</span><br><span class="line">            p = tail-&gt;next;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">give_value</span><span class="params">(Linklist p, <span class="keyword">int</span> n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Linklist s, r;</span><br><span class="line">    s = p;</span><br><span class="line">    <span class="keyword">while</span> (n--)</span><br><span class="line">    &#123;</span><br><span class="line">        r = (Linklist)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(Node));</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;r-&gt;data);</span><br><span class="line">        s-&gt;next = r;</span><br><span class="line">        s = s-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">    s-&gt;next = <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">cross_list</span><span class="params">(Linklist p, Linklist q)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Linklist s, r, tail;</span><br><span class="line">    tail = p;</span><br><span class="line">    s = tail-&gt;next;</span><br><span class="line">    <span class="keyword">while</span> (s)</span><br><span class="line">    &#123;</span><br><span class="line">        r = q-&gt;next;</span><br><span class="line">        <span class="keyword">while</span> (r)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (s-&gt;data == r-&gt;data)</span><br><span class="line">            &#123;</span><br><span class="line">                tail = tail-&gt;next;</span><br><span class="line">                s = tail-&gt;next;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                r = r-&gt;next;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (r == <span class="literal">NULL</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            s = s-&gt;next;</span><br><span class="line">            <span class="built_in">free</span>(tail-&gt;next);</span><br><span class="line">            tail-&gt;next = s;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="6"><a href="#6" class="headerlink" title="6."></a>6.</h2><p><img data-src="http://cdn.sekyoro.top/imgs/094109.png" alt="image-20210416000713105"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">Node</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">int</span> data;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Node</span> *<span class="title">pre</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Node</span> *<span class="title">next</span>;</span></span><br><span class="line">    <span class="keyword">int</span> freq;</span><br><span class="line">&#125; Node, *pNode;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">sort</span><span class="params">(<span class="keyword">const</span> pNode,<span class="keyword">int</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">initial</span><span class="params">(<span class="keyword">const</span> pNode, <span class="keyword">int</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Locate_</span><span class="params">(<span class="keyword">const</span> pNode, <span class="keyword">char</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">print_List</span><span class="params">(<span class="keyword">const</span> pNode)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    pNode pa = (pNode)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(Node));</span><br><span class="line">    <span class="keyword">int</span> size, l_size;</span><br><span class="line">    <span class="keyword">char</span> ch;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;size, &amp;l_size);</span><br><span class="line">    initial(pa, size);</span><br><span class="line">    <span class="keyword">while</span>(l_size--)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%c&quot;</span>,&amp;ch);</span><br><span class="line">        <span class="keyword">while</span>(ch&lt;=<span class="string">&#x27;A&#x27;</span>||ch&gt;=<span class="string">&#x27;z&#x27;</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%c&quot;</span>,&amp;ch);</span><br><span class="line">        &#125;</span><br><span class="line">        Locate_(pa,ch);</span><br><span class="line">    &#125;</span><br><span class="line">    sort(pa,size);</span><br><span class="line">    print_List(pa);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">print_List</span><span class="params">(pNode p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    pNode r;</span><br><span class="line">    r = p-&gt;next;</span><br><span class="line">    <span class="keyword">while</span>(r != p)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%c%c&quot;</span>,r-&gt;data,(r-&gt;next==<span class="literal">NULL</span>)?<span class="string">&#x27;\n&#x27;</span>:<span class="string">&#x27; &#x27;</span>);</span><br><span class="line">        r = r-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">sort</span><span class="params">(<span class="keyword">const</span> pNode p,<span class="keyword">int</span> size)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  pNode head,pa,pb;</span><br><span class="line">  <span class="keyword">int</span> i,j;</span><br><span class="line">  <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;size<span class="number">-1</span>;i++)</span><br><span class="line">  &#123;</span><br><span class="line">      head = p;</span><br><span class="line">      pa = head-&gt;next;</span><br><span class="line">      pb = pa-&gt;next;</span><br><span class="line">      j = size-i<span class="number">-1</span>;</span><br><span class="line">      <span class="keyword">while</span>(j--)</span><br><span class="line">      &#123;</span><br><span class="line">          <span class="keyword">if</span>(pa-&gt;freq&lt;pb-&gt;freq)</span><br><span class="line">          &#123;</span><br><span class="line">              pa-&gt;next = pb-&gt;next;</span><br><span class="line">              pb-&gt;next = pa;</span><br><span class="line">              head-&gt;next = pb;</span><br><span class="line">          &#125;</span><br><span class="line">          head = head-&gt;next;</span><br><span class="line">          pa = head-&gt;next;</span><br><span class="line">          pb = pa-&gt;next;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Locate_</span><span class="params">(<span class="keyword">const</span> pNode p, <span class="keyword">char</span> ch)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    pNode r = p-&gt;next;</span><br><span class="line">    <span class="keyword">while</span> (r != p)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (r-&gt;data == ch)</span><br><span class="line">        &#123;</span><br><span class="line">            (r-&gt;freq)++;</span><br><span class="line">            <span class="comment">// printf(&quot;%c++\n&quot;,r-&gt;data);</span></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            r = r-&gt;next;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">initial</span><span class="params">(<span class="keyword">const</span> pNode p, <span class="keyword">int</span> size)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    pNode s, r;</span><br><span class="line">    r = p;</span><br><span class="line">    <span class="keyword">int</span> ch;</span><br><span class="line">    <span class="keyword">while</span> (size--)</span><br><span class="line">    &#123;</span><br><span class="line">        s = (pNode)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(Node));</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%c&quot;</span>,&amp;ch);</span><br><span class="line">        <span class="keyword">while</span>(ch&lt;=<span class="string">&#x27;A&#x27;</span>||ch&gt;=<span class="string">&#x27;z&#x27;</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%c&quot;</span>,&amp;ch);</span><br><span class="line">        &#125;</span><br><span class="line">        s-&gt;data = ch;</span><br><span class="line">        s-&gt;freq = <span class="number">0</span>;</span><br><span class="line">        s-&gt;pre = r;</span><br><span class="line">        r-&gt;next = s;</span><br><span class="line">        p-&gt;pre = s;</span><br><span class="line">        s-&gt;next = p;</span><br><span class="line">        r = s;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="7"><a href="#7" class="headerlink" title="7."></a>7.</h2><p><img data-src="http://cdn.sekyoro.top/imgs/094112.png" alt="image-20210416000746427"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">Stack</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">int</span> op;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Stack</span> *<span class="title">next</span>;</span></span><br><span class="line">&#125;<span class="built_in">stack</span>,*pStack;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">match</span><span class="params">(<span class="keyword">int</span>,<span class="keyword">int</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">push_</span><span class="params">(pStack,<span class="keyword">int</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">pop</span><span class="params">(pStack)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">get_Pop</span><span class="params">(pStack)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> ch;</span><br><span class="line">    <span class="keyword">int</span> flag=<span class="number">1</span>;</span><br><span class="line">    pStack op_stack = (pStack)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="built_in">stack</span>));</span><br><span class="line">    op_stack-&gt;next = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">while</span>((ch=getchar())!=EOF&amp;&amp;ch!=<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">switch</span>(ch)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;&#123;&#x27;</span>:</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;[&#x27;</span>:</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;(&#x27;</span>:</span><br><span class="line">            push_(op_stack,ch);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;)&#x27;</span>:</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;]&#x27;</span>:</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;&#125;&#x27;</span>:</span><br><span class="line">            <span class="keyword">if</span>(match(get_Pop(op_stack),ch))</span><br><span class="line">            &#123;</span><br><span class="line">                pop(op_stack);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                flag=<span class="number">0</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:<span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">        <span class="keyword">if</span>(flag)</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;yes\n&quot;</span>);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;no\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">push_</span><span class="params">(pStack top,<span class="keyword">int</span> ch)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    pStack s = (pStack)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="built_in">stack</span>));</span><br><span class="line">    s-&gt;op = ch;</span><br><span class="line">    s-&gt;next = top-&gt;next;</span><br><span class="line">    top-&gt;next = s;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">pop</span><span class="params">(pStack top)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> ret;</span><br><span class="line">    pStack r = top-&gt;next;</span><br><span class="line">    <span class="keyword">if</span>(r==<span class="literal">NULL</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    ret = r-&gt;op;</span><br><span class="line">    top-&gt;next = r-&gt;next;</span><br><span class="line">    <span class="built_in">free</span>(r);</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">get_Pop</span><span class="params">(pStack top)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> ret;</span><br><span class="line">    pStack r = top-&gt;next;</span><br><span class="line">    <span class="keyword">if</span>(r==<span class="literal">NULL</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    ret = r-&gt;op;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">match</span><span class="params">(<span class="keyword">int</span> src,<span class="keyword">int</span> dst)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> flag=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(src==<span class="string">&#x27;&#123;&#x27;</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(dst==<span class="string">&#x27;&#125;&#x27;</span>)</span><br><span class="line">        flag=<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    <span class="keyword">if</span>(src==<span class="string">&#x27;[&#x27;</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(dst==<span class="string">&#x27;]&#x27;</span>)</span><br><span class="line">        flag=<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    <span class="keyword">if</span>(src==<span class="string">&#x27;(&#x27;</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(dst==<span class="string">&#x27;)&#x27;</span>)</span><br><span class="line">        flag=<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(flag)</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="8"><a href="#8" class="headerlink" title="8."></a>8.</h2><p><img data-src="http://cdn.sekyoro.top/imgs/094118.png" alt="image-20210416000817929"></p><h2 id="9"><a href="#9" class="headerlink" title="9."></a>9.</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">Stack_</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">int</span> data;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Stack_</span> *<span class="title">next</span>;</span></span><br><span class="line">&#125; Stack_, *pStack;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">push_</span><span class="params">(pStack, <span class="keyword">int</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">pop_</span><span class="params">(pStack)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">get_top</span><span class="params">(pStack)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">is_alpha</span><span class="params">(<span class="keyword">int</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">is_op</span><span class="params">(<span class="keyword">int</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">compare_</span><span class="params">(<span class="keyword">int</span>, <span class="keyword">int</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Bolan</span><span class="params">(pStack, <span class="keyword">int</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">is_empty</span><span class="params">(pStack)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    pStack opr = (pStack)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(Stack_));</span><br><span class="line">    <span class="keyword">int</span> ch;</span><br><span class="line">    opr-&gt;next = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">while</span> ((ch = getchar()) != <span class="string">&#x27;\n&#x27;</span> &amp;&amp; ch != EOF)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (ch == <span class="string">&#x27;(&#x27;</span>)</span><br><span class="line">            push_(opr, ch);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (is_alpha(ch))</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%c&quot;</span>, ch);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            Bolan(opr, ch);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> (!is_empty(opr))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%c&quot;</span>, opr-&gt;next-&gt;data);</span><br><span class="line">        pop_(opr);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">free</span>(opr);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">is_empty</span><span class="params">(pStack pa)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (pa-&gt;next)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">is_op</span><span class="params">(<span class="keyword">int</span> ch)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;+&#x27;</span> || ch == <span class="string">&#x27;-&#x27;</span> || ch == <span class="string">&#x27;*&#x27;</span> || ch == <span class="string">&#x27;/&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">pop_</span><span class="params">(pStack head)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    pStack pop_s = head-&gt;next;</span><br><span class="line">    head-&gt;next = pop_s-&gt;next;</span><br><span class="line">    <span class="built_in">free</span>(pop_s);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">compare_</span><span class="params">(<span class="keyword">int</span> op_1, <span class="keyword">int</span> op_2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (op_1 == <span class="string">&#x27;*&#x27;</span> || op_1 == <span class="string">&#x27;/&#x27;</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (op_2 == <span class="string">&#x27;+&#x27;</span> || op_2 == <span class="string">&#x27;-&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (op_2 == <span class="string">&#x27;(&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (op_2 == <span class="number">0</span>)<span class="comment">//无元素，为空栈</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">get_top</span><span class="params">(pStack head)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (is_empty(head))</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> head-&gt;next-&gt;data;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">push_</span><span class="params">(pStack head, <span class="keyword">int</span> ch)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    pStack r = (pStack)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(Stack_));</span><br><span class="line">    r-&gt;data = ch;</span><br><span class="line">    r-&gt;next = head-&gt;next;</span><br><span class="line">    head-&gt;next = r;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">is_alpha</span><span class="params">(<span class="keyword">int</span> ch)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ((ch &gt;= <span class="string">&#x27;a&#x27;</span> &amp;&amp; ch &lt;= <span class="string">&#x27;z&#x27;</span>) || (ch &gt;= <span class="string">&#x27;A&#x27;</span> &amp;&amp; ch &lt;= <span class="string">&#x27;Z&#x27;</span>))</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Bolan</span><span class="params">(pStack opr, <span class="keyword">int</span> ch)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> top_ch;</span><br><span class="line">    <span class="keyword">if</span> (ch == <span class="string">&#x27;)&#x27;</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">while</span> ((top_ch = get_top(opr)) != <span class="string">&#x27;(&#x27;</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%c&quot;</span>, top_ch);</span><br><span class="line">            pop_(opr);</span><br><span class="line">        &#125;</span><br><span class="line">        pop_(opr);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        top_ch = get_top(opr);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (compare_(ch, top_ch)) <span class="comment">//比较</span></span><br><span class="line">        &#123;</span><br><span class="line">            push_(opr, ch);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            pop_(opr);</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%c&quot;</span>, top_ch);</span><br><span class="line">            push_(opr, ch);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="10"><a href="#10" class="headerlink" title="10."></a>10.</h2><p><img data-src="http://cdn.sekyoro.top/imgs/094127.png" alt="image-20210416001130594"></p><p><strong>这个题系统设置有问题，不用太注意</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> maxsize 1000</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">Queue</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">int</span> Element[maxsize];</span><br><span class="line">    <span class="keyword">int</span> rear;</span><br><span class="line">    <span class="keyword">int</span> length;</span><br><span class="line">    <span class="keyword">int</span> head;</span><br><span class="line">&#125; Queue, *pQueue;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">initial</span><span class="params">(pQueue)</span></span>;</span><br><span class="line"><span class="comment">// void push(pQueue, int);</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">pop</span><span class="params">(pQueue)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">get_top</span><span class="params">(pQueue)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">(pQueue)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    pQueue <span class="built_in">queue</span> = (pQueue)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(Queue));</span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">queue</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;malloc fail&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    initial(<span class="built_in">queue</span>);</span><br><span class="line">    <span class="comment">// fflush(stdin);</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">queue</span>-&gt;rear&lt;=<span class="built_in">queue</span>-&gt;length)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">char</span> temp[<span class="number">100</span>];</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>,temp);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> pop_date;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;pop_date);</span><br><span class="line">    <span class="keyword">while</span>(get_top(<span class="built_in">queue</span>)!=pop_date)</span><br><span class="line">    &#123;</span><br><span class="line">        pop(<span class="built_in">queue</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    pop(<span class="built_in">queue</span>);</span><br><span class="line">    print(<span class="built_in">queue</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">initial</span><span class="params">(pQueue q)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> date;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;q-&gt;length);</span><br><span class="line">    q-&gt;head = q-&gt;rear = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;date);</span><br><span class="line">        q-&gt;Element[q-&gt;rear] = date;</span><br><span class="line">        (q-&gt;rear)++;</span><br><span class="line">    &#125;<span class="keyword">while</span>((q-&gt;rear&lt;q-&gt;length)&amp;&amp;getchar()!=<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">(pQueue q)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = (q-&gt;head)%q-&gt;length;i&lt;q-&gt;rear;i++)</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d%c&quot;</span>,q-&gt;Element[i],(i==q-&gt;rear<span class="number">-1</span>)?<span class="string">&#x27;\n&#x27;</span>:<span class="string">&#x27; &#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span>(q-&gt;head!=q-&gt;rear)</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>,get_top(q));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// void push(pQueue q, int x)</span></span><br><span class="line"><span class="comment">// &#123;</span></span><br><span class="line"><span class="comment">//     // if ((q-&gt;rear+1)%q-&gt;length==q-&gt;head)</span></span><br><span class="line"><span class="comment">//     // return false;</span></span><br><span class="line"><span class="comment">//     q-&gt;Element[q-&gt;rear] = x;</span></span><br><span class="line"><span class="comment">//     q-&gt;rear = (q-&gt;rear+1)%(q-&gt;length);</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">get_top</span><span class="params">(pQueue q)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> x;</span><br><span class="line">    x = q-&gt;Element[q-&gt;head];</span><br><span class="line">    <span class="keyword">return</span> x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">pop</span><span class="params">(pQueue q)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// if(q-&gt;head==q-&gt;rear)</span></span><br><span class="line">    <span class="comment">// return false;</span></span><br><span class="line">    q-&gt;Element[q-&gt;head] = <span class="number">0</span>;</span><br><span class="line">    q-&gt;head = (q-&gt;head+<span class="number">1</span>)%q-&gt;length;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img data-src="http://cdn.sekyoro.top/imgs/094132.png" alt="image-20210416001238359"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> Maxsize 10000</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">Queue</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">int</span> data[Maxsize];</span><br><span class="line">    <span class="keyword">int</span> rear;</span><br><span class="line">    <span class="keyword">int</span> head;</span><br><span class="line">&#125; Queue, *pQueue;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">initial</span><span class="params">(pQueue, <span class="keyword">int</span>)</span></span>;        <span class="comment">//初始化队列，将前k项赋值，前k-1项为0，k项为1</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">fibonacci</span><span class="params">(pQueue, <span class="keyword">int</span>, <span class="keyword">int</span>)</span></span>; <span class="comment">//叠加，求得k的值</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">(pQueue, <span class="keyword">int</span>)</span></span>;          <span class="comment">//输出</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(pQueue, <span class="keyword">int</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> max, k;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d %d&quot;</span>, &amp;max, &amp;k);</span><br><span class="line">    pQueue q = (pQueue)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(Queue));</span><br><span class="line">    initial(q, k);</span><br><span class="line">    fibonacci(q, max, k);</span><br><span class="line">    print(q, k);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">(pQueue q, <span class="keyword">int</span> t)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = q-&gt;head; i &lt;= q-&gt;rear; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d%c&quot;</span>, q-&gt;data[i], (i == q-&gt;rear) ? <span class="string">&#x27;\n&#x27;</span> : <span class="string">&#x27; &#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">initial</span><span class="params">(pQueue q, <span class="keyword">int</span> k)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= k - <span class="number">1</span>; i++)</span><br><span class="line">        q-&gt;data[i] = <span class="number">0</span>;</span><br><span class="line">    q-&gt;head = <span class="number">1</span>;</span><br><span class="line">    q-&gt;data[k] = <span class="number">1</span>;</span><br><span class="line">    q-&gt;rear = (q-&gt;head) + k - <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">fibonacci</span><span class="params">(pQueue q, <span class="keyword">int</span> max, <span class="keyword">int</span> k)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (!((q-&gt;data[q-&gt;rear] &lt;= max) &amp;&amp; (q-&gt;data[(q-&gt;rear) + <span class="number">1</span>] &gt; max)))</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        add(q, k);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(pQueue q, <span class="keyword">int</span> t)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    q-&gt;head += <span class="number">1</span>;</span><br><span class="line">    q-&gt;rear = q-&gt;head + t - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> k = q-&gt;head; k &lt;= (q-&gt;rear) + <span class="number">1</span>; k++)</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (k &lt; t)</span><br><span class="line">        &#123;</span><br><span class="line">            q-&gt;data[k] = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (k == t)</span><br><span class="line">        &#123;</span><br><span class="line">            q-&gt;data[k] = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            q-&gt;data[k] = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = k - t; i &lt; k; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                q-&gt;data[k] += q-&gt;data[i];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      
      
      <categories>
          
          <category> study </category>
          
      </categories>
      
      
        <tags>
            
            <tag> data_structure </tag>
            
            <tag> c </tag>
            
            <tag> noj </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
