<!doctypehtml><html lang=zh-CN><script defer src=/live2d-widget/autoload.js></script><meta charset=UTF-8><meta content=width=device-width,initial-scale=1,maximum-scale=2 name=viewport><meta content=#222 name=theme-color><meta content="Hexo 5.4.0" name=generator><link href=/images/blog_32px.png rel=apple-touch-icon sizes=180x180><link href=/images/blog_32px.png rel=icon sizes=32x32 type=image/png><link href=/images/blog_16px.png rel=icon sizes=16x16 type=image/png><link color=#222 href=/images/logo.svg rel=mask-icon><meta content=EPrJAp11bJwHULpQUaSNSZ8_3RcvTsPDAEGOME4pl1w name=google-site-verification><!-- Google tag (gtag.js) --><!-- 
<script async src="https://www.googletagmanager.com/gtag/js?id=G-VB21D8MKKW"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-VB21D8MKKW');
</script> --><!-- google adsense in head.swig --><script async crossorigin=anonymous src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4034523802263123></script><meta content=7226864CE87CE9DE8C008385273846FF name=msvalidate.01><meta content=code-fjFXVtiL7j name=baidu-site-verification><link href=/css/main.css rel=stylesheet><link as=style href=https://fonts.googleapis.com/css?family=Roboto%20Mono,Roboto:300,300italic,400,400italic,700,700italic|Roboto:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext onload=this.rel='stylesheet' rel=preload><link as=style href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css onload=this.rel='stylesheet' rel=preload><link href=https://fonts.googleapis.com/css?family=Noto+Serif+SC|Roboto&display=swap rel=stylesheet><link href=https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css rel=stylesheet><link href=https://cdn.jsdelivr.net/npm/pace-js@1/themes/blue/pace-theme-minimal.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/pace-js@1/pace.min.js></script><script id=hexo-configurations>var NexT = window.NexT || {};
    var CONFIG = {"hostname":"www.sekyoro.top","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","width":240,"display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":null},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":true,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"appID":"0F9LEEVW82","apiKey":"78839e9f9be09d081c5c4da81975cd19","indexName":"sekyoblog_sec","hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"manual","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};</script><link href=//cdn.bootcss.com/animate.css/3.5.0/animate.min.css rel=stylesheet><meta content=课程作业 name=description><meta content=article property=og:type><meta content=汇编原理课程学习 property=og:title><meta content=https://www.sekyoro.top/2022/03/09/%E6%B1%87%E7%BC%96%E5%8E%9F%E7%90%86%E8%AF%BE%E7%A8%8B%E5%AD%A6%E4%B9%A0/index.html property=og:url><meta content=Sekyoro的博客小屋 property=og:site_name><meta content=课程作业 property=og:description><meta content=zh_CN property=og:locale><meta content=http://cdn.sekyoro.top/imgs/093035.png property=og:image><meta content=http://cdn.sekyoro.top/imgs/image-20220113225054383.png property=og:image><meta content=http://cdn.sekyoro.top/imgs/image-20220114125236250.png property=og:image><meta content=http://cdn.sekyoro.top/imgs/image-20220113225844722.png property=og:image><meta content=http://cdn.sekyoro.top/imgs/image-20220114000424117.png property=og:image><meta content=http://cdn.sekyoro.top/imgs/image-20220114000538225.png property=og:image><meta content=http://cdn.sekyoro.top/imgs/image-20220113232659992.png property=og:image><meta content=http://cdn.sekyoro.top/imgs/065315.png property=og:image><meta content=http://cdn.sekyoro.top/imgs/065318.png property=og:image><meta content=http://cdn.sekyoro.top/imgs/093121.png property=og:image><meta content=http://cdn.sekyoro.top/imgs/093122.png property=og:image><meta content=http://cdn.sekyoro.top/imgs/065327.png property=og:image><meta content=http://cdn.sekyoro.top/imgs/093124.png property=og:image><meta content=http://cdn.sekyoro.top/imgs/093127.png property=og:image><meta content=http://cdn.sekyoro.top/imgs/093130.png property=og:image><meta content=http://cdn.sekyoro.top/imgs/093132.png property=og:image><meta content=http://cdn.sekyoro.top/imgs/093136.png property=og:image><meta content=http://cdn.sekyoro.top/imgs/093137.png property=og:image><meta content=http://cdn.sekyoro.top/imgs/065335.png property=og:image><meta content=http://cdn.sekyoro.top/imgs/093140.png property=og:image><meta content=http://cdn.sekyoro.top/imgs/093142.png property=og:image><meta content=http://cdn.sekyoro.top/imgs/093145.png property=og:image><meta content=http://cdn.sekyoro.top/imgs/093151.png property=og:image><meta content=http://cdn.sekyoro.top/imgs/093154.png property=og:image><meta content=http://cdn.sekyoro.top/imgs/093152.png property=og:image><meta content=http://cdn.sekyoro.top/imgs/093158.png property=og:image><meta content=http://cdn.sekyoro.top/imgs/093200.png property=og:image><meta content=http://cdn.sekyoro.top/imgs/093203.png property=og:image><meta content=http://cdn.sekyoro.top/imgs/093205.png property=og:image><meta content=http://cdn.sekyoro.top/imgs/093207.png property=og:image><meta content=http://cdn.sekyoro.top/imgs/093215.png property=og:image><meta content=http://cdn.sekyoro.top/imgs/093218.png property=og:image><meta content=http://cdn.sekyoro.top/imgs/065337.png property=og:image><meta content=http://cdn.sekyoro.top/imgs/093220.png property=og:image><meta content=http://cdn.sekyoro.top/imgs/093222.png property=og:image><meta content=http://cdn.sekyoro.top/imgs/093224.png property=og:image><meta content=http://cdn.sekyoro.top/imgs/093227.png property=og:image><meta content=http://cdn.sekyoro.top/imgs/093231.jpg property=og:image><meta content=http://cdn.sekyoro.top/imgs/093233.png property=og:image><meta content=http://cdn.sekyoro.top/imgs/093237.png property=og:image><meta content=http://cdn.sekyoro.top/imgs/093242.png property=og:image><meta content=http://cdn.sekyoro.top/imgs/093245.png property=og:image><meta content=http://cdn.sekyoro.top/imgs/image-20220402210438375.png property=og:image><meta content=http://cdn.sekyoro.top/imgs/image-20220402210354837.png property=og:image><meta content=http://cdn.sekyoro.top/imgs/image-20220402210533785.png property=og:image><meta content=http://cdn.sekyoro.top/imgs/image-20220402210919739.png property=og:image><meta content=http://cdn.sekyoro.top/imgs/image-20220402210950053.png property=og:image><meta content=http://cdn.sekyoro.top/imgs/image-20220402211606553.png property=og:image><meta content=http://cdn.sekyoro.top/imgs/093248.jpg property=og:image><meta content=http://cdn.sekyoro.top/imgs/093249.jpg property=og:image><meta content=http://cdn.sekyoro.top/imgs/093251.jpg property=og:image><meta content=http://cdn.sekyoro.top/imgs/065338.png property=og:image><meta content=http://cdn.sekyoro.top/imgs/065339.png property=og:image><meta content=http://cdn.sekyoro.top/imgs/093252.png property=og:image><meta content=http://cdn.sekyoro.top/imgs/065345.png property=og:image><meta content=http://cdn.sekyoro.top/imgs/065347.png property=og:image><meta content=http://cdn.sekyoro.top/imgs/093254.png property=og:image><meta content=http://cdn.sekyoro.top/imgs/093257.png property=og:image><meta content=http://cdn.sekyoro.top/imgs/093259.png property=og:image><meta content=http://cdn.sekyoro.top/imgs/image-20220402215053078.png property=og:image><meta content=http://cdn.sekyoro.top/imgs/image-20220402215528693.png property=og:image><meta content=http://cdn.sekyoro.top/imgs/image-20220402220439060.png property=og:image><meta content=http://cdn.sekyoro.top/imgs/image-20220402222535565.png property=og:image><meta content=http://cdn.sekyoro.top/imgs/image-20220402223339213.png property=og:image><meta content=http://cdn.sekyoro.top/imgs/image-20220402223551048.png property=og:image><meta content=http://cdn.sekyoro.top/imgs/image-20220402223849933.png property=og:image><meta content=http://cdn.sekyoro.top/imgs/image-20220402224120628.png property=og:image><meta content=http://cdn.sekyoro.top/imgs/093301.png property=og:image><meta content=http://cdn.sekyoro.top/imgs/093303.png property=og:image><meta content=http://cdn.sekyoro.top/imgs/093305.png property=og:image><meta content=http://cdn.sekyoro.top/imgs/093307.png property=og:image><meta content=http://cdn.sekyoro.top/imgs/093309.png property=og:image><meta content=http://cdn.sekyoro.top/imgs/093311.png property=og:image><meta content=http://cdn.sekyoro.top/imgs/093312.png property=og:image><meta content=http://cdn.sekyoro.top/imgs/093315.png property=og:image><meta content=http://cdn.sekyoro.top/imgs/065348.png property=og:image><meta content=http://cdn.sekyoro.top/imgs/065351.png property=og:image><meta content=http://cdn.sekyoro.top/imgs/093317.png property=og:image><meta content=http://cdn.sekyoro.top/imgs/065353.png property=og:image><meta content=http://cdn.sekyoro.top/imgs/093318.png property=og:image><meta content=http://cdn.sekyoro.top/imgs/093319.png property=og:image><meta content=http://cdn.sekyoro.top/imgs/065355.png property=og:image><meta content=http://cdn.sekyoro.top/imgs/093321.png property=og:image><meta content=http://cdn.sekyoro.top/imgs/065357.png property=og:image><meta content=http://cdn.sekyoro.top/imgs/065402.png property=og:image><meta content=http://cdn.sekyoro.top/imgs/065404.png property=og:image><meta content=http://cdn.sekyoro.top/imgs/093322.png property=og:image><meta content=http://cdn.sekyoro.top/imgs/093324.png property=og:image><meta content=http://cdn.sekyoro.top/imgs/093327.png property=og:image><meta content=2022-03-09T14:10:18.000Z property=article:published_time><meta content=2022-04-02T14:44:52.000Z property=article:modified_time><meta content=Sekyoro property=article:author><meta content=course property=article:tag><meta content=compile property=article:tag><meta content=summary name=twitter:card><meta content=http://cdn.sekyoro.top/imgs/093035.png name=twitter:image><link href=https://www.sekyoro.top/2022/03/09/%E6%B1%87%E7%BC%96%E5%8E%9F%E7%90%86%E8%AF%BE%E7%A8%8B%E5%AD%A6%E4%B9%A0/ rel=canonical><script id=page-configurations>// https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };</script><title>汇编原理课程学习 | Sekyoro的博客小屋</title><noscript><style>.use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }</style></noscript><link href=/atom.xml rel=alternate title=Sekyoro的博客小屋 type=application/atom+xml><body itemscope itemtype=http://schema.org/WebPage><canvas style="position: fixed;left: 0;top: 0;z-index: 1; pointer-events: none;" class=fireworks></canvas><script defer src=https://cdn.bootcss.com/animejs/2.2.0/anime.min.js></script><script defer src=/js/src/fireworks.js></script><div class="container use-motion"><div class=headband></div><header class=header itemscope itemtype=http://schema.org/WPHeader><div class=header-inner><div class=site-brand-container><div class=site-nav-toggle><div aria-label=切换导航栏 class=toggle><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div></div><div class=site-meta><a class=brand href=/ rel=start> <span class=logo-line-before><i></i></span> <h1 class=site-title>Sekyoro的博客小屋</h1> <span class=logo-line-after><i></i></span> </a></div><div class=site-nav-right><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class=site-nav><ul class="main-menu menu" id=menu><li class="menu-item menu-item-home"><a href=/ rel=section><i class="fa fa-home fa-fw"></i>首页</a><li class="menu-item menu-item-about"><a href=/about/ rel=section><i class="fa fa-user fa-fw"></i>关于</a><li class="menu-item menu-item-tags"><a href=/tags/ rel=section><i class="fa fa-tags fa-fw"></i>标签</a><li class="menu-item menu-item-categories"><a href=/categories/ rel=section><i class="fa fa-th fa-fw"></i>分类</a><li class="menu-item menu-item-archives"><a href=/archives/ rel=section><i class="fa fa-archive fa-fw"></i>归档</a><li class="menu-item menu-item-bangumis"><a href=/bangumis/ rel=section><i class="fa fa-film fa-fw"></i>追番</a><li class="menu-item menu-item-resume"><a href=/resume/ rel=section><i class="fa fa-file-pdf fa-fw"></i>简历</a><li class="menu-item menu-item-materials"><a href=/materials/ rel=section><i class="fa fa-book fa-fw"></i>学习资料</a><li class="menu-item menu-item-sitemap"><a href=/sitemap.xml rel=section><i class="fa fa-sitemap fa-fw"></i>站点地图</a><li class="menu-item menu-item-search"><a class=popup-trigger role=button><i class="fa fa-search fa-fw"></i>搜索 </a></ul></nav><div class=search-pop-overlay><div class="popup search-popup"><div class=search-header><span class=search-icon> <i class="fa fa-search"></i> </span><div class=search-input-container></div><span class=popup-btn-close> <i class="fa fa-times-circle"></i> </span></div><div class=algolia-results><div id=algolia-stats></div><div id=algolia-hits></div><div class=algolia-pagination id=algolia-pagination></div></div></div></div></div></header><a class="book-mark-link book-mark-link-fixed" role=button></a><main class=main><div class=main-inner><div class=content-wrap><div class="content post posts-expand"><article class=post-block itemscope itemtype=http://schema.org/Article lang=zh-CN><link href=https://www.sekyoro.top/2022/03/09/%E6%B1%87%E7%BC%96%E5%8E%9F%E7%90%86%E8%AF%BE%E7%A8%8B%E5%AD%A6%E4%B9%A0/ itemprop=mainEntityOfPage><span hidden itemprop=author itemscope itemtype=http://schema.org/Person> <meta content=https://i.loli.net/2021/05/17/YqoavnXdGTpPO9R.jpg itemprop=image> <meta content=Sekyoro itemprop=name> <meta content=什么也无法舍弃的人，什么也做不了. itemprop=description> </span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization> <meta content=Sekyoro的博客小屋 itemprop=name> </span><header class=post-header><h1 itemprop="name headline" class=post-title>汇编原理课程学习</h1><div class=post-meta><span class=post-meta-item> <span class=post-meta-item-icon> <i class="far fa-calendar"></i> </span> <span class=post-meta-item-text>发表于</span> <time itemprop="dateCreated datePublished" title="创建时间：2022-03-09 22:10:18" datetime=2022-03-09T22:10:18+08:00>2022-03-09</time> </span><span class=post-meta-item> <span class=post-meta-item-icon> <i class="far fa-calendar-check"></i> </span> <span class=post-meta-item-text>更新于</span> <time title="修改时间：2022-04-02 22:44:52" datetime=2022-04-02T22:44:52+08:00 itemprop=dateModified>2022-04-02</time> </span><span class=post-meta-item> <span class=post-meta-item-icon> <i class="far fa-folder"></i> </span> <span class=post-meta-item-text>分类于</span> <span itemprop=about itemscope itemtype=http://schema.org/Thing> <a href=/categories/course/ itemprop=url rel=index><span itemprop=name>course</span></a> </span> </span><span style="display: none;" class=post-meta-item id=busuanzi_container_page_pv title=阅读次数> <span class=post-meta-item-icon> <i class="fa fa-eye"></i> </span> <span class=post-meta-item-text>阅读次数：</span> <span id=busuanzi_value_page_pv></span> </span><br><span class=post-meta-item title=本文字数> <span class=post-meta-item-icon> <i class="far fa-file-word"></i> </span> <span class=post-meta-item-text>本文字数：</span> <span>15k</span> </span><span class=post-meta-item title=阅读时长> <span class=post-meta-item-icon> <i class="far fa-clock"></i> </span> <span class=post-meta-item-text>阅读时长 ≈</span> <span>14 分钟</span> </span></div></header><div class=post-body itemprop=articleBody><div class=post-tags><a href=/tags/course/ rel=tag># course</a><a href=/tags/compile/ rel=tag># compile</a></div><p>课程作业</p><span id=more></span><h2 id=1><a class=headerlink href=#1 title=1.></a>1.</h2><p>请自己编写的一个简单C语言例子（至少包括3个C文件、至少一个头文件；含有初始化全局变量、未初始化全局变量、函数内静态变量与局部变量、函数调用、if语句、while语句等），尽量不要包含第三方的头文件，按照预处理->编译->汇编->链接的操作过程，截图分析做成文档，分析源程序与可执行程序Section的对应关系，特别是数据与指令，通过分析阐述编译器的功能。着重分析LLVM的IR与源语句的对应关系。<h3 id=环境><a class=headerlink href=#环境 title=环境></a>环境</h3><figure class="highlight tex"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line>Ubuntu 20.04.3   gcc 9.3.0</span><br></pre></table></figure><p><img alt=环境信息 data-src=http://cdn.sekyoro.top/imgs/093035.png><p><img alt=gcc信息 data-src=http://cdn.sekyoro.top/imgs/image-20220113225054383.png style=zoom:67%;><h3 id=使用GCC><a class=headerlink href=#使用GCC title=使用GCC></a>使用GCC</h3><p>gcc具体使用参考教程.这里大概写一下<figure class="highlight bash"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br></pre><td class=code><pre><span class=line>gcc -E <span class=comment>#预处理</span></span><br><span class=line>gcc -S <span class=comment>#进行编译</span></span><br><span class=line>gcc -c<span class=comment>#进行汇编,获得目标文件</span></span><br><span class=line>gcc -o <span class=comment># -o本是指定输入文件名,不加参数直接进行链接</span></span><br></pre></table></figure><p>注意,-Wall选项可以输出尽可能多的提示信息,建议每次都加上<p><strong>源文件 </strong><p><img alt=main源文件 data-src=http://cdn.sekyoro.top/imgs/image-20220114125236250.png><p>可以看到变量类型涉及到 全局变量,全局静态变量,局部变量和局部静态变量.<p>同时由引入的函数头文件,while和if结构. 先进行单个文件由.c->.i->.S->.o->可执行文件的过程.从中分析每个过程的变化以及一些信息.<h4 id=预处理><a class=headerlink href=#预处理 title=预处理></a>预处理</h4><figure class="highlight bash"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line>gcc -E -o main.i main.c -Wall</span><br></pre></table></figure><p>可以看到main.c引入了一些头文件,主要是stdio.h,我们可以查看.i文件大小<p><img alt=预处理文件大小变化 data-src=http://cdn.sekyoro.top/imgs/image-20220113225844722.png style=zoom:67%;><p>可以看到由原本467B变为17KB,可见文件中引入了许多信息,都是由宏处理的.<p><img alt=预处理后的文件 data-src=http://cdn.sekyoro.top/imgs/image-20220114000424117.png style=zoom:67%;><blockquote><p>所谓预处理操作，主要是处理那些源文件和头文件中以 # 开头的命令（比如 #include、#define、#ifdef 等），并删除程序中所有的注释 // 和 /<em> … </em>/</blockquote><p>这一步没有太多要说的<h4 id=编译><a class=headerlink href=#编译 title=编译></a>编译</h4><figure class="highlight bash"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line>gcc -S -o main.S  main.i -Wall</span><br></pre></table></figure><p><img alt=编译 data-src=http://cdn.sekyoro.top/imgs/image-20220114000538225.png style=zoom:67%;><p>可以看到报了几个warning,这是因为局部变量如果没有初始化,它们是不会在.bss段的,而是在栈中<sup><a href=#fn_1 id=reffn_1>1</a></sup>,代码段中(局部变量是函数的变量,而函数在代码段中<sup><a href=#fn_2 id=reffn_2>2</a></sup>),也就是程序运行过程随着调用函数开栈,随着栈帧的创建而创建,随着函数结束生命周期也就结束了.(在当前gcc版本下),同时如果定义了但没有使用也会报warning.如果加了-O优化这种代码很可能被优化处理.<p>值得注意的是,代码段中也会存储一些const值.<blockquote><p><code>C语言</code>中定义的字符串常量<p><code>const型</code>常量：<code>C语言</code>中<code>const</code>关键字用来定义常量</blockquote><p>我们可以根据编译得到的汇编代码更加详细地查看．<p><img alt=汇编代码 data-src=http://cdn.sekyoro.top/imgs/image-20220113232659992.png style=zoom:67%;><p>由于main.c文件写得有点复杂,这里挑重点说一下.<p>.file标识文件名 .text就是一个熟悉的重要的section,就是代码段.存着函数以及一些常量(比如c语言的字符串和const常量)<p>我发现这里有些符号没遇到过,网上搜索一番<sup><a href=#fn_3 id=reffn_3>3</a></sup>,而且貌似全局未初始化变量并没有直接放在.bss段的.<p>.comm表示的就是未初始化的全局变量.<p>可以得知g1是全局变量,因为是.comm(这与.lcomm都在链接后分配在.bss),<p>g2为20为全局变量(.global),.long 20.g3值为5,但可以看出其没有了.global,推测这是因为加了static导致,同时因为其进行了初始化,所以不会加在.bss段,即这里不会在.comm。<p>(.comm是未初始化全局变量,.lcomm是静态全局变量)可以这么简单理解<p>可以看出g4就是全局静态变量(.local)且未进行初始化.<p><strong>总结一下</strong><blockquote><p>g2和g3变量在*.S文件中差别是g2有 .global g2表示全局(全文件的作用域) g3没有.<p>表示全局变量加上static导致的作用域减小.即g2可以在其他文件中使用extern使用.<p>g2和g3都有type @object,都分配在.data段.表示经过了初始化,如果加了static作用域受限,没有.global.<p>g1和g4差别是g1是.comm,g4是.local .comm即.lcomm表示g1是未初始化的全局变量,链接后在.bss段,而g4是静态的未初始化全局变量,同理其作用域也是所在的文件,编译后也分配在.bss段.</blockquote><p><img alt=静态局部变量 data-src=http://cdn.sekyoro.top/imgs/065315.png><p>而main函数中的变量,比如local1和local2是在栈中,在汇编代码中没有相关符号.<p>而两个静态局部变量 s_local3应该分配在.bss段,s_local4分配在.data段,因为其初始化过了.<blockquote><p>全局未初始化变量没有被放到任何段，而是作为未定义的COMMON符号。这个和不同语言、编译器实现有关，有的编译器放到.bss 段，有的仅仅是预留一个COMMON符号，在链接的时候再在.bss段分配预留空间。编译单元内部可见的静态变量，比如在上述中加上static的 static int global_static_var则确实被放到了.bss，是因为这个仅仅是编译单元内部可见<p>对于全局变量来说，如果初始化了不为0的值，那么该全局变量则被保存在data段，如果初始化的值为0，那么将其保存在bss段，如果没有初始化，则将其保存在common段，等到链接时再将其放入到BSS段。关于第三点不同编译器行为会不同，有的编译器会把没有初始化的全局变量直接放到BSS段</blockquote><p>.LC0等这些存储着字符串,这是固定值.还有一些汇编符号<sup><a href=#fn_4 id=reffn_4>4</a></sup>.值得注意的是,尽管这个汇编代码中没有.bss,但是.data中包含了.bss,.comm或.lcomm表示这个变量分配在.bss段<p><img alt=bss段与data段描述 data-src=http://cdn.sekyoro.top/imgs/065318.png><p>从这个汇编代码得到的信息不太够.<p><img alt=局部变量 data-src=http://cdn.sekyoro.top/imgs/093121.png><p>可以看到这里有movl $40 -8(%rbp)这其实就是int local1=40表示局部变量初始化.在这之前有<figure class="highlight plaintext"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br></pre><td class=code><pre><span class=line>pushq %rbp</span><br><span class=line>movq %rsp %rbp</span><br><span class=line>subq $16 %rbp</span><br></pre></table></figure><p>这其实就是栈帧的开始,表明局部变量(不是静态)分配在栈中(.data),而静态变量在编译时就有了.<h4 id=汇编><a class=headerlink href=#汇编 title=汇编></a>汇编</h4><figure class="highlight bash"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line>gcc -c -o main.o main.c -Wall -g</span><br></pre></table></figure><p><img alt=进行汇编 data-src=http://cdn.sekyoro.top/imgs/093122.png><p>得到目标文件<img alt=查看信息 data-src=http://cdn.sekyoro.top/imgs/065327.png><p>注意格式relocatable,表示没有进行重定位.直接运行是有问题的,需要进行链接.<h5 id=objdump><a class=headerlink href=#objdump title=objdump></a>objdump</h5><p>使用objdump对于目标文件以及可执行文件进行反编译<sup><a href=#fn_8 id=reffn_8>8</a></sup>.<figure class="highlight bash"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line>objdump -f  <span class=comment>#file headers</span></span><br></pre></table></figure><p><img alt=文件头 data-src=http://cdn.sekyoro.top/imgs/093124.png><p>可以知道main.o目标文件是需要重定位且开始地址还未定.<p>main可执行文件程序开始地址已经定了.<figure class="highlight bash"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line>objdump -x  <span class=comment>#查看所有的头信息(文件头,section头,程序头(*.o文件没有程序头),符号表,重定位信息)</span></span><br></pre></table></figure><p><strong>对于main.o文件</strong><p>section头<p><img alt=节点头信息 data-src=http://cdn.sekyoro.top/imgs/093127.png><p>重点关注.text .data .bss .rodata.由于没有重定位,逻辑地址都是0<p>.text代码段,只读 .data数据段初始化全局变量(不管是否是static,如果加了static,则作用域减小). .bss未初始化段,包含未初始化的全局变量或者静态变量.<p>符号表<p><img alt=符号表信息 data-src=http://cdn.sekyoro.top/imgs/093130.png><p>通过符号表可以更方便地查看某个量分配在哪个section.<p>由于这是main.o文件,没有进行链接,可以观察到后面几个函数都是und(undefined).<p>g3在.data段,g4在.bss段.s_local4在.data段,s_local3在.bss段<p>后面还有重定位记录,但是由于是main.o这些地址不是最终地址.<figure class="highlight bash"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br></pre><td class=code><pre><span class=line>objdump -s   <span class=comment>#查看所有内容 二进制</span></span><br><span class=line>objdump -d   <span class=comment>#反汇编 .text</span></span><br><span class=line>objdump -D   <span class=comment>#反汇编所有</span></span><br></pre></table></figure><p>查看 .data段<p><img alt=.data段内容 data-src=http://cdn.sekyoro.top/imgs/093132.png><p>可以看见.data都是初始化了的静态变量或全局变量.<p>局部变量加了static初始化后分配在.data<p>查看.bss<p><img alt=.bss段信息 data-src=http://cdn.sekyoro.top/imgs/093136.png><p>.text段内容是main函数中的内容,局部变量在这.<p><img alt=.text段内容 data-src=http://cdn.sekyoro.top/imgs/093137.png><p>将main.o反汇编后与main.S比较,可以看出main.S中值表示是十进制的,而反汇编后是16进制.<p>call指令跳转,在*.S中,直接指定跳转函数名,反汇编是指令相对地址<p>同时,如果使用.bss或.data的内容,会使用%RIP(指令地址)+偏移获得值.<p>在*.S文件中同样的使用符号表示偏移,即相对地址.<p>具体可以看这个例子<p><img alt=变量 data-src=http://cdn.sekyoro.top/imgs/065335.png><p>可以看到,当把g1,g2全局变量(分配在.data或.bss段)进行运算时,利用%rip作为基址,变量名为偏移.同时可以看出 -4(%rbp)是d,-8(%rpb)是c,-12(%rbp)是a,-16(%rbp)是b.<p>gcc -c得到目标文件再反汇编可以看到<p><img alt=image-20220114155704049 data-src=http://cdn.sekyoro.top/imgs/093140.png><p>可以看到这里地址是0x0(%rip),为什么是这样呢?推测这是因为目标文件没有进行重定位,所以这里的地址都是0,需要链接后才是真正的地址.<p>同时发现符号表中g1并没有在.bss段<img alt=查看目标文件信息 data-src=http://cdn.sekyoro.top/imgs/093142.png><p>同时.bss段的大小也是0<img alt=image-20220114160713548 data-src=http://cdn.sekyoro.top/imgs/093145.png><p>但是g1作为未初始化的全局变量,分配在.bss段,按理说.bss段大小不应该为0.这表明需要在链接后才能查看bss段大小(若有不对之处还望指出).<p>接下来分析这个程序的可执行文件的反汇编结果.<img alt=可执行文件反汇编 data-src=http://cdn.sekyoro.top/imgs/093151.png><p>值得注意的是,链接后得到的文件.text段内容增加了一些动态库的信息.重定位文件*.o.text段开头简简单单的就是一个main函数.现在开头有一些初始化函数.<p>找到main<img alt=可执行文件的反汇编 data-src=http://cdn.sekyoro.top/imgs/093154.png><p>可以明显看出g1,g2这种分配在.data或是.bss段的值由%rip作为基址(需要注意的是当我们执行一条指令时%rip的值已经是下一条指令的地址了)取引用.<p>0x113e+0x2eda = 0x4018<p><img alt=.bss段 data-src=http://cdn.sekyoro.top/imgs/093152.png><p>根据得到的地址找到g1,发现这个地址下啥都没有,表明.bss段只记录地址.而值在每次运行时由os清零<sup><a href=#fn_5 id=reffn_5>5</a></sup>.<p>114c+2ec4 = 4010<p><img alt=初始化全局变量 data-src=http://cdn.sekyoro.top/imgs/093158.png><p>可以在.data段下看到这个地址即对应的值 g2值为0x14.比较有意思的是,因为g2是4个字节.<p>所以表示为1400,然后因为是小段存放,所以低字节上的14先放,所以成了14 00,objdump就将这个14 00编码成了汇编代码,但是后面的adc $0x0,%al并不是正确要表达的意思.<p>call调用函数类似,在汇编代码中,call的调用是按照函数名称的,不是按照地址的.<p>在目标文件中(可重定位文件),call的相对地址是%RIP的值,即下一条指令的地址,显然这是有问题的.不符合实际情况.<p>在执行文件中偏移地址+%RIP,下一条指令地址加上偏移,这里不细说了.可以在.data中<p>注意在可重定位文件中,由于没有链接,用的函数是UND,且未初始化的全局变量是COM.<p>查看调用函数时跳转地址.<p><img alt=函数跳转地址 data-src=http://cdn.sekyoro.top/imgs/093200.png><p>在符号表中查找,<p><img alt=calc函数地址 data-src=http://cdn.sekyoro.top/imgs/093203.png><p>可以看到函数地址 0x13e9<p>也可以进行反编译,查看这个函数符号的代码.<p><img alt=函数地址 data-src=http://cdn.sekyoro.top/imgs/093205.png><p>到这里基本的变量和符号(section和函数符号)就分析完了.<p>下面分析一下if和while得到的汇编代码.<p><strong>if代码</strong><p><img alt=if汇编代码 data-src=http://cdn.sekyoro.top/imgs/093207.png><p>可以看到40与10比较,<blockquote><p>cmpl指令将两个操作数相减，但计算结果并不保存，只是根据计算结果改变eflags寄存器中的标志位。如果两个操作数相等，则计算结果为0，eflags中的ZF位置1.</blockquote><p>通过标志跳转.L2,再次体现了汇编代码通过符号跳转这个概念.<p><img alt=while结构 data-src=http://cdn.sekyoro.top/imgs/093215.png><p>可以看到进入.L4后,与0比较,如果大于就跳转到.L5,.L5就是while中的语句,值减去10,再进入.L4进行判断.<p>分析重定位文件.<p><img alt=重定位文件反汇编 data-src=http://cdn.sekyoro.top/imgs/093218.png><p>汇编代码中通过jle .L2符号跳转,而重定位文件中,通过函数内偏移,0x2c是跳转的对应的地址,因为是main.o目的文件,没有经过链接,没有重定位,所以地址都是相对的.链接后地址会变化.<p><img alt=while结构汇编 data-src=http://cdn.sekyoro.top/imgs/065337.png><p>可以看到在while语句中,结束时会再次判断,根据结果再选择跳转.跳转地址是main内相对地址<p>对于可执行程序,反汇编得到.text段.<p><img alt=可执行程序反汇编 data-src=http://cdn.sekyoro.top/imgs/093220.png><p>可以看到相对地址是没有变的,这表明在一个函数内的if,while等跳转遵循相对跳转,且相对地址没有变化,基址是函数地址.<p>如果是调用函数或者使用全局变量就是利用%RIP作为基址,在.data,.bss,.text段中找到数据.<p><img alt=可执行文件符号表 data-src=http://cdn.sekyoro.top/imgs/093222.png><p>可以看见这些函数在.text段,可以得到它们的地址和大小.<p>分析ELF文件既可以用objdump也可以用readelf,不过这两个命令有一些差别.<p>使用<figure class="highlight bash"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br></pre><td class=code><pre><span class=line>man readelf</span><br><span class=line>man objdump</span><br></pre></table></figure><p>可以详细查看两者的命令参数.<figure class="highlight bash"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line>readelf -S  <span class=comment>#也可以查看section header</span></span><br></pre></table></figure><p><img alt=readelf查看节点头文件 data-src=http://cdn.sekyoro.top/imgs/093224.png><p>同时readelf -h可以查看文件头,从中可以知道section header和program header.<p><img alt="readelf  -h" data-src=http://cdn.sekyoro.top/imgs/093227.png><p>可以看出main.o是没有程序头的.<p><img alt=ELF文件 data-src=http://cdn.sekyoro.top/imgs/093231.jpg><p>上图是ELF文件视图<p>下面对可执行文件main分析<p><img alt=main文件头 data-src=http://cdn.sekyoro.top/imgs/093233.png><p>可以看到有起始地址,而且是dynamic链接.<p>由于文件链接了很多其他文件,内容较多.<figure class="highlight bash"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line>objdump -x main <span class=comment>#查看所有头信息</span></span><br></pre></table></figure><p>可以看到多个了program header<p><img alt=可执行文件的程序头 data-src=http://cdn.sekyoro.top/imgs/093237.png><p>其中有段的地址.<p>此外由于链接了一些动态库,出现了dynamic section,不过这相对来说不重要.<p>关注Sections<p><img alt=可执行文件的section表头 data-src=http://cdn.sekyoro.top/imgs/093242.png><p>可以看到已经有了地址和大小<p>另外也有符号表的信息<p><img alt=可执行文件符号表 data-src=http://cdn.sekyoro.top/imgs/093245.png><p>注意到重定位信息已被删去<sup><a href=#fn_9 id=reffn_9>9</a></sup><h4 id=函数的调用和返回><a class=headerlink href=#函数的调用和返回 title=函数的调用和返回></a>函数的调用和返回</h4><p>这方面的内容我在做cmu的炸弹实验已经了解过了(自我认为).可以查看网站上的之前文章.<p>现在在windows上直接使用MinGW.<p>源文件很简单<p><img alt=源文件 data-src=http://cdn.sekyoro.top/imgs/image-20220402210438375.png><p>scanf函数调用了八个参数,一个字符串以及7个数.<p><img alt=反汇编main data-src=http://cdn.sekyoro.top/imgs/image-20220402210354837.png style=zoom:67%;><p>在.rodata中的就是字符串,利用%rcx传参,n1在%eax上.<p>有意思的是在Linux的gcc上并不是这样<p><img alt=linux下 data-src=http://cdn.sekyoro.top/imgs/image-20220402210533785.png style=zoom:67%;><p>鉴于这并不直观,看一下另一个源文件。<p><img alt=另一个源文件 data-src=http://cdn.sekyoro.top/imgs/image-20220402210919739.png style=zoom:67%;><p>反编译得到结果<p><img alt=反汇编结果 data-src=http://cdn.sekyoro.top/imgs/image-20220402210950053.png style=zoom:67%;><p>我们传参是1,2..8. 其首先从最后一个参数开始,有六个寄存器用于传参(64位下),多余的传入栈中.<p>在这里push两个值,剩余的六个值用寄存器传参.即以$rdi,%rsi,%rdx,%rcx寄存器的顺序<p>在这里,值6直接传到%r9d,注意%r9d就是低32位的%r9.<p>同理,其余值也依次传到寄存器中.<p><img alt=被调用函数 data-src=http://cdn.sekyoro.top/imgs/image-20220402211606553.png style=zoom:67%;><p>可以看到函数中先开栈,然后依次将1,2..的值从寄存器中使用.<p><a href=https://www.jianshu.com/p/57128e477efb rel=noopener target=_blank>寄存器</a>这个网站简洁分析了各个寄存器.<blockquote><p><strong>结论</strong>：当参数个数小于等于6个时，使用寄存器<strong>rdi,rsi,rdx,rcx,r8,r9，从第7个参数开始通过栈传递，顺序为从右往左入栈。</strong></blockquote><h3 id=LLVM><a class=headerlink href=#LLVM title=LLVM></a>LLVM</h3><p>传统的编译器是前端,优化(可选),后端.在某些书中也称为analysis和synthetic.<p><img alt=传统编译器架构 data-src=http://cdn.sekyoro.top/imgs/093248.jpg><p>LLVM本身并不是一个编译器,它是一种架构.<p><img alt=LLVM架构 data-src=http://cdn.sekyoro.top/imgs/093249.jpg><p>编译器根据前端生成的AST(抽象语法树)得到一种中间语言,对IR进行优化后由后端生成对应的机器代码.<blockquote><p>IR可以说是集中体现了这款编译器的特征—-他的算法，优化方式，汇编流程等等，想要完全掌握某种编译器的工作和运行原理，分析和学习这款编译器的中间语言无疑是重要手段，另外，由于中间语言相当于一款编译器前端和后端的“桥梁”<p>对于现代编译器来说，编译器前端和后端分别指分析输入源语言和生成目标平台汇编代码的两编译阶段，大部分现代编译器在前端和后端之间会有个中间表示层。有了一个设计良好的中间表示，有m种前端编程语言（C\C++、Fortran、Ada、Java等）和n种后端平台（x86、MIPS、Sparc、ARM等）的编译器设计，这样就减少了为了设计m中语言和n个平台从而设计m*n个编译器设计</blockquote><p>同时LLVM可以提供优化算法,在优化时可以将其提供的算法链接进来.<p><a href=https://www.cnblogs.com/zuopeng/p/4141467.html rel=noopener target=_blank>LLVM和GCC的区别</a><p>GCC的中间语言RTL形式.<p><a href=https://blog.csdn.net/sonicling/article/details/7915301 rel=noopener target=_blank>GCC源码分析</a><blockquote><p>gimple和RTL是gcc用来表示指令的两种形式。因此每个基本块都包含有两组指令序列，一组是gimple指令，一组是RTL指令。每个函数将首先被gimple化，此时基本块里只包含gimple指令，之后由gimple生成RT</blockquote><p><a href=https://blog.csdn.net/u012150792/article/details/50651743 rel=noopener target=_blank>GENERIC，GIMPLE和RTL</a><p><a href=https://blog.csdn.net/u012491514/article/details/25000519 rel=noopener target=_blank>gcc编译器——中间表示</a><blockquote><p>中间表示RTL：RTL叫做“寄存器转移语言”（Register Transfer Language），它是以一种虚拟寄存器（pseudo register）的方式来叙述计算机行为的语言。RTL 是一种接近机器指令的语言，既有指令序列组成的内部形式，又有机器描述和调试信息组成的文本形式。</blockquote><p><img alt=LLVM data-src=http://cdn.sekyoro.top/imgs/093251.jpg><h4 id=对于GCC><a class=headerlink href=#对于GCC title=对于GCC></a>对于GCC</h4><p>gcc的设计并不是教科书般的,它的前端和后端也并没有那么明确.<p>使用命令<figure class="highlight sh"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line>gcc -S fdump-tree-all main.c</span><br></pre></table></figure><p>得到一大堆文件.<p><img alt=结果 data-src=http://cdn.sekyoro.top/imgs/065338.png><p>这些都是中间文件,我们看看cfg和ssa.<p>我的源文件<figure class="highlight c"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br></pre><td class=code><pre><span class=line><span class=comment>//main.c</span></span><br><span class=line><span class=meta>#<span class=meta-keyword>include</span> <span class=meta-string>"add.h"</span></span></span><br><span class=line><span class=keyword>int</span> g1 = <span class=number>10</span>;</span><br><span class=line><span class=keyword>int</span> g2;</span><br><span class=line><span class=function><span class=keyword>int</span> <span class=title>main</span><span class=params>()</span></span></span><br><span class=line><span class=function></span>{</span><br><span class=line>        <span class=keyword>int</span> a = <span class=number>10</span>;</span><br><span class=line>        <span class=keyword>int</span> c;</span><br><span class=line>        c =  add(a,g1);</span><br><span class=line>        c = ADD(c,g2);</span><br><span class=line>        <span class=keyword>return</span> c;</span><br><span class=line>}</span><br></pre></table></figure><h5 id=CFG文件><a class=headerlink href=#CFG文件 title=CFG文件></a>CFG文件</h5><p>cfg是控制流图.<blockquote><p>每个函数翻译为GENERIC的语法树之后，会进行gimplification，在这一过程中函数的语法树被翻译为了控制流图的形式。每个函数对应一个控制流图</blockquote><p><img alt=cfg中间文件 data-src=http://cdn.sekyoro.top/imgs/065339.png><p>可以看到有很多cfg中间文件,应该是经过了多次处理.<p><img alt=不同的cfg文件对比 data-src=http://cdn.sekyoro.top/imgs/093252.png><h5 id=SSA文件><a class=headerlink href=#SSA文件 title=SSA文件></a>SSA文件</h5><blockquote><p>SSA 形式的 IR 主要特征是每个变量只赋值一次。相比而言，非 SSA 形式的 IR 里一个变量可以赋值多次。为了得到 SSA 形式的 IR，起初的 IR 中的变量会被分割成不同的版本（version），每个定义（definition：静态分析术语，可以理解为赋值）对应着一个版本.<p>把程序转换为 SSA 形式，最简单的方法就是将每个被赋值的变量用一个新的变量（版本）来取代，同时将每次使用的变量替换为这个变量到达该程序点的“”版本”</blockquote><p>可以看到有两个ssa中间文件<p><img alt=ssa文件 data-src=http://cdn.sekyoro.top/imgs/065345.png><p>值得一提的是前面这个ssa文件与最新的cfg文件是相同的.而这个release版的ssa文件只增加了一些东西<p><img alt=ssa增加的东西 data-src=http://cdn.sekyoro.top/imgs/065347.png><p>这表明ssa过程并没有改变什么(当然只是针对我这个源文件而言)<p>对于gcc的中间语言就不做分析了.<h4 id=对于clang><a class=headerlink href=#对于clang title=对于clang></a>对于clang</h4><p>以LLVM为后端的是苹果的clang编译器,其作为前端<sup><a href=#fn_10 id=reffn_10>10</a></sup>.<p>clang优点<blockquote><p>编译速度快:在某些平台上，Clang的编译速度显著的快过GCC(Debug模式下编译OC速度比GGC快3倍)<p>占用内存小:Clang生成的AST所占用的内存是GCC的五分之一左右<p>模块化设计:Clang采用基于库的模块化设计，易于 IDE 集成及其他用途的重用<p>诊断信息可读性强:在编译过程中，Clang 创建并保留了大量详细的元数据 (metadata)，有利于调试和错误报告<p>设计清晰简单，容易理解，易于扩展增强</blockquote><p>在Linux或者其他平台上需要自己安装.苹果上应该是自带的.<p><a href=https://buaa-se-compiling.github.io/miniSysY-tutorial/pre/llvm_download.html rel=noopener target=_blank>LLVM 工具链下载 · GitBook (buaa-se-compiling.github.io)</a><figure class="highlight sh"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br></pre><td class=code><pre><span class=line>sudo apt-get install llvm</span><br><span class=line>sudo apt-get install clang</span><br></pre></table></figure><p>Ubuntu 20.04.<p>继续用刚才的源程序分析.<figure class="highlight sh"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line>clang -emit-llvm -S -o main.ll main.c</span><br></pre></table></figure><p><img alt=得到ll文件 data-src=http://cdn.sekyoro.top/imgs/093254.png><p><img alt=ll中间文件 data-src=http://cdn.sekyoro.top/imgs/093257.png><p>下面来分析一下这个IR代码.<blockquote><p><code>arget triple</code> 与 <code>target datalayout</code> 是程序的标签属性说明<p>align<code>字段描述了程序的对齐属性</code>；<br><code>dso_local</code> 是变量和函数的的运行时抢占说明符` dso_local 是一个<strong>Runtime Preemption</strong>,表明该变量会在同一个链接单元内解析符号<p>; 开头的字符串是 LLVM IR 的注释</blockquote><p>根据源程序我们知道g1,g2是全局变量.且g1进行了初始化,g2没有所以分配在.bss段<p>在ll文件中 所有的全局变量都以 @ 为前缀，后面的 global 关键字表明了它是一个全局变量.<p>i32显而易见表示32位整数.后面跟着值. align表示对齐字节数.<p>common表示的是未初始化的全局变量.<p>这几行语句就是声明与初始化全局变量<figure class="highlight c"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br></pre><td class=code><pre><span class=line><span class=keyword>int</span> g1 = <span class=number>10</span>;</span><br><span class=line><span class=keyword>int</span> g2;</span><br></pre></table></figure><p><strong>对于main函数</strong><figure class="highlight tex"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br></pre><td class=code><pre><span class=line>define dso<span class=built_in>_</span>local i32 @main() <span class=params>#0</span> {</span><br><span class=line>  <span class=comment>%1 = alloca i32, align 4</span></span><br><span class=line>  <span class=comment>%2 = alloca i32, align 4</span></span><br><span class=line>  <span class=comment>%3 = alloca i32, align 4</span></span><br><span class=line>  store i32 0, i32* <span class=comment>%1, align 4</span></span><br><span class=line>  store i32 10, i32* <span class=comment>%2, align 4</span></span><br><span class=line>  <span class=comment>%4 = load i32, i32* %2, align 4</span></span><br><span class=line>  <span class=comment>%5 = load i32, i32* @g1, align 4</span></span><br><span class=line>  <span class=comment>%6 = call i32 @add(i32 %4, i32 %5)</span></span><br><span class=line>  store i32 <span class=comment>%6, i32* %3, align 4</span></span><br><span class=line>  <span class=comment>%7 = load i32, i32* %3, align 4</span></span><br><span class=line>  <span class=comment>%8 = load i32, i32* @g2, align 4</span></span><br><span class=line>  <span class=comment>%9 = add nsw i32 %7, %8</span></span><br><span class=line>  store i32 <span class=comment>%9, i32* %3, align 4</span></span><br><span class=line>  <span class=comment>%10 = load i32, i32* %3, align 4</span></span><br><span class=line>  ret i32 <span class=comment>%10</span></span><br><span class=line>}</span><br></pre></table></figure><p>可以看出 main函数返回值是一个32位整数(就是c语言中的int).<p>ret i32 %10表明返回一个值存储在%10(类似寄存器),其类型为int.<blockquote><p>一个函数定义的最简单的语法形如 <code>define + 返回值 (i32) + 函数名 (@foo) + 参数列表 ((i32 %a,i32 %b)) +函数体 ({ret i32 0})</code></blockquote><p>这里的 <code>#0</code> 与<code>main.ll</code>中靠后的<code>attributes #0 = ...</code>是对应的，他们被用来给函数加上特定的标记，例如是否是能够被内联。<p><img alt="func attribute" data-src=http://cdn.sekyoro.top/imgs/093259.png><p>表示的是main函数的特性,比如noinline是不进行内联.说实话,这里有点复杂而且没必要进一步阐述了.可以查阅官方文档<a href=https://llvm.org/docs/LangRef.html#function-attributes rel=noopener target=_blank>LLVM Language Reference Manual — LLVM 15.0.0git documentation</a><p>接下来分析main函数内部<figure class="highlight tex"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br></pre><td class=code><pre><span class=line><span class=comment>%1 = alloca i32, align 4</span></span><br><span class=line>  <span class=comment>%2 = alloca i32, align 4</span></span><br><span class=line>  <span class=comment>%3 = alloca i32, align 4</span></span><br><span class=line>  store i32 0, i32* <span class=comment>%1, align 4</span></span><br><span class=line>  store i32 10, i32* <span class=comment>%2, align 4</span></span><br></pre></table></figure><p>alloca表示分配空间,i32类型 4字节对齐<figure class="highlight tex"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line>以 <span class=comment>% 开头的符号表示虚拟寄存器，你可以把它当作一个临时变量（与全局变量相区分），或称之为临时寄存器</span></span><br></pre></table></figure><p>其余同理.<p>store i32 0表示将0存入%1. i32*表示i32类型内存的值,是一个地址.类似指针的感觉.<p>store i32 10类似将10存入另一个寄存器.<p>这几行语句类似main函数中<figure class="highlight c"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br></pre><td class=code><pre><span class=line><span class=keyword>int</span> a = <span class=number>10</span>;</span><br><span class=line><span class=keyword>int</span> c;</span><br></pre></table></figure><figure class="highlight tex"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br></pre><td class=code><pre><span class=line><span class=comment>%4 = load i32, i32* %2, align 4   //1</span></span><br><span class=line>  <span class=comment>%5 = load i32, i32* @g1, align 4  //2</span></span><br><span class=line>  <span class=comment>%6 = call i32 @add(i32 %4, i32 %5)  //3</span></span><br><span class=line>  store i32 <span class=comment>%6, i32* %3, align 4   //4</span></span><br><span class=line>  <span class=comment>%7 = load i32, i32* %3, align 4  //5</span></span><br><span class=line>  <span class=comment>%8 = load i32, i32* @g2, align 4 //6</span></span><br><span class=line>  <span class=comment>%9 = add nsw i32 %7, %8  //7</span></span><br></pre></table></figure><p>第一行表示 从 %2（i32*）中 load 出一个值（类型为 i32），这个值的名字为 %4<p>第二行表示将全局变量g1赋值给%5. 第三行表示执行call函数.call函数声明在后面,顺便实参是%4与%5.<p>第四行表示将上一行得到的结果存入%3. 第5行表示将%3结果load出给%7.<p>第六行表示将全局变量g2赋给%8. 关于nsw查阅官方文档.表示不进行有符号转换.即无符号运算.<blockquote><p><code>nuw</code> and <code>nsw</code> stand for “No Unsigned Wrap” and “No Signed Wrap”, respectively. If the <code>nuw</code> and/or <code>nsw</code> keywords are present, the result value of the <code>add</code> is a <a href=https://llvm.org/docs/LangRef.html#poisonvalues rel=noopener target=_blank>poison value</a> if unsigned and/or signed overflow, respectively, occurs.<p>A poison value is a result of an erroneous operation.</blockquote><p>所以第七行表示将%7和%8值相加赋给%9.<p>接着将%9的值存入%3.再将%3的值load给%10.然后返回%10.<figure class="highlight tex"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br></pre><td class=code><pre><span class=line>store i32 <span class=comment>%9, i32* %3, align 4</span></span><br><span class=line> <span class=comment>%10 = load i32, i32* %3, align 4</span></span><br><span class=line> ret i32 <span class=comment>%10</span></span><br></pre></table></figure><p>这样main函数中代码说明完了.<figure class="highlight tex"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line>declare dso<span class=built_in>_</span>local i32 @add(i32, i32) <span class=params>#1</span></span><br></pre></table></figure><p>表示声明函数add. add有两个参数均为i32类型.<figure class="highlight tex"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br></pre><td class=code><pre><span class=line>!llvm.module.flags = !{!0}</span><br><span class=line>!llvm.ident = !{!1}</span><br><span class=line></span><br><span class=line>!0 = !{i32 1, !"wchar<span class=built_in>_</span>size", i32 4}</span><br><span class=line>!1 = !{!"clang version 10.0.0-4ubuntu1 "}</span><br></pre></table></figure><p>这些就是一些信息了,不用在意.<p>LLVM中也有SSA.<blockquote><p>在 LLVM IR 中，变量是以 SSA 形式存在的，为了生成正确的 LLVM IR 并实现我们的实验，对 SSA 的知识是必不可少的，LLVM IR 的代码有两种状态，分别是存取内存形式的 IR 以及带有 <code>phi</code> 指令的 SSA IR</blockquote><p>我们其实可以看出LLVM的IR与汇编代码还是有很大类似之处的,不过IR需要SSA.即程序中的每个变量都有且只有一个赋值语句,这是比较大的差别.<p>再看一下分支和循环语句的IR.<figure class="highlight c"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br></pre><td class=code><pre><span class=line><span class=meta>#<span class=meta-keyword>include</span> <span class=meta-string>"add.h"</span></span></span><br><span class=line><span class=keyword>int</span> g1 = <span class=number>10</span>;</span><br><span class=line><span class=keyword>int</span> g2;</span><br><span class=line><span class=function><span class=keyword>int</span> <span class=title>main</span><span class=params>()</span></span></span><br><span class=line><span class=function></span>{</span><br><span class=line>        <span class=keyword>int</span> a = <span class=number>10</span>;</span><br><span class=line>        <span class=keyword>int</span> c;</span><br><span class=line>        <span class=keyword>if</span>(a<<span class=number>5</span>)</span><br><span class=line>        {</span><br><span class=line>                c = <span class=number>2</span>;</span><br><span class=line>        }</span><br><span class=line>        <span class=keyword>while</span>(a><span class=number>5</span>)</span><br><span class=line>        {</span><br><span class=line>                a = a<span class=number>-5</span>;</span><br><span class=line>        }</span><br><span class=line>        <span class=keyword>return</span> <span class=number>0</span>;</span><br><span class=line>}</span><br></pre></table></figure><p>看一下得到的ll文件<figure class="highlight tex"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br></pre><td class=code><pre><span class=line>define dso<span class=built_in>_</span>local i32 @main() <span class=params>#0</span> {</span><br><span class=line>  <span class=comment>%1 = alloca i32, align 4 //分配空间i32</span></span><br><span class=line>  <span class=comment>%2 = alloca i32, align 4</span></span><br><span class=line>  <span class=comment>%3 = alloca i32, align 4</span></span><br><span class=line>  store i32 0, i32* <span class=comment>%1, align 4 //赋值 0    c</span></span><br><span class=line>  store i32 10, i32* <span class=comment>%2, align 4 //赋值10   a</span></span><br><span class=line>  <span class=comment>%4 = load i32, i32* %2, align 4 //将%2所存的值赋给%4  t=a</span></span><br><span class=line>  <span class=comment>%5 = icmp slt i32 %4, 5 //icmp就是有符号比较 即%4与5比较如果%4小于5则slt=1</span></span><br><span class=line>  br i1 <span class=comment>%5, label %6, label %7 //i1表示一个类型即%5 比较%5是否为1,若是则跳转%6否则跳%7</span></span><br><span class=line></span><br><span class=line>6:                                                ; preds = <span class=comment>%0</span></span><br><span class=line>  store i32 2, i32* <span class=comment>%3, align 4 //即c语言c=2</span></span><br><span class=line>  br label <span class=comment>%7//跳出 至此if分支语句结束</span></span><br><span class=line></span><br><span class=line>7:                                                ; preds = <span class=comment>%6, %0</span></span><br><span class=line>  br label <span class=comment>%8// a>=5跳转到这</span></span><br><span class=line></span><br><span class=line>8:                                                ; preds = <span class=comment>%11, %7</span></span><br><span class=line>  <span class=comment>%9 = load i32, i32* %2, align 4 //将%2赋值给%5 t = a</span></span><br><span class=line>  <span class=comment>%10 = icmp sgt i32 %9, 5 // 又是进行比较sgt与slt相反 大于则置为1  t>5</span></span><br><span class=line>  br i1 <span class=comment>%10, label %11, label %14 //如果%10=1则跳转到11处否则跳转14处</span></span><br><span class=line></span><br><span class=line>11:                                               ; preds = <span class=comment>%8</span></span><br><span class=line>  <span class=comment>%12 = load i32, i32* %2, align 4 //t>5则跳转到这 将%2赋给%12  t2 = a</span></span><br><span class=line>  <span class=comment>%13 = sub nsw i32 %12, 5 //t3 = t2-5</span></span><br><span class=line>  store i32 <span class=comment>%13, i32* %2, align 4 // a = t3</span></span><br><span class=line>  br label <span class=comment>%8</span></span><br><span class=line></span><br><span class=line>14:                                               ; preds = <span class=comment>%8</span></span><br><span class=line>  ret i32 0</span><br><span class=line>}</span><br><span class=line></span><br></pre></table></figure><p>slt在mips指令集有解释<blockquote><p>如果第一个源寄存器的内容小于第二个源寄存器的内容，则 SLT 指令将目标寄存器的内容设置为值 1。 否则，它被设置为值 0。</blockquote><p>br<code>指令的语法为</code>br + 标志位 + truelabel + falselabel<code>，或者</code>br + label.是跳转指令.<p>如注释.<h4 id=update><a class=headerlink href=#update title=update></a>update</h4><p>现在更新一下clang对于一个源程序文件的整体编译过程.之前只分析了前端.<p>clang的官方文档还是有点复杂.<p><code>-fmodules</code>:启用“模块”语言功能。关于<code>Modules</code>特性，详见<a href=https://links.jianshu.com/go?to=https%3A%2F%2Fclang.llvm.org%2Fdocs%2FModules.html%23introduction rel=noopener target=_blank>此处</a>，大意为使用<code>import</code>代替<code>include</code>，编译速度快。<p><code>-fsyntax-only</code>:运行预处理器，解析器和类型检查阶段。<p><code>-Xclang &LTarg></code>:传递参数到<code>clang</code>的编译器。<p><code>dump-tokens</code>:运行预处理器，转储<code>Token</code>的内部表示<p>这里参照博客<a href=https://www.jianshu.com/p/2da08634b53a rel=noopener target=_blank>编译器与Clang编译过程 - 简书 (jianshu.com)</a>看一下clang的使用<h5 id=预处理-1><a class=headerlink href=#预处理-1 title=预处理></a>预处理</h5><figure class="highlight bash"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line>clang -E test.c</span><br></pre></table></figure><p>预处理<blockquote><p>1、删除所有的#define，代码中使用宏定义的地方会进行替换<p>2、将#include包含的文件插入到文件的位置，这个插入的过程是递归的<p>3、删除掉注释符号及注释<p>4、添加行号和文件标识，便于调试</blockquote><p>查看文件发现前几行都是注释,大致是包含一些文件路径.再下面是typedef定义变量.<p>还定义了一些结构体,声明了函数.最后是源代码<p><img alt=预处理文件 data-src=http://cdn.sekyoro.top/imgs/image-20220402215053078.png><h5 id=分析词法功能><a class=headerlink href=#分析词法功能 title=分析词法功能></a>分析词法功能</h5><figure class="highlight bash"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line>clang -fsyntax-only -Xclang -dump-tokens test.c</span><br></pre></table></figure><p>这一步顾名思义是词法分析,得到valueType value loc这样形式的数据<p>有标识符identifier类型,有comma逗号类型,const类型等等<p><img alt=词法分析得到元组 data-src=http://cdn.sekyoro.top/imgs/image-20220402215528693.png><p>处理文件后可以得到三元组,即属性,值以及位置.<ul><li><code>Sourece Location</code>：表示<code>Token</code>开始的位置，比如：<code>Loc=&LTmain.m:11:5></code>；<li><code>Token Kind</code>：表示<code>Token</code>的类型，比如：<code>identifier</code>、<code>numeric_constant</code>、<code>string_literal</code>；<li><code>Flags</code>：词法分析器和处理器跟踪每个<code>Token</code>的基础，目前有四个<code>Flag</code>分别是：</ul><ol><li><code>StartOfLine</code>：表示这是每行开始的第一个<code>Token</code>；<li><code>LeadingSpace</code>：当通过宏扩展<code>Token</code>时，在<code>Token</code>之前有一个空格字符。该标志的定义是依据预处理器的字符串化要求而进行的非常严格地定义。<li><code>DisableExpand</code>：该标志在预处理器内部使用，用来表示<code>identifier</code>令牌禁用宏扩展。<li><code>NeedsCleaning</code>：如果令牌的原始拼写包含三字符组或转义的换行符，则设置此标志</ol><h5 id=分析语法产生出的抽象语法树><a class=headerlink href=#分析语法产生出的抽象语法树 title=分析语法产生出的抽象语法树></a>分析语法产生出的抽象语法树</h5><figure class="highlight bash"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line>clang -fsyntax-only -Xclang -ast-dump test.c</span><br></pre></table></figure><blockquote><p>-ast-dump: Build ASTs and then debug dump them<p>表示生成抽象语法树</blockquote><p><img style="zoom: 50%;" alt=语法分析后的抽象语法树 data-src=http://cdn.sekyoro.top/imgs/image-20220402220439060.png><p>很好,我并不是和能看懂这个东西.<p><a href=https://links.jianshu.com/go?to=https%3A%2F%2Fclang.llvm.org%2Fdoxygen%2Fclassclang_1_1Type.html rel=noopener target=_blank>Type</a> ：表示类型，比如<code>BuiltinType</code><p><a href=https://links.jianshu.com/go?to=https%3A%2F%2Fclang.llvm.org%2Fdoxygen%2Fclassclang_1_1Decl.html rel=noopener target=_blank>Decl</a> ：表示一个声明<code>declaration</code>或者一个定义<code>definition</code>，比如：变量，函数，结构体，<code>typedef</code>；<p><a href=https://links.jianshu.com/go?to=https%3A%2F%2Fclang.llvm.org%2Fdoxygen%2Fclassclang_1_1DeclContext.html rel=noopener target=_blank>DeclContext</a> ：用来声明表示上下文的特定<code>decl</code>类型的基类；<p><a href=https://links.jianshu.com/go?to=https%3A%2F%2Fclang.llvm.org%2Fdoxygen%2Fclassclang_1_1Stmt.html rel=noopener target=_blank>Stmt</a> ：表示一条陈述<code>statement</code>;<p><a href=https://links.jianshu.com/go?to=https%3A%2F%2Fclang.llvm.org%2Fdoxygen%2Fclassclang_1_1Expr.html rel=noopener target=_blank>Expr</a>：在<code>Clang</code>的语法树中也表示一条陈述<code>statements</code>;<h5 id=中间代码生成><a class=headerlink href=#中间代码生成 title=中间代码生成></a>中间代码生成</h5><figure class="highlight bash"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line>clang -S -emit-llvm -o test.ll test.c</span><br></pre></table></figure><p>这个中间代码之前已经分析过了<a href=#IR分析>点击查看</a><p><img alt=IR代码 data-src=http://cdn.sekyoro.top/imgs/image-20220402222535565.png><p>这是f函数的中间代码,i32表示类型,align表示对齐.alloca分配空间,store存储值.<h5 id=汇编语言生成><a class=headerlink href=#汇编语言生成 title=汇编语言生成></a>汇编语言生成</h5><figure class="highlight bash"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line>llc test.ll -o test.s</span><br></pre></table></figure><p>汇编语言生成<p><img alt=image-20220402223339213 data-src=http://cdn.sekyoro.top/imgs/image-20220402223339213.png><p>到这一步生成汇编代码与及其相关,就没有太多可以说了.<h5 id=可执行程序生成><a class=headerlink href=#可执行程序生成 title=可执行程序生成></a>可执行程序生成</h5><figure class="highlight bash"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line>clang test.s -o <span class=built_in>test</span></span><br></pre></table></figure><p><img alt=生成可执行程序 data-src=http://cdn.sekyoro.top/imgs/image-20220402223551048.png><h5 id=反汇编程序><a class=headerlink href=#反汇编程序 title=反汇编程序></a>反汇编程序</h5><figure class="highlight bash"><table><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br></pre><td class=code><pre><span class=line>objdump -dS <span class=built_in>test</span></span><br><span class=line>clang -g -o <span class=built_in>test</span> test.c</span><br></pre></table></figure><p>clang -g -o test test.c可以直接生成目标程序.<p><img alt=反汇编可执行程序 data-src=http://cdn.sekyoro.top/imgs/image-20220402223849933.png><p>objdump -S命令可以显示源代码,但需要编译时加上-g<p>使用clang -g test.c -o test得到的可执行程序反汇编.<p><img alt=image-20220402224120628 data-src=http://cdn.sekyoro.top/imgs/image-20220402224120628.png style=zoom:67%;><p>可以看到这里有更多的调试信息.<h2 id=2><a class=headerlink href=#2 title=2.></a>2.</h2><p>对所编写的例子尝试编写一个Makefile文件,然后进行make编译,然后通过make -j #n来编译,也可采用cmake.证明并行编译确实提高了.<p>makefile编写本身就遵循一定技巧,好的makefile能让人一眼看上去知道规则.由于我编写的比较少,makefile写的不是很好,但是勉强能用.<h3 id=make并行编译><a class=headerlink href=#make并行编译 title=make并行编译></a>make并行编译</h3><p><img alt=Makefile data-src=http://cdn.sekyoro.top/imgs/093301.png><p>重点关注编译,即build这一行.进行了main.c主文件的编译以及引入的其他五个c文件的编译<p><img alt=make编译 data-src=http://cdn.sekyoro.top/imgs/093303.png><p>time命令可以得到运行时间<sup><a href=#fn_6 id=reffn_6>6</a></sup>,0.08s是执行用户态代码所耗费的 CPU 时间<p>0.19s是内核态运行所耗费的CPU时间,0.592包括了阻塞时间和其他进程耗费时间<p>每次编译时间或多说少有一点差异,<p><img alt=再次进行编译 data-src=http://cdn.sekyoro.top/imgs/093305.png><p>但基本上用户态时间0.1s左右,管态时间要多一点<p>可以看见make -j 3,并行三条指令编译时间减少了.<p>看来编译的任务还不够多,于是我又增加了几个个源文件进行编译,每个源文件代码二三十行也不算多.<p><img alt=make并行编译 data-src=http://cdn.sekyoro.top/imgs/093307.png><p>可以看到时间减少了,但不是很明显.可能是因为我用的虚拟机,分配的cpu与实机有一定差别.<p>我在windows上的测试.<p><img alt=image-20220114212732480 data-src=http://cdn.sekyoro.top/imgs/093309.png><p>进行并行编译<p><img alt=make并行编译 data-src=http://cdn.sekyoro.top/imgs/093311.png><p>可以看到时间由用户态的0.03s->0.015s,可以说明并行编译时间变短了.<h3 id=update-1><a class=headerlink href=#update-1 title=update></a>update</h3><p>由于之前做的编译量有一点少,运行时间太短以及测试次数不够.这里继续做一下补充.<p>我继续增加源文件的代码量.<p>由于我使用的是虚拟机,查看我主机电脑配置信息6核cpu.<p>所以这里我设置虚拟机分配了3个虚拟cpu.<p>同时我增加了一些代码,当时并不是很多.<p>可惜的是还是因为代码量不够的原因导致差别不是很大.考虑到make -j使用多处理器并行,所以time命令结果看total time更合适.因为使用并行减少时间<p><img alt=编译1 data-src=http://cdn.sekyoro.top/imgs/093312.png><p>由于代码还是写的不规范,有warning不过不影响<p><img alt=编译结果 data-src=http://cdn.sekyoro.top/imgs/093315.png><p>make -j2 make -j3 make -j6<p><img alt=-j2 data-src=http://cdn.sekyoro.top/imgs/065348.png><p><img alt=-j2编译结果 data-src=http://cdn.sekyoro.top/imgs/065351.png><p><img alt=-j3编译结果 data-src=http://cdn.sekyoro.top/imgs/093317.png><p><img alt=-j6编译结果 data-src=http://cdn.sekyoro.top/imgs/065353.png><p>进行了7组实验,根据total时间结果,也就是进程从开始到结束所用的实际时间。这个时间包括其他进程使用的时间片和进程阻塞的时间.因为使用了多处理器并行处理编译.<p><img alt=试验结果 data-src=http://cdn.sekyoro.top/imgs/093318.png><p>但是user时间也就是用户态时间并没有明显变化.<del>估计是代码还是不够</del><p><img alt=sys+usr时间 data-src=http://cdn.sekyoro.top/imgs/093319.png><p>经过我的考虑,认为make -j本是是让多个cpu内核并行处理指令,这也不意味着优化.即usr+sys时间变化不大是正常的,real时间即总时间(包括其他进程及IO)应该变化,因为多个cpu并行就像多个人一起干同一件事一样,总的来说时间减少了.但放在每个人身上都花了一点时间,这个时间是变化不大的<sup><a href=#fn_11 id=reffn_11>11</a></sup>.<p>现在进行Linux源码部分模块的编译<sup><a href=#fn_12 id=reffn_12>12</a></sup><p><img alt=linux内核源码 data-src=http://cdn.sekyoro.top/imgs/065355.png><p>由于编译全部代码太耗时了,这里编译部分代码.<figure class="highlight sh"><table><tr><td class=gutter><pre><span class=line>1</span><br></pre><td class=code><pre><span class=line>time make SUBDIRS=./samples/kprobes  modules</span><br></pre></table></figure><p>网上教程有点难,直接使用这个命令.选择某个模块的文件夹编译.<p><img alt=模块编译 data-src=http://cdn.sekyoro.top/imgs/093321.png><p>上图是直接make的编译时间<p>下图是 -j3编译内核某模块时间<p><img alt=-j3编译时间 data-src=http://cdn.sekyoro.top/imgs/065357.png><p>-j6编译时间<p><img alt=-j6编译时间 data-src=http://cdn.sekyoro.top/imgs/065402.png><p><img alt=内核模块编译时间 data-src=http://cdn.sekyoro.top/imgs/065404.png><p>由于是虚拟机并且因为编译内核时间有点久只做了一组实验.<p>但是结果还是比较清晰的,usr和sys时间并没有太大变化.主要是total时间减少.<p>有意思的是-j6情况下编译时间并没有想象的减小的那么多,初步估计是虚拟机的逻辑cpu机制导致.<h3 id=Cmake使用><a class=headerlink href=#Cmake使用 title=Cmake使用></a>Cmake使用</h3><p>同时,由于makefile编写较为麻烦,这里用cmake实现一下,不过本质上差别不大.<p>CMake是一个<strong>跨平台</strong>的编译(Build)工具,可以用简单的语句来描述所有平台的编译过程。<p>CMake能够输出各种各样的makefile或者project文件.也就是说只要我们配置好了cmake文件(CMakeLists.txt),就能输出对应的makefile,我们再make就行了<sup><a href=#fn_7 id=reffn_7>7</a></sup>.<p>cmake是跨平台的,我在windows上编写cmakelists,cmake可以指定构建的目的,可以是一般的MinGW,也可以是Ninja等.<p>需要在CMakeLists.txt文件中指定如下几项，cmake版本、工程名、构建目标app的源文件<ol><li><code>cmake_minimum_required</code>：指定运行此配置文件所需的 CMake 的最低版本；<li><code>project</code>：参数值是 <code>Demo1</code>，该命令表示项目的名称是 <code>Demo1</code> 。<li><code>add_executable</code>： 将名为 main.cc 的源文件编译成一个名称为 Demo 的可执行文件</ol><p><img alt=cmake构建 data-src=http://cdn.sekyoro.top/imgs/093322.png><p>cmake在不同平台默认的构建目标(generators)不一样,我的在Windows上是visual studio,Linux上是Unix Makefiles,需要按照自己要求修改.<p>执行cmake后会在根据指定路径找到CMakeLists.txt,然后按照要求构建,构建文件等在执行命令的本目录下产生.由CMakeCache.txt,cmake_install.cmake,Makefile和CMakeFiles文件夹等.<p>我们主要关注生成的Makefile.然后在该目录下make即可.<p><img alt=cmake data-src=http://cdn.sekyoro.top/imgs/093324.png><img alt=make data-src=http://cdn.sekyoro.top/imgs/093327.png><p>这样按照generator的makefile等构建就完成了.<h3 id=参考资料><a class=headerlink href=#参考资料 title=参考资料></a>参考资料</h3><p><sup><a href=#fn_1 id=reffn_1>1</a></sup>:<a href=https://zhuanlan.zhihu.com/p/345669064 rel=noopener target=_blank>C语言未初始化的局部变量是多少？ - 知乎 (zhihu.com)</a> 事实上,未初始化的局部变量不一定为0,这与编译器有关.<br><sup><a href=#fn_2 id=reffn_2>2</a></sup>:<a href=https://blog.csdn.net/weixin_43955214/article/details/104138416 rel=noopener target=_blank>(58条消息) 代码段(.text)、数据区(.data)和bss段<em>baymaxly的博客-CSDN博客</em>.text段</a><p><sup><a href=#fn_3 id=reffn_3>3</a></sup>:<a href=https://www.cnblogs.com/james1207/archive/2013/10/10/3362277.html rel=noopener target=_blank>C语言全局未初始化数据段分析 - Class Xman - 博客园 (cnblogs.com)</a>很好的文章<br><sup><a href=#fn_4 id=reffn_4>4</a></sup>:<a href=https://blog.csdn.net/qqliyunpeng/article/details/45116615 rel=noopener target=_blank>(58条消息) ARM中的—-汇编指令<em>老鹏-CSDN博客</em>汇编.quad</a><br><sup><a href=#fn_5 id=reffn_5>5</a></sup>:<a href=https://www.cnblogs.com/yanghong-hnu/p/4705755.html rel=noopener target=_blank>(深入理解计算机系统) bss段，data段、text段、堆(heap)和栈(stack) - 跑马灯的忧伤 - 博客园 (cnblogs.com)</a><br><sup><a href=#fn_6 id=reffn_6>6</a></sup>:<a href=http://c.biancheng.net/linux/time.html rel=noopener target=_blank>time命令_Linux time命令：测量命令的执行时间或者系统资源的使用情况 (biancheng.net)</a><br><sup><a href=#fn_7 id=reffn_7>7</a></sup>:<a href=https://www.cnblogs.com/ybqjymy/p/13409050.html rel=noopener target=_blank>超详细的CMake教程 - 一杯清酒邀明月 - 博客园 (cnblogs.com)</a><p><sup><a href=#fn_8 id=reffn_8>8</a></sup>:<a href=https://blog.csdn.net/lqy971966/article/details/106905237 rel=noopener target=_blank>readelf 和 objdump 例子详解及区别_哈尼的博客-CSDN博客_readelf和objdump</a><p><sup><a href=#fn_9 id=reffn_9>9</a></sup>:<a href=https://www.jianshu.com/p/863b279c941e rel=noopener target=_blank>使用readelf和objdump解析目标文件 - 简书 (jianshu.com)</a><h3 id=个人感想><a class=headerlink href=#个人感想 title=个人感想></a>个人感想</h3><p>我更加熟悉了变量和函数在段的分配以及ELF文件链接视图和执行视图.<p>LLVM相对于gcc确实是好很多,中间代码很容易懂也很容易研究,模块更加分离.了解了编译器的大概设计,从词法,语法到语义的前端生成AST,再由AST得到IR,再对IR进行优化.后端根据优化后的IR生成对应平台的机器代码.这个过程中IR的代码就显得很重要.<p>最后使用了make并行编译.不过我写的代码量还是上不去,real时间0.5秒左右,不过也能看到并行编译带来的优势了.编译了Linux部分模块源码,耗时比较久,并没有多做几组实验.</p><link href=/css/spoiler.css rel=stylesheet><script async src=/js/spoiler.js></script></div><div><div><div style="text-align:center;color: #ccc;font-size:14px;">-------------本文结束<i class="fa fa-paw"></i>感谢您的阅读-------------</div></div></div><div class=reward-container><div>感谢阅读.</div><button onclick="var qr = document.getElementById('qr'); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">打赏</button><div style="display: none;" id=qr><div style="display: inline-block;"><img alt="Sekyoro 微信支付" src=/images/wechatpay.png><p>微信支付</div></div></div><div><ul class=post-copyright><li class=post-copyright-author><strong>本文作者： </strong>Sekyoro<li class=post-copyright-link><strong>本文链接：</strong> <a href=https://www.sekyoro.top/2022/03/09/%E6%B1%87%E7%BC%96%E5%8E%9F%E7%90%86%E8%AF%BE%E7%A8%8B%E5%AD%A6%E4%B9%A0/ title=汇编原理课程学习>https://www.sekyoro.top/2022/03/09/汇编原理课程学习/</a><li class=post-copyright-license><strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href=https://creativecommons.org/licenses/by-nc-sa/4.0/ rel=noopener target=_blank><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！</ul></div><div class=followme><p>欢迎关注我的其它发布渠道<div class=social-list><div class=social-item><a class=social-link href=/images/wxqrcode.png target=_blank> <span class=icon> <i class="fab fa-weixin"></i> </span> <span class=label>WeChat</span> </a></div><div class=social-item><a class=social-link href=/images/website.png target=_blank> <span class=icon> <i class="fa fa-user"></i> </span> <span class=label>PersonalWebsite</span> </a></div><div class=social-item><a class=social-link href=https://my-astro-git-main-drowning-in-codes.vercel.app target=_blank> <span class=icon> <i class="fas fa-share"></i> </span> <span class=label>杂鱼分享</span> </a></div><div class=social-item><a class=social-link href=/atom.xml target=_blank> <span class=icon> <i class="fa fa-rss"></i> </span> <span class=label>RSS</span> </a></div></div></div><footer class=post-footer><div class=post-tags><a href=/tags/course/ rel=tag><i class="fa fa-tag"></i> course</a><a href=/tags/compile/ rel=tag><i class="fa fa-tag"></i> compile</a></div><div class=post-nav><div class=post-nav-item><a href=/2022/03/05/nginx%E5%AD%A6%E4%B9%A0/ rel=prev title=nginx学习> <i class="fa fa-chevron-left"></i> nginx学习 </a></div><div class=post-nav-item><a href=/2022/04/01/graphviz%E5%AD%A6%E4%B9%A0/ rel=next title=graphviz学习> graphviz学习 <i class="fa fa-chevron-right"></i> </a></div></div></footer></article></div><!-- 评论区 --><div class=comments><div data-id=city data-uid=MTAyMC81MzE5Ny8yOTY3Mg== id=lv-container></div></div><script>window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div><aside class=sidebar><div class=sidebar-inner><!-- canvas粒子时钟 --><div><canvas id=canvas style=width:60%;>当前浏览器不支持canvas，请更换浏览器后再试</canvas></div><script>(function(){

   var digit=
    [
        [
            [0,0,1,1,1,0,0],
            [0,1,1,0,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,0,1,1,0],
            [0,0,1,1,1,0,0]
        ],//0
        [
            [0,0,0,1,1,0,0],
            [0,1,1,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [1,1,1,1,1,1,1]
        ],//1
        [
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,0,1,1,0,0,0],
            [0,1,1,0,0,0,0],
            [1,1,0,0,0,0,0],
            [1,1,0,0,0,1,1],
            [1,1,1,1,1,1,1]
        ],//2
        [
            [1,1,1,1,1,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,0,0,1,1,0],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//3
        [
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,1,0],
            [0,0,1,1,1,1,0],
            [0,1,1,0,1,1,0],
            [1,1,0,0,1,1,0],
            [1,1,1,1,1,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,0,1,1,0],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,1,1]
        ],//4
        [
            [1,1,1,1,1,1,1],
            [1,1,0,0,0,0,0],
            [1,1,0,0,0,0,0],
            [1,1,1,1,1,1,0],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//5
        [
            [0,0,0,0,1,1,0],
            [0,0,1,1,0,0,0],
            [0,1,1,0,0,0,0],
            [1,1,0,0,0,0,0],
            [1,1,0,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//6
        [
            [1,1,1,1,1,1,1],
            [1,1,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,1,1,0,0,0],
            [0,0,1,1,0,0,0],
            [0,0,1,1,0,0,0],
            [0,0,1,1,0,0,0]
        ],//7
        [
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//8
        [
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,1,1,0,0,0,0]
        ],//9
        [
            [0,0,0,0,0,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,0,0,0,0,0]
        ]//:
    ];

var canvas = document.getElementById('canvas');

if(canvas.getContext){
    var cxt = canvas.getContext('2d');
    //声明canvas的宽高
    var H = 100,W = 700;
    canvas.height = H;
    canvas.width = W;
    cxt.fillStyle = '#f00';
    cxt.fillRect(10,10,50,50);

    //存储时间数据
    var data = [];
    //存储运动的小球
    var balls = [];
    //设置粒子半径
    var R = canvas.height/20-1;
    (function(){
        var temp = /(\d)(\d):(\d)(\d):(\d)(\d)/.exec(new Date());
        //存储时间数字，由十位小时、个位小时、冒号、十位分钟、个位分钟、冒号、十位秒钟、个位秒钟这7个数字组成
        data.push(temp[1],temp[2],10,temp[3],temp[4],10,temp[5],temp[6]);
    })();

    /*生成点阵数字*/
    function renderDigit(index,num){
        for(var i = 0; i < digit[num].length; i++){
            for(var j = 0; j < digit[num][i].length; j++){
                if(digit[num][i][j] == 1){
                    cxt.beginPath();
                    cxt.arc(14*(R+2)*index + j*2*(R+1)+(R+1),i*2*(R+1)+(R+1),R,0,2*Math.PI);
                    cxt.closePath();
                    cxt.fill();
                }
            }
        }
    }

    /*更新时钟*/
    function updateDigitTime(){
        var changeNumArray = [];
        var temp = /(\d)(\d):(\d)(\d):(\d)(\d)/.exec(new Date());
        var NewData = [];
        NewData.push(temp[1],temp[2],10,temp[3],temp[4],10,temp[5],temp[6]);
        for(var i = data.length-1; i >=0 ; i--){
            //时间发生变化
            if(NewData[i] !== data[i]){
                //将变化的数字值和在data数组中的索引存储在changeNumArray数组中
                changeNumArray.push(i+'_'+(Number(data[i])+1)%10);
            }
        }
        //增加小球
        for(var i = 0; i< changeNumArray.length; i++){
            addBalls.apply(this,changeNumArray[i].split('_'));
        }
        data = NewData.concat();
    }

    /*更新小球状态*/
    function updateBalls(){
        for(var i = 0; i < balls.length; i++){
            balls[i].stepY += balls[i].disY;
            balls[i].x += balls[i].stepX;
            balls[i].y += balls[i].stepY;
            if(balls[i].x > W + R || balls[i].y > H + R){
                balls.splice(i,1);
                i--;
            }
        }
    }

    /*增加要运动的小球*/
    function addBalls(index,num){
        var numArray = [1,2,3];
        var colorArray =  ["#3BE","#09C","#A6C","#93C","#9C0","#690","#FB3","#F80","#F44","#C00"];
        for(var i = 0; i < digit[num].length; i++){
            for(var j = 0; j < digit[num][i].length; j++){
                if(digit[num][i][j] == 1){
                    var ball = {
                        x:14*(R+2)*index + j*2*(R+1)+(R+1),
                        y:i*2*(R+1)+(R+1),
                        stepX:Math.floor(Math.random() * 4 -2),
                        stepY:-2*numArray[Math.floor(Math.random()*numArray.length)],
                        color:colorArray[Math.floor(Math.random()*colorArray.length)],
                        disY:1
                    };
                    balls.push(ball);
                }
            }
        }
    }

    /*渲染*/
    function render(){
        //重置画布宽度，达到清空画布的效果
        canvas.height = 100;
        //渲染时钟
        for(var i = 0; i < data.length; i++){
            renderDigit(i,data[i]);
        }
        //渲染小球
        for(var i = 0; i < balls.length; i++){
            cxt.beginPath();
            cxt.arc(balls[i].x,balls[i].y,R,0,2*Math.PI);
            cxt.fillStyle = balls[i].color;
            cxt.closePath();
            cxt.fill();
        }
    }

    clearInterval(oTimer);
    var oTimer = setInterval(function(){
        //更新时钟
        updateDigitTime();
        //更新小球状态
        updateBalls();
        //渲染
        render();
    },50);
}

})();</script><!-- require APlayer --><link href=https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js></script><!-- require MetingJS --><script src=/js/meting-js.js></script><ul class="sidebar-nav motion-element"><li class=sidebar-nav-toc>文章目录<li class=sidebar-nav-overview>站点概览</ul><!--noindex--><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class=nav><li class="nav-item nav-level-2"><a class=nav-link href=#1><span class=nav-number>1.</span> <span class=nav-text>1.</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#%E7%8E%AF%E5%A2%83><span class=nav-number>1.1.</span> <span class=nav-text>环境</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#%E4%BD%BF%E7%94%A8GCC><span class=nav-number>1.2.</span> <span class=nav-text>使用GCC</span></a><ol class=nav-child><li class="nav-item nav-level-4"><a class=nav-link href=#%E9%A2%84%E5%A4%84%E7%90%86><span class=nav-number>1.2.1.</span> <span class=nav-text>预处理</span></a><li class="nav-item nav-level-4"><a class=nav-link href=#%E7%BC%96%E8%AF%91><span class=nav-number>1.2.2.</span> <span class=nav-text>编译</span></a><li class="nav-item nav-level-4"><a class=nav-link href=#%E6%B1%87%E7%BC%96><span class=nav-number>1.2.3.</span> <span class=nav-text>汇编</span></a><ol class=nav-child><li class="nav-item nav-level-5"><a class=nav-link href=#objdump><span class=nav-number>1.2.3.1.</span> <span class=nav-text>objdump</span></a></ol><li class="nav-item nav-level-4"><a class=nav-link href=#%E5%87%BD%E6%95%B0%E7%9A%84%E8%B0%83%E7%94%A8%E5%92%8C%E8%BF%94%E5%9B%9E><span class=nav-number>1.2.4.</span> <span class=nav-text>函数的调用和返回</span></a></ol><li class="nav-item nav-level-3"><a class=nav-link href=#LLVM><span class=nav-number>1.3.</span> <span class=nav-text>LLVM</span></a><ol class=nav-child><li class="nav-item nav-level-4"><a class=nav-link href=#%E5%AF%B9%E4%BA%8EGCC><span class=nav-number>1.3.1.</span> <span class=nav-text>对于GCC</span></a><ol class=nav-child><li class="nav-item nav-level-5"><a class=nav-link href=#CFG%E6%96%87%E4%BB%B6><span class=nav-number>1.3.1.1.</span> <span class=nav-text>CFG文件</span></a><li class="nav-item nav-level-5"><a class=nav-link href=#SSA%E6%96%87%E4%BB%B6><span class=nav-number>1.3.1.2.</span> <span class=nav-text>SSA文件</span></a></ol><li class="nav-item nav-level-4"><a class=nav-link href=#%E5%AF%B9%E4%BA%8Eclang><span class=nav-number>1.3.2.</span> <span class=nav-text>对于clang</span></a><li class="nav-item nav-level-4"><a class=nav-link href=#update><span class=nav-number>1.3.3.</span> <span class=nav-text>update</span></a><ol class=nav-child><li class="nav-item nav-level-5"><a class=nav-link href=#%E9%A2%84%E5%A4%84%E7%90%86-1><span class=nav-number>1.3.3.1.</span> <span class=nav-text>预处理</span></a><li class="nav-item nav-level-5"><a class=nav-link href=#%E5%88%86%E6%9E%90%E8%AF%8D%E6%B3%95%E5%8A%9F%E8%83%BD><span class=nav-number>1.3.3.2.</span> <span class=nav-text>分析词法功能</span></a><li class="nav-item nav-level-5"><a class=nav-link href=#%E5%88%86%E6%9E%90%E8%AF%AD%E6%B3%95%E4%BA%A7%E7%94%9F%E5%87%BA%E7%9A%84%E6%8A%BD%E8%B1%A1%E8%AF%AD%E6%B3%95%E6%A0%91><span class=nav-number>1.3.3.3.</span> <span class=nav-text>分析语法产生出的抽象语法树</span></a><li class="nav-item nav-level-5"><a class=nav-link href=#%E4%B8%AD%E9%97%B4%E4%BB%A3%E7%A0%81%E7%94%9F%E6%88%90><span class=nav-number>1.3.3.4.</span> <span class=nav-text>中间代码生成</span></a><li class="nav-item nav-level-5"><a class=nav-link href=#%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80%E7%94%9F%E6%88%90><span class=nav-number>1.3.3.5.</span> <span class=nav-text>汇编语言生成</span></a><li class="nav-item nav-level-5"><a class=nav-link href=#%E5%8F%AF%E6%89%A7%E8%A1%8C%E7%A8%8B%E5%BA%8F%E7%94%9F%E6%88%90><span class=nav-number>1.3.3.6.</span> <span class=nav-text>可执行程序生成</span></a><li class="nav-item nav-level-5"><a class=nav-link href=#%E5%8F%8D%E6%B1%87%E7%BC%96%E7%A8%8B%E5%BA%8F><span class=nav-number>1.3.3.7.</span> <span class=nav-text>反汇编程序</span></a></ol></ol></ol><li class="nav-item nav-level-2"><a class=nav-link href=#2><span class=nav-number>2.</span> <span class=nav-text>2.</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#make%E5%B9%B6%E8%A1%8C%E7%BC%96%E8%AF%91><span class=nav-number>2.1.</span> <span class=nav-text>make并行编译</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#update-1><span class=nav-number>2.2.</span> <span class=nav-text>update</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#Cmake%E4%BD%BF%E7%94%A8><span class=nav-number>2.3.</span> <span class=nav-text>Cmake使用</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99><span class=nav-number>2.4.</span> <span class=nav-text>参考资料</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#%E4%B8%AA%E4%BA%BA%E6%84%9F%E6%83%B3><span class=nav-number>2.5.</span> <span class=nav-text>个人感想</span></a></ol></ol></div></div><!--/noindex--><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop=author itemscope itemtype=http://schema.org/Person><img alt=Sekyoro class=site-author-image itemprop=image src=https://i.loli.net/2021/05/17/YqoavnXdGTpPO9R.jpg><p class=site-author-name itemprop=name>Sekyoro<div class=site-description itemprop=description>什么也无法舍弃的人，什么也做不了.</div></div><div class="site-state-wrap motion-element"><nav class=site-state><div class="site-state-item site-state-posts"><a href=/archives/> <span class=site-state-item-count>259</span> <span class=site-state-item-name>日志</span> </a></div><div class="site-state-item site-state-categories"><a href=/categories/> <span class=site-state-item-count>16</span> <span class=site-state-item-name>分类</span></a></div><div class="site-state-item site-state-tags"><a href=/tags/> <span class=site-state-item-count>220</span> <span class=site-state-item-name>标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class=links-of-author-item> <a title="Personal Website → http://proanimer.com" href=http://proanimer.com/ rel=noopener target=_blank><i class="fab fa-internet-explorer fa-fw"></i>Personal Website</a> </span><span class=links-of-author-item> <a title="GitHub → https://github.com/drowning-in-codes" href=https://github.com/drowning-in-codes rel=noopener target=_blank><i class="fab fa-github fa-fw"></i>GitHub</a> </span><span class=links-of-author-item> <a title="E-Mail → mailto:bukalala174@gmail.com" href=mailto:bukalala174@gmail.com rel=noopener target=_blank><i class="fa fa-envelope fa-fw"></i>E-Mail</a> </span><span class=links-of-author-item> <a title="wxPublicAccount → https://mp.weixin.qq.com/s?__biz=Mzg3ODY1MDkzMg==&mid=2247483770&idx=1&sn=fdf88faab01d5c219ac609570a21c9d6&chksm=cf113221f866bb373938cfca03cf095ff4fe1e4dc37d68ef5de4cd4876ee1260fca0c015a4d6&token=1096259873&lang=zh_CN#rd" href=https://mp.weixin.qq.com/s?__biz=Mzg3ODY1MDkzMg==&mid=2247483770&idx=1&sn=fdf88faab01d5c219ac609570a21c9d6&chksm=cf113221f866bb373938cfca03cf095ff4fe1e4dc37d68ef5de4cd4876ee1260fca0c015a4d6&token=1096259873&lang=zh_CN#rd rel=noopener target=_blank><i class="fab fa-weixin fa-fw"></i>wxPublicAccount</a> </span><span class=links-of-author-item> <a title="RSS → /atom.xml" href=/atom.xml><i class="fa fa-rss fa-fw"></i>RSS</a> </span><span class=links-of-author-item> <a title="CSDN → https://blog.csdn.net/aqwca" href=https://blog.csdn.net/aqwca rel=noopener target=_blank><i class="fa fa-handshake fa-fw"></i>CSDN</a> </span><span class=links-of-author-item> <a title="杂鱼分享 → https://my-astro-git-main-drowning-in-codes.vercel.app" href=https://my-astro-git-main-drowning-in-codes.vercel.app/ rel=noopener target=_blank><i class="fas fa-share fa-fw"></i>杂鱼分享</a> </span></div><div class="links-of-blogroll motion-element"><div class=links-of-blogroll-title><i class="fa fa-link fa-fw"></i> 友情链接</div><ul class=links-of-blogroll-list><li class=links-of-blogroll-item><a href=http://myqhs.top/ rel=noopener target=_blank title=http://myqhs.top/>myqhs</a><li class=links-of-blogroll-item><a href=https://www.lllomh.com/ rel=noopener target=_blank title=https://www.lllomh.com/>芈渡</a><li class=links-of-blogroll-item><a href=https://protool-ten.vercel.app/ rel=noopener target=_blank title=https://protool-ten.vercel.app/>protools</a></ul></div><div class="motion-element announcement"><div class=title></div><p class=content><p class=date></div></div><meting-js id=6856787487 order=random server=netease type=playlist> </meting-js><div class=widget-wrap><h3 class=widget-title style=margin:0>文章词云</h3><div class="widget tagcloud" id=myCanvasContainer><canvas height=250 id=resCanvas style=width:100% width=250><ul class=tag-list itemprop=keywords><li class=tag-list-item><a class=tag-list-link href=/tags/compile/ rel=tag>compile</a><span class=tag-list-count>1</span><li class=tag-list-item><a class=tag-list-link href=/tags/course/ rel=tag>course</a><span class=tag-list-count>1</span></ul></canvas></div></div><script id=clustrmaps src=https://clustrmaps.com/map_v2.js?d=xQdGTxqARTBiNIwX2aUban-ixkj2s6VaZQWo-aVCgY8&cl=ffffff&w=a></script><div class="back-to-top motion-element"><i class="fa fa-arrow-up"></i><span>0%</span></div><!-- 边栏 --></div></aside><div id=sidebar-dimmer></div></div></main><footer class=footer><div class=footer-inner><div class=copyright>© Wed Apr 08 2020 08:00:00 GMT+0800 (中国标准时间) – <span itemprop=copyrightYear>2026</span><span class=with-love> <i class="fa fa-heart"></i> </span><span class=author itemprop=copyrightHolder>Sekyoro</span><span class=post-meta-divider>|</span><span class=post-meta-item-icon> <i class="fa fa-chart-area"></i> </span><span title=站点总字数>4.3m</span><span class=post-meta-divider>|</span><span class=post-meta-item-icon> <i class="fa fa-coffee"></i> </span><span title=站点阅读时长>64:45</span></div><script async src=https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js></script><span id=busuanzi_container_site_pv>总访问量<span id=busuanzi_value_site_pv></span>次</span><span class=post-meta-divider>|</span><span id=busuanzi_container_site_uv>总访客数<span id=busuanzi_value_site_uv></span>人</span><span class=post-meta-divider>|</span><!-- 不蒜子计数初始值纠正 --><script>document.addEventListener("DOMContentLoaded", function() {
    var int = setInterval(fixCount, 50);  // 50ms周期检测函数
    var countOffset = 20000;  // 初始化首次数据

    function fixCount() {
        var pvContainer = document.getElementById("busuanzi_container_site_pv");
        if (pvContainer && pvContainer.style.display !== "none") {
            var pvElement = document.getElementById("busuanzi_value_site_pv");
            if (pvElement) {
                pvElement.innerHTML = parseInt(pvElement.innerHTML) + countOffset;
                clearInterval(int);
            }
        }
        
        var uvContainer = document.getElementById("busuanzi_container_site_uv");
        if (uvContainer && window.getComputedStyle(uvContainer).display !== "none")
        {
            var uvElement = document.getElementById("busuanzi_value_site_uv");
            if (uvElement) {
                uvElement.innerHTML = parseInt(uvElement.innerHTML) + countOffset; // 加上初始数据 
                clearInterval(int); // 停止检测
            }
        }
    }
});</script><div><span id=timeDate>载入天数...</span><span id=times>载入时分秒...</span><script>var now = new Date();
    function createtime() {
        var grt= new Date("04/08/2021 20:00:00");
        now.setTime(now.getTime()+250);
        days = (now - grt ) / 1000 / 60 / 60 / 24; dnum = Math.floor(days);
        hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum); hnum = Math.floor(hours);
        if(String(hnum).length ==1 ){hnum = "0" + hnum;} minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum);
        mnum = Math.floor(minutes); if(String(mnum).length ==1 ){mnum = "0" + mnum;}
        seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum);
        snum = Math.round(seconds); if(String(snum).length ==1 ){snum = "0" + snum;}
        document.getElementById("timeDate").innerHTML = "本站已安全运行 "+dnum+" 天 ";
        document.getElementById("times").innerHTML = hnum + " 小时 " + mnum + " 分 " + snum + " 秒";
    }
setInterval("createtime()",250);</script></div><div class=busuanzi-count><script async data-pjax src=https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><span style="display: none;" class=post-meta-item id=busuanzi_container_site_uv> <span class=post-meta-item-icon> <i class="fa fa-user"></i> </span> <span class=site-uv title=总访客量> <span id=busuanzi_value_site_uv></span> </span> </span><span class=post-meta-divider>|</span><span style="display: none;" class=post-meta-item id=busuanzi_container_site_pv> <span class=post-meta-item-icon> <i class="fa fa-eye"></i> </span> <span class=site-pv title=总访问量> <span id=busuanzi_value_site_pv></span> </span> </span></div></div></footer></div><script color=0,0,255 count=99 opacity=0.5 src=/lib/canvas-nest/canvas-nest.min.js zindex=-1></script><script src=/lib/anime.min.js></script><script src=https://cdn.jsdelivr.net/gh/theme-next/theme-next-pjax@0/pjax.min.js></script><script src=https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js></script><script src=https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js></script><script src=https://cdn.jsdelivr.net/npm/lozad@1/dist/lozad.min.js></script><script src=https://cdn.jsdelivr.net/npm/velocity-animate@1/velocity.min.js></script><script src=https://cdn.jsdelivr.net/npm/velocity-animate@1/velocity.ui.min.js></script><script src=/js/utils.js></script><script src=/js/motion.js></script><script src=/js/schemes/pisces.js></script><script src=/js/next-boot.js></script><script src=/js/bookmark.js></script><script>var pjax = new Pjax({
  selectors: [
    'head title',
    '#page-configurations',
    '.content-wrap',
    '.post-toc-wrap',
    '.languages',
    '#pjax',
	 '.widget-wrap'
  ],
  switches: {
    '.post-toc-wrap': Pjax.switches.innerHTML
  },
  analytics: false,
  cacheBust: false,
  scrollTo : !CONFIG.bookmark.enable
});

window.addEventListener('pjax:success', () => {
  document.querySelectorAll('script[data-pjax], script#page-configurations, #pjax script').forEach(element => {
    var code = element.text || element.textContent || element.innerHTML || '';
    var parent = element.parentNode;
    parent.removeChild(element);
    var script = document.createElement('script');
    if (element.id) {
      script.id = element.id;
    }
    if (element.className) {
      script.className = element.className;
    }
    if (element.type) {
      script.type = element.type;
    }
    if (element.src) {
      script.src = element.src;
      // Force synchronous loading of peripheral JS.
      script.async = false;
    }
    if (element.dataset.pjax !== undefined) {
      script.dataset.pjax = '';
    }
    if (code !== '') {
      script.appendChild(document.createTextNode(code));
    }
    parent.appendChild(script);
  });
 
  NexT.boot.refresh();
  // Define Motion Sequence & Bootstrap Motion.
  if (CONFIG.motion.enable) {
    NexT.motion.integrator
      .init()
      .add(NexT.motion.middleWares.subMenu)
      .add(NexT.motion.middleWares.postList)
      .bootstrap();
  }
  NexT.utils.updateSidebarPosition();
  
  // Reinitialize TagCanvas for tag cloud
  if (typeof TagCanvas !== 'undefined' && document.getElementById('resCanvas')) {
    try {
      TagCanvas.textFont = 'Trebuchet MS, Helvetica';
      TagCanvas.textColour = '#333';
      TagCanvas.textHeight = 20;
      TagCanvas.outlineColour = '#E2E1D1';
      TagCanvas.maxSpeed = 0.3;
      TagCanvas.freezeActive = true;
      TagCanvas.outlineMethod = 'block';
      TagCanvas.minBrightness = 0.2;
      TagCanvas.depth = 0.92;
      TagCanvas.pulsateTo = 0.6;
      TagCanvas.initial = [0.1,-0.1];
      TagCanvas.decel = 0.98;
      TagCanvas.reverse = true;
      TagCanvas.hideTags = false;
      TagCanvas.shadow = '#ccf';
      TagCanvas.shadowBlur = 3;
      TagCanvas.weight = false;
      TagCanvas.imageScale = null;
      TagCanvas.fadeIn = 1000;
      TagCanvas.clickToFront = 600;
      TagCanvas.lock = false;
      TagCanvas.Start('resCanvas');
      TagCanvas.tc['resCanvas'].Wheel(true);
    } catch(e) {
      console.log('TagCanvas initialization failed:', e);
    }
  }
});</script><script data-pjax>(function(){
      var canonicalURL, curProtocol;
      //Get the <link> tag
      var x=document.getElementsByTagName("link");
		//Find the last canonical URL
		if(x.length > 0){
			for (i=0;i<x.length;i++){
				if(x[i].rel.toLowerCase() == 'canonical' && x[i].href){
					canonicalURL=x[i].href;
				}
			}
		}
    //Get protocol
	    if (!canonicalURL){
	    	curProtocol = window.location.protocol.split(':')[0];
	    }
	    else{
	    	curProtocol = canonicalURL.split(':')[0];
	    }
      //Get current URL if the canonical URL does not exist
	    if (!canonicalURL) canonicalURL = window.location.href;
	    //Assign script content. Replace current URL with the canonical URL
      !function(){var e=/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi,r=canonicalURL,t=document.referrer;if(!e.test(r)){var n=(String(curProtocol).toLowerCase() === 'https')?"https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif":"//api.share.baidu.com/s.gif";t?(n+="?r="+encodeURIComponent(document.referrer),r&&(n+="&l="+r)):r&&(n+="?l="+r);var i=new Image;i.src=n}}(window);})();</script><script src=https://cdn.jsdelivr.net/npm/algoliasearch@4/dist/algoliasearch-lite.umd.js></script><script src=https://cdn.jsdelivr.net/npm/instantsearch.js@4/dist/instantsearch.production.min.js></script><script src=/js/algolia-search.js></script><script data-pjax>document.querySelectorAll('.pdfobject-container').forEach(element => {
  let url = element.dataset.target;
  let pdfOpenParams = {
    navpanes : 0,
    toolbar  : 0,
    statusbar: 0,
    pagemode : 'thumbs',
    view     : 'FitH'
  };
  let pdfOpenFragment = '#' + Object.entries(pdfOpenParams).map(([key, value]) => `${key}=${encodeURIComponent(value)}`).join('&');
  let fullURL = `/lib/pdf/web/viewer.html?file=${encodeURIComponent(url)}${pdfOpenFragment}`;

  if (NexT.utils.supportsPDFs()) {
    element.innerHTML = `<embed class="pdfobject" src="${url + pdfOpenFragment}" type="application/pdf" style="height: ${element.dataset.height};">`;
  } else {
    element.innerHTML = `<iframe src="${fullURL}" style="height: ${element.dataset.height};" frameborder="0"></iframe>`;
  }
});</script><div id=pjax><script charset=utf-8 defer src=/js/outdate.js></script></div><script charset=utf-8 defer src=/js/tagcanvas.js></script><script charset=utf-8 defer src=/js/tagcloud.js></script><script>NexT.utils.loadComments(document.querySelector('#lv-container'), () => {
  window.livereOptions = {
    refer: location.pathname.replace(CONFIG.root, '').replace('index.html', '')
  };
  (function(d, s) {
    var j, e = d.getElementsByTagName(s)[0];
    if (typeof LivereTower === 'function') { return; }
    j = d.createElement(s);
    j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
    j.async = true;
    e.parentNode.insertBefore(j, e);
  })(document, 'script');
});</script><script>var OriginTitile = document.title;
  var titleTime;
  document.addEventListener("visibilitychange", function() {
    if (document.hidden) {
      document.title = "(つェ⊂)我藏好了哦~" + OriginTitile;
      clearTimeout(titleTime);
    } else {
      document.title = "(*´∇｀*) 被你发现啦~" + OriginTitile;
      titleTime = setTimeout(function() {
        document.title = OriginTitile;
      }, 2000);
    }
  });</script><script src=/js/src/activate-power-mode.min.js></script><script>POWERMODE.colorful = true;
    POWERMODE.shake = false;
    document.body.addEventListener('input', POWERMODE);</script>